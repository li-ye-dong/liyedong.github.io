{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u674e\u70e8\u680b\u7684\u535a\u5ba2","text":"<p>\u6b22\u8fce\u6765\u5230\u674e\u70e8\u680b\u7684\u4e2a\u4eba\u535a\u5ba2\uff01\u672c\u535a\u5ba2\u4e13\u6ce8\u4e8e\u5206\u4eab\u6280\u672f\u77e5\u8bc6\u3001\u9879\u76ee\u7ecf\u9a8c\u548c\u5b66\u4e60\u5fc3\u5f97\u3002</p>"},{"location":"#_2","title":"\u5173\u4e8e\u6211","text":"<p>\u6211\u662f\u674e\u70e8\u680b\uff0c\u4e00\u540d\u5728 IT \u884c\u4e1a\u5de5\u4f5c\u7684\u6280\u672f\u7231\u597d\u8005\uff0c\u81f4\u529b\u4e8e\u63a2\u7d22\u8ba1\u7b97\u673a\u6280\u672f\u548c\u8f6f\u4ef6\u5f00\u53d1\u9886\u57df\u7684\u6700\u65b0\u52a8\u6001\u3002\u6211\u7684\u4e3b\u8981\u5174\u8da3\u5305\u62ec\uff1a - \u8ba1\u7b97\u673a\u7f51\u7edc\uff1aDNS \u914d\u7f6e\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u7f51\u7edc\u5b89\u5168\u7b49 - \u865a\u62df\u5316\u6280\u672f\uff1aOpenStack\u3001KVM\u3001VMware - Web \u5f00\u53d1\uff1aDjango\u3001Flask\u3001FastAPI \u7b49\u6846\u67b6 - \u6570\u636e\u5904\u7406\u4e0e\u6570\u636e\u5e93\uff1aSQL Server\u3001MongoDB\u3001SQLite</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u5c06\u5206\u4eab\u6211\u7684\u7814\u7a76\u6210\u679c\u3001\u5b9e\u6218\u7ecf\u9a8c\u4ee5\u53ca\u89e3\u51b3\u65b9\u6848\uff0c\u5e2e\u52a9\u66f4\u591a\u6280\u672f\u7231\u597d\u8005\u548c\u5f00\u53d1\u8005\u5171\u540c\u8fdb\u6b65\u3002</p>"},{"location":"#_3","title":"\u535a\u5ba2\u4e3b\u9898","text":"<p>\u672c\u535a\u5ba2\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u4e3b\u9898\uff1a - \u6280\u672f\u6559\u7a0b\uff1a\u6df1\u5165\u6d45\u51fa\u5730\u8bb2\u89e3\u7f51\u7edc\u3001\u865a\u62df\u5316\u3001\u6570\u636e\u5e93\u7b49\u6280\u672f - \u9879\u76ee\u5206\u4eab\uff1a\u5c55\u793a\u6211\u5728\u5de5\u4f5c\u548c\u5b66\u4e60\u4e2d\u7684\u9879\u76ee\u5b9e\u4f8b\u548c\u89e3\u51b3\u65b9\u6848 - \u4ee3\u7801\u7247\u6bb5\uff1a\u63d0\u4f9b\u5e38\u7528\u7684\u4ee3\u7801\u7247\u6bb5\u548c\u811a\u672c\uff0c\u4fbf\u4e8e\u65e5\u5e38\u5f00\u53d1 - \u5b66\u4e60\u5fc3\u5f97\uff1a\u5206\u4eab\u5bf9\u8ba1\u7b97\u673a\u6280\u672f\u7684\u7406\u89e3\u548c\u5fc3\u5f97\u4f53\u4f1a</p>"},{"location":"#_4","title":"\u5982\u4f55\u5f00\u59cb","text":"<p>\u5982\u679c\u4f60\u5bf9\u4efb\u4f55\u4e3b\u9898\u611f\u5174\u8da3\uff0c\u8bf7\u968f\u65f6\u7559\u8a00\u4ea4\u6d41\uff0c\u671f\u5f85\u4e0e\u4f60\u5171\u540c\u63a2\u8ba8\uff01</p> <p>\u6ce8\u610f: \u672c\u535a\u5ba2\u5185\u5bb9\u4ec5\u4f9b\u5b66\u4e60\u548c\u53c2\u8003\uff0c\u5982\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u6b22\u8fce\u8054\u7cfb\u6211\u3002</p> <p>\u611f\u8c22\u4f60\u7684\u5230\u6765\uff0c\u5e0c\u671b\u4f60\u5728\u8fd9\u91cc\u6536\u83b7\u65b0\u7684\u77e5\u8bc6\u548c\u7075\u611f\uff01</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/","title":"Docker\u7b14\u8bb0","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#1","title":"1.\u57fa\u7840\u547d\u4ee4","text":"<pre><code> yum update\n yum install -y yum-utils device-mapper-persistent-data lvm2\n yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n yum install docker-ce #\u793e\u533a\u7248\n docker -v\n</code></pre> <p>\u8bbe\u7f6e\u56fd\u5185ustc\u955c\u50cf</p> <pre><code>vi /etc/docker/daemon.json\n</code></pre> <pre><code>{\n    \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"]\n}\n</code></pre> <p>\u542f\u52a8</p> <pre><code>systemctl start docker\nsystemctl restart docker\n</code></pre> <p>\u72b6\u6001</p> <pre><code>systemctl status docker\n</code></pre> <p>\u505c\u6b62</p> <pre><code>systemctl stop docker\n</code></pre> <p>\u5f00\u673a\u81ea\u542f\u52a8</p> <pre><code>systemctl enable docker\n</code></pre> <p>\u67e5\u770b\u6982\u8981</p> <pre><code>docker info\n</code></pre> <p>\u5e2e\u52a9</p> <pre><code>docker --help\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#2","title":"2.\u955c\u50cf","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_1","title":"\u83b7\u53d6\u955c\u50cf","text":"<pre><code>docker pull ubuntu\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_2","title":"\u67e5\u770b\u955c\u50cf","text":"<pre><code>docker images\n</code></pre> <p>\u5404\u4e2a\u9009\u9879\u8bf4\u660e:</p> <ul> <li>REPOSITORY\uff1a\u8868\u793a\u955c\u50cf\u7684\u4ed3\u5e93\u6e90</li> <li>TAG\uff1a\u955c\u50cf\u7684\u6807\u7b7e</li> <li>IMAGE ID\uff1a\u955c\u50cfID</li> <li>CREATED\uff1a\u955c\u50cf\u521b\u5efa\u65f6\u95f4</li> <li>SIZE\uff1a\u955c\u50cf\u5927\u5c0f</li> </ul>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_3","title":"\u641c\u7d22","text":"<pre><code>docker search xxx\n</code></pre> <p>NAME: \u955c\u50cf\u4ed3\u5e93\u6e90\u7684\u540d\u79f0</p> <p>DESCRIPTION: \u955c\u50cf\u7684\u63cf\u8ff0</p> <p>OFFICIAL: \u662f\u5426 docker \u5b98\u65b9\u53d1\u5e03</p> <p>stars: \u7c7b\u4f3c Github \u91cc\u9762\u7684 star\uff0c\u8868\u793a\u70b9\u8d5e\u3001\u559c\u6b22\u7684\u610f\u601d\u3002</p> <p>AUTOMATED: \u81ea\u52a8\u6784\u5efa\u3002</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#1510ubuntu","title":"\u7528\u7248\u672c\u4e3a15.10\u7684ubuntu\u7cfb\u7edf\u955c\u50cf","text":"<p>\u6765\u8fd0\u884c\u5bb9\u5668\u65f6\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>runoob@runoob:~$ docker run -t -i ubuntu:15.10 /bin/bash \nroot@d77ccb2e5cca:/#\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>-i: \u4ea4\u4e92\u5f0f\u64cd\u4f5c\u3002</li> <li>-t: \u7ec8\u7aef\u3002</li> <li>ubuntu:15.10: \u8fd9\u662f\u6307\u7528 ubuntu 15.10 \u7248\u672c\u955c\u50cf\u4e3a\u57fa\u7840\u6765\u542f\u52a8\u5bb9\u5668\u3002</li> <li>/bin/bash\uff1a\u653e\u5728\u955c\u50cf\u540d\u540e\u7684\u662f\u547d\u4ee4\uff0c\u8fd9\u91cc\u6211\u4eec\u5e0c\u671b\u6709\u4e2a\u4ea4\u4e92\u5f0f Shell\uff0c\u56e0\u6b64\u7528\u7684\u662f /bin/bash\u3002</li> </ul>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_4","title":"\u5220\u9664\u955c\u50cf","text":"<p>\u955c\u50cf\u5220\u9664\u4f7f\u7528 docker rmi \u547d\u4ee4\uff0c\u6bd4\u5982\u6211\u4eec\u5220\u9664 hello-world \u955c\u50cf\uff1a</p> <pre><code> docker rmi hello-world\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_5","title":"\u521b\u5efa\u955c\u50cf","text":"<p>\u5f53\u6211\u4eec\u4ece docker \u955c\u50cf\u4ed3\u5e93\u4e2d\u4e0b\u8f7d\u7684\u955c\u50cf\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u5bf9\u955c\u50cf\u8fdb\u884c\u66f4\u6539\u3002</p> <ul> <li>1\u3001\u4ece\u5df2\u7ecf\u521b\u5efa\u7684\u5bb9\u5668\u4e2d\u66f4\u65b0\u955c\u50cf\uff0c\u5e76\u4e14\u63d0\u4ea4\u8fd9\u4e2a\u955c\u50cf</li> <li>2\u3001\u4f7f\u7528 Dockerfile \u6307\u4ee4\u6765\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u955c\u50cf</li> </ul>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_6","title":"\u66f4\u65b0\u955c\u50cf","text":"<p>\u66f4\u65b0\u955c\u50cf\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u955c\u50cf\u6765\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u3002</p> <pre><code>runoob@runoob:~$ docker run -t -i ubuntu:15.10 /bin/bash\nroot@e218edb10161:/# \n</code></pre> <p>\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u5185\u4f7f\u7528 apt-get update \u547d\u4ee4\u8fdb\u884c\u66f4\u65b0\u3002</p> <p>\u5728\u5b8c\u6210\u64cd\u4f5c\u4e4b\u540e\uff0c\u8f93\u5165 exit \u547d\u4ee4\u6765\u9000\u51fa\u8fd9\u4e2a\u5bb9\u5668\u3002</p> <p>\u6b64\u65f6 ID \u4e3a e218edb10161 \u7684\u5bb9\u5668\uff0c\u662f\u6309\u6211\u4eec\u7684\u9700\u6c42\u66f4\u6539\u7684\u5bb9\u5668\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 docker commit \u6765\u63d0\u4ea4\u5bb9\u5668\u526f\u672c\u3002</p> <pre><code>runoob@runoob:~$ docker commit -m=\"has update\" -a=\"runoob\" e218edb10161 runoob/ubuntu:v2\nsha256:70bf1840fd7c0d2d8ef0a42a817eb29f854c1af8f7c59fc03ac7bdee9545aff8\n</code></pre> <p>\u5404\u4e2a\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>-m: \u63d0\u4ea4\u7684\u63cf\u8ff0\u4fe1\u606f</li> <li>-a: \u6307\u5b9a\u955c\u50cf\u4f5c\u8005</li> <li>e218edb10161\uff1a\u5bb9\u5668 ID</li> <li>runoob/ubuntu:v2: \u6307\u5b9a\u8981\u521b\u5efa\u7684\u76ee\u6807\u955c\u50cf\u540d</li> </ul>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_7","title":"\u6784\u5efa\u955c\u50cf","text":"<p>\u6211\u4eec\u4f7f\u7528\u547d\u4ee4 docker build \uff0c \u4ece\u96f6\u5f00\u59cb\u6765\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u955c\u50cf\u3002\u4e3a\u6b64\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a Dockerfile \u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u7ec4\u6307\u4ee4\u6765\u544a\u8bc9 Docker \u5982\u4f55\u6784\u5efa\u6211\u4eec\u7684\u955c\u50cf\u3002</p> <pre><code>runoob@runoob:~$ cat Dockerfile \nFROM    centos:6.7\nMAINTAINER      Fisher \"fisher@sudops.com\"\n\nRUN     /bin/echo 'root:123456' |chpasswd\nRUN     useradd runoob\nRUN     /bin/echo 'runoob:123456' |chpasswd\nRUN     /bin/echo -e \"LANG=\\\"en_US.UTF-8\\\"\" &gt;/etc/default/local\nEXPOSE  22\nEXPOSE  80\nCMD     /usr/sbin/sshd -D\n</code></pre> <p>\u6bcf\u4e00\u4e2a\u6307\u4ee4\u90fd\u4f1a\u5728\u955c\u50cf\u4e0a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5c42\uff0c\u6bcf\u4e00\u4e2a\u6307\u4ee4\u7684\u524d\u7f00\u90fd\u5fc5\u987b\u662f\u5927\u5199\u7684\u3002</p> <p>\u7b2c\u4e00\u6761FROM\uff0c\u6307\u5b9a\u4f7f\u7528\u54ea\u4e2a\u955c\u50cf\u6e90</p> <p>RUN \u6307\u4ee4\u544a\u8bc9docker \u5728\u955c\u50cf\u5185\u6267\u884c\u547d\u4ee4\uff0c\u5b89\u88c5\u4e86\u4ec0\u4e48\u3002\u3002\u3002</p> <p>\u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 Dockerfile \u6587\u4ef6\uff0c\u901a\u8fc7 docker build \u547d\u4ee4\u6765\u6784\u5efa\u4e00\u4e2a\u955c\u50cf\u3002</p> <pre><code>runoob@runoob:~$ docker build -t runoob/centos:6.7 .\nSending build context to Docker daemon 17.92 kB\nStep 1 : FROM centos:6.7\n ---&amp;gt; d95b5ca17cc3\nStep 2 : MAINTAINER Fisher \"fisher@sudops.com\"\n ---&amp;gt; Using cache\n ---&amp;gt; 0c92299c6f03\nStep 3 : RUN /bin/echo 'root:123456' |chpasswd\n ---&amp;gt; Using cache\n ---&amp;gt; 0397ce2fbd0a\nStep 4 : RUN useradd runoob\n......\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>-t \uff1a\u6307\u5b9a\u8981\u521b\u5efa\u7684\u76ee\u6807\u955c\u50cf\u540d</li> <li>. \uff1aDockerfile \u6587\u4ef6\u6240\u5728\u76ee\u5f55\uff0c\u53ef\u4ee5\u6307\u5b9aDockerfile \u7684\u7edd\u5bf9\u8def\u5f84</li> </ul> <p>\u4f7f\u7528docker images \u67e5\u770b\u521b\u5efa\u7684\u955c\u50cf\u5df2\u7ecf\u5728\u5217\u8868\u4e2d\u5b58\u5728,\u955c\u50cfID\u4e3a860c279d2fec</p> <pre><code>runoob@runoob:~$ docker images \nREPOSITORY          TAG                 IMAGE ID            CREATED              SIZE\nrunoob/centos       6.7                 860c279d2fec        About a minute ago   190.6 MB\nrunoob/ubuntu       v2                  70bf1840fd7c        17 hours ago         158.5 MB\nubuntu              14.04               90d5884b1ee0        6 days ago           188 MB\nphp                 5.6                 f40e9e0f10c8        10 days ago          444.8 MB\nnginx               latest              6f8d099c3adc        12 days ago          182.7 MB\nmysql               5.6                 f2e8d6c772c0        3 weeks ago          324.6 MB\nhttpd               latest              02ef73cf1bc0        3 weeks ago          194.4 MB\nubuntu              15.10               4e3b13c8a266        5 weeks ago          136.3 MB\nhello-world         latest              690ed74de00f        6 months ago         960 B\ncentos              6.7                 d95b5ca17cc3        6 months ago         190.6 MB\ntraining/webapp     latest              6fae60ef3446        12 months ago        348.8 MB\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u65b0\u7684\u955c\u50cf\u6765\u521b\u5efa\u5bb9\u5668</p> <pre><code>runoob@runoob:~$ docker run -t -i runoob/centos:6.7  /bin/bash\n[root@41c28d18b5fb /]# id runoob\nuid=500(runoob) gid=500(runoob) groups=500(runoob)\n</code></pre> <p>\u4ece\u4e0a\u9762\u770b\u5230\u65b0\u955c\u50cf\u5df2\u7ecf\u5305\u542b\u6211\u4eec\u521b\u5efa\u7684\u7528\u6237 runoob\u3002</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_8","title":"\u8bbe\u7f6e\u955c\u50cf\u6807\u7b7e","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 docker tag \u547d\u4ee4\uff0c\u4e3a\u955c\u50cf\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u6807\u7b7e\u3002</p> <pre><code>runoob@runoob:~$ docker tag 860c279d2fec runoob/centos:dev\n</code></pre> <p>docker tag \u955c\u50cfID\uff0c\u8fd9\u91cc\u662f 860c279d2fec ,\u7528\u6237\u540d\u79f0\u3001\u955c\u50cf\u6e90\u540d(repository name)\u548c\u65b0\u7684\u6807\u7b7e\u540d(tag)\u3002</p> <p>\u4f7f\u7528 docker images \u547d\u4ee4\u53ef\u4ee5\u770b\u5230\uff0cID\u4e3a860c279d2fec\u7684\u955c\u50cf\u591a\u4e00\u4e2a\u6807\u7b7e\u3002</p> <pre><code>runoob@runoob:~$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nrunoob/centos       6.7                 860c279d2fec        5 hours ago         190.6 MB\nrunoob/centos       dev                 860c279d2fec        5 hours ago         190.6 MB\nrunoob/ubuntu       v2                  70bf1840fd7c        22 hours ago        158.5 MB\nubuntu              14.04               90d5884b1ee0        6 days ago          188 MB\nphp                 5.6                 f40e9e0f10c8        10 days ago         444.8 MB\nnginx               latest              6f8d099c3adc        13 days ago         182.7 MB\nmysql               5.6                 f2e8d6c772c0        3 weeks ago         324.6 MB\nhttpd               latest              02ef73cf1bc0        3 weeks ago         194.4 MB\nubuntu              15.10               4e3b13c8a266        5 weeks ago         136.3 MB\nhello-world         latest              690ed74de00f        6 months ago        960 B\ncentos              6.7                 d95b5ca17cc3        6 months ago        190.6 MB\ntraining/webapp     latest              6fae60ef3446        12 months ago       348.8 MB\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#3","title":"3.\u5bb9\u5668","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_9","title":"\u542f\u52a8\u5bb9\u5668","text":"<pre><code>docker run -it ubuntu /bin/bash\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>-i: \u4ea4\u4e92\u5f0f\u64cd\u4f5c\u3002</li> <li>-t: \u7ec8\u7aef\u3002</li> <li>ubuntu: ubuntu \u955c\u50cf\u3002</li> <li>/bin/bash\uff1a\u653e\u5728\u955c\u50cf\u540d\u540e\u7684\u662f\u547d\u4ee4\uff0c\u8fd9\u91cc\u6211\u4eec\u5e0c\u671b\u6709\u4e2a\u4ea4\u4e92\u5f0f Shell\uff0c\u56e0\u6b64\u7528\u7684\u662f /bin/bash\u3002</li> </ul>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_10","title":"\u542f\u52a8\u5df2\u505c\u6b62\u8fd0\u884c\u7684\u5bb9\u5668","text":"<p>\u67e5\u770b\u6240\u6709\u7684\u5bb9\u5668\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>docker ps -a\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_11","title":"\u5f00\u542f\u5bb9\u5668","text":"<pre><code>docker start id\u53f7\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_12","title":"\u540e\u53f0\u8fd0\u884c","text":"<p>\u5728\u5927\u90e8\u5206\u7684\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e0c\u671b docker \u7684\u670d\u52a1\u662f\u5728\u540e\u53f0\u8fd0\u884c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8fc7 -d \u6307\u5b9a\u5bb9\u5668\u7684\u8fd0\u884c\u6a21\u5f0f\u3002</p> <pre><code>docker run -itd --name ubuntu-test ubuntu /bin/bash\n</code></pre> <p>\u6ce8\uff1a\u52a0\u4e86 -d \u53c2\u6570\u9ed8\u8ba4\u4e0d\u4f1a\u8fdb\u5165\u5bb9\u5668\uff0c\u60f3\u8981\u8fdb\u5165\u5bb9\u5668\u9700\u8981\u4f7f\u7528\u6307\u4ee4 docker exec\uff08\u4e0b\u9762\u4f1a\u4ecb\u7ecd\u5230\uff09\u3002</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_13","title":"\u540e\u53f0\u8fd0\u884c","text":"<p>\u5728\u5927\u90e8\u5206\u7684\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e0c\u671b docker \u7684\u670d\u52a1\u662f\u5728\u540e\u53f0\u8fd0\u884c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8fc7 -d \u6307\u5b9a\u5bb9\u5668\u7684\u8fd0\u884c\u6a21\u5f0f\u3002</p> <pre><code>$ docker run -itd --name ubuntu-test ubuntu /bin/bash\n</code></pre> <p>\u505c\u6b62\u7684\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7 docker restart \u91cd\u542f\uff1a</p> <pre><code>$ docker restart &lt;\u5bb9\u5668 ID&gt;\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_14","title":"\u8fdb\u5165\u5bb9\u5668","text":"<p>\u5728\u4f7f\u7528 -d \u53c2\u6570\u65f6\uff0c\u5bb9\u5668\u542f\u52a8\u540e\u4f1a\u8fdb\u5165\u540e\u53f0\u3002\u6b64\u65f6\u60f3\u8981\u8fdb\u5165\u5bb9\u5668\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6307\u4ee4\u8fdb\u5165\uff1a</p> <ul> <li>docker attach</li> <li>docker exec\uff1a\u63a8\u8350\u5927\u5bb6\u4f7f\u7528 docker exec \u547d\u4ee4\uff0c\u56e0\u4e3a\u6b64\u547d\u4ee4\u4f1a\u9000\u51fa\u5bb9\u5668\u7ec8\u7aef\uff0c\u4f46\u4e0d\u4f1a\u5bfc\u81f4\u5bb9\u5668\u7684\u505c\u6b62\u3002</li> </ul> <p>attach \u547d\u4ee4</p> <p>\u4e0b\u9762\u6f14\u793a\u4e86\u4f7f\u7528 docker attach \u547d\u4ee4\u3002</p> <pre><code>$ docker attach 1e560fca3906 \n</code></pre> <p>\u6ce8\u610f\uff1a \u5982\u679c\u4ece\u8fd9\u4e2a\u5bb9\u5668\u9000\u51fa\uff0c\u4f1a\u5bfc\u81f4\u5bb9\u5668\u7684\u505c\u6b62\u3002</p> <p>exec \u547d\u4ee4</p> <p>\u4e0b\u9762\u6f14\u793a\u4e86\u4f7f\u7528 docker exec \u547d\u4ee4\u3002</p> <pre><code>docker exec -it 243c32535da7 /bin/bash\n</code></pre> <p>\u6ce8\u610f\uff1a \u5982\u679c\u4ece\u8fd9\u4e2a\u5bb9\u5668\u9000\u51fa\uff0c\u5bb9\u5668\u4e0d\u4f1a\u505c\u6b62\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u63a8\u8350\u5927\u5bb6\u4f7f\u7528 docker exec \u7684\u539f\u56e0\u3002</p> <p>\u66f4\u591a\u53c2\u6570\u8bf4\u660e\u8bf7\u4f7f\u7528 docker exec --help \u547d\u4ee4\u67e5\u770b\u3002</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_15","title":"\u5bfc\u51fa\u548c\u5bfc\u5165\u5bb9\u5668","text":"<p>\u5bfc\u51fa\u5bb9\u5668</p> <p>\u5982\u679c\u8981\u5bfc\u51fa\u672c\u5730\u67d0\u4e2a\u5bb9\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528 docker export \u547d\u4ee4\u3002</p> <pre><code>$ docker export 1e560fca3906 &gt; ubuntu.tar\n</code></pre> <p>\u8fd9\u6837\u5c06\u5bfc\u51fa\u5bb9\u5668\u5feb\u7167\u5230\u672c\u5730\u6587\u4ef6\u3002</p> <p>\u5bfc\u5165\u5bb9\u5668\u5feb\u7167</p> <p>\u53ef\u4ee5\u4f7f\u7528 docker import \u4ece\u5bb9\u5668\u5feb\u7167\u6587\u4ef6\u4e2d\u518d\u5bfc\u5165\u4e3a\u955c\u50cf\uff0c\u4ee5\u4e0b\u5b9e\u4f8b\u5c06\u5feb\u7167\u6587\u4ef6 ubuntu.tar \u5bfc\u5165\u5230\u955c\u50cf test/ubuntu:v1:</p> <pre><code>$ cat docker/ubuntu.tar | docker import - test/ubuntu:v1\n</code></pre> <p>\u6b64\u5916\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a URL \u6216\u8005\u67d0\u4e2a\u76ee\u5f55\u6765\u5bfc\u5165\uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ docker import http://example.com/exampleimage.tgz example/imagerepo\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_16","title":"\u5220\u9664\u5bb9\u5668","text":"<p>\u5220\u9664\u5bb9\u5668\u4f7f\u7528 docker rm \u547d\u4ee4\uff1a</p> <pre><code>$ docker rm -f 1e560fca3906\n</code></pre> <p>\u4e0b\u9762\u7684\u547d\u4ee4\u53ef\u4ee5\u6e05\u7406\u6389\u6240\u6709\u5904\u4e8e\u7ec8\u6b62\u72b6\u6001\u7684\u5bb9\u5668\u3002</p> <pre><code>$ docker container prune\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#4","title":"4.\u6587\u4ef6\u62f7\u8d1d","text":"<p>\u5c06\u6587\u4ef6\u62f7\u8d1d\u5230\u5bb9\u5668\u5185\u53ef\u4ee5\u4f7f\u7528cp</p> <pre><code>docker cp \u9700\u8981\u62f7\u8d1d\u7684\u6587\u4ef6\u6216\u8005\u76ee\u5f55  \u5bb9\u5668\u540d\u79f0:\u5bb9\u5668\u76ee\u5f55\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5c06\u6587\u4ef6\u4ece\u5bb9\u5668\u4e2d\u62f7\u8d1d\u51fa\u6765</p> <pre><code>docker cp \u5bb9\u5668\u540d\u79f0:\u5bb9\u5668\u76ee\u5f55 \u9700\u8981\u62f7\u8d1d\u7684\u6587\u4ef6\u6216\u76ee\u5f55\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#5","title":"5.\u76ee\u5f55\u6302\u8f7d","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5728\u521b\u5efa\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u5c06\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\u4e0e\u5bb9\u5668\u5185\u7684\u76ee\u5f55\u8fdb\u884c\u6620\u5c04\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u5bbf\u4e3b\u673a\u67d0\u4e2a\u76ee\u5f55\u7684\u6587\u4ef6\u4ece\u800c\u53bb\u5f71\u54cd\u5bb9\u5668\u3002 \u521b\u5efa\u5bb9\u5668\u6dfb\u52a0-v\u53c2\u6570\u540e\u8fb9\u4e3a\u5bbf\u4e3b\u673a\u76ee\u5f55:\u5bb9\u5668\u76ee\u5f55\uff0c\u4f8b\u5982:</p> <pre><code>docker run -di -v /usr/local/myhtml:/usr/local/myhtml --name=mycentos3 centos:7\n</code></pre> <p>\u5982\u679c\u4f60\u5171\u4eab\u7684\u662f\u591a\u7ea7\u7684\u76ee\u5f55\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u6743\u9650\u4e0d\u8db3\u7684\u63d0\u793a\u3002 \u8fd9\u662f\u56e0\u4e3aCentOS7\u4e2d\u7684\u5b89\u5168\u6a21\u5757selinux\u628a\u6743\u9650\u7981\u6389\u4e86\uff0c\u6211\u4eec\u9700\u8981\u6dfb\u52a0\u53c2\u6570--privileged=true \u6765\u89e3\u51b3\u6302\u8f7d\u7684\u76ee\u5f55\u6ca1\u6709\u6743\u9650\u7684\u95ee\u9898</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#6json","title":"6.\u67e5\u770b\u4e00\u4e2ajson\u4fe1\u606f","text":"<pre><code>docker inspect \u5bb9\u5668\u540d\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#ip","title":"\u8fc7\u6ee4\uff08\u67e5\u770bIP\uff09","text":"<pre><code>docker inspect --format='{{.NetworkSettings.IPAddress}}' \u5bb9\u5668\u540d\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#7mysql","title":"7.mysql\u90e8\u7f72","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_17","title":"\u62c9\u53d6\u955c\u50cf","text":"<pre><code>docker pull centos/mysql-57-centos7\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_18","title":"\u521b\u5efa\u5bb9\u5668","text":"<pre><code>docker run -di --name=tensquare_mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 j\n</code></pre> <p>-p:\u7aef\u53e3\u6620\u5c04   \u5bbf\u4e3b\u673a\u6620\u5c04\u7aef\u53e3:\u5bb9\u5668\u8fd0\u884c\u7aef\u53e3</p> <p>-e:\u4ee3\u8868\u6dfb\u52a0\u73af\u5883\u53d8\u91cf MYSQL_ROOT_PASSWORD \u662froot\u7528\u6237\u7684\u767b\u5f55\u5bc6\u7801</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#mysql","title":"\u8fdb\u5165mysql\u5bb9\u5668","text":"<pre><code>docker exec -it tensquare_mysql /bin/bash\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#mysql_1","title":"\u767b\u5f55mysql","text":"<pre><code>mysql -u root -p\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#8tomcat","title":"8.tomcat\u90e8\u7f72","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_19","title":"\u62c9\u53d6\u955c\u50cf","text":"<pre><code>docker pull tomcat:7-jre7\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_20","title":"\u521b\u5efa\u5bb9\u5668","text":"<pre><code>docker run -di --name=mytomcat -p 9000:8080 -v /usr/local/webapps:/usr/local/tomcat/webapps tomcat:7-jre7\n</code></pre> <p>-p:\u7aef\u53e3\u6620\u5c04   \u5bbf\u4e3b\u673a\u6620\u5c04\u7aef\u53e3:\u5bb9\u5668\u8fd0\u884c\u7aef\u53e3</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#9nginx","title":"9.Nginx\u90e8\u7f72","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_21","title":"\u62c9\u53d6\u955c\u50cf","text":"<pre><code>docker pull nginx\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_22","title":"\u521b\u5efa\u5bb9\u5668","text":"<pre><code>docker run -di --name=mynginx -p 80:80 nginx\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#10redis","title":"10.Redis\u90e8\u7f72","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_23","title":"\u62c9\u53d6\u955c\u50cf","text":"<pre><code>docker pull redis\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_24","title":"\u521b\u5efa\u5bb9\u5668","text":"<pre><code>docker run -di --name=myredis -p 6379:6379 redis\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#11","title":"11.\u5907\u4efd\u548c\u8fc1\u79fb","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_25","title":"\u5bb9\u5668\u4fdd\u5b58\u4e3a\u955c\u50cf","text":"<pre><code>docker commit mynginx mynginx_img\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_26","title":"\u955c\u50cf\u5907\u4efd","text":"<p>\u5c06\u955c\u50cf\u4fdd\u5b58\u4e3atar\u6587\u4ef6</p> <pre><code>docker save -o mynginx.tar mynginx_img\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_27","title":"\u955c\u50cf\u6062\u590d\u548c\u8fc1\u79fb","text":"<p>\u5148\u5220\u9664mynginx_img\u955c\u50cf\uff0c\u7136\u540e\u6267\u884c\u547d\u4ee4\u6062\u590d</p> <pre><code>docker load -i mynginx.tar\n</code></pre> <p>-i:\u8f93\u5165\u7684\u6587\u4ef6</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#12dockerfile","title":"12.Dockerfile","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_28","title":"\u4ecb\u7ecd","text":"<p>Dockerfile\u662f\u7531\u4e00\u7cfb\u5217\u547d\u4ee4\u548c\u53c2\u6570\u6784\u6210\u7684\u811a\u672c\uff0c\u8fd9\u4e9b\u547d\u4ee4\u5e94\u7528\u4e8e\u57fa\u7840\u955c\u50cf\u5e76\u6700\u7ec8\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u955c\u50cf\u3002 1\u3001\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458:\u53ef\u4ee5\u4e3a\u5f00\u53d1\u56e2\u961f\u63d0\u4f9b\u4e00\u4e2a\u5b8c\u5168\u4e00\u81f4\u7684\u5f00\u53d1\u73af\u5883; 2\u3001\u5bf9\u4e8e\u6d4b\u8bd5\u4eba\u5458:\u53ef\u4ee5\u76f4\u63a5\u62ff\u5f00\u53d1\u65f6\u6240\u6784\u5efa\u7684\u955c\u50cf\u6216\u8005\u901a\u8fc7Dockerfile\u6587\u4ef6\u6784\u5efa\u4e00\u4e2a\u65b0\u7684\u955c\u50cf\u5f00\u59cb\u5de5\u4f5c\u4e86; 3\u3001\u5bf9\u4e8e\u8fd0\u7ef4\u4eba\u5458:\u5728\u90e8\u7f72\u65f6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5e94\u7528\u7684\u65e0\u7f1d\u79fb\u690d\u3002</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#dockerfile","title":"dockerfile \u7684\u547d\u4ee4\u6458\u8981","text":"<ul> <li> <p>FROM- \u955c\u50cf\u4ece\u90a3\u91cc\u6765</p> </li> <li> <p>MAINTAINER- \u955c\u50cf\u7ef4\u62a4\u8005\u4fe1\u606f</p> </li> <li> <p>RUN- \u6784\u5efa\u955c\u50cf\u6267\u884c\u7684\u547d\u4ee4\uff0c\u6bcf\u4e00\u6b21RUN\u90fd\u4f1a\u6784\u5efa\u4e00\u5c42</p> </li> <li> <p>CMD- \u5bb9\u5668\u542f\u52a8\u7684\u547d\u4ee4\uff0c\u5982\u679c\u6709\u591a\u4e2a\u5219\u4ee5\u6700\u540e\u4e00\u4e2a\u4e3a\u51c6\uff0c\u4e5f\u53ef\u4ee5\u4e3aENTRYPOINT\u63d0\u4f9b\u53c2\u6570</p> </li> <li> <p>VOLUME- \u5b9a\u4e49\u6570\u636e\u5377\uff0c\u5982\u679c\u6ca1\u6709\u5b9a\u4e49\u5219\u4f7f\u7528\u9ed8\u8ba4</p> </li> <li> <p>USER- \u6307\u5b9a\u540e\u7eed\u6267\u884c\u7684\u7528\u6237\u7ec4\u548c\u7528\u6237</p> </li> <li> <p>WORKDIR- \u5207\u6362\u5f53\u524d\u6267\u884c\u7684\u5de5\u4f5c\u76ee\u5f55</p> </li> <li> <p>HEALTHCHECH- \u5065\u5eb7\u68c0\u6d4b\u6307\u4ee4</p> </li> <li> <p>ARG- \u53d8\u91cf\u5c5e\u6027\u503c\uff0c\u4f46\u4e0d\u5728\u5bb9\u5668\u5185\u90e8\u8d77\u4f5c\u7528</p> </li> <li> <p>EXPOSE- \u66b4\u9732\u7aef\u53e3</p> </li> <li> <p>ENV- \u73af\u5883\u53d8\u91cf\u5c5e\u6027\u503c\uff0c\u5bb9\u5668\u5185\u90e8\u4e5f\u4f1a\u8d77\u4f5c\u7528</p> </li> <li> <p>ADD- \u6dfb\u52a0\u6587\u4ef6\uff0c\u5982\u679c\u662f\u538b\u7f29\u6587\u4ef6\u4e5f\u89e3\u538b</p> </li> <li> <p>COPY- \u6dfb\u52a0\u6587\u4ef6\uff0c\u4ee5\u590d\u5236\u7684\u5f62\u5f0f</p> </li> <li> <p>ENTRYPOINT- \u5bb9\u5668\u8fdb\u5165\u65f6\u6267\u884c\u7684\u547d\u4ee4</p> </li> </ul>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#13dockerfilejdk18","title":"13.\u4f7f\u7528dockerfile\u521b\u5efa\u4e00\u4e2ajdk1.8\u955c\u50cf","text":"<pre><code>mkdir -p /usr/local/dockerjdk8\ncd /usr/local/dockerjdk8/\nvi Dockerfile\n</code></pre> <pre><code>FROM centos:7\nMAINTAINER liyedong \nWORKDIR /usr\nRUN mkdir /usr/local/java\nADD jdk8xxxxx.tar.gz /usr/local/java/\n\nENV JAVA_HOME /usr/local/java/jdk1.8.0_171\nENV JRE_HOME $JAVA_HOME/jre\nENV CLASSPATH $JAVA_HOME/bin/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH\nENV PATH $JAVA_HOME/bin:$PATH\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_29","title":"\u6784\u5efa","text":"<pre><code>docker build -t 'jdk1.8' .\n</code></pre> <p>\u6ce8\u610f\uff1a. \u4ee3\u8868\u5728\u5f53\u524d\u76ee\u5f55</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#14docker","title":"14.Docker\u79c1\u6709\u4ed3\u5e93","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_30","title":"\u4ed3\u5e93\u642d\u5efa\u548c\u914d\u7f6e","text":"<p>\u62c9\u53bb\u79c1\u6709\u4ed3\u5e93\u955c\u50cf</p> <pre><code>docker pull registry\n</code></pre> <p>\u542f\u52a8\u79c1\u6709\u4ed3\u5e93\u5bb9\u5668</p> <pre><code>docker run -di --name=registry -p 5000:5000 registry\n</code></pre> <p>\u6253\u5f00\u6d4f\u89c8\u5668\u8f93\u5165\u5730\u5740</p> <pre><code>http://ip:5000/v2/_catalog\n</code></pre> <p>\u770b\u5230{\"repositories\":[]}\u8868\u793a\u79c1\u6709\u4ed3\u5e93\u642d\u5efa\u6210\u529f\u5e76\u4e14\u5185\u5bb9\u4e3a\u7a7a</p> <p>\u4fee\u6539daemon.json</p> <pre><code>vi /etc/docker/daemon.json\n</code></pre> <p>\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff0c\u4fdd\u5b58\u9000\u51fa(\u8ba9docker\u4fe1\u4efb\u79c1\u6709\u4ed3\u5e93\u5730\u5740)</p> <pre><code>{\"insecure-registries\":[\"ip:5000\"]}\n</code></pre> <p>\u91cd\u542fdocker</p> <pre><code>systemctl restart docker\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_31","title":"\u5c06\u955c\u50cf\u4e0a\u4f20\u81f3\u79c1\u6709\u4ed3\u5e93","text":"<p>\u6807\u8bb0\u955c\u50cf\u4e3a\u79c1\u6709\u4ed3\u5e93\u7684\u955c\u50cf</p> <pre><code>docker tag jdk1.8 ip:5000/jdk1.8\n</code></pre> <p>\u4e0a\u4f20\u6807\u8bb0\u7684\u955c\u50cf</p> <pre><code>docker push ip:5000/jdk1.8\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#15","title":"15.\u4e0b\u8f7d\u79c1\u6709\u4ed3\u5e93\u955c\u50cf","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#docker","title":"\u4fe1\u4efb\u5bf9\u5e94\u7684docker\u5730\u5740","text":"<p>\u4fee\u6539daemon.json</p> <pre><code>vi /etc/docker/daemon.json\n</code></pre> <p>\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff0c\u4fdd\u5b58\u9000\u51fa(\u8ba9docker\u4fe1\u4efb\u79c1\u6709\u4ed3\u5e93\u5730\u5740)</p> <pre><code>{\"insecure-registries\":[\"ip:5000\"]}\n</code></pre> <p>\u91cd\u542fdocker</p> <pre><code>systemctl restart docker\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_32","title":"\u67e5\u770b\u955c\u50cf\u4ed3\u5e93","text":"<pre><code>http://ip:5000/v2/_catalog\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_33","title":"\u4e0b\u62c9\u955c\u50cf","text":"<pre><code>docker pull ip:5000/jdk1.8\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#16-web","title":"16.\u8fd0\u884c\u4e00\u4e2a web \u5e94\u7528","text":"<p>\u524d\u9762\u6211\u4eec\u8fd0\u884c\u7684\u5bb9\u5668\u5e76\u6ca1\u6709\u4e00\u4e9b\u4ec0\u4e48\u7279\u522b\u7684\u7528\u5904\u3002</p> <p>\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u5c1d\u8bd5\u4f7f\u7528 docker \u6784\u5efa\u4e00\u4e2a web \u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u6211\u4eec\u5c06\u5728docker\u5bb9\u5668\u4e2d\u8fd0\u884c\u4e00\u4e2a Python Flask \u5e94\u7528\u6765\u8fd0\u884c\u4e00\u4e2aweb\u5e94\u7528\u3002</p> <pre><code>runoob@runoob:~# docker pull training/webapp  # \u8f7d\u5165\u955c\u50cf\nrunoob@runoob:~# docker run -d -P training/webapp python app.py\n</code></pre> <p>\u53c2\u6570\u8bf4\u660e:</p> <ul> <li>-d:\u8ba9\u5bb9\u5668\u5728\u540e\u53f0\u8fd0\u884c\u3002</li> <li>-P:\u5c06\u5bb9\u5668\u5185\u90e8\u4f7f\u7528\u7684\u7f51\u7edc\u7aef\u53e3\u968f\u673a\u6620\u5c04\u5230\u6211\u4eec\u4f7f\u7528\u7684\u4e3b\u673a\u4e0a\u3002</li> </ul>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#17docker-run-docker-exec","title":"17.docker run \u548c docker exec \u7684\u5dee\u5f02","text":"<p>docker run \uff1a\u6839\u636e\u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u5e76\u8fd0\u884c\u4e00\u4e2a\u547d\u4ee4\uff0c\u64cd\u4f5c\u7684\u5bf9\u8c61\u662f \u955c\u50cf\uff1b</p> <p>docker exec \uff1a\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4\uff0c\u64cd\u4f5c\u7684\u5bf9\u8c61\u662f \u5bb9\u5668\u3002</p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#docker-run","title":"docker run \u547d\u4ee4","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_34","title":"\u8bed\u6cd5","text":"<pre><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]\n</code></pre> <p>OPTIONS\u8bf4\u660e\uff1a</p> <ul> <li>-a stdin: \u6307\u5b9a\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u5185\u5bb9\u7c7b\u578b\uff0c\u53ef\u9009 STDIN/STDOUT/STDERR \u4e09\u9879\uff1b</li> <li>-d: \u540e\u53f0\u8fd0\u884c\u5bb9\u5668\uff0c\u5e76\u8fd4\u56de\u5bb9\u5668ID\uff1b</li> <li>-i: \u4ee5\u4ea4\u4e92\u6a21\u5f0f\u8fd0\u884c\u5bb9\u5668\uff0c\u901a\u5e38\u4e0e -t \u540c\u65f6\u4f7f\u7528\uff1b</li> <li>-P: \u968f\u673a\u7aef\u53e3\u6620\u5c04\uff0c\u5bb9\u5668\u5185\u90e8\u7aef\u53e3\u968f\u673a\u6620\u5c04\u5230\u4e3b\u673a\u7684\u9ad8\u7aef\u53e3</li> <li>-p: \u6307\u5b9a\u7aef\u53e3\u6620\u5c04\uff0c\u683c\u5f0f\u4e3a\uff1a\u4e3b\u673a(\u5bbf\u4e3b)\u7aef\u53e3:\u5bb9\u5668\u7aef\u53e3</li> <li>-t: \u4e3a\u5bb9\u5668\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u4f2a\u8f93\u5165\u7ec8\u7aef\uff0c\u901a\u5e38\u4e0e -i \u540c\u65f6\u4f7f\u7528\uff1b</li> <li>--name=\"nginx-lb\": \u4e3a\u5bb9\u5668\u6307\u5b9a\u4e00\u4e2a\u540d\u79f0\uff1b</li> <li>--dns 8.8.8.8: \u6307\u5b9a\u5bb9\u5668\u4f7f\u7528\u7684DNS\u670d\u52a1\u5668\uff0c\u9ed8\u8ba4\u548c\u5bbf\u4e3b\u4e00\u81f4\uff1b</li> <li>--dns-search example.com: \u6307\u5b9a\u5bb9\u5668DNS\u641c\u7d22\u57df\u540d\uff0c\u9ed8\u8ba4\u548c\u5bbf\u4e3b\u4e00\u81f4\uff1b</li> <li>-h \"mars\": \u6307\u5b9a\u5bb9\u5668\u7684hostname\uff1b</li> <li>-e username=\"ritchie\": \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff1b</li> <li>--env-file=[]: \u4ece\u6307\u5b9a\u6587\u4ef6\u8bfb\u5165\u73af\u5883\u53d8\u91cf\uff1b</li> <li>--cpuset=\"0-2\" or --cpuset=\"0,1,2\": \u7ed1\u5b9a\u5bb9\u5668\u5230\u6307\u5b9aCPU\u8fd0\u884c\uff1b</li> <li>-m :\u8bbe\u7f6e\u5bb9\u5668\u4f7f\u7528\u5185\u5b58\u6700\u5927\u503c\uff1b</li> <li>--net=\"bridge\": \u6307\u5b9a\u5bb9\u5668\u7684\u7f51\u7edc\u8fde\u63a5\u7c7b\u578b\uff0c\u652f\u6301 bridge/host/none/container: \u56db\u79cd\u7c7b\u578b\uff1b <li>--link=[]: \u6dfb\u52a0\u94fe\u63a5\u5230\u53e6\u4e00\u4e2a\u5bb9\u5668\uff1b</li> <li>--expose=[]: \u5f00\u653e\u4e00\u4e2a\u7aef\u53e3\u6216\u4e00\u7ec4\u7aef\u53e3\uff1b</li> <li>--volume , -v: \u7ed1\u5b9a\u4e00\u4e2a\u5377</li>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_35","title":"\u5b9e\u4f8b","text":"<p>\u4f7f\u7528docker\u955c\u50cf nginx:latest \u4ee5\u540e\u53f0\u6a21\u5f0f\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u5e76\u5c06\u5bb9\u5668\u547d\u540d\u4e3amy-nginx\u3002</p> <pre><code>docker run --name my-nginx -p 8081:80 -d nginx:latest\n</code></pre> <p></p> <p>\u6d4f\u89c8\u5668\u8bbf\u95ee http://\u4e3b\u673aIP:8081\uff0c\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u4f7f\u7528\u955c\u50cf nginx:latest \u4ee5\u540e\u53f0\u6a21\u5f0f\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u5e76\u5c06\u5bb9\u5668\u768480\u7aef\u53e3\u6620\u5c04\u5230\u4e3b\u673a\u968f\u673a\u7aef\u53e3\uff1a</p> <pre><code>docker run -P -d nginx:latest\n</code></pre> <p>\u4f7f\u7528\u955c\u50cf nginx:latest \u4ee5\u540e\u53f0\u6a21\u5f0f\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u5c06\u4e3b\u673a\u7684 80 \u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684 80 \u7aef\u53e3\uff0c\u4e3b\u673a\u7684\u76ee\u5f55 /data \u6620\u5c04\u5230\u5bb9\u5668\u7684 /data\uff1a</p> <pre><code>docker run -p 80:80 -v /data:/data -d nginx:latest\n</code></pre> <p>\u4f7f\u7528\u955c\u50cf nginx:latest \u4ee5\u4ea4\u4e92\u6a21\u5f0f\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u5728\u5bb9\u5668\u5185\u6267\u884c/bin/bash\u547d\u4ee4\uff1a</p> <pre><code>docker run -it nginx:latest /bin/bash\n</code></pre> <p></p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#docker-exec","title":"docker exec \u547d\u4ee4","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#_36","title":"\u8bed\u6cd5","text":"<pre><code>docker exec [OPTIONS] CONTAINER COMMAND [ARG...]\n</code></pre> <p>OPTIONS\u8bf4\u660e\uff1a</p> <ul> <li>-d : \u5206\u79bb\u6a21\u5f0f: \u5728\u540e\u53f0\u8fd0\u884c</li> <li>-i : \u5373\u4f7f\u6ca1\u6709\u9644\u52a0\u4e5f\u4fdd\u6301STDIN \u6253\u5f00</li> <li>-t : \u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef</li> </ul> <p>\u5728\u5bb9\u5668\u540d\u79f0 my-nginx \u4e2d\u5f00\u542f\u4e00\u4e2a\u4ea4\u4e92\u6a21\u5f0f\u7684\u7ec8\u7aef\uff1a</p> <pre><code>docker exec -it my-nginx /bin/bash\n</code></pre> <p></p> <p>\u6216\u8005\u4f7f\u7528\u5bb9\u5668ID 721eb23901ce \u5f00\u542f\u4e00\u4e2a\u4ea4\u4e92\u6a21\u5f0f\u7684\u7ec8\u7aef\uff1a</p> <pre><code>docker exec -it 721eb23901ce /bin/bash\n</code></pre> <p></p>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#18","title":"18.\u81ea\u5b9a\u4e49\u955c\u50cf","text":"<pre><code>\u5f53\u4f7f\u7528 Docker \u6784\u5efa\u4e00\u4e2a\u5305\u542b CentOS\u3001JDK 1.8\u3001MySQL 5.7\u3001Redis \u548c Nginx \u7684\u5bb9\u5668\u65f6\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\uff1a\n\n1. \u5728 Docker \u4e3b\u673a\u4e0a\u5b89\u88c5 Docker\u3002\n2. \u521b\u5efa\u4e00\u4e2a Dockerfile\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a\n# \u4f7f\u7528\u5b98\u65b9\u7684 CentOS \u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\nFROM centos:centos7\n\n# \u5b89\u88c5 JDK 1.8\nRUN yum install -y java-1.8.0-openjdk-devel\n\n# \u5b89\u88c5 MySQL 5.7\nRUN yum install -y https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm\nRUN yum install -y mysql-community-server\n\n# \u5b89\u88c5 Redis\nRUN yum install -y epel-release\nRUN yum install -y redis\n\n# \u5b89\u88c5 Nginx\nRUN yum install -y nginx\n\n# \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\nENV JAVA_HOME /usr/lib/jvm/java-1.8.0-openjdk\nENV PATH $PATH:$JAVA_HOME/bin\n\n# \u66b4\u9732\u7aef\u53e3\nEXPOSE 80 3306 6379\n\n# \u542f\u52a8\u670d\u52a1\nCMD service mysqld start &amp;&amp; service redis start &amp;&amp; nginx -g \"daemon off;\"\n```\n\n3. \u5728 Dockerfile \u6240\u5728\u7684\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u6784\u5efa\u955c\u50cf\uff1a\n\n```bash\ndocker build -t myimage .\n```\n\n4. \u6784\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668\uff1a\n\n```bash\ndocker run -d -p 80:80 -p 3306:3306 -p 6379:6379 myimage\n```\n\n\u8fd9\u5c06\u521b\u5efa\u4e00\u4e2a\u540e\u53f0\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u5c06\u4e3b\u673a\u7684 80 \u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684 80 \u7aef\u53e3\uff0c3306 \u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684 3306 \u7aef\u53e3\uff0c6379 \u7aef\u53e3\u6620\u5c04\u5230\u5bb9\u5668\u7684 6379 \u7aef\u53e3\u3002\n\n\u5173\u4e8e Docker \u7684\u66f4\u591a\u4fe1\u606f\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u4ee5\u4e0b\u94fe\u63a5\uff1a\n- Docker \u5b98\u65b9\u6587\u6863\uff1ahttps://docs.docker.com/\n- Docker \u6559\u7a0b\uff1ahttps://www.runoob.com/docker/docker-tutorial.html\n\n\u8bf7\u6ce8\u610f\uff0c\u4ee5\u4e0a\u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\uff0c\u5177\u4f53\u914d\u7f6e\u53d6\u51b3\u4e8e\u4f60\u7684\u9700\u6c42\u548c\u73af\u5883\u3002\n</code></pre> <pre><code>docker build -t myspringboot .\ndocker run -d -p 80:80 -p 3306:3306 -p 6379:6379 myimage\n</code></pre>"},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#19","title":"19.\u5171\u4eab\u955c\u50cf","text":""},{"location":"docker/docker%E7%AC%94%E8%AE%B0/#docker_1","title":"\u5982\u4f55\u628aDocker\u955c\u50cf\u62f7\u7ed9\u522b\u4eba","text":"<p>\u6bd4\u5982\u672c\u5730\u6709\u4e2a\u540d\u4e3alyhero11/springbootapp2\u7684\u955c\u50cf\uff0c\u64cd\u4f5c\u5982\u4e0b\u3002 docker save\u5bfc\u51fa\u955c\u50cf:</p> <pre><code>docker save -o D:\\docker-images\\springbootapp2-latest.tar lyhero11/springbootapp2\n</code></pre> <p>\u5728D:\\docker-images\\\u8def\u5f84\u4e0b\u4f1a\u751f\u6210\u4e00\u4e2atar\u5305springbootapp2-latest.tar\uff0c\u8fd9\u4e2a\u5c31\u662f\u955c\u50cf\uff0c\u53ef\u4ee5U\u76d8\u62f7\u7ed9\u522b\u4eba\u7535\u8111\u4e0a\u53bb\u3002 \u7136\u540edocker load\u8fd9\u4e2a\u955c\u50cf\uff1a</p> <pre><code>docker load -i D:\\docker-images\\springbootapp2-latest.tar\n</code></pre> <p>\u6ce8\u610f\uff1a \u4e0a\u9762\u7684-o, -i\u5206\u522b\u4ee3\u8868--output\u548c--input\uff0csave\u955c\u50cf\u7684\u65f6\u5019\u4e0d\u52a0-o\u9009\u9879\u4f1a\u5bfc\u81f4load\u7684\u65f6\u5019\u62a5\u9519\uff1a<code>Error processing tar file(exit status 1): archive/tar: invalid tar header</code>\u3002\u800c\u4e14save\u51fa\u6765\u7684\u955c\u50cf\u5927\u5c0f\u4e5f\u4e0d\u5bf9\uff0c\u7b14\u8005\u8fd9\u4e2a\u955c\u50cf\u6b63\u5e38\u662f105M\uff0c\u8fd9\u6837save\u51fa\u6765\u7684\u955c\u50cf\u662f200\u591aM.</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/","title":"MySQL8","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_1","title":"\u6570\u636e\u7c7b\u578b","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#1","title":"1.\u6570\u503c\u7c7b\u578b","text":"\u7c7b\u578b \u5927\u5c0f \u6709\u7b26\u53f7(SIGNED)\u8303\u56f4 \u65e0\u7b26\u53f7(UNSIGNED)\u8303\u56f4 \u63cf\u8ff0 TINYINT 1  byte (-128\uff0c127) (0\uff0c255) \u5c0f\u6574\u6570\u503c SMALLINT 2  bytes (-32768\uff0c32767) (0\uff0c65535) \u5927\u6574\u6570\u503c MEDIUMINT 3  bytes (-8388608\uff0c8388607) (0\uff0c16777215) \u5927\u6574\u6570\u503c INT\u6216INTEGER 4  bytes (-2147483648\uff0c2147483647) (0\uff0c4294967295) \u5927\u6574\u6570\u503c BIGINT 8  bytes (-2<sup>63\uff0c2</sup>63-1) (0\uff0c2^64-1) \u6781\u5927\u6574\u6570\u503c FLOAT 4  bytes (-3.402823466 E+38\uff0c3.402823466351  E+38) 0 \u548c (1.175494351  E-38\uff0c3.402823466 E+38) \u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\u503c DOUBLE 8  bytes (-1.7976931348623157 E+308\uff0c1.7976931348623157 E+308) 0 \u548c  (2.2250738585072014 E-308\uff0c1.7976931348623157 E+308) \u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\u503c DECIMAL \u4f9d\u8d56\u4e8eM(\u7cbe\u5ea6)\u548cD(\u6807\u5ea6)\u7684\u503c \u4f9d\u8d56\u4e8eM(\u7cbe\u5ea6)\u548cD(\u6807\u5ea6)\u7684\u503c \u5c0f\u6570\u503c(\u7cbe\u786e\u5b9a\u70b9\u6570)"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#2","title":"2.\u5b57\u7b26\u4e32\u7c7b\u578b","text":"\u7c7b\u578b \u5927\u5c0f \u63cf\u8ff0 CHAR 0-255 bytes \u5b9a\u957f\u5b57\u7b26\u4e32 VARCHAR 0-65535 bytes \u53d8\u957f\u5b57\u7b26\u4e32 TINYBLOB 0-255 bytes \u4e0d\u8d85\u8fc7255\u4e2a\u5b57\u7b26\u7684\u4e8c\u8fdb\u5236\u6570\u636e TINYTEXT 0-255 bytes \u77ed\u6587\u672c\u5b57\u7b26\u4e32 BLOB 0-65 535 bytes \u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u957f\u6587\u672c\u6570\u636e TEXT 0-65 535 bytes \u957f\u6587\u672c\u6570\u636e MEDIUMBLOB 0-16 777 215 bytes \u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u4e2d\u7b49\u957f\u5ea6\u6587\u672c\u6570\u636e MEDIUMTEXT 0-16 777 215 bytes \u4e2d\u7b49\u957f\u5ea6\u6587\u672c\u6570\u636e LONGBLOB 0-4 294 967 295 bytes \u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u6781\u5927\u6587\u672c\u6570\u636e LONGTEXT 0-4 294 967 295 bytes \u6781\u5927\u6587\u672c\u6570\u636e"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#3","title":"3.\u65f6\u95f4\u7c7b\u578b","text":"\u7c7b\u578b \u5927\u5c0f \u8303\u56f4 \u683c\u5f0f \u63cf\u8ff0 DATE 3 1000-01-01 \u81f3  9999-12-31 YYYY-MM-DD \u65e5\u671f\u503c TIME 3 -838:59:59 \u81f3  838:59:59 HH:MM:SS \u65f6\u95f4\u503c\u6216\u6301\u7eed\u65f6\u95f4 YEAR 1 1901 \u81f3 2155 YYYY \u5e74\u4efd\u503c DATETIME 8 1000-01-01 00:00:00 \u81f3 9999-12-31 23:59:59 YYYY-MM-DD HH:MM:SS \u6df7\u5408\u65e5\u671f\u548c\u65f6\u95f4\u503c TIMESTAMP 4 1970-01-01 00:00:01 \u81f3 2038-01-19 03:14:07 YYYY-MM-DD HH:MM:SS \u6df7\u5408\u65e5\u671f\u548c\u65f6\u95f4\u503c\uff0c\u65f6\u95f4\u6233"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#sql","title":"SQL\u5206\u7c7b","text":"\u5206 \u7c7b \u5168\u79f0 \u8bf4\u660e DDL Data Definition Language \u6570\u636e\u5b9a\u4e49\u8bed\u8a00\uff0c\u7528\u6765\u5b9a\u4e49\u6570\u636e\u5e93\u5bf9\u8c61(\u6570\u636e\u5e93\uff0c\u8868\uff0c \u5b57\u6bb5) DML Data Manipulation Language \u6570\u636e\u64cd\u4f5c\u8bed\u8a00\uff0c\u7528\u6765\u5bf9\u6570\u636e\u5e93\u8868\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u589e\u5220\u6539 DQL Data Query Language \u6570\u636e\u67e5\u8be2\u8bed\u8a00\uff0c\u7528\u6765\u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u8868\u7684\u8bb0\u5f55 DCL Data Control Language \u6570\u636e\u63a7\u5236\u8bed\u8a00\uff0c\u7528\u6765\u521b\u5efa\u6570\u636e\u5e93\u7528\u6237\u3001\u63a7\u5236\u6570\u636e\u5e93\u7684 \u8bbf\u95ee\u6743\u9650"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#1ddl","title":"1.DDL","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_2","title":"\u6570\u636e\u5e93\u64cd\u4f5c","text":"<p>1). \u67e5\u8be2\u6240\u6709\u6570\u636e\u5e93</p> <pre><code> show databases ;  \n</code></pre> <p>2). \u67e5\u8be2\u5f53\u524d\u6570\u636e\u5e93</p> <pre><code>select database() ;\n</code></pre> <p>3). \u521b\u5efa\u6570\u636e\u5e93</p> <pre><code>create database [ if not exists ] \u6570\u636e\u5e93\u540d [ default charset \u5b57\u7b26\u96c6 ] [ collate \u6392\u5e8f\u89c4\u5219 ] ;\n</code></pre> <p>4). \u6848\u4f8b\uff1a A. \u521b\u5efa\u4e00\u4e2aitcast\u6570\u636e\u5e93, \u4f7f\u7528\u6570\u636e\u5e93\u9ed8\u8ba4\u7684\u5b57\u7b26\u96c6\u3002</p> <pre><code>create database itcast;\n</code></pre> <p>\u5728\u540c\u4e00\u4e2a\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e2d\uff0c\u4e0d\u80fd\u521b\u5efa\u4e24\u4e2a\u540d\u79f0\u76f8\u540c\u7684\u6570\u636e\u5e93\uff0c\u5426\u5219\u5c06\u4f1a\u62a5\u9519\u3002 \u53ef\u4ee5\u901a\u8fc7if not exists \u53c2\u6570\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6570\u636e\u5e93\u4e0d\u5b58\u5728, \u5219\u521b\u5efa\u8be5\u6570\u636e\u5e93\uff0c\u5982\u679c\u5b58\u5728\uff0c\u5219\u4e0d \u521b\u5efa\u3002</p> <pre><code> create database if not extists itcast;\n</code></pre> <p>B. \u521b\u5efa\u4e00\u4e2aitheima\u6570\u636e\u5e93\uff0c\u5e76\u4e14\u6307\u5b9a\u5b57\u7b26\u96c6</p> <pre><code>create database itheima default charset utf8mb4;\n</code></pre> <p>4). \u5220\u9664\u6570\u636e\u5e93 \u5982\u679c\u5220\u9664\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6570\u636e\u5e93\uff0c\u5c06\u4f1a\u62a5\u9519\u3002\u6b64\u65f6\uff0c\u53ef\u4ee5\u52a0\u4e0a\u53c2\u6570  if exists \uff0c\u5982\u679c\u6570\u636e\u5e93\u5b58\u5728\uff0c\u518d\u6267\u884c\u5220\u9664\uff0c\u5426\u5219\u4e0d\u6267\u884c\u5220\u9664\u3002</p> <pre><code>drop database [ if exists ] \u6570\u636e\u5e93\u540d ;\n</code></pre> <p>5). \u5207\u6362\u6570\u636e\u5e93</p> <pre><code>use \u6570\u636e\u5e93\u540d ;\n</code></pre> <p>\u6211\u4eec\u8981\u64cd\u4f5c\u67d0\u4e00\u4e2a\u6570\u636e\u5e93\u4e0b\u7684\u8868\u65f6\uff0c\u5c31\u9700\u8981\u901a\u8fc7\u8be5\u6307\u4ee4\uff0c\u5207\u6362\u5230\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u4e0b\uff0c\u5426\u5219\u662f\u4e0d\u80fd\u64cd\u4f5c\u7684\u3002 \u6bd4\u5982\uff0c\u5207\u6362\u5230itcast\u6570\u636e\uff0c\u6267\u884c\u5982\u4e0bSQL\uff1a</p> <pre><code>use itcast;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_3","title":"\u6570\u636e\u8868\u64cd\u4f5c","text":"<p>1). \u67e5\u8be2\u5f53\u524d\u6570\u636e\u5e93\u6240\u6709\u8868</p> <pre><code>show tables;\n</code></pre> <p>\u6bd4\u5982,\u6211\u4eec\u53ef\u4ee5\u5207\u6362\u5230sys\u8fd9\u4e2a\u7cfb\u7edf\u6570\u636e\u5e93,\u5e76\u67e5\u770b\u7cfb\u7edf\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868\u7ed3\u6784\u3002  </p> <pre><code>use sys;\nshow tables;\n</code></pre> <p>2). \u67e5\u770b\u6307\u5b9a\u8868\u7ed3\u6784  </p> <pre><code>desc \u8868\u540d ;\n</code></pre> <p>3). \u67e5\u8be2\u6307\u5b9a\u8868\u7684\u5efa\u8868\u8bed\u53e5</p> <pre><code> show create table \u8868\u540d \n</code></pre> <p>\u901a\u8fc7\u8fd9\u6761\u6307\u4ee4\uff0c\u4e3b\u8981\u662f\u7528\u6765\u67e5\u770b\u5efa\u8868\u8bed\u53e5\u7684\uff0c\u800c\u6709\u90e8\u5206\u53c2\u6570\u6211\u4eec\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\uff0c\u5e76\u672a\u6307\u5b9a\u4e5f\u4f1a\u67e5\u8be2 \u5230\uff0c\u56e0\u4e3a\u8fd9\u90e8\u5206\u662f\u6570\u636e\u5e93\u7684\u9ed8\u8ba4\u503c\uff0c\u5982\uff1a\u5b58\u50a8\u5f15\u64ce\u3001\u5b57\u7b26\u96c6\u7b49\u3002 4). \u521b\u5efa\u8868\u7ed3\u6784</p> <pre><code>CREATE TABLE  \u8868\u540d(\n \u5b57\u6bb51  \u5b57\u6bb51\u7c7b\u578b [ COMMENT  \u5b57\u6bb51\u6ce8\u91ca ],\n \u5b57\u6bb52  \u5b57\u6bb52\u7c7b\u578b [COMMENT  \u5b57\u6bb52\u6ce8\u91ca ],\n \u5b57\u6bb53  \u5b57\u6bb53\u7c7b\u578b [COMMENT  \u5b57\u6bb53\u6ce8\u91ca ],\n......\n \u5b57\u6bb5n  \u5b57\u6bb5n\u7c7b\u578b [COMMENT  \u5b57\u6bb5n\u6ce8\u91ca ]\n) [ COMMENT  \u8868\u6ce8\u91ca ] ;\n</code></pre> <p>\u6ce8\u610f: [...] \u5185\u4e3a\u53ef\u9009\u53c2\u6570\uff0c\u6700\u540e\u4e00\u4e2a\u5b57\u6bb5\u540e\u9762\u6ca1\u6709\u9017\u53f7 \u6bd4\u5982\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u5f20\u8868  tb_user \uff0c\u5bf9\u5e94\u7684\u7ed3\u6784\u5982\u4e0b\uff0c\u90a3\u4e48\u5efa\u8868\u8bed\u53e5\u4e3a\uff1a</p> <pre><code>create table tb_user(\nid int comment '\u7f16\u53f7',\nname varchar(50) comment '\u59d3\u540d',\nage int comment '\u5e74\u9f84',\ngender varchar(1) comment '\u6027\u522b'\n) comment '\u7528\u6237\u8868';\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#-","title":"\u8868\u64cd\u4f5c-\u6848\u4f8b","text":"<pre><code>\u8bbe\u8ba1\u4e00\u5f20\u5458\u5de5\u4fe1\u606f\u8868\uff0c\u8981\u6c42\u5982\u4e0b\uff1a\n1. \u7f16\u53f7\uff08\u7eaf\u6570\u5b57\uff09\n2. \u5458\u5de5\u5de5\u53f7 (\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u957f\u5ea6\u4e0d\u8d85\u8fc710\u4f4d)\n3. \u5458\u5de5\u59d3\u540d\uff08\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u957f\u5ea6\u4e0d\u8d85\u8fc710\u4f4d\uff09\n4. \u6027\u522b\uff08\u7537/\u5973\uff0c\u5b58\u50a8\u4e00\u4e2a\u6c49\u5b57\uff09\n5. \u5e74\u9f84\uff08\u6b63\u5e38\u4eba\u5e74\u9f84\uff0c\u4e0d\u53ef\u80fd\u5b58\u50a8\u8d1f\u6570\uff09\n6. \u8eab\u4efd\u8bc1\u53f7\uff08\u4e8c\u4ee3\u8eab\u4efd\u8bc1\u53f7\u5747\u4e3a18\u4f4d\uff0c\u8eab\u4efd\u8bc1\u4e2d\u6709X\u8fd9\u6837\u7684\u5b57\u7b26\uff09\n7. \u5165\u804c\u65f6\u95f4\uff08\u53d6\u503c\u5e74\u6708\u65e5\u5373\u53ef\uff09  \n</code></pre> <p>\u5efa\u8868</p> <pre><code>create table emp(\n        id int comment '\u7f16\u53f7',\n        workno varchar(10) comment '\u5de5\u53f7',\n        name varchar(10) comment '\u59d3\u540d',\n        gender char(1) comment '\u6027\u522b',\n        age tinyint unsigned comment '\u5e74\u9f84',\n        idcard char(18) comment '\u8eab\u4efd\u8bc1\u53f7',\n        entrydate date comment '\u5165\u804c\u65f6\u95f4'\n) comment '\u5458\u5de5\u8868';\n</code></pre> <pre><code>SQL\u8bed\u53e5\u7f16\u5199\u5b8c\u6bd5\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728MySQL\u7684\u547d\u4ee4\u884c\u4e2d\u6267\u884cSQL\uff0c\u7136\u540e\u4e5f\u53ef\u4ee5\u901a\u8fc7  desc  \u6307\u4ee4\u67e5\u8be2\u8868\u7ed3\u6784\u4fe1\u606f\uff1a\ndesc emp;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#-_1","title":"\u8868\u64cd\u4f5c-\u4fee\u6539","text":"<p>1). \u6dfb\u52a0\u5b57\u6bb5</p> <pre><code>ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u7c7b\u578b (\u957f\u5ea6) [ COMMENT \u6ce8\u91ca ] [ \u7ea6\u675f ];\n</code></pre> <p>\u6848\u4f8b:</p> <p>\u4e3aemp\u8868\u589e\u52a0\u4e00\u4e2a\u65b0\u7684\u5b57\u6bb5\u201d\u6635\u79f0\u201d\u4e3anickname\uff0c\u7c7b\u578b\u4e3avarchar(20)</p> <pre><code>ALTER TABLE emp ADD nickname varchar(20) COMMENT '\u6635\u79f0';\n</code></pre> <p>2). \u4fee\u6539\u6570\u636e\u7c7b\u578b</p> <pre><code>ALTER TABLE \u8868\u540d MODIFY \u5b57\u6bb5\u540d \u65b0\u6570\u636e\u7c7b\u578b (\u957f\u5ea6);\n</code></pre> <p>3). \u4fee\u6539\u5b57\u6bb5\u540d\u548c\u5b57\u6bb5\u7c7b\u578b</p> <pre><code>ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u7c7b\u578b (\u957f\u5ea6) [ COMMENT \u6ce8\u91ca ] [ \u7ea6\u675f ];\n</code></pre> <p>\u6848\u4f8b:</p> <p>\u5c06emp\u8868\u7684nickname\u5b57\u6bb5\u4fee\u6539\u4e3ausername\uff0c\u7c7b\u578b\u4e3avarchar(30)</p> <pre><code>ALTER TABLE emp CHANGE nickname username varchar(30) COMMENT ' \u6635 \u79f0 ';\n</code></pre> <p>4). \u5220\u9664\u5b57\u6bb5</p> <pre><code>ALTER TABLE \u8868\u540d DROP \u5b57\u6bb5\u540d;\n</code></pre> <p>\u6848\u4f8b:</p> <p>\u5c06emp\u8868\u7684\u5b57\u6bb5username\u5220\u9664</p> <pre><code>ALTER TABLE emp DROP username;\n</code></pre> <p>5). \u4fee\u6539\u8868\u540d</p> <pre><code>ALTER TABLE \u8868\u540d RENAME TO \u65b0\u8868\u540d;\n</code></pre> <p>\u6848\u4f8b:</p> <p>\u5c06emp\u8868\u7684\u8868\u540d\u4fee\u6539\u4e3a employee</p> <pre><code>ALTER TABLE emp RENAME TO employee;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#-_2","title":"\u8868\u64cd\u4f5c-\u5220\u9664","text":"<p>1). \u5220\u9664\u8868</p> <pre><code>DROP TABLE [ IF EXISTS ] \u8868 \u540d ;\n</code></pre> <p>\u53ef\u9009\u9879 IF EXISTS \u4ee3\u8868\uff0c\u53ea\u6709\u8868\u540d\u5b58\u5728\u65f6\u624d\u4f1a\u5220\u9664\u8be5\u8868\uff0c\u8868\u540d\u4e0d\u5b58\u5728\uff0c\u5219\u4e0d\u6267\u884c\u5220\u9664\u64cd\u4f5c(\u5982\u679c\u4e0d\u52a0\u8be5\u53c2\u6570\u9879\uff0c\u5220\u9664\u4e00\u5f20\u4e0d\u5b58\u5728\u7684\u8868\uff0c\u6267\u884c\u5c06\u4f1a\u62a5\u9519)\u3002</p> <p>\u6848\u4f8b:</p> <p>\u5982\u679ctb_user\u8868\u5b58\u5728\uff0c\u5219\u5220\u9664tb_user\u8868</p> <pre><code>DROP TABLE IF EXISTS tb_user;\n</code></pre> <p>2). \u5220\u9664\u6307\u5b9a\u8868, \u5e76\u91cd\u65b0\u521b\u5efa\u8868</p> <pre><code>TRUNCATE TABLE \u8868\u540d;\n</code></pre> <p>\u6ce8\u610f: \u5728\u5220\u9664\u8868\u7684\u65f6\u5019\uff0c\u8868\u4e2d\u7684\u5168\u90e8\u6570\u636e\u4e5f\u90fd\u4f1a\u88ab\u5220\u9664\u3002</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#2dml","title":"2.DML","text":"<p>DML\u82f1\u6587\u5168\u79f0\u662fData Manipulation Language(\u6570\u636e\u64cd\u4f5c\u8bed\u8a00)\uff0c\u7528\u6765\u5bf9\u6570\u636e\u5e93\u4e2d\u8868\u7684\u6570\u636e\u8bb0\u5f55\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u3002</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_4","title":"\u6dfb\u52a0\u6570\u636e","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#1_1","title":"1). \u7ed9\u6307\u5b9a\u5b57\u6bb5\u6dfb\u52a0\u6570\u636e","text":"<pre><code>INSERT INTO \u8868\u540d (\u5b57\u6bb5\u540d1, \u5b57\u6bb5\u540d2, ...) VALUES (\u503c1, \u503c2, ...);\n</code></pre> <p>\u6848\u4f8b: \u7ed9employee\u8868\u6240\u6709\u7684\u5b57\u6bb5\u6dfb\u52a0\u6570\u636e \uff1b</p> <pre><code>insert into employee(id,workno,name,gender,age,idcard,entrydate) values(1,'1','Itcast','\u7537',10,'123456789012345678','2000-01-01');\n</code></pre> <p>\u63d2\u5165\u6570\u636e\u5b8c\u6210\u4e4b\u540e\uff0c\u67e5\u8be2\u6570\u636e\u5e93\u7684\u6570\u636e\uff1a</p> <pre><code>select * from employee;\n</code></pre> <p>\u6848\u4f8b: \u7ed9employee\u8868\u6240\u6709\u7684\u5b57\u6bb5\u6dfb\u52a0\u6570\u636e\u6267\u884c\u5982\u4e0bSQL\uff0c\u6dfb\u52a0\u7684\u5e74\u9f84\u5b57\u6bb5\u503c\u4e3a-1\u3002</p> <pre><code>insert into employee(id,workno,name,gender,age,idcard,entrydate) values(1,'1','Itcast','\u7537',-1,'123456789012345678','2000-01-01');\n</code></pre> <p>\u6267\u884c\u4e0a\u8ff0\u7684SQL\u8bed\u53e5\u65f6\uff0c\u62a5\u9519\u4e86\uff0c\u5177\u4f53\u7684\u9519\u8bef\u4fe1\u606f\u5982\u4e0b\uff1a</p> <p></p> <p>\u56e0\u4e3a employee \u8868\u7684age\u5b57\u6bb5\u7c7b\u578b\u4e3a tinyint\uff0c\u800c\u4e14\u8fd8\u662f\u65e0\u7b26\u53f7\u7684 unsigned \uff0c\u6240\u4ee5\u53d6\u503c\u53ea\u80fd\u5728</p> <p>0-255 \u4e4b\u95f4\u3002</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#2_1","title":"2). \u7ed9\u5168\u90e8\u5b57\u6bb5\u6dfb\u52a0\u6570\u636e","text":"<pre><code>INSERT INTO \u8868\u540d VALUES (\u503c1, \u503c2, ...);\n</code></pre> <p>\u6848\u4f8b\uff1a\u63d2\u5165\u6570\u636e\u5230employee\u8868\uff0c\u5177\u4f53\u7684SQL\u5982\u4e0b\uff1a</p> <pre><code>insert into employee values(2,'2','\u5f20\u65e0\u5fcc','\u7537',18,'123456789012345670','2005-01-01');\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#3_1","title":"3). \u6279\u91cf\u6dfb\u52a0\u6570\u636e","text":"<pre><code>INSERT INTO \u8868\u540d (\u5b57\u6bb5\u540d1, \u5b57\u6bb5\u540d2, ...) VALUES (\u503c1, \u503c2, ...), (\u503c1, \u503c2, ...), (\u503c1, \u503c2, ...) ;\n</code></pre> <pre><code>INSERT INTO \u8868\u540d VALUES (\u503c1, \u503c2, ...), (\u503c1, \u503c2, ...), (\u503c1, \u503c2, ...) ;\n</code></pre> <p>\u6848\u4f8b\uff1a\u6279\u91cf\u63d2\u5165\u6570\u636e\u5230employee\u8868\uff0c\u5177\u4f53\u7684SQL\u5982\u4e0b\uff1a</p> <pre><code>insert into employee values(3,'3','\u97e6\u4e00\u7b11','\u7537',38,'123456789012345670','2005-01-01'),(4,'4','\u8d75\u654f','\u5973',18,'123456789012345670','2005-01-01');\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879:</p> <p>\u63d2\u5165\u6570\u636e\u65f6\uff0c\u6307\u5b9a\u7684\u5b57\u6bb5\u987a\u5e8f\u9700\u8981\u4e0e\u503c\u7684\u987a\u5e8f\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002</p> <p>\u5b57\u7b26\u4e32\u548c\u65e5\u671f\u578b\u6570\u636e\u5e94\u8be5\u5305\u542b\u5728\u5f15\u53f7\u4e2d\u3002</p> <p>\u63d2\u5165\u7684\u6570\u636e\u5927\u5c0f\uff0c\u5e94\u8be5\u5728\u5b57\u6bb5\u7684\u89c4\u5b9a\u8303\u56f4\u5185\u3002</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#4","title":"4). \u4fee\u6539\u6570\u636e","text":"<p>\u4fee\u6539\u6570\u636e\u7684\u5177\u4f53\u8bed\u6cd5\u4e3a:</p> <pre><code>UPDATE  \u8868\u540d  SET \u5b57\u6bb5\u540d1 = \u503c1 , \u5b57\u6bb5\u540d2 = \u503c2 , .... [ WHERE \u6761\u4ef6 ] ;\n</code></pre> <p>\u6848\u4f8b:</p> <p>A. \u4fee\u6539id\u4e3a1\u7684\u6570\u636e\uff0c\u5c06name\u4fee\u6539\u4e3aitheima</p> <pre><code>update employee set name = 'itheima' where id = 1;\n</code></pre> <p>B. \u4fee\u6539id\u4e3a1\u7684\u6570\u636e, \u5c06name\u4fee\u6539\u4e3a\u5c0f\u662d, gender\u4fee\u6539\u4e3a \u5973</p> <pre><code>update employee set name = '\u5c0f\u662d' , gender = '\u5973' where id = 1;\n</code></pre> <p>C. \u5c06\u6240\u6709\u7684\u5458\u5de5\u5165\u804c\u65e5\u671f\u4fee\u6539\u4e3a 2008-01-01</p> <pre><code>update employee set entrydate = '2008-01-01';\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879:</p> <p>\u4fee\u6539\u8bed\u53e5\u7684\u6761\u4ef6\u53ef\u4ee5\u6709\uff0c\u4e5f\u53ef\u4ee5\u6ca1\u6709\uff0c\u5982\u679c\u6ca1\u6709\u6761\u4ef6\uff0c\u5219\u4f1a\u4fee\u6539\u6574\u5f20\u8868\u7684\u6240\u6709\u6570\u636e\u3002</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#5","title":"5). \u5220\u9664\u6570\u636e","text":"<pre><code>DELETE FROM \u8868 \u540d [ WHERE \u6761 \u4ef6 ] ;\n</code></pre> <p>\u6848\u4f8b:</p> <p>A. \u5220\u9664gender\u4e3a\u5973\u7684\u5458\u5de5</p> <pre><code>delete from employee where gender = '\u5973';\n</code></pre> <p>B. \u5220\u9664\u6240\u6709\u5458\u5de5</p> <pre><code>delete from employee;\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879:</p> <p>\u2022 DELETE \u8bed\u53e5\u7684\u6761\u4ef6\u53ef\u4ee5\u6709\uff0c\u4e5f\u53ef\u4ee5\u6ca1\u6709\uff0c\u5982\u679c\u6ca1\u6709\u6761\u4ef6\uff0c\u5219\u4f1a\u5220\u9664\u6574\u5f20\u8868\u7684\u6240\u6709\u6570</p> <p>\u636e\u3002</p> <p>\u2022 DELETE \u8bed\u53e5\u4e0d\u80fd\u5220\u9664\u67d0\u4e00\u4e2a\u5b57\u6bb5\u7684\u503c(\u53ef\u4ee5\u4f7f\u7528UPDATE\uff0c\u5c06\u8be5\u5b57\u6bb5\u503c\u7f6e\u4e3aNULL\u5373\u53ef)\u3002</p> <p>\u2022 \u5f53\u8fdb\u884c\u5220\u9664\u5168\u90e8\u6570\u636e\u64cd\u4f5c\u65f6\uff0cdatagrip\u4f1a\u63d0\u793a\u6211\u4eec\uff0c\u8be2\u95ee\u662f\u5426\u786e\u8ba4\u5220\u9664\uff0c\u6211\u4eec\u76f4\u63a5\u70b9\u51fb</p> <p>Execute\u5373\u53ef\u3002</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#3dql","title":"3.DQL","text":"<p>DQL\u82f1\u6587\u5168\u79f0\u662fData Query Language(\u6570\u636e\u67e5\u8be2\u8bed\u8a00)\uff0c\u6570\u636e\u67e5\u8be2\u8bed\u8a00\uff0c\u7528\u6765\u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u8868\u7684\u8bb0\u5f55\u3002</p> <p>\u67e5\u8be2\u5173\u952e\u5b57: SELECT</p> <p>\u5728\u4e00\u4e2a\u6b63\u5e38\u7684\u4e1a\u52a1\u7cfb\u7edf\u4e2d\uff0c\u67e5\u8be2\u64cd\u4f5c\u7684\u9891\u6b21\u662f\u8981\u8fdc\u9ad8\u4e8e\u589e\u5220\u6539\u7684\uff0c\u5f53\u6211\u4eec\u53bb\u8bbf\u95ee\u4f01\u4e1a\u5b98\u7f51\u3001\u7535\u5546\u7f51\u7ad9\uff0c \u5728\u8fd9\u4e9b\u7f51\u7ad9\u4e2d\u6211\u4eec\u6240\u770b\u5230\u7684\u6570\u636e\uff0c\u5b9e\u9645\u90fd\u662f\u9700\u8981\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u5e76\u5c55\u793a\u7684\u3002\u800c\u4e14\u5728\u67e5\u8be2\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd \u8fd8\u4f1a\u6d89\u53ca\u5230\u6761\u4ef6\u3001\u6392\u5e8f\u3001\u5206\u9875\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_5","title":"\u51c6\u5907\u5de5\u4f5c","text":"<pre><code>drop table if exists employee;\ncreate table emp(\nid int comment '\u7f16\u53f7',\nworkno varchar(10) comment '\u5de5\u53f7',\nname varchar(10) comment '\u59d3\u540d',\ngender char(1) comment '\u6027\u522b',\nage tinyint unsigned comment '\u5e74\u9f84',\nidcard char(18) comment '\u8eab\u4efd\u8bc1\u53f7',\nworkaddress varchar(50) comment '\u5de5\u4f5c\u5730\u5740',\nentrydate date comment '\u5165\u804c\u65f6\u95f4'\n)comment '\u5458\u5de5\u8868';\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (1, '00001', '\u67f3\u5ca9666', '\u5973', 20, '123456789012345678', '\u5317\u4eac', '2000-01-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (2, '00002', '\u5f20\u65e0\u5fcc', '\u7537', 18, '123456789012345670', '\u5317\u4eac', '2005-09-\n01');\n1 2 3 4 5 6 7 8 9\n10\n11\n12\n13\n14\n15INSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (3, '00003', '\u97e6\u4e00\u7b11', '\u7537', 38, '123456789712345670', '\u4e0a\u6d77', '2005-08-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (4, '00004', '\u8d75\u654f', '\u5973', 18, '123456757123845670', '\u5317\u4eac', '2009-12-01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (5, '00005', '\u5c0f\u662d', '\u5973', 16, '123456769012345678', '\u4e0a\u6d77', '2007-07-01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (6, '00006', '\u6768\u900d', '\u7537', 28, '12345678931234567X', '\u5317\u4eac', '2006-01-01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (7, '00007', '\u8303\u7476', '\u7537', 40, '123456789212345670', '\u5317\u4eac', '2005-05-01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (8, '00008', '\u9edb\u7eee\u4e1d', '\u5973', 38, '123456157123645670', '\u5929\u6d25', '2015-05-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (9, '00009', '\u8303\u51c9\u51c9', '\u5973', 45, '123156789012345678', '\u5317\u4eac', '2010-04-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (10, '00010', '\u9648\u53cb\u8c05', '\u7537', 53, '123456789012345670', '\u4e0a\u6d77', '2011-01-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (11, '00011', '\u5f20\u58eb\u8bda', '\u7537', 55, '123567897123465670', '\u6c5f\u82cf', '2015-05-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (12, '00012', '\u5e38\u9047\u6625', '\u7537', 32, '123446757152345670', '\u5317\u4eac', '2004-02-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (13, '00013', '\u5f20\u4e09\u4e30', '\u7537', 88, '123656789012345678', '\u6c5f\u82cf', '2020-11-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (14, '00014', '\u706d\u7edd', '\u5973', 65, '123456719012345670', '\u897f\u5b89', '2019-05-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (15, '00015', '\u80e1\u9752\u725b', '\u7537', 70, '12345674971234567X', '\u897f\u5b89', '2018-04-\n01');\nINSERT INTO emp (id, workno, name, gender, age, idcard, workaddress, entrydate)\nVALUES (16, '00016', '\u5468\u82b7\u82e5', '\u5973', 18, null, '\u5317\u4eac', '2012-06-01');\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_6","title":"\u57fa\u672c\u8bed\u6cd5","text":"<pre><code>SELECT\n\u5b57\u6bb5\u5217\u8868\nFROM\n\u8868\u540d\u5217\u8868\nWHERE\n\u6761\u4ef6\u5217\u8868\nGROUP BY\n\u5206\u7ec4\u5b57\u6bb5\u5217\u8868\nHAVING\n\u5206\u7ec4\u540e\u6761\u4ef6\u5217\u8868\nORDER BY\n\u6392\u5e8f\u5b57\u6bb5\u5217\u8868\nLIMIT\n\u5206\u9875\u53c2\u6570\n</code></pre> <p>\u6211\u4eec\u5728\u8bb2\u89e3\u8fd9\u90e8\u5206\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u4e0a\u9762\u7684\u5b8c\u6574\u8bed\u6cd5\u8fdb\u884c\u62c6\u5206\uff0c\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a \u57fa\u672c\u67e5\u8be2\uff08\u4e0d\u5e26\u4efb\u4f55\u6761\u4ef6\uff09 \u6761\u4ef6\u67e5\u8be2\uff08WHERE\uff09 \u805a\u5408\u51fd\u6570\uff08count\u3001max\u3001min\u3001avg\u3001sum\uff09 \u5206\u7ec4\u67e5\u8be2\uff08group by\uff09 \u6392\u5e8f\u67e5\u8be2\uff08order by\uff09 \u5206\u9875\u67e5\u8be2\uff08limit\uff09  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_7","title":"\u57fa\u7840\u67e5\u8be2","text":"<p>\u67e5\u8be2\u591a\u4e2a\u5b57\u6bb5  </p> <pre><code>SELECT \u5b57\u6bb51, \u5b57\u6bb52, \u5b57\u6bb53 ... FROM \u8868\u540d ;\nSELECT * FROM \u8868\u540d ;\n</code></pre> <p>\u6ce8\u610f : * \u53f7\u4ee3\u8868\u67e5\u8be2\u6240\u6709\u5b57\u6bb5\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u5c3d\u91cf\u5c11\u7528\uff08\u4e0d\u76f4\u89c2\u3001\u5f71\u54cd\u6548\u7387\uff09\u3002</p> <p>\u5b57\u6bb5\u8bbe\u7f6e\u522b\u540d  </p> <pre><code>SELECT \u5b57\u6bb51 [ AS \u522b\u540d1 ] , \u5b57\u6bb52 [ AS \u522b\u540d2 ] ... FROM \u8868\u540d;\nSELECT \u5b57\u6bb51 [ \u522b\u540d1 ] , \u5b57\u6bb52 [ \u522b\u540d2 ] ... FROM \u8868\u540d;\n</code></pre> <p>\u53bb\u9664\u91cd\u590d\u8bb0\u5f55  </p> <pre><code>SELECT DISTINCT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d;\n</code></pre> <p>\u6848\u4f8b\uff1a  </p> <p>\u67e5\u8be2\u6307\u5b9a\u5b57\u6bb5 name, workno, age\u5e76\u8fd4\u56de  </p> <pre><code>select name,workno,age from emp;\n</code></pre> <p>\u67e5\u8be2\u8fd4\u56de\u6240\u6709\u5b57\u6bb5  </p> <pre><code>select id ,workno,name,gender,age,idcard,workaddress,entrydate from emp;\nselect * from emp;\n</code></pre> <p>\u67e5\u8be2\u6240\u6709\u5458\u5de5\u7684\u5de5\u4f5c\u5730\u5740,\u8d77\u522b\u540d  </p> <pre><code>select workaddress as '\u5de5\u4f5c\u5730\u5740' from emp;\n-- as\u53ef\u4ee5\u7701\u7565\nselect workaddress '\u5de5\u4f5c\u5730\u5740' from emp;\n</code></pre> <p>\u67e5\u8be2\u516c\u53f8\u5458\u5de5\u7684\u4e0a\u73ed\u5730\u5740\u6709\u54ea\u4e9b(\u4e0d\u8981\u91cd\u590d)  </p> <pre><code>select distinct workaddress '\u5de5\u4f5c\u5730\u5740' from emp;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_8","title":"\u6761\u4ef6\u67e5\u8be2","text":"<pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d WHERE \u6761\u4ef6\u5217\u8868 ;\n</code></pre> <p>\u6761\u4ef6  </p> <p>\u5e38\u7528\u7684\u6bd4\u8f83\u8fd0\u7b97\u7b26\u5982\u4e0b:  </p> \u6bd4\u8f83\u8fd0\u7b97\u7b26 \u529f\u80fd &gt; \u5927\u4e8e &gt;= \u5927\u4e8e\u7b49\u4e8e &lt; \u5c0f\u4e8e &lt;= \u5c0f\u4e8e\u7b49\u4e8e = \u7b49\u4e8e &lt;&gt; \u6216 != \u4e0d\u7b49\u4e8e BETWEEN ... AND ... \u5728\u67d0\u4e2a\u8303\u56f4\u4e4b\u5185(\u542b\u6700\u5c0f\u3001\u6700\u5927\u503c) IN(...) \u5728in\u4e4b\u540e\u7684\u5217\u8868\u4e2d\u7684\u503c\uff0c\u591a\u9009\u4e00 LIKE \u5360\u4f4d\u7b26 \u6a21\u7cca\u5339\u914d(_\u5339\u914d\u5355\u4e2a\u5b57\u7b26, %\u5339\u914d\u4efb\u610f\u4e2a\u5b57\u7b26) IS NULL \u662fNULL <p>\u5e38\u7528\u7684\u903b\u8f91\u8fd0\u7b97\u7b26\u5982\u4e0b  </p> \u903b\u8f91\u8fd0\u7b97\u7b26 \u529f\u80fd AND \u6216 &amp;&amp; \u5e76\u4e14 (\u591a\u4e2a\u6761\u4ef6\u540c\u65f6\u6210\u7acb) OR \u6216 || \u6216\u8005 (\u591a\u4e2a\u6761\u4ef6\u4efb\u610f\u4e00\u4e2a\u6210\u7acb) NOT \u6216 ! \u975e , \u4e0d\u662f <p>\u6848\u4f8b  </p> <p>\u67e5\u8be2\u5e74\u9f84\u7b49\u4e8e 88 \u7684\u5458\u5de5  </p> <pre><code> select * from emp where age = 88;\n</code></pre> <p>\u67e5\u8be2\u5e74\u9f84\u5c0f\u4e8e 20 \u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where age &lt; 20;\n</code></pre> <p>\u67e5\u8be2\u5e74\u9f84\u5c0f\u4e8e\u7b49\u4e8e 20 \u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where age &lt;= 20;\n</code></pre> <p>\u67e5\u8be2\u6ca1\u6709\u8eab\u4efd\u8bc1\u53f7\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where idcard is null;\n</code></pre> <p>\u67e5\u8be2\u6709\u8eab\u4efd\u8bc1\u53f7\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where idcard is not null;\n</code></pre> <p>\u67e5\u8be2\u5e74\u9f84\u4e0d\u7b49\u4e8e 88 \u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where age != 88;\nselect * from emp where age &lt;&gt; 88;\n</code></pre> <p>\u67e5\u8be2\u5e74\u9f84\u572815\u5c81(\u5305\u542b) \u5230 20\u5c81(\u5305\u542b)\u4e4b\u95f4\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where age &gt;= 15 &amp;&amp; age &lt;= 20;\nselect * from emp where age &gt;= 15 and age &lt;= 20;\nselect * from emp where age between 15 and 20;\n</code></pre> <p>\u67e5\u8be2\u6027\u522b\u4e3a \u5973 \u4e14\u5e74\u9f84\u5c0f\u4e8e 25\u5c81\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where gender = '\u5973' and age &lt; 25;\n</code></pre> <p>\u67e5\u8be2\u5e74\u9f84\u7b49\u4e8e18 \u6216 20 \u6216 40 \u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where age = 18 or age = 20 or age =40;\nselect * from emp where age in(18,20,40);\n</code></pre> <p>\u67e5\u8be2\u59d3\u540d\u4e3a\u4e24\u4e2a\u5b57\u7684\u5458\u5de5\u4fe1\u606f _ %  </p> <pre><code>select * from emp where name like '__';\n</code></pre> <p>\u67e5\u8be2\u8eab\u4efd\u8bc1\u53f7\u6700\u540e\u4e00\u4f4d\u662fX\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where idcard like '%X';\nselect * from emp where idcard like '_________________X';\n</code></pre> <p>\u805a\u5408\u51fd\u6570  </p> \u51fd\u6570 \u529f\u80fd count \u7edf\u8ba1\u6570\u91cf max \u6700\u5927\u503c min \u6700\u5c0f\u503c avg \u5e73\u5747\u503c sum \u6c42\u548c <p>\u8bed\u6cd5  </p> <pre><code>SELECT \u805a\u5408\u51fd\u6570(\u5b57\u6bb5\u5217\u8868) FROM \u8868\u540d ;\n</code></pre> <p>\u6ce8\u610f : NULL\u503c\u662f\u4e0d\u53c2\u4e0e\u6240\u6709\u805a\u5408\u51fd\u6570\u8fd0\u7b97\u7684\u3002  </p> <p>\u6848\u4f8b\uff1a  \u7edf\u8ba1\u8be5\u4f01\u4e1a\u5458\u5de5\u6570\u91cf  </p> <pre><code>select count(*) from emp; -- \u7edf\u8ba1\u7684\u662f\u603b\u8bb0\u5f55\u6570\nselect count(idcard) from emp; -- \u7edf\u8ba1\u7684\u662fidcard\u5b57\u6bb5\u4e0d\u4e3anull\u7684\u8bb0\u5f55\u6570\n</code></pre> <p>\u5bf9\u4e8ecount\u805a\u5408\u51fd\u6570\uff0c\u7edf\u8ba1\u7b26\u5408\u6761\u4ef6\u7684\u603b\u8bb0\u5f55\u6570\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 count(\u6570\u5b57/\u5b57\u7b26\u4e32)\u7684\u5f62\u5f0f\u8fdb\u884c\u7edf\u8ba1 \u67e5\u8be2\uff0c\u6bd4\u5982\uff1a  </p> <pre><code>select count(1) from emp;  \n</code></pre> <pre><code>\u5bf9\u4e8ecount(*) \u3001count(\u5b57\u6bb5)\u3001 count(1) \u7684\u5177\u4f53\u539f\u7406\uff0c\u6211\u4eec\u5728\u8fdb\u9636\u7bc7\u4e2dSQL\u4f18\u5316\u90e8\u5206\u4f1a\u8be6\n\u7ec6\u8bb2\u89e3\uff0c\u6b64\u5904\u5927\u5bb6\u53ea\u9700\u8981\u77e5\u9053\u5982\u4f55\u4f7f\u7528\u5373\u53ef\u3002\n</code></pre> <p>\u7edf\u8ba1\u8be5\u4f01\u4e1a\u5458\u5de5\u7684\u5e73\u5747\u5e74\u9f84  </p> <pre><code> select avg(age) from emp;\n</code></pre> <p>\u7edf\u8ba1\u8be5\u4f01\u4e1a\u5458\u5de5\u7684\u6700\u5927\u5e74\u9f84  </p> <pre><code>select max(age) from emp;\n</code></pre> <p>\u7edf\u8ba1\u8be5\u4f01\u4e1a\u5458\u5de5\u7684\u6700\u5c0f\u5e74\u9f84  </p> <pre><code>select min(age) from emp;\n</code></pre> <p>\u7edf\u8ba1\u897f\u5b89\u5730\u533a\u5458\u5de5\u7684\u5e74\u9f84\u4e4b\u548c  </p> <pre><code>select sum(age) from emp where workaddress = '\u897f\u5b89';\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_9","title":"\u5206\u7ec4\u67e5\u8be2","text":"<p>\u8bed\u6cd5  </p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d [ WHERE \u6761\u4ef6 ] GROUP BY \u5206\u7ec4\u5b57\u6bb5\u540d [ HAVING \u5206\u7ec4\n\u540e\u8fc7\u6ee4\u6761\u4ef6 ];\n</code></pre> <p>where\u4e0ehaving\u533a\u522b  </p> <pre><code>\u6267\u884c\u65f6\u673a\u4e0d\u540c\uff1awhere\u662f\u5206\u7ec4\u4e4b\u524d\u8fdb\u884c\u8fc7\u6ee4\uff0c\u4e0d\u6ee1\u8db3where\u6761\u4ef6\uff0c\u4e0d\u53c2\u4e0e\u5206\u7ec4\uff1b\u800chaving\u662f\u5206\u7ec4\n\u4e4b\u540e\u5bf9\u7ed3\u679c\u8fdb\u884c\u8fc7\u6ee4\u3002\n\u5224\u65ad\u6761\u4ef6\u4e0d\u540c\uff1awhere\u4e0d\u80fd\u5bf9\u805a\u5408\u51fd\u6570\u8fdb\u884c\u5224\u65ad\uff0c\u800chaving\u53ef\u4ee5\u3002  \n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879: \u2022 \u5206\u7ec4\u4e4b\u540e\uff0c\u67e5\u8be2\u7684\u5b57\u6bb5\u4e00\u822c\u4e3a\u805a\u5408\u51fd\u6570\u548c\u5206\u7ec4\u5b57\u6bb5\uff0c\u67e5\u8be2\u5176\u4ed6\u5b57\u6bb5\u65e0\u4efb\u4f55\u610f\u4e49\u3002 \u2022 \u6267\u884c\u987a\u5e8f: where &gt; \u805a\u5408\u51fd\u6570 &gt; having \u3002 \u2022 \u652f\u6301\u591a\u5b57\u6bb5\u5206\u7ec4, \u5177\u4f53\u8bed\u6cd5\u4e3a : group by columnA,columnB  </p> <p>\u6848\u4f8b:  \u6839\u636e\u6027\u522b\u5206\u7ec4 , \u7edf\u8ba1\u7537\u6027\u5458\u5de5 \u548c \u5973\u6027\u5458\u5de5\u7684\u6570\u91cf  </p> <pre><code>select gender, count(*) from emp group by gender ;\n</code></pre> <p>\u6839\u636e\u6027\u522b\u5206\u7ec4 , \u7edf\u8ba1\u7537\u6027\u5458\u5de5 \u548c \u5973\u6027\u5458\u5de5\u7684\u5e73\u5747\u5e74\u9f84  </p> <pre><code>select gender, avg(age) from emp group by gender ;\n</code></pre> <p>\u67e5\u8be2\u5e74\u9f84\u5c0f\u4e8e45\u7684\u5458\u5de5 , \u5e76\u6839\u636e\u5de5\u4f5c\u5730\u5740\u5206\u7ec4 , \u83b7\u53d6\u5458\u5de5\u6570\u91cf\u5927\u4e8e\u7b49\u4e8e3\u7684\u5de5\u4f5c\u5730\u5740  </p> <pre><code>select workaddress, count(*) address_count from emp where age &lt; 45 group by workaddress having address_count &gt;= 3;\n</code></pre> <p>\u7edf\u8ba1\u5404\u4e2a\u5de5\u4f5c\u5730\u5740\u4e0a\u73ed\u7684\u7537\u6027\u53ca\u5973\u6027\u5458\u5de5\u7684\u6570\u91cf  </p> <pre><code>select workaddress, gender, count(*) '\u6570\u91cf' from emp group by gender , workaddress;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_10","title":"\u6392\u5e8f\u67e5\u8be2","text":"<pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d ORDER BY \u5b57\u6bb51 \u6392\u5e8f\u65b9\u5f0f1 , \u5b57\u6bb52 \u6392\u5e8f\u65b9\u5f0f2 ;\n</code></pre> <ul> <li>ASC : \u5347\u5e8f(\u9ed8\u8ba4\u503c)</li> <li>DESC: \u964d\u5e8f  </li> </ul> <p>\u6ce8\u610f\u4e8b\u9879\uff1a \u2022 \u5982\u679c\u662f\u5347\u5e8f, \u53ef\u4ee5\u4e0d\u6307\u5b9a\u6392\u5e8f\u65b9\u5f0fASC ; \u2022 \u5982\u679c\u662f\u591a\u5b57\u6bb5\u6392\u5e8f\uff0c\u5f53\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u503c\u76f8\u540c\u65f6\uff0c\u624d\u4f1a\u6839\u636e\u7b2c\u4e8c\u4e2a\u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f ;  </p> <p>\u6848\u4f8b  \u6839\u636e\u5e74\u9f84\u5bf9\u516c\u53f8\u7684\u5458\u5de5\u8fdb\u884c\u5347\u5e8f\u6392\u5e8f  </p> <pre><code>select * from emp order by age asc;\nselect * from emp order by age;\n</code></pre> <p>\u6839\u636e\u5165\u804c\u65f6\u95f4, \u5bf9\u5458\u5de5\u8fdb\u884c\u964d\u5e8f\u6392\u5e8f  </p> <pre><code>select * from emp order by entrydate desc;\n</code></pre> <p>\u6839\u636e\u5e74\u9f84\u5bf9\u516c\u53f8\u7684\u5458\u5de5\u8fdb\u884c\u5347\u5e8f\u6392\u5e8f , \u5e74\u9f84\u76f8\u540c , \u518d\u6309\u7167\u5165\u804c\u65f6\u95f4\u8fdb\u884c\u964d\u5e8f\u6392\u5e8f  </p> <pre><code>select * from emp order by age asc , entrydate desc;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_11","title":"\u5206\u9875\u67e5\u8be2","text":"<pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868\u540d LIMIT \u8d77\u59cb\u7d22\u5f15, \u67e5\u8be2\u8bb0\u5f55\u6570 ;\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879: \u2022 \u8d77\u59cb\u7d22\u5f15\u4ece0\u5f00\u59cb\uff0c\u8d77\u59cb\u7d22\u5f15 = \uff08\u67e5\u8be2\u9875\u7801 - 1\uff09* \u6bcf\u9875\u663e\u793a\u8bb0\u5f55\u6570\u3002 \u2022 \u5206\u9875\u67e5\u8be2\u662f\u6570\u636e\u5e93\u7684\u65b9\u8a00\uff0c\u4e0d\u540c\u7684\u6570\u636e\u5e93\u6709\u4e0d\u540c\u7684\u5b9e\u73b0\uff0cMySQL\u4e2d\u662fLIMIT\u3002 \u2022 \u5982\u679c\u67e5\u8be2\u7684\u662f\u7b2c\u4e00\u9875\u6570\u636e\uff0c\u8d77\u59cb\u7d22\u5f15\u53ef\u4ee5\u7701\u7565\uff0c\u76f4\u63a5\u7b80\u5199\u4e3a limit 10\u3002  </p> <p>\u6848\u4f8b:  \u67e5\u8be2\u7b2c1\u9875\u5458\u5de5\u6570\u636e, \u6bcf\u9875\u5c55\u793a10\u6761\u8bb0\u5f55  </p> <pre><code>select * from emp limit 0,10;\nselect * from emp limit 10;\n</code></pre> <p>\u67e5\u8be2\u7b2c2\u9875\u5458\u5de5\u6570\u636e, \u6bcf\u9875\u5c55\u793a10\u6761\u8bb0\u5f55 --------&gt; (\u9875\u7801-1)*\u9875\u5c55\u793a\u8bb0\u5f55\u6570  </p> <pre><code>select * from emp limit 10,10;\n</code></pre> <p>\u6848\u4f8b  \u67e5\u8be2\u5e74\u9f84\u4e3a20,21,22,23\u5c81\u7684\u5458\u5de5\u4fe1\u606f\u3002  </p> <pre><code>select * from emp where gender = '\u5973' and age in(20,21,22,23);\n</code></pre> <p>\u67e5\u8be2\u6027\u522b\u4e3a \u7537 \uff0c\u5e76\u4e14\u5e74\u9f84\u5728 20-40 \u5c81(\u542b)\u4ee5\u5185\u7684\u59d3\u540d\u4e3a\u4e09\u4e2a\u5b57\u7684\u5458\u5de5\u3002  </p> <pre><code>select * from emp where gender = '\u7537' and ( age between 20 and 40 ) and name like '___';\n</code></pre> <p>\u7edf\u8ba1\u5458\u5de5\u8868\u4e2d, \u5e74\u9f84\u5c0f\u4e8e60\u5c81\u7684 , \u7537\u6027\u5458\u5de5\u548c\u5973\u6027\u5458\u5de5\u7684\u4eba\u6570\u3002  </p> <pre><code>select gender, count(*) from emp where age &lt; 60 group by gender;  \n</code></pre> <p>\u67e5\u8be2\u6240\u6709\u5e74\u9f84\u5c0f\u4e8e\u7b49\u4e8e35\u5c81\u5458\u5de5\u7684\u59d3\u540d\u548c\u5e74\u9f84\uff0c\u5e76\u5bf9\u67e5\u8be2\u7ed3\u679c\u6309\u5e74\u9f84\u5347\u5e8f\u6392\u5e8f\uff0c\u5982\u679c\u5e74\u9f84\u76f8\u540c\u6309\u5165\u804c\u65f6\u95f4\u964d\u5e8f\u6392\u5e8f\u3002  </p> <pre><code>select name , age from emp where age &lt;= 35 order by age asc , entrydate desc;\n</code></pre> <p>\u67e5\u8be2\u6027\u522b\u4e3a\u7537\uff0c\u4e14\u5e74\u9f84\u572820-40 \u5c81(\u542b)\u4ee5\u5185\u7684\u524d5\u4e2a\u5458\u5de5\u4fe1\u606f\uff0c\u5bf9\u67e5\u8be2\u7684\u7ed3\u679c\u6309\u5e74\u9f84\u5347\u5e8f\u6392\u5e8f\uff0c\u5e74\u9f84\u76f8\u540c\u6309\u5165\u804c\u65f6\u95f4\u5347\u5e8f\u6392\u5e8f\u3002  </p> <pre><code>select * from emp where gender = '\u7537' and age between 20 and 40 order by age asc ,entrydate asc limit 5 ;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_12","title":"\u6267\u884c\u987a\u5e8f","text":"<p>\u5728\u8bb2\u89e3DQL\u8bed\u53e5\u7684\u5177\u4f53\u8bed\u6cd5\u4e4b\u524d\uff0c\u6211\u4eec\u5df2\u7ecf\u8bb2\u89e3\u4e86DQL\u8bed\u53e5\u7684\u5b8c\u6574\u8bed\u6cd5\uff0c\u53ca\u7f16\u5199\u987a\u5e8f\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8981 \u6765\u8bf4\u660e\u7684\u662fDQL\u8bed\u53e5\u5728\u6267\u884c\u65f6\u7684\u6267\u884c\u987a\u5e8f\uff0c\u4e5f\u5c31\u662f\u5148\u6267\u884c\u90a3\u4e00\u90e8\u5206\uff0c\u540e\u6267\u884c\u90a3\u4e00\u90e8\u5206\u3002  </p> <p></p> <p>\u9a8c\u8bc1\uff1a \u67e5\u8be2\u5e74\u9f84\u5927\u4e8e15\u7684\u5458\u5de5\u59d3\u540d\u3001\u5e74\u9f84\uff0c\u5e76\u6839\u636e\u5e74\u9f84\u8fdb\u884c\u5347\u5e8f\u6392\u5e8f\u3002  </p> <pre><code>select name , age from emp where age &gt; 15 order by age asc;\n</code></pre> <p>\u5728\u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u7ed9emp\u8868\u8d77\u4e00\u4e2a\u522b\u540d e\uff0c\u7136\u540e\u5728select \u53ca where\u4e2d\u4f7f\u7528\u8be5\u522b\u540d  </p> <pre><code>select e.name , e.age from emp e where e.age &gt; 15 order by age asc;\n</code></pre> <p>\u6267\u884c\u4e0a\u8ff0SQL\u8bed\u53e5\u540e\uff0c\u6211\u4eec\u770b\u5230\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u7684\u67e5\u8be2\u5230\u7ed3\u679c\uff0c\u6b64\u65f6\u5c31\u8bf4\u660e\uff1a from \u5148\u6267\u884c, \u7136\u540e where \u548c select \u6267\u884c\u3002\u90a3 where \u548c select \u5230\u5e95\u54ea\u4e2a\u5148\u6267\u884c\u5462? \u6b64\u65f6\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u7ed9select\u540e\u9762\u7684\u5b57\u6bb5\u8d77\u522b\u540d\uff0c\u7136\u540e\u5728 where \u4e2d\u4f7f\u7528\u8fd9\u4e2a\u522b\u540d\uff0c\u7136\u540e\u770b\u770b\u662f\u5426\u53ef \u4ee5\u6267\u884c\u6210\u529f\u3002  </p> <pre><code>select e.name ename , e.age eage from emp e where eage &gt; 15 order by age asc;\n</code></pre> <p>\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u7ed3\u8bba: from \u5148\u6267\u884c\uff0c\u7136\u540e\u6267\u884c where \uff0c \u518d\u6267\u884cselect \u3002  </p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u518d\u6267\u884c\u5982\u4e0bSQL\u8bed\u53e5\uff0c\u67e5\u770b\u6267\u884c\u6548\u679c\uff1a  </p> <pre><code>select e.name ename , e.age eage from emp e where e.age &gt; 15 order by eage asc;\n</code></pre> <p>\u7ed3\u679c\u6267\u884c\u6210\u529f\u3002 \u90a3\u4e48\u4e5f\u5c31\u9a8c\u8bc1\u4e86: order by \u662f\u5728select \u8bed\u53e5\u4e4b\u540e\u6267\u884c\u7684\u3002  </p> <pre><code>\u7efc\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230DQL\u8bed\u53e5\u7684\u6267\u884c\u987a\u5e8f\u4e3a\uff1a from ... where ... group by ...\nhaving ... select ... order by ... limit ...\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#4dcl","title":"4.DCL","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_13","title":"\u7ba1\u7406\u7528\u6237","text":"<p>\u67e5\u8be2\u7528\u6237  </p> <pre><code>select * from mysql.user;\n</code></pre> <p>\u5176\u4e2d Host\u4ee3\u8868\u5f53\u524d\u7528\u6237\u8bbf\u95ee\u7684\u4e3b\u673a, \u5982\u679c\u4e3alocalhost, \u4ec5\u4ee3\u8868\u53ea\u80fd\u591f\u5728\u5f53\u524d\u672c\u673a\u8bbf\u95ee\uff0c\u662f\u4e0d\u53ef\u4ee5 \u8fdc\u7a0b\u8bbf\u95ee\u7684\u3002 User\u4ee3\u8868\u7684\u662f\u8bbf\u95ee\u8be5\u6570\u636e\u5e93\u7684\u7528\u6237\u540d\u3002\u5728MySQL\u4e2d\u9700\u8981\u901a\u8fc7Host\u548cUser\u6765\u552f\u4e00\u6807\u8bc6\u4e00 \u4e2a\u7528\u6237\u3002  </p> <p>\u521b\u5efa\u7528\u6237  </p> <pre><code>CREATE USER '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d' IDENTIFIED BY '\u5bc6\u7801';\n</code></pre> <p>\u4fee\u6539\u7528\u6237\u5bc6\u7801  </p> <pre><code>ALTER USER '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d' IDENTIFIED WITH mysql_native_password BY '\u65b0\u5bc6\u7801' ;\n</code></pre> <p>\u5220\u9664\u7528\u6237  </p> <pre><code>DROP USER '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d' ;\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879: \u2022 \u5728MySQL\u4e2d\u9700\u8981\u901a\u8fc7\u7528\u6237\u540d@\u4e3b\u673a\u540d\u7684\u65b9\u5f0f\uff0c\u6765\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a\u7528\u6237\u3002  </p> <p>\u2022 \u4e3b\u673a\u540d\u53ef\u4ee5\u4f7f\u7528 % \u901a\u914d\u3002 \u2022 \u8fd9\u7c7bSQL\u5f00\u53d1\u4eba\u5458\u64cd\u4f5c\u7684\u6bd4\u8f83\u5c11\uff0c\u4e3b\u8981\u662fDBA\uff08 Database Administrator \u6570\u636e\u5e93 \u7ba1\u7406\u5458\uff09\u4f7f\u7528\u3002  </p> <p>\u6848\u4f8b\uff1a  </p> <p>\u521b\u5efa\u7528\u6237itcast, \u53ea\u80fd\u591f\u5728\u5f53\u524d\u4e3b\u673alocalhost\u8bbf\u95ee, \u5bc6\u7801123456;  </p> <pre><code>create user 'itcast'@'localhost' identified by '123456';\n</code></pre> <p>\u521b\u5efa\u7528\u6237heima, \u53ef\u4ee5\u5728\u4efb\u610f\u4e3b\u673a\u8bbf\u95ee\u8be5\u6570\u636e\u5e93, \u5bc6\u7801123456;  </p> <pre><code>create user 'heima'@'%' identified by '123456';\n</code></pre> <p>\u4fee\u6539\u7528\u6237heima\u7684\u8bbf\u95ee\u5bc6\u7801\u4e3a1234;  </p> <pre><code>alter user 'heima'@'%' identified with mysql_native_password by '1234';\n</code></pre> <p>\u5220\u9664 itcast@localhost \u7528\u6237  </p> <pre><code>drop user 'itcast'@'localhost';\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_14","title":"\u6743\u9650\u63a7\u5236","text":"<p>MySQL\u4e2d\u5b9a\u4e49\u4e86\u5f88\u591a\u79cd\u6743\u9650\uff0c\u4f46\u662f\u5e38\u7528\u7684\u5c31\u4ee5\u4e0b\u51e0\u79cd\uff1a  </p> \u6743\u9650 \u8bf4\u660e ALL, ALL PRIVILEGES \u6240\u6709\u6743\u9650 SELECT \u67e5\u8be2\u6570\u636e INSERT \u63d2\u5165\u6570\u636e UPDATE \u4fee\u6539\u6570\u636e DELETE \u5220\u9664\u6570\u636e ALTER \u4fee\u6539\u8868 DROP \u5220\u9664\u6570\u636e\u5e93/\u8868/\u89c6\u56fe CREATE \u521b\u5efa\u6570\u636e\u5e93/\u8868 <p>\u4e0a\u8ff0\u53ea\u662f\u7b80\u5355\u7f57\u5217\u4e86\u5e38\u89c1\u7684\u51e0\u79cd\u6743\u9650\u63cf\u8ff0\uff0c\u5176\u4ed6\u6743\u9650\u63cf\u8ff0\u53ca\u542b\u4e49\uff0c\u53ef\u4ee5\u76f4\u63a5\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002  </p> <p>1). \u67e5\u8be2\u6743\u9650  </p> <pre><code>SHOW GRANTS FOR '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d' ;\n</code></pre> <p>\u6388\u4e88\u6743\u9650  </p> <pre><code>GRANT \u6743\u9650\u5217\u8868 ON \u6570\u636e\u5e93\u540d.\u8868\u540d TO '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d';\n</code></pre> <p>\u64a4\u9500\u6743\u9650  </p> <pre><code>REVOKE \u6743\u9650\u5217\u8868 ON \u6570\u636e\u5e93\u540d.\u8868\u540d FROM '\u7528\u6237\u540d'@'\u4e3b\u673a\u540d';\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879\uff1a \u2022 \u591a\u4e2a\u6743\u9650\u4e4b\u95f4\uff0c\u4f7f\u7528\u9017\u53f7\u5206\u9694 \u2022 \u6388\u6743\u65f6\uff0c \u6570\u636e\u5e93\u540d\u548c\u8868\u540d\u53ef\u4ee5\u4f7f\u7528 * \u8fdb\u884c\u901a\u914d\uff0c\u4ee3\u8868\u6240\u6709\u3002  </p> <p>\u6848\u4f8b:  \u67e5\u8be2 'heima'@'%' \u7528\u6237\u7684\u6743\u9650  </p> <pre><code>show grants for 'heima'@'%';\n</code></pre> <p>\u6388\u4e88 'heima'@'%' \u7528\u6237itcast\u6570\u636e\u5e93\u6240\u6709\u8868\u7684\u6240\u6709\u64cd\u4f5c\u6743\u9650  </p> <pre><code>grant all on itcast.* to 'heima'@'%';\n</code></pre> <p>\u64a4\u9500 'heima'@'%' \u7528\u6237\u7684itcast\u6570\u636e\u5e93\u7684\u6240\u6709\u6743\u9650  </p> <pre><code>revoke all on itcast.* from 'heima'@'%';\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_15","title":"\u51fd\u6570","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_16","title":"\u5b57\u7b26\u4e32\u51fd\u6570","text":"<p>MySQL\u4e2d\u5185\u7f6e\u4e86\u5f88\u591a\u5b57\u7b26\u4e32\u51fd\u6570\uff0c\u5e38\u7528\u7684\u51e0\u4e2a\u5982\u4e0b\uff1a  </p> \u51fd\u6570 \u529f\u80fd CONCAT(S1,S2,...Sn) \u5b57\u7b26\u4e32\u62fc\u63a5\uff0c\u5c06S1\uff0cS2\uff0c... Sn\u62fc\u63a5\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32 LOWER(str) \u5c06\u5b57\u7b26\u4e32str\u5168\u90e8\u8f6c\u4e3a\u5c0f\u5199 UPPER(str) \u5c06\u5b57\u7b26\u4e32str\u5168\u90e8\u8f6c\u4e3a\u5927\u5199 LPAD(str,n,pad) \u5de6\u586b\u5145\uff0c\u7528\u5b57\u7b26\u4e32pad\u5bf9str\u7684\u5de6\u8fb9\u8fdb\u884c\u586b\u5145\uff0c\u8fbe\u5230n\u4e2a\u5b57\u7b26 \u4e32\u957f\u5ea6 RPAD(str,n,pad) \u53f3\u586b\u5145\uff0c\u7528\u5b57\u7b26\u4e32pad\u5bf9str\u7684\u53f3\u8fb9\u8fdb\u884c\u586b\u5145\uff0c\u8fbe\u5230n\u4e2a\u5b57\u7b26 \u4e32\u957f\u5ea6 TRIM(str) \u53bb\u6389\u5b57\u7b26\u4e32\u5934\u90e8\u548c\u5c3e\u90e8\u7684\u7a7a\u683c SUBSTRING(str,start,len) \u8fd4\u56de\u4ece\u5b57\u7b26\u4e32str\u4ecestart\u4f4d\u7f6e\u8d77\u7684len\u4e2a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32 <p>\u6f14\u793a\u5982\u4e0b\uff1a concat : \u5b57\u7b26\u4e32\u62fc\u63a5  </p> <pre><code>select concat('Hello' , ' MySQL');\n</code></pre> <p>lower : \u5168\u90e8\u8f6c\u5c0f\u5199  </p> <pre><code>select lower('Hello');\n</code></pre> <p>upper : \u5168\u90e8\u8f6c\u5927\u5199  </p> <pre><code>select upper('Hello');\n</code></pre> <p>lpad : \u5de6\u586b\u5145  </p> <pre><code>select lpad('01', 5, '-');\n</code></pre> <p>rpad : \u53f3\u586b\u5145  </p> <pre><code>select rpad('01', 5, '-');\n</code></pre> <p>trim : \u53bb\u9664\u7a7a\u683c  </p> <pre><code>select trim(' Hello MySQL ');\n</code></pre> <p>substring : \u622a\u53d6\u5b50\u5b57\u7b26\u4e32  </p> <pre><code>select substring('Hello MySQL',1,5);\n</code></pre> <p>\u6848\u4f8b:  </p> <p>\u7531\u4e8e\u4e1a\u52a1\u9700\u6c42\u53d8\u66f4\uff0c\u4f01\u4e1a\u5458\u5de5\u7684\u5de5\u53f7\uff0c\u7edf\u4e00\u4e3a5\u4f4d\u6570\uff0c\u76ee\u524d\u4e0d\u8db35\u4f4d\u6570\u7684\u5168\u90e8\u5728\u524d\u9762\u88650\u3002\u6bd4\u5982\uff1a 1\u53f7\u5458 \u5de5\u7684\u5de5\u53f7\u5e94\u8be5\u4e3a00001\u3002  </p> <pre><code>update emp set workno = lpad(workno, 5, '0');\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_17","title":"\u6570\u503c\u51fd\u6570","text":"<p>\u5e38\u89c1\u7684\u6570\u503c\u51fd\u6570\u5982\u4e0b\uff1a  </p> \u51fd\u6570 \u529f\u80fd CEIL(x) \u5411\u4e0a\u53d6\u6574 FLOOR(x) \u5411\u4e0b\u53d6\u6574 MOD(x,y) \u8fd4\u56dex/y\u7684\u6a21 RAND() \u8fd4\u56de0~1\u5185\u7684\u968f\u673a\u6570 ROUND(x,y) \u6c42\u53c2\u6570x\u7684\u56db\u820d\u4e94\u5165\u7684\u503c\uff0c\u4fdd\u7559y\u4f4d\u5c0f\u6570 <p>\u6f14\u793a\u5982\u4e0b\uff1a   </p> <p>ceil\uff1a\u5411\u4e0a\u53d6\u6574  </p> <pre><code>select ceil(1.1);  \n</code></pre> <p>floor\uff1a\u5411\u4e0b\u53d6\u6574  </p> <pre><code>select floor(1.9);\n</code></pre> <p>mod\uff1a\u53d6\u6a21  </p> <pre><code>select mod(7,4);\n</code></pre> <p>rand\uff1a\u83b7\u53d6\u968f\u673a\u6570  </p> <pre><code>select rand();\n</code></pre> <p>round\uff1a\u56db\u820d\u4e94\u5165  </p> <pre><code>select round(2.344,2);\n</code></pre> <p>\u6848\u4f8b\uff1a \u901a\u8fc7\u6570\u636e\u5e93\u7684\u51fd\u6570\uff0c\u751f\u6210\u4e00\u4e2a\u516d\u4f4d\u6570\u7684\u968f\u673a\u9a8c\u8bc1\u7801\u3002 \u601d\u8def\uff1a \u83b7\u53d6\u968f\u673a\u6570\u53ef\u4ee5\u901a\u8fc7rand()\u51fd\u6570\uff0c\u4f46\u662f\u83b7\u53d6\u51fa\u6765\u7684\u968f\u673a\u6570\u662f\u57280-1\u4e4b\u95f4\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728\u5176\u57fa\u7840 \u4e0a\u4e58\u4ee51000000\uff0c\u7136\u540e\u820d\u5f03\u5c0f\u6570\u90e8\u5206\uff0c\u5982\u679c\u957f\u5ea6\u4e0d\u8db36\u4f4d\uff0c\u88650  </p> <pre><code>select lpad(round(rand()*1000000 , 0), 6, '0');\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_18","title":"\u65e5\u671f\u51fd\u6570","text":"<p>\u5e38\u89c1\u7684\u65e5\u671f\u51fd\u6570\u5982\u4e0b\uff1a  </p> \u51fd\u6570 \u529f\u80fd CURDATE() \u8fd4\u56de\u5f53\u524d\u65e5\u671f CURTIME() \u8fd4\u56de\u5f53\u524d\u65f6\u95f4 NOW() \u8fd4\u56de\u5f53\u524d\u65e5\u671f\u548c\u65f6\u95f4 YEAR(date) \u83b7\u53d6\u6307\u5b9adate\u7684\u5e74\u4efd MONTH(date) \u83b7\u53d6\u6307\u5b9adate\u7684\u6708\u4efd DAY(date) \u83b7\u53d6\u6307\u5b9adate\u7684\u65e5\u671f DATE_ADD(date, INTERVAL expr type) \u8fd4\u56de\u4e00\u4e2a\u65e5\u671f/\u65f6\u95f4\u503c\u52a0\u4e0a\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694expr\u540e\u7684 \u65f6\u95f4\u503c DATEDIFF(date1,date2) \u8fd4\u56de\u8d77\u59cb\u65f6\u95f4date1 \u548c \u7ed3\u675f\u65f6\u95f4date2\u4e4b\u95f4\u7684\u5929 \u6570 <p>\u6f14\u793a\u5982\u4e0b\uff1a  </p> <p>curdate\uff1a\u5f53\u524d\u65e5\u671f  </p> <pre><code>select curdate();\n</code></pre> <p>curtime\uff1a\u5f53\u524d\u65f6\u95f4  </p> <pre><code>select curtime();\n</code></pre> <p>now\uff1a\u5f53\u524d\u65e5\u671f\u548c\u65f6\u95f4  </p> <pre><code>select now();\n</code></pre> <p>YEAR , MONTH , DAY\uff1a\u5f53\u524d\u5e74\u3001\u6708\u3001\u65e5  </p> <pre><code>select YEAR(now());\nselect MONTH(now());\nselect DAY(now());\n</code></pre> <p>date_add\uff1a\u589e\u52a0\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694  </p> <pre><code>select date_add(now(), INTERVAL 70 YEAR );\n</code></pre> <p>datediff\uff1a\u83b7\u53d6\u4e24\u4e2a\u65e5\u671f\u76f8\u5dee\u7684\u5929\u6570  </p> <pre><code>select datediff('2021-10-01', '2021-12-01');\n</code></pre> <p>\u6848\u4f8b\uff1a \u67e5\u8be2\u6240\u6709\u5458\u5de5\u7684\u5165\u804c\u5929\u6570\uff0c\u5e76\u6839\u636e\u5165\u804c\u5929\u6570\u5012\u5e8f\u6392\u5e8f\u3002 \u601d\u8def\uff1a \u5165\u804c\u5929\u6570\uff0c\u5c31\u662f\u901a\u8fc7\u5f53\u524d\u65e5\u671f - \u5165\u804c\u65e5\u671f\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528datediff\u51fd\u6570\u6765\u5b8c\u6210\u3002  </p> <pre><code>select name, datediff(curdate(), entrydate) as 'entrydays' from emp order by\nentrydays desc;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_19","title":"\u6d41\u7a0b\u51fd\u6570","text":"<p>\u6d41\u7a0b\u51fd\u6570\u4e5f\u662f\u5f88\u5e38\u7528\u7684\u4e00\u7c7b\u51fd\u6570\uff0c\u53ef\u4ee5\u5728SQL\u8bed\u53e5\u4e2d\u5b9e\u73b0\u6761\u4ef6\u7b5b\u9009\uff0c\u4ece\u800c\u63d0\u9ad8\u8bed\u53e5\u7684\u6548\u7387\u3002  </p> \u51fd\u6570 \u529f\u80fd IF(value , t , f) \u5982\u679cvalue\u4e3atrue\uff0c\u5219\u8fd4\u56det\uff0c\u5426\u5219\u8fd4\u56de f IFNULL(value1 , value2) \u5982\u679cvalue1\u4e0d\u4e3a\u7a7a\uff0c\u8fd4\u56devalue1\uff0c\u5426\u5219 \u8fd4\u56devalue2 CASE WHEN [ val1 ] THEN [res1] ... ELSE [ default ] END \u5982\u679cval1\u4e3atrue\uff0c\u8fd4\u56deres1\uff0c... \u5426 \u5219\u8fd4\u56dedefault\u9ed8\u8ba4\u503c CASE [ expr ] WHEN [ val1 ] THEN [res1] ... ELSE [ default ] END \u5982\u679cexpr\u7684\u503c\u7b49\u4e8eval1\uff0c\u8fd4\u56de res1\uff0c... \u5426\u5219\u8fd4\u56dedefault\u9ed8\u8ba4\u503c <p>\u6f14\u793a\u5982\u4e0b\uff1a  </p> <p>if  </p> <pre><code>select if(false, 'Ok', 'Error');\n</code></pre> <p>ifnull  </p> <pre><code>select ifnull('Ok','Default');\nselect ifnull('','Default');\nselect ifnull(null,'Default');\n</code></pre> <p>case when then else end  </p> <p>\u9700\u6c42: \u67e5\u8be2emp\u8868\u7684\u5458\u5de5\u59d3\u540d\u548c\u5de5\u4f5c\u5730\u5740 (\u5317\u4eac/\u4e0a\u6d77 ----&gt; \u4e00\u7ebf\u57ce\u5e02 , \u5176\u4ed6 ----&gt; \u4e8c\u7ebf\u57ce\u5e02)  </p> <pre><code>select\nname,\n( case workaddress when '\u5317\u4eac' then '\u4e00\u7ebf\u57ce\u5e02' when '\u4e0a\u6d77' then '\u4e00\u7ebf\u57ce\u5e02' else\n'\u4e8c\u7ebf\u57ce\u5e02' end ) as '\u5de5\u4f5c\u5730\u5740'\nfrom emp;\n</code></pre> <p>\u6848\u4f8b  </p> <pre><code>create table score(\nid int comment 'ID',\nname varchar(20) comment '\u59d3\u540d',\nmath int comment '\u6570\u5b66',\nenglish int comment '\u82f1\u8bed',\nchinese int comment '\u8bed\u6587'\n) comment '\u5b66\u5458\u6210\u7ee9\u8868';\ninsert into score(id, name, math, english, chinese) VALUES (1, 'Tom', 67, 88, 95\n), (2, 'Rose' , 23, 66, 90),(3, 'Jack', 56, 98, 76);\n</code></pre> <p>\u5177\u4f53\u7684SQL\u8bed\u53e5\u5982\u4e0b:  </p> <pre><code>select\nid,\nname,\n(case when math &gt;= 85 then '\u4f18\u79c0' when math &gt;=60 then '\u53ca\u683c' else '\u4e0d\u53ca\u683c' end )\n'\u6570\u5b66',\n(case when english &gt;= 85 then '\u4f18\u79c0' when english &gt;=60 then '\u53ca\u683c' else '\u4e0d\u53ca\u683c'\nend ) '\u82f1\u8bed',\n(case when chinese &gt;= 85 then '\u4f18\u79c0' when chinese &gt;=60 then '\u53ca\u683c' else '\u4e0d\u53ca\u683c'\nend ) '\u8bed\u6587'\nfrom score;\n</code></pre> <p>MySQL\u7684\u5e38\u89c1\u51fd\u6570\u6211\u4eec\u5b66\u4e60\u5b8c\u4e86\uff0c\u90a3\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u6765\u5206\u6790\u4e00\u4e0b\uff0c\u5728\u524d\u9762\u8bb2\u5230\u7684\u4e24\u4e2a\u51fd\u6570\u7684\u6848\u4f8b\u573a\u666f\uff0c \u601d\u8003\u4e00\u4e0b\u9700\u8981\u7528\u5230\u4ec0\u4e48\u6837\u7684\u51fd\u6570\u6765\u5b9e\u73b0? 1). \u6570\u636e\u5e93\u4e2d\uff0c\u5b58\u50a8\u7684\u662f\u5165\u804c\u65e5\u671f\uff0c\u5982 2000-01-01\uff0c\u5982\u4f55\u5feb\u901f\u8ba1\u7b97\u51fa\u5165\u804c\u5929\u6570\u5462\uff1f --------&gt; \u7b54\u6848: datediff 2). \u6570\u636e\u5e93\u4e2d\uff0c\u5b58\u50a8\u7684\u662f\u5b66\u751f\u7684\u5206\u6570\u503c\uff0c\u598298\u300175\uff0c\u5982\u4f55\u5feb\u901f\u5224\u5b9a\u5206\u6570\u7684\u7b49\u7ea7\u5462\uff1f ----------&gt; \u7b54\u6848: case ... when ...  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_20","title":"\u7ea6\u675f","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_21","title":"\u6982\u8ff0","text":"<p>\u6982\u5ff5\uff1a\u7ea6\u675f\u662f\u4f5c\u7528\u4e8e\u8868\u4e2d\u5b57\u6bb5\u4e0a\u7684\u89c4\u5219\uff0c\u7528\u4e8e\u9650\u5236\u5b58\u50a8\u5728\u8868\u4e2d\u7684\u6570\u636e\u3002 \u76ee\u7684\uff1a\u4fdd\u8bc1\u6570\u636e\u5e93\u4e2d\u6570\u636e\u7684\u6b63\u786e\u3001\u6709\u6548\u6027\u548c\u5b8c\u6574\u6027\u3002 \u5206\u7c7b:  </p> \u7ea6\u675f \u63cf\u8ff0 \u5173\u952e\u5b57 \u975e\u7a7a\u7ea6\u675f \u9650\u5236\u8be5\u5b57\u6bb5\u7684\u6570\u636e\u4e0d\u80fd\u4e3anull NOT NULL \u552f\u4e00\u7ea6\u675f \u4fdd\u8bc1\u8be5\u5b57\u6bb5\u7684\u6240\u6709\u6570\u636e\u90fd\u662f\u552f\u4e00\u3001\u4e0d\u91cd\u590d\u7684 UNIQUE \u4e3b\u952e\u7ea6\u675f \u4e3b\u952e\u662f\u4e00\u884c\u6570\u636e\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u8981\u6c42\u975e\u7a7a\u4e14\u552f\u4e00 PRIMARY KEY \u9ed8\u8ba4\u7ea6\u675f \u4fdd\u5b58\u6570\u636e\u65f6\uff0c\u5982\u679c\u672a\u6307\u5b9a\u8be5\u5b57\u6bb5\u7684\u503c\uff0c\u5219\u91c7\u7528\u9ed8\u8ba4\u503c DEFAULT \u68c0\u67e5\u7ea6\u675f(8.0.16\u7248\u672c \u4e4b\u540e) \u4fdd\u8bc1\u5b57\u6bb5\u503c\u6ee1\u8db3\u67d0\u4e00\u4e2a\u6761\u4ef6 CHECK \u5916\u952e\u7ea6\u675f \u7528\u6765\u8ba9\u4e24\u5f20\u8868\u7684\u6570\u636e\u4e4b\u95f4\u5efa\u7acb\u8fde\u63a5\uff0c\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4 \u6027\u548c\u5b8c\u6574\u6027 FOREIGN KEY <p>\u6ce8\u610f\uff1a\u7ea6\u675f\u662f\u4f5c\u7528\u4e8e\u8868\u4e2d\u5b57\u6bb5\u4e0a\u7684\uff0c\u53ef\u4ee5\u5728\u521b\u5efa\u8868/\u4fee\u6539\u8868\u7684\u65f6\u5019\u6dfb\u52a0\u7ea6\u675f\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_22","title":"\u7ea6\u675f\u6f14\u793a","text":"<p>\u4e0a\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86\u6570\u636e\u5e93\u4e2d\u5e38\u89c1\u7684\u7ea6\u675f\uff0c\u4ee5\u53ca\u7ea6\u675f\u6d89\u53ca\u5230\u7684\u5173\u952e\u5b57\uff0c\u90a3\u8fd9\u4e9b\u7ea6\u675f\u6211\u4eec\u5230\u5e95\u5982\u4f55\u5728\u521b\u5efa\u8868\u3001 \u4fee\u6539\u8868\u7684\u65f6\u5019\u6765\u6307\u5b9a\u5462\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u901a\u8fc7\u4e00\u4e2a\u6848\u4f8b\uff0c\u6765\u6f14\u793a\u4e00\u4e0b\u3002 \u6848\u4f8b\u9700\u6c42\uff1a \u6839\u636e\u9700\u6c42\uff0c\u5b8c\u6210\u8868\u7ed3\u6784\u7684\u521b\u5efa\u3002\u9700\u6c42\u5982\u4e0b\uff1a  </p> \u5b57\u6bb5\u540d \u5b57\u6bb5\u542b \u4e49 \u5b57\u6bb5\u7c7b\u578b \u7ea6\u675f\u6761\u4ef6 \u7ea6\u675f\u5173\u952e\u5b57 id ID\u552f\u4e00 \u6807\u8bc6 int \u4e3b\u952e\uff0c\u5e76\u4e14\u81ea\u52a8\u589e\u957f PRIMARY KEY, AUTO_INCREMENT name \u59d3\u540d varchar(10) \u4e0d\u4e3a\u7a7a\uff0c\u5e76\u4e14\u552f\u4e00 NOT NULL , UNIQUE age \u5e74\u9f84 int \u5927\u4e8e0\uff0c\u5e76\u4e14\u5c0f\u4e8e\u7b49 \u4e8e120 CHECK status \u72b6\u6001 char(1) \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u8be5\u503c\uff0c \u9ed8\u8ba4\u4e3a1 DEFAULT gender \u6027\u522b char(1) \u65e0 <p>\u5bf9\u5e94\u7684\u5efa\u8868\u8bed\u53e5\u4e3a\uff1a  </p> <pre><code>CREATE TABLE tb_user(\nid int AUTO_INCREMENT PRIMARY KEY COMMENT 'ID\u552f\u4e00\u6807\u8bc6',\nname varchar(10) NOT NULL UNIQUE COMMENT '\u59d3\u540d' ,\nage int check (age &gt; 0 &amp;&amp; age &lt;= 120) COMMENT '\u5e74\u9f84' ,\nstatus char(1) default '1' COMMENT '\u72b6\u6001',\ngender char(1) COMMENT '\u6027\u522b'\n);\n</code></pre> <p>\u5728\u4e3a\u5b57\u6bb5\u6dfb\u52a0\u7ea6\u675f\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u5b57\u6bb5\u4e4b\u540e\u52a0\u4e0a\u7ea6\u675f\u7684\u5173\u952e\u5b57\u5373\u53ef\uff0c\u9700\u8981\u5173\u6ce8\u5176\u8bed\u6cd5\u3002\u6211\u4eec\u6267\u884c\u4e0a\u9762 \u7684SQL\u628a\u8868\u7ed3\u6784\u521b\u5efa\u5b8c\u6210\uff0c\u7136\u540e\u63a5\u4e0b\u6765\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e00\u7ec4\u6570\u636e\u8fdb\u884c\u6d4b\u8bd5\uff0c\u4ece\u800c\u9a8c\u8bc1\u4e00\u4e0b\uff0c\u7ea6\u675f\u662f\u5426\u53ef\u4ee5 \u751f\u6548\u3002  </p> <pre><code>insert into tb_user(name,age,status,gender) values ('Tom1',19,'1','\u7537'),\n('Tom2',25,'0','\u7537');\ninsert into tb_user(name,age,status,gender) values ('Tom3',19,'1','\u7537');\ninsert into tb_user(name,age,status,gender) values (null,19,'1','\u7537');\ninsert into tb_user(name,age,status,gender) values ('Tom3',19,'1','\u7537');\ninsert into tb_user(name,age,status,gender) values ('Tom4',80,'1','\u7537');\ninsert into tb_user(name,age,status,gender) values ('Tom5',-1,'1','\u7537');\ninsert into tb_user(name,age,status,gender) values ('Tom5',121,'1','\u7537');\ninsert into tb_user(name,age,gender) values ('Tom5',120,'\u7537');\n</code></pre> <p>\u4e0a\u9762\uff0c\u6211\u4eec\u662f\u901a\u8fc7\u7f16\u5199SQL\u8bed\u53e5\u7684\u5f62\u5f0f\u6765\u5b8c\u6210\u7ea6\u675f\u7684\u6307\u5b9a\uff0c\u90a3\u52a0\u5165\u6211\u4eec\u662f\u901a\u8fc7\u56fe\u5f62\u5316\u754c\u9762\u6765\u521b\u5efa\u8868\u7ed3\u6784 \u65f6\uff0c\u53c8\u8be5\u5982\u4f55\u6765\u6307\u5b9a\u7ea6\u675f\u5462\uff1f \u53ea\u9700\u8981\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\uff0c\u6839\u636e\u6211\u4eec\u7684\u9700\u8981\u9009\u62e9\u5bf9\u5e94\u7684\u7ea6\u675f\u5373\u53ef\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_23","title":"\u5916\u952e\u7ea6\u675f","text":"<p>\u4ecb\u7ecd  </p> <p>\u5916\u952e\uff1a\u7528\u6765\u8ba9\u4e24\u5f20\u8868\u7684\u6570\u636e\u4e4b\u95f4\u5efa\u7acb\u8fde\u63a5\uff0c\u4ece\u800c\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u3002 \u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50\uff1a  </p> <p></p> <p>\u5de6\u4fa7\u7684emp\u8868\u662f\u5458\u5de5\u8868\uff0c\u91cc\u9762\u5b58\u50a8\u5458\u5de5\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u5305\u542b\u5458\u5de5\u7684ID\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3001\u804c\u4f4d\u3001\u85aa\u8d44\u3001\u5165\u804c\u65e5 \u671f\u3001\u4e0a\u7ea7\u4e3b\u7ba1ID\u3001\u90e8\u95e8ID\uff0c\u5728\u5458\u5de5\u7684\u4fe1\u606f\u4e2d\u5b58\u50a8\u7684\u662f\u90e8\u95e8\u7684ID dept_id\uff0c\u800c\u8fd9\u4e2a\u90e8\u95e8\u7684ID\u662f\u5173\u8054\u7684 \u90e8\u95e8\u8868dept\u7684\u4e3b\u952eid\uff0c\u90a3emp\u8868\u7684dept_id\u5c31\u662f\u5916\u952e,\u5173\u8054\u7684\u662f\u53e6\u4e00\u5f20\u8868\u7684\u4e3b\u952e\u3002  </p> <p>\u6ce8\u610f\uff1a\u76ee\u524d\u4e0a\u8ff0\u4e24\u5f20\u8868\uff0c\u53ea\u662f\u5728\u903b\u8f91\u4e0a\u5b58\u5728\u8fd9\u6837\u4e00\u5c42\u5173\u7cfb\uff1b\u5728\u6570\u636e\u5e93\u5c42\u9762\uff0c\u5e76\u672a\u5efa\u7acb\u5916\u952e\u5173\u8054\uff0c \u6240\u4ee5\u662f\u65e0\u6cd5\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u7684\u3002  </p> <p>\u6ca1\u6709\u6570\u636e\u5e93\u5916\u952e\u5173\u8054\u7684\u60c5\u51b5\u4e0b\uff0c\u80fd\u591f\u4fdd\u8bc1\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u5462\uff0c\u6211\u4eec\u6765\u6d4b\u8bd5\u4e00\u4e0b\u3002  </p> <p>\u51c6\u5907\u6570\u636e  </p> <pre><code>create table dept(\nid int auto_increment comment 'ID' primary key,\nname varchar(50) not null comment '\u90e8\u95e8\u540d\u79f0'\n)comment '\u90e8\u95e8\u8868';\nINSERT INTO dept (id, name) VALUES (1, '\u7814\u53d1\u90e8'), (2, '\u5e02\u573a\u90e8'),(3, '\u8d22\u52a1\u90e8'), (4,\n'\u9500\u552e\u90e8'), (5, '\u603b\u7ecf\u529e');\ncreate table emp(\nid int auto_increment comment 'ID' primary key,\nname varchar(50) not null comment '\u59d3\u540d',\nage int comment '\u5e74\u9f84',\njob varchar(20) comment '\u804c\u4f4d',\nsalary int comment '\u85aa\u8d44',\nentrydate date comment '\u5165\u804c\u65f6\u95f4',\nmanagerid int comment '\u76f4\u5c5e\u9886\u5bfcID',\ndept_id int comment '\u90e8\u95e8ID'\n)comment '\u5458\u5de5\u8868';\nINSERT INTO emp (id, name, age, job,salary, entrydate, managerid, dept_id)\nVALUES\n(1, '\u91d1\u5eb8', 66, '\u603b\u88c1',20000, '2000-01-01', null,5),(2, '\u5f20\u65e0\u5fcc', 20,\n'\u9879\u76ee\u7ecf\u7406',12500, '2005-12-05', 1,1),\n(3, '\u6768\u900d', 33, '\u5f00\u53d1', 8400,'2000-11-03', 2,1),(4, '\u97e6\u4e00\u7b11', 48, '\u5f00\n\u53d1',11000, '2002-02-05', 2,1),\n(5, '\u5e38\u9047\u6625', 43, '\u5f00\u53d1',10500, '2004-09-07', 3,1),(6, '\u5c0f\u662d', 19, '\u7a0b\n\u5e8f\u5458\u9f13\u52b1\u5e08',6600, '2004-10-12', 2,1);\n</code></pre> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e2a\u6d4b\u8bd5\uff0c\u5220\u9664id\u4e3a1\u7684\u90e8\u95e8\u4fe1\u606f\u3002  </p> <p></p> <p>\u7ed3\u679c\uff0c\u6211\u4eec\u770b\u5230\u5220\u9664\u6210\u529f\uff0c\u800c\u5220\u9664\u6210\u529f\u4e4b\u540e\uff0c\u90e8\u95e8\u8868\u4e0d\u5b58\u5728id\u4e3a1\u7684\u90e8\u95e8\uff0c\u800c\u5728emp\u8868\u4e2d\u8fd8\u6709\u5f88\u591a\u7684\u5458 \u5de5\uff0c\u5173\u8054\u7684\u4e3aid\u4e3a1\u7684\u90e8\u95e8\uff0c\u6b64\u65f6\u5c31\u51fa\u73b0\u4e86\u6570\u636e\u7684\u4e0d\u5b8c\u6574\u6027\u3002 \u800c\u8981\u60f3\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5c31\u5f97\u901a\u8fc7\u6570\u636e\u5e93\u7684 \u5916\u952e\u7ea6\u675f\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_24","title":"\u8bed\u6cd5","text":"<p>\u6dfb\u52a0\u5916\u952e  </p> <pre><code>CREATE TABLE \u8868\u540d(\n\u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b,\n...\n[CONSTRAINT] [\u5916\u952e\u540d\u79f0] FOREIGN KEY (\u5916\u952e\u5b57\u6bb5\u540d) REFERENCES \u4e3b\u8868 (\u4e3b\u8868\u5217\u540d)\n);\n</code></pre> <pre><code>ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d\u79f0 FOREIGN KEY (\u5916\u952e\u5b57\u6bb5\u540d)\nREFERENCES \u4e3b\u8868 (\u4e3b\u8868\u5217\u540d) ;\n</code></pre> <p>\u6848\u4f8b: \u4e3aemp\u8868\u7684dept_id\u5b57\u6bb5\u6dfb\u52a0\u5916\u952e\u7ea6\u675f,\u5173\u8054dept\u8868\u7684\u4e3b\u952eid\u3002  </p> <pre><code>alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references\ndept(id);\n</code></pre> <p></p> <p>\u6dfb\u52a0\u4e86\u5916\u952e\u7ea6\u675f\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u5230dept\u8868(\u7236\u8868)\u5220\u9664id\u4e3a1\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u770b\u4e00\u4e0b\u4f1a\u53d1\u751f\u4ec0\u4e48\u73b0\u8c61\u3002 \u6b64\u65f6 \u5c06\u4f1a\u62a5\u9519\uff0c\u4e0d\u80fd\u5220\u9664\u6216\u66f4\u65b0\u7236\u8868\u8bb0\u5f55\uff0c\u56e0\u4e3a\u5b58\u5728\u5916\u952e\u7ea6\u675f\u3002  </p> <p></p> <p>\u5220\u9664\u5916\u952e  </p> <pre><code>ALTER TABLE \u8868\u540d DROP FOREIGN KEY \u5916\u952e\u540d\u79f0;\n</code></pre> <p>\u6848\u4f8b\uff1a \u5220\u9664emp\u8868\u7684\u5916\u952efk_emp_dept_id\u3002  </p> <pre><code>alter table emp drop foreign key fk_emp_dept_id;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_25","title":"\u5220\u9664/\u66f4\u65b0\u884c\u4e3a","text":"<p>\u6dfb\u52a0\u4e86\u5916\u952e\u4e4b\u540e\uff0c\u518d\u5220\u9664\u7236\u8868\u6570\u636e\u65f6\u4ea7\u751f\u7684\u7ea6\u675f\u884c\u4e3a\uff0c\u6211\u4eec\u5c31\u79f0\u4e3a\u5220\u9664/\u66f4\u65b0\u884c\u4e3a\u3002\u5177\u4f53\u7684\u5220\u9664/\u66f4\u65b0\u884c \u4e3a\u6709\u4ee5\u4e0b\u51e0\u79cd:  </p> \u884c\u4e3a \u8bf4\u660e NO ACTION \u5f53\u5728\u7236\u8868\u4e2d\u5220\u9664/\u66f4\u65b0\u5bf9\u5e94\u8bb0\u5f55\u65f6\uff0c\u9996\u5148\u68c0\u67e5\u8be5\u8bb0\u5f55\u662f\u5426\u6709\u5bf9\u5e94\u5916\u952e\uff0c\u5982\u679c\u6709\u5219\u4e0d \u5141\u8bb8\u5220\u9664/\u66f4\u65b0\u3002 (\u4e0e RESTRICT \u4e00\u81f4) \u9ed8\u8ba4\u884c\u4e3a RESTRICT \u5f53\u5728\u7236\u8868\u4e2d\u5220\u9664/\u66f4\u65b0\u5bf9\u5e94\u8bb0\u5f55\u65f6\uff0c\u9996\u5148\u68c0\u67e5\u8be5\u8bb0\u5f55\u662f\u5426\u6709\u5bf9\u5e94\u5916\u952e\uff0c\u5982\u679c\u6709\u5219\u4e0d \u5141\u8bb8\u5220\u9664/\u66f4\u65b0\u3002 (\u4e0e NO ACTION \u4e00\u81f4) \u9ed8\u8ba4\u884c\u4e3a CASCADE \u5f53\u5728\u7236\u8868\u4e2d\u5220\u9664/\u66f4\u65b0\u5bf9\u5e94\u8bb0\u5f55\u65f6\uff0c\u9996\u5148\u68c0\u67e5\u8be5\u8bb0\u5f55\u662f\u5426\u6709\u5bf9\u5e94\u5916\u952e\uff0c\u5982\u679c\u6709\uff0c\u5219 \u4e5f\u5220\u9664/\u66f4\u65b0\u5916\u952e\u5728\u5b50\u8868\u4e2d\u7684\u8bb0\u5f55\u3002 SET NULL \u5f53\u5728\u7236\u8868\u4e2d\u5220\u9664\u5bf9\u5e94\u8bb0\u5f55\u65f6\uff0c\u9996\u5148\u68c0\u67e5\u8be5\u8bb0\u5f55\u662f\u5426\u6709\u5bf9\u5e94\u5916\u952e\uff0c\u5982\u679c\u6709\u5219\u8bbe\u7f6e\u5b50\u8868 \u4e2d\u8be5\u5916\u952e\u503c\u4e3anull\uff08\u8fd9\u5c31\u8981\u6c42\u8be5\u5916\u952e\u5141\u8bb8\u53d6null\uff09\u3002 SET DEFAULT \u7236\u8868\u6709\u53d8\u66f4\u65f6\uff0c\u5b50\u8868\u5c06\u5916\u952e\u5217\u8bbe\u7f6e\u6210\u4e00\u4e2a\u9ed8\u8ba4\u7684\u503c (Innodb\u4e0d\u652f\u6301) <p>\u5177\u4f53\u8bed\u6cd5\u4e3a:  </p> <pre><code>ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d\u79f0 FOREIGN KEY (\u5916\u952e\u5b57\u6bb5) REFERENCES\n\u4e3b\u8868\u540d (\u4e3b\u8868\u5b57\u6bb5\u540d) ON UPDATE CASCADE ON DELETE CASCADE;\n</code></pre> <p>\u6f14\u793a\u5982\u4e0b\uff1a  </p> <p>\u7531\u4e8eNO ACTION \u662f\u9ed8\u8ba4\u884c\u4e3a\uff0c\u6211\u4eec\u524d\u9762\u8bed\u6cd5\u6f14\u793a\u7684\u65f6\u5019\uff0c\u5df2\u7ecf\u6d4b\u8bd5\u8fc7\u4e86\uff0c\u5c31\u4e0d\u518d\u6f14\u793a\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u518d \u6f14\u793a\u5176\u4ed6\u7684\u4e24\u79cd\u884c\u4e3a\uff1aCASCADE\u3001SET NULL\u3002  </p> <p>CASCADE  </p> <pre><code>alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references\ndept(id) on update cascade on delete cascade ;\n</code></pre> <p>\u4fee\u6539\u7236\u8868id\u4e3a1\u7684\u8bb0\u5f55\uff0c\u5c06id\u4fee\u6539\u4e3a6  </p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u539f\u6765\u5728\u5b50\u8868\u4e2ddept_id\u503c\u4e3a1\u7684\u8bb0\u5f55\uff0c\u73b0\u5728\u4e5f\u53d8\u4e3a6\u4e86\uff0c\u8fd9\u5c31\u662fcascade\u7ea7\u8054\u7684\u6548\u679c\u3002  </p> <p>\u5728\u4e00\u822c\u7684\u4e1a\u52a1\u7cfb\u7edf\u4e2d\uff0c\u4e0d\u4f1a\u4fee\u6539\u4e00\u5f20\u8868\u7684\u4e3b\u952e\u503c  </p> <p>\u5220\u9664\u7236\u8868id\u4e3a6\u7684\u8bb0\u5f55  </p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\uff0c\u7236\u8868\u7684\u6570\u636e\u5220\u9664\u6210\u529f\u4e86\uff0c\u4f46\u662f\u5b50\u8868\u4e2d\u5173\u8054\u7684\u8bb0\u5f55\u4e5f\u88ab\u7ea7\u8054\u5220\u9664\u4e86\u3002  </p> <p>SET NULL  </p> <p>\u5728\u8fdb\u884c\u6d4b\u8bd5\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u9700\u8981\u5220\u9664\u4e0a\u9762\u5efa\u7acb\u7684\u5916\u952e fk_emp_dept_id\u3002\u7136\u540e\u518d\u901a\u8fc7\u6570\u636e\u811a\u672c\uff0c\u5c06 emp\u3001dept\u8868\u7684\u6570\u636e\u6062\u590d\u4e86\u3002  </p> <pre><code>alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references\ndept(id) on update set null on delete set null ;\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5220\u9664id\u4e3a1\u7684\u6570\u636e\uff0c\u770b\u770b\u4f1a\u53d1\u751f\u4ec0\u4e48\u6837\u7684\u73b0\u8c61\u3002  </p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\u7236\u8868\u7684\u8bb0\u5f55\u662f\u53ef\u4ee5\u6b63\u5e38\u7684\u5220\u9664\u7684\uff0c\u7236\u8868\u7684\u6570\u636e\u5220\u9664\u4e4b\u540e\uff0c\u518d\u6253\u5f00\u5b50\u8868 emp\uff0c\u6211\u4eec\u53d1\u73b0\u5b50\u8868emp \u7684dept_id\u5b57\u6bb5\uff0c\u539f\u6765dept_id\u4e3a1\u7684\u6570\u636e\uff0c\u73b0\u5728\u90fd\u88ab\u7f6e\u4e3aNULL\u4e86\u3002  </p> <p></p> <p>\u8fd9\u5c31\u662fSET NULL\u8fd9\u79cd\u5220\u9664/\u66f4\u65b0\u884c\u4e3a\u7684\u6548\u679c  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_26","title":"\u591a\u8868\u67e5\u8be2","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_27","title":"\u591a\u8868\u67e5\u8be2","text":"<p>\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u5728\u8fdb\u884c\u6570\u636e\u5e93\u8868\u7ed3\u6784\u8bbe\u8ba1\u65f6\uff0c\u4f1a\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u53ca\u4e1a\u52a1\u6a21\u5757\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5206\u6790\u5e76\u8bbe\u8ba1\u8868\u7ed3 \u6784\uff0c\u7531\u4e8e\u4e1a\u52a1\u4e4b\u95f4\u76f8\u4e92\u5173\u8054\uff0c\u6240\u4ee5\u5404\u4e2a\u8868\u7ed3\u6784\u4e4b\u95f4\u4e5f\u5b58\u5728\u7740\u5404\u79cd\u8054\u7cfb\uff0c\u57fa\u672c\u4e0a\u5206\u4e3a\u4e09\u79cd\uff1a \u4e00\u5bf9\u591a(\u591a\u5bf9\u4e00) \u591a\u5bf9\u591a \u4e00\u5bf9\u4e00  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_28","title":"\u4e00\u5bf9\u591a","text":"<p>\u6848\u4f8b: \u90e8\u95e8 \u4e0e \u5458\u5de5\u7684\u5173\u7cfb \u5173\u7cfb: \u4e00\u4e2a\u90e8\u95e8\u5bf9\u5e94\u591a\u4e2a\u5458\u5de5\uff0c\u4e00\u4e2a\u5458\u5de5\u5bf9\u5e94\u4e00\u4e2a\u90e8\u95e8 \u5b9e\u73b0: \u5728\u591a\u7684\u4e00\u65b9\u5efa\u7acb\u5916\u952e\uff0c\u6307\u5411\u4e00\u7684\u4e00\u65b9\u7684\u4e3b\u952e  </p> <p></p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_29","title":"\u591a\u5bf9\u591a","text":"<p>\u6848\u4f8b: \u5b66\u751f \u4e0e \u8bfe\u7a0b\u7684\u5173\u7cfb \u5173\u7cfb: \u4e00\u4e2a\u5b66\u751f\u53ef\u4ee5\u9009\u4fee\u591a\u95e8\u8bfe\u7a0b\uff0c\u4e00\u95e8\u8bfe\u7a0b\u4e5f\u53ef\u4ee5\u4f9b\u591a\u4e2a\u5b66\u751f\u9009\u62e9 \u5b9e\u73b0: \u5efa\u7acb\u7b2c\u4e09\u5f20\u4e2d\u95f4\u8868\uff0c\u4e2d\u95f4\u8868\u81f3\u5c11\u5305\u542b\u4e24\u4e2a\u5916\u952e\uff0c\u5206\u522b\u5173\u8054\u4e24\u65b9\u4e3b\u952e  </p> <p></p> <p>\u5bf9\u5e94\u7684SQL\u811a\u672c:  </p> <pre><code>create table student(\nid int auto_increment primary key comment '\u4e3b\u952eID',\nname varchar(10) comment '\u59d3\u540d',\nno varchar(10) comment '\u5b66\u53f7'\n) comment '\u5b66\u751f\u8868';\ninsert into student values (null, '\u9edb\u7eee\u4e1d', '2000100101'),(null, '\u8c22\u900a',\n'2000100102'),(null, '\u6bb7\u5929\u6b63', '2000100103'),(null, '\u97e6\u4e00\u7b11', '2000100104');\ncreate table course(\nid int auto_increment primary key comment '\u4e3b\u952eID',\nname varchar(10) comment '\u8bfe\u7a0b\u540d\u79f0'\n) comment '\u8bfe\u7a0b\u8868';\ninsert into course values (null, 'Java'), (null, 'PHP'), (null , 'MySQL') ,\n(null, 'Hadoop');\ncreate table student_course(\nid int auto_increment comment '\u4e3b\u952e' primary key,\nstudentid int not null comment '\u5b66\u751fID',\ncourseid int not null comment '\u8bfe\u7a0bID',\nconstraint fk_courseid foreign key (courseid) references course (id),\nconstraint fk_studentid foreign key (studentid) references student (id)\n)comment '\u5b66\u751f\u8bfe\u7a0b\u4e2d\u95f4\u8868';\ninsert into student_course values (null,1,1),(null,1,2),(null,1,3),(null,2,2),\n(null,2,3),(null,3,4);\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_30","title":"\u4e00\u5bf9\u4e00","text":"<p>\u6848\u4f8b: \u7528\u6237 \u4e0e \u7528\u6237\u8be6\u60c5\u7684\u5173\u7cfb \u5173\u7cfb: \u4e00\u5bf9\u4e00\u5173\u7cfb\uff0c\u591a\u7528\u4e8e\u5355\u8868\u62c6\u5206\uff0c\u5c06\u4e00\u5f20\u8868\u7684\u57fa\u7840\u5b57\u6bb5\u653e\u5728\u4e00\u5f20\u8868\u4e2d\uff0c\u5176\u4ed6\u8be6\u60c5\u5b57\u6bb5\u653e\u5728\u53e6 \u4e00\u5f20\u8868\u4e2d\uff0c\u4ee5\u63d0\u5347\u64cd\u4f5c\u6548\u7387 \u5b9e\u73b0: \u5728\u4efb\u610f\u4e00\u65b9\u52a0\u5165\u5916\u952e\uff0c\u5173\u8054\u53e6\u5916\u4e00\u65b9\u7684\u4e3b\u952e\uff0c\u5e76\u4e14\u8bbe\u7f6e\u5916\u952e\u4e3a\u552f\u4e00\u7684(UNIQUE)  </p> <p></p> <pre><code>create table tb_user(\nid int auto_increment primary key comment '\u4e3b\u952eID',\nname varchar(10) comment '\u59d3\u540d',\nage int comment '\u5e74\u9f84',\ngender char(1) comment '1: \u7537 , 2: \u5973',\nphone char(11) comment '\u624b\u673a\u53f7'\n) comment '\u7528\u6237\u57fa\u672c\u4fe1\u606f\u8868';\ncreate table tb_user_edu(\nid int auto_increment primary key comment '\u4e3b\u952eID',\ndegree varchar(20) comment '\u5b66\u5386',\nmajor varchar(50) comment '\u4e13\u4e1a',\nprimaryschool varchar(50) comment '\u5c0f\u5b66',\nmiddleschool varchar(50) comment '\u4e2d\u5b66',\nuniversity varchar(50) comment '\u5927\u5b66',\nuserid int unique comment '\u7528\u6237ID',\nconstraint fk_userid foreign key (userid) references tb_user(id)\n) comment '\u7528\u6237\u6559\u80b2\u4fe1\u606f\u8868';\ninsert into tb_user(id, name, age, gender, phone) values\n(null,'\u9ec4\u6e24',45,'1','18800001111'),\n(null,'\u51b0\u51b0',35,'2','18800002222'),\n(null,'\u7801\u4e91',55,'1','18800008888'),\n(null,'\u674e\u5f66\u5b8f',50,'1','18800009999');\ninsert into tb_user_edu(id, degree, major, primaryschool, middleschool,\nuniversity, userid) values\n(null,'\u672c\u79d1','\u821e\u8e48','\u9759\u5b89\u533a\u7b2c\u4e00\u5c0f\u5b66','\u9759\u5b89\u533a\u7b2c\u4e00\u4e2d\u5b66','\u5317\u4eac\u821e\u8e48\u5b66\u9662',1),\n(null,'\u7855\u58eb','\u8868\u6f14','\u671d\u9633\u533a\u7b2c\u4e00\u5c0f\u5b66','\u671d\u9633\u533a\u7b2c\u4e00\u4e2d\u5b66','\u5317\u4eac\u7535\u5f71\u5b66\u9662',2),\n(null,'\u672c\u79d1','\u82f1\u8bed','\u676d\u5dde\u5e02\u7b2c\u4e00\u5c0f\u5b66','\u676d\u5dde\u5e02\u7b2c\u4e00\u4e2d\u5b66','\u676d\u5dde\u5e08\u8303\u5927\u5b66',3),\n(null,'\u672c\u79d1','\u5e94\u7528\u6570\u5b66','\u9633\u6cc9\u7b2c\u4e00\u5c0f\u5b66','\u9633\u6cc9\u533a\u7b2c\u4e00\u4e2d\u5b66','\u6e05\u534e\u5927\u5b66',4);\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_31","title":"\u591a\u8868\u67e5\u8be2\u6982\u8ff0","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_32","title":"\u6570\u636e\u51c6\u5907","text":"<p>\u5220\u9664\u4e4b\u524d emp, dept\u8868\u7684\u6d4b\u8bd5\u6570\u636e  </p> <p>\u6267\u884c\u5982\u4e0b\u811a\u672c\uff0c\u521b\u5efaemp\u8868\u4e0edept\u8868\u5e76\u63d2\u5165\u6d4b\u8bd5\u6570\u636e  </p> <pre><code>-- \u521b\u5efadept\u8868\uff0c\u5e76\u63d2\u5165\u6570\u636e\ncreate table dept(\nid int auto_increment comment 'ID' primary key,\nname varchar(50) not null comment '\u90e8\u95e8\u540d\u79f0'\n)comment '\u90e8\u95e8\u8868';\nINSERT INTO dept (id, name) VALUES (1, '\u7814\u53d1\u90e8'), (2, '\u5e02\u573a\u90e8'),(3, '\u8d22\u52a1\u90e8'), (4,\n'\u9500\u552e\u90e8'), (5, '\u603b\u7ecf\u529e'), (6, '\u4eba\u4e8b\u90e8');\n-- \u521b\u5efaemp\u8868\uff0c\u5e76\u63d2\u5165\u6570\u636e\ncreate table emp(\nid int auto_increment comment 'ID' primary key,\ndept\u8868\u51716\u6761\u8bb0\u5f55\uff0cemp\u8868\u517117\u6761\u8bb0\u5f55\u3002\n5.2.2 \u6982\u8ff0\n\u591a\u8868\u67e5\u8be2\u5c31\u662f\u6307\u4ece\u591a\u5f20\u8868\u4e2d\u67e5\u8be2\u6570\u636e\u3002\nname varchar(50) not null comment '\u59d3\u540d',\nage int comment '\u5e74\u9f84',\njob varchar(20) comment '\u804c\u4f4d',\nsalary int comment '\u85aa\u8d44',\nentrydate date comment '\u5165\u804c\u65f6\u95f4',\nmanagerid int comment '\u76f4\u5c5e\u9886\u5bfcID',\ndept_id int comment '\u90e8\u95e8ID'\n)comment '\u5458\u5de5\u8868';\n-- \u6dfb\u52a0\u5916\u952e\nalter table emp add constraint fk_emp_dept_id foreign key (dept_id) references\ndept(id);\nINSERT INTO emp (id, name, age, job,salary, entrydate, managerid, dept_id)\nVALUES\n(1, '\u91d1\u5eb8', 66, '\u603b\u88c1',20000, '2000-01-01', null,5),\n(2, '\u5f20\u65e0\u5fcc', 20, '\u9879\u76ee\u7ecf\u7406',12500, '2005-12-05', 1,1),\n(3, '\u6768\u900d', 33, '\u5f00\u53d1', 8400,'2000-11-03', 2,1),\n(4, '\u97e6\u4e00\u7b11', 48, '\u5f00\u53d1',11000, '2002-02-05', 2,1),\n(5, '\u5e38\u9047\u6625', 43, '\u5f00\u53d1',10500, '2004-09-07', 3,1),\n(6, '\u5c0f\u662d', 19, '\u7a0b\u5e8f\u5458\u9f13\u52b1\u5e08',6600, '2004-10-12', 2,1),\n(7, '\u706d\u7edd', 60, '\u8d22\u52a1\u603b\u76d1',8500, '2002-09-12', 1,3),\n(8, '\u5468\u82b7\u82e5', 19, '\u4f1a\u8ba1',48000, '2006-06-02', 7,3),\n(9, '\u4e01\u654f\u541b', 23, '\u51fa\u7eb3',5250, '2009-05-13', 7,3),\n(10, '\u8d75\u654f', 20, '\u5e02\u573a\u90e8\u603b\u76d1',12500, '2004-10-12', 1,2),\n(11, '\u9e7f\u6756\u5ba2', 56, '\u804c\u5458',3750, '2006-10-03', 10,2),\n(12, '\u9e64\u7b14\u7fc1', 19, '\u804c\u5458',3750, '2007-05-09', 10,2),\n(13, '\u65b9\u4e1c\u767d', 19, '\u804c\u5458',5500, '2009-02-12', 10,2),\n(14, '\u5f20\u4e09\u4e30', 88, '\u9500\u552e\u603b\u76d1',14000, '2004-10-12', 1,4),\n(15, '\u4fde\u83b2\u821f', 38, '\u9500\u552e',4600, '2004-10-12', 14,4),\n(16, '\u5b8b\u8fdc\u6865', 40, '\u9500\u552e',4600, '2004-10-12', 14,4),\n(17, '\u9648\u53cb\u8c05', 42, null,2000, '2011-10-12', 1,null);\n</code></pre> <p>dept\u8868\u51716\u6761\u8bb0\u5f55\uff0cemp\u8868\u517117\u6761\u8bb0\u5f55\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_33","title":"\u6982\u8ff0","text":"<p>\u591a\u8868\u67e5\u8be2\u5c31\u662f\u6307\u4ece\u591a\u5f20\u8868\u4e2d\u67e5\u8be2\u6570\u636e\u3002  </p> <p>\u539f\u6765\u67e5\u8be2\u5355\u8868\u6570\u636e\uff0c\u6267\u884c\u7684SQL\u5f62\u5f0f\u4e3a\uff1aselect * from emp;  </p> <p>\u90a3\u4e48\u6211\u4eec\u8981\u6267\u884c\u591a\u8868\u67e5\u8be2\uff0c\u5c31\u53ea\u9700\u8981\u4f7f\u7528\u9017\u53f7\u5206\u9694\u591a\u5f20\u8868\u5373\u53ef\uff0c\u5982\uff1a select * from emp , dept \u5177\u4f53\u7684\u6267\u884c\u7ed3\u679c\u5982\u4e0b:  </p> <p></p> <p>\u6b64\u65f6,\u6211\u4eec\u770b\u5230\u67e5\u8be2\u7ed3\u679c\u4e2d\u5305\u542b\u4e86\u5927\u91cf\u7684\u7ed3\u679c\u96c6\uff0c\u603b\u5171102\u6761\u8bb0\u5f55\uff0c\u800c\u8fd9\u5176\u5b9e\u5c31\u662f\u5458\u5de5\u8868emp\u6240\u6709\u7684\u8bb0\u5f55 (17) \u4e0e \u90e8\u95e8\u8868dept\u6240\u6709\u8bb0\u5f55(6) \u7684\u6240\u6709\u7ec4\u5408\u60c5\u51b5\uff0c\u8fd9\u79cd\u73b0\u8c61\u79f0\u4e4b\u4e3a\u7b1b\u5361\u5c14\u79ef\u3002\u63a5\u4e0b\u6765\uff0c\u5c31\u6765\u7b80\u5355 \u4ecb\u7ecd\u4e0b\u7b1b\u5361\u5c14\u79ef\u3002 \u7b1b\u5361\u5c14\u79ef: \u7b1b\u5361\u5c14\u4e58\u79ef\u662f\u6307\u5728\u6570\u5b66\u4e2d\uff0c\u4e24\u4e2a\u96c6\u5408A\u96c6\u5408 \u548c B\u96c6\u5408\u7684\u6240\u6709\u7ec4\u5408\u60c5\u51b5\u3002  </p> <p></p> <p>\u800c\u5728\u591a\u8868\u67e5\u8be2\u4e2d\uff0c\u6211\u4eec\u662f\u9700\u8981\u6d88\u9664\u65e0\u6548\u7684\u7b1b\u5361\u5c14\u79ef\u7684\uff0c\u53ea\u4fdd\u7559\u4e24\u5f20\u8868\u5173\u8054\u90e8\u5206\u7684\u6570\u636e\u3002  </p> <p></p> <p></p> <p>\u5728SQL\u8bed\u53e5\u4e2d\uff0c\u5982\u4f55\u6765\u53bb\u9664\u65e0\u6548\u7684\u7b1b\u5361\u5c14\u79ef\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u7ed9\u591a\u8868\u67e5\u8be2\u52a0\u4e0a\u8fde\u63a5\u67e5\u8be2\u7684\u6761\u4ef6\u5373\u53ef\u3002  </p> <pre><code>select * from emp , dept where emp.dept_id = dept.id;\n</code></pre> <p></p> <p>\u800c\u7531\u4e8eid\u4e3a17\u7684\u5458\u5de5\uff0c\u6ca1\u6709dept_id\u5b57\u6bb5\u503c\uff0c\u6240\u4ee5\u5728\u591a\u8868\u67e5\u8be2\u65f6\uff0c\u6839\u636e\u8fde\u63a5\u67e5\u8be2\u7684\u6761\u4ef6\u5e76\u6ca1\u6709\u67e5\u8be2 \u5230\u3002  </p> <p>\u5206\u7c7b  </p> <p>\u8fde\u63a5\u67e5\u8be2 \u5185\u8fde\u63a5\uff1a\u76f8\u5f53\u4e8e\u67e5\u8be2A\u3001B\u4ea4\u96c6\u90e8\u5206\u6570\u636e \u5916\u8fde\u63a5\uff1a \u5de6\u5916\u8fde\u63a5\uff1a\u67e5\u8be2\u5de6\u8868\u6240\u6709\u6570\u636e\uff0c\u4ee5\u53ca\u4e24\u5f20\u8868\u4ea4\u96c6\u90e8\u5206\u6570\u636e \u53f3\u5916\u8fde\u63a5\uff1a\u67e5\u8be2\u53f3\u8868\u6240\u6709\u6570\u636e\uff0c\u4ee5\u53ca\u4e24\u5f20\u8868\u4ea4\u96c6\u90e8\u5206\u6570\u636e \u81ea\u8fde\u63a5\uff1a\u5f53\u524d\u8868\u4e0e\u81ea\u8eab\u7684\u8fde\u63a5\u67e5\u8be2\uff0c\u81ea\u8fde\u63a5\u5fc5\u987b\u4f7f\u7528\u8868\u522b\u540d  </p> <p>\u5b50\u67e5\u8be2 </p> <p></p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_34","title":"\u5185\u8fde\u63a5","text":"<p>\u9690\u5f0f\u5185\u8fde\u63a5  </p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 , \u88682 WHERE \u6761\u4ef6 ... ;\n</code></pre> <p>\u663e\u5f0f\u5185\u8fde\u63a5  </p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 [ INNER ] JOIN \u88682 ON \u8fde\u63a5\u6761\u4ef6 ... ;\n</code></pre> <p>\u6848\u4f8b: A. \u67e5\u8be2\u6bcf\u4e00\u4e2a\u5458\u5de5\u7684\u59d3\u540d , \u53ca\u5173\u8054\u7684\u90e8\u95e8\u7684\u540d\u79f0 (\u9690\u5f0f\u5185\u8fde\u63a5\u5b9e\u73b0) \u8868\u7ed3\u6784: emp , dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select emp.name , dept.name from emp , dept where emp.dept_id = dept.id ;\n-- \u4e3a\u6bcf\u4e00\u5f20\u8868\u8d77\u522b\u540d,\u7b80\u5316SQL\u7f16\u5199\nselect e.name,d.name from emp e , dept d where e.dept_id = d.id;\n</code></pre> <p>B. \u67e5\u8be2\u6bcf\u4e00\u4e2a\u5458\u5de5\u7684\u59d3\u540d , \u53ca\u5173\u8054\u7684\u90e8\u95e8\u7684\u540d\u79f0 (\u663e\u5f0f\u5185\u8fde\u63a5\u5b9e\u73b0) --- INNER JOIN ... ON ... \u8868\u7ed3\u6784: emp , dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select e.name, d.name from emp e inner join dept d on e.dept_id = d.id;\n-- \u4e3a\u6bcf\u4e00\u5f20\u8868\u8d77\u522b\u540d,\u7b80\u5316SQL\u7f16\u5199\nselect e.name, d.name from emp e join dept d on e.dept_id = d.id;\n</code></pre> <p>\u8868\u7684\u522b\u540d: \u2460. tablea as \u522b\u540d1 , tableb as \u522b\u540d2 ; \u2461. tablea \u522b\u540d1 , tableb \u522b\u540d2 ;  </p> <p>\u6ce8\u610f\u4e8b\u9879:  \u4e00\u65e6\u4e3a\u8868\u8d77\u4e86\u522b\u540d\uff0c\u5c31\u4e0d\u80fd\u518d\u4f7f\u7528\u8868\u540d\u6765\u6307\u5b9a\u5bf9\u5e94\u7684\u5b57\u6bb5\u4e86\uff0c\u6b64\u65f6\u53ea\u80fd\u591f\u4f7f\u7528\u522b\u540d\u6765\u6307\u5b9a\u5b57 \u6bb5  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_35","title":"\u5916\u8fde\u63a5","text":"<p>\u5de6\u5916\u8fde\u63a5  </p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 LEFT [ OUTER ] JOIN \u88682 ON \u6761\u4ef6 ... ;\n</code></pre> <p>\u5de6\u5916\u8fde\u63a5\u76f8\u5f53\u4e8e\u67e5\u8be2\u88681(\u5de6\u8868)\u7684\u6240\u6709\u6570\u636e\uff0c\u5f53\u7136\u4e5f\u5305\u542b\u88681\u548c\u88682\u4ea4\u96c6\u90e8\u5206\u7684\u6570\u636e\u3002  </p> <p>\u53f3\u5916\u8fde\u63a5  </p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 RIGHT [ OUTER ] JOIN \u88682 ON \u6761\u4ef6 ... ;\n</code></pre> <p>\u53f3\u5916\u8fde\u63a5\u76f8\u5f53\u4e8e\u67e5\u8be2\u88682(\u53f3\u8868)\u7684\u6240\u6709\u6570\u636e\uff0c\u5f53\u7136\u4e5f\u5305\u542b\u88681\u548c\u88682\u4ea4\u96c6\u90e8\u5206\u7684\u6570\u636e\u3002  </p> <p>\u6848\u4f8b:  </p> <p>A. \u67e5\u8be2emp\u8868\u7684\u6240\u6709\u6570\u636e, \u548c\u5bf9\u5e94\u7684\u90e8\u95e8\u4fe1\u606f \u7531\u4e8e\u9700\u6c42\u4e2d\u63d0\u5230\uff0c\u8981\u67e5\u8be2emp\u7684\u6240\u6709\u6570\u636e\uff0c\u6240\u4ee5\u662f\u4e0d\u80fd\u5185\u8fde\u63a5\u67e5\u8be2\u7684\uff0c\u9700\u8981\u8003\u8651\u4f7f\u7528\u5916\u8fde\u63a5\u67e5\u8be2\u3002 \u8868\u7ed3\u6784: emp, dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select e.*, d.name from emp e left outer join dept d on e.dept_id = d.id;\nselect e.*, d.name from emp e left join dept d on e.dept_id = d.id;\n</code></pre> <p>B. \u67e5\u8be2dept\u8868\u7684\u6240\u6709\u6570\u636e, \u548c\u5bf9\u5e94\u7684\u5458\u5de5\u4fe1\u606f(\u53f3\u5916\u8fde\u63a5)  </p> <p>\u7531\u4e8e\u9700\u6c42\u4e2d\u63d0\u5230\uff0c\u8981\u67e5\u8be2dept\u8868\u7684\u6240\u6709\u6570\u636e\uff0c\u6240\u4ee5\u662f\u4e0d\u80fd\u5185\u8fde\u63a5\u67e5\u8be2\u7684\uff0c\u9700\u8981\u8003\u8651\u4f7f\u7528\u5916\u8fde\u63a5\u67e5 \u8be2\u3002 \u8868\u7ed3\u6784: emp, dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select d.*, e.* from emp e right outer join dept d on e.dept_id = d.id;\nselect d.*, e.* from dept d left outer join emp e on e.dept_id = d.id;\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879\uff1a \u5de6\u5916\u8fde\u63a5\u548c\u53f3\u5916\u8fde\u63a5\u662f\u53ef\u4ee5\u76f8\u4e92\u66ff\u6362\u7684\uff0c\u53ea\u9700\u8981\u8c03\u6574\u5728\u8fde\u63a5\u67e5\u8be2\u65f6SQL\u4e2d\uff0c\u8868\u7ed3\u6784\u7684\u5148\u540e\u987a \u5e8f\u5c31\u53ef\u4ee5\u4e86\u3002\u800c\u6211\u4eec\u5728\u65e5\u5e38\u5f00\u53d1\u4f7f\u7528\u65f6\uff0c\u66f4\u504f\u5411\u4e8e\u5de6\u5916\u8fde\u63a5\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_36","title":"\u81ea\u8fde\u63a5","text":"<p>\u81ea\u8fde\u63a5\u67e5\u8be2\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u81ea\u5df1\u8fde\u63a5\u81ea\u5df1\uff0c\u4e5f\u5c31\u662f\u628a\u4e00\u5f20\u8868\u8fde\u63a5\u67e5\u8be2\u591a\u6b21\u3002\u6211\u4eec\u5148\u6765\u5b66\u4e60\u4e00\u4e0b\u81ea\u8fde\u63a5 \u7684\u67e5\u8be2\u8bed\u6cd5  </p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868A \u522b\u540dA JOIN \u8868A \u522b\u540dB ON \u6761\u4ef6 ... ;\n</code></pre> <p>\u800c\u5bf9\u4e8e\u81ea\u8fde\u63a5\u67e5\u8be2\uff0c\u53ef\u4ee5\u662f\u5185\u8fde\u63a5\u67e5\u8be2\uff0c\u4e5f\u53ef\u4ee5\u662f\u5916\u8fde\u63a5\u67e5\u8be2  </p> <p>\u6848\u4f8b\uff1a A. \u67e5\u8be2\u5458\u5de5 \u53ca\u5176 \u6240\u5c5e\u9886\u5bfc\u7684\u540d\u5b57 \u8868\u7ed3\u6784: emp  </p> <pre><code>select a.name , b.name from emp a , emp b where a.managerid = b.id;\n</code></pre> <p>B. \u67e5\u8be2\u6240\u6709\u5458\u5de5 emp \u53ca\u5176\u9886\u5bfc\u7684\u540d\u5b57 emp , \u5982\u679c\u5458\u5de5\u6ca1\u6709\u9886\u5bfc, \u4e5f\u9700\u8981\u67e5\u8be2\u51fa\u6765 \u8868\u7ed3\u6784: emp a , emp b  </p> <pre><code>select a.name '\u5458\u5de5', b.name '\u9886\u5bfc' from emp a left join emp b on a.managerid =\nb.id;\n</code></pre> <p>\u6ce8\u610f\u4e8b\u9879: \u5728\u81ea\u8fde\u63a5\u67e5\u8be2\u4e2d\uff0c\u5fc5\u987b\u8981\u4e3a\u8868\u8d77\u522b\u540d\uff0c\u8981\u4e0d\u7136\u6211\u4eec\u4e0d\u6e05\u695a\u6240\u6307\u5b9a\u7684\u6761\u4ef6\u3001\u8fd4\u56de\u7684\u5b57\u6bb5\uff0c\u5230\u5e95 \u662f\u54ea\u4e00\u5f20\u8868\u7684\u5b57\u6bb5\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_37","title":"\u8054\u5408\u67e5\u8be2","text":"<p>\u5bf9\u4e8eunion\u67e5\u8be2\uff0c\u5c31\u662f\u628a\u591a\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u5408\u5e76\u8d77\u6765\uff0c\u5f62\u6210\u4e00\u4e2a\u65b0\u7684\u67e5\u8be2\u7ed3\u679c\u96c6\u3002  </p> <pre><code>SELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868A ...\nUNION [ ALL ]\nSELECT \u5b57\u6bb5\u5217\u8868 FROM \u8868B ....;  \n</code></pre> <p>\u5bf9\u4e8e\u8054\u5408\u67e5\u8be2\u7684\u591a\u5f20\u8868\u7684\u5217\u6570\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\uff0c\u5b57\u6bb5\u7c7b\u578b\u4e5f\u9700\u8981\u4fdd\u6301\u4e00\u81f4\u3002 union all \u4f1a\u5c06\u5168\u90e8\u7684\u6570\u636e\u76f4\u63a5\u5408\u5e76\u5728\u4e00\u8d77\uff0cunion \u4f1a\u5bf9\u5408\u5e76\u4e4b\u540e\u7684\u6570\u636e\u53bb\u91cd\u3002  </p> <p>\u6848\u4f8b: A. \u5c06\u85aa\u8d44\u4f4e\u4e8e 5000 \u7684\u5458\u5de5 , \u548c \u5e74\u9f84\u5927\u4e8e 50 \u5c81\u7684\u5458\u5de5\u5168\u90e8\u67e5\u8be2\u51fa\u6765. \u5f53\u524d\u5bf9\u4e8e\u8fd9\u4e2a\u9700\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u591a\u6761\u4ef6\u67e5\u8be2\uff0c\u4f7f\u7528\u903b\u8f91\u8fd0\u7b97\u7b26 or \u8fde\u63a5\u5373\u53ef\u3002 \u90a3\u8fd9\u91cc\u5462\uff0c\u6211\u4eec \u4e5f\u53ef\u4ee5\u901a\u8fc7union/union all\u6765\u8054\u5408\u67e5\u8be2.  </p> <pre><code>select * from emp where salary &lt; 5000\nunion all\nselect * from emp where age &gt; 50; \n</code></pre> <p></p> <p>union all\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\uff0c\u4ec5\u4ec5\u8fdb\u884c\u7b80\u5355\u7684\u5408\u5e76\uff0c\u5e76\u672a\u53bb\u91cd\u3002  </p> <pre><code>select * from emp where salary &lt; 5000\nunion\nselect * from emp where age &gt; 50;  \n</code></pre> <p></p> <p>union \u8054\u5408\u67e5\u8be2\uff0c\u4f1a\u5bf9\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u8fdb\u884c\u53bb\u91cd\u5904\u7406\u3002  </p> <p>\u6ce8\u610f\uff1a \u5982\u679c\u591a\u6761\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\uff0c\u5b57\u6bb5\u6570\u91cf\u4e0d\u4e00\u81f4\uff0c\u5728\u8fdb\u884cunion/union all\u8054\u5408\u67e5\u8be2\u65f6\uff0c\u5c06\u4f1a\u62a5 \u9519\u3002\u5982\uff1a  </p> <p></p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_38","title":"\u5b50\u67e5\u8be2","text":"<p>\u6982\u5ff5  </p> <p>SQL\u8bed\u53e5\u4e2d\u5d4c\u5957SELECT\u8bed\u53e5\uff0c\u79f0\u4e3a\u5d4c\u5957\u67e5\u8be2\uff0c\u53c8\u79f0\u5b50\u67e5\u8be2\u3002  </p> <pre><code>SELECT * FROM t1 WHERE column1 = ( SELECT column1 FROM t2 );\n</code></pre> <p>\u5b50\u67e5\u8be2\u5916\u90e8\u7684\u8bed\u53e5\u53ef\u4ee5\u662fINSERT / UPDATE / DELETE / SELECT \u7684\u4efb\u4f55\u4e00\u4e2a\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_39","title":"\u5206\u7c7b","text":"<p>\u6839\u636e\u5b50\u67e5\u8be2\u7ed3\u679c\u4e0d\u540c\uff0c\u5206\u4e3a\uff1a A. \u6807\u91cf\u5b50\u67e5\u8be2\uff08\u5b50\u67e5\u8be2\u7ed3\u679c\u4e3a\u5355\u4e2a\u503c\uff09 B. \u5217\u5b50\u67e5\u8be2(\u5b50\u67e5\u8be2\u7ed3\u679c\u4e3a\u4e00\u5217) C. \u884c\u5b50\u67e5\u8be2(\u5b50\u67e5\u8be2\u7ed3\u679c\u4e3a\u4e00\u884c) D. \u8868\u5b50\u67e5\u8be2(\u5b50\u67e5\u8be2\u7ed3\u679c\u4e3a\u591a\u884c\u591a\u5217)  </p> <p>\u6839\u636e\u5b50\u67e5\u8be2\u4f4d\u7f6e\uff0c\u5206\u4e3a\uff1a A. WHERE\u4e4b\u540e B. FROM\u4e4b\u540e C. SELECT\u4e4b\u540e  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_40","title":"\u6807\u91cf\u5b50\u67e5\u8be2","text":"<p>\u5b50\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5355\u4e2a\u503c\uff08\u6570\u5b57\u3001\u5b57\u7b26\u4e32\u3001\u65e5\u671f\u7b49\uff09\uff0c\u6700\u7b80\u5355\u7684\u5f62\u5f0f\uff0c\u8fd9\u79cd\u5b50\u67e5\u8be2\u79f0\u4e3a\u6807\u91cf\u5b50\u67e5\u8be2\u3002 \u5e38\u7528\u7684\u64cd\u4f5c\u7b26\uff1a= &lt;&gt; &gt; &gt;= &lt; &lt;=  </p> <p>\u6848\u4f8b: A. \u67e5\u8be2 \"\u9500\u552e\u90e8\" \u7684\u6240\u6709\u5458\u5de5\u4fe1\u606f \u5b8c\u6210\u8fd9\u4e2a\u9700\u6c42\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u9700\u6c42\u5206\u89e3\u4e3a\u4e24\u6b65\uff1a \u2460. \u67e5\u8be2 \"\u9500\u552e\u90e8\" \u90e8\u95e8ID  </p> <pre><code> select id from dept where name = '\u9500\u552e\u90e8';\n</code></pre> <p>\u2461. \u6839\u636e \"\u9500\u552e\u90e8\" \u90e8\u95e8ID, \u67e5\u8be2\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where dept_id = (select id from dept where name = '\u9500\u552e\u90e8');\n</code></pre> <p>B. \u67e5\u8be2\u5728 \"\u65b9\u4e1c\u767d\" \u5165\u804c\u4e4b\u540e\u7684\u5458\u5de5\u4fe1\u606f \u5b8c\u6210\u8fd9\u4e2a\u9700\u6c42\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u9700\u6c42\u5206\u89e3\u4e3a\u4e24\u6b65\uff1a \u2460. \u67e5\u8be2 \u65b9\u4e1c\u767d \u7684\u5165\u804c\u65e5\u671f  </p> <pre><code>select entrydate from emp where name = '\u65b9\u4e1c\u767d';\n</code></pre> <p>\u2461. \u67e5\u8be2\u6307\u5b9a\u5165\u804c\u65e5\u671f\u4e4b\u540e\u5165\u804c\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where entrydate &gt; (select entrydate from emp where name = '\u65b9\u4e1c\u767d');\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_41","title":"\u5217\u5b50\u67e5\u8be2","text":"<p>\u5b50\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e00\u5217\uff08\u53ef\u4ee5\u662f\u591a\u884c\uff09\uff0c\u8fd9\u79cd\u5b50\u67e5\u8be2\u79f0\u4e3a\u5217\u5b50\u67e5\u8be2\u3002 \u5e38\u7528\u7684\u64cd\u4f5c\u7b26\uff1aIN \u3001NOT IN \u3001 ANY \u3001SOME \u3001 ALL  </p> \u64cd\u4f5c\u7b26 \u63cf\u8ff0 IN \u5728\u6307\u5b9a\u7684\u96c6\u5408\u8303\u56f4\u4e4b\u5185\uff0c\u591a\u9009\u4e00 NOT IN \u4e0d\u5728\u6307\u5b9a\u7684\u96c6\u5408\u8303\u56f4\u4e4b\u5185 ANY \u5b50\u67e5\u8be2\u8fd4\u56de\u5217\u8868\u4e2d\uff0c\u6709\u4efb\u610f\u4e00\u4e2a\u6ee1\u8db3\u5373\u53ef SOME \u4e0eANY\u7b49\u540c\uff0c\u4f7f\u7528SOME\u7684\u5730\u65b9\u90fd\u53ef\u4ee5\u4f7f\u7528ANY ALL \u5b50\u67e5\u8be2\u8fd4\u56de\u5217\u8868\u7684\u6240\u6709\u503c\u90fd\u5fc5\u987b\u6ee1\u8db3 <p>\u6848\u4f8b: A. \u67e5\u8be2 \"\u9500\u552e\u90e8\" \u548c \"\u5e02\u573a\u90e8\" \u7684\u6240\u6709\u5458\u5de5\u4fe1\u606f \u5206\u89e3\u4e3a\u4ee5\u4e0b\u4e24\u6b65: \u2460. \u67e5\u8be2 \"\u9500\u552e\u90e8\" \u548c \"\u5e02\u573a\u90e8\" \u7684\u90e8\u95e8ID  </p> <pre><code>select id from dept where name = '\u9500\u552e\u90e8' or name = '\u5e02\u573a\u90e8';\n</code></pre> <p>\u2461. \u6839\u636e\u90e8\u95e8ID, \u67e5\u8be2\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where dept_id in (select id from dept where name = '\u9500\u552e\u90e8' or name = '\u5e02\u573a\u90e8');\n</code></pre> <p>B. \u67e5\u8be2\u6bd4 \u8d22\u52a1\u90e8 \u6240\u6709\u4eba\u5de5\u8d44\u90fd\u9ad8\u7684\u5458\u5de5\u4fe1\u606f  </p> <p>\u5206\u89e3\u4e3a\u4ee5\u4e0b\u4e24\u6b65: \u2460. \u67e5\u8be2\u6240\u6709 \u8d22\u52a1\u90e8 \u4eba\u5458\u5de5\u8d44  </p> <pre><code>select id from dept where name = '\u8d22\u52a1\u90e8';\nselect salary from emp where dept_id = (select id from dept where name = '\u8d22\u52a1\u90e8');\n</code></pre> <p>\u2461. \u6bd4 \u8d22\u52a1\u90e8 \u6240\u6709\u4eba\u5de5\u8d44\u90fd\u9ad8\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where salary &gt; all ( select salary from emp where dept_id =\n(select id from dept where name = '\u8d22\u52a1\u90e8') );\n</code></pre> <p>C. \u67e5\u8be2\u6bd4\u7814\u53d1\u90e8\u5176\u4e2d\u4efb\u610f\u4e00\u4eba\u5de5\u8d44\u9ad8\u7684\u5458\u5de5\u4fe1\u606f  </p> <p>\u5206\u89e3\u4e3a\u4ee5\u4e0b\u4e24\u6b65: \u2460. \u67e5\u8be2\u7814\u53d1\u90e8\u6240\u6709\u4eba\u5de5\u8d44  </p> <pre><code>select salary from emp where dept_id = (select id from dept where name = '\u7814\u53d1\u90e8');\n</code></pre> <p>\u2461. \u6bd4\u7814\u53d1\u90e8\u5176\u4e2d\u4efb\u610f\u4e00\u4eba\u5de5\u8d44\u9ad8\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where salary &gt; any ( select salary from emp where dept_id =\n(select id from dept where name = '\u7814\u53d1\u90e8') );\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_42","title":"\u884c\u5b50\u67e5\u8be2","text":"<p>\u5b50\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e00\u884c\uff08\u53ef\u4ee5\u662f\u591a\u5217\uff09\uff0c\u8fd9\u79cd\u5b50\u67e5\u8be2\u79f0\u4e3a\u884c\u5b50\u67e5\u8be2\u3002 \u5e38\u7528\u7684\u64cd\u4f5c\u7b26\uff1a= \u3001&lt;&gt; \u3001IN \u3001NOT IN \u6848\u4f8b: A. \u67e5\u8be2\u4e0e \"\u5f20\u65e0\u5fcc\" \u7684\u85aa\u8d44\u53ca\u76f4\u5c5e\u9886\u5bfc\u76f8\u540c\u7684\u5458\u5de5\u4fe1\u606f ; \u8fd9\u4e2a\u9700\u6c42\u540c\u6837\u53ef\u4ee5\u62c6\u89e3\u4e3a\u4e24\u6b65\u8fdb\u884c: \u2460. \u67e5\u8be2 \"\u5f20\u65e0\u5fcc\" \u7684\u85aa\u8d44\u53ca\u76f4\u5c5e\u9886\u5bfc  </p> <pre><code>select salary, managerid from emp where name = '\u5f20\u65e0\u5fcc';\n</code></pre> <p>\u2461. \u67e5\u8be2\u4e0e \"\u5f20\u65e0\u5fcc\" \u7684\u85aa\u8d44\u53ca\u76f4\u5c5e\u9886\u5bfc\u76f8\u540c\u7684\u5458\u5de5\u4fe1\u606f ;  </p> <pre><code>select * from emp where (salary,managerid) = (select salary, managerid from emp\nwhere name = '\u5f20\u65e0\u5fcc');\n</code></pre> <p>\u8868\u5b50\u67e5\u8be2  </p> <p>\u5b50\u67e5\u8be2\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u591a\u884c\u591a\u5217\uff0c\u8fd9\u79cd\u5b50\u67e5\u8be2\u79f0\u4e3a\u8868\u5b50\u67e5\u8be2\u3002 \u5e38\u7528\u7684\u64cd\u4f5c\u7b26\uff1aIN  </p> <p>\u6848\u4f8b: A. \u67e5\u8be2\u4e0e \"\u9e7f\u6756\u5ba2\" , \"\u5b8b\u8fdc\u6865\" \u7684\u804c\u4f4d\u548c\u85aa\u8d44\u76f8\u540c\u7684\u5458\u5de5\u4fe1\u606f \u5206\u89e3\u4e3a\u4e24\u6b65\u6267\u884c: \u2460. \u67e5\u8be2 \"\u9e7f\u6756\u5ba2\" , \"\u5b8b\u8fdc\u6865\" \u7684\u804c\u4f4d\u548c\u85aa\u8d44  </p> <pre><code>select job, salary from emp where name = '\u9e7f\u6756\u5ba2' or name = '\u5b8b\u8fdc\u6865';\n</code></pre> <p>\u2461. \u67e5\u8be2\u4e0e \"\u9e7f\u6756\u5ba2\" , \"\u5b8b\u8fdc\u6865\" \u7684\u804c\u4f4d\u548c\u85aa\u8d44\u76f8\u540c\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where (job,salary) in ( select job, salary from emp where name =\n'\u9e7f\u6756\u5ba2' or name = '\u5b8b\u8fdc\u6865' );\n</code></pre> <p>B. \u67e5\u8be2\u5165\u804c\u65e5\u671f\u662f \"2006-01-01\" \u4e4b\u540e\u7684\u5458\u5de5\u4fe1\u606f , \u53ca\u5176\u90e8\u95e8\u4fe1\u606f \u5206\u89e3\u4e3a\u4e24\u6b65\u6267\u884c: \u2460. \u5165\u804c\u65e5\u671f\u662f \"2006-01-01\" \u4e4b\u540e\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where entrydate &gt; '2006-01-01';\n</code></pre> <p>\u2461. \u67e5\u8be2\u8fd9\u90e8\u5206\u5458\u5de5, \u5bf9\u5e94\u7684\u90e8\u95e8\u4fe1\u606f;  </p> <pre><code>select e.*, d.* from (select * from emp where entrydate &gt; '2006-01-01') e left\njoin dept d on e.dept_id = d.id ;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_43","title":"\u591a\u8868\u67e5\u8be2\u6848\u4f8b","text":"<pre><code>create table salgrade(\ngrade int,\nlosal int,\nhisal int\n) comment '\u85aa\u8d44\u7b49\u7ea7\u8868';\ninsert into salgrade values (1,0,3000);\ninsert into salgrade values (2,3001,5000);\ninsert into salgrade values (3,5001,8000);\ninsert into salgrade values (4,8001,10000);\ninsert into salgrade values (5,10001,15000);\ninsert into salgrade values (6,15001,20000);\ninsert into salgrade values (7,20001,25000);\ninsert into salgrade values (8,25001,30000);\n</code></pre> <p>\u5728\u8fd9\u4e2a\u6848\u4f8b\u4e2d\uff0c\u6211\u4eec\u4e3b\u8981\u8fd0\u7528\u4e0a\u9762\u6240\u8bb2\u89e3\u7684\u591a\u8868\u67e5\u8be2\u7684\u8bed\u6cd5\uff0c\u5b8c\u6210\u4ee5\u4e0b\u768412\u4e2a\u9700\u6c42\u5373\u53ef\uff0c\u800c\u8fd9\u91cc\u4e3b\u8981\u6d89 \u53ca\u5230\u7684\u8868\u5c31\u4e09\u5f20\uff1aemp\u5458\u5de5\u8868\u3001dept\u90e8\u95e8\u8868\u3001salgrade\u85aa\u8d44\u7b49\u7ea7\u8868 \u3002 1). \u67e5\u8be2\u5458\u5de5\u7684\u59d3\u540d\u3001\u5e74\u9f84\u3001\u804c\u4f4d\u3001\u90e8\u95e8\u4fe1\u606f \uff08\u9690\u5f0f\u5185\u8fde\u63a5\uff09 \u8868: emp , dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select e.name , e.age , e.job , d.name from emp e , dept d where e.dept_id = d.id;\n</code></pre> <p>2). \u67e5\u8be2\u5e74\u9f84\u5c0f\u4e8e30\u5c81\u7684\u5458\u5de5\u7684\u59d3\u540d\u3001\u5e74\u9f84\u3001\u804c\u4f4d\u3001\u90e8\u95e8\u4fe1\u606f\uff08\u663e\u5f0f\u5185\u8fde\u63a5\uff09 \u8868: emp , dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select e.name , e.age , e.job , d.name from emp e inner join dept d on e.dept_id =\nd.id where e.age &lt; 30;\n</code></pre> <p>3). \u67e5\u8be2\u62e5\u6709\u5458\u5de5\u7684\u90e8\u95e8ID\u3001\u90e8\u95e8\u540d\u79f0 \u8868: emp , dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select distinct d.id , d.name from emp e , dept d where e.dept_id = d.id;\n</code></pre> <p>4). \u67e5\u8be2\u6240\u6709\u5e74\u9f84\u5927\u4e8e40\u5c81\u7684\u5458\u5de5, \u53ca\u5176\u5f52\u5c5e\u7684\u90e8\u95e8\u540d\u79f0; \u5982\u679c\u5458\u5de5\u6ca1\u6709\u5206\u914d\u90e8\u95e8, \u4e5f\u9700\u8981\u5c55\u793a\u51fa \u6765(\u5916\u8fde\u63a5) \u8868: emp , dept \u8fde\u63a5\u6761\u4ef6: emp.dept_id = dept.id  </p> <pre><code>select e.*, d.name from emp e left join dept d on e.dept_id = d.id where e.age &gt; 40 ;\n</code></pre> <p>5). \u67e5\u8be2\u6240\u6709\u5458\u5de5\u7684\u5de5\u8d44\u7b49\u7ea7 \u8868: emp , salgrade \u8fde\u63a5\u6761\u4ef6 : emp.salary &gt;= salgrade.losal and emp.salary &lt;= salgrade.hisal  </p> <pre><code>-- \u65b9\u5f0f\u4e00\nselect e.* , s.grade , s.losal, s.hisal from emp e , salgrade s where e.salary &gt;=\ns.losal and e.salary &lt;= s.hisal;\n-- \u65b9\u5f0f\u4e8c\nselect e.* , s.grade , s.losal, s.hisal from emp e , salgrade s where e.salary\nbetween s.losal and s.hisal;\n</code></pre> <p>6). \u67e5\u8be2 \"\u7814\u53d1\u90e8\" \u6240\u6709\u5458\u5de5\u7684\u4fe1\u606f\u53ca \u5de5\u8d44\u7b49\u7ea7 \u8868: emp , salgrade , dept \u8fde\u63a5\u6761\u4ef6 : emp.salary between salgrade.losal and salgrade.hisal , emp.dept_id = dept.id \u67e5\u8be2\u6761\u4ef6 : dept.name = '\u7814\u53d1\u90e8'  </p> <pre><code>select e.* , s.grade from emp e , dept d , salgrade s where e.dept_id = d.id and (e.salary between s.losal and s.hisal ) and d.name = '\u7814\u53d1\u90e8';\n</code></pre> <p>7). \u67e5\u8be2 \"\u7814\u53d1\u90e8\" \u5458\u5de5\u7684\u5e73\u5747\u5de5\u8d44 \u8868: emp , dept \u8fde\u63a5\u6761\u4ef6 : emp.dept_id = dept.id  </p> <pre><code>select avg(e.salary) from emp e, dept d where e.dept_id = d.id and d.name = '\u7814\u53d1\u90e8';\n</code></pre> <p>8). \u67e5\u8be2\u5de5\u8d44\u6bd4 \"\u706d\u7edd\" \u9ad8\u7684\u5458\u5de5\u4fe1\u606f\u3002 \u2460. \u67e5\u8be2 \"\u706d\u7edd\" \u7684\u85aa\u8d44  </p> <pre><code>select salary from emp where name = '\u706d\u7edd';\n</code></pre> <p>\u2461. \u67e5\u8be2\u6bd4\u5979\u5de5\u8d44\u9ad8\u7684\u5458\u5de5\u6570\u636e  </p> <pre><code>select * from emp where salary &gt; ( select salary from emp where name = '\u706d\u7edd' );\n</code></pre> <p>9). \u67e5\u8be2\u6bd4\u5e73\u5747\u85aa\u8d44\u9ad8\u7684\u5458\u5de5\u4fe1\u606f \u2460. \u67e5\u8be2\u5458\u5de5\u7684\u5e73\u5747\u85aa\u8d44  </p> <pre><code>select avg(salary) from emp;\n</code></pre> <p>\u2461. \u67e5\u8be2\u6bd4\u5e73\u5747\u85aa\u8d44\u9ad8\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp where salary &gt; ( select avg(salary) from emp );\n</code></pre> <p>10). \u67e5\u8be2\u4f4e\u4e8e\u672c\u90e8\u95e8\u5e73\u5747\u5de5\u8d44\u7684\u5458\u5de5\u4fe1\u606f \u2460. \u67e5\u8be2\u6307\u5b9a\u90e8\u95e8\u5e73\u5747\u85aa\u8d44  </p> <pre><code>select avg(e1.salary) from emp e1 where e1.dept_id = 1;\nselect avg(e1.salary) from emp e1 where e1.dept_id = 2;\n</code></pre> <p>\u2461. \u67e5\u8be2\u4f4e\u4e8e\u672c\u90e8\u95e8\u5e73\u5747\u5de5\u8d44\u7684\u5458\u5de5\u4fe1\u606f  </p> <pre><code>select * from emp e2 where e2.salary &lt; ( select avg(e1.salary) from emp e1 where e1.dept_id = e2.dept_id );\n</code></pre> <p>11). \u67e5\u8be2\u6240\u6709\u7684\u90e8\u95e8\u4fe1\u606f, \u5e76\u7edf\u8ba1\u90e8\u95e8\u7684\u5458\u5de5\u4eba\u6570  </p> <pre><code>select d.id, d.name , ( select count(*) from emp e where e.dept_id = d.id ) '\u4eba\u6570' from dept d;\n</code></pre> <p>12). \u67e5\u8be2\u6240\u6709\u5b66\u751f\u7684\u9009\u8bfe\u60c5\u51b5, \u5c55\u793a\u51fa\u5b66\u751f\u540d\u79f0, \u5b66\u53f7, \u8bfe\u7a0b\u540d\u79f0 \u8868: student , course , student_course \u8fde\u63a5\u6761\u4ef6: student.id = student_course.studentid , course.id = student_course.courseid  </p> <pre><code>select s.name , s.no , c.name from student s , student_course sc , course c where s.id = sc.studentid and sc.courseid = c.id ;\n</code></pre> <p>\u5907\u6ce8: \u4ee5\u4e0a\u9700\u6c42\u7684\u5b9e\u73b0\u65b9\u5f0f\u53ef\u80fd\u4f1a\u5f88\u591a, SQL\u5199\u6cd5\u4e5f\u6709\u5f88\u591a\uff0c\u53ea\u8981\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\uff0c\u67e5\u8be2\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u8bb0\u5f55\u5373\u53ef\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_44","title":"\u4e8b\u52a1","text":""},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_45","title":"\u4e8b\u52a1\u7b80\u4ecb","text":"<p>\u4e8b\u52a1 \u662f\u4e00\u7ec4\u64cd\u4f5c\u7684\u96c6\u5408\uff0c\u5b83\u662f\u4e00\u4e2a\u4e0d\u53ef\u5206\u5272\u7684\u5de5\u4f5c\u5355\u4f4d\uff0c\u4e8b\u52a1\u4f1a\u628a\u6240\u6709\u7684\u64cd\u4f5c\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u4e00\u8d77\u5411\u7cfb \u7edf\u63d0\u4ea4\u6216\u64a4\u9500\u64cd\u4f5c\u8bf7\u6c42\uff0c\u5373\u8fd9\u4e9b\u64cd\u4f5c\u8981\u4e48\u540c\u65f6\u6210\u529f\uff0c\u8981\u4e48\u540c\u65f6\u5931\u8d25\u3002 \u5c31\u6bd4\u5982: \u5f20\u4e09\u7ed9\u674e\u56db\u8f6c\u8d261000\u5757\u94b1\uff0c\u5f20\u4e09\u94f6\u884c\u8d26\u6237\u7684\u94b1\u51cf\u5c111000\uff0c\u800c\u674e\u56db\u94f6\u884c\u8d26\u6237\u7684\u94b1\u8981\u589e\u52a0 1000\u3002 \u8fd9\u4e00\u7ec4\u64cd\u4f5c\u5c31\u5fc5\u987b\u5728\u4e00\u4e2a\u4e8b\u52a1\u7684\u8303\u56f4\u5185\uff0c\u8981\u4e48\u90fd\u6210\u529f\uff0c\u8981\u4e48\u90fd\u5931\u8d25\u3002  </p> <p>\u6ce8\u610f\uff1a \u9ed8\u8ba4MySQL\u7684\u4e8b\u52a1\u662f\u81ea\u52a8\u63d0\u4ea4\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u6267\u884c\u5b8c\u4e00\u6761DML\u8bed\u53e5\u65f6\uff0cMySQL\u4f1a\u7acb\u5373\u9690 \u5f0f\u7684\u63d0\u4ea4\u4e8b\u52a1  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_46","title":"\u4e8b\u52a1\u64cd\u4f5c","text":"<p>\u6570\u636e\u51c6\u5907\uff1a  </p> <pre><code>drop table if exists account;\ncreate table account(\nid int primary key AUTO_INCREMENT comment 'ID',\nname varchar(10) comment '\u59d3\u540d',\nmoney double(10,2) comment '\u4f59\u989d'\n) comment '\u8d26\u6237\u8868';\ninsert into account(name, money) VALUES ('\u5f20\u4e09',2000), ('\u674e\u56db',2000);\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_47","title":"\u672a\u63a7\u5236\u4e8b\u52a1","text":"<p>\u6d4b\u8bd5\u6b63\u5e38\u60c5\u51b5  </p> <pre><code>-- 1. \u67e5\u8be2\u5f20\u4e09\u4f59\u989d\nselect * from account where name = '\u5f20\u4e09';\n-- 2. \u5f20\u4e09\u7684\u4f59\u989d\u51cf\u5c111000\nupdate account set money = money - 1000 where name = '\u5f20\u4e09';\n-- 3. \u674e\u56db\u7684\u4f59\u989d\u589e\u52a01000\nupdate account set money = money + 1000 where name = '\u674e\u56db';\n</code></pre> <p>\u6d4b\u8bd5\u5b8c\u6bd5\u4e4b\u540e\u68c0\u67e5\u6570\u636e\u7684\u72b6\u6001, \u53ef\u4ee5\u770b\u5230\u6570\u636e\u64cd\u4f5c\u524d\u540e\u662f\u4e00\u81f4\u7684  </p> <p></p> <p>\u6d4b\u8bd5\u5f02\u5e38\u60c5\u51b5  </p> <pre><code>-- 1. \u67e5\u8be2\u5f20\u4e09\u4f59\u989d\nselect * from account where name = '\u5f20\u4e09';\n-- 2. \u5f20\u4e09\u7684\u4f59\u989d\u51cf\u5c111000\nupdate account set money = money - 1000 where name = '\u5f20\u4e09';\n\u51fa\u9519\u4e86....\n-- 3. \u674e\u56db\u7684\u4f59\u989d\u589e\u52a01000\nupdate account set money = money + 1000 where name = '\u674e\u56db';\n</code></pre> <p>\u6211\u4eec\u628a\u6570\u636e\u90fd\u6062\u590d\u52302000\uff0c \u7136\u540e\u518d\u6b21\u4e00\u6b21\u6027\u6267\u884c\u4e0a\u8ff0\u7684SQL\u8bed\u53e5(\u51fa\u9519\u4e86.... \u8fd9\u53e5\u8bdd\u4e0d\u7b26\u5408SQL\u8bed \u6cd5,\u6267\u884c\u5c31\u4f1a\u62a5\u9519)\uff0c\u68c0\u67e5\u6700\u7ec8\u7684\u6570\u636e\u60c5\u51b5, \u53d1\u73b0\u6570\u636e\u5728\u64cd\u4f5c\u524d\u540e\u4e0d\u4e00\u81f4\u4e86\u3002  </p> <p></p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_48","title":"\u63a7\u5236\u4e8b\u52a1\u4e00","text":"<p>1). \u67e5\u770b/\u8bbe\u7f6e\u4e8b\u52a1\u63d0\u4ea4\u65b9\u5f0f  </p> <pre><code>SELECT @@autocommit ;\nSET @@autocommit = 0 ; \n</code></pre> <p>2). \u63d0\u4ea4\u4e8b\u52a1  </p> <pre><code>COMMIT;\n</code></pre> <p>3). \u56de\u6eda\u4e8b\u52a1  </p> <pre><code> ROLLBACK;\n</code></pre> <p>\u6ce8\u610f\uff1a\u4e0a\u8ff0\u7684\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u662f\u4fee\u6539\u4e86\u4e8b\u52a1\u7684\u81ea\u52a8\u63d0\u4ea4\u884c\u4e3a, \u628a\u9ed8\u8ba4\u7684\u81ea\u52a8\u63d0\u4ea4\u4fee\u6539\u4e3a\u4e86\u624b\u52a8\u63d0 \u4ea4, \u6b64\u65f6\u6211\u4eec\u6267\u884c\u7684DML\u8bed\u53e5\u90fd\u4e0d\u4f1a\u63d0\u4ea4, \u9700\u8981\u624b\u52a8\u7684\u6267\u884ccommit\u8fdb\u884c\u63d0\u4ea4\u3002  </p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_49","title":"\u63a7\u5236\u4e8b\u52a1\u4e8c","text":"<p>1). \u5f00\u542f\u4e8b\u52a1  </p> <pre><code>START TRANSACTION \u6216 BEGIN ;  \n</code></pre> <p>2). \u63d0\u4ea4\u4e8b\u52a1  </p> <pre><code>COMMIT;\n</code></pre> <p>3). \u56de\u6eda\u4e8b\u52a1  </p> <pre><code>ROLLBACK;\n</code></pre> <p>\u8f6c\u8d26\u6848\u4f8b\uff1a  </p> <pre><code>-- \u5f00\u542f\u4e8b\u52a1\nstart transaction\n-- 1. \u67e5\u8be2\u5f20\u4e09\u4f59\u989d\nselect * from account where name = '\u5f20\u4e09';\n-- 2. \u5f20\u4e09\u7684\u4f59\u989d\u51cf\u5c111000\nupdate account set money = money - 1000 where name = '\u5f20\u4e09';\n-- 3. \u674e\u56db\u7684\u4f59\u989d\u589e\u52a01000\nupdate account set money = money + 1000 where name = '\u674e\u56db';\n-- \u5982\u679c\u6b63\u5e38\u6267\u884c\u5b8c\u6bd5, \u5219\u63d0\u4ea4\u4e8b\u52a1\ncommit;\n-- \u5982\u679c\u6267\u884c\u8fc7\u7a0b\u4e2d\u62a5\u9519, \u5219\u56de\u6eda\u4e8b\u52a1\n-- rollback;\n</code></pre>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_50","title":"\u4e8b\u52a1\u56db\u5927\u7279\u6027","text":"<p>\u539f\u5b50\u6027\uff08Atomicity\uff09\uff1a\u4e8b\u52a1\u662f\u4e0d\u53ef\u5206\u5272\u7684\u6700\u5c0f\u64cd\u4f5c\u5355\u5143\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002 \u4e00\u81f4\u6027\uff08Consistency\uff09\uff1a\u4e8b\u52a1\u5b8c\u6210\u65f6\uff0c\u5fc5\u987b\u4f7f\u6240\u6709\u7684\u6570\u636e\u90fd\u4fdd\u6301\u4e00\u81f4\u72b6\u6001\u3002 \u9694\u79bb\u6027\uff08Isolation\uff09\uff1a\u6570\u636e\u5e93\u7cfb\u7edf\u63d0\u4f9b\u7684\u9694\u79bb\u673a\u5236\uff0c\u4fdd\u8bc1\u4e8b\u52a1\u5728\u4e0d\u53d7\u5916\u90e8\u5e76\u53d1\u64cd\u4f5c\u5f71\u54cd\u7684\u72ec\u7acb \u73af\u5883\u4e0b\u8fd0\u884c\u3002 \u6301\u4e45\u6027\uff08Durability\uff09\uff1a\u4e8b\u52a1\u4e00\u65e6\u63d0\u4ea4\u6216\u56de\u6eda\uff0c\u5b83\u5bf9\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u7684\u6539\u53d8\u5c31\u662f\u6c38\u4e45\u7684\u3002 \u4e0a\u8ff0\u5c31\u662f\u4e8b\u52a1\u7684\u56db\u5927\u7279\u6027\uff0c\u7b80\u79f0ACID  </p> <p></p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_51","title":"\u5e76\u53d1\u4e8b\u52a1\u95ee\u9898","text":"<p>1). \u8d43\u8bfb\uff1a\u4e00\u4e2a\u4e8b\u52a1\u8bfb\u5230\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u6ca1\u6709\u63d0\u4ea4\u7684\u6570\u636e\u3002  </p> <p></p> <p>\u6bd4\u5982B\u8bfb\u53d6\u5230\u4e86A\u672a\u63d0\u4ea4\u7684\u6570\u636e\u3002  </p> <p>2). \u4e0d\u53ef\u91cd\u590d\u8bfb\uff1a\u4e00\u4e2a\u4e8b\u52a1\u5148\u540e\u8bfb\u53d6\u540c\u4e00\u6761\u8bb0\u5f55\uff0c\u4f46\u4e24\u6b21\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u540c\uff0c\u79f0\u4e4b\u4e3a\u4e0d\u53ef\u91cd\u590d\u8bfb\u3002  </p> <p></p> <p>\u4e8b\u52a1A\u4e24\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u8bfb\u53d6\u5230\u7684\u6570\u636e\u5374\u662f\u4e0d\u4e00\u6837\u7684\u3002  </p> <p>3). \u5e7b\u8bfb\uff1a\u4e00\u4e2a\u4e8b\u52a1\u6309\u7167\u6761\u4ef6\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u6ca1\u6709\u5bf9\u5e94\u7684\u6570\u636e\u884c\uff0c\u4f46\u662f\u5728\u63d2\u5165\u6570\u636e\u65f6\uff0c\u53c8\u53d1\u73b0\u8fd9\u884c\u6570\u636e \u5df2\u7ecf\u5b58\u5728\uff0c\u597d\u50cf\u51fa\u73b0\u4e86 \"\u5e7b\u5f71\"\u3002  </p> <p></p>"},{"location":"mysql8/mysql8%E5%AD%A6%E4%B9%A0/#_52","title":"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u5e76\u53d1\u4e8b\u52a1\u6240\u5f15\u53d1\u7684\u95ee\u9898\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u5f15\u5165\u4e86\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u3002\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a  </p> \u9694\u79bb\u7ea7\u522b \u810f\u8bfb \u4e0d\u53ef\u91cd\u590d\u8bfb \u5e7b\u8bfb Read uncommitted \u221a \u221a \u221a Read committed \u00d7 \u221a \u221a Repeatable Read(\u9ed8\u8ba4) \u00d7 \u00d7 \u221a Serializable \u00d7 \u00d7 \u00d7 <p>1). \u67e5\u770b\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b  </p> <pre><code>SELECT @@TRANSACTION_ISOLATION;\n</code></pre> <p>2). \u8bbe\u7f6e\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b  </p> <pre><code>SET [ SESSION | GLOBAL ] TRANSACTION ISOLATION LEVEL { READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE }\n</code></pre> <p>\u6ce8\u610f\uff1a\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u8d8a\u9ad8\uff0c\u6570\u636e\u8d8a\u5b89\u5168\uff0c\u4f46\u662f\u6027\u80fd\u8d8a\u4f4e  </p>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/","title":"Nginx\u5b66\u4e60","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1tengine","title":"1.Tengine\u4ecb\u7ecd","text":"<p>\u7531\u6dd8\u5b9d\u5bf9Nginx\u8fdb\u884c\u4e8c\u6b21\u5f00\u53d1\u7684\u4e00\u4e2a\u5206\u652f\u670d\u52a1\u5668\uff0c\u4e00\u822c\u7528\u5728\u9ad8\u5e76\u53d1\u957f\u573a\u666f</p> <p>\u5b98\u7f51</p> <pre><code>https://tengine.taobao.org/\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2nginx","title":"2.\u5b89\u88c5Nginx","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ayum","title":"A.yum\u6e90\u5b89\u88c5","text":"<pre><code>vi /etc/yum.repos.d/nginx.repo #\u914d\u7f6enginx\u8f83\u65b0\u7248\u672cyum\u6e90\n    [nginx]\n    name=nginx repo\n    baseurl=http://nginx.org/packages/centos/$releasever/$basearch/\n    gpgcheck=0\n    enabled=1\n#\u6216\u8005\u4e0b\u8f7d\u62d3\u5c55\u6e90epel-release\uff0c\u7248\u672c\u8f83\u65e7 \n#yum install epel-release -y\nyum list | grep nginx\nyum install nginx -y\nwhereis nginx\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#b","title":"B.\u6e90\u7801\u5b89\u88c5","text":"<pre><code>yum intall wget\nwget url\ntar xf xxx.gz -C /usr/local\ncd /usr/local/nginx-1.2.5\n./configure --prefix=/usr/local/nginx\n#\u7f3a\u5c11pcre  yum install pcre-devel\n#\u7f3a\u5c11zlib    yum install zlib-devel\nmake #\u7f16\u8bd1\nmake install #\u5b89\u88c5\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#cnginx","title":"C.\u67e5\u770bNginx\u8fdb\u7a0b","text":"<pre><code>netstat -lnp|grep 80 #\u67e5\u770b80\u7aef\u53e3\u5360\u7528\u60c5\u51b5\nps -ef|grep nginx #\u67e5\u770bnginx\u8fdb\u7a0b\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#3nginx","title":"3.Nginx\u914d\u7f6e\u6587\u4ef6\u8be6\u89e3","text":"<pre><code>[root@master nginx]# ll\n\u603b\u7528\u91cf 4\ndrwxr-xr-x. 2 root root 4096 8\u6708  21 10:21 conf #\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\ndrwxr-xr-x. 2 root root   40 8\u6708  21 09:40 html #html\u76ee\u5f55\ndrwxr-xr-x. 2 root root    6 8\u6708  21 09:40 logs #\u65e5\u5fd7\ndrwxr-xr-x. 2 root root   19 8\u6708  21 09:40 sbin #\u542f\u52a8\u811a\u672c\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#anginxconf","title":"A.nginx.conf\u5168\u5c40\u914d\u7f6e","text":"<pre><code>user nobody;\n#\u5b9a\u4e49\u8fd0\u884cnginx\u670d\u52a1\u7684\u7528\u6237,\u8fd8\u53ef\u4ee5\u52a0\u4e0a\u7ec4,\u5982 user nobody nobody;\nworker_processes 1;\n#\u5b9a\u4e49nginx\u5b50\u8fdb\u7a0b\u6570\u91cf\uff0c\u5373\u63d0\u4f9b\u670d\u52a1\u7684\u8fdb\u7a0b\u6570\u91cf\uff0c\u8be5\u6570\u503c\u5efa\u8bae\u548c\u670d\u52a1cpu\u6838\u6570\u4fdd\u6301\u4e00\u81f4\u3002\n#\u9664\u4e86\u53ef\u4ee5\u5b9a\u4e49\u6570\u5b57\u5916\uff0c\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u4e3aauto\uff0c\u8868\u793a\u8ba9\u7cfb\u7edf\u81ea\u52a8\u8c03\u6574\u3002\nerror_log logs/error.log;\n#\u5b9a\u4e49\u9519\u8bef\u65e5\u5fd7\u7684\u8def\u5f84\uff0c\u53ef\u4ee5\u662f\u76f8\u5bf9\u8def\u5f84\uff08\u76f8\u5bf9prefix\u8def\u5f84\u7684\uff09\uff0c\u4e5f\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\u3002\n#\u8be5\u914d\u7f6e\u53ef\u4ee5\u5728\u6b64\u5904\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u5230http\u3001server\u3001location\u91cc\nerror_log logs/error.log notice;\n#\u5b9a\u4e49\u9519\u8bef\u65e5\u5fd7\u8def\u5f84\u4ee5\u53ca\u65e5\u5fd7\u7ea7\u522b.\n##\u9519\u8bef\u65e5\u5fd7\u7ea7\u522b\uff1a\u5e38\u89c1\u7684\u9519\u8bef\u65e5\u5fd7\u7ea7\u522b\u6709[debug|info|notice|warn|error|crit|alert|emerg]\uff0c\u7ea7\u522b\u8d8a\u9ad8\u8bb0\u5f55\u7684\u4fe1\u606f\u8d8a\u5c11\u3002\n#\u5982\u679c\u4e0d\u5b9a\u4e49\u9ed8\u8ba4\u662ferror\npid logs/nginx.pid;\n#\u5b9a\u4e49nginx\u8fdb\u7a0bpid\u6587\u4ef6\u6240\u5728\u8def\u5f84\uff0c\u53ef\u4ee5\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\u3002\nworker_rlimit_nofile 100000;\n#\u5b9a\u4e49nginx\u6700\u591a\u6253\u5f00\u6587\u4ef6\u6570\u9650\u5236\u3002\u5982\u679c\u6ca1\u8bbe\u7f6e\u7684\u8bdd\uff0c\u8fd9\u4e2a\u503c\u4e3a\u64cd\u4f5c\u7cfb\u7edf\uff08ulimit -n\uff09\u7684\u9650\u5236\u4fdd\u6301\u4e00\u81f4\u3002\n#\u628a\u8fd9\u4e2a\u503c\u8bbe\u9ad8\uff0cnginx\u5c31\u4e0d\u4f1a\u6709\u201ctoo many open files\u201d\u95ee\u9898\u4e86\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#bevents","title":"B.events\u914d\u7f6e\u9879\u7ed3\u6784","text":"<pre><code>events\u914d\u7f6e\u90e8\u5206\nworker_connections 1024;\n#\u5b9a\u4e49\u6bcf\u4e2awork_process\u540c\u65f6\u5f00\u542f\u7684\u6700\u5927\u8fde\u63a5\u6570\uff0c\u5373\u5141\u8bb8\u6700\u591a\u53ea\u80fd\u6709\u8fd9\u4e48\u591a\u8fde\u63a5\u3002\naccept_mutex on;\n#\u5f53\u67d0\u4e00\u4e2a\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5\u8bf7\u6c42\u670d\u52a1\u5668\u65f6\uff0c\u670d\u52a1\u5668\u4e0a\u6709\u591a\u4e2a\u7761\u7720\u7684\u8fdb\u7a0b\u4f1a\u88ab\u540c\u65f6\u53eb\u9192\uff0c\u8fd9\u6837\u4f1a\u635f\u8017\u4e00\u5b9a\u7684\u670d\u52a1\u5668\u6027\u80fd\u3002\n#Nginx\u4e2d\u7684accept_mutex\u8bbe\u7f6e\u4e3aon\uff0c\u5c06\u4f1a\u5bf9\u591a\u4e2aNginx\u8fdb\u7a0b\uff08worker processer\uff09\u63a5\u6536\u8fde\u63a5\u65f6\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u9632\u6b62\u591a\u4e2a\u8fdb\u7a0b\u4e89\u62a2\u8d44\u6e90\u3002\n#\u9ed8\u8ba4\u5c31\u662fon\u3002\nmulti_accept on;\n#nginx worker processer\u53ef\u4ee5\u505a\u5230\u540c\u65f6\u63a5\u6536\u591a\u4e2a\u65b0\u5230\u8fbe\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u524d\u63d0\u662f\u628a\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3aon\u3002\n#\u9ed8\u8ba4\u4e3aoff\uff0c\u5373\u6bcf\u4e2aworker process\u4e00\u6b21\u53ea\u80fd\u63a5\u6536\u4e00\u4e2a\u65b0\u5230\u8fbe\u7684\u7f51\u7edc\u8fde\u63a5\u3002\nuse epoll;\n#Nginx\u670d\u52a1\u5668\u63d0\u4f9b\u4e86\u591a\u4e2a\u4e8b\u4ef6\u9a71\u52a8\u5668\u6a21\u578b\u6765\u5904\u7406\u7f51\u7edc\u6d88\u606f\u3002\n#\u5176\u652f\u6301\u7684\u7c7b\u578b\u6709\uff1aselect\u3001poll\u3001kqueue\u3001epoll\u3001rtsing\u3001/dev/poll\u4ee5\u53caeventport\u3002\n\n#select\uff1a\u53ea\u80fd\u5728Windows\u4e0b\u4f7f\u7528\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u6a21\u578b\u4e0d\u5efa\u8bae\u5728\u9ad8\u8d1f\u8f7d\u7684\u7cfb\u7edf\u4f7f\u7528\n\n#poll:Nginx\u9ed8\u8ba4\u9996\u9009\uff0c\u4f46\u4e0d\u662f\u5728\u6240\u6709\u7cfb\u7edf\u4e0b\u90fd\u53ef\u7528\n\n#kqueue:\u8fd9\u79cd\u65b9\u5f0f\u5728FreeBSD 4.1+, OpenBSD2.9+, NetBSD 2.0, \u548c MacOS X\u7cfb\u7edf\u4e2d\u662f\u6700\u9ad8\u6548\u7684\n\n#epoll: \u8fd9\u79cd\u65b9\u5f0f\u662f\u5728Linux 2.6+\u5185\u6838\u4e2d\u6700\u9ad8\u6548\u7684\u65b9\u5f0f\n\n#rtsig:\u5b9e\u65f6\u4fe1\u53f7\uff0c\u53ef\u7528\u5728Linux 2.2.19\u7684\u5185\u6838\u4e2d\uff0c\u4f46\u4e0d\u9002\u7528\u5728\u9ad8\u6d41\u91cf\u7684\u7cfb\u7edf\u4e2d\n\n#/dev/poll: Solaris 7 11/99+,HP/UX 11.22+, IRIX 6.5.15+, and Tru64 UNIX 5.1A+\u64cd\u4f5c\u7cfb\u7edf\u6700\u9ad8\u6548\u7684\u65b9\u5f0f\n\n#eventport: Solaris 10\u6700\u9ad8\u6548\u7684\u65b9\u5f0f\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#chttp","title":"C.http\u914d\u7f6e\u9879","text":"<pre><code>MIME-Type\ninclude       mime.types;  //cat conf/mime.types\n#\u5b9a\u4e49nginx\u80fd\u8bc6\u522b\u7684\u7f51\u7edc\u8d44\u6e90\u5a92\u4f53\u7c7b\u578b\uff08\u5982\uff0c\u6587\u672c\u3001html\u3001js\u3001css\u3001\u6d41\u5a92\u4f53\u7b49\uff09\n\ndefault_type  application/octet-stream;\n#\u5b9a\u4e49\u9ed8\u8ba4\u7684type\uff0c\u5982\u679c\u4e0d\u5b9a\u4e49\u8be5\u9879\uff0c\u9ed8\u8ba4\u4e3atext/plain.\nlog_format\nlog_format main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                  '$status $body_bytes_sent \"$http_referer\" '\n                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n#\u5176\u4e2dmain\u4e3a\u65e5\u5fd7\u683c\u5f0f\u7684\u540d\u5b57\uff0c\u540e\u9762\u7684\u4e3anginx\u7684\u5185\u90e8\u53d8\u91cf\u7ec4\u6210\u7684\u4e00\u4e32\u5b57\u7b26\u4e32\u3002\naccess_log logs/access.log main;\n#\u5b9a\u4e49\u65e5\u5fd7\u7684\u8def\u5f84\u4ee5\u53ca\u91c7\u7528\u7684\u65e5\u5fd7\u683c\u5f0f\uff0c\u8be5\u53c2\u6570\u53ef\u4ee5\u5728server\u914d\u7f6e\u5757\u4e2d\u5b9a\u4e49\u3002\nsendfile on;\n#\u662f\u5426\u8c03\u7528sendfile\u51fd\u6570\u4f20\u8f93\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4e3aoff\uff0c\u4f7f\u7528sendfile\u51fd\u6570\u4f20\u8f93\uff0c\u53ef\u4ee5\u51cf\u5c11user mode\u548ckernel mode\u7684\u5207\u6362\uff0c\u4ece\u800c\u63d0\u5347\u670d\u52a1\u5668\u6027\u80fd\u3002\n#\u5bf9\u4e8e\u666e\u901a\u5e94\u7528\u8bbe\u4e3a on\uff0c\u5982\u679c\u7528\u6765\u8fdb\u884c\u4e0b\u8f7d\u7b49\u5e94\u7528\u78c1\u76d8IO\u91cd\u8d1f\u8f7d\u5e94\u7528\uff0c\u53ef\u8bbe\u7f6e\u4e3aoff\uff0c\u4ee5\u5e73\u8861\u78c1\u76d8\u4e0e\u7f51\u7edcI/O\u5904\u7406\u901f\u5ea6\uff0c\u964d\u4f4e\u7cfb\u7edf\u7684\u8d1f\u8f7d\u3002\nsendfile_max_chunk 128k;\n#\u8be5\u53c2\u6570\u9650\u5b9aNginx worker process\u6bcf\u6b21\u8c03\u7528sendfile()\u51fd\u6570\u4f20\u8f93\u6570\u636e\u7684\u6700\u5927\u503c\uff0c\u9ed8\u8ba4\u503c\u4e3a0\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a0\u5219\u65e0\u9650\u5236\u3002\ntcp_nopush on;\n#\u5f53tcp_nopush\u8bbe\u7f6e\u4e3aon\u65f6\uff0c\u4f1a\u8c03\u7528tcp_cork\u65b9\u6cd5\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\n#\u4f7f\u7528\u8be5\u65b9\u6cd5\u4f1a\u4ea7\u751f\u8fd9\u6837\u7684\u6548\u679c\uff1a\u5f53\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u6570\u636e\u65f6\uff0c\u5185\u6838\u4e0d\u4f1a\u7acb\u9a6c\u5c01\u88c5\u5305\uff0c\u800c\u662f\u5f53\u6570\u636e\u91cf\u79ef\u7d2f\u5230\u4e00\u5b9a\u91cf\u65f6\u624d\u4f1a\u5c01\u88c5\uff0c\u7136\u540e\u4f20\u8f93\u3002\u8fd9\u6837\u6709\u52a9\u4e8e\u89e3\u51b3\u7f51\u7edc\u5835\u585e\u95ee\u9898\u3002\n#\u9ed8\u8ba4\u503c\u4e3aon\u3002\u4e3e\u4f8b\uff1a\u5feb\u9012\u5458\u6536\u5feb\u9012\u3001\u53d1\u5feb\u9012\uff0c\u5305\u88f9\u7d2f\u79ef\u5230\u4e00\u5b9a\u91cf\u624d\u4f1a\u53d1\uff0c\u8282\u7701\u8fd0\u8f93\u6210\u672c\u3002\nkeepalive_timeout 65 60;\n#\u8be5\u53c2\u6570\u6709\u4e24\u4e2a\u503c\uff0c\u7b2c\u4e00\u4e2a\u503c\u8bbe\u7f6enginx\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4f1a\u8bdd\u7ed3\u675f\u540e\u4ecd\u65e7\u4fdd\u6301\u8fde\u63a5\u7684\u6700\u957f\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba4\u4e3a75s\u3002\n#\u7b2c\u4e8c\u4e2a\u503c\u53ef\u4ee5\u7701\u7565\uff0c\u5b83\u662f\u9488\u5bf9\u5ba2\u6237\u7aef\u7684\u6d4f\u89c8\u5668\u6765\u8bbe\u7f6e\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7curl -I\u770b\u5230header\u4fe1\u606f\u4e2d\u6709\u4e00\u9879Keep-Alive: timeout=60\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u5c31\u6ca1\u6709\u8fd9\u4e00\u9879\u3002\n#\u7b2c\u4e8c\u4e2a\u6570\u503c\u8bbe\u7f6e\u540e\uff0c\u6d4f\u89c8\u5668\u5c31\u4f1a\u6839\u636e\u8fd9\u4e2a\u6570\u503c\u51b3\u5b9a\u4f55\u65f6\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\uff0cNginx\u670d\u52a1\u5668\u5c31\u4e0d\u64cd\u5fc3\u4e86\u3002\u4f46\u6709\u7684\u6d4f\u89c8\u5668\u5e76\u4e0d\u8ba4\u53ef\u8be5\u53c2\u6570\u3002\nsend_timeout\n#\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u662f\u53d1\u9001\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5373Nginx\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u6570\u636e\u5305\uff0c\u4f46\u5ba2\u6237\u7aef\u4e00\u76f4\u6ca1\u6709\u53bb\u63a5\u6536\u8fd9\u4e2a\u6570\u636e\u5305\u3002\n#\u5982\u679c\u67d0\u4e2a\u8fde\u63a5\u8d85\u8fc7send_timeout\u5b9a\u4e49\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u90a3\u4e48Nginx\u5c06\u4f1a\u5173\u95ed\u8fd9\u4e2a\u8fde\u63a5\u3002\nclient_max_body_size 10m;\n#\u6d4f\u89c8\u5668\u5728\u53d1\u9001\u542b\u6709\u8f83\u5927HTTP\u5305\u4f53\u7684\u8bf7\u6c42\u65f6\uff0c\u5176\u5934\u90e8\u4f1a\u6709\u4e00\u4e2aContent-Length\u5b57\u6bb5\uff0cclient_max_body_size\u662f\u7528\u6765\u9650\u5236Content-Length\u6240\u793a\u503c\u7684\u5927\u5c0f\u7684\u3002\n#\u8fd9\u4e2a\u9650\u5236\u5305\u4f53\u7684\u914d\u7f6e\u4e0d\u7528\u7b49Nginx\u63a5\u6536\u5b8c\u6240\u6709\u7684HTTP\u5305\u4f53\uff0c\u5c31\u53ef\u4ee5\u544a\u8bc9\u7528\u6237\u8bf7\u6c42\u8fc7\u5927\u4e0d\u88ab\u63a5\u53d7\u3002\u4f1a\u8fd4\u56de413\u72b6\u6001\u7801\u3002\n#\u4f8b\u5982\uff0c\u7528\u6237\u8bd5\u56fe\u4e0a\u4f20\u4e00\u4e2a1GB\u7684\u6587\u4ef6\uff0cNginx\u5728\u6536\u5b8c\u5305\u5934\u540e\uff0c\u53d1\u73b0Content-Length\u8d85\u8fc7client_max_body_size\u5b9a\u4e49\u7684\u503c\uff0c\n#\u5c31\u76f4\u63a5\u53d1\u9001413(Request Entity Too Large)\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002\ngzip on\uff1b\n#\u662f\u5426\u5f00\u542fgzip\u538b\u7f29\u3002\ngzip_min_length 1k;\n#\u8bbe\u7f6e\u5141\u8bb8\u538b\u7f29\u7684\u9875\u9762\u6700\u5c0f\u5b57\u8282\u6570\uff0c\u9875\u9762\u5b57\u8282\u6570\u4eceheader\u5934\u5f97content-length\u4e2d\u8fdb\u884c\u83b7\u53d6\u3002\u9ed8\u8ba4\u503c\u662f20\u3002\u5efa\u8bae\u8bbe\u7f6e\u6210\u5927\u4e8e1k\u7684\u5b57\u8282\u6570\uff0c\u5c0f\u4e8e1k\u53ef\u80fd\u4f1a\u8d8a\u538b\u8d8a\u5927\u3002\ngzip_buffers 4 16k;\n#\u8bbe\u7f6e\u7cfb\u7edf\u83b7\u53d6\u51e0\u4e2a\u5355\u4f4d\u7684buffer\u7528\u4e8e\u5b58\u50a8gzip\u7684\u538b\u7f29\u7ed3\u679c\u6570\u636e\u6d41\u30024 16k\u4ee3\u8868\u5206\u914d4\u4e2a16k\u7684buffer\u3002\ngzip_http_version 1.1;\n#\u7528\u4e8e\u8bc6\u522b http \u534f\u8bae\u7684\u7248\u672c\uff0c\u65e9\u671f\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 Gzip \u538b\u7f29\uff0c\u7528\u6237\u4f1a\u770b\u5230\u4e71\u7801\uff0c\u6240\u4ee5\u4e3a\u4e86\u652f\u6301\u524d\u671f\u7248\u672c\u52a0\u4e0a\u4e86\u8fd9\u4e2a\u9009\u9879\u3002\n#\u5982\u679c\u4f60\u7528\u4e86Nginx\u53cd\u5411\u4ee3\u7406\u5e76\u671f\u671b\u4e5f\u542f\u7528Gzip\u538b\u7f29\u7684\u8bdd\uff0c\u7531\u4e8e\u672b\u7aef\u901a\u4fe1\u662fhttp/1.1\uff0c\u6545\u8bf7\u8bbe\u7f6e\u4e3a 1.1\u3002\ngzip_comp_level 6;\n#gzip\u538b\u7f29\u6bd4\uff0c1\u538b\u7f29\u6bd4\u6700\u5c0f\u5904\u7406\u901f\u5ea6\u6700\u5feb\uff0c9\u538b\u7f29\u6bd4\u6700\u5927\u4f46\u5904\u7406\u901f\u5ea6\u6700\u6162(\u4f20\u8f93\u5feb\u4f46\u6bd4\u8f83\u6d88\u8017cpu)\ngzip_types mime-type ... ;\n#\u5339\u914dmime\u7c7b\u578b\u8fdb\u884c\u538b\u7f29\uff0c\u65e0\u8bba\u662f\u5426\u6307\u5b9a,\u201dtext/html\u201d\u7c7b\u578b\u603b\u662f\u4f1a\u88ab\u538b\u7f29\u7684\u3002\n#\u5728conf/mime.conf\u91cc\u67e5\u770b\u5bf9\u5e94\u7684type\u3002\n\n#\u793a\u4f8b\uff1agzip_types       text/plain application/x-javascript text/css text/html application/xml;\ngzip_proxied any;\n#Nginx\u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\u7684\u65f6\u5019\u542f\u7528\uff0c\u51b3\u5b9a\u5f00\u542f\u6216\u8005\u5173\u95ed\u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5426\u538b\u7f29\uff0c\u5339\u914d\u7684\u524d\u63d0\u662f\u540e\u7aef\u670d\u52a1\u5668\u5fc5\u987b\u8981\u8fd4\u56de\u5305\u542b\u201dVia\u201d\u7684 header\u5934\u3002\n\n#\u4ee5\u4e0b\u4e3a\u53ef\u7528\u7684\u503c\uff1a\n#off - \u5173\u95ed\u6240\u6709\u7684\u4ee3\u7406\u7ed3\u679c\u6570\u636e\u7684\u538b\u7f29\n#expired - \u542f\u7528\u538b\u7f29\uff0c\u5982\u679cheader\u5934\u4e2d\u5305\u542b \"Expires\" \u5934\u4fe1\u606f\n#no-cache - \u542f\u7528\u538b\u7f29\uff0c\u5982\u679cheader\u5934\u4e2d\u5305\u542b \"Cache-Control:no-cache\" \u5934\u4fe1\u606f\n#no-store - \u542f\u7528\u538b\u7f29\uff0c\u5982\u679cheader\u5934\u4e2d\u5305\u542b \"Cache-Control:no-store\" \u5934\u4fe1\u606f\n#private - \u542f\u7528\u538b\u7f29\uff0c\u5982\u679cheader\u5934\u4e2d\u5305\u542b \"Cache-Control:private\" \u5934\u4fe1\u606f\n#no_last_modified - \u542f\u7528\u538b\u7f29,\u5982\u679cheader\u5934\u4e2d\u4e0d\u5305\u542b \"Last-Modified\" \u5934\u4fe1\u606f\n#no_etag - \u542f\u7528\u538b\u7f29 ,\u5982\u679cheader\u5934\u4e2d\u4e0d\u5305\u542b \"ETag\" \u5934\u4fe1\u606f\n#auth - \u542f\u7528\u538b\u7f29 , \u5982\u679cheader\u5934\u4e2d\u5305\u542b \"Authorization\" \u5934\u4fe1\u606f\n#any - \u65e0\u6761\u4ef6\u542f\u7528\u538b\u7f29\n#gzip_vary on\uff1b\n#\u548chttp\u5934\u6709\u5173\u7cfb\uff0c\u4f1a\u5728\u54cd\u5e94\u5934\u52a0\u4e2a Vary: Accept-Encoding \uff0c\u53ef\u4ee5\u8ba9\u524d\u7aef\u7684\u7f13\u5b58\u670d\u52a1\u5668\u7f13\u5b58\u7ecf\u8fc7gzip\u538b\u7f29\u7684\u9875\u9762\uff0c\u4f8b\u5982\uff0c\u7528Squid\u7f13\u5b58\u7ecf\u8fc7Nginx\u538b\u7f29\u7684\u6570\u636e\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#dserver","title":"D.server\u914d\u7f6e\u9879","text":"<pre><code>   server {\n    listen       80;  //\u76d1\u542c\u7aef\u53e3\u4e3a80\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5176\u4ed6\u7aef\u53e3\uff0c\u4e5f\u53ef\u4ee5\u52a0\u4e0aIP\u5730\u5740\uff0c\u5982\uff0clisten 127.0.0.1:8080;\n    server_name  localhost; //\u5b9a\u4e49\u7f51\u7ad9\u57df\u540d\uff0c\u53ef\u4ee5\u5199\u591a\u4e2a\uff0c\u7528\u7a7a\u683c\u5206\u9694\u3002\n    #charset koi8-r; //\u5b9a\u4e49\u7f51\u7ad9\u7684\u5b57\u7b26\u96c6\uff0c\u4e00\u822c\u4e0d\u8bbe\u7f6e\uff0c\u800c\u662f\u5728\u7f51\u9875\u4ee3\u7801\u4e2d\u8bbe\u7f6e\u3002\n    #access_log  logs/host.access.log  main; //\u5b9a\u4e49\u8bbf\u95ee\u65e5\u5fd7\uff0c\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e00\u4e2aserver\uff08\u5373\u6bcf\u4e00\u4e2a\u7ad9\u70b9\uff09\u8bbe\u7f6e\u5b83\u4eec\u81ea\u5df1\u7684\u8bbf\u95ee\u65e5\u5fd7\u3002\n\n    ##\u5728server{}\u91cc\u6709\u5f88\u591alocation\u914d\u7f6e\u6bb5\n    location / {\n        root   html;  //\u5b9a\u4e49\u7f51\u7ad9\u6839\u76ee\u5f55\uff0c\u76ee\u5f55\u53ef\u4ee5\u662f\u76f8\u5bf9\u8def\u5f84\u4e5f\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\u3002\n        index  index.html index.htm; //\u5b9a\u4e49\u7ad9\u70b9\u7684\u9ed8\u8ba4\u9875\u3002\n    }\n\n    #error_page  404              /404.html;  //\u5b9a\u4e49404\u9875\u9762\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;  //\u5f53\u72b6\u6001\u7801\u4e3a500\u3001502\u3001503\u3001504\u65f6\uff0c\u5219\u8bbf\u95ee50x.html\n    location = /50x.html {\n        root   html;  //\u5b9a\u4e4950x.html\u6240\u5728\u8def\u5f84\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #\u5b9a\u4e49\u8bbf\u95eephp\u811a\u672c\u65f6\uff0c\u5c06\u4f1a\u6267\u884c\u672clocation{}\u90e8\u5206\u6307\u4ee4\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;  //proxy_pass\u540e\u9762\u6307\u5b9a\u8981\u8bbf\u95ee\u7684url\u94fe\u63a5\uff0c\u7528proxy_pass\u5b9e\u73b0\u4ee3\u7406\u3002\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ {\n    #    root           html;\n    #    fastcgi_pass   127.0.0.1:9000;  //\u5b9a\u4e49FastCGI\u670d\u52a1\u5668\u76d1\u542c\u7aef\u53e3\u4e0e\u5730\u5740\uff0c\u652f\u6301\u4e24\u79cd\u5f62\u5f0f\uff0c1 IP:Port\uff0c 2 unix:/path/to/sockt\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;  //\u5b9a\u4e49SCRIPT_FILENAME\u53d8\u91cf\uff0c\u540e\u9762\u7684\u8def\u5f84/scripts\u4e3a\u4e0a\u9762\u7684root\u6307\u5b9a\u7684\u76ee\u5f55\n    #    include        fastcgi_params; //\u5f15\u7528prefix/conf/fastcgi_params\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5b9a\u4e49\u4e86fastcgi\u76f8\u5173\u7684\u53d8\u91cf\n    #}\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    # \n    #location ~ /\\.ht {   //\u8bbf\u95ee\u7684url\u4e2d\uff0c\u4ee5/.ht\u5f00\u5934\u7684\uff0c\u5982\uff0cwww.example.com/.htaccess\uff0c\u4f1a\u88ab\u62d2\u7edd\uff0c\u8fd4\u56de403\u72b6\u6001\u7801\u3002\n    #    deny  all;  //\u8fd9\u91cc\u7684all\u6307\u7684\u662f\u6240\u6709\u7684\u8bf7\u6c42\u3002\n    #}\n}\n\n\n# another virtual host using mix of IP-, name-, and port-based configuration\n#\n#server {\n#    listen       8000;  //\u76d1\u542c8000\u7aef\u53e3\n#    listen       somename:8080;  //\u6307\u5b9aip:port\n#    server_name  somename  alias  another.alias;  //\u6307\u5b9a\u591a\u4e2aserver_name\n\n#    location / {\n#        root   html;\n#        index  index.html index.htm;\n#    }\n#}\n\n\n# HTTPS server\n#\n#server {\n#    listen       443 ssl;  //\u76d1\u542c443\u7aef\u53e3\uff0c\u5373ssl\n#    server_name  localhost;\n\n### \u4ee5\u4e0b\u4e3assl\u76f8\u5173\u914d\u7f6e\n#    ssl_certificate      cert.pem;    //\u6307\u5b9apem\u6587\u4ef6\u8def\u5f84\n#    ssl_certificate_key  cert.key;  //\u6307\u5b9akey\u6587\u4ef6\u8def\u5f84\n\n#    ssl_session_cache    shared:SSL:1m;  //\u6307\u5b9asession cache\u5927\u5c0f\n#    ssl_session_timeout  5m;  //\u6307\u5b9asession\u8d85\u65f6\u65f6\u95f4\n#    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;   //\u6307\u5b9assl\u534f\u8bae\n#    ssl_ciphers  HIGH:!aNULL:!MD5;  //\u6307\u5b9assl\u7b97\u6cd5\n#    ssl_prefer_server_ciphers  on;  //\u4f18\u5148\u91c7\u53d6\u670d\u52a1\u5668\u7b97\u6cd5\n#    location / {\n#        root   html;\n#        index  index.html index.htm;\n#    }\n#}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#e","title":"E.\u8303\u4f8b","text":"<pre><code>user nobody; # \u5b9a\u4e49\u8fd0\u884cnginx\u670d\u52a1\u7684\u7528\u6237,\u8fd8\u53ef\u4ee5\u52a0\u4e0a\u7ec4,\u5982 user nobody nobody\n\nworker_processes  8; #\u5f00\u542f8\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\nworker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 10000000; #\u5c068\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u56fa\u5b9a\u57288\u4e2acpu\u4e0a\n\n#\u4ee5\u4e0b\u4e3a4\u6838CPU\u7684\u8303\u4f8b\n#worker_processes  4;\n#worker_cpu_affinity 0001 0010 0100 1000;\n\nerror_log logs/error.log crit; #\u5b9a\u4e49\u9519\u8bef\u65e5\u5fd7\u7684\u8def\u5f84\u548c\u7ea7\u522b\u3002\u9519\u8bef\u65e5\u5fd7\u7ea7\u522b\uff1a\u5e38\u89c1\u7684\u9519\u8bef\u65e5\u5fd7\u7ea7\u522b\u6709[debug|info|notice|warn|error|crit|alert|emerg]\uff0c\u7ea7\u522b\u8d8a\u9ad8\u8bb0\u5f55\u7684\u4fe1\u606f\u8d8a\u5c11\u3002\n\npid logs/nginx.pid; #\u5b9a\u4e49nginx\u8fdb\u7a0bpid\u6587\u4ef6\u6240\u5728\u8def\u5f84\uff0c\u53ef\u4ee5\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\u3002\n\nworker_rlimit_nofile 1024000; #\u5b9a\u4e49nginx\u6700\u591a\u6253\u5f00\u6587\u4ef6\u6570\u9650\u5236\u3002\u5982\u679c\u6ca1\u8bbe\u7f6e\u7684\u8bdd\uff0c\u8fd9\u4e2a\u503c\u4e3a\u64cd\u4f5c\u7cfb\u7edf\uff08ulimit -n\uff09\u7684\u9650\u5236\u4fdd\u6301\u4e00\u81f4\u3002\n\nevents {\n\n    use epoll; #Nginx\u670d\u52a1\u5668\u63d0\u4f9b\u4e86\u591a\u4e2a\u4e8b\u4ef6\u9a71\u52a8\u5668\u6a21\u578b\u6765\u5904\u7406\u7f51\u7edc\u6d88\u606f\u3002epol\u8fd9\u79cd\u65b9\u5f0f\u662f\u5728Linux 2.6+\u5185\u6838\u4e2d\u6700\u9ad8\u6548\u7684\u65b9\u5f0f\n    worker_connections  65535; #\u5b9a\u4e49\u6bcf\u4e2awork_process\u540c\u65f6\u5f00\u542f\u7684\u6700\u5927\u8fde\u63a5\u6570\uff0c\u5373\u5141\u8bb8\u6700\u591a\u53ea\u80fd\u6709\u8fd9\u4e48\u591a\u8fde\u63a5\u3002\n    accept_mutex on; #\u5f53\u67d0\u4e00\u4e2a\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5\u8bf7\u6c42\u670d\u52a1\u5668\u65f6\uff0c\u670d\u52a1\u5668\u4e0a\u6709\u591a\u4e2a\u7761\u7720\u7684\u8fdb\u7a0b\u4f1a\u88ab\u540c\u65f6\u53eb\u9192\uff0c\u8fd9\u6837\u4f1a\u635f\u8017\u4e00\u5b9a\u7684\u670d\u52a1\u5668\u6027\u80fd\u3002Nginx\u4e2d\u7684accept_mutex\u8bbe\u7f6e\u4e3aon\uff0c\u5c06\u4f1a\u5bf9\u591a\u4e2aNginx\u8fdb\u7a0b\uff08worker processer\uff09\u63a5\u6536\u8fde\u63a5\u65f6\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u9632\u6b62\u591a\u4e2a\u8fdb\u7a0b\u4e89\u62a2\u8d44\u6e90\u3002\n    multi_accept on; #nginx worker processer\u53ef\u4ee5\u505a\u5230\u540c\u65f6\u63a5\u6536\u591a\u4e2a\u65b0\u5230\u8fbe\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u524d\u63d0\u662f\u628a\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3aon\u3002\u9ed8\u8ba4\u4e3aoff\uff0c\u5373\u6bcf\u4e2aworker process\u4e00\u6b21\u53ea\u80fd\u63a5\u6536\u4e00\u4e2a\u65b0\u5230\u8fbe\u7684\u7f51\u7edc\u8fde\u63a5\u3002\n} \n\nhttp {\n    include        /etc/nginx/mime.types; # \u5b9a\u4e49nginx\u80fd\u8bc6\u522b\u7684\u7f51\u7edc\u8d44\u6e90\u5a92\u4f53\u7c7b\u578b\uff08\u5982\uff0c\u6587\u672c\u3001html\u3001js\u3001css\u3001\u6d41\u5a92\u4f53\u7b49\n    default_type  application/octet-stream; #\u5b9a\u4e49\u9ed8\u8ba4\u7684type\uff0c\u5982\u679c\u4e0d\u5b9a\u4e49\u8be5\u9879\uff0c\u9ed8\u8ba4\u4e3atext/plain.\n    client_max_body_size 1024M; #\u5b9a\u4e49\u5141\u8bb8\u6700\u5927\u53ef\u4ee5\u4e0a\u4f20\u591a\u5927\u7684\u6587\u4ef6\uff0c\u8d85\u8fc7\u8be5\u503c\u5c31\u4f1a\u62a5413\n    log_format main  '$remote_addr $http_x_forwarded_for [$time_local]'\n    '$host \"$request_uri\" $status'\n    '\"$http_referer\" \"$http_user_agent\"';\n    #\u8fd9\u91cc\u5b9a\u4e49\u65e5\u5fd7\u7684\u683c\u5f0f\uff0c\u5176\u4e2dmain\u4e3a\u65e5\u5fd7\u683c\u5f0f\u7684\u540d\u5b57\uff0c\u540e\u9762\u7684\u4e3anginx\u7684\u5185\u90e8\u53d8\u91cf\u7ec4\u6210\u7684\u4e00\u4e32\u5b57\u7b26\u4e32\u3002\n    sendfile        on; #\u4f7f\u7528\u5185\u6838\u7684FD\u6587\u4ef6\u4f20\u8f93\u529f\u80fd\uff0c\u53ef\u4ee5\u51cf\u5c11user mode\u548ckernel mode\u7684\u5207\u6362\uff0c\u4ece\u800c\u63d0\u5347\u670d\u52a1\u5668\u6027\u80fd\u3002\n    sendfile_max_chunk 128k; #\u8be5\u53c2\u6570\u9650\u5b9aNginx worker process\u6bcf\u6b21\u8c03\u7528sendfile()\u51fd\u6570\u4f20\u8f93\u6570\u636e\u7684\u6700\u5927\u503c\uff0c\u9ed8\u8ba4\u503c\u4e3a0\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a0\u5219\u65e0\u9650\u5236\u3002\n    tcp_nopush      on; #\u8bbe\u7f6e\u4e3aon\u65f6\uff0c\u4f1a\u8c03\u7528tcp_cork\u65b9\u6cd5\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\u5f53\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u6570\u636e\u65f6\uff0c\u5185\u6838\u4e0d\u4f1a\u7acb\u9a6c\u5c01\u88c5\u5305\uff0c\u800c\u662f\u5f53\u6570\u636e\u91cf\u79ef\u7d2f\u5230\u4e00\u5b9a\u91cf\u65f6\u624d\u4f1a\u5c01\u88c5\uff0c\u7136\u540e\u4f20\u8f93\u3002\n    tcp_nodelay     on; #\u4e0d\u7f13\u5b58data-sends\uff08\u5173\u95ed Nagle \u7b97\u6cd5\uff09\uff0c\u8fd9\u4e2a\u80fd\u591f\u63d0\u9ad8\u9ad8\u9891\u53d1\u9001\u5c0f\u6570\u636e\u62a5\u6587\u7684\u5b9e\u65f6\u6027\u3002\n    server_tokens   off;#\u5c06Nginx\u7248\u672c\u4fe1\u606f\u5173\u95ed\uff0c\u63d0\u5347\u5b89\u5168\u6027\u3002\n    keepalive_timeout 65 60; #\u8be5\u53c2\u6570\u6709\u4e24\u4e2a\u503c\uff0c\u7b2c\u4e00\u4e2a\u503c\u8bbe\u7f6enginx\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4f1a\u8bdd\u7ed3\u675f\u540e\u4ecd\u65e7\u4fdd\u6301\u8fde\u63a5\u7684\u6700\u957f\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba4\u4e3a75s\u3002\u7b2c\u4e8c\u4e2a\u503c\u53ef\u4ee5\u7701\u7565\uff0c\u5b83\u662f\u9488\u5bf9\u5ba2\u6237\u7aef\u7684\u6d4f\u89c8\u5668\u6765\u8bbe\u7f6e\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7curl -I\u770b\u5230header\u4fe1\u606f\u4e2d\u6709\u4e00\u9879Keep-Alive: timeout=60\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u5c31\u6ca1\u6709\u8fd9\u4e00\u9879\u3002\u7b2c\u4e8c\u4e2a\u6570\u503c\u8bbe\u7f6e\u540e\uff0c\u6d4f\u89c8\u5668\u5c31\u4f1a\u6839\u636e\u8fd9\u4e2a\u6570\u503c\u51b3\u5b9a\u4f55\u65f6\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\uff0cNginx\u670d\u52a1\u5668\u5c31\u4e0d\u64cd\u5fc3\u4e86\u3002\u4f46\u6709\u7684\u6d4f\u89c8\u5668\u5e76\u4e0d\u8ba4\u53ef\u8be5\u53c2\u6570\u3002\n    send_timeout 10; #\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u662f\u53d1\u9001\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5373Nginx\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u6570\u636e\u5305\uff0c\u4f46\u5ba2\u6237\u7aef\u4e00\u76f4\u6ca1\u6709\u53bb\u63a5\u6536\u8fd9\u4e2a\u6570\u636e\u5305\u3002\u5982\u679c\u67d0\u4e2a\u8fde\u63a5\u8d85\u8fc7send_timeout\u5b9a\u4e49\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u90a3\u4e48Nginx\u5c06\u4f1a\u5173\u95ed\u8fd9\u4e2a\u8fde\u63a5\u3002\n    client_header_timeout 15; #\u5ba2\u6237\u7aef\u5982\u679c\u5728\u8be5\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u52a0\u8f7d\u5b8c\u5934\u90e8\u6570\u636e\uff0c\u5219\u65ad\u5f00\u8fde\u63a5\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba460\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a15\u3002\n    client_body_timeout 120;  #\u5ba2\u6237\u7aef\u5982\u679c\u5728\u8be5\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u52a0\u8f7d\u5b8cbody\u6570\u636e\uff0c\u5219\u65ad\u5f00\u8fde\u63a5\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba460\uff0c\u5efa\u8bae\u5927\u4e00\u70b9\uff0c\u56e0\u4e3a\u6709\u65f6\u5019\u4e0b\u8f7d\u5927\u6587\u4ef6\u65f6\u95f4\u4f1a\u6bd4\u8f83\u4e45\u3002\n    client_body_buffer_size 128k; #\u5f53\u5ba2\u6237\u7aef\u4ee5POST\u65b9\u6cd5\u63d0\u4ea4\u4e00\u4e9b\u6570\u636e\u5230\u670d\u52a1\u7aef\u65f6\uff0c\u4f1a\u5148\u5199\u5165\u5230client_body_buffer\u4e2d\uff0c\u5982\u679cbuffer\u5199\u6ee1\u4f1a\u5199\u5230\u4e34\u65f6\u6587\u4ef6\u91cc\u3002\n    client_header_buffer_size 4k; #\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u90e8\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u6839\u636e\u4f60\u7684\u7cfb\u7edf\u5206\u9875\u5927\u5c0f\u6765\u8bbe\u7f6e\uff0c\u4e00\u822c\u4e00\u4e2a\u8bf7\u6c42\u5934\u7684\u5927\u5c0f\u4e0d\u4f1a\u8d85\u8fc71k\uff0c\u4e0d\u8fc7\u7531\u4e8e\u4e00\u822c\u7cfb\u7edf\u5206\u9875\u90fd\u8981\u5927\u4e8e1k,\u6240\u4ee5\u8fd8\u662f\u8981\u5927\u4e00\u4e9b\u3002\n    large_client_header_buffers 4 8k; #\u5bf9\u4e8e\u6bd4\u8f83\u5927\u7684header\uff08\u8d85\u8fc7client_header_buffer_size\uff09\u5c06\u4f1a\u4f7f\u7528\u8be5\u90e8\u5206buffer\uff0c\u4e24\u4e2a\u6570\u503c\uff0c\u7b2c\u4e00\u4e2a\u662f\u4e2a\u6570\uff0c\u7b2c\u4e8c\u4e2a\u662f\u6bcf\u4e2abuffer\u7684\u5927\u5c0f\u3002\n    open_file_cache max=204800 inactive=20s; #max\u8bbe\u5b9a\u7f13\u5b58\u6587\u4ef6\u7684\u6570\u91cf\uff0cinactive\u8bbe\u5b9a\u7ecf\u8fc7\u591a\u957f\u65f6\u95f4\u6587\u4ef6\u6ca1\u88ab\u8bf7\u6c42\u540e\u5220\u9664\u7f13\u5b58\u3002\n    open_file_cache_min_uses 1; #open_file_cache\u6307\u4ee4\u4e2d\u7684inactive\u53c2\u6570\u65f6\u95f4\u5185\u6587\u4ef6\u7684\u6700\u5c11\u4f7f\u7528\u6b21\u6570\uff0c\u5982,\u5c06\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a1\uff0c\u5219\u8868\u793a\uff0c\u5982\u679c\u6587\u4ef6\u5728inactive\u65f6\u95f4\u5185\u4e00\u6b21\u90fd\u6ca1\u88ab\u4f7f\u7528\uff0c\u5b83\u5c06\u88ab\u79fb\u9664\u3002\n    open_file_cache_valid 30s; #\u6307\u591a\u957f\u65f6\u95f4\u68c0\u67e5\u4e00\u6b21\u7f13\u5b58\u7684\u6709\u6548\u4fe1\u606f\u3002\u5efa\u8bae\u8bbe\u7f6e\u4e3a30s\u3002\n\n    gzip on;  #\u5f00\u542fgzip\u529f\u80fd\n    gzip_min_length 1024;  #\u8bbe\u7f6e\u8bf7\u6c42\u8d44\u6e90\u8d85\u8fc7\u8be5\u6570\u503c\u624d\u8fdb\u884c\u538b\u7f29\uff0c\u5355\u4f4d\u5b57\u8282\n    gzip_buffers 16 8k; #\u8bbe\u7f6e\u538b\u7f29\u4f7f\u7528\u7684buffer\u5927\u5c0f\uff0c\u7b2c\u4e00\u4e2a\u6570\u5b57\u4e3a\u6570\u91cf\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u6bcf\u4e2abuffer\u7684\u5927\u5c0f\n    gzip_comp_level 6; #\u8bbe\u7f6e\u538b\u7f29\u7ea7\u522b\uff0c\u8303\u56f41-9,9\u538b\u7f29\u7ea7\u522b\u6700\u9ad8\uff0c\u4e5f\u6700\u8017\u8d39CPU\u8d44\u6e90\n    gzip_types text/plain text/xhtml text/css text/js text/csv application/javascript application/x-javascript application/json application/xml text/xml application/atom+xml application/rss+xml application/vnd.android.package-archive application/vnd.iphone; #\u6307\u5b9a\u54ea\u4e9b\u7c7b\u578b\u7684\u6587\u4ef6\u9700\u8981\u538b\u7f29\n    gzip_disable \"MSIE 6\\.\"; #IE6\u6d4f\u89c8\u5668\u4e0d\u542f\u7528\u538b\u7f29\n    gzip_proxied any; #Nginx\u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406\u7684\u65f6\u5019\u542f\u7528\uff0c\u51b3\u5b9a\u5f00\u542f\u6216\u8005\u5173\u95ed\u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5426\u538b\u7f29\uff0c\u5339\u914d\u7684\u524d\u63d0\u662f\u540e\u7aef\u670d\u52a1\u5668\u5fc5\u987b\u8981\u8fd4\u56de\u5305\u542b\u201dVia\u201d\u7684 header\u5934\u3002\n\n    include conf.d/*.conf; #\u8981\u52a0\u8f7dconf.d/\u4e0b\u7684\u6240\u6709.conf\u914d\u7f6e\u6587\u4ef6\n}\n\n\n##\u4ee5\u4e0b\u4e3aconf.d/example.conf\u7684\u5185\u5bb9\nserver {\n\n    listen      443;  #\u76d1\u542c\u7aef\u53e3\u4e3a443\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5176\u4ed6\u7aef\u53e3\uff0c\u4e5f\u53ef\u4ee5\u52a0\u4e0aIP\u5730\u5740\uff0c\u5982\uff0clisten 127.0.0.1:8080;\n    server_name  aaa.com aaa.net; #\u5b9a\u4e49\u7f51\u7ad9\u57df\u540d\uff0c\u53ef\u4ee5\u5199\u591a\u4e2a\uff0c\u7528\u7a7a\u683c\u5206\u9694\u3002\n    #\u4ee5\u4e0b\u914d\u7f6e\u4e3a\u5f00\u542fssl\u8ba4\u8bc1\n    ssl_certificate sslkey/www.crt; #\u6307\u5b9acrt\u6587\u4ef6\u8def\u5f84\n    ssl_certificate_key sslkey/www.key; #\u6307\u5b9a\u79c1\u94a5\u6587\u4ef6\u8def\u5f84\n    ssl_session_cache   shared:SSL:10m; #\u8bbe\u7f6essl\u4f1a\u8bdd\u4f7f\u7528\u7684\u7f13\u5b58\u4e3a10M\n    ssl_session_timeout 10m; #ssl\u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\u4e3a10\u5206\u949f\n    ssl_protocols TLSv1.1 TLSv1.2; #ssl\u7248\u672c\uff0c\u4e0d\u8981\u52a01.0\u4e86\uff0c1.0\u4e0d\u5b89\u5168\n    ssl_ciphers AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:!aNULL:!eNULL:!MD5:!DH:!ECDH:!DHE:!ECDHE:!RC4:!EXPORT; #\u5f00\u542f\u6216\u8005\u5173\u95ed\u6307\u5b9a\u7b97\u6cd5,\u8fd9\u4e9b\u662f\u5b89\u5168\u6f0f\u6d1e\u5de5\u5177\u5efa\u8bae\u7684\u914d\u7f6e\n    ssl_prefer_server_ciphers on; #\u5982\u679c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u4e3aoff\uff0c\u5f53\u4e3aon\u65f6\uff0c\u670d\u52a1\u5668\u52a0\u5bc6\u7b97\u6cd5\u5c06\u4f18\u4e8e\u5ba2\u6237\u7aef\u52a0\u5bc6\u7b97\u6cd5\u3002\n\n    access_log  logs/host.access.log  main; #\u5b9a\u4e49\u8bbf\u95ee\u65e5\u5fd7\uff0c\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e00\u4e2aserver\uff08\u5373\u6bcf\u4e00\u4e2a\u7ad9\u70b9\uff09\u8bbe\u7f6e\u5b83\u4eec\u81ea\u5df1\u7684\u8bbf\u95ee\u65e5\u5fd7\u3002\n\n    ##\u5728server{}\u91cc\u6709\u5f88\u591alocation\u914d\u7f6e\u6bb5\n    location / {\n        root   html;  #\u5b9a\u4e49\u7f51\u7ad9\u6839\u76ee\u5f55\uff0c\u76ee\u5f55\u53ef\u4ee5\u662f\u76f8\u5bf9\u8def\u5f84\u4e5f\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\u3002\n        index  index.html index.htm; #\u5b9a\u4e49\u7ad9\u70b9\u7684\u9ed8\u8ba4\u9875\u3002\n    }\n\n    error_page  404              /404.html;  #\u5b9a\u4e49404\u9875\u9762\n    error_page   500 502 503 504  /50x.html;  #\u5f53\u72b6\u6001\u7801\u4e3a500\u3001502\u3001503\u3001504\u65f6\uff0c\u5219\u8bbf\u95ee50x.html\n    location = /50x.html {\n        root   html;  #\u5b9a\u4e4950x.html\u6240\u5728\u8def\u5f84\n    }\n\n    #\u5b9a\u4e49\u54ea\u4e9b\u76ee\u5f55\u4e0b\u7684php\u4e0d\u80fd\u8bbf\u95ee\uff0c\u4e00\u822c\u8981\u9650\u5236\u6240\u6709\u53ef\u5199\u7684\u76ee\u5f55\u4e0b\u7684php\n    location ~ .*(data|config|template|attachments|forumdata|attachment|images|log|conf|cache)/.*\\.php$ {\n        deny all;\n    }\n\n    #\u8bbe\u7f6e\u9632\u76d7\u94fe\uff0c\u4e0d\u8bb0\u5f55\u65e5\u5fd7\uff0c\u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\u4e3a7\u5929\n    location ~* ^.+\\.(swf|jpg|gif|bmp|png|jpeg|zip|rar)$ {\n         expires 7d;\n         access_log /dev/null;\n         valid_referers none blocked server_names *.aaa.net *.aaa.com;\n         if ($invalid_referer) {\n              return 403;\n         }\n    }\n    #js\u3001css\u4e0d\u8bb0\u5f55\u65e5\u5fd7\uff0c\u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\u4e3a7\u5929\n    location ~ .*\\.(js|css)$\n    {\n            expires      7d;\n            access_log off;\n    }\n\n    #\u9488\u5bf9php\u7684\u914d\u7f6e\n    location ~ \\.php$ {\n            #fastcgi_pass   unix:/tmp/55188_71-fpm.sock;\n            fastcgi_pass   127.0.0.1:9005; #\u8fd9\u4e2a\u662fphp-fpm\u7684\u76d1\u542c\u7aef\u53e3\uff0cnginx\u4f1a\u628aphp\u7684\u8bf7\u6c42\u8f6c\u53d1\u7ed9php-fpm\u5904\u7406\n            fastcgi_index  index.php;\n            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n            fastcgi_param  X-Real-IP $remote_addr;\n            include        fastcgi_params;\n        }\n\n    #\u9488\u5bf9admin.php\u505a\u9650\u5236\n    location  /admin.php \n    {\n    allow 12.13.12.12; #\u5141\u8bb8\u7684ip\n        allow 22.22.22.0/24; #\u5141\u8bb8\u7684ip\u6bb5\n        deny all;\n    }\n\n}\n\n## \u53cd\u5411\u4ee3\u7406\u793a\u4f8b\nserver {\n    listen 80;\n    server_name bbb.com;\n    proxy_buffering on; #\u8be5\u53c2\u6570\u8bbe\u7f6e\u662f\u5426\u5f00\u542fproxy\u7684buffer\u529f\u80fd, \u5982\u679c\u8fd9\u4e2a\u8bbe\u7f6e\u4e3aoff\uff0c\u90a3\u4e48proxy_buffers\u548cproxy_busy_buffers_size\u8fd9\u4e24\u4e2a\u6307\u4ee4\u5c06\u4f1a\u5931\u6548\n    proxy_buffer_size 4k; #\u8be5\u53c2\u6570\u7528\u6765\u8bbe\u7f6eheader\u7f13\u5b58\u7684\u5927\u5c0f\uff0c\u4e0d\u80fd\u4f4e\u4e8e4k\n    proxy_buffers 8 4k; #\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u5b58\u50a8\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u7684\u6570\u636e\u6240\u5360\u7528\u7684buffer\u7684\u4e2a\u6570\u548c\u6bcf\u4e2abuffer\u7684\u5927\u5c0f\u3002\n    proxy_busy_buffers_size 16k; #\u5728\u6240\u6709\u7684buffer\u91cc\uff0c\u6211\u4eec\u9700\u8981\u89c4\u5b9a\u4e00\u90e8\u5206buffer\u628a\u81ea\u5df1\u5b58\u7684\u6570\u636e\u4f20\u7ed9A\uff0c\u8fd9\u90e8\u5206buffer\u5c31\u53eb\u505abusy_buffer\uff0c\u8be5\u53c2\u6570\u7528\u6765\u8bbe\u7f6e\u5904\u4e8ebusy\u72b6\u6001\u7684buffer\u6709\u591a\u5927\u3002\n    proxy_temp_path /tmp/nginx_proxy_tmp 1 2; #\u5b9a\u4e49proxy\u7684\u4e34\u65f6\u6587\u4ef6\u5b58\u5728\u76ee\u5f55\u4ee5\u53ca\u76ee\u5f55\u7684\u5c42\u7ea7\uff0c1\u8868\u793a\u5c42\u7ea71\u7684\u76ee\u5f55\u540d\u4e3a\u4e00\u4e2a\u6570\u5b57(0-9),2\u8868\u793a\u5c42\u7ea72\u76ee\u5f55\u540d\u4e3a2\u4e2a\u6570\u5b57(00-99)\n    proxy_max_temp_file_size 100M; #\u8bbe\u7f6e\u4e34\u65f6\u6587\u4ef6\u7684\u603b\u5927\u5c0f\n    proxy_temp_file_write_size 16k; #\u8bbe\u7f6e\u540c\u65f6\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u91cf\u7684\u603b\u5927\u5c0f\n\n    location /\n    {\n        proxy_pass http://123.23.13.11/; #\u540e\u7aef\u670d\u52a1\u5668\u7684ip\u5730\u5740\n        proxy_set_header Host   $host; #\u8bbf\u95ee\u540e\u7aef\u670d\u52a1\u5668\u65f6\uff0c\u7528\u54ea\u4e2a\u57df\u540d\u8bbf\u95ee\u5462\uff0c\u8fd9\u91cc\u7684$host\u5c31\u662fserver_name\u3002\n        proxy_set_header X-Real-IP      $remote_addr; # \u7528\u6765\u8bbe\u7f6e\u88ab\u4ee3\u7406\u7aef\u63a5\u6536\u5230\u7684\u8fdc\u7a0b\u5ba2\u6237\u7aefIP\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u5219header\u4fe1\u606f\u4e2d\u5e76\u4e0d\u4f1a\u900f\u4f20\u8fdc\u7a0b\u771f\u5b9e\u5ba2\u6237\u7aef\u7684IP\u5730\u5740\u3002\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #\u540c\u4e0a\n    }\n} \n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#4","title":"4.\u67b6\u6784\u5206\u6790","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#anginx","title":"A.Nginx\u6a21\u5757\u5316","text":"<p>Nginx\u57fa\u4e8e\u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u6bcf\u4e2a\u6a21\u5757\u662f\u4e00\u4e2a\u529f\u80fd\u5b9e\u73b0\uff0c\u5206\u5e03\u5f0f\u5f00\u53d1\uff0c\u56e2\u961f\u534f\u4f5c</p> <p>\u6838\u5fc3\u6a21\u5757\u3001\u6807\u51c6HTTP\u6a21\u5757\u3001\u53ef\u9009HTTP\u6a21\u5757\u3001\u90ae\u4ef6\u6a21\u5757\u3001\u7b2c\u4e09\u65b9\u6a21\u5757</p> <p>\u7f16\u8bd1\u540e\u7684\u6e90\u7801\u76ee\u5f55objs/ngx_modules.c</p>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#bnginxweb","title":"B.Nginx\u7684web\u8bf7\u6c42\u673a\u5236","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_1","title":"\u540c\u6b65\u673a\u5236","text":"<pre><code>\u540c\u6b65\u3001\u5f02\u6b65\u53d1\u751f\u5728\u5f53\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u540e\uff0c\u670d\u52a1\u7aef\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u65f6\u3002\n\u540c\u6b65\u673a\u5236\uff0c\u662f\u6307\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u540e\uff0c\u9700\u8981\u7b49\u5f85\u670d\u52a1\u7aef\uff08\u5185\u6838\uff09\u8fd4\u56de\u4fe1\u606f\u540e\uff0c\u518d\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u3002\n\u5728\u540c\u6b65\u673a\u5236\u4e2d\uff0c\u6240\u6709\u7684\u8bf7\u6c42\u5728\u670d\u52a1\u5668\u7aef\u5f97\u5230\u540c\u6b65\uff0c\u5373\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u5bf9\u8bf7\u6c42\u7684\u5904\u7406\u6b65\u8c03\u662f\u4e00\u81f4\u7684\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_2","title":"\u5f02\u6b65\u673a\u5236","text":"<pre><code>\u5f02\u6b65\u673a\u5236\uff0c\u662f\u6307\u5ba2\u6237\u7aef\u53d1\u51fa\u4e00\u4e2a\u8bf7\u6c42\u540e\uff0c\u4e0d\u7b49\u5f85\u670d\u52a1\u7aef\uff08\u5185\u6838\uff09\u8fd4\u56de\u4fe1\u606f\uff0c\u5c31\u7ee7\u7eed\u53d1\u9001\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u3002\n\u5728\u5f02\u6b65\u673a\u5236\u4e2d\uff0c\u6240\u6709\u6765\u81ea\u53d1\u9001\u65b9\u7684\u8bf7\u6c42\u5f62\u6210\u4e00\u4e2a\u961f\u5217\uff0c\u63a5\u6536\u65b9\u5904\u7406\u5b8c\u540e\u518d\u901a\u77e5\u53d1\u9001\u65b9\u3002\n\n\n\u4e3e\u4f8b\uff1a\u4e00\u5bb6\u9152\u5e97\u524d\u53f0\uff0c\u5728\u65fa\u5b63\u7684\u9ad8\u5cf0\u65f6\u95f4\u6bb5\u4f1a\u63a5\u5f88\u591a\u9884\u5b9a\u9152\u5e2d\u7684\u7535\u8bdd\u3002\n\u5982\u679c\u662f\u540c\u6b65\u673a\u5236\u60c5\u51b5\u4e0b\uff0c\u524d\u53f0\u6bcf\u63a5\u4e00\u4e2a\u7535\u8bdd\u540e\u5148\u4e0d\u6302\u6389\u7535\u8bdd\uff0c\u800c\u662f\u53bb\u67e5\u8be2\u6709\u65e0\u5269\u4f59\u9152\u5e2d\uff0c\u67e5\u5230\u7ed3\u679c\u540e\uff0c\u544a\u8bc9\u5ba2\u6237\u3002\n\u5982\u679c\u662f\u5f02\u6b65\u673a\u5236\u60c5\u51b5\u4e0b\uff0c\u524d\u53f0\u6bcf\u63a5\u4e00\u4e2a\u9884\u5b9a\u7535\u8bdd\u76f4\u63a5\u56de\u590d\u5ba2\u6237\uff0c\u4e00\u4f1a\u56de\u590d\uff0c\u6b64\u65f6\u524d\u53f0\u628a\u67e5\u8be2\u8fd9\u4ef6\u4e8b\u60c5\u4ea4\u7ed9\u4e86\u53e6\u5916\u7684\u540c\u4e8b\uff0c\n\u8be5\u524d\u53f0\u6302\u6389\u7535\u8bdd\u540e\uff0c\u7ee7\u7eed\u5904\u7406\u5176\u4ed6\u5ba2\u6237\u7684\u4e8b\u60c5\uff0c\u5f53\u53e6\u5916\u7684\u540c\u4e8b\u67e5\u8be2\u5230\u7ed3\u679c\u540e\u518d\u901a\u77e5\u7ed9\u524d\u53f0\uff0c\u524d\u53f0\u518d\u901a\u77e5\u5ba2\u6237\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_3","title":"\u963b\u585e","text":"<pre><code>\u963b\u585e\u4e0e\u975e\u963b\u585e\u53d1\u751f\u5728IO\u8c03\u5ea6\u4e2d\uff0c\u6bd4\u5982\u5185\u6838\u5230\u78c1\u76d8IO\u3002\n\u963b\u585e\u65b9\u5f0f\u4e0b\uff0c\u8fdb\u7a0b/\u7ebf\u7a0b\u5728\u83b7\u53d6\u6700\u7ec8\u7ed3\u679c\u4e4b\u524d\uff0c\u88ab\u7cfb\u7edf\u6302\u8d77\u4e86\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684\u963b\u585e\u4e86\uff0c\u5728\u963b\u585e\u8fc7\u7a0b\u4e2d\u8be5\u8fdb\u7a0b\u4ec0\u4e48\u90fd\u5e72\u4e0d\u4e86\uff0c\n\u76f4\u5230\u6700\u7ec8\u7ed3\u679c\u53cd\u9988\u7ed9\u5b83\u65f6\uff0c\u5b83\u624d\u6062\u590d\u8fd0\u884c\u72b6\u6001\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_4","title":"\u975e\u963b\u585e","text":"<pre><code>\u975e\u963b\u585e\u65b9\u5f0f\u548c\u963b\u585e\u76f8\u53cd\uff0c\u8fdb\u7a0b/\u7ebf\u7a0b\u5728\u83b7\u53d6\u6700\u7ec8\u7ed3\u679c\u4e4b\u524d\uff0c\u5e76\u6ca1\u6709\u8fdb\u5165\u88ab\u6302\u8d77\u7684\u72b6\u6001\uff0c\u800c\u662f\u8be5\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u65b0\u7684\u4efb\u52a1\u3002\n\u5f53\u6709\u6700\u7ec8\u7ed3\u679c\u53cd\u9988\u7ed9\u8be5\u8fdb\u7a0b\u65f6\uff0c\u5b83\u518d\u628a\u7ed3\u679c\u4ea4\u7ed9\u5ba2\u6237\u7aef\u3002\n\n\u4e3e\u4f8b\uff1a\u4f9d\u7136\u662f\u9152\u5e97\u524d\u53f0\u63a5\u5f85\u9884\u5b9a\u9152\u5e2d\u7535\u8bdd\u7684\u6848\u4f8b\u3002\n\u6b64\u65f6\u89d2\u8272\u4e0d\u518d\u662f\u524d\u53f0\uff0c\u800c\u662f\u5979\u7684\u67e5\u8be2\u6709\u65e0\u5269\u4f59\u9152\u5e2d\u7684\u540c\u4e8b\u3002\u5982\u679c\u662f\u963b\u585e\u65b9\u5f0f\uff0c\u8be5\u540c\u4e8b\u5728\u67e5\u8be2\u6709\u65e0\u5269\u4f59\u9152\u5e2d\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u50bb\u50bb\u5730\n\u7b49\u5f85\u9152\u5e97\u7ba1\u7406\u7cfb\u7edf\u7ed9\u4ed6\u8fd4\u56de\u7ed3\u679c\uff0c\u5728\u6b64\u671f\u95f4\u4e0d\u80fd\u505a\u5176\u4ed6\u4e8b\u60c5\u3002\n\u5982\u679c\u662f\u975e\u963b\u585e\uff0c\u8be5\u540c\u4e8b\u5728\u7b49\u5f85\u9152\u5e97\u7ba1\u7406\u7cfb\u7edf\u7ed9\u4ed6\u8fd4\u56de\u7ed3\u679c\u8fd9\u6bb5\u65f6\u95f4\uff0c\u53ef\u4ee5\u505a\u5176\u4ed6\u4e8b\u60c5\uff0c\u6bd4\u5982\u53ef\u4ee5\u901a\u77e5\u524d\u53f0\u5269\u4f59\u9152\u5e2d\u7684\u60c5\u51b5\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_1","title":"Nginx\u7684\u8bf7\u6c42\u673a\u5236","text":"<pre><code>Nginx\u4e4b\u6240\u4ee5\u53ef\u4ee5\u652f\u6301\u9ad8\u5e76\u53d1\uff0c\u662f\u56e0\u4e3aNginx\u7528\u7684\u662f\u5f02\u6b65\u975e\u963b\u585e\u7684\u673a\u5236\uff0c\u800cNginx\u662f\u9760\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u6765\u5b9e\u73b0\u8fd9\u79cd\u673a\u5236\u7684\u3002\n\n\u5728Nginx\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u4e0b\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u7684\u6240\u6709\u8bf7\u6c42\u5728\u670d\u52a1\u7aef\u90fd\u4f1a\u88ab\u6807\u8bb0\u4e3a\u4e00\u4e2a\u4e8b\u4ef6\uff0cNginx\u4f1a\u628a\u8fd9\u4e9b\u4e8b\u4ef6\u6536\u96c6\u5230\u201c\u4e8b\u4ef6\u6536\u96c6\u5668\u201d\u91cc\uff0c\n\u7136\u540e\u518d\u628a\u8fd9\u4e9b\u4e8b\u4ef6\u4ea4\u7ed9\u5185\u6838\u53bb\u5904\u7406\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#c","title":"C.\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b","text":"<pre><code>\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u662f\u5b9e\u73b0\u5f02\u6b65\u975e\u963b\u585e\u7684\u4e00\u4e2a\u624b\u6bb5\u3002\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u4e2d\uff0c\u4e00\u4e2a\u8fdb\u7a0b\uff08\u7ebf\u7a0b\uff09\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5bf9\u4e8eweb\u670d\u52a1\u5668\u6765\u8bf4\uff0c\u5ba2\u6237\u7aefA\u7684\u8bf7\u6c42\u8fde\u63a5\u5230\u670d\u52a1\u7aef\u65f6\uff0c\u670d\u52a1\u7aef\u7684\u67d0\u4e2a\u8fdb\u7a0b\uff08Nginx worker process\uff09\u4f1a\u5904\u7406\u8be5\u8bf7\u6c42\uff0c\n\u6b64\u8fdb\u7a0b\u5728\u6ca1\u6709\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aefA\u7ed3\u679c\u65f6\uff0c\u5b83\u53c8\u53bb\u5904\u7406\u4e86\u5ba2\u6237\u7aefB\u7684\u8bf7\u6c42\u3002\n\u670d\u52a1\u7aef\u628a\u5ba2\u6237\u7aefA\u4ee5\u53ca\u5ba2\u6237\u7aefB\u53d1\u6765\u7684\u8bf7\u6c42\u4f5c\u4e3a\u4e8b\u4ef6\u4ea4\u7ed9\u4e86\u201c\u4e8b\u4ef6\u6536\u96c6\u5668\u201d\uff0c\n\u800c\u201c\u4e8b\u4ef6\u6536\u96c6\u5668\u201d\u518d\u628a\u6536\u96c6\u5230\u7684\u4e8b\u4ef6\u4ea4\u7531\u201c\u4e8b\u4ef6\u53d1\u9001\u5668\u201d\u53d1\u9001\u7ed9\u201c\u4e8b\u4ef6\u5904\u7406\u5668\u201d\u8fdb\u884c\u5904\u7406\u3002\n\u6700\u540e\u201c\u4e8b\u4ef6\u5904\u7406\u5668\u201d\u5904\u7406\u5b8c\u8be5\u4e8b\u4ef6\u540e\uff0c\u901a\u77e5\u670d\u52a1\u7aef\u8fdb\u7a0b\uff0c\u670d\u52a1\u7aef\u8fdb\u7a0b\u518d\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aefA\u3001\u5ba2\u6237\u7aefB\u3002\n\n\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u670d\u52a1\u7aef\u8fdb\u7a0b\u505a\u7684\u4e8b\u60c5\u5c5e\u4e8e\u7528\u6237\u7ea7\u522b\u7684\uff0c\u800c\u4e8b\u4ef6\u5904\u7406\u8fd9\u90e8\u5206\u5de5\u4f5c\u5c5e\u4e8e\u5185\u6838\u7ea7\u522b\u7684\u3002\n\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u662f\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u6765\u4f5c\u4e3a\u652f\u6491\u7684\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_2","title":"Nginx\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b","text":"<pre><code>Nginx\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\uff0c\u652f\u6301select\u3001poll\u3001epoll\u3001rtsig\u3001kqueue\u3001/dev/poll\u3001eventport\u7b49\u3002\n\u6700\u5e38\u7528\u7684\u662f\u524d\u4e09\u79cd\uff0c\u5176\u4e2dkqueue\u6a21\u578b\u7528\u4e8e\u652f\u6301BSD\u7cfb\u5217\u5e73\u53f0\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u3002kqueue\u662fpoll\u6a21\u578b\u7684\u4e00\u4e2a\u53d8\u79cd\uff0c\u672c\u8d28\u4e0a\u548cepoll\u4e00\u6837\u3002\n/dev/poll\u662fUnix\u5e73\u53f0\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\uff0c\u5176\u4e3b\u8981\u5728Solaris7\u53ca\u4ee5\u4e0a\u7248\u672c\u3001HP/UX11.22\u53ca\u4ee5\u4e0a\u7248\u672c\u3001IRIX6.5.15\u53ca\u4ee5\u4e0a\u7248\u672c\u3001\nTru64 Unix 5.1A\u53ca\u4ee5\u4e0a\u7248\u672c\u7684\u5e73\u53f0\u4f7f\u7528\u3002\neventport\u662f\u7528\u4e8e\u652f\u6301Solaris10\u53ca\u4ee5\u4e0a\u7248\u672c\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#select","title":"select\u6a21\u578b","text":"<pre><code>Linux\u548cWindows\u90fd\u652f\u6301\uff0c\u4f7f\u7528select\u6a21\u578b\u7684\u6b65\u9aa4\u662f\uff1a\n\n1. \u521b\u5efa\u6240\u5173\u6ce8\u4e8b\u4ef6\u7684\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u63cf\u8ff0\u7b26\uff0c\u53ef\u4ee5\u5173\u6ce8\u5176\u4e0a\u9762\u7684\u8bfb(Read)\u4e8b\u4ef6\u3001\u5199(Write)\u4e8b\u4ef6\u4ee5\u53ca\u5f02\u5e38\u53d1\u751f(Exception)\u4e8b\u4ef6\u3002\n\u5728select\u6a21\u578b\u4e2d\uff0c\u8981\u521b\u5efa\u8fd93\u7c7b\u4e8b\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u3002\n\n2. \u8c03\u7528\u5e95\u5c42\u63d0\u4f9b\u7684select()\u51fd\u6570\uff0c\u7b49\u5f85\u4e8b\u4ef6\u53d1\u751f\u3002\n\n3. \u8f6e\u8be2\u6240\u6709\u4e8b\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u4e2d\u7684\u6bcf\u4e00\u4e2a\u4e8b\u4ef6\u63cf\u8ff0\u7b26\uff0c\u68c0\u67e5\u662f\u5426\u6709\u76f8\u5e94\u7684\u4e8b\u4ef6\u53d1\u751f\uff0c\u5982\u679c\u6709\u5c31\u8fdb\u884c\u5904\u7406\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#poll","title":"poll\u6a21\u578b","text":"<pre><code>poll\u6a21\u578b\u662fLinux\u5e73\u53f0\u4e0a\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\uff0c\u5728Linux2.1.23\u4e2d\u5f15\u5165\u7684\uff0cWindows\u5e73\u53f0\u4e0d\u652f\u6301\u8be5\u6a21\u578b\u3002\n\npoll\u6a21\u578b\u548cselect\u6a21\u578b\u5de5\u4f5c\u65b9\u5f0f\u57fa\u672c\u76f8\u540c\uff0c\u533a\u522b\u5728\u4e8e\uff0cselect\u6a21\u578b\u521b\u5efa\u4e863\u4e2a\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\u800cpoll\u6a21\u578b\u53ea\u521b\u5efa\u4e00\u4e2a\u63cf\u8ff0\u7b26\u96c6\u5408\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#epoll","title":"epoll\u6a21\u578b","text":"<pre><code>epoll\u6a21\u578b\u5c5e\u4e8epoll\u6a21\u578b\u7684\u53d8\u79cd\uff0c\u5728Linux2.5.44\u4e2d\u5f15\u5165\u3002epoll\u6bd4poll\u66f4\u52a0\u9ad8\u6548\uff0c\u539f\u56e0\u5728\u4e8e\u5b83\u4e0d\u9700\u8981\u8f6e\u8be2\u6574\u4e2a\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\n\u800c\u662fLinux\u5185\u6838\u4f1a\u5173\u6ce8\u4e8b\u4ef6\u96c6\u5408\uff0c\u5f53\u6709\u53d8\u52a8\u65f6\uff0c\u5185\u6838\u4f1a\u53d1\u6765\u901a\u77e5\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#dnginx","title":"D.Nginx\u67b6\u6784","text":"<pre><code>Nginx\u670d\u52a1\u5668\u4f7f\u7528 master/worker \u591a\u8fdb\u7a0b\u6a21\u5f0f\u3002\n\u4e3b\u8fdb\u7a0b(Master process)\u542f\u52a8\u540e\uff0c\u4f1a\u63a5\u6536\u548c\u5904\u7406\u5916\u90e8\u4fe1\u53f7\uff1b\n\u4e3b\u8fdb\u7a0b\u542f\u52a8\u540e\u901a\u8fc7fork() \u51fd\u6570\u4ea7\u751f\u4e00\u4e2a\u6216\u591a\u4e2a\u5b50\u8fdb\u7a0b(work process)\uff0c\u6bcf\u4e2a\u5b50\u8fdb\u7a0b\u4f1a\u8fdb\u884c\u8fdb\u7a0b\u521d\u59cb\u5316\u3001\n\u6a21\u5757\u8c03\u7528\u4ee5\u53ca\u5bf9\u4e8b\u4ef6\u7684\u63a5\u6536\u548c\u5904\u7406\u7b49\u5de5\u4f5c\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_5","title":"\u4e3b\u8fdb\u7a0b","text":"<pre><code>\u4e3b\u8981\u529f\u80fd\u662f\u548c\u5916\u754c\u901a\u4fe1\u548c\u5bf9\u5185\u90e8\u5176\u4ed6\u8fdb\u7a0b\u8fdb\u884c\u7ba1\u7406\uff0c\u5177\u4f53\u6765\u8bf4\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a\n\n* \u8bfb\u53d6Nginx\u914d\u7f6e\u6587\u4ef6\u5e76\u9a8c\u8bc1\u5176\u6709\u6548\u6027\u548c\u6b63\u786e\u6027\n\n* \u5efa\u7acb\u3001\u7ed1\u5b9a\u548c\u5173\u95edsocket\n\n* \u6309\u7167\u914d\u7f6e\u751f\u6210\u3001\u7ba1\u7406\u5de5\u4f5c\u8fdb\u7a0b\n\n* \u63a5\u6536\u5916\u754c\u6307\u4ee4\uff0c\u6bd4\u5982\u91cd\u542f\u3001\u5173\u95ed\u3001\u91cd\u8f7d\u670d\u52a1\u7b49\u6307\u4ee4\n\n* \u65e5\u5fd7\u6587\u4ef6\u7ba1\u7406\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#worker-process","title":"\u5b50\u8fdb\u7a0b\uff08worker process)","text":"<pre><code>\u662f\u7531\u4e3b\u8fdb\u7a0b\u751f\u6210\uff0c\u751f\u6210\u6570\u91cf\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u4e49\u3002\u8be5\u8fdb\u7a0b\u4e3b\u8981\u5de5\u4f5c\u6709\uff1a\n\n* \u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\n\n* \u5c06\u8bf7\u6c42\u4f9d\u6b21\u9001\u5165\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u8fdb\u884c\u8fc7\u6ee4\u5904\u7406\n\n* IO\u8c03\u7528\uff0c\u83b7\u53d6\u54cd\u5e94\u6570\u636e\n\n* \u4e0e\u540e\u7aef\u670d\u52a1\u5668\u901a\u4fe1\uff0c\u63a5\u6536\u540e\u7aef\u670d\u52a1\u5668\u5904\u7406\u7ed3\u679c\n\n* \u6570\u636e\u7f13\u5b58\uff0c\u8bbf\u95ee\u7f13\u5b58\u7d22\u5f15\uff0c\u67e5\u8be2\u548c\u8c03\u7528\u7f13\u5b58\u6570\u636e\n\n* \u53d1\u9001\u8bf7\u6c42\u7ed3\u679c\uff0c\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42\n\n* \u63a5\u6536\u4e3b\u8fdb\u7a0b\u6307\u4ee4\uff0c\u5982\u91cd\u542f\u3001\u91cd\u8f7d\u3001\u9000\u51fa\u7b49\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#5","title":"5.\u865a\u62df\u4e3b\u673a\u914d\u7f6e","text":"<pre><code>user nobody; # \u5b9a\u4e49\u8fd0\u884cnginx\u670d\u52a1\u7684\u7528\u6237,\u8fd8\u53ef\u4ee5\u52a0\u4e0a\u7ec4,\u5982 user nobody nobody\nworker_processes  1;\nevents {\n    worker_connections  1024;\n}\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n    include vhost/*.conf; #\u5305\u542bvhost\u4e0b\u7684.conf\u6587\u4ef6\n}\n</code></pre> <pre><code>mkdir /usr/local/nginx/conf/vhost\nvi /usr/local/nginx/conf/vhost/www.1.com.conf\n    server{\n    listen 80;\n    server_name www.1.com;\n    root /data/wwwroot/www.1.com;\n    index index.html index.htm;\n    }\nvi /usr/local/nginx/conf/vhost/www.1.com.conf\n    server{\n    listen 80;\n    server_name *.2.com 2.com;\n    root /data/wwwroot/www.2.com;\n    index index.html index.htm;\n    }\nvi /usr/local/nginx/conf/vhost/default.conf\n    server{\n        listen 80 default_server;\n        deny all;\n    }\nmkdir -p /data/wwwroot\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#6rewrite","title":"6.rewrite\u914d\u7f6e","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_3","title":"nginx \u5e38\u7528\u5168\u5c40\u53d8\u91cf","text":"\u53d8\u91cf \u8bf4\u660e $args \u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\uff0c\u5982www.123.com/1.php?a=1&amp;b=2\u7684$args\u5c31\u662fa=1&amp;b=2 $content_length HTTP\u8bf7\u6c42\u4fe1\u606f\u91cc\u7684\"Content-Length\" $conten_type HTTP\u8bf7\u6c42\u4fe1\u606f\u91cc\u7684\"Content-Type\" $document_root nginx\u865a\u62df\u4e3b\u673a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684root\u53c2\u6570\u5bf9\u5e94\u7684\u503c $document_uri \u5f53\u524d\u8bf7\u6c42\u4e2d\u4e0d\u5305\u542b\u6307\u4ee4\u7684URI\uff0c\u5982www.123.com/1.php?a=1&amp;b=2\u7684$document_uri\u5c31\u662f1.php,\u4e0d\u5305\u542b\u540e\u9762\u7684\u53c2\u6570 $host \u4e3b\u673a\u5934\uff0c\u4e5f\u5c31\u662f\u57df\u540d $http_user_agent \u5ba2\u6237\u7aef\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u6d4f\u89c8\u5668\u7684\u6807\u8bc6\uff0c\u7528curl -A\u53ef\u4ee5\u6307\u5b9a $http_cookie \u5ba2\u6237\u7aef\u7684cookie\u4fe1\u606f $limit_rate \u5982\u679cnginx\u670d\u52a1\u5668\u4f7f\u7528limit_rate\u914d\u7f6e\u4e86\u663e\u793a\u7f51\u7edc\u901f\u7387\uff0c\u5219\u4f1a\u663e\u793a\uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c \u5219\u663e\u793a0 $remote_addr \u5ba2\u6237\u7aef\u7684\u516c\u7f51ip $remote_port \u5ba2\u6237\u7aef\u7684port $remote_user \u5982\u679cnginx\u6709\u914d\u7f6e\u8ba4\u8bc1\uff0c\u8be5\u53d8\u91cf\u4ee3\u8868\u5ba2\u6237\u7aef\u8ba4\u8bc1\u7684\u7528\u6237\u540d $request_body_file \u505a\u53cd\u5411\u4ee3\u7406\u65f6\u53d1\u7ed9\u540e\u7aef\u670d\u52a1\u5668\u7684\u672c\u5730\u8d44\u6e90\u7684\u540d\u79f0 $request_method \u8bf7\u6c42\u8d44\u6e90\u7684\u65b9\u5f0f\uff0cGET/PUT/DELETE\u7b49 $request_filename \u5f53\u524d\u8bf7\u6c42\u7684\u8d44\u6e90\u6587\u4ef6\u7684\u8def\u5f84\u540d\u79f0\uff0c\u76f8\u5f53\u4e8e\u662f\\(document_root/\\)document_uri\u7684\u7ec4\u5408 $request_uri \u8bf7\u6c42\u7684\u94fe\u63a5\uff0c\u5305\u62ec\\(document_uri\u548c\\)args $scheme \u8bf7\u6c42\u7684\u534f\u8bae\uff0c\u5982ftp,http,https $server_protocol \u5ba2\u6237\u7aef\u8bf7\u6c42\u8d44\u6e90\u4f7f\u7528\u7684\u534f\u8bae\u7684\u7248\u672c\uff0c\u5982HTTP/1.0\uff0cHTTP/1.1\uff0cHTTP/2.0\u7b49 $server_addr \u670d\u52a1\u5668IP\u5730\u5740 $server_name \u670d\u52a1\u5668\u7684\u4e3b\u673a\u540d $server_port \u670d\u52a1\u5668\u7684\u7aef\u53e3\u53f7 $uri \u548c$document_uri\u76f8\u540c $http_referer \u5ba2\u6237\u7aef\u8bf7\u6c42\u65f6\u7684referer\uff0c\u901a\u4fd7\u8bb2\u5c31\u662f\u8be5\u8bf7\u6c42\u662f\u901a\u8fc7\u54ea\u4e2a\u94fe\u63a5\u8df3\u8fc7\u6765\u7684\uff0c\u7528curl -e\u53ef\u4ee5\u6307\u5b9a"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#if","title":"if\u6761\u4ef6\u4e3e\u4f8b","text":"<pre><code>\u6761\u4ef6\u5224\u65ad\u8bed\u53e5\u7531Nginx\u5185\u7f6e\u53d8\u91cf\u3001\u903b\u8f91\u5224\u65ad\u7b26\u53f7\u548c\u76ee\u6807\u5b57\u7b26\u4e32\u4e09\u90e8\u5206\u7ec4\u6210\u3002\n\u5176\u4e2d\uff0c\u5185\u7f6e\u53d8\u91cf\u662fNginx\u56fa\u5b9a\u7684\u975e\u81ea\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5982\uff0c$request_method, $request_uri\u7b49\u3002\n\u903b\u8f91\u5224\u65ad\u7b26\u53f7\uff0c\u6709=, !=, ~, ~*, !~, !~*\n!\u8868\u793a\u76f8\u53cd\u7684\u610f\u601d\uff0c~\u4e3a\u5339\u914d\u7b26\u53f7\uff0c\u5b83\u53f3\u4fa7\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u533a\u5206\u5927\u5c0f\u5199\uff0c\u800c~*\u4e3a\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u5339\u914d\u3002\n\u76ee\u6807\u5b57\u7b26\u4e32\u53ef\u4ee5\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u901a\u5e38\u4e0d\u7528\u52a0\u5f15\u53f7\uff0c\u4f46\u8868\u8fbe\u5f0f\u4e2d\u6709\u7279\u6b8a\u7b26\u53f7\u65f6\uff0c\u6bd4\u5982\u7a7a\u683c\u3001\u82b1\u62ec\u53f7\u3001\u5206\u53f7\u7b49\uff0c\u9700\u8981\u7528\u5355\u5f15\u53f7\u5f15\u8d77\u6765\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1","title":"\u793a\u4f8b1","text":"<pre><code>nginxif ($request_method = POST)  //\u5f53\u8bf7\u6c42\u7684\u65b9\u6cd5\u4e3aPOST\u65f6\uff0c\u76f4\u63a5\u8fd4\u56de405\u72b6\u6001\u7801\n{\n    return 405; //\u5728\u8be5\u793a\u4f8b\u4e2d\u5e76\u672a\u7528\u5230rewrite\u89c4\u5219\uff0cif\u4e2d\u652f\u6301\u7528return\u6307\u4ee4\u3002\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2","title":"\u793a\u4f8b2","text":"<pre><code>if ($http_user_agent ~ MSIE) //user_agent\u5e26\u6709MSIE\u5b57\u7b26\u7684\u8bf7\u6c42\uff0c\u76f4\u63a5\u8fd4\u56de403\u72b6\u6001\u7801\n{\n    return 403;\n}\n\n\u5982\u679c\u60f3\u540c\u65f6\u9650\u5236\u591a\u4e2auser_agent\uff0c\u8fd8\u53ef\u4ee5\u5199\u6210\u8fd9\u6837\n\nif ($http_user_agent ~ \"MSIE|firefox|spider\")\n{\n    return 403;\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#3","title":"\u793a\u4f8b3","text":"<pre><code>if(!-f $request_filename)  //\u5f53\u8bf7\u6c42\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5c06\u4f1a\u6267\u884c\u4e0b\u9762\u7684rewrite\u89c4\u5219\n{\n    rewrite \u8bed\u53e5;\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#4_1","title":"\u793a\u4f8b4","text":"<pre><code>if($request_uri ~* 'gid=\\d{9,12}/')  //\\d\u8868\u793a\u6570\u5b57\uff0c{9,12}\u8868\u793a\u6570\u5b57\u51fa\u73b0\u7684\u6b21\u6570\u662f9\u523012\u6b21\uff0c\u5982gid=123456789/\u5c31\u662f\u7b26\u5408\u6761\u4ef6\u7684\u3002\n{\n    rewrite \u8bed\u53e5;\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#rewritebreaklast","title":"rewrite\u4e2d\u7684break\u548clast","text":"<pre><code>\u4e24\u4e2a\u6307\u4ee4\u7528\u6cd5\u76f8\u540c\uff0c\u4f46\u542b\u4e49\u4e0d\u540c\uff0c\u9700\u8981\u653e\u5230rewrite\u89c4\u5219\u7684\u672b\u5c3e\uff0c\u7528\u6765\u63a7\u5236\u91cd\u5199\u540e\u7684\u94fe\u63a5\u662f\u5426\u7ee7\u7eed\u88abnginx\u914d\u7f6e\u6267\u884c(\u4e3b\u8981\u662frewrite\u3001return\u6307\u4ee4)\u3002\n\n\u793a\u4f8b1\uff08\u8fde\u7eed\u4e24\u6761rewrite\u89c4\u5219\uff09\uff1a\nserver{\n    listen 80; \n    server_name test.com;\n    root /tmp/123.com;\n\n    rewrite /1.html /2.html ;\n    rewrite /2.html /3.html ;\n\n}\n\u5f53\u6211\u4eec\u8bf7\u6c421.html\u65f6\uff0c\u6700\u7ec8\u8bbf\u95ee\u5230\u7684\u662f3.html\uff0c\u4e24\u6761rewrite\u89c4\u5219\u5148\u540e\u6267\u884c\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#breaklastlocation","title":"break\u548clast\u5728location {}\u5916\u90e8","text":"<pre><code>\u683c\u5f0f\uff1arewrite xxxxx  break;\n\n\u793a\u4f8b2\uff08\u589e\u52a0break\uff09\uff1a\nserver{\n    listen 80; \n    server_name test.com;\n    root /tmp/123.com;\n\n    rewrite /1.html /2.html break;\n    rewrite /2.html /3.html;\n}\n\u5f53\u6211\u4eec\u8bf7\u6c421.html\u65f6\uff0c\u6700\u7ec8\u8bbf\u95ee\u5230\u7684\u662f2.html\n\u8bf4\u660ebreak\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u4f5c\u7528\u662f\u4e0d\u518d\u6267\u884cbreak\u4ee5\u4e0b\u7684rewrite\u89c4\u5219\u3002\n\n\u4f46\uff0c\u5f53\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709location\u65f6\uff0c\u5b83\u8fd8\u4f1a\u53bb\u6267\u884clocation{}\u6bb5\u7684\u914d\u7f6e\uff08\u8bf7\u6c42\u8981\u5339\u914d\u8be5location\uff09\u3002\n\n\u793a\u4f8b3\uff08break\u540e\u9762\u8fd8\u6709location\u6bb5\uff09\uff1a\nserver{\n    listen 80; \n    server_name test.com;\n    root /tmp/123.com;\n\n    rewrite /1.html /2.html break;\n    rewrite /2.html /3.html;\n    location /2.html {\n        return 403;\n    }\n}\n\u5f53\u8bf7\u6c421.html\u65f6\uff0c\u6700\u7ec8\u4f1a\u8fd4\u56de403\u72b6\u6001\u7801\uff0c\u8bf4\u660e\u5b83\u53bb\u5339\u914d\u4e86break\u540e\u9762\u7684location{}\u914d\u7f6e\u3002\n\n\u4ee5\u4e0a2\u4e2a\u793a\u4f8b\u4e2d\uff0c\u53ef\u4ee5\u628abreak\u66ff\u6362\u4e3alast\uff0c\u5b83\u4eec\u4e24\u8005\u8d77\u5230\u7684\u6548\u679c\u4e00\u6a21\u4e00\u6837\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#breaklastlocation_1","title":"\u5f53break\u548clast\u5728location{}\u91cc\u9762","text":"<pre><code>\u793a\u4f8b4\uff08\u4ec0\u4e48\u90fd\u4e0d\u52a0\uff09\uff1a\nserver{\n    listen 80; \n    server_name test.com;\n    root /tmp/123.com;\n\n    location / {\n        rewrite /1.html /2.html;\n        rewrite /2.html /3.html;\n    }\n    location /2.html\n    {\n        rewrite /2.html /a.html;\n    }\n    location /3.html\n    {\n        rewrite /3.html /b.html;\n    }\n}\n\u5f53\u8bf7\u6c42/1.html\uff0c\u6700\u7ec8\u5c06\u4f1a\u8bbf\u95ee/b.html\uff0c\u8fde\u7eed\u6267\u884clocation /\u4e0b\u7684\u4e24\u6b21rewrite\uff0c\u8df3\u8f6c\u5230\u4e86/3.html\uff0c\u7136\u540e\u53c8\u5339\u914dlocation /3.html\n\n\u793a\u4f8b5\uff08\u589e\u52a0break\uff09\uff1a\nserver{\n    listen 80; \n    server_name test.com;\n    root /tmp/123.com;\n\n    location / {\n        rewrite /1.html /2.html break;\n        rewrite /2.html /3.html;\n    }\n    location /2.html\n    {\n        rewrite /2.html /a.html;\n    }\n    location /3.html\n    {\n        rewrite /3.html /b.html;\n    }\n}\n\u5f53\u8bf7\u6c42/1.html\uff0c\u6700\u7ec8\u4f1a\u8bbf\u95ee/2.html\n\u5728location{}\u5185\u90e8\uff0c\u9047\u5230break\uff0c\u672clocation{}\u5185\u4ee5\u53ca\u540e\u9762\u7684\u6240\u6709location{}\u5185\u7684\u6240\u6709\u6307\u4ee4\u90fd\u4e0d\u518d\u6267\u884c\u3002\n\n\n\u793a\u4f8b6\uff08\u589e\u52a0last\uff09:\nserver{\n    listen 80; \n    server_name test.com;\n    root /tmp/123.com;\n\n    location / {\n        rewrite /1.html /2.html last;\n        rewrite /2.html /3.html;\n    }\n    location /2.html\n    {\n        rewrite /2.html /a.html;\n    }\n    location /3.html\n    {\n        rewrite /3.html /b.html;\n    }\n}\n\u5f53\u8bf7\u6c42/1.html\uff0c\u6700\u7ec8\u4f1a\u8bbf\u95ee/a.html\n\u5728location{}\u5185\u90e8\uff0c\u9047\u5230last\uff0c\u672clocation{}\u5185\u540e\u7eed\u6307\u4ee4\u4e0d\u518d\u6267\u884c\uff0c\u800c\u91cd\u5199\u540e\u7684url\u518d\u6b21\u4ece\u5934\u5f00\u59cb\uff0c\u4ece\u5934\u5230\u5c3e\u5339\u914d\u4e00\u904d\u89c4\u5219\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_6","title":"\u7ed3\u8bba","text":"<ul> <li>\u5f53rewrite\u89c4\u5219\u5728location{}\u5916\uff0cbreak\u548clast\u4f5c\u7528\u4e00\u6837\uff0c\u9047\u5230break\u6216last\u540e\uff0c\u5176\u540e\u7eed\u7684rewrite/return\u8bed\u53e5\u4e0d\u518d\u6267\u884c\u3002\u4f46\u540e\u7eed\u6709location{}\u7684\u8bdd\uff0c\u8fd8\u4f1a\u8fd1\u4e00\u6b65\u6267\u884clocation{}\u91cc\u9762\u7684\u8bed\u53e5,\u5f53\u7136\u524d\u63d0\u662f\u8bf7\u6c42\u5fc5\u987b\u8981\u5339\u914d\u8be5location\u3002</li> <li>\u5f53rewrite\u89c4\u5219\u5728location{}\u91cc\uff0c\u9047\u5230break\u540e\uff0c\u672clocation{}\u4e0e\u5176\u4ed6location{}\u7684\u6240\u6709rewrite/return\u89c4\u5219\u90fd\u4e0d\u518d\u6267\u884c\u3002</li> <li>\u5f53rewrite\u89c4\u5219\u5728location{}\u91cc\uff0c\u9047\u5230last\u540e\uff0c\u672clocation{}\u91cc\u540e\u7eedrewrite/return\u89c4\u5219\u4e0d\u6267\u884c\uff0c\u4f46\u91cd\u5199\u540e\u7684url\u518d\u6b21\u4ece\u5934\u5f00\u59cb\u6267\u884c\u6240\u6709\u89c4\u5219\uff0c\u54ea\u4e2a\u5339\u914d\u6267\u884c\u54ea\u4e2a\u3002</li> </ul>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginxreturn","title":"nginx\u7684return\u6307\u4ee4","text":"<pre><code>\u8be5\u6307\u4ee4\u4e00\u822c\u7528\u4e8e\u5bf9\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef\u76f4\u63a5\u8fd4\u56de\u54cd\u5e94\u72b6\u6001\u7801\u3002\u5728\u8be5\u4f5c\u7528\u57df\u5185return\u540e\u9762\u7684\u6240\u6709nginx\u914d\u7f6e\u90fd\u662f\u65e0\u6548\u7684\u3002\n\u53ef\u4ee5\u4f7f\u7528\u5728server\u3001location\u4ee5\u53caif\u914d\u7f6e\u4e2d\u3002\n\n\u9664\u4e86\u652f\u6301\u8ddf\u72b6\u6001\u7801\uff0c\u8fd8\u53ef\u4ee5\u8ddf\u5b57\u7b26\u4e32\u6216\u8005url\u94fe\u63a5\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_7","title":"\u76f4\u63a5\u8fd4\u56de\u72b6\u6001\u7801","text":"<pre><code>\u793a\u4f8b1\uff1a\nserver{\n    listen 80;\n    server_name www.aming.com;\n    return 403;\n    rewrite /(.*) /abc/$1;  //\u8be5\u884c\u914d\u7f6e\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\n}\n\n\u793a\u4f8b2\uff1a\nserver {\n.....\n\nif ($request_uri ~ \"\\.htpasswd|\\.bak\")\n{\n    return 404;\n    rewrite /(.*) /aaa.txt;  //\u8be5\u884c\u914d\u7f6e\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\n}\n//\u5982\u679c\u4e0b\u9762\u8fd8\u6709\u5176\u4ed6\u914d\u7f6e\uff0c\u4f1a\u88ab\u6267\u884c\u3002\n.....\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_8","title":"\u8fd4\u56de\u5b57\u7b26\u4e32","text":"<pre><code>\u793a\u4f8b3\uff1a\nserver{\n    listen 80;\n    server_name www.aming.com;\n    return 200 \"hello\";\n}\n\u8bf4\u660e\uff1a\u5982\u679c\u8981\u60f3\u8fd4\u56de\u5b57\u7b26\u4e32\uff0c\u5fc5\u987b\u8981\u52a0\u4e0a\u72b6\u6001\u7801\uff0c\u5426\u5219\u4f1a\u62a5\u9519\u3002\n\u8fd8\u53ef\u4ee5\u652f\u6301json\u6570\u636e\n\n\u793a\u4f8b4\uff1a\nlocation ^~ /aming {\n    default_type application/json ;\n    return 200  '{\"name\":\"aming\",\"id\":\"100\"}';\n}\n\n\u4e5f\u652f\u6301\u5199\u4e00\u4e2a\u53d8\u91cf\n\n\u793a\u4f8b5\uff1a\nlocation /test {\n    return 200 \"$host $request_uri\";\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#url","title":"\u8fd4\u56deurl","text":"<pre><code>\u793a\u4f8b6\uff1a\nserver{\n    listen 80;\n    server_name www.aming.com;\n    return http://www.aminglinux.com/123.html;\n    rewrite /(.*) /abc/$1;  //\u8be5\u884c\u914d\u7f6e\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\n}\n\u6ce8\u610f\uff1areturn\u540e\u9762\u7684url\u5fc5\u987b\u662f\u4ee5http://\u6216\u8005https://\u5f00\u5934\u7684\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_9","title":"\u751f\u4ea7\u573a\u666f\u5b9e\u6218","text":"<pre><code>\u80cc\u666f\uff1a\u7f51\u7ad9\u88ab\u9ed1\u4e86\uff0c\u51e1\u662f\u5728\u767e\u5ea6\u70b9\u51fb\u5230\u672c\u7f51\u7ad9\u7684\u8bf7\u6c42\uff0c\u5168\u90e8\u90fd\u8df3\u8f6c\u5230\u4e86\u4e00\u4e2a\u8d4c\u535a\u7f51\u7ad9\u3002\n\u901a\u8fc7nginx\u89e3\u51b3\uff1a\nif ($http_referer ~ 'baidu.com') \n{\n    return 200 \"&lt;html&gt;&lt;script&gt;window.location.href='//$host$request_uri';&lt;/script&gt;&lt;/html&gt;\";\n}\n\n\u5982\u679c\u5199\u6210\uff1a\nreturn http://$host$request_uri; \u5728\u6d4f\u89c8\u5668\u4e2d\u4f1a\u63d0\u793a\u201c\u91cd\u5b9a\u5411\u7684\u6b21\u6570\u8fc7\u591a\u201d\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#rewrite","title":"rewrite\u89c4\u5219","text":"<pre><code>\u683c\u5f0f\uff1arewrite  regex replacement [flag] \n\n* rewrite\u914d\u7f6e\u53ef\u4ee5\u5728server\u3001location\u4ee5\u53caif\u914d\u7f6e\u6bb5\u5185\u751f\u6548\n\n* regex\u662f\u7528\u4e8e\u5339\u914dURI\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5176\u4e0d\u4f1a\u5339\u914d\u5230$host\uff08\u57df\u540d\uff09\n\n* replacement\u662f\u76ee\u6807\u8df3\u8f6c\u7684URI\uff0c\u53ef\u4ee5\u4ee5http://\u6216\u8005https://\u5f00\u5934\uff0c\u4e5f\u53ef\u4ee5\u7701\u7565\u6389$host\uff0c\u76f4\u63a5\u5199$request_uri\u90e8\u5206\uff08\u5373\u8bf7\u6c42\u7684\u94fe\u63a5\uff09\n\n* flag\uff0c\u7528\u6765\u8bbe\u7f6erewrite\u5bf9URI\u7684\u5904\u7406\u884c\u4e3a\uff0c\u5176\u4e2d\u6709break\u3001last\u3001rediect\u3001permanent\uff0c\u5176\u4e2dbreak\u548clast\u5728\u524d\u9762\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\uff0c\nrediect\u548cpermanent\u7684\u533a\u522b\u5728\u4e8e\uff0c\u524d\u8005\u4e3a\u4e34\u65f6\u91cd\u5b9a\u5411(302)\uff0c\u800c\u540e\u8005\u662f\u6c38\u4e45\u91cd\u5b9a\u5411(301)\uff0c\u5bf9\u4e8e\u7528\u6237\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\uff0c\u8fd9\u4e24\u8005\u7684\u6548\u679c\u662f\u4e00\u81f4\u7684\u3002\n\u4f46\u662f\uff0c\u5bf9\u4e8e\u641c\u7d22\u5f15\u64ce\u8718\u86db\u722c\u866b\u6765\u8bf4\u5c31\u6709\u533a\u522b\u4e86\uff0c\u4f7f\u7528301\u66f4\u6709\u5229\u4e8eSEO\u3002\u6240\u4ee5\uff0c\u5efa\u8baereplacemnet\u662f\u4ee5http://\u6216\u8005https://\u5f00\u5934\u7684flag\u4f7f\u7528permanent\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1_1","title":"\u793a\u4f8b1","text":"<pre><code>location / {\n    rewrite /(.*) http://www.aming.com/$1 permanent;\n}\n\u8bf4\u660e\uff1a.*\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u7528()\u62ec\u8d77\u6765\uff0c\u5728\u540e\u9762\u7684URI\u4e2d\u53ef\u4ee5\u8c03\u7528\u5b83\uff0c\u7b2c\u4e00\u6b21\u51fa\u73b0\u7684()\u7528$1\u8c03\u7528\uff0c\u7b2c\u4e8c\u6b21\u51fa\u73b0\u7684()\u7528$2\u8c03\u7528\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2_1","title":"\u793a\u4f8b2","text":"<pre><code>location / {\n    rewrite /.* http://www.aming.com$request_uri permanent;\n}\n\u8bf4\u660e\uff1a\u5728replacement\u4e2d\uff0c\u652f\u6301\u53d8\u91cf\uff0c\u8fd9\u91cc\u7684$request_uri\u5c31\u662f\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u94fe\u63a5\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#3_1","title":"\u793a\u4f8b3","text":"<pre><code>server{\n    listen 80;\n    server_name www.123.com;\n    root /tmp/123.com;\n    index index.html;\n    rewrite /(.*) /abc/$1 redirect;\n}\n\u8bf4\u660e\uff1a\u672c\u4f8b\u4e2d\u7684rewrite\u89c4\u5219\u6709\u95ee\u9898\uff0c\u4f1a\u9020\u8fde\u7eed\u5faa\u73af\uff0c\u6700\u7ec8\u4f1a\u5931\u8d25\uff0c\u89e3\u51b3\u8be5\u95ee\u9898\u6709\u4e24\u4e2a\u65b9\u6848\u3002\n\u5173\u4e8e\u5faa\u73af\u6b21\u6570\uff0c\u7ecf\u6d4b\u8bd5\u53d1\u73b0\uff0ccurl \u4f1a\u5faa\u73af50\u6b21\uff0cchrome\u4f1a\u5faa\u73af80\u6b21\uff0cIE\u4f1a\u5faa\u73af120\u6b21\uff0cfirefox\u4f1a\u5faa\u73af20\u6b21\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#4_2","title":"\u793a\u4f8b4","text":"<pre><code>server{\n    listen 80;\n    server_name www.123.com;\n    root /tmp/123.com;\n    index index.html;\n    rewrite /(.*) /abc/$1 break;\n}\n\u8bf4\u660e\uff1a\u5728rewrite\u4e2d\u4f7f\u7528break\uff0c\u4f1a\u907f\u514d\u5faa\u73af\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#5_1","title":"\u793a\u4f8b5","text":"<pre><code>server{\n    listen 80;\n    server_name www.123.com;\n    root /tmp/123.com;\n    index index.html;\n    if ($request_uri !~ '^/abc/')\n    {\n        rewrite /(.*) /abc/$1 redirect;\n    }\n}\n\u8bf4\u660e\uff1a\u52a0\u4e00\u4e2a\u6761\u4ef6\u9650\u5236\uff0c\u4e5f\u53ef\u4ee5\u907f\u514d\u4ea7\u751f\u5faa\u73af\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#rewrite_1","title":"Rewrite\u5b9e\u6218","text":"<pre><code>\u672c\u90e8\u5206\u5185\u5bb9\u4e3anginx\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u7684\u573a\u666f\u793a\u4f8b\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_10","title":"\u57df\u540d\u8df3\u8f6c\uff08\u57df\u540d\u91cd\u5b9a\u5411\uff09","text":"<pre><code>\u793a\u4f8b1\uff08\u4e0d\u5e26\u6761\u4ef6\u7684\uff09\uff1a\nserver{\n    listen 80;\n    server_name www.aminglinux.com;\n    rewrite /(.*) http://www.aming.com/$1 permanent;\n    .......\n\n}\n\n\u793a\u4f8b2\uff08\u5e26\u6761\u4ef6\u7684\uff09\uff1a\nserver{\n    listen 80;\n    server_name www.aminglinux.com aminglinux.com;\n    if ($host != 'www.aminglinux.com')\n    {\n        rewrite /(.*) http://www.aminglinux.com/$1 permanent;\n    }\n    .......\n\n}\n\u793a\u4f8b3\uff08http\u8df3\u8f6c\u5230https\uff09\uff1a\nserver{\n    listen 80;\n    server_name www.aminglinux.com;\n    rewrite /(.*) https://www.aminglinux.com/$1 permanent;\n    .......\n\n}\n\u793a\u4f8b4\uff08\u57df\u540d\u8bbf\u95ee\u4e8c\u7ea7\u76ee\u5f55\uff09\nserver{\n    listen 80;\n    server_name bbs.aminglinux.com;\n    rewrite /(.*) http://www.aminglinux.com/bbs/$1 last;\n    .......\n\n}\n\u793a\u4f8b5\uff08\u9759\u6001\u8bf7\u6c42\u5206\u79bb\uff09\nserver{\n    listen 80;\n    server_name www.aminglinux.com;\n    location ~* ^.+.(jpg|jpeg|gif|css|png|js)$\n    {\n        rewrite /(.*) http://img.aminglinux.com/$1 permanent;\n    }\n\n    .......\n\n}\n\u6216\u8005\uff1a\nserver{\n    listen 80;\n    server_name www.aminglinux.com;\n    if ( $uri ~* 'jpg|jpeg|gif|css|png|js$')\n    {\n        rewrite /(.*) http://img.aminglinux.com/$1 permanent;\n    }\n\n    .......\n\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_11","title":"\u9632\u76d7\u94fe","text":"<pre><code>\u793a\u4f8b6\nserver{\n    listen 80;\n    server_name www.aminglinux.com;\n    location ~* ^.+.(jpg|jpeg|gif|css|png|js|rar|zip|flv)$\n    {\n        valid_referers none blocked server_names *.aminglinux.com aminglinux.com *.aming.com aming.com;\n        if ($invalid_referer)\n        {\n            rewrite /(.*) http://img.aminglinux.com/images/forbidden.png;\n        }\n    }\n\n    .......\n\n}\n\u8bf4\u660e\uff1a*\u8fd9\u91cc\u662f\u901a\u914d\uff0c\u8ddf\u6b63\u5219\u91cc\u9762\u7684*\u4e0d\u662f\u4e00\u4e2a\u610f\u601d\uff0cnone\u6307\u7684\u662freferer\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\uff08curl -e \u6d4b\u8bd5\uff09\uff0c\n      blocked\u6307\u7684\u662freferer\u5934\u90e8\u7684\u503c\u88ab\u9632\u706b\u5899\u6216\u8005\u4ee3\u7406\u670d\u52a1\u5668\u5220\u9664\u6216\u8005\u4f2a\u88c5\u7684\u60c5\u51b5\uff0c\n      \u8be5\u60c5\u51b5\u4e0b\uff0creferer\u5934\u90e8\u7684\u503c\u4e0d\u4ee5http://\u6216\u8005https://\u5f00\u5934\uff08curl -e \u540e\u9762\u8ddf\u7684referer\u4e0d\u4ee5http://\u6216\u8005https://\u5f00\u5934\uff09\u3002\n\u6216\u8005\uff1a\n    location ~* ^.+.(jpg|jpeg|gif|css|png|js|rar|zip|flv)$\n    {\n        valid_referers none blocked server_names *.aminglinux.com *.aming.com aminglinux.com aming.com;\n        if ($invalid_referer)\n        {\n            return 403;\n        }\n    }\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_12","title":"\u4f2a\u9759\u6001","text":"<pre><code>\u793a\u4f8b7(discuz\u4f2a\u9759\u6001)\uff1a\nlocation /  {\n    rewrite ^([^\\.]*)/topic-(.+)\\.html$ $1/portal.php?mod=topic&amp;topic=$2 last;\n    rewrite ^([^\\.]*)/forum-(\\w+)-([0-9]+)\\.html$ $1/forum.php?mod=forumdisplay&amp;fid=$2&amp;page=$3 last;\n    rewrite ^([^\\.]*)/thread-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ $1/forum.php?mod=viewthread&amp;tid=$2&amp;extra=page%3D$4&amp;page=$3 last;\n    rewrite ^([^\\.]*)/group-([0-9]+)-([0-9]+)\\.html$ $1/forum.php?mod=group&amp;fid=$2&amp;page=$3 last;\n    rewrite ^([^\\.]*)/space-(username|uid)-(.+)\\.html$ $1/home.php?mod=space&amp;$2=$3 last;\n    rewrite ^([^\\.]*)/(fid|tid)-([0-9]+)\\.html$ $1/index.php?action=$2&amp;value=$3 last;\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#rewrite_2","title":"rewrite\u591a\u4e2a\u6761\u4ef6\u7684\u5e76\u4e14","text":"<pre><code>\u793a\u4f8b8\uff1a\nlocation /{\n    set $rule 0;\n    if ($document_uri !~ '^/abc')\n    {\n        set $rule \"${rule}1\";\n    }\n    if ($http_user_agent ~* 'ie6|firefox')\n    {\n       set $rule \"${rule}2\";\n    }\n    if ($rule = \"012\")\n    {\n        rewrite /(.*) /abc/$1 redirect;\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#7location","title":"7.location\u914d\u7f6e","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#aecho","title":"A.\u5b89\u88c5echo\u6a21\u5757","text":"<pre><code>git clone https://github.com/openresty/echo-nginx-module.git\nmake clean\n./configure --prefix=/usr/local/nginx --add-module=/echo-nginx-module\nmake\nmake install\n/usr/local/nginx/sbin/nginx -s stop\n/usr/local/nginx/sbin/nginx\n\n\nvi /usr/local/nginx/conf/vhost/www.1.com.conf\n    location /abc/\n    {\n        echo 123;\n    }\ncurl -x127.0.0.1:80 www.1.com/abc/ssss\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#location","title":"location\u8bed\u6cd5","text":"<pre><code>nginx location\u8bed\u6cd5\u89c4\u5219\uff1alocation [=|~|~*|^~] /uri/ { \u2026 }\nnginx\u7684location\u5339\u914d\u7684\u53d8\u91cf\u662f$uri\n</code></pre> \u7b26\u53f7 \u8bf4\u660e = \u8868\u793a\u7cbe\u786e\u5339\u914d ^~ \u8868\u793auri\u4ee5\u6307\u5b9a\u5b57\u7b26\u6216\u5b57\u7b26\u4e32\u5f00\u5934 ~ \u8868\u793a\u533a\u5206\u5927\u5c0f\u5199\u7684\u6b63\u5219\u5339\u914d ~* \u8868\u793a\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u6b63\u5219\u5339\u914d / \u901a\u7528\u5339\u914d\uff0c\u4efb\u4f55\u8bf7\u6c42\u90fd\u4f1a\u5339\u914d\u5230"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_13","title":"\u89c4\u5219\u4f18\u5148\u7ea7","text":"<pre><code>=  \u9ad8\u4e8e  ^~  \u9ad8\u4e8e  ~* \u7b49\u4e8e ~  \u9ad8\u4e8e  /\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_14","title":"\u89c4\u5219\u793a\u4f8b","text":"<pre><code>location = \"/12.jpg\" { ... }\n\u5982\uff1a\nwww.aminglinux.com/12.jpg \u5339\u914d\nwww.aminglinux.com/abc/12.jpg \u4e0d\u5339\u914d\n\nlocation ^~ \"/abc/\" { ... }\n\u5982\uff1a\nwww.aminglinux.com/abc/123.html \u5339\u914d\nwww.aminglinux.com/a/abc/123.jpg \u4e0d\u5339\u914d\n\nlocation ~ \"png\" { ... }\n\u5982\uff1a\nwww.aminglinux.com/aaa/bbb/ccc/123.png \u5339\u914d\nwww.aminglinux.com/aaa/png/123.html \u5339\u914d\n\nlocation ~* \"png\" { ... }\n\u5982\uff1a\nwww.aminglinux.com/aaa/bbb/ccc/123.PNG \u5339\u914d\nwww.aminglinux.com/aaa/png/123.html \u5339\u914d\n\n\nlocation /admin/ { ... }\n\u5982\uff1a\nwww.aminglinux.com/admin/aaa/1.php \u5339\u914d\nwww.aminglinux.com/123/admin/1.php \u4e0d\u5339\u914d\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_15","title":"\u5c0f\u5e38\u8bc6","text":"<pre><code>\u6709\u4e9b\u8d44\u6599\u4e0a\u4ecb\u7ecdlocation\u652f\u6301\u4e0d\u5339\u914d !~\uff0c\n\u5982\uff1a location !~ 'png'{ ... }\n\u8fd9\u662f\u9519\u8bef\u7684\uff0clocation\u4e0d\u652f\u6301 !~\n\n\u5982\u679c\u6709\u8fd9\u6837\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u901a\u8fc7if\u6765\u5b9e\u73b0\uff0c\n\u5982\uff1a if ($uri !~ 'png') { ... }\n\n\u6ce8\u610f\uff1alocation\u4f18\u5148\u7ea7\u5c0f\u4e8eif\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#8nginx","title":"8.nginx\u4ee3\u7406","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#a","title":"A.\u6b63\u5411\u4ee3\u7406","text":"<pre><code>Nginx\u6b63\u5411\u4ee3\u7406\u4f7f\u7528\u573a\u666f\u5e76\u4e0d\u591a\u89c1\u3002\n\u9700\u6c42\u573a\u666f1\uff1a\n\u5982\u679c\u5728\u673a\u623f\u4e2d\uff0c\u53ea\u6709\u4e00\u53f0\u673a\u5668\u53ef\u4ee5\u8054\u7f51\uff0c\u5176\u4ed6\u673a\u5668\u53ea\u6709\u5185\u7f51\uff0c\u5185\u7f51\u7684\u673a\u5668\u60f3\u7528\u4f7f\u7528yum\u5b89\u88c5\u8f6f\u4ef6\u5305\uff0c\u5728\u80fd\u80fd\u8054\u7f51\u7684\u673a\u5668\u4e0a\u914d\u7f6e\u4e00\u4e2a\u6b63\u5411\u4ee3\u7406\u5373\u53ef\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_4","title":"Nginx\u6b63\u5411\u4ee3\u7406\u914d\u7f6e\u6587\u4ef6","text":"<p>\u8bf4\u660e\uff1a \u4ee5\u4e0b\u914d\u7f6e\u6587\u4ef6\u4e3anginx\u5b98\u65b9\u63d0\u4f9b\uff0c\u8be5\u65b9\u6cd5\u53ea\u80fd\u5b9e\u73b0\u9488\u5bf9http\u7684\u7f51\u7ad9\u7684\u8bbf\u95ee\uff0c\u5982\u679c\u662fhttps\u5c31\u4f1a\u6709\u95ee\u9898\u3002\u8981\u60f3\u5b9e\u73b0https\u7684\u6b63\u5411\u4ee3\u7406\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u4e09\u65b9\u6a21\u5757\uff0c\u540e\u9762\u4ecb\u7ecd\u3002</p> <pre><code>server {\n    listen 80 default_server;\n    resolver 119.29.29.29;\n    location /\n    {\n        proxy_pass http://$host$request_uri;\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_5","title":"Nginx\u6b63\u5411\u4ee3\u7406\u914d\u7f6e\u6267\u884c\u8bf4\u660e","text":"<ul> <li>resolver</li> </ul> <pre><code>\u8bed\u6cd5\uff1aresolver address;\n\naddress\u4e3aDNS\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u56fd\u5185\u901a\u7528\u7684DNS 119.29.29.29\u4e3adnspod\u516c\u53f8\u63d0\u4f9b\u3002 \u56fd\u9645\u901a\u7528DNS 8.8.8.8\u6216\u80058.8.4.4\u4e3agoogle\u63d0\u4f9b\u3002\n\u5176\u4ed6\u53ef\u4ee5\u53c2\u8003 http://dns.lisect.com/\n\n\u793a\u4f8b\uff1aresolver 119.29.29.29;\n</code></pre> <ul> <li>default_server</li> </ul> <pre><code>\u4e4b\u6240\u4ee5\u8981\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u865a\u62df\u4e3b\u673a\uff0c\u662f\u56e0\u4e3a\u8fd9\u6837\u5c31\u4e0d\u7528\u8bbe\u7f6eserver_name\u4e86\uff0c\u4efb\u4f55\u57df\u540d\u89e3\u6790\u8fc7\u6765\u90fd\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\u3002\n</code></pre> <ul> <li>proxy_pass</li> </ul> <pre><code>\u8be5\u6307\u4ee4\u7528\u6765\u8bbe\u7f6e\u8981\u4ee3\u7406\u7684\u76ee\u6807url\uff0c\u6b63\u5411\u4ee3\u7406\u670d\u52a1\u5668\u8bbe\u7f6e\u5c31\u4fdd\u6301\u8be5\u56fa\u5b9a\u503c\u5373\u53ef\u3002\u5173\u4e8e\u8be5\u6307\u4ee4\u7684\u8be6\u7ec6\u89e3\u91ca\u5728\u53cd\u5411\u4ee3\u7406\u914d\u7f6e\u4e2d\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginxhttps","title":"Nginx\u6b63\u5411\u4ee3\u7406\u652f\u6301https","text":"<p>\u4e0b\u8f7d\u4e09\u65b9\u6a21\u5757ngx_http_proxy_connect_module\uff0cgithub\u5730\u5740\uff1ahttps://github.com/chobits/ngx_http_proxy_connect_module \u6ce8\u610f\uff0c\u4e0d\u540c\u7684Nginx\u7248\u672c\uff0c\u8fd8\u9700\u8981\u4e0b\u8f7d\u4e0d\u540c\u7684patch\u5305\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\uff0c\u4ee51.9.12\u4e3a\u4f8b</p> <pre><code>wget http://nginx.org/download/nginx-1.9.12.tar.gz\ntar -xzvf nginx-1.9.12.tar.gz\ncd nginx-1.9.12/\npatch -p1 &lt; /path/to/ngx_http_proxy_connect_module/patch/proxy_connect.patch\n./configure --add-dynamic-module=/path/to/ngx_http_proxy_connect_module\nmake &amp;&amp; make install\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_6","title":"Nginx\u6b63\u5411\u4ee3\u7406\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>server {\n     listen                         3128;\n\n\n     # dns resolver used by forward proxying\n     resolver                       119.29.29.29;\n\n\n     # forward proxy for CONNECT request\n     proxy_connect;\n     proxy_connect_allow            80 443 3000 9070 9074;\n     proxy_connect_connect_timeout  10s;\n     proxy_connect_read_timeout     10s;\n     proxy_connect_send_timeout     10s;\n\n\n     # forward proxy for non-CONNECT request\n     location / {\n         proxy_pass http://$host;\n         proxy_set_header Host $host;\n     }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_16","title":"\u6d4b\u8bd5\u793a\u4f8b","text":"<pre><code>$ curl https://github.com/ -v -x 127.0.0.1:3128\n*   Trying 127.0.0.1...                                           -.\n* Connected to 127.0.0.1 (127.0.0.1) port 3128 (#0)                | curl creates TCP connection with nginx (with proxy_connect module).\n* Establish HTTP proxy tunnel to github.com:443                   -'\n&gt; CONNECT github.com:443 HTTP/1.1                                 -.\n&gt; Host: github.com:443                                         (1) | curl sends CONNECT request to create tunnel.\n&gt; User-Agent: curl/7.43.0                                          |\n&gt; Proxy-Connection: Keep-Alive                                    -'\n&gt;\n&lt; HTTP/1.0 200 Connection Established                             .- nginx replies 200 that tunnel is established.\n&lt; Proxy-agent: nginx                                           (2)|  (The client is now being proxied to the remote host. Any data sent\n&lt;                                                                 '-  to nginx is now forwarded, unmodified, to the remote host)\n\n* Proxy replied OK to CONNECT request\n* TLS 1.2 connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256  -.\n* Server certificate: github.com                                   |\n* Server certificate: DigiCert SHA2 Extended Validation Server CA  | curl sends \"https://github.com\" request via tunnel,\n* Server certificate: DigiCert High Assurance EV Root CA           | proxy_connect module will proxy data to remote host (github.com).\n&gt; GET / HTTP/1.1                                                   |\n&gt; Host: github.com                                             (3) |\n&gt; User-Agent: curl/7.43.0                                          |\n&gt; Accept: */*                                                     -'\n&gt;\n&lt; HTTP/1.1 200 OK                                                 .-\n&lt; Date: Fri, 11 Aug 2017 04:13:57 GMT                             |\n&lt; Content-Type: text/html; charset=utf-8                          |  Any data received from remote host will be sent to client\n&lt; Transfer-Encoding: chunked                                      |  by proxy_connect module.\n&lt; Server: GitHub.com                                           (4)|\n&lt; Status: 200 OK                                                  |\n&lt; Cache-Control: no-cache                                         |\n&lt; Vary: X-PJAX                                                    |\n...                                                               |\n... &lt;other response headers &amp; response body&gt; ...                  |\n...                                                               \n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#linux","title":"linux\u673a\u5668\u4e0a\u914d\u7f6e\u5168\u5c40\u4ee3\u7406","text":"<p>\u5728 /etc/profile \u6587\u4ef6\u4e2d\u589e\u52a0\u5982\u4e0b\u4e09\u9879\u3002</p> <pre><code>export proxy=\"http://{proxy_server_ip}:3128\"\nexport http_proxy=$proxy\nexport https_proxy=$proxy\n</code></pre> <p>\u4f7f\u914d\u7f6e\u751f\u6548</p> <pre><code>source /etc/profile\n</code></pre> <p>\u5bf9\u90a3\u4e9b\u6ca1\u6709\u57df\u540d\u89e3\u6790\u901a\u8fc7\u7ed1\u5b9ahosts\u6587\u4ef6\u6765\u8bbf\u95ee\u7684\u57df\u540d\uff0c\u4e0d\u8ba9\u5176\u8d70http/https\u4ee3\u7406\uff0c\u9700\u8981\u989d\u5916\u589e\u52a0\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>export no_proxy='a.test.com,127.0.0.1,2.2.2.2'\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#b_1","title":"B.\u53cd\u5411\u4ee3\u7406","text":"<pre><code>Nginx\u53cd\u5411\u4ee3\u7406\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\u5f88\u591a\u7684\u3002\n\n\u573a\u666f1\uff1a\n\u57df\u540d\u6ca1\u6709\u5907\u6848\uff0c\u53ef\u4ee5\u628a\u57df\u540d\u89e3\u6790\u5230\u9999\u6e2f\u4e00\u53f0\u4e91\u4e3b\u673a\u4e0a\uff0c\u5728\u9999\u6e2f\u4e91\u4e3b\u673a\u505a\u4e2a\u4ee3\u7406\uff0c\u800c\u7f51\u7ad9\u6570\u636e\u662f\u5728\u5927\u9646\u7684\u670d\u52a1\u5668\u4e0a\u3002\n\n\u793a\u4f8b1\uff1a\nserver \n{\n    listen 80;\n    server_name aminglinux.com;\n\n    location /\n    {\n        proxy_pass http://123.23.13.11/;\n        proxy_set_header Host   $host;\n        proxy_set_header X-Real-IP      $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_17","title":"\u914d\u7f6e\u8bf4\u660e","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1-proxy_pass","title":"1. proxy_pass","text":"<pre><code>\u5728\u6b63\u5411\u4ee3\u7406\u4e2d\uff0c\u5df2\u7ecf\u4f7f\u7528\u8fc7\u8be5\u6307\u4ee4\u3002\n\u683c\u5f0f\u5f88\u7b80\u5355\uff1a proxy_pass  URL;\n\u5176\u4e2dURL\u5305\u542b\uff1a\u4f20\u8f93\u534f\u8bae\uff08http://, https://\u7b49\uff09\u3001\u4e3b\u673a\u540d\uff08\u57df\u540d\u6216\u8005IP:PORT\uff09\u3001uri\u3002\n\n\u793a\u4f8b\u5982\u4e0b\uff1a\nproxy_pass http://www.aminglinux.com/;\nproxy_pass http://192.168.200.101:8080/uri;\nproxy_pass unix:/tmp/www.sock;\n\n\u5bf9\u4e8eproxy_pass\u7684\u914d\u7f6e\u6709\u51e0\u79cd\u60c5\u51b5\u9700\u8981\u6ce8\u610f\u3002\n\u793a\u4f8b2\uff1a\nlocation /aming/\n{\n    proxy_pass http://192.168.1.10;\n    ...\n}\n\n\n\u793a\u4f8b3\uff1a\nlocation /aming/\n{\n    proxy_pass http://192.168.1.10/;\n    ...\n}\n\n\u793a\u4f8b4\uff1a\nlocation /aming/\n{\n    proxy_pass http://192.168.1.10/linux/;\n    ...\n}\n\n\u793a\u4f8b5\uff1a\nlocation /aming/\n{\n    proxy_pass http://192.168.1.10/linux;\n    ...\n}\n\n\u5047\u8bbeserver_name\u4e3awww.aminglinux.com\n\u5f53\u8bf7\u6c42http://www.aminglinux.com/aming/a.html\u7684\u65f6\u5019\uff0c\u4ee5\u4e0a\u793a\u4f8b2-5\u5206\u522b\u8bbf\u95ee\u7684\u7ed3\u679c\u662f\n\n\u793a\u4f8b2\uff1ahttp://192.168.1.10/aming/a.html\n\n\u793a\u4f8b3\uff1ahttp://192.168.1.10/a.html\n\n\u793a\u4f8b4\uff1ahttp://192.168.1.10/linux/a.html\n\n\u793a\u4f8b5\uff1ahttp://192.168.1.10/linuxa.html\n\n\n\u603b\u7ed3\uff1a\u4ee3\u7406\u52a0\u4e0a\u6839'/path'\u7684\u8bdd\uff0c\u4f1a\u628alocation\u7684\u8def\u5f84\u4e5f\u52a0\u4e0a\u3002\n     \u52a0\u4e0a'/'\u6bd4\u8f83\u89c4\u8303\uff0c\u4e14\u53ef\u8bfb\u6027\u5f3a\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2-proxy_set_header","title":"2. proxy_set_header","text":"<pre><code>proxy_set_header\u7528\u6765\u8bbe\u5b9a\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u63a5\u6536\u5230\u7684header\u4fe1\u606f\u3002\n\n\u8bed\u6cd5\uff1aproxy_set_header field value;\nfield\u4e3a\u8981\u66f4\u6539\u7684\u9879\u76ee\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\u53d8\u91cf\u7684\u540d\u5b57\uff0c\u6bd4\u5982host\nvalue\u4e3a\u53d8\u91cf\u7684\u503c\n\n\u5982\u679c\u4e0d\u8bbe\u7f6eproxy_set_header\uff0c\u5219\u9ed8\u8ba4host\u7684\u503c\u4e3aproxy_pass\u540e\u9762\u8ddf\u7684\u90a3\u4e2a\u57df\u540d\u6216\u8005IP\uff08\u4e00\u822c\u5199IP\uff09\uff0c\n\u6bd4\u5982\u793a\u4f8b4\uff0c\u8bf7\u6c42\u5230\u540e\u7aef\u7684\u670d\u52a1\u5668\u4e0a\u65f6\uff0c\u5b8c\u6574\u8bf7\u6c42uri\u4e3a\uff1ahttp://192.168.1.10/linux/a.html\n\n\u5982\u679c\u8bbe\u7f6eproxy_set_header\uff0c\u5982 proxy_set_header host $host;\n\u6bd4\u5982\u793a\u4f8b4\uff0c\u8bf7\u6c42\u5230\u540e\u7aef\u7684\u670d\u52a1\u5668\u5b8c\u6574uri\u4e3a\uff1ahttp://www.aminglinux.com/linux/a.html\n\nproxy_set_header X-Real-IP $remote_addr;\u548cproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\u7528\u6765\u8bbe\u7f6e\u88ab\u4ee3\u7406\u7aef\u63a5\u6536\u5230\u7684\u8fdc\u7a0b\u5ba2\u6237\u7aefIP\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u5219header\u4fe1\u606f\u4e2d\u5e76\u4e0d\u4f1a\u900f\u4f20\u8fdc\u7a0b\u771f\u5b9e\u5ba2\u6237\u7aef\u7684IP\u5730\u5740\u3002\n\u53ef\u4ee5\u7528\u5982\u4e0b\u793a\u4f8b\u6765\u6d4b\u8bd5\uff1a\n\n\n\u793a\u4f8b6(\u88ab\u4ee3\u7406\u7aef)C\u7aef\nserver{\n    listen 8080;\n    server_name www.aminglinux.com;\n    root /tmp/123.com_8080;\n    index index.html;\n        location /linux/ {\n        echo \"$host\";\n        echo $remote_addr;\n        echo $proxy_add_x_forwarded_for;\n    }\n}\n\n\u793a\u4f8b7\uff08\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\uff09B\u7aef\nserver {\n    listen 80;\n    server_name www.aminglinux.com;\n\n    location /aming/\n    {\n    proxy_pass http://192.168.1.10:8080/linux/;\n    proxy_set_header host $host;\n    proxy_set_header X-Real-IP      $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_18","title":"\u603b\u7ed3","text":"<ul> <li>A\u7aef\uff08\u5ba2\u6237\u7aef\uff09-&gt;B\u7aef\uff08nginx\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff09-&gt;C\u7aef\uff08Server\u7aef\uff09\uff1b</li> <li>\u5982\u679c\u5728B\u7aef\u4e0d\u8bbe\u7f6ehost\uff0c\u90a3\u4e48\u5982\u679c\u662ftomcat\u540c\u4e00\u4e2a\u7aef\u53e3\u4e0b\u7684\u865a\u62df\u673a\u4e3b\u673a\uff0c\u5219\u65e0\u6cd5\u6b63\u5e38\u89e3\u6790\uff0c\u5728nginx\u7aef\u9700\u914d\u4e0aproxy_set_header host $host\uff0c\u8bbe\u7f6e\u6210\u529f\u4ee5\u540e\uff0c\u7ecf\u8fc7\u53cd\u5411\u4ee3\u7406\u540e\uff0c\u53d1\u9001\u7ed9C\u7aef\u7684\u65f6\u5019\u4f1a\u5e26\u7740\u8fd9\u4e2ahost\u57df\u540d;</li> <li>\u5982\u679c\u6211\u4eec\u5728B\u7aef\u4e0d\u8bbe\u7f6eX-Real-IP\u5934\uff0c\u90a3\u4e48\u6211\u4eec\u5728C\u7aef\u8bb0\u5f55\u65e5\u5fd7\u5c31\u65e0\u6cd5\u8bb0\u5f55\u8bbf\u95ee\u7684\u5ba2\u6237\u673aIP\uff0c\u4e0d\u5229\u4e8e\u65e5\u5fd7\u7684\u6536\u96c6\uff0c\u6240\u4ee5\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u9700\u8981\u52a0\u4e0aproxy_set_header X-Real-IP      $remote_addr;\u8fd9\u4e2a\u914d\u7f6e\u9879\u3002</li> <li>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\u8bf7\u6c42\u7ecf\u8fc7\u7684\u4ee3\u7406\u670d\u52a1\u5668\u7684 IP \u5730\u5740\u5217\u8868\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u53d8\u91cf\u6765\u67e5\u770b\u53cd\u5411\u4ee3\u7406\u7684\u529f\u80fd\u662f\u5426\u6b63\u5e38\u3002</li> </ul>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#3-proxy_redirect","title":"3. proxy_redirect","text":"<pre><code>\u8be5\u6307\u4ee4\u7528\u6765\u4fee\u6539\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u5934\u4e2d\u7684Location\u5934\u57df\u548c\u201crefresh\u201d\u5934\u57df\u3002\n\u8bed\u6cd5\u7ed3\u6784\u4e3a\uff1a\nproxy_redirect redirect replacement;\nproxy_redirect default;\nproxy_redirect off;\n\n\u793a\u4f8b8\uff1a\nserver {\n    listen 80;\n    server_name www.aminglinux.com;\n    index  index.html;\n\n    location /\n    {\n    proxy_pass http://127.0.0.1:8080;\n    proxy_set_header host $host;\n    proxy_set_header X-Real-IP      $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n\u5f53\u8bf7\u6c42\u7684\u94fe\u63a5\u4e3a http://www.aminglinux.com/aming\n\u7ed3\u679c\u4f1a\u8fd4\u56de301\uff0c\u5b9a\u5411\u5230\u4e86 http://www.aminglinux.com:8080/aming/\n\n\u6ce8\u610f\uff1a\u8fd4\u56de301\u6709\u51e0\u4e2a\u5148\u51b3\u6761\u4ef6\n1. location\u540e\u9762\u5fc5\u987b\u662f/; \n2. proxy_pass\u540e\u9762\u7684URL\u4e0d\u80fd\u52a0uri,\u53ea\u80fd\u662fIP\u6216\u8005IP:port\u7ed3\u5c3e\uff0c\u5e76\u4e0d\u80fd\u4ee5/\u7ed3\u5c3e\uff1b\n3. \u8bbf\u95ee\u7684uri\u5fc5\u987b\u662f\u4e00\u4e2a\u771f\u5b9e\u5b58\u5728\u7684\u76ee\u5f55\uff0c\u5982\uff0c\u8fd9\u91cc\u7684aming\u5fc5\u987b\u662f\u5b58\u5728\u7684\n4. \u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u4e0d\u80fd\u4ee5/\u7ed3\u5c3e\uff0c\u53ea\u80fd\u662f www.aminglinux.com/aming\n\n\u867d\u7136\uff0c\u8fd94\u4e2a\u6761\u4ef6\u633a\u82db\u523b\uff0c\u4f46\u786e\u5b9e\u4f1a\u9047\u5230\u7c7b\u4f3c\u7684\u8bf7\u6c42\u3002\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u52a0\u4e00\u884cproxy_redirect http://$host:8080/ /;\n\n\u793a\u4f8b9\uff1a\nserver {\n    listen 80;\n    server_name www.aminglinux.com;\n    index  index.html;\n\n    location /\n    {\n    proxy_pass http://127.0.0.1:8080;\n    proxy_set_header host $host;\n    proxy_redirect http://$host:8080/ /;\n    proxy_set_header X-Real-IP      $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#9buffercache","title":"9.buffer\u4e0ecache","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#abuffer","title":"A.buffer","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#proxy_buffering","title":"proxy_buffering\u8bbe\u7f6e","text":"<pre><code>proxy_buffering\u4e3b\u8981\u662f\u5b9e\u73b0\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u6570\u636e\u548c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5f02\u6b65\u3002\n\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\uff0c\u6211\u4eec\u5b9a\u4e49\u4e09\u4e2a\u89d2\u8272\uff0cA\u4e3a\u5ba2\u6237\u7aef\uff0cB\u4e3a\u4ee3\u7406\u670d\u52a1\u5668\uff0cC\u4e3a\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u3002\n\n\u5f53proxy_buffering\u5f00\u542f\uff0cA\u53d1\u8d77\u8bf7\u6c42\u5230B\uff0cB\u518d\u5230C\uff0cC\u53cd\u9988\u7684\u6570\u636e\u5148\u5230B\u7684buffer\u4e0a\uff0c\n\u7136\u540eB\u4f1a\u6839\u636eproxy_busy_buffer_size\u6765\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u5f00\u59cb\u628a\u6570\u636e\u4f20\u8f93\u7ed9A\u3002\u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6240\u6709\u7684buffer\u88ab\u5199\u6ee1\uff0c\n\u6570\u636e\u5c06\u4f1a\u5199\u5165\u5230temp_file\u4e2d\u3002\n\n\u76f8\u53cd\uff0c\u5982\u679cproxy_buffering\u5173\u95ed\uff0cC\u53cd\u9988\u7684\u6570\u636e\u5b9e\u65f6\u5730\u901a\u8fc7B\u4f20\u8f93\u7ed9A\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#http","title":"#\u4ee5\u4e0b\u914d\u7f6e\uff0c\u90fd\u662f\u9488\u5bf9\u6bcf\u4e00\u4e2ahttp\u8bf7\u6c42\u7684\u3002","text":"<pre><code>1. proxy_buffering  on;\n\u8be5\u53c2\u6570\u8bbe\u7f6e\u662f\u5426\u5f00\u542fproxy\u7684buffer\u529f\u80fd\uff0c\u53c2\u6570\u7684\u503c\u4e3aon\u6216\u8005off\u3002\n\u5982\u679c\u8fd9\u4e2a\u8bbe\u7f6e\u4e3aoff\uff0c\u90a3\u4e48proxy_buffers\u548cproxy_busy_buffers_size\u8fd9\u4e24\u4e2a\u6307\u4ee4\u5c06\u4f1a\u5931\u6548\u3002 \n\u4f46\u662f\u65e0\u8bbaproxy_buffering\u662f\u5426\u5f00\u542f\uff0cproxy_buffer_size\u90fd\u662f\u751f\u6548\u7684\n\n2. proxy_buffer_size  4k;\n\u8be5\u53c2\u6570\u7528\u6765\u8bbe\u7f6e\u4e00\u4e2a\u7279\u6b8a\u7684buffer\u5927\u5c0f\u7684\u3002\n\u4ece\u88ab\u4ee3\u7406\u670d\u52a1\u5668\uff08C\uff09\u4e0a\u83b7\u53d6\u5230\u7684\u7b2c\u4e00\u90e8\u5206\u54cd\u5e94\u6570\u636e\u5185\u5bb9\u5230\u4ee3\u7406\u670d\u52a1\u5668\uff08B\uff09\u4e0a\uff0c\u901a\u5e38\u662fheader\uff0c\u5c31\u5b58\u5230\u4e86\u8fd9\u4e2abuffer\u4e2d\u3002 \n\u5982\u679c\u8be5\u53c2\u6570\u8bbe\u7f6e\u592a\u5c0f\uff0c\u4f1a\u51fa\u73b0502\u9519\u8bef\u7801\uff0c\u8fd9\u662f\u56e0\u4e3a\u8fd9\u90e8\u5206buffer\u4e0d\u591f\u5b58\u50a8header\u4fe1\u606f\u3002\u5efa\u8bae\u8bbe\u7f6e\u4e3a4k\u3002\n\n3. proxy_buffers  8  4k;\n\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u5b58\u50a8\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u7684\u6570\u636e\u6240\u5360\u7528\u7684buffer\u7684\u4e2a\u6570\u548c\u6bcf\u4e2abuffer\u7684\u5927\u5c0f\u3002\n\u6240\u6709buffer\u7684\u5927\u5c0f\u4e3a\u8fd9\u4e24\u4e2a\u6570\u5b57\u7684\u4e58\u79ef\u3002\n\n4. proxy_busy_buffer_size 16k;\n\u5728\u6240\u6709\u7684buffer\u91cc\uff0c\u6211\u4eec\u9700\u8981\u89c4\u5b9a\u4e00\u90e8\u5206buffer\u628a\u81ea\u5df1\u5b58\u7684\u6570\u636e\u4f20\u7ed9A\uff0c\u8fd9\u90e8\u5206buffer\u5c31\u53eb\u505abusy_buffer\u3002\nproxy_busy_buffer_size\u53c2\u6570\u7528\u6765\u8bbe\u7f6e\u5904\u4e8ebusy\u72b6\u6001\u7684buffer\u6709\u591a\u5927\u3002\n\n\u5bf9\u4e8eB\u4e0abuffer\u91cc\u7684\u6570\u636e\u4f55\u65f6\u4f20\u8f93\u7ed9A\uff0c\u6211\u4e2a\u4eba\u7684\u7406\u89e3\u662f\u8fd9\u6837\u7684\uff1a\n1\uff09\u5982\u679c\u5b8c\u6574\u6570\u636e\u5927\u5c0f\u5c0f\u4e8ebusy_buffer\u5927\u5c0f\uff0c\u5f53\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u540e\uff0c\u9a6c\u4e0a\u4f20\u7ed9A\uff1b\n2\uff09\u5982\u679c\u5b8c\u6574\u6570\u636e\u5927\u5c0f\u4e0d\u5c11\u4e8ebusy_buffer\u5927\u5c0f\uff0c\u5219\u88c5\u6ee1busy_buffer\u540e\uff0c\u9a6c\u4e0a\u4f20\u7ed9A\uff1b\n\n5. proxy_temp_path\n\u8bed\u6cd5\uff1aproxy_temp_path  path [level1 level2 level3]\n\u5b9a\u4e49proxy\u7684\u4e34\u65f6\u6587\u4ef6\u5b58\u5728\u76ee\u5f55\u4ee5\u53ca\u76ee\u5f55\u7684\u5c42\u7ea7\u3002\n\n\u4f8b\uff1aproxy_temp_path /usr/local/nginx/proxy_temp 1 2;\n\u5176\u4e2d/usr/local/nginx/proxy_temp\u4e3a\u4e34\u65f6\u6587\u4ef6\u6240\u5728\u76ee\u5f55\uff0c1\u8868\u793a\u5c42\u7ea71\u7684\u76ee\u5f55\u540d\u4e3a\u4e00\u4e2a\u6570\u5b57(0-9),2\u8868\u793a\u5c42\u7ea72\u76ee\u5f55\u540d\u4e3a2\u4e2a\u6570\u5b57(00-99)\n\n6. proxy_max_temp_file_size\n\u8bbe\u7f6e\u4e34\u65f6\u6587\u4ef6\u7684\u603b\u5927\u5c0f\uff0c\u4f8b\u5982 proxy_max_temp_file_size 100M;\n\n7. proxy_temp_file_wirte_size\n\u8bbe\u7f6e\u540c\u65f6\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u91cf\u7684\u603b\u5927\u5c0f\u3002\u901a\u5e38\u8bbe\u7f6e\u4e3a8k\u6216\u800516k\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#proxy_buffer","title":"proxy_buffer\u793a\u4f8b","text":"<pre><code>server\n{\n    listen 80;\n    server_name www.aminglinux.com;\n    proxy_buffering on;\n    proxy_buffer_size 4k;\n    proxy_buffers 2 4k;\n    proxy_busy_buffers_size 4k;\n    proxy_temp_path /tmp/nginx_proxy_tmp 1 2;\n    proxy_max_temp_file_size 20M;\n    proxy_temp_file_write_size 8k;\n\n    location /\n    {\n        proxy_pass      http://192.168.10.110:8080/;\n        proxy_set_header Host   $host;\n        proxy_set_header X-Real-IP      $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n    }\n\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#bcache","title":"B.cache","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#proxy_cache","title":"proxy_cache\u8bbe\u7f6e","text":"<pre><code>proxy_cache\u5c06\u4eceC\u4e0a\u83b7\u53d6\u5230\u7684\u6570\u636e\u6839\u636e\u9884\u8bbe\u89c4\u5219\u5b58\u653e\u5230B\u4e0a\uff08\u5185\u5b58+\u78c1\u76d8\uff09\u7559\u7740\u5907\u7528\uff0c\nA\u8bf7\u6c42B\u65f6\uff0cB\u4f1a\u628a\u7f13\u5b58\u7684\u8fd9\u4e9b\u6570\u636e\u76f4\u63a5\u7ed9A\uff0c\u800c\u4e0d\u9700\u8981\u518d\u53bb\u5411C\u53bb\u83b7\u53d6\u3002\n\nproxy_cache\u76f8\u5173\u529f\u80fd\u751f\u6548\u7684\u524d\u63d0\u662f\uff0c\u9700\u8981\u8bbe\u7f6eproxy_buffering on;\n#\u6ce8\u610f\uff1aproxy_buffering\u9ed8\u8ba4\u65f6\u5f00\u542f\u7684\uff0c\u5982\u679c\u9700\u8981\u5f00\u542f\u7f13\u5b58\u4e0d\u9700\u8981\u914d\u7f6e\u8be5\u9879\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#proxy_cache_1","title":"#proxy_cache\u4e3b\u8981\u53c2\u6570","text":"<pre><code>1. proxy_cache\n\u8bed\u6cd5\uff1aproxy_cache zone|off\n\n\u9ed8\u8ba4\u4e3aoff\uff0c\u5373\u5173\u95edproxy_cache\u529f\u80fd\uff0czone\u4e3a\u7528\u4e8e\u5b58\u653e\u7f13\u5b58\u7684\u5185\u5b58\u533a\u57df\u540d\u79f0\u3002\n\u4f8b\uff1aproxy_cache my_zone;\n\n\u4ecenginx 0.7.66\u7248\u672c\u5f00\u59cb\uff0cproxy_cache\u673a\u5236\u5f00\u542f\u540e\u4f1a\u68c0\u6d4b\u88ab\u4ee3\u7406\u7aef\u7684HTTP\u54cd\u5e94\u5934\u4e2d\u7684\"Cache-Control\"\u3001\"Expire\"\u5934\u57df\u3002\n\u5982\uff0cCache-Control\u4e3ano-cache\u65f6\uff0c\u662f\u4e0d\u4f1a\u7f13\u5b58\u6570\u636e\u7684\u3002\n\n2. proxy_cache_bypass \n\u8bed\u6cd5\uff1aproxy_cache_bypass string;\n\n\u8be5\u53c2\u6570\u8bbe\u5b9a\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u7684\u8bf7\u6c42\u4e0d\u8bfb\u53d6cache\u800c\u662f\u76f4\u63a5\u4ece\u540e\u7aef\u7684\u670d\u52a1\u5668\u4e0a\u83b7\u53d6\u8d44\u6e90\u3002\n\u8fd9\u91cc\u7684string\u901a\u5e38\u4e3anginx\u7684\u4e00\u4e9b\u53d8\u91cf\u3002\n\n\u4f8b\uff1aproxy_cahce_bypass $cookie_nocache $arg_nocache$arg_comment;\n\u610f\u601d\u662f\uff0c\u5982\u679c$cookie_nocache $arg_nocache$arg_comment\u8fd9\u4e9b\u53d8\u91cf\u7684\u503c\u53ea\u8981\u4efb\u4f55\u4e00\u4e2a\u4e0d\u4e3a0\u6216\u8005\u4e0d\u4e3a\u7a7a\u65f6\uff0c\n\u5219\u54cd\u5e94\u6570\u636e\u4e0d\u4ececache\u4e2d\u83b7\u53d6\uff0c\u800c\u662f\u76f4\u63a5\u4ece\u540e\u7aef\u7684\u670d\u52a1\u5668\u4e0a\u83b7\u53d6\u3002\n\n3. proxy_no_cache\n\u8bed\u6cd5\uff1aproxy_no_cache string;\n\n\u8be5\u53c2\u6570\u548cproxy_cache_bypass\u7c7b\u4f3c\uff0c\u7528\u6765\u8bbe\u5b9a\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4e0d\u7f13\u5b58\u3002\n\n\u4f8b\uff1aproxy_no_cache $cookie_nocache $arg_nocache $arg_comment;\n\u8868\u793a\uff0c\u5982\u679c$cookie_nocache $arg_nocache $arg_comment\u7684\u503c\u53ea\u8981\u6709\u4e00\u9879\u4e0d\u4e3a0\u6216\u8005\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u4e0d\u7f13\u5b58\u6570\u636e\u3002\n\n4. proxy_cache_key\n\u8bed\u6cd5\uff1aproxy_cache_key string;\n\n\u5b9a\u4e49cache key\uff0c\u5982\uff1a proxy_cache_key $scheme$proxy_host$uri$is_args$args; \uff08\u8be5\u503c\u4e3a\u9ed8\u8ba4\u503c\uff0c\u4e00\u822c\u4e0d\u7528\u8bbe\u7f6e\uff09\n\n5. proxy_cache_path\n\u8bed\u6cd5\uff1aproxy_cache_path path [levels=levels] keys_zone=name:size  [inactive=time] [max_size=size] \n\npath\u8bbe\u7f6e\u7f13\u5b58\u6570\u636e\u5b58\u653e\u7684\u8def\u5f84\uff1b\n\nlevels\u8bbe\u7f6e\u76ee\u5f55\u5c42\u7ea7\uff0c\u5982levels=1:2\uff0c\u8868\u793a\u6709\u4e24\u7ea7\u5b50\u76ee\u5f55,\u7b2c\u4e00\u4e2a\u76ee\u5f55\u540d\u53d6md5\u503c\u7684\u5012\u6570\u7b2c\u4e00\u4e2a\u503c\uff0c\u7b2c\u4e8c\u4e2a\u76ee\u5f55\u540d\u53d6md5\u503c\u7684\u7b2c2\u548c3\u4e2a\u503c\u3002\u5982\u4e0b\u56fe\uff1a\n</code></pre> <pre><code>keys_zone\u8bbe\u7f6e\u5185\u5b58zone\u7684\u540d\u5b57\u548c\u5927\u5c0f\uff0c\u5982keys_zone=my_zone:10m\n\ninactive\u8bbe\u7f6e\u7f13\u5b58\u591a\u957f\u65f6\u95f4\u5c31\u5931\u6548\uff0c\u5f53\u786c\u76d8\u4e0a\u7684\u7f13\u5b58\u6570\u636e\u5728\u8be5\u65f6\u95f4\u6bb5\u5185\u6ca1\u6709\u88ab\u8bbf\u95ee\u8fc7\uff0c\u5c31\u4f1a\u5931\u6548\u4e86\uff0c\u8be5\u6570\u636e\u5c31\u4f1a\u88ab\u5220\u9664\uff0c\u9ed8\u8ba4\u4e3a10s\u3002\n\nmax_size\u8bbe\u7f6e\u786c\u76d8\u4e2d\u6700\u591a\u53ef\u4ee5\u7f13\u5b58\u591a\u5c11\u6570\u636e\uff0c\u5f53\u5230\u8fbe\u8be5\u6570\u503c\u65f6\uff0cnginx\u4f1a\u5220\u9664\u6700\u5c11\u8bbf\u95ee\u7684\u6570\u636e\u3002\n\n\u4f8b\uff1aproxy_cache_path /data/nginx_cache/ levels=1:2 keys_zone=my_zone:10m inactive=300s max_size=5g\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#proxy_cache_2","title":"proxy_cache\u793a\u4f8b","text":"<pre><code>http \n{\n    ...;\n\n    proxy_cache_path /data/nginx_cache/ levels=1:2 keys_zone=my_zone:10m inactive=300s max_size=5g;\n\n    ...;\n\n    server\n    {\n        listen 80;\n        server_name www.aminglinux.com;\n        #\u7f13\u51b2\u533a\u9ed8\u8ba4\u5f00\u542f\uff0c\u8fd9\u4e2a\u914d\u7f6e\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u662f\u5426\u9700\u8981\u8bbe\u7f6e\u5927\u5c0f\u6765\u8fdb\u884c\u914d\u7f6e\uff0c\u4e5f\u53ef\u4f7f\u7528\u9ed8\u8ba4\n        proxy_buffering on;\n        proxy_buffer_size 4k;\n        proxy_buffers 2 4k;\n        proxy_busy_buffers_size 4k;\n        proxy_temp_path /tmp/nginx_proxy_tmp 1 2;\n        proxy_max_temp_file_size 20M;\n        proxy_temp_file_write_size 8k;\n\n\n\n        location /\n        {\n            proxy_cache my_zone;\n            proxy_pass      http://192.168.10.110:8080/;\n            proxy_set_header Host   $host;\n            proxy_set_header X-Real-IP      $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n        }\n\n    }\n}\n\n\u8bf4\u660e\uff1a\u6838\u5fc3\u914d\u7f6e\u4e3aproxy_cache_path\u90a3\u4e00\u884c\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#10nginx","title":"10.Nginx\u7684\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e","text":"<pre><code>Nginx\u901a\u8fc7upstream\u548cproxy_pass\u5b9e\u73b0\u4e86\u8d1f\u8f7d\u5747\u8861\u3002\u672c\u8d28\u4e0a\u4e5f\u662fNginx\u7684\u53cd\u5411\u4ee3\u7406\u529f\u80fd\uff0c\u53ea\u4e0d\u8fc7\u540e\u7aef\u7684server\u4e3a\u591a\u4e2a\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_19","title":"\u6848\u4f8b\u4e00\uff08\u7b80\u5355\u7684\u8f6e\u8be2\uff09","text":"<pre><code>upstream www {\n    server 172.37.150.109:80;\n    server 172.37.150.101:80;\n    server 172.37.150.110:80;\n}\n\nserver {\n    listen 80;\n    server_name www.aminglinux.com;\n    location / {\n        proxy_pass http://www/;\n        proxy_set_header Host   $host;\n        proxy_set_header X-Real-IP      $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n\u8bf4\u660e\uff1a\u5f53\u88ab\u4ee3\u7406\u7684\u673a\u5668\u6709\u591a\u53f0\u65f6\uff0c\u9700\u8981\u4f7f\u7528upstream\u6765\u5b9a\u4e49\u4e00\u4e2a\u670d\u52a1\u5668\u7ec4\uff0c\n\u5176\u4e2dwww\u540d\u5b57\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u5728\u540e\u9762\u7684proxy_pass\u90a3\u91cc\u5f15\u7528\u3002\n\u8fd9\u6837nginx\u4f1a\u5c06\u8bf7\u6c42\u5747\u8861\u5730\u8f6e\u8be2\u53d1\u9001\u7ed9www\u7ec4\u5185\u7684\u4e09\u53f0\u670d\u52a1\u5668\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ip_hash","title":"\u6848\u4f8b\u4e8c\uff08\u5e26\u6743\u91cd\u8f6e\u8be2+ip_hash\u7b97\u6cd5\uff09","text":"<pre><code>upstream www {\n    server 172.37.150.109:80 weight=50;\n    server 172.37.150.101:80 weight=100;\n    server 172.37.150.110:80 weight=50;\n    ip_hash;\n}\n\nserver {\n    listen 80;\n    server_name www.aminglinux.com;\n    location / {\n        proxy_pass http://www/;\n        proxy_set_header Host   $host;\n        proxy_set_header X-Real-IP      $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n\u8bf4\u660e\uff1a\u53ef\u4ee5\u7ed9www\u7ec4\u5185\u7684\u4e09\u53f0\u673a\u5668\u914d\u7f6e\u6743\u91cd\uff0c\u6743\u91cd\u8d8a\u9ad8\uff0c\u5219\u5206\u914d\u5230\u7684\u8bf7\u6c42\u8d8a\u591a\u3002\nip_hash\u4e3anginx\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff0c\u539f\u7406\u5f88\u7b80\u5355\uff0c\u5b83\u6839\u636e\u8bf7\u6c42\u6240\u5c5e\u7684\u5ba2\u6237\u7aefIP\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u6570\u503c\uff0c\u7136\u540e\u628a\u8bf7\u6c42\u53d1\u5f80\u8be5\u6570\u503c\u5bf9\u5e94\u7684\u540e\u7aef\u3002\n\u6240\u4ee5\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u90fd\u4f1a\u53d1\u5f80\u540c\u4e00\u53f0\u540e\u7aef\uff0c\u9664\u975e\u8be5\u540e\u7aef\u4e0d\u53ef\u7528\u4e86\u3002ip_hash\u80fd\u591f\u8fbe\u5230\u4fdd\u6301\u4f1a\u8bdd\u7684\u6548\u679c\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#upstream","title":"\u6848\u4f8b\u4e09\uff08upstream\u5176\u4ed6\u914d\u7f6e\uff09","text":"<pre><code>upstream www {\n        server 172.37.150.109:80 weight=50 max_fails=3 fail_timeout=30s;\n        server 172.37.150.101:80 weight=100;\n        server 172.37.150.110:80 down;\n        server 172.37.150.110:80 backup;\n}\nserver\n{\n    listen 80;\n    server_name www.aminglinux.com;\n    location / {\n        proxy_next_upstream off;\n        proxy_pass http://www/;\n        proxy_set_header Host   $host;\n        proxy_set_header X-Real-IP      $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n\u8bf4\u660e\uff1adown\uff0c\u8868\u793a\u5f53\u524d\u7684server\u4e0d\u53c2\u4e0e\u8d1f\u8f7d\u5747\u8861\uff1b\nbackup\uff0c\u4e3a\u9884\u7559\u7684\u673a\u5668\uff0c\u5f53\u5176\u4ed6\u7684server\uff08\u975ebackup\uff09\u51fa\u73b0\u6545\u969c\u6216\u8005\u5fd9\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u8bf7\u6c42backup\u673a\u5668;\nmax_fails\uff0c\u5141\u8bb8\u8bf7\u6c42\u5931\u8d25\u7684\u6b21\u6570\uff0c\u9ed8\u8ba4\u4e3a1\u3002\u5f53\u5931\u8d25\u6b21\u6570\u8fbe\u5230\u8be5\u503c\uff0c\u5c31\u8ba4\u4e3a\u8be5\u673a\u5668down\u6389\u4e86\u3002 \u5931\u8d25\u7684\u6307\u6807\u662f\u7531proxy_next_upstream\u6a21\u5757\u5b9a\u4e49\uff0c\u5176\u4e2d404\u72b6\u6001\u7801\u4e0d\u8ba4\u4e3a\u662f\u5931\u8d25\u3002\nfail_timeount\uff0c\u5b9a\u4e49\u5931\u8d25\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u8be5\u65f6\u95f4\u6bb5\u5185\u8fbe\u5230max_fails\uff0c\u624d\u7b97\u771f\u6b63\u7684\u5931\u8d25\u3002\u9ed8\u8ba4\u662f10\u79d2\u3002\n\nproxy_next_upstream\uff0c\u901a\u8fc7\u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u72b6\u6001\u7801\uff0c\u8868\u793a\u670d\u52a1\u5668\u6b7b\u6d3b\uff0c\u53ef\u4ee5\u7075\u6d3b\u63a7\u5236\u540e\u7aef\u673a\u5668\u662f\u5426\u52a0\u5165\u5206\u53d1\u5217\u8868\u3002\n\u8bed\u6cd5: proxy_next_upstream error | timeout | invalid_header | http_500 | http_502 | http_503 | http_504 |http_404 | off ...; \n\u9ed8\u8ba4\u503c: proxy_next_upstream error timeout\n\nerror      # \u548c\u540e\u7aef\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u6216\u8005\u5411\u540e\u7aef\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u6216\u8005\u4ece\u540e\u7aef\u670d\u52a1\u5668\u63a5\u6536\u54cd\u5e94\u5934\u65f6\uff0c\u51fa\u73b0\u9519\u8bef\ntimeout    # \u548c\u540e\u7aef\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u6216\u8005\u5411\u540e\u7aef\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u6216\u8005\u4ece\u540e\u7aef\u670d\u52a1\u5668\u63a5\u6536\u54cd\u5e94\u5934\u65f6\uff0c\u51fa\u73b0\u8d85\u65f6\ninvalid_header  # \u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7a7a\u54cd\u5e94\u6216\u8005\u975e\u6cd5\u54cd\u5e94\u5934\nhttp_500   # \u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u72b6\u6001\u7801\u4e3a500\nhttp_502   # \u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u72b6\u6001\u7801\u4e3a502\nhttp_503   # \u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u72b6\u6001\u7801\u4e3a503\nhttp_504   # \u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u72b6\u6001\u7801\u4e3a504\nhttp_404   # \u540e\u7aef\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u72b6\u6001\u7801\u4e3a404\noff        # \u505c\u6b62\u5c06\u8bf7\u6c42\u53d1\u9001\u7ed9\u4e0b\u4e00\u53f0\u540e\u7aef\u670d\u52a1\u5668\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#uri","title":"\u6848\u4f8b\u56db\uff08\u6839\u636e\u4e0d\u540c\u7684uri\uff09","text":"<pre><code>    upstream aa.com {         \n                      server 192.168.0.121;\n                      server 192.168.0.122;  \n     }\n    upstream bb.com {  \n                       server 192.168.0.123;\n                       server 192.168.0.124;\n    }\n    server {\n        listen       80;\n        server_name  www.aminglinux.com;\n        location ~ aa.php\n        {\n            proxy_pass http://aa.com/;\n            proxy_set_header Host   $host;\n            proxy_set_header X-Real-IP      $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n        location ~ bb.php\n        {\n              proxy_pass http://bb.com/;\n              proxy_set_header Host   $host;\n              proxy_set_header X-Real-IP      $remote_addr;\n              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n        location /\n        {\n              proxy_pass http://bb.com/;\n              proxy_set_header Host   $host;\n              proxy_set_header X-Real-IP      $remote_addr;\n              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n}\n\n\u8bf4\u660e\uff1a\u8bf7\u6c42aa.php\u7684\uff0c\u4f1a\u5230aa.com\u7ec4\uff0c\u8bf7\u6c42bb.php\u7684\u4f1a\u5230bb.com\uff0c\u5176\u4ed6\u8bf7\u6c42\u5168\u90e8\u5230bb.com\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_20","title":"\u6848\u4f8b\u4e94\uff08\u6839\u636e\u4e0d\u540c\u7684\u76ee\u5f55\uff09","text":"<pre><code>upstream aaa.com\n{\n            server 192.168.111.6;\n}\nupstream bbb.com\n{\n            server 192.168.111.20;\n}\nserver {\n        listen 80;\n        server_name www.aminglinux.com;\n        location /aaa/\n        {\n            proxy_pass http://aaa.com/aaa/;\n            proxy_set_header Host   $host;\n            proxy_set_header X-Real-IP      $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n        location /bbb/\n        {\n            proxy_pass http://bbb.com/bbb/;\n            proxy_set_header Host   $host;\n            proxy_set_header X-Real-IP      $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n        location /\n        {\n            proxy_pass http://bbb.com/;\n            proxy_set_header Host   $host;\n            proxy_set_header X-Real-IP      $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#11nginx","title":"11.Nginx\u8bbf\u95ee\u63a7\u5236","text":"<pre><code>Nginx\u7684deny\u548callow\u6307\u4ee4\u662f\u7531ngx_http_access_module\u6a21\u5757\u63d0\u4f9b\uff0cNginx\u5b89\u88c5\u9ed8\u8ba4\u5185\u7f6e\u4e86\u8be5\u6a21\u5757\u3002\n\u9664\u975e\u5728\u5b89\u88c5\u65f6\u6709\u6307\u5b9a --without-http_access_module\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_21","title":"\u8bed\u6cd5","text":"<pre><code>\u8bed\u6cd5\uff1aallow/deny address | CIDR | unix: | all\n\n\u5b83\u8868\u793a\uff0c\u5141\u8bb8/\u62d2\u7edd\u67d0\u4e2aip\u6216\u8005\u4e00\u4e2aip\u6bb5\u8bbf\u95ee.\u5982\u679c\u6307\u5b9aunix:,\u90a3\u5c06\u5141\u8bb8socket\u7684\u8bbf\u95ee\u3002\n\u6ce8\u610f\uff1aunix\u57281.5.1\u4e2d\u65b0\u52a0\u5165\u7684\u529f\u80fd\u3002\n\n\u5728nginx\u4e2d\uff0callow\u548cdeny\u7684\u89c4\u5219\u662f\u6309\u987a\u5e8f\u6267\u884c\u7684\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_22","title":"\u793a\u4f8b","text":"<pre><code>\u793a\u4f8b1\uff1a\nlocation /\n{\n    allow 192.168.0.0/24;\n    allow 127.0.0.1;\n    deny all;\n}\n\n\u8bf4\u660e\uff1a\u8fd9\u6bb5\u914d\u7f6e\u503c\u5141\u8bb8192.168.0.0/24\u7f51\u6bb5\u548c127.0.0.1\u7684\u8bf7\u6c42\uff0c\u5176\u4ed6\u6765\u6e90IP\u5168\u90e8\u62d2\u7edd\u3002\n\n\u793a\u4f8b2\uff1a\nlocation ~ \"admin\"\n{\n    allow 110.21.33.121;\n    deny all\n}\n\u8bf4\u660e\uff1a\u8bbf\u95ee\u7684uri\u4e2d\u5305\u542badmin\u7684\u8bf7\u6c42\uff0c\u53ea\u5141\u8bb8110.21.33.121\u8fd9\u4e2aIP\u7684\u8bf7\u6c42\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#12nginxdocument_uri","title":"12.Nginx\u57fa\u4e8e$document_uri\u7684\u8bbf\u95ee\u63a7\u5236","text":"<pre><code>\u8fd9\u5c31\u7528\u5230\u4e86\u53d8\u91cf$document_uri\uff0c\u6839\u636e\u524d\u9762\u6240\u5b66\u5185\u5bb9\uff0c\u8be5\u53d8\u91cf\u7b49\u4ef7\u4e8e$uri\uff0c\u5176\u5b9e\u4e5f\u7b49\u4ef7\u4e8elocation\u5339\u914d\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1_2","title":"\u793a\u4f8b1","text":"<pre><code>if ($document_uri ~ \"/admin/\")\n{\n    return 403;\n}\n\n\u8bf4\u660e\uff1a\u5f53\u8bf7\u6c42\u7684uri\u4e2d\u5305\u542b/admin/\u65f6\uff0c\u76f4\u63a5\u8fd4\u56de403.\n\nif\u7ed3\u6784\u4e2d\u4e0d\u652f\u6301\u4f7f\u7528allow\u548cdeny\u3002\n\n\u6d4b\u8bd5\u94fe\u63a5\uff1a\n1. www.aminglinux.com/123/admin/1.html \u5339\u914d\n2. www.aminglinux.com/admin123/1.html  \u4e0d\u5339\u914d\n3. www.aminglinux.com/admin.php  \u4e0d\u5339\u914d\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2_2","title":"\u793a\u4f8b2","text":"<pre><code>if ($document_uri = /admin.php)\n{\n    return 403;\n}\n\n\u8bf4\u660e\uff1a\u8bf7\u6c42\u7684uri\u4e3a/admin.php\u65f6\u8fd4\u56de403\u72b6\u6001\u7801\u3002\n\n\u6d4b\u8bd5\u94fe\u63a5\uff1a\n1. www.aminglinux.com/admin.php \u5339\u914d\n2. www.aminglinux.com/123/admin.php  \u4e0d\u5339\u914d\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#3_2","title":"\u793a\u4f8b3","text":"<pre><code>if ($document_uri ~ '/data/|/cache/.*\\.php$')\n{\n    return 403;\n}\n\n\u8bf4\u660e\uff1a\u8bf7\u6c42\u7684uri\u5305\u542bdata\u6216\u8005cache\u76ee\u5f55\uff0c\u5e76\u4e14\u662fphp\u65f6\uff0c\u8fd4\u56de403\u72b6\u6001\u7801\u3002\n\n\u6d4b\u8bd5\u94fe\u63a5\uff1a\n1. www.aminglinux.com/data/123.php  \u5339\u914d\n2. www.aminglinux.com/cache1/123.php \u4e0d\u5339\u914d\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#13nginxrequest_uri","title":"13.nginx\u57fa\u4e8e$request_uri\u8bbf\u95ee\u63a7\u5236","text":"<pre><code>$request_uri\u6bd4$docuemnt_uri\u591a\u4e86\u8bf7\u6c42\u7684\u53c2\u6570\u3002\n\u4e3b\u8981\u662f\u9488\u5bf9\u8bf7\u6c42\u7684uri\u4e2d\u7684\u53c2\u6570\u8fdb\u884c\u63a7\u5236\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_23","title":"\u793a\u4f8b","text":"<pre><code>if ($request_uri ~ \"gid=\\d{9,12}\")\n{\n    return 403;\n}\n\n\u8bf4\u660e\uff1a\\d{9,12}\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8868\u793a9\u523012\u4e2a\u6570\u5b57\uff0c\u4f8b\u5982gid=1234567890\u5c31\u7b26\u53f7\u8981\u6c42\u3002\n\n\u6d4b\u8bd5\u94fe\u63a5\uff1a\n1. www.aminglinux.com/index.php?gid=1234567890&amp;pid=111  \u5339\u914d\n2. www.aminglinux.com/gid=123  \u4e0d\u5339\u914d\n\n\u80cc\u666f\u77e5\u8bc6\uff1a\n\u66fe\u7ecf\u6709\u4e00\u4e2a\u5ba2\u6237\u7684\u7f51\u7ad9cc\u653b\u51fb\uff0c\u5bf9\u65b9\u53d1\u8d77\u592a\u591a\u7c7b\u4f3c\u8fd9\u6837\u7684\u8bf7\u6c42\uff1a/read-123405150-1-1.html\n\u5b9e\u9645\u4e0a\uff0c\u8fd9\u6837\u7684\u8bf7\u6c42\u5e76\u4e0d\u662f\u6b63\u5e38\u7684\u8bf7\u6c42\uff0c\u7f51\u7ad9\u4f1a\u629b\u51fa\u4e00\u4e2a\u9875\u9762\uff0c\u63d0\u793a\u5e16\u5b50\u4e0d\u5b58\u5728\u3002\n\u6240\u4ee5\uff0c\u53ef\u4ee5\u76f4\u63a5\u9488\u5bf9\u8fd9\u6837\u7684\u8bf7\u6c42\uff0creturn 403\u72b6\u6001\u7801\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#14nginxuser_agent","title":"14.Nginx\u57fa\u4e8e$user_agent\u7684\u8bbf\u95ee\u63a7\u5236","text":"<pre><code>user_agent\u5927\u5bb6\u5e76\u4e0d\u964c\u751f\uff0c\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u6210\u6d4f\u89c8\u5668\u6807\u8bc6\uff0c\u5305\u62ec\u4e00\u4e9b\u8718\u86db\u722c\u866b\u90fd\u53ef\u4ee5\u901a\u8fc7user_agent\u6765\u8fa8\u8bc6\u3002\n\u901a\u8fc7\u89c2\u5bdf\u8bbf\u95ee\u65e5\u5fd7\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e9b\u641c\u7d22\u5f15\u64ce\u7684\u8718\u86db\u5bf9\u7f51\u7ad9\u8bbf\u95ee\u7279\u522b\u9891\u7e41\uff0c\u5b83\u4eec\u5e76\u4e0d\u53cb\u597d\u3002\n\u4e3a\u4e86\u51cf\u5c11\u670d\u52a1\u5668\u7684\u538b\u529b\uff0c\u5176\u5b9e\u53ef\u4ee5\u628a\u9664\u4e3b\u6d41\u641c\u7d22\u5f15\u64ce\u8718\u86db\u5916\u7684\u5176\u4ed6\u8718\u86db\u722c\u866b\u5168\u90e8\u5c01\u6389\u3002\n\u53e6\u5916\uff0c\u4e00\u4e9bcc\u653b\u51fb\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u89c2\u5bdf\u5b83\u4eec\u7684user_agent\u627e\u5230\u89c4\u5f8b\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_24","title":"\u793a\u4f8b","text":"<pre><code>if ($user_agent ~ 'YisouSpider|MJ12bot/v1.4.2|YoudaoBot|Tomato')\n{\n    return 403;\n}\n\u8bf4\u660e\uff1auser_agent\u5305\u542b\u4ee5\u4e0a\u5173\u952e\u8bcd\u7684\u8bf7\u6c42\uff0c\u5168\u90e8\u8fd4\u56de403\u72b6\u6001\u7801\u3002\n\n\u6d4b\u8bd5\uff1a\n1. curl -A \"123YisouSpider1.0\"\n2. curl -A \"MJ12bot/v1.4.1\"\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#15nginxhttp_referer","title":"15.Nginx\u57fa\u4e8e$http_referer\u7684\u8bbf\u95ee\u63a7\u5236","text":"<pre><code>\u5728\u524d\u9762\u8bb2\u89e3rewrite\u65f6\uff0c\u66fe\u7ecf\u7528\u8fc7\u8be5\u53d8\u91cf\uff0c\u5f53\u65f6\u5b9e\u73b0\u4e86\u9632\u76d7\u94fe\u529f\u80fd\u3002\n\u5176\u5b9e\u57fa\u4e8e\u8be5\u53d8\u91cf\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u505a\u4e00\u4e9b\u7279\u6b8a\u7684\u9700\u6c42\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_25","title":"\u793a\u4f8b","text":"<pre><code>\u80cc\u666f\uff1a\u7f51\u7ad9\u88ab\u9ed1\u6302\u9a6c\uff0c\u641c\u7d22\u5f15\u64ce\u6536\u5f55\u7684\u7f51\u9875\u662f\u6709\u95ee\u9898\u7684\uff0c\u5f53\u901a\u8fc7\u641c\u7d22\u5f15\u64ce\u70b9\u51fb\u5230\u7f51\u7ad9\u65f6\uff0c\u5374\u663e\u793a\u4e00\u4e2a\u535a\u5f69\u7f51\u7ad9\u3002\n\u7531\u4e8e\u67e5\u627e\u6728\u9a6c\u9700\u8981\u65f6\u95f4\uff0c\u4e0d\u80fd\u9a6c\u4e0a\u89e3\u51b3\uff0c\u4e3a\u4e86\u4e0d\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\uff0c\u53ef\u4ee5\u9488\u5bf9\u6b64\u7c7b\u8bf7\u6c42\u505a\u4e00\u4e2a\u7279\u6b8a\u64cd\u4f5c\u3002\n\u6bd4\u5982\uff0c\u53ef\u4ee5\u628a\u4ece\u767e\u5ea6\u8bbf\u95ee\u7684\u94fe\u63a5\u76f4\u63a5\u8fd4\u56de404\u72b6\u6001\u7801\uff0c\u6216\u8005\u8fd4\u56de\u4e00\u6bb5html\u4ee3\u7801\u3002\n\nif ($http_referer ~ 'baidu.com')\n{\n    return 404;\n}\n\n\u6216\u8005\n\nif ($http_referer ~ 'baidu.com')\n{\n    return 200 \"&lt;html&gt;&lt;script&gt;window.location.href='//$host$request_uri';&lt;/script&gt;&lt;/html&gt;\";\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#16nginx","title":"16.Nginx\u7684\u9650\u901f","text":"<pre><code>\u53ef\u4ee5\u901a\u8fc7ngx_http_limit_conn_module\u548cngx_http_limit_req_module\u6a21\u5757\u6765\u5b9e\u73b0\u9650\u901f\u7684\u529f\u80fd\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ngx_http_limit_conn_module","title":"ngx_http_limit_conn_module","text":"<pre><code>\u8be5\u6a21\u5757\u4e3b\u8981\u9650\u5236\u4e0b\u8f7d\u901f\u5ea6\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1_3","title":"#1. \u5e76\u53d1\u9650\u5236","text":"<pre><code>\u914d\u7f6e\u793a\u4f8b\nhttp\n{\n    ...\n    limit_conn_zone $binary_remote_addr zone=aming:10m;\n    ...\n    server\n    {\n        ...\n        limit_conn aming 10;\n        ...   \n    }\n}\n\u8bf4\u660e\uff1a\u9996\u5148\u7528limit_conn_zone\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5185\u5b58\u533a\u5757\u7d22\u5f15aming\uff0c\u5927\u5c0f\u4e3a10m\uff0c\u5b83\u4ee5$binary_remote_addr\u4f5c\u4e3akey\u3002\n\u8be5\u914d\u7f6e\u53ea\u80fd\u5728http\u91cc\u9762\u914d\u7f6e\uff0c\u4e0d\u652f\u6301\u5728server\u91cc\u914d\u7f6e\u3002\n\nlimit_conn \u5b9a\u4e49\u9488\u5bf9aming\u8fd9\u4e2azone\uff0c\u5e76\u53d1\u8fde\u63a5\u4e3a10\u4e2a\u3002\u5728\u8fd9\u9700\u8981\u6ce8\u610f\u4e00\u4e0b\uff0c\u8fd9\u4e2a10\u6307\u7684\u662f\u5355\u4e2aIP\u7684\u5e76\u53d1\u6700\u591a\u4e3a10\u4e2a\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2_3","title":"#2. \u901f\u5ea6\u9650\u5236","text":"<pre><code>location ~ /download/ {\n    ...\n    limit_rate_after 512k;\n    limit_rate 150k;\n    ...\n}\n\u8bf4\u660e\uff1alimit_rate_after\u5b9a\u4e49\u5f53\u4e00\u4e2a\u6587\u4ef6\u4e0b\u8f7d\u5230\u6307\u5b9a\u5927\u5c0f\uff08\u672c\u4f8b\u4e2d\u4e3a512k\uff09\u4e4b\u540e\u5f00\u59cb\u9650\u901f\uff1b\nlimit_rate \u5b9a\u4e49\u4e0b\u8f7d\u901f\u5ea6\u4e3a150k/s\u3002\n\n\u6ce8\u610f\uff1a\u8fd9\u4e24\u4e2a\u53c2\u6570\u9488\u5bf9\u6bcf\u4e2a\u8bf7\u6c42\u9650\u901f\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ngx_http_limit_req_module","title":"ngx_http_limit_req_module","text":"<pre><code>\u8be5\u6a21\u5757\u4e3b\u8981\u7528\u6765\u9650\u5236\u8bf7\u6c42\u6570\u3002\n\u53ef\u4ee5\u7528\u6765\u9632ddos\u653b\u51fb\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1-limit_req_zone","title":"#1. limit_req_zone","text":"<pre><code>\u8bed\u6cd5: limit_req_zone $variable zone=name:size rate=rate;\n\u9ed8\u8ba4\u503c: none\n\u914d\u7f6e\u6bb5: http\n\n\u8bbe\u7f6e\u4e00\u5757\u5171\u4eab\u5185\u5b58\u9650\u5236\u57df\u7528\u6765\u4fdd\u5b58\u952e\u503c\u7684\u72b6\u6001\u53c2\u6570\u3002 \u7279\u522b\u662f\u4fdd\u5b58\u4e86\u5f53\u524d\u8d85\u51fa\u8bf7\u6c42\u7684\u6570\u91cf\u3002 \n\u952e\u7684\u503c\u5c31\u662f\u6307\u5b9a\u7684\u53d8\u91cf\uff08\u7a7a\u503c\u4e0d\u4f1a\u88ab\u8ba1\u7b97\uff09\u3002\n\u5982limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\n\u8bf4\u660e\uff1a\u533a\u57df\u540d\u79f0\u4e3aone\uff0c\u5927\u5c0f\u4e3a10m\uff0c\u5e73\u5747\u5904\u7406\u7684\u8bf7\u6c42\u9891\u7387\u4e0d\u80fd\u8d85\u8fc7\u6bcf\u79d2\u4e00\u6b21,\u952e\u503c\u662f\u5ba2\u6237\u7aefIP\u3002\n\u4f7f\u7528$binary_remote_addr\u53d8\u91cf\uff0c \u53ef\u4ee5\u5c06\u6bcf\u6761\u72b6\u6001\u8bb0\u5f55\u7684\u5927\u5c0f\u51cf\u5c11\u523064\u4e2a\u5b57\u8282\uff0c\u8fd9\u68371M\u7684\u5185\u5b58\u53ef\u4ee5\u4fdd\u5b58\u5927\u7ea61\u4e076\u5343\u4e2a64\u5b57\u8282\u7684\u8bb0\u5f55\u3002\n\u5982\u679c\u9650\u5236\u57df\u7684\u5b58\u50a8\u7a7a\u95f4\u8017\u5c3d\u4e86\uff0c\u5bf9\u4e8e\u540e\u7eed\u6240\u6709\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u90fd\u4f1a\u8fd4\u56de 503 (Service Temporarily Unavailable)\u9519\u8bef\u3002\n\u901f\u5ea6\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u6bcf\u79d2\u5904\u7406\u8bf7\u6c42\u6570\u548c\u6bcf\u5206\u949f\u5904\u7406\u8bf7\u6c42\u6570\uff0c\u5176\u503c\u5fc5\u987b\u662f\u6574\u6570\uff0c\n\u6240\u4ee5\u5982\u679c\u4f60\u9700\u8981\u6307\u5b9a\u6bcf\u79d2\u5904\u7406\u5c11\u4e8e1\u4e2a\u7684\u8bf7\u6c42\uff0c2\u79d2\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528 \u201c30r/m\u201d\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2-limit_req","title":"#2. limit_req","text":"<pre><code>\u8bed\u6cd5: limit_req zone=name [burst=number] [nodelay];\n\u9ed8\u8ba4\u503c: \u2014\n\u914d\u7f6e\u6bb5: http, server, location\n\n\u8bbe\u7f6e\u5bf9\u5e94\u7684\u5171\u4eab\u5185\u5b58\u9650\u5236\u57df\u548c\u5141\u8bb8\u88ab\u5904\u7406\u7684\u6700\u5927\u8bf7\u6c42\u6570\u9608\u503c\u3002 \n\u5982\u679c\u8bf7\u6c42\u7684\u9891\u7387\u8d85\u8fc7\u4e86\u9650\u5236\u57df\u914d\u7f6e\u7684\u503c\uff0c\u8bf7\u6c42\u5904\u7406\u4f1a\u88ab\u5ef6\u8fdf\uff0c\u6240\u4ee5\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u662f\u4ee5\u5b9a\u4e49\u7684\u9891\u7387\u88ab\u5904\u7406\u7684\u3002 \n\u8d85\u8fc7\u9891\u7387\u9650\u5236\u7684\u8bf7\u6c42\u4f1a\u88ab\u5ef6\u8fdf\uff0c\u76f4\u5230\u88ab\u5ef6\u8fdf\u7684\u8bf7\u6c42\u6570\u8d85\u8fc7\u4e86\u5b9a\u4e49\u7684\u9608\u503c\uff0c\n\u8fd9\u65f6\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u4f1a\u88ab\u7ec8\u6b62\uff0c\u5e76\u8fd4\u56de503 (Service Temporarily Unavailable) \u9519\u8bef\u3002\n\n\u8fd9\u4e2a\u9608\u503c\u7684\u9ed8\u8ba4\u503c\u4e3a0\u3002\u5982\uff1a\nlimit_req_zone $binary_remote_addr zone=aming:10m rate=1r/s;\nserver {\n    location /upload/ {\n        limit_req zone=aming burst=5;\n    }\n}\n\n\u9650\u5236\u5e73\u5747\u6bcf\u79d2\u4e0d\u8d85\u8fc7\u4e00\u4e2a\u8bf7\u6c42\uff0c\u540c\u65f6\u5141\u8bb8\u8d85\u8fc7\u9891\u7387\u9650\u5236\u7684\u8bf7\u6c42\u6570\u4e0d\u591a\u4e8e5\u4e2a\u3002\n\n\u5982\u679c\u4e0d\u5e0c\u671b\u8d85\u8fc7\u7684\u8bf7\u6c42\u88ab\u5ef6\u8fdf\uff0c\u53ef\u4ee5\u7528nodelay\u53c2\u6570,\u5982\uff1a\n\nlimit_req zone=aming burst=5 nodelay;\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>http {\n    limit_req_zone $binary_remote_addr zone=aming:10m rate=1r/s;\n\n    server {\n        location  ^~ /download/ {  \n            limit_req zone=aming burst=5;\n        }\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ip","title":"\u8bbe\u5b9a\u767d\u540d\u5355IP","text":"<pre><code>\u5982\u679c\u662f\u9488\u5bf9\u516c\u53f8\u5185\u90e8IP\u6216\u8005lo\uff08127.0.0.1\uff09\u4e0d\u8fdb\u884c\u9650\u901f\uff0c\u5982\u4f55\u505a\u5462\uff1f\u8fd9\u5c31\u8981\u7528\u5230geo\u6a21\u5757\u4e86\u3002\n\n\u5047\u5982\uff0c\u9884\u628a127.0.0.1\u548c192.168.100.0/24\u7f51\u6bb5\u8bbe\u7f6e\u4e3a\u767d\u540d\u5355\uff0c\u9700\u8981\u8fd9\u6837\u505a\u3002\n\u5728http { }\u91cc\u9762\u589e\u52a0\uff1a\ngeo $limited {\n    default 1;\n    127.0.0.1/32 0;\n    192.168.100.0/24 0;\n}\n\nmap $limited $limit {\n    1 $binary_remote_addr;\n    0 \"\";\n}\n\n\u539f\u6765\u7684 \u201climit_req_zone $binary_remote_addr \u201d \u6539\u4e3a\u201climit_req_zone $limit\u201d\n\n\u5b8c\u6574\u793a\u4f8b\uff1a\n\nhttp {\n    geo $limited {\n        default 1;\n        127.0.0.1/32 0;\n        192.168.100.0/24 0;\n    }\n\n    map $limited $limit {\n        1 $binary_remote_addr;\n        0 \"\";\n    }\n\n    limit_req_zone $limit zone=aming:10m rate=1r/s;\n\n    server {\n        location  ^~ /download/ {  \n            limit_req zone=aming burst=5;\n        }\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#17nginxtomcatbasic","title":"17.Nginx\u7684\u7528\u6237\u8ba4\u8bc1\uff08\u7c7b\u4f3ctomcatbasic\u8ba4\u8bc1\uff09","text":"<pre><code>\u5f53\u8bbf\u95ee\u4e00\u4e9b\u79c1\u5bc6\u8d44\u6e90\u65f6\uff0c\u6700\u597d\u914d\u7f6e\u7528\u6237\u8ba4\u8bc1\uff0c\u589e\u52a0\u5b89\u5168\u6027\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_26","title":"\u6b65\u9aa4\u548c\u793a\u4f8b","text":"<ul> <li>\u5b89\u88c5httpd</li> </ul> <pre><code>yum install -y httpd\n</code></pre> <ul> <li>\u4f7f\u7528htpasswd\u751f\u4ea7\u5bc6\u7801\u6587\u4ef6</li> </ul> <pre><code>htpasswd -c /usr/local/nginx/conf/htpasswd liyedong #\u521b\u5efa\u65b0\u6587\u4ef6\nhtpasswd /usr/local/nginx/conf/htpasswd liyedong1 #\u8ffd\u52a0\u6216\u8005\u4fee\u6539\n</code></pre> <ul> <li>\u914d\u7f6enginx\u7528\u6237\u8ba4\u8bc1</li> </ul> <pre><code>location  /admin/\n{\n    auth_basic \"Auth\";\n    auth_basic_user_file /usr/local/nginx/conf/htpasswd;\n}\n</code></pre> <ul> <li>\u6d4b\u8bd5</li> </ul> <pre><code>mkdir -p /data/wwwroot/www.1.com/admin\necho i am admin &gt; /data/wwwroot/www.1.com/admin/admin.html\nhttp://www.1.com/admin/admin.html\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#18ca","title":"18.CA\u8bc1\u4e66","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ca","title":"\u4ec0\u4e48\u662fCA\uff1f","text":"<pre><code>CA \u662f\u201cCertificate Authority\u201d\u7684\u7f29\u5199\uff0c\u4e5f\u53eb\u201c\u8bc1\u4e66\u6388\u6743\u4e2d\u5fc3\u201d\u3002\u5b83\u662f\u8d1f\u8d23\u7ba1\u7406\u548c\u7b7e\u53d1\u8bc1\u4e66\u7684\u7b2c\u4e09\u65b9\u673a\u6784\uff0c\n\u5c31\u597d\u6bd4\u4f8b\u5b50\u91cc\u9762\u7684\u4e2d\u4ecbC\u516c\u53f8\u3002\n\u4e00\u822c\u6765\u8bf4\uff0cCA\u5fc5\u987b\u662f\u6240\u6709\u884c\u4e1a\u548c\u6240\u6709\u516c\u4f17\u90fd\u4fe1\u4efb\u7684\u3001\u8ba4\u53ef\u7684\u3002\u56e0\u6b64\u5b83\u5fc5\u987b\u5177\u6709\u8db3\u591f\u7684\u6743\u5a01\u6027\u3002\n\u5c31\u597d\u6bd4A\u3001B\u4e24\u516c\u53f8\u90fd\u5fc5\u987b\u4fe1\u4efbC\u516c\u53f8\uff0c\u624d\u4f1a\u627eC\u516c\u53f8\u4f5c\u4e3a\u516c\u7ae0\u7684\u4e2d\u4ecb\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ca_1","title":"\u4ec0\u4e48\u662fCA\u8bc1\u4e66\uff1f","text":"<pre><code>CA\u8bc1\u4e66\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662fCA\u9881\u53d1\u7684\u8bc1\u4e66\u3002\n\n\u524d\u9762\u5df2\u7ecf\u8bf4\u4e86\uff0c\u4eba\u4eba\u90fd\u53ef\u4ee5\u627e\u5de5\u5177\u5236\u4f5c\u8bc1\u4e66\u3002\u4f46\u662f\u4f60\u4e00\u4e2a\u5c0f\u7834\u5b69\u5236\u4f5c\u51fa\u6765\u7684\u8bc1\u4e66\u662f\u6ca1\u5565\u7528\u5904\u7684\u3002\n\u56e0\u4e3a\u4f60\u4e0d\u662f\u6743\u5a01\u7684CA\u673a\u5173\uff0c\u4f60\u81ea\u5df1\u641e\u7684\u8bc1\u4e66\u4e0d\u5177\u6709\u6743\u5a01\u6027\u3002\n\u8fd9\u5c31\u597d\u6bd4\u4e0a\u8ff0\u7684\u4f8b\u5b50\u91cc\uff0c\u67d0\u4e2a\u574f\u4eba\u81ea\u5df1\u523b\u4e86\u4e00\u4e2a\u516c\u7ae0\uff0c\u76d6\u5230\u4ecb\u7ecd\u4fe1\u4e0a\u3002\u4f46\u662f\u522b\u4eba\u4e00\u770b\uff0c\n\u4e0d\u662f\u53d7\u4fe1\u4efb\u7684\u4e2d\u4ecb\u516c\u53f8\u7684\u516c\u7ae0\uff0c\u5c31\u4e0d\u4e88\u7406\u776c\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_27","title":"\u4ec0\u4e48\u662f\u8bc1\u4e66\u4e4b\u95f4\u7684\u4fe1\u4efb\u5173\u7cfb\uff1f","text":"<pre><code>\u5728\u5f00\u7bc7\u7684\u4f8b\u5b50\u91cc\u8c08\u5230\uff0c\u5f15\u5165\u4e2d\u4ecb\u540e\uff0c\u4e1a\u52a1\u5458\u8981\u540c\u65f6\u5e26\u4e24\u4e2a\u4ecb\u7ecd\u4fe1\u3002\u7b2c\u4e00\u4e2a\u4ecb\u7ecd\u4fe1\u5305\u542b\u4e86\u4e24\u4e2a\u516c\u7ae0\uff0c\u5e76\u6ce8\u660e\uff0c\u516c\u7ae0C\u4fe1\u4efb\u516c\u7ae0A\u3002\n\u8bc1\u4e66\u95f4\u7684\u4fe1\u4efb\u5173\u7cfb\uff0c\u5c31\u548c\u8fd9\u4e2a\u7c7b\u4f3c\u3002\u5c31\u662f\u7528\u4e00\u4e2a\u8bc1\u4e66\u6765\u8bc1\u660e\u53e6\u4e00\u4e2a\u8bc1\u4e66\u662f\u771f\u5b9e\u53ef\u4fe1\u6ef4\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_28","title":"\u4ec0\u4e48\u662f\u8bc1\u4e66\u4fe1\u4efb\u94fe\uff1f","text":"<pre><code>\u5b9e\u9645\u4e0a\uff0c\u8bc1\u4e66\u4e4b\u95f4\u7684\u4fe1\u4efb\u5173\u7cfb\uff0c\u662f\u53ef\u4ee5\u5d4c\u5957\u7684\u3002\n\u6bd4\u5982\uff0cC\u4fe1\u4efbA1\uff0cA1\u4fe1\u4efbA2\uff0cA2\u4fe1\u4efbA3......\u8fd9\u4e2a\u53eb\u505a\u8bc1\u4e66\u7684\u4fe1\u4efb\u94fe\u3002\n\u53ea\u8981\u4f60\u4fe1\u4efb\u94fe\u4e0a\u7684\u5934\u4e00\u4e2a\u8bc1\u4e66\uff0c\u90a3\u540e\u7eed\u7684\u8bc1\u4e66\uff0c\u90fd\u662f\u53ef\u4ee5\u4fe1\u4efb\u6ef4\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_29","title":"\u4ec0\u4e48\u662f\u6839\u8bc1\u4e66\uff1f","text":"<pre><code>\u6839\u8bc1\u4e66\u7684\u6d0b\u6587\u53eb\u201croot certificate\u201d\uff0c\u4e3a\u4e86\u8bf4\u6e05\u695a\u6839\u8bc1\u4e66\u662f\u548b\u56de\u4e8b\uff0c\u518d\u6765\u770b\u4e2a\u7a0d\u5fae\u590d\u6742\u70b9\u7684\u4f8b\u5b50\u3002\n\u5047\u8bbeC\u8bc1\u4e66\u4fe1\u4efbA\u548cB\uff1b\u7136\u540eA\u4fe1\u4efbA1\u548cA2\uff1bB\u4fe1\u4efbB1\u548cB2\u3002\u5219\u5b83\u4eec\u4e4b\u95f4\uff0c\u6784\u6210\u5982\u4e0b\u7684\u4e00\u4e2a\u6811\u5f62\u5173\u7cfb\uff08\u4e00\u4e2a\u5012\u7acb\u7684\u6811\uff09\u3002\n</code></pre> <pre><code>\u5904\u4e8e\u6700\u9876\u4e0a\u7684\u6811\u6839\u4f4d\u7f6e\u7684\u90a3\u4e2a\u8bc1\u4e66\uff0c\u5c31\u662f\u201c\u6839\u8bc1\u4e66\u201d\u3002\u9664\u4e86\u6839\u8bc1\u4e66\uff0c\u5176\u5b83\u8bc1\u4e66\u90fd\u8981\u4f9d\u9760\u4e0a\u4e00\u7ea7\u7684\u8bc1\u4e66\uff0c\u6765\u8bc1\u660e\u81ea\u5df1\u3002\n\u90a3\u8c01\u6765\u8bc1\u660e\u201c\u6839\u8bc1\u4e66\u201d\u53ef\u9760\u5462\uff1f\n\u5b9e\u9645\u4e0a\uff0c\u6839\u8bc1\u4e66\u81ea\u5df1\u8bc1\u660e\u81ea\u5df1\u662f\u53ef\u9760\u6ef4\uff08\u6216\u8005\u6362\u53e5\u8bdd\u8bf4\uff0c\u6839\u8bc1\u4e66\u662f\u4e0d\u9700\u8981\u88ab\u8bc1\u660e\u6ef4\uff09\u3002\n\u806a\u660e\u7684\u540c\u5b66\u6b64\u523b\u5e94\u8be5\u610f\u8bc6\u5230\u4e86\uff1a\u6839\u8bc1\u4e66\u662f\u6574\u4e2a\u8bc1\u4e66\u4f53\u7cfb\u5b89\u5168\u7684\u6839\u672c\u3002\n\u6240\u4ee5\uff0c\u5982\u679c\u67d0\u4e2a\u8bc1\u4e66\u4f53\u7cfb\u4e2d\uff0c\u6839\u8bc1\u4e66\u51fa\u4e86\u95ee\u9898\uff08\u4e0d\u518d\u53ef\u4fe1\u4e86\uff09\uff0c\u90a3\u4e48\u6240\u6709\u88ab\u6839\u8bc1\u4e66\u6240\u4fe1\u4efb\u7684\u5176\u5b83\u8bc1\u4e66\uff0c\u4e5f\u5c31\u4e0d\u518d\u53ef\u4fe1\u4e86\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_30","title":"\u8bc1\u4e66\u6709\u5565\u7528\uff1f","text":"<p>CA\u8bc1\u4e66\u7684\u4f5c\u7528\u6709\u5f88\u591a\uff0c\u53ea\u5217\u51fa\u5e38\u7528\u7684\u51e0\u4e2a\u3002</p> <ul> <li>\u9a8c\u8bc1\u7f51\u7ad9\u662f\u5426\u53ef\u4fe1\uff08\u9488\u5bf9HTTPS\uff09</li> </ul> <pre><code>\u901a\u5e38\uff0c\u6211\u4eec\u5982\u679c\u8bbf\u95ee\u67d0\u4e9b\u654f\u611f\u7684\u7f51\u9875\uff08\u6bd4\u5982\u7528\u6237\u767b\u5f55\u7684\u9875\u9762\uff09\uff0c\u5176\u534f\u8bae\u90fd\u4f1a\u4f7f\u7528HTTPS\u800c\u4e0d\u662fHTTP,\u56e0\u4e3aHTTP\u534f\u8bae\u662f\u660e\u6587\u7684\uff0c\n\u4e00\u65e6\u6709\u574f\u4eba\u5728\u5077\u7aa5\u4f60\u7684\u7f51\u7edc\u901a\u8baf\uff0c\u4ed6/\u5979\u5c31\u53ef\u4ee5\u770b\u5230\u7f51\u7edc\u901a\u8baf\u7684\u5185\u5bb9\uff08\u6bd4\u5982\u4f60\u7684\u5bc6\u7801\u3001\u94f6\u884c\u5e10\u53f7\u3001\u7b49\uff09\u3002\n\u800c HTTPS \u662f\u52a0\u5bc6\u7684\u534f\u8bae\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u4f60\u7684\u4f20\u8f93\u8fc7\u7a0b\u4e2d\uff0c\u574f\u86cb\u65e0\u6cd5\u5077\u7aa5\u3002\n\u4f46\u662f\uff0c\u5343\u4e07\u4e0d\u8981\u4ee5\u4e3a\uff0cHTTPS\u534f\u8bae\u6709\u4e86\u52a0\u5bc6\uff0c\u5c31\u53ef\u9ad8\u6795\u65e0\u5fe7\u4e86\u3002\n\u5047\u8bbe\u6709\u4e00\u4e2a\u574f\u4eba\uff0c\u641e\u4e86\u4e00\u4e2a\u5047\u7684\u7f51\u94f6\u7684\u7ad9\u70b9\uff0c\u7136\u540e\u8bf1\u9a97\u4f60\u4e0a\u8fd9\u4e2a\u7ad9\u70b9\u3002\n\u5047\u8bbe\u4f60\u53c8\u6bd4\u8f83\u5355\u7eaf\uff0c\u4e00\u4e0d\u7559\u795e\uff0c\u5c31\u628a\u4f60\u7684\u5e10\u53f7\uff0c\u53e3\u4ee4\u90fd\u8f93\u5165\u8fdb\u53bb\u4e86\u3002\u90a3\u8fd9\u4e2a\u574f\u86cb\u7684\u9634\u8c0b\u5c31\u5f97\u901e\u4e86\u3002\n\u4e3a\u4e86\u9632\u6b62\u574f\u4eba\u8fd9\u4e48\u5e72\uff0cHTTPS \u534f\u8bae\u9664\u4e86\u6709\u52a0\u5bc6\u7684\u673a\u5236\uff0c\u8fd8\u6709\u4e00\u5957\u8bc1\u4e66\u7684\u673a\u5236\u3002\u901a\u8fc7\u8bc1\u4e66\u6765\u786e\u4fdd\uff0c\u67d0\u4e2a\u7ad9\u70b9\u786e\u5b9e\u5c31\u662f\u67d0\u4e2a\u7ad9\u70b9\u3002\n\u6709\u4e86\u8bc1\u4e66\u4e4b\u540e\uff0c\u5f53\u4f60\u7684\u6d4f\u89c8\u5668\u5728\u8bbf\u95ee\u67d0\u4e2aHTTPS\u7f51\u7ad9\u65f6\uff0c\u4f1a\u9a8c\u8bc1\u8be5\u7ad9\u70b9\u4e0a\u7684CA\u8bc1\u4e66\uff08\u7c7b\u4f3c\u4e8e\u9a8c\u8bc1\u4ecb\u7ecd\u4fe1\u7684\u516c\u7ae0\uff09\u3002\n\u5982\u679c\u6d4f\u89c8\u5668\u53d1\u73b0\u8be5\u8bc1\u4e66\u6ca1\u6709\u95ee\u9898\uff08\u8bc1\u4e66\u88ab\u67d0\u4e2a\u6839\u8bc1\u4e66\u4fe1\u4efb\u3001\u8bc1\u4e66\u4e0a\u7ed1\u5b9a\u7684\u57df\u540d\u548c\u8be5\u7f51\u7ad9\u7684\u57df\u540d\u4e00\u81f4\u3001\u8bc1\u4e66\u6ca1\u6709\u8fc7\u671f\uff09\uff0c\n\u90a3\u4e48\u9875\u9762\u5c31\u76f4\u63a5\u6253\u5f00\uff0c\u5426\u5219\u7684\u8bdd\uff0c\u6d4f\u89c8\u5668\u4f1a\u7ed9\u51fa\u4e00\u4e2a\u8b66\u544a\uff0c\u544a\u8bc9\u4f60\u8be5\u7f51\u7ad9\u7684\u8bc1\u4e66\u5b58\u5728\u67d0\u67d0\u95ee\u9898\uff0c\u662f\u5426\u7ee7\u7eed\u8bbf\u95ee\u8be5\u7ad9\u70b9\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#19ssl","title":"19.SSL\u539f\u7406","text":"<pre><code>\u8981\u60f3\u5f04\u660e\u767dSSL\u8ba4\u8bc1\u539f\u7406\uff0c\u9996\u5148\u8981\u5bf9CA\u6709\u6709\u6240\u4e86\u89e3\uff0c\u5b83\u5728SSL\u8ba4\u8bc1\u8fc7\u7a0b\u4e2d\u6709\u975e\u5e38\u91cd\u8981\u7684\u4f5c\u7528\u3002\n\u8bf4\u767d\u4e86\uff0cCA\u5c31\u662f\u4e00\u4e2a\u7ec4\u7ec7\uff0c\u4e13\u95e8\u4e3a\u7f51\u7edc\u670d\u52a1\u5668\u9881\u53d1\u8bc1\u4e66\u7684\uff0c\u56fd\u9645\u77e5\u540d\u7684CA\u673a\u6784\u6709VeriSign\u3001Symantec\uff0c\u56fd\u5185\u7684\u6709GlobalSign\u3002\n\u6bcf\u4e00\u5bb6CA\u90fd\u6709\u81ea\u5df1\u7684\u6839\u8bc1\u4e66\uff0c\u7528\u6765\u5bf9\u5b83\u6240\u7b7e\u53d1\u8fc7\u7684\u670d\u52a1\u5668\u7aef\u8bc1\u4e66\u8fdb\u884c\u9a8c\u8bc1\u3002\n\n\u5982\u679c\u670d\u52a1\u5668\u63d0\u4f9b\u65b9\u60f3\u4e3a\u81ea\u5df1\u7684\u670d\u52a1\u5668\u7533\u8bf7\u8bc1\u4e66\uff0c\u5b83\u5c31\u9700\u8981\u5411CA\u673a\u6784\u63d0\u51fa\u7533\u8bf7\u3002\n\u670d\u52a1\u5668\u63d0\u4f9b\u65b9\u5411CA\u63d0\u4f9b\u81ea\u5df1\u7684\u8eab\u4efd\u4fe1\u606f\uff0cCA\u5224\u660e\u7533\u8bf7\u8005\u7684\u8eab\u4efd\u540e\uff0c\u5c31\u4e3a\u5b83\u5206\u914d\u4e00\u4e2a\u516c\u94a5\uff0c\n\u5e76\u4e14CA\u5c06\u8be5\u516c\u94a5\u548c\u670d\u52a1\u5668\u8eab\u4efd\u7ed1\u5b9a\u5728\u4e00\u8d77\uff0c\u5e76\u4e3a\u4e4b\u7b7e\u5b57\uff0c\u8fd9\u5c31\u5f62\u6210\u4e86\u4e00\u4e2a\u670d\u52a1\u5668\u7aef\u8bc1\u4e66\u3002\n\n\u5982\u679c\u4e00\u4e2a\u7528\u6237\u60f3\u9274\u522b\u53e6\u4e00\u4e2a\u8bc1\u4e66\u7684\u771f\u4f2a\uff0c\u4ed6\u5c31\u7528CA\u7684\u516c\u94a5\u5bf9\u90a3\u4e2a\u8bc1\u4e66\u4e0a\u7684\u7b7e\u5b57\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4e00\u65e6\u9a8c\u8bc1\u901a\u8fc7\uff0c\u8be5\u8bc1\u4e66\u5c31\u88ab\u8ba4\u4e3a\u662f\u6709\u6548\u7684\u3002\n\u8bc1\u4e66\u5b9e\u9645\u662f\u7531\u8bc1\u4e66\u7b7e\u8bc1\u673a\u5173\uff08CA\uff09\u7b7e\u53d1\u7684\u5bf9\u7528\u6237\u7684\u516c\u94a5\u7684\u8ba4\u8bc1\u3002\n\n\u8bc1\u4e66\u7684\u5185\u5bb9\u5305\u62ec\uff1a\u7535\u5b50\u7b7e\u8bc1\u673a\u5173\u7684\u4fe1\u606f\u3001\u516c\u94a5\u7528\u6237\u4fe1\u606f\u3001\u516c\u94a5\u3001\u6743\u5a01\u673a\u6784\u7684\u7b7e\u5b57\u548c\u6709\u6548\u671f\u7b49\u7b49\u3002\n\u76ee\u524d\uff0c\u8bc1\u4e66\u7684\u683c\u5f0f\u548c\u9a8c\u8bc1\u65b9\u6cd5\u666e\u904d\u9075\u5faaX.509\u56fd\u9645\u6807\u51c6\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_31","title":"#\u7533\u8bf7\u8bc1\u4e66\u8fc7\u7a0b","text":"<pre><code>\u9996\u5148\u8981\u6709\u4e00\u4e2aCA\u6839\u8bc1\u4e66\uff0c\u7136\u540e\u7528CA\u6839\u8bc1\u4e66\u6765\u7b7e\u53d1\u7528\u6237\u8bc1\u4e66\u3002\n\u7528\u6237\u8fdb\u884c\u8bc1\u4e66\u7533\u8bf7\uff1a\n1. \u5148\u751f\u6210\u4e00\u4e2a\u79c1\u94a5\n2. \u7528\u79c1\u94a5\u751f\u6210\u8bc1\u4e66\u8bf7\u6c42(\u8bc1\u4e66\u8bf7\u6c42\u91cc\u5e94\u542b\u6709\u516c\u94a5\u4fe1\u606f)\n3. \u5229\u7528\u8bc1\u4e66\u670d\u52a1\u5668\u7684CA\u6839\u8bc1\u4e66\u6765\u7b7e\u53d1\u8bc1\u4e66\n\n\u8fd9\u6837\u6700\u7ec8\u62ff\u5230\u4e00\u4e2a\u7531CA\u6839\u8bc1\u4e66\u7b7e\u53d1\u7684\u8bc1\u4e66\uff0c\u5176\u5b9e\u8bc1\u4e66\u91cc\u4ec5\u6709\u516c\u94a5\uff0c\u800c\u79c1\u94a5\u662f\u5728\u7528\u6237\u624b\u91cc\u7684\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ssl","title":"SSL\u5de5\u4f5c\u6d41\u7a0b\uff08\u5355\u5411\uff09","text":"<pre><code>1.\u5ba2\u6237\u7aefsay hello \u670d\u52a1\u7aef\n2.\u670d\u52a1\u7aef\u5c06\u8bc1\u4e66\u3001\u516c\u94a5\u7b49\u53d1\u7ed9\u5ba2\u6237\u7aef\n3.\u5ba2\u6237\u7aefCA\u9a8c\u8bc1\u8bc1\u4e66\uff0c\u6210\u529f\u7ee7\u7eed\u3001\u4e0d\u6210\u529f\u5f39\u51fa\u9009\u62e9\u9875\u9762\n4.\u5ba2\u6237\u7aef\u544a\u77e5\u670d\u52a1\u7aef\u6240\u652f\u6301\u7684\u52a0\u5bc6\u7b97\u6cd5\n5.\u670d\u52a1\u7aef\u9009\u62e9\u6700\u9ad8\u7ea7\u522b\u52a0\u5bc6\u7b97\u6cd5\u660e\u6587\u901a\u77e5\u5ba2\u6237\u7aef\n6.\u5ba2\u6237\u7aef\u751f\u6210\u968f\u673a\u5bf9\u79f0\u5bc6\u94a5key\uff0c\u4f7f\u7528\u670d\u52a1\u7aef\u516c\u94a5\u52a0\u5bc6\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\n7.\u670d\u52a1\u7aef\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6\uff0c\u83b7\u53d6\u5bf9\u79f0\u5bc6\u94a5key\n8.\u540e\u7eed\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4f7f\u7528\u8be5\u5bc6\u94a5key\u8fdb\u884c\u52a0\u5bc6\u901a\u4fe1\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ssl_1","title":"SSL\u5de5\u4f5c\u6d41\u7a0b\uff08\u53cc\u5411\uff09","text":"<p>\u5355\u5411\u8ba4\u8bc1\uff0c\u4ec5\u4ec5\u662f\u5ba2\u6237\u7aef\u9700\u8981\u68c0\u9a8c\u670d\u52a1\u7aef\u8bc1\u4e66\u662f\u5426\u662f\u6b63\u786e\u7684\uff0c\u800c\u670d\u52a1\u7aef\u4e0d\u4f1a\u68c0\u9a8c\u5ba2\u6237\u7aef\u8bc1\u4e66\u662f\u5426\u662f\u6b63\u786e\u7684\u3002 \u53cc\u5411\u8ba4\u8bc1\uff0c\u6307\u5ba2\u6237\u7aef\u9a8c\u8bc1\u670d\u52a1\u5668\u7aef\u8bc1\u4e66\uff0c\u800c\u670d\u52a1\u5668\u4e5f\u9700\u8981\u901a\u8fc7CA\u7684\u516c\u94a5\u8bc1\u4e66\u6765\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002</p> <p>\u53cc\u5411\u9a8c\u8bc1\u7684\u8fc7\u7a0b\uff1a</p> <pre><code>1.\u5ba2\u6237\u7aefsay hello \u670d\u52a1\u7aef\n2.\u670d\u52a1\u7aef\u5c06\u8bc1\u4e66\u3001\u516c\u94a5\u7b49\u53d1\u7ed9\u5ba2\u6237\u7aef\n3.\u5ba2\u6237\u7aefCA\u9a8c\u8bc1\u8bc1\u4e66\uff0c\u6210\u529f\u7ee7\u7eed\u3001\u4e0d\u6210\u529f\u5f39\u51fa\u9009\u62e9\u9875\u9762\n4.\u5ba2\u6237\u7aef\u5c06\u81ea\u5df1\u7684\u8bc1\u4e66\u548c\u516c\u94a5\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\n5.\u670d\u52a1\u7aef\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u5982\u4e0d\u901a\u8fc7\u76f4\u63a5\u65ad\u5f00\u8fde\u63a5\n6.\u5ba2\u6237\u7aef\u544a\u77e5\u670d\u52a1\u7aef\u6240\u652f\u6301\u7684\u52a0\u5bc6\u7b97\u6cd5\n7.\u670d\u52a1\u7aef\u9009\u62e9\u6700\u9ad8\u7ea7\u522b\u52a0\u5bc6\u7b97\u6cd5\u4f7f\u7528\u5ba2\u6237\u7aef\u516c\u94a5\u52a0\u5bc6\u540e\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\n8.\u5ba2\u6237\u7aef\u6536\u5230\u540e\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6\u5e76\u751f\u6210\u968f\u673a\u5bf9\u79f0\u5bc6\u94a5key\uff0c\u4f7f\u7528\u670d\u52a1\u7aef\u516c\u94a5\u52a0\u5bc6\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\n9.\u670d\u52a1\u7aef\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6\uff0c\u83b7\u53d6\u5bf9\u79f0\u5bc6\u94a5key\n10.\u540e\u7eed\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4f7f\u7528\u8be5\u5bc6\u94a5key\u8fdb\u884c\u52a0\u5bc6\u901a\u4fe1\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#20ca","title":"20.\u81ea\u5236ca\u8bc1\u4e66","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ca_2","title":"\u751f\u6210CA\u6839\u8bc1\u4e66","text":"<pre><code>mkdir -p /etc/pki/ca_test //\u521b\u5efaCA\u66f4\u8bc1\u4e66\u7684\u76ee\u5f55\n\ncd /etc/pki/ca_test\n\nmkdir root server client newcerts  //\u521b\u5efa\u51e0\u4e2a\u76f8\u5173\u7684\u76ee\u5f55\n\necho 01 &gt; serial   //\u5b9a\u4e49\u5e8f\u5217\u53f7\u4e3a01\n\necho 01 &gt; crlnumber  //\u5b9a\u4e49crl\u53f7\u4e3a01\n\ntouch index.txt  //\u521b\u5efaindex.txt\n\ncd ..\n\nvi tls/openssl.cnf  //\u6539\u914d\u7f6e\u6587\u4ef6\ndefault_ca     = CA_default \u6539\u4e3a default_ca     = CA_test\n[ CA_default ] \u6539\u4e3a [ CA_test ]\ndir             = /etc/pki/CA  \u6539\u4e3a  dir             = /etc/pki/ca_test\ncertificate = $dir/cacert.pem  \u6539\u4e3a certificate   = $dir/root/ca.crt\nprivate_key = $dir/private/cakey.pe \u6539\u4e3a  private_key = $dir/root/ca.key\n\nopenssl genrsa -out /etc/pki/ca_test/root/ca.key  #\u751f\u6210\u79c1\u94a5\n\nopenssl req -new -key /etc/pki/ca_test/root/ca.key -out /etc/pki/ca_test/root/ca.csr   \n#\u751f\u6210\u8bf7\u6c42\u6587\u4ef6\uff0c\u4f1a\u8ba9\u6211\u4eec\u586b\u5199\u4e00\u4e9b\u6307\u6807,\u8fd9\u91cc\u8981\u6ce8\u610f\uff1a\u5982\u679c\u5728\u8fd9\u4e00\u6b65\u586b\u5199\u4e86\u76f8\u5e94\u7684\u6307\u6807\uff0c\n#\u6bd4\u5982Country Name\u3001State or Province Name\u3001hostname\u3002\nCountry Name (2 letter code) [XX]:\nState or Province Name (full name) []:bj\nLocality Name (eg, city) [Default City]:bj\nOrganization Name (eg, company) [Default Company Ltd]:kehua\nOrganizational Unit Name (eg, section) []:test\nCommon Name (eg, your name or your server's hostname) []:www.1.com\nEmail Address []:liyedong@kehua.com\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:123456\nAn optional company name []:kehua\n\nopenssl x509 -req -days 3650 -in /etc/pki/ca_test/root/ca.csr -signkey /etc/pki/ca_test/root/ca.key -out /etc/pki/ca_test/root/ca.crt \n#\u751f\u6210crt\u6587\u4ef6\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#server","title":"\u751f\u6210server\u7aef\u8bc1\u4e66","text":"<pre><code>cd /etc/pki/ca_test/server\n\nopenssl genrsa -out server.key   #\u751f\u6210\u79c1\u94a5\u6587\u4ef6\n\nopenssl req -new -key server.key -out server.csr#\u751f\u6210\u8bc1\u4e66\u8bf7\u6c42\u6587\u4ef6\uff0c\u586b\u5199\u4fe1\u606f\u9700\u8981\u548cca.csr\u4e2d\u7684Organization Name\u4fdd\u6301\u4e00\u81f4\n\nopenssl ca -in server.csr -cert /etc/pki/ca_test/root/ca.crt -keyfile /etc/pki/ca_test/root/ca.key -out server.crt -days 3650  \n#\u7528\u6839\u8bc1\u4e66\u7b7e\u540dserver.csr\uff0c\u6700\u540e\u751f\u6210\u516c\u94a5\u6587\u4ef6server.crt\uff0c\u6b64\u6b65\u9aa4\u4f1a\u6709\u4e24\u4e2a\u5730\u65b9\u9700\u8981\u8f93\u5165y\nSign the certificate? [y/n]:y\n1 out of 1 certificate requests certified, commit? [y/n]y\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_32","title":"\u751f\u6210\u5ba2\u6237\u7aef\u8bc1\u4e66","text":"<pre><code>#\u5982\u679c\u505assl\u7684\u53cc\u5411\u8ba4\u8bc1\uff0c\u8fd8\u9700\u8981\u7ed9\u5ba2\u6237\u7aef\u751f\u6210\u4e00\u4e2a\u8bc1\u4e66\uff0c\u6b65\u9aa4\u548c\u4e0a\u9762\u7684\u57fa\u672c\u4e00\u81f4\ncd /etc/pki/ca_test/client\n\nopenssl genrsa -out  client.key  #\u751f\u6210\u79c1\u94a5\u6587\u4ef6\n\nopenssl req -new  -key client.key -out client.csr  #\u751f\u6210\u8bf7\u6c42\u6587\u4ef6\uff0c\u586b\u5199\u4fe1\u606f\u9700\u8981\u548cca.csr\u4e2d\u7684Organization Name\u4fdd\u6301\u4e00\u81f4\n\nopenssl ca -in client.csr -cert /etc/pki/ca_test/root/ca.crt -keyfile /etc/pki/ca_test/root/ca.key -out client.crt -days 3650 \n#\u7b7e\u540dclient.csr, \u751f\u6210client.crt\uff0c\u6b64\u6b65\u5982\u679c\u51fa\u73b0\nfailed to update database\nTXT_DB error number 2\n\n\u9700\u6267\u884c\uff1a\nsed -i 's/unique_subject = yes/unique_subject = no/' /etc/pki/ca_test/index.txt.attr\n\n#\u6267\u884c\u5b8c\uff0c\u518d\u6b21\u91cd\u590d\u6267\u884c\u7b7e\u540dclient.csr\u90a3\u4e2a\u64cd\u4f5c\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#21nginxssl","title":"21.Nginx\u914d\u7f6eSSL","text":""},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_7","title":"Nginx\u914d\u7f6e\u793a\u4f8b\uff08\u5355\u5411\uff09","text":"<pre><code>./configure --prefix=/usr/local/nginx --with-http_ssl_module \n#\u51fa\u73b0\u9519\u8bef\n#\u5b89\u88c5\nyum -y install openssl openssl-devel\n./configure --prefix=/usr/local/nginx --with-http_ssl_module \nmake install\n</code></pre> <pre><code>cp /etc/pki/ca_test/server/server.* /usr/local/nginx/conf/\nserver{\n    listen 443 ssl;\n    server_name www.1.com;\n    root /data/wwwroot/www.1.com;\n    index index.html index.htm;\n    access_log /tmp/log;\n    ssl_certificate server.crt;\n    ssl_certificate_key server.key;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers ALL:!DH:!EXPORT:!RC4:+HIGH:+MEDIUM:!eNULL;\n    ssl_prefer_server_ciphers on;\n    location /admin/\n    {\n        auth_basic \"Auth\";\n        auth_basic_user_file /usr/local/nginx/conf/htpasswd;\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_33","title":"\u914d\u7f6e\u8bf4\u660e","text":"<pre><code>1. 443\u7aef\u53e3\u4e3assl\u76d1\u542c\u7aef\u53e3\u3002\n2. ssl on\u8868\u793a\u6253\u5f00ssl\u652f\u6301\u3002\n3. ssl_certificate\u6307\u5b9acrt\u6587\u4ef6\u6240\u5728\u8def\u5f84\uff0c\u5982\u679c\u5199\u76f8\u5bf9\u8def\u5f84\uff0c\u5fc5\u987b\u628a\u8be5\u6587\u4ef6\u548cnginx.conf\u6587\u4ef6\u653e\u5230\u4e00\u4e2a\u76ee\u5f55\u4e0b\u3002\n4. ssl_certificate_key\u6307\u5b9akey\u6587\u4ef6\u6240\u5728\u8def\u5f84\u3002\n5. ssl_protocols\u6307\u5b9aSSL\u534f\u8bae\u3002\n6. ssl_ciphers\u914d\u7f6essl\u52a0\u5bc6\u7b97\u6cd5\uff0c\u591a\u4e2a\u7b97\u6cd5\u7528:\u5206\u9694\uff0cALL\u8868\u793a\u5168\u90e8\u7b97\u6cd5\uff0c!\u8868\u793a\u4e0d\u542f\u7528\u8be5\u7b97\u6cd5\uff0c+\u8868\u793a\u5c06\u8be5\u7b97\u6cd5\u6392\u5230\u6700\u540e\u9762\u53bb\u3002\n7. ssl_prefer_server_ciphers \u5982\u679c\u4e0d\u6307\u5b9a\u9ed8\u8ba4\u4e3aoff\uff0c\u5f53\u4e3aon\u65f6\uff0c\u5728\u4f7f\u7528SSLv3\u548cTLS\u534f\u8bae\u65f6\uff0c\u670d\u52a1\u5668\u52a0\u5bc6\u7b97\u6cd5\u5c06\u4f18\u4e8e\u5ba2\u6237\u7aef\u52a0\u5bc6\u7b97\u6cd5\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_8","title":"Nginx\u914d\u7f6e\u53cc\u5411\u8ba4\u8bc1","text":"<pre><code>cp /etc/pki/ca_test/root/ca.crt /usr/local/nginx/conf/\n\u914d\u7f6e\u793a\u4f8b\uff1a\nserver{\n    listen 443 ssl;\n    server_name www.1.com;\n    root /data/wwwroot/www.1.com;\n    index index.html index.htm;\n    ssl_certificate server.crt;\n    ssl_certificate_key server.key;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers ALL:!DH:!EXPORT:!RC4:+HIGH:+MEDIUM:!eNULL;\n    ssl_prefer_server_ciphers on;\n    ssl_client_certificate ca.crt;\n    ssl_verify_client on;\n    location /admin/\n    {\n        auth_basic \"Auth\";\n        auth_basic_user_file /usr/local/nginx/conf/htpasswd;\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_34","title":"\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\u64cd\u4f5c","text":"<pre><code>\u5982\u679c\u4e0d\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u6d4f\u89c8\u5668\u4f1a\u51fa\u73b0400\u9519\u8bef\u3002400 Bad Request\uff08No required SSL certificate was sent\uff09\n\u9996\u5148\u9700\u8981\u5c06client.key\u8f6c\u6362\u4e3apfx(p12)\u683c\u5f0f\n\ncd /etc/pki/ca_test/client\nopenssl pkcs12 -export -inkey client.key -in client.crt -out client.pfx \n123456\n#\u8fd9\u4e00\u6b65\u9700\u8981\u8f93\u5165\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5bc6\u7801\uff0c\u4e00\u4f1a\u5728windows\u4e0a\u5b89\u88c5\u7684\u65f6\u5019\u8981\u7528\u5230\uff0c\u9700\u8981\u8bb0\u4e00\u4e0b\u3002\n\n\u7136\u540e\u5c06client.pfx\u62f7\u8d1d\u5230windows\u4e0b\uff0c\u53cc\u51fb\u5373\u53ef\u5b89\u88c5\u3002\n\u5728chrome\u6d4f\u89c8\u5668\u4e2d\u53ef\u4ee5\u67e5\u770b\u5230\u8be5\u8bc1\u4e66\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#22nginx","title":"22.Nginx\u7684\u9519\u8bef\u65e5\u5fd7","text":"<pre><code>Nginx\u9519\u8bef\u65e5\u5fd7\u5e73\u65f6\u4e0d\u7528\u592a\u5173\u6ce8\uff0c\u4f46\u662f\u4e00\u65e6\u51fa\u4e86\u95ee\u9898\uff0c\u5c31\u9700\u8981\u501f\u52a9\u9519\u8bef\u65e5\u5fd7\u6765\u5224\u65ad\u95ee\u9898\u6240\u5728\u3002\n\n\u914d\u7f6e\u53c2\u6570\u683c\u5f0f\uff1aerror_log /path/to/log level;\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_9","title":"Nginx\u9519\u8bef\u65e5\u5fd7\u7ea7\u522b","text":"<pre><code>\u5e38\u89c1\u7684\u9519\u8bef\u65e5\u5fd7\u7ea7\u522b\u6709debug | info | notice | warn | error | crit | alert | emerg\n\u7ea7\u522b\u8d8a\u9ad8\u8bb0\u5f55\u7684\u4fe1\u606f\u8d8a\u5c11\uff0c\u5982\u679c\u4e0d\u5b9a\u4e49\uff0c\u9ed8\u8ba4\u7ea7\u522b\u4e3aerror.\n\n\u5b83\u53ef\u4ee5\u914d\u7f6e\u5728main\u3001http\u3001server\u3001location\u6bb5\u91cc\u3002\n\n\u5982\u679c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u4e49\u4e86\u4e24\u4e2aerror_log\uff0c\u5728\u540c\u4e00\u4e2a\u914d\u7f6e\u6bb5\u91cc\u7684\u8bdd\u4f1a\u4ea7\u751f\u51b2\u7a81\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u6bb5\u91cc\u53ea\u5141\u8bb8\u914d\u7f6e\u4e00\u4e2aerror_log\u3002\n\u4f46\u662f\uff0c\u5728\u4e0d\u540c\u7684\u914d\u7f6e\u6bb5\u4e2d\u51fa\u73b0\u662f\u6ca1\u95ee\u9898\u7684\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_10","title":"Nginx\u9519\u8bef\u65e5\u5fd7\u793a\u4f8b","text":"<pre><code>error_log  /var/log/nginx/error.log crit;\n\u6700\u597d\u6bcf\u4e00\u4e2aserver\u914d\u7f6e\u4e00\u4e2a\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6 \u53ef\u4ee5\u65b9\u4fbf\u5b9a\u4f4d\u9519\u8bef\uff0c\u5f53server\u6bb5\u7684\u9519\u8bef\u65e5\u5fd7\u914d\u7f6e\u540e\uff0c\u53d1\u751f\u9519\u8bef\u65f6\u5c31\u4e0d\u4f1a\u518d\u5411\u8fd9\u4e2a\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\u5199\u5165\u65e5\u5fd7/usr/local/nginx/logs/error.log\n\u5982\u679c\u8981\u60f3\u5f7b\u5e95\u5173\u95ederror_log\uff0c\u9700\u8981\u8fd9\u6837\u914d\u7f6e\nerror_log /dev/null;\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#23nginx","title":"23.Nginx\u8bbf\u95ee\u65e5\u5fd7\u914d\u7f6e","text":"<pre><code>web\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u65e5\u5fd7\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u65e5\u5fd7\u6765\u5206\u6790\u7528\u6237\u7684\u8bbf\u95ee\u60c5\u51b5\uff0c\n\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u65e5\u5fd7\u53d1\u73b0\u4e00\u4e9b\u5f02\u5e38\u8bbf\u95ee\uff0c\u6bd4\u5982cc\u653b\u51fb\u3002\n\n\u683c\u5f0f\uff1a access_log /path/to/logfile format;\n\naccess_log\u53ef\u4ee5\u914d\u7f6e\u5230http, server, location\u914d\u7f6e\u6bb5\u4e2d\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_35","title":"\u914d\u7f6e\u793a\u4f8b","text":"<pre><code>server \n{\n    listen 80;\n    server_name www.aminglinux.com;\n    root /data/wwwroot/www.aminglinux.com;\n    index index.html index.php;\n    access_log /data/logs/www.aminglinux.com_access.log;\n}\n\u8bf4\u660e\uff1a\u82e5\u4e0d\u6307\u5b9alog_format\uff0c\u5219\u6309\u7167\u9ed8\u8ba4\u7684\u683c\u5f0f\u5199\u65e5\u5fd7\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#24nginx","title":"24.Nginx\u8bbf\u95ee\u65e5\u5fd7\u683c\u5f0f","text":"<pre><code>Nginx\u8bbf\u95ee\u65e5\u5fd7\u53ef\u4ee5\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684\u683c\u5f0f\uff0c\u6765\u6ee1\u8db3\u7279\u5b9a\u7684\u9700\u6c42\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_36","title":"\u8bbf\u95ee\u65e5\u5fd7\u683c\u5f0f\u793a\u4f8b","text":"<pre><code>\u793a\u4f8b1\n    log_format combined_realip '$remote_addr $http_x_forwarded_for [$time_local]'\n    '$host \"$request_uri\" $status'\n    '\"$http_referer\" \"$http_user_agent\"';\n\n\u793a\u4f8b2\n    log_format main '$remote_addr [$time_local] '\n    '$host \"$request_uri\" $status \"$request\"'\n    '\"$http_referer\" \"$http_user_agent\" \"$request_time\"';\n\n\u82e5\u4e0d\u914d\u7f6elog_format\u6216\u8005\u4e0d\u5728access_log\u914d\u7f6e\u4e2d\u6307\u5b9alog_format\uff0c\u5219\u9ed8\u8ba4\u683c\u5f0f\u4e3a\uff1a\n    '$remote_addr - $remote_user [$time_local] \"$request\" '\n    '$status $body_bytes_sent \"$http_referer\" '\n    '\"$http_user_agent\";\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_37","title":"\u914d\u7f6e\u5b9e\u4f8b","text":"<pre><code>#server\u7aef\u914d\u7f6e A.conf\nlog_format combined_realip '$remote_addr $http_x_forwarded_for [$time_local]'\n    '$host \"$request_uri\" $status'\n    '\"$http_referer\" \"$http_user_agent\"';#\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3acombined_realip\u7684\u65e5\u5fd7\u683c\u5f0f\nserver{\n    listen 99;\n    server_name localhost;\n    root /usr/local/nginx/html;\n    index index.html index.php;\n    access_log /data/logs/localhost.log combined_realip;\n}\n\n#\u4ee3\u7406\u7aef\u914d\u7f6e B.conf\nserver\n{\n    listen 8080;\n    server_name localhost;\n    location /\n    {\n        proxy_pass http://192.168.107.254:99/;\n        proxy_set_header Host   $host;\n        proxy_set_header X-Real-IP      $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n\ntail -f /data/logs/localhost.log\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:28:18 +0800]192.168.107.254 \"/\" 200\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:28:18 +0800]192.168.107.254 \"/favicon.ico\" 404\"http://192.168.107.254:8080/\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:28:19 +0800]192.168.107.254 \"/\" 304\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:28:20 +0800]192.168.107.254 \"/\" 304\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n192.168.107.1 - [23/Aug/2023:09:29:15 +0800]192.168.107.254 \"/\" 304\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:29:36 +0800]192.168.107.254 \"/\" 304\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_38","title":"\u5e38\u89c1\u53d8\u91cf","text":"\u53d8\u91cf \u8bf4\u660e $time_local \u901a\u7528\u65e5\u5fd7\u683c\u5f0f\u4e0b\u7684\u672c\u5730\u65f6\u95f4\uff1b\uff08\u670d\u52a1\u5668\u65f6\u95f4\uff09 $remote_addr \u5ba2\u6237\u7aef\uff08\u7528\u6237\uff09IP\u5730\u5740 $status \u8bf7\u6c42\u72b6\u6001\u7801\uff0c\u5982200\uff0c404\uff0c301\uff0c302\u7b49 $body_bytes_sent \u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u5b57\u8282\u6570\uff0c\u4e0d\u5305\u62ec\u54cd\u5e94\u5934\u7684\u5927\u5c0f $bytes_sent \u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u603b\u5b57\u8282\u6570 $request_length \u8bf7\u6c42\u7684\u957f\u5ea6\uff08\u5305\u62ec\u8bf7\u6c42\u884c\uff0c\u8bf7\u6c42\u5934\u548c\u8bf7\u6c42\u6b63\u6587\uff09 $request_time \u8bf7\u6c42\u5904\u7406\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c\u5c0f\u6570\u7684\u5f62\u5f0f $upstream_addr \u96c6\u7fa4\u8f6e\u8be2\u5730\u5740 $upstream_response_time \u6307\u4eceNginx\u5411\u540e\u7aef\uff08php-cgi)\u5efa\u7acb\u8fde\u63a5\u5f00\u59cb\u5230\u63a5\u53d7\u5b8c\u6570\u636e\u7136\u540e\u5173\u95ed\u8fde\u63a5\u4e3a\u6b62\u7684\u65f6\u95f4 $remote_user \u7528\u6765\u8bb0\u5f55\u5ba2\u6237\u7aef\u7528\u6237\u540d\u79f0 $request \u8bf7\u6c42\u65b9\u5f0f\uff08GET\u6216\u8005POST\u7b49\uff09+URL\uff08\u5305\u542b\\(request_method,\\)host,$request_uri\uff09 $http_user_agent \u7528\u6237\u6d4f\u89c8\u5668\u6807\u8bc6 $http_host \u8bf7\u6c42\u7684url\u5730\u5740\uff08\u76ee\u6807url\u5730\u5740\uff09\u7684host $host \u7b49\u540c\u4e8e$http_host $http_referer \u6765\u6e90\u9875\u9762\uff0c\u5373\u4ece\u54ea\u4e2a\u9875\u9762\u8f6c\u5230\u672c\u9875\uff0c\u5982\u679c\u76f4\u63a5\u5728\u6d4f\u89c8\u5668\u8f93\u5165\u7f51\u5740\u6765\u8bbf\u95ee\uff0c\u5219referer\u4e3a\u7a7a $uri \u8bf7\u6c42\u4e2d\u7684\u5f53\u524dURI(\u4e0d\u5e26\u8bf7\u6c42\u53c2\u6570\uff0c\u53c2\u6570\u4f4d\u4e8e\\(args)\uff0c\u4e0d\u540c\u4e8e\u6d4f\u89c8\u5668\u4f20\u9012\u7684\\)request_uri\u7684\u503c\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u5185\u90e8\u91cd\u5b9a\u5411\uff0c\u6216\u8005\u4f7f\u7528index\u6307\u4ee4\u8fdb\u884c\u4fee\u6539\u3002 $document_uri \u7b49\u540c\u4e8e$uri $request_uri \u6bd4\\(uri\u591a\u4e86\u53c2\u6570\uff0c\u5373\\)uri+$args $http_x_forwarded_for \u5982\u679c\u4f7f\u7528\u4e86\u4ee3\u7406\uff0c\u8fd9\u4e2a\u53c2\u6570\u4f1a\u8bb0\u5f55\u4ee3\u7406\u670d\u52a1\u5668\u7684ip\u548c\u5ba2\u6237\u7aef\u7684ip"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#25nginx","title":"25.Nginx\u8bbf\u95ee\u65e5\u5fd7\u8fc7\u6ee4","text":"<pre><code>\u4e00\u4e2a\u7f51\u7ad9\uff0c\u4f1a\u5305\u542b\u5f88\u591a\u5143\u7d20\uff0c\u5c24\u5176\u662f\u6709\u5927\u91cf\u7684\u56fe\u7247\u3001js\u3001css\u7b49\u9759\u6001\u5143\u7d20\u3002\n\u8fd9\u6837\u7684\u8bf7\u6c42\u5176\u5b9e\u53ef\u4ee5\u4e0d\u7528\u8bb0\u5f55\u65e5\u5fd7\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_39","title":"\u914d\u7f6e\u793a\u4f8b","text":"<pre><code>location ~* ^.+\\.(gif|jpg|png|css|js)$ \n{\n    access_log off;\n}\n\n\u6216\nlocation ~* ^.+\\.(gif|jpg|png|css|js)$                                      \n{\n    access_log /dev/null;\n}\n\nvi A.conf\n    log_format combined_realip '$remote_addr $http_x_forwarded_for [$time_local]'\n        '$host \"$request_uri\" $status'\n        '\"$http_referer\" \"$http_user_agent\"';#\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3acombined_realip\u7684\u65e5\u5fd7\u683c\u5f0f\n    server{\n        listen 99;\n        server_name localhost;\n        root /usr/local/nginx/html;\n        index index.html index.php;\n        location ~* ^.+\\.(gif|jpg|png|css|js)$\n        {\n            access_log off;\n        }\n        access_log /data/logs/localhost.log combined_realip;\n    }\ntail -f /data/logs/localhost.log\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:29:36 +0800]192.168.107.254 \"/\" 304\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:44:19 +0800]192.168.107.254 \"/1.css1\" 404\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n192.168.107.254 192.168.107.1 [23/Aug/2023:09:44:35 +0800]192.168.107.254 \"/1.css2\" 404\"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#26nginx","title":"26.Nginx\u8bbf\u95ee\u65e5\u5fd7\u5207\u5272","text":"<pre><code>\u5982\u679c\u4efb\u7531\u8bbf\u95ee\u65e5\u5fd7\u5199\u4e0b\u53bb\uff0c\u65e5\u5fd7\u6587\u4ef6\u4f1a\u53d8\u5f97\u8d8a\u6765\u8d8a\u5927\uff0c\u751a\u81f3\u662f\u5199\u6ee1\u78c1\u76d8\u3002\n\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u60f3\u529e\u6cd5\u628a\u65e5\u5fd7\u505a\u5207\u5272\uff0c\u6bd4\u5982\u6bcf\u5929\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u65e5\u5fd7\uff0c\u65e7\u7684\u65e5\u5fd7\u6309\u89c4\u5b9a\u65f6\u95f4\u5220\u9664\u5373\u53ef\u3002\n\n\u5b9e\u73b0\u65e5\u5fd7\u5207\u5272\u53ef\u4ee5\u901a\u8fc7\u5199shell\u811a\u672c\u6216\u8005\u7cfb\u7edf\u7684\u65e5\u5fd7\u5207\u5272\u673a\u5236\u5b9e\u73b0\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#shellnginx","title":"shell\u811a\u672c\u5207\u5272Nginx\u65e5\u5fd7","text":"<pre><code>vi log_rotate.sh\n\n#\u5207\u5272\u811a\u672c\u5185\u5bb9\uff1a\n#!/bin/bash\nlogdir=/data/logs/  #\u5b9a\u4e49\u65e5\u5fd7\u8def\u5f84\nprefix=`date -d \"-1 day\" +%y%m%d`  #\u5b9a\u4e49\u5207\u5272\u540e\u7684\u65e5\u5fd7\u524d\u7f00\ncd $logdir\nfor f in `ls *.log`\ndo\nmv $f $f-$prefix  #\u628a\u65e5\u5fd7\u6539\u540d\ndone\n/usr/local/nginx/sbin/nginx -s reload #/bin/kill -USR1 $(cat /usr/local/nginx/logs/nginx.pid 2&gt;/dev/null) 2&gt;/dev/null \u4e24\u53e5\u547d\u4ee4\u6548\u679c\u4e00\u6837\nbzip2 *$prefix  #\u538b\u7f29\u65e5\u5fd7\nfind . -type f -mtime +180 |xargs /bin/rm -f  #\u5220\u9664\u8d85\u8fc7180\u5929\u7684\u8001\u65e5\u5fd7\n\n\n\nsh -x log_rotate.sh #\u6267\u884c\u811a\u672c\u5e76\u4e14\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f\n\n\n#\u6dfb\u52a0\u5230\u6bcf\u65e5\u5de5\u4f5c\u4efb\u52a1\u4e2d\ncrontab -e\n0 0 * * * /bin/bash /usr/local/nginx/sbin/log_rotate.sh\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_40","title":"\u7cfb\u7edf\u65e5\u5fd7\u5207\u5272\u673a\u5236","text":"<pre><code>\u5728/etc/logrotate.d/\u4e0b\u521b\u5efanginx\u6587\u4ef6\uff0c\u5185\u5bb9\u4e3a\uff1a\nvi /etc/logrotate.d/nginx\n/data/logs/*log {\n    daily\n    rotate 30\n    missingok\n    notifempty\n    compress\n    sharedscripts\n    postrotate\n        /bin/kill -USR1 $(cat /usr/local/nginx/logs/nginx.pid 2&gt;/dev/null) 2&gt;/dev/null \n    endscript\n}\n\n\u8bf4\u660e\uff1a\n1 nginx\u65e5\u5fd7\u5728/data/logs/\u76ee\u5f55\u4e0b\u9762\uff0c\u65e5\u5fd7\u540d\u5b57\u4ee5log\u7ed3\u5c3e\n2 daily\u8868\u793a\u6bcf\u5929\u5207\u5272\n3 rotate 30\u8868\u793a\u65e5\u5fd7\u4fdd\u755930\u5929\n4 missingok\u8868\u793a\u5ffd\u7565\u9519\u8bef\n5 notifempty\u8868\u793a\u5982\u679c\u65e5\u5fd7\u4e3a\u7a7a\uff0c\u4e0d\u5207\u5272\n6 compress\u8868\u793a\u538b\u7f29\n7 sharedscripts\u548cendscript\u4e2d\u95f4\u53ef\u4ee5\u5f15\u7528\u7cfb\u7edf\u7684\u547d\u4ee4\n8 postrotate\u8868\u793a\u5f53\u5207\u5272\u4e4b\u540e\u8981\u6267\u884c\u7684\u547d\u4ee4\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#27nginx","title":"27.Nginx\u914d\u7f6e\u53c2\u6570\u4f18\u5316","text":"<pre><code>Nginx\u4f5c\u4e3a\u9ad8\u6027\u80fdweb\u670d\u52a1\u5668\uff0c\u5373\u4f7f\u4e0d\u7279\u610f\u8c03\u6574\u914d\u7f6e\u53c2\u6570\u4e5f\u53ef\u4ee5\u5904\u7406\u5927\u91cf\u7684\u5e76\u53d1\u8bf7\u6c42\u3002\n\u4ee5\u4e0b\u7684\u914d\u7f6e\u53c2\u6570\u662f\u501f\u9274\u7f51\u4e0a\u7684\u4e00\u4e9b\u8c03\u4f18\u53c2\u6570\uff0c\u4ec5\u4f5c\u4e3a\u53c2\u8003\uff0c\u4e0d\u89c1\u5f97\u9002\u4e8e\u4f60\u7684\u7ebf\u4e0a\u4e1a\u52a1\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#worker","title":"worker\u8fdb\u7a0b","text":"<ul> <li>worker_processes</li> </ul> <pre><code>\u8be5\u53c2\u6570\u8868\u793a\u542f\u52a8\u51e0\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u5efa\u8bae\u548c\u672c\u673aCPU\u6838\u6570\u4fdd\u6301\u4e00\u81f4\uff0c\u6bcf\u4e00\u6838CPU\u5904\u7406\u4e00\u4e2a\u8fdb\u7a0b\u3002\n</code></pre> <ul> <li>worker_rlimit_nofile</li> </ul> <pre><code>\u5b83\u8868\u793aNginx\u6700\u5927\u53ef\u7528\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e2a\u6570\uff0c\u9700\u8981\u914d\u5408\u7cfb\u7edf\u7684\u6700\u5927\u63cf\u8ff0\u7b26\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a102400\u3002\n\u8fd8\u9700\u8981\u5728\u7cfb\u7edf\u91cc\u6267\u884culimit -n 102400\u624d\u53ef\u4ee5\u3002\u8fd9\u4e2a\u914d\u7f6e\u53ea\u662f\u6682\u65f6\u7684\u3002\n\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u914d\u7f6e\u6587\u4ef6/etc/security/limits.conf\u4fee\u6539\n\u589e\u52a0\uff1a\n* soft nofile 655350\n* hard nofile 655350\n</code></pre> <ul> <li>worker_connections</li> </ul> <pre><code>\u8be5\u53c2\u6570\u7528\u6765\u914d\u7f6e\u6bcf\u4e2aNginx worker\u8fdb\u7a0b\u6700\u5927\u5904\u7406\u7684\u8fde\u63a5\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u4e5f\u51b3\u5b9a\u4e86\u8be5Nginx\u670d\u52a1\u5668\u6700\u591a\u80fd\u5904\u7406\u591a\u5c11\u5ba2\u6237\u7aef\u8bf7\u6c42\n\uff08worker_processes * worker_connections)\uff0c\u5efa\u8bae\u628a\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a10240\uff0c\u4e0d\u5efa\u8bae\u592a\u5927\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#httptcp","title":"http\u548ctcp\u8fde\u63a5","text":"<ul> <li>use epoll</li> </ul> <pre><code>\u4f7f\u7528epoll\u6a21\u5f0f\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\uff0c\u8be5\u6a21\u578b\u4e3aLinux\u7cfb\u7edf\u4e0b\u6700\u4f18\u65b9\u5f0f\u3002\n</code></pre> <ul> <li>multi_accept on</li> </ul> <pre><code>\u4f7f\u6bcf\u4e2aworker\u8fdb\u7a0b\u53ef\u4ee5\u540c\u65f6\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002\n</code></pre> <ul> <li>sendfile on</li> </ul> <pre><code>\u4f7f\u7528\u5185\u6838\u7684FD\u6587\u4ef6\u4f20\u8f93\u529f\u80fd\uff0c\u53ef\u4ee5\u51cf\u5c11user mode\u548ckernel mode\u7684\u5207\u6362\uff0c\u4ece\u800c\u63d0\u5347\u670d\u52a1\u5668\u6027\u80fd\u3002\n</code></pre> <ul> <li>tcp_nopush on</li> </ul> <pre><code>\u5f53tcp_nopush\u8bbe\u7f6e\u4e3aon\u65f6\uff0c\u4f1a\u8c03\u7528tcp_cork\u65b9\u6cd5\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\n\u4f7f\u7528\u8be5\u65b9\u6cd5\u4f1a\u4ea7\u751f\u8fd9\u6837\u7684\u6548\u679c\uff1a\u5f53\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u6570\u636e\u65f6\uff0c\u5185\u6838\u4e0d\u4f1a\u7acb\u9a6c\u5c01\u88c5\u5305\uff0c\u800c\u662f\u5f53\u6570\u636e\u91cf\u79ef\u7d2f\u5230\u4e00\u5b9a\u91cf\u65f6\u624d\u4f1a\u5c01\u88c5\uff0c\u7136\u540e\u4f20\u8f93\u3002\n</code></pre> <ul> <li>tcp_nodelay on</li> </ul> <pre><code>\u4e0d\u7f13\u5b58data-sends\uff08\u5173\u95ed Nagle \u7b97\u6cd5\uff09\uff0c\u8fd9\u4e2a\u80fd\u591f\u63d0\u9ad8\u9ad8\u9891\u53d1\u9001\u5c0f\u6570\u636e\u62a5\u6587\u7684\u5b9e\u65f6\u6027\u3002\n(\u5173\u4e8eNagle\u7b97\u6cd5)\n\u3010\u5047\u5982\u9700\u8981\u9891\u7e41\u7684\u53d1\u9001\u4e00\u4e9b\u5c0f\u5305\u6570\u636e\uff0c\u6bd4\u5982\u8bf41\u4e2a\u5b57\u8282\uff0c\u4ee5IPv4\u4e3a\u4f8b\u7684\u8bdd\uff0c\u5219\u6bcf\u4e2a\u5305\u90fd\u8981\u9644\u5e2640\u5b57\u8282\u7684\u5934\uff0c\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u603b\u8ba141\u4e2a\u5b57\u8282\u7684\u6570\u636e\u91cc\uff0c\u5176\u4e2d\u53ea\u67091\u4e2a\u5b57\u8282\u662f\u6211\u4eec\u9700\u8981\u7684\u6570\u636e\u3002\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u51fa\u73b0\u4e86Nagle\u7b97\u6cd5\u3002\n\u5b83\u89c4\u5b9a\uff1a\u5982\u679c\u5305\u7684\u5927\u5c0f\u6ee1\u8db3MSS\uff0c\u90a3\u4e48\u53ef\u4ee5\u7acb\u5373\u53d1\u9001\uff0c\u5426\u5219\u6570\u636e\u4f1a\u88ab\u653e\u5230\u7f13\u51b2\u533a\uff0c\u7b49\u5230\u5df2\u7ecf\u53d1\u9001\u7684\u5305\u88ab\u786e\u8ba4\u4e86\u4e4b\u540e\u624d\u80fd\u7ee7\u7eed\u53d1\u9001\u3002\n\u901a\u8fc7\u8fd9\u6837\u7684\u89c4\u5b9a\uff0c\u53ef\u4ee5\u964d\u4f4e\u7f51\u7edc\u91cc\u5c0f\u5305\u7684\u6570\u91cf\uff0c\u4ece\u800c\u63d0\u5347\u7f51\u7edc\u6027\u80fd\u3002\u3011\n</code></pre> <ul> <li>keepalive_timeout</li> </ul> <pre><code>\u5b9a\u4e49\u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5efa\u8bae30s\uff0c\u592a\u77ed\u6216\u8005\u592a\u957f\u90fd\u4e0d\u4e00\u5b9a\u5408\u9002\uff0c\u5f53\u7136\uff0c\u6700\u597d\u662f\u6839\u636e\u4e1a\u52a1\u81ea\u8eab\u7684\u60c5\u51b5\u6765\u52a8\u6001\u5730\u8c03\u6574\u8be5\u53c2\u6570\u3002\n</code></pre> <ul> <li>keepalive_requests</li> </ul> <pre><code>\u5b9a\u4e49\u5f53\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5904\u4e8e\u957f\u8fde\u63a5\u7684\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u6700\u591a\u53ef\u4ee5\u8bf7\u6c42\u591a\u5c11\u6b21\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u5f88\u5927\uff0c\u6bd4\u598250000.\n</code></pre> <ul> <li>reset_timeout_connection on</li> </ul> <pre><code>\u8bbe\u7f6e\u4e3aon\u7684\u8bdd\uff0c\u5f53\u5ba2\u6237\u7aef\u4e0d\u518d\u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u5141\u8bb8\u670d\u52a1\u7aef\u5173\u95ed\u8be5\u8fde\u63a5\u3002\n</code></pre> <ul> <li>client_body_timeout</li> </ul> <pre><code>\u5ba2\u6237\u7aef\u5982\u679c\u5728\u8be5\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u52a0\u8f7d\u5b8cbody\u6570\u636e\uff0c\u5219\u65ad\u5f00\u8fde\u63a5\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba460\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a10\u3002\n</code></pre> <ul> <li>send_timeout</li> </ul> <pre><code>\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u662f\u53d1\u9001\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u5373Nginx\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u6570\u636e\u5305\uff0c\u4f46\u5ba2\u6237\u7aef\u4e00\u76f4\u6ca1\u6709\u53bb\u63a5\u6536\u8fd9\u4e2a\u6570\u636e\u5305\u3002\n\u5982\u679c\u67d0\u4e2a\u8fde\u63a5\u8d85\u8fc7send_timeout\u5b9a\u4e49\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u90a3\u4e48Nginx\u5c06\u4f1a\u5173\u95ed\u8fd9\u4e2a\u8fde\u63a5\u3002\u5355\u4f4d\u662f\u79d2\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a3\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#buffercache","title":"buffer\u548ccache(\u4ee5\u4e0b\u914d\u7f6e\u90fd\u662f\u9488\u5bf9\u5355\u4e2a\u8bf7\u6c42)","text":"<ul> <li>client_body_buffer_size</li> </ul> <pre><code>\u5f53\u5ba2\u6237\u7aef\u4ee5POST\u65b9\u6cd5\u63d0\u4ea4\u4e00\u4e9b\u6570\u636e\u5230\u670d\u52a1\u7aef\u65f6\uff0c\u4f1a\u5148\u5199\u5165\u5230client_body_buffer\u4e2d\uff0c\u5982\u679cbuffer\u5199\u6ee1\u4f1a\u5199\u5230\u4e34\u65f6\u6587\u4ef6\u91cc\uff0c\u5efa\u8bae\u8c03\u6574\u4e3a128k\u3002\n</code></pre> <ul> <li>client_max_body_size</li> </ul> <pre><code>\u6d4f\u89c8\u5668\u5728\u53d1\u9001\u542b\u6709\u8f83\u5927HTTP body\u7684\u8bf7\u6c42\u65f6\uff0c\u5176\u5934\u90e8\u4f1a\u6709\u4e00\u4e2aContent-Length\u5b57\u6bb5\uff0cclient_max_body_size\u662f\u7528\u6765\u9650\u5236Content-Length\u6240\u793a\u503c\u7684\u5927\u5c0f\u7684\u3002\n\u8fd9\u4e2a\u9650\u5236body\u7684\u914d\u7f6e\u4e0d\u7528\u7b49Nginx\u63a5\u6536\u5b8c\u6240\u6709\u7684HTTP\u5305\u4f53\uff0c\u5c31\u53ef\u4ee5\u544a\u8bc9\u7528\u6237\u8bf7\u6c42\u8fc7\u5927\u4e0d\u88ab\u63a5\u53d7\u3002\u4f1a\u8fd4\u56de413\u72b6\u6001\u7801\u3002\n\u4f8b\u5982\uff0c\u7528\u6237\u8bd5\u56fe\u4e0a\u4f20\u4e00\u4e2a1GB\u7684\u6587\u4ef6\uff0cNginx\u5728\u6536\u5b8c\u5305\u5934\u540e\uff0c\u53d1\u73b0Content-Length\u8d85\u8fc7client_max_body_size\u5b9a\u4e49\u7684\u503c\uff0c\n\u5c31\u76f4\u63a5\u53d1\u9001413(Request Entity Too Large)\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002\n\u5c06\u8be5\u6570\u503c\u8bbe\u7f6e\u4e3a0\uff0c\u5219\u7981\u7528\u9650\u5236\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a10m\u3002\n</code></pre> <ul> <li>client_header_buffer_size</li> </ul> <pre><code>\u8bbe\u7f6e\u5ba2\u6237\u7aefheader\u7684buffer\u5927\u5c0f\uff0c\u5efa\u8bae4k\u3002\n</code></pre> <ul> <li>large_client_header_buffers</li> </ul> <pre><code>\u5bf9\u4e8e\u6bd4\u8f83\u5927\u7684header\uff08\u8d85\u8fc7client_header_buffer_size\uff09\u5c06\u4f1a\u4f7f\u7528\u8be5\u90e8\u5206buffer\uff0c\u4e24\u4e2a\u6570\u503c\uff0c\u7b2c\u4e00\u4e2a\u662f\u4e2a\u6570\uff0c\u7b2c\u4e8c\u4e2a\u662f\u6bcf\u4e2abuffer\u7684\u5927\u5c0f\u3002\n\u5efa\u8bae\u8bbe\u7f6e\u4e3a4 8k\n</code></pre> <ul> <li>open_file_cache</li> </ul> <pre><code>\u8be5\u53c2\u6570\u4f1a\u5bf9\u4ee5\u4e0b\u4fe1\u606f\u8fdb\u884c\u7f13\u5b58\uff1a\n\u6253\u5f00\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u6587\u4ef6\u5927\u5c0f\u548c\u4fee\u6539\u65f6\u95f4\u4fe1\u606f;\n\u5b58\u5728\u7684\u76ee\u5f55\u4fe1\u606f;\n\u641c\u7d22\u6587\u4ef6\u7684\u9519\u8bef\u4fe1\u606f\uff08\u6587\u4ef6\u4e0d\u5b58\u5728\u65e0\u6743\u9650\u8bfb\u53d6\u7b49\u4fe1\u606f\uff09\u3002\n\u683c\u5f0f\uff1aopen_file_cache max=size inactive=time;\nmax\u8bbe\u5b9a\u7f13\u5b58\u6587\u4ef6\u7684\u6570\u91cf\uff0cinactive\u8bbe\u5b9a\u7ecf\u8fc7\u591a\u957f\u65f6\u95f4\u6587\u4ef6\u6ca1\u88ab\u8bf7\u6c42\u540e\u5220\u9664\u7f13\u5b58\u3002\n\u5efa\u8bae\u8bbe\u7f6e open_file_cache max=102400 inactive=20s;\n</code></pre> <ul> <li>open_file_cache_valid</li> </ul> <pre><code>\u6307\u591a\u957f\u65f6\u95f4\u68c0\u67e5\u4e00\u6b21\u7f13\u5b58\u7684\u6709\u6548\u4fe1\u606f\u3002\u5efa\u8bae\u8bbe\u7f6e\u4e3a30s\u3002\n</code></pre> <ul> <li>open_file_cache_min_uses</li> </ul> <pre><code>open_file_cache\u6307\u4ee4\u4e2d\u7684inactive\u53c2\u6570\u65f6\u95f4\u5185\u6587\u4ef6\u7684\u6700\u5c11\u4f7f\u7528\u6b21\u6570\uff0c\n\u5982,\u5c06\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a1\uff0c\u5219\u8868\u793a\uff0c\u5982\u679c\u6587\u4ef6\u5728inactive\u65f6\u95f4\u5185\u4e00\u6b21\u90fd\u6ca1\u88ab\u4f7f\u7528\uff0c\u5b83\u5c06\u88ab\u79fb\u9664\u3002\n\u5efa\u8bae\u8bbe\u7f6e\u4e3a2\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_41","title":"\u538b\u7f29","text":"<pre><code>\u5bf9\u4e8e\u7eaf\u6587\u672c\u7684\u5185\u5bb9\uff0cNginx\u662f\u53ef\u4ee5\u4f7f\u7528gzip\u538b\u7f29\u7684\u3002\u4f7f\u7528\u538b\u7f29\u6280\u672f\u53ef\u4ee5\u51cf\u5c11\u5bf9\u5e26\u5bbd\u7684\u6d88\u8017\u3002\n\u7531ngx_http_gzip_module\u6a21\u5757\u652f\u6301\n\n\u914d\u7f6e\u5982\u4e0b\uff1a\ngzip on; #\u5f00\u542fgzip\u529f\u80fd\ngzip_min_length 1024; #\u8bbe\u7f6e\u8bf7\u6c42\u8d44\u6e90\u8d85\u8fc7\u8be5\u6570\u503c\u624d\u8fdb\u884c\u538b\u7f29\uff0c\u5355\u4f4d\u5b57\u8282\ngzip_buffers 16 8k; #\u8bbe\u7f6e\u538b\u7f29\u4f7f\u7528\u7684buffer\u5927\u5c0f\uff0c\u7b2c\u4e00\u4e2a\u6570\u5b57\u4e3a\u6570\u91cf\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u6bcf\u4e2abuffer\u7684\u5927\u5c0f\ngzip_comp_level 6; #\u8bbe\u7f6e\u538b\u7f29\u7ea7\u522b\uff0c\u8303\u56f41-9,9\u538b\u7f29\u7ea7\u522b\u6700\u9ad8\uff0c\u4e5f\u6700\u8017\u8d39CPU\u8d44\u6e90\ngzip_types text/plain application/x-javascript text/css application/xml image/jpeg image/gif image/png; #\u6307\u5b9a\u54ea\u4e9b\u7c7b\u578b\u7684\u6587\u4ef6\u9700\u8981\u538b\u7f29\ngzip_disable \"MSIE 6\\.\"; #IE6\u6d4f\u89c8\u5668\u4e0d\u542f\u7528\u538b\u7f29\n\n\u6d4b\u8bd5\uff1a\ndu -sb /usr/local/nginx/html/1.css #\u67e5\u770b\u5b57\u8282\u5927\u5c0f \u5fc5\u987b\u8d85\u8fc71024\u6839\u636e\u4e0a\u9762\u7684\u8bbe\u7f6e\ncat index.html &gt;&gt; 1.css\ncurl -I -H \"Accept-Encoding: gzip, deflate\" 192.168.107.254:8080/1.css\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_42","title":"\u65e5\u5fd7","text":"<ul> <li>\u9519\u8bef\u65e5\u5fd7\u7ea7\u522b\u8c03\u9ad8\uff0c\u6bd4\u5982crit\u7ea7\u522b\uff0c\u5c3d\u91cf\u5c11\u8bb0\u5f55\u65e0\u5173\u7d27\u8981\u7684\u65e5\u5fd7\u3002</li> <li>\u5bf9\u4e8e\u8bbf\u95ee\u65e5\u5fd7\uff0c\u5982\u679c\u4e0d\u8981\u6c42\u8bb0\u5f55\u65e5\u5fd7\uff0c\u53ef\u4ee5\u5173\u95ed\uff0c</li> <li>\u9759\u6001\u8d44\u6e90\u7684\u8bbf\u95ee\u65e5\u5fd7\u5173\u95ed</li> </ul>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_43","title":"\u9759\u6001\u6587\u4ef6\u8fc7\u671f","text":"<pre><code>#\u5bf9\u4e8e\u9759\u6001\u6587\u4ef6\uff0c\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u8fd9\u4e9b\u8d44\u6e90\u7f13\u5b58\u5230\u5ba2\u6237\u7aef\u6d4f\u89c8\u5668\uff0c\n#\u5728\u7f13\u5b58\u672a\u5931\u6548\u524d\uff0c\u5ba2\u6237\u7aef\u4e0d\u518d\u5411\u670d\u52a1\u671f\u8bf7\u6c42\u76f8\u540c\u7684\u8d44\u6e90\uff0c\u4ece\u800c\u8282\u7701\u5e26\u5bbd\u548c\u8d44\u6e90\u6d88\u8017\u3002\n\n#\u914d\u7f6e\u793a\u4f8b\u5982\u4e0b\uff1a\nlocation ~* ^.+\\.(gif|jpg|png|css|js)$                                      \n{\n    expires 1d; #1d\u8868\u793a1\u5929\uff0c\u4e5f\u53ef\u4ee5\u752824h\u8868\u793a\u4e00\u5929\u3002\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_44","title":"\u4f5c\u4e3a\u4ee3\u7406\u670d\u52a1\u5668","text":"<pre><code>Nginx\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u90fd\u662f\u4f5c\u4e3a\u4ee3\u7406\u6216\u8005\u8d1f\u8f7d\u5747\u8861\u7684\u89d2\u8272\u3002\n\u56e0\u4e3a\u524d\u9762\u7ae0\u8282\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u4ee5\u4e0b\u53c2\u6570\u7684\u542b\u4e49\uff0c\u5728\u8fd9\u91cc\u53ea\u63d0\u4f9b\u5bf9\u5e94\u7684\u914d\u7f6e\u53c2\u6570\uff1a\nhttp\n{\n    proxy_cache_path /data/nginx_cache/ levels=1:2 keys_zone=my_zone:10m inactive=300s max_size=5g;\n    ...;\n    server\n    {\n    proxy_buffering on;\n    proxy_buffer_size 4k;\n    proxy_buffers 2 4k;\n    proxy_busy_buffers_size 4k;\n    proxy_temp_path /tmp/nginx_proxy_tmp 1 2;\n    proxy_max_temp_file_size 20M;\n    proxy_temp_file_write_size 8k;\n\n    location /\n    {\n        proxy_cache my_zone;\n        ...;\n    }\n    }\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#ssl_2","title":"SSL\u4f18\u5316","text":"<ul> <li>\u9002\u5f53\u51cf\u5c11worker_processes\u6570\u91cf\uff0c\u56e0\u4e3assl\u529f\u80fd\u9700\u8981\u4f7f\u7528CPU\u7684\u8ba1\u7b97\u3002</li> <li>\u4f7f\u7528\u957f\u8fde\u63a5\uff0c\u56e0\u4e3a\u6bcf\u6b21\u5efa\u7acbssl\u4f1a\u8bdd\uff0c\u90fd\u4f1a\u8017\u8d39\u4e00\u5b9a\u7684\u8d44\u6e90\uff08\u52a0\u5bc6\u3001\u89e3\u5bc6\uff09</li> <li>\u5f00\u542fssl\u7f13\u5b58\uff0c\u7b80\u5316\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u7684\u201c\u63e1\u624b\u201d\u8fc7\u7a0b\u3002</li> </ul> <pre><code>ssl_session_cache   shared:SSL:10m; //\u7f13\u5b58\u4e3a10M\nssl_session_timeout 10m; //\u4f1a\u8bdd\u8d85\u65f6\u65f6\u95f4\u4e3a10\u5206\u949f\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#28linux","title":"28.\u8c03\u6574Linux\u5185\u6838\u53c2\u6570","text":"<pre><code>\u4f5c\u4e3a\u9ad8\u6027\u80fdWEB\u670d\u52a1\u5668\uff0c\u53ea\u8c03\u6574Nginx\u672c\u8eab\u7684\u53c2\u6570\u662f\u4e0d\u884c\u7684\uff0c\u56e0\u4e3aNginx\u670d\u52a1\u4f9d\u8d56\u4e8e\u9ad8\u6027\u80fd\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002\n\u4ee5\u4e0b\u4e3a\u5e38\u89c1\u7684\u51e0\u4e2aLinux\u5185\u6838\u53c2\u6570\u4f18\u5316\u65b9\u6cd5\u3002\n</code></pre> <ul> <li>1 net.ipv4.tcp_max_tw_buckets</li> </ul> <pre><code>\u5bf9\u4e8etcp\u8fde\u63a5\uff0c\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u901a\u4fe1\u5b8c\u540e\u72b6\u6001\u53d8\u4e3atimewait\uff0c\u5047\u5982\u67d0\u53f0\u670d\u52a1\u5668\u975e\u5e38\u5fd9\uff0c\u8fde\u63a5\u6570\u7279\u522b\u591a\u7684\u8bdd\uff0c\u90a3\u4e48\u8fd9\u4e2atimewait\u6570\u91cf\u5c31\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002\n\u6bd5\u7adf\u5b83\u4e5f\u662f\u4f1a\u5360\u7528\u4e00\u5b9a\u7684\u8d44\u6e90\uff0c\u6240\u4ee5\u5e94\u8be5\u6709\u4e00\u4e2a\u6700\u5927\u503c\uff0c\u5f53\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u7cfb\u7edf\u5c31\u4f1a\u5220\u9664\u6700\u65e9\u7684\u8fde\u63a5\uff0c\u8fd9\u6837\u59cb\u7ec8\u4fdd\u6301\u5728\u4e00\u4e2a\u6570\u91cf\u7ea7\u3002\n\u8fd9\u4e2a\u6570\u503c\u5c31\u662f\u7531net.ipv4.tcp_max_tw_buckets\u8fd9\u4e2a\u53c2\u6570\u6765\u51b3\u5b9a\u7684\u3002\nCentOS7\u7cfb\u7edf\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528sysctl -a |grep tw_buckets\u6765\u67e5\u770b\u5b83\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a32768\uff0c\n\u4f60\u53ef\u4ee5\u9002\u5f53\u628a\u5b83\u8c03\u4f4e\uff0c\u6bd4\u5982\u8c03\u6574\u52308000\uff0c\u6bd5\u7adf\u8fd9\u4e2a\u72b6\u6001\u7684\u8fde\u63a5\u592a\u591a\u4e5f\u662f\u4f1a\u6d88\u8017\u8d44\u6e90\u7684\u3002\n\u4f46\u4f60\u4e0d\u8981\u628a\u5b83\u8c03\u5230\u51e0\u5341\u3001\u51e0\u767e\u8fd9\u6837\uff0c\u56e0\u4e3a\u8fd9\u79cd\u72b6\u6001\u7684tcp\u8fde\u63a5\u4e5f\u662f\u6709\u7528\u7684\uff0c\n\u5982\u679c\u540c\u6837\u7684\u5ba2\u6237\u7aef\u518d\u6b21\u548c\u670d\u52a1\u7aef\u901a\u4fe1\uff0c\u5c31\u4e0d\u7528\u518d\u6b21\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u4e86\uff0c\u7528\u8fd9\u4e2a\u65e7\u7684\u901a\u9053\uff0c\u7701\u65f6\u7701\u529b\u3002\n</code></pre> <ul> <li>2 net.ipv4.tcp_tw_recycle = 1</li> </ul> <pre><code>\u8be5\u53c2\u6570\u7684\u4f5c\u7528\u662f\u5feb\u901f\u56de\u6536timewait\u72b6\u6001\u7684\u8fde\u63a5\u3002\u4e0a\u9762\u867d\u7136\u63d0\u5230\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5220\u9664\u6389timewait\u72b6\u6001\u7684\u8fde\u63a5\uff0c\u4f46\u5982\u679c\u628a\u8fd9\u6837\u7684\u8fde\u63a5\u91cd\u65b0\u5229\u7528\u8d77\u6765\u5c82\u4e0d\u662f\u66f4\u597d\u3002\n\u6240\u4ee5\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a1\u5c31\u53ef\u4ee5\u8ba9timewait\u72b6\u6001\u7684\u8fde\u63a5\u5feb\u901f\u56de\u6536\uff0c\u5b83\u9700\u8981\u548c\u4e0b\u9762\u7684\u53c2\u6570\u914d\u5408\u4e00\u8d77\u4f7f\u7528\u3002\n</code></pre> <ul> <li>3 net.ipv4.tcp_tw_reuse = 1</li> </ul> <pre><code>\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a1\uff0c\u5c06timewait\u72b6\u6001\u7684\u8fde\u63a5\u91cd\u65b0\u7528\u4e8e\u65b0\u7684TCP\u8fde\u63a5\uff0c\u8981\u7ed3\u5408\u4e0a\u9762\u7684\u53c2\u6570\u4e00\u8d77\u4f7f\u7528\u3002\n</code></pre> <ul> <li>4 net.ipv4.tcp_syncookies = 1</li> </ul> <pre><code>tcp\u4e09\u6b21\u63e1\u624b\u4e2d\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u8d77syn\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u4e5f\u4f1a\u5411\u5ba2\u6237\u7aef\u53d1\u8d77syn\u8bf7\u6c42\u540c\u65f6\u8fde\u5e26ack\u786e\u8ba4\uff0c\n\u5047\u5982\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u540e\u76f4\u63a5\u65ad\u5f00\u548c\u670d\u52a1\u7aef\u7684\u8fde\u63a5\uff0c\u4e0d\u63a5\u6536\u670d\u52a1\u7aef\u53d1\u8d77\u7684\u8fd9\u4e2a\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u4f1a\u91cd\u8bd5\u591a\u6b21\uff0c\n\u8fd9\u4e2a\u91cd\u8bd5\u7684\u8fc7\u7a0b\u4f1a\u6301\u7eed\u4e00\u6bb5\u65f6\u95f4\uff08\u901a\u5e38\u9ad8\u4e8e30s\uff09\uff0c\u5f53\u8fd9\u79cd\u72b6\u6001\u7684\u8fde\u63a5\u6570\u91cf\u975e\u5e38\u5927\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u6d88\u8017\u5f88\u5927\u7684\u8d44\u6e90\uff0c\u4ece\u800c\u9020\u6210\u762b\u75ea\uff0c\n\u6b63\u5e38\u7684\u8fde\u63a5\u8fdb\u4e0d\u6765\uff0c\u8fd9\u79cd\u6076\u610f\u7684\u534a\u8fde\u63a5\u884c\u4e3a\u5176\u5b9e\u53eb\u505asyn flood\u653b\u51fb\u3002\n\u8bbe\u7f6e\u4e3a1\uff0c\u662f\u5f00\u542fSYN Cookies\uff0c\u5f00\u542f\u540e\u53ef\u4ee5\u907f\u514d\u53d1\u751f\u4e0a\u8ff0\u7684syn flood\u653b\u51fb\u3002\n\u5f00\u542f\u8be5\u53c2\u6570\u540e\uff0c\u670d\u52a1\u7aef\u63a5\u6536\u5ba2\u6237\u7aef\u7684ack\u540e\uff0c\u518d\u5411\u5ba2\u6237\u7aef\u53d1\u9001ack+syn\u4e4b\u524d\u4f1a\u8981\u6c42client\u5728\u77ed\u65f6\u95f4\u5185\u56de\u5e94\u4e00\u4e2a\u5e8f\u53f7\uff0c\n\u5982\u679c\u5ba2\u6237\u7aef\u4e0d\u80fd\u63d0\u4f9b\u5e8f\u53f7\u6216\u8005\u63d0\u4f9b\u7684\u5e8f\u53f7\u4e0d\u5bf9\u5219\u8ba4\u4e3a\u8be5\u5ba2\u6237\u7aef\u4e0d\u5408\u6cd5\uff0c\u4e8e\u662f\u4e0d\u4f1a\u53d1ack+syn\u7ed9\u5ba2\u6237\u7aef\uff0c\u66f4\u6d89\u53ca\u4e0d\u5230\u91cd\u8bd5\u3002\n</code></pre> <ul> <li>5 net.ipv4.tcp_max_syn_backlog</li> </ul> <pre><code>\u8be5\u53c2\u6570\u5b9a\u4e49\u7cfb\u7edf\u80fd\u63a5\u53d7\u7684\u6700\u5927\u534a\u8fde\u63a5\u72b6\u6001\u7684tcp\u8fde\u63a5\u6570\u3002\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e86syn\u5305\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u4f1a\u8bb0\u5f55\u4e00\u4e0b\uff0c\n\u8be5\u53c2\u6570\u51b3\u5b9a\u6700\u591a\u80fd\u8bb0\u5f55\u51e0\u4e2a\u8fd9\u6837\u7684\u8fde\u63a5\u3002\u5728CentOS7\uff0c\u9ed8\u8ba4\u662f256\uff0c\u5f53\u6709syn flood\u653b\u51fb\u65f6\uff0c\u8fd9\u4e2a\u6570\u503c\u592a\u5c0f\u5219\u5f88\u5bb9\u6613\u5bfc\u81f4\u670d\u52a1\u5668\u762b\u75ea\uff0c\n\u5b9e\u9645\u4e0a\u6b64\u65f6\u670d\u52a1\u5668\u5e76\u6ca1\u6709\u6d88\u8017\u592a\u591a\u8d44\u6e90\uff08cpu\u3001\u5185\u5b58\u7b49\uff09\uff0c\u6240\u4ee5\u53ef\u4ee5\u9002\u5f53\u8c03\u5927\u5b83\uff0c\u6bd4\u5982\u8c03\u6574\u523030000\u3002\n</code></pre> <ul> <li>6 net.ipv4.tcp_syn_retries</li> </ul> <pre><code>\u8be5\u53c2\u6570\u9002\u7528\u4e8e\u5ba2\u6237\u7aef\uff0c\u5b83\u5b9a\u4e49\u53d1\u8d77syn\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba4\u4e3a6\uff0c\u5efa\u8bae\u6539\u4e3a2\u3002\n</code></pre> <ul> <li>7 net.ipv4.tcp_synack_retries</li> </ul> <pre><code>\u8be5\u53c2\u6570\u9002\u7528\u4e8e\u670d\u52a1\u7aef\uff0c\u5b83\u5b9a\u4e49\u53d1\u8d77syn+ack\u7684\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba4\u4e3a5\uff0c\u5efa\u8bae\u6539\u4e3a2\uff0c\u53ef\u4ee5\u9002\u5f53\u9884\u9632syn flood\u653b\u51fb\u3002\n</code></pre> <ul> <li>8 net.ipv4.ip_local_port_range</li> </ul> <pre><code>\u8be5\u53c2\u6570\u5b9a\u4e49\u7aef\u53e3\u8303\u56f4\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u4fdd\u7559\u7aef\u53e3\u4e3a1024\u53ca\u4ee5\u4e0b\uff0c\u4ee5\u4e0a\u90e8\u5206\u4e3a\u81ea\u5b9a\u4e49\u7aef\u53e3\u3002\u8fd9\u4e2a\u53c2\u6570\u9002\u7528\u4e8e\u5ba2\u6237\u7aef\uff0c\n\u5f53\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u6bd4\u5982\u8bf4\u8bbf\u95ee\u670d\u52a1\u7aef\u768480\u7aef\u53e3\uff0c\u5ba2\u6237\u7aef\u968f\u673a\u5f00\u542f\u4e86\u4e00\u4e2a\u7aef\u53e3\u548c\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\uff0c\n\u8fd9\u4e2a\u53c2\u6570\u5b9a\u4e49\u968f\u673a\u7aef\u53e3\u7684\u8303\u56f4\u3002\u9ed8\u8ba4\u4e3a32768    61000\uff0c\u5efa\u8bae\u8c03\u6574\u4e3a1025 61000\u3002\n</code></pre> <ul> <li>9 net.ipv4.tcp_fin_timeout</li> </ul> <pre><code>tcp\u8fde\u63a5\u7684\u72b6\u6001\u4e2d\uff0c\u5ba2\u6237\u7aef\u4e0a\u6709\u4e00\u4e2a\u662fFIN-WAIT-2\u72b6\u6001\uff0c\u5b83\u662f\u72b6\u6001\u53d8\u8fc1\u4e3atimewait\u524d\u4e00\u4e2a\u72b6\u6001\u3002\n\u8be5\u53c2\u6570\u5b9a\u4e49\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u8fdb\u7a0b\u7684\u8be5\u8fde\u63a5\u72b6\u6001\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u503c\u4e3a60\uff0c\u5efa\u8bae\u8c03\u6574\u4e3a6\u3002\n</code></pre> <ul> <li>10 net.ipv4.tcp_keepalive_time</li> </ul> <pre><code>tcp\u8fde\u63a5\u72b6\u6001\u91cc\uff0c\u6709\u4e00\u4e2a\u662festablished\u72b6\u6001\uff0c\u53ea\u6709\u5728\u8fd9\u4e2a\u72b6\u6001\u4e0b\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u624d\u80fd\u901a\u4fe1\u3002\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u5f53\u901a\u4fe1\u5b8c\u6bd5\uff0c\n\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u7aef\u4f1a\u544a\u8bc9\u5bf9\u65b9\u8981\u5173\u95ed\u8fde\u63a5\uff0c\u6b64\u65f6\u72b6\u6001\u5c31\u4f1a\u53d8\u4e3atimewait\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709\u544a\u8bc9\u670d\u52a1\u7aef\uff0c\n\u5e76\u4e14\u670d\u52a1\u7aef\u4e5f\u6ca1\u6709\u544a\u8bc9\u5ba2\u6237\u7aef\u5173\u95ed\u7684\u8bdd\uff08\u4f8b\u5982\uff0c\u5ba2\u6237\u7aef\u90a3\u8fb9\u65ad\u7f51\u4e86\uff09\uff0c\u6b64\u65f6\u9700\u8981\u8be5\u53c2\u6570\u6765\u5224\u5b9a\u3002\n\u6bd4\u5982\u5ba2\u6237\u7aef\u5df2\u7ecf\u65ad\u7f51\u4e86\uff0c\u4f46\u670d\u52a1\u7aef\u4e0a\u672c\u6b21\u8fde\u63a5\u7684\u72b6\u6001\u4f9d\u7136\u662festablished\uff0c\u670d\u52a1\u7aef\u4e3a\u4e86\u786e\u8ba4\u5ba2\u6237\u7aef\u662f\u5426\u65ad\u7f51\uff0c\n\u5c31\u9700\u8981\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u53bb\u53d1\u4e00\u4e2a\u63a2\u6d4b\u5305\u53bb\u786e\u8ba4\u4e00\u4e0b\u770b\u770b\u5bf9\u65b9\u662f\u5426\u5728\u7ebf\u3002\u8fd9\u4e2a\u65f6\u95f4\u5c31\u7531\u8be5\u53c2\u6570\u51b3\u5b9a\u3002\u5b83\u7684\u9ed8\u8ba4\u503c\u4e3a7200\u79d2\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a30\u79d2\u3002\n</code></pre> <ul> <li>11 net.ipv4.tcp_keepalive_intvl</li> </ul> <pre><code>\u8be5\u53c2\u6570\u548c\u4e0a\u9762\u7684\u53c2\u6570\u662f\u4e00\u8d77\u7684\uff0c\u670d\u52a1\u7aef\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u53d1\u8d77\u4e86\u63a2\u6d4b\uff0c\u67e5\u770b\u5ba2\u6237\u7aef\u662f\u5426\u5728\u7ebf\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5e76\u6ca1\u6709\u786e\u8ba4\uff0c\n\u6b64\u65f6\u670d\u52a1\u7aef\u8fd8\u4e0d\u80fd\u8ba4\u5b9a\u4e3a\u5bf9\u65b9\u4e0d\u5728\u7ebf\uff0c\u800c\u662f\u8981\u5c1d\u8bd5\u591a\u6b21\u3002\u8be5\u53c2\u6570\u5b9a\u4e49\u91cd\u65b0\u53d1\u9001\u63a2\u6d4b\u7684\u65f6\u95f4\uff0c\u5373\u7b2c\u4e00\u6b21\u53d1\u73b0\u5bf9\u65b9\u6709\u95ee\u9898\u540e\uff0c\u8fc7\u591a\u4e45\u518d\u6b21\u53d1\u8d77\u63a2\u6d4b\u3002\n\u9ed8\u8ba4\u503c\u4e3a75\u79d2\uff0c\u53ef\u4ee5\u6539\u4e3a3\u79d2\u3002\n</code></pre> <ul> <li>12 net.ipv4.tcp_keepalive_probes</li> </ul> <pre><code>\u7b2c10\u548c\u7b2c11\u4e2a\u53c2\u6570\u89c4\u5b9a\u4e86\u4f55\u65f6\u53d1\u8d77\u63a2\u6d4b\u548c\u63a2\u6d4b\u5931\u8d25\u540e\u518d\u8fc7\u591a\u4e45\u518d\u53d1\u8d77\u63a2\u6d4b\uff0c\u4f46\u5e76\u6ca1\u6709\u5b9a\u4e49\u4e00\u5171\u63a2\u6d4b\u51e0\u6b21\u624d\u7b97\u7ed3\u675f\u3002\n\u8be5\u53c2\u6570\u5b9a\u4e49\u53d1\u8d77\u63a2\u6d4b\u7684\u5305\u7684\u6570\u91cf\u3002\u9ed8\u8ba4\u4e3a9\uff0c\u5efa\u8bae\u8bbe\u7f6e2\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_45","title":"\u8bbe\u7f6e\u548c\u8303\u4f8b","text":"<pre><code>\u5728Linux\u4e0b\u8c03\u6574\u5185\u6838\u53c2\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6/etc/sysctl.conf\uff0c\u7136\u540e\u6267\u884csysctl -p\u547d\u4ee4\u751f\u6548\nvi /etc/sysctl.conf\n\u7ed3\u5408\u4ee5\u4e0a\u5206\u6790\u7684\u5404\u5185\u6838\u53c2\u6570\uff0c\u8303\u4f8b\u5982\u4e0b\nnet.ipv4.tcp_fin_timeout = 6\nnet.ipv4.tcp_keepalive_time = 30\nnet.ipv4.tcp_max_tw_buckets = 8000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 30000\nnet.ipv4.tcp_syn_retries = 2\nnet.ipv4.tcp_synack_retries = 2\nnet.ipv4.ip_local_port_range = 1025 61000\nnet.ipv4.tcp_keepalive_intvl = 3\nnet.ipv4.tcp_keepalive_probes = 2\n\n\nsysctl -p\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#29nginx","title":"29.\u76d1\u63a7nginx","text":"<pre><code>top\nps\nnetstat\nss\nlsof\ntcpdump -nn\ntcpdump -i eth0\n\u65e5\u5fd7\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#30nginx","title":"30.\u914d\u7f6eNginx\u72b6\u6001","text":"<pre><code>#Nginx\u6709\u5185\u7f6e\u4e00\u4e2a\u72b6\u6001\u9875\uff0c\u9700\u8981\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u6307\u5b9a\u53c2\u6570--with-http_stub_status_module\u53c2\u6570\u65b9\u53ef\u6253\u5f00\u3002\n#\u4e5f\u5c31\u662f\u8bf4\uff0c\u8be5\u529f\u80fd\u662f\u7531http_stub_status_module\u6a21\u5757\u63d0\u4f9b\uff0c\u9ed8\u8ba4\u6ca1\u6709\u52a0\u8f7d\u3002\n ./configure --with-http_stub_status_module --with-http_ssl_module --prefix=/usr/local/nginx\n make install \n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_11","title":"Nginx\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b","text":"<pre><code>log_format combined_realip '$remote_addr $http_x_forwarded_for [$time_local]'\n    '$host \"$request_uri\" $status'\n    '\"$http_referer\" \"$http_user_agent\"';#\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3acombined_realip\u7684\u65e5\u5fd7\u683c\u5f0f\nserver{\n    listen 99;\n    server_name localhost;\n    root /usr/local/nginx/html;\n    index index.html index.php;\n    error_log /data/logs/localhost.err.log debug;\n    location ~* ^.+\\.(gif|jpg|png|css|js)$\n    {\n        expires 1d; #1d\u8868\u793a1\u5929\uff0c\u4e5f\u53ef\u4ee5\u752824h\u8868\u793a\u4e00\u5929\u3002\n        access_log off;\n    }\n    location /status/#\u52a0\u4e0a\u8fd9\u4e2alocation\u6a21\u5757\n    {\n        stub_status on;\n        access_log off;\n        allow 127.0.0.1;\n        allow 192.168.107.0/24;\n        deny all;\n    }\n\n    access_log /data/logs/localhost.acc.log combined_realip;\n}\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_46","title":"\u914d\u7f6e\u8bf4\u660e","text":"<ul> <li>location /status/\u8fd9\u6837\u5f53\u8bbf\u95ee/status/\u65f6\u5373\u53ef\u8bbf\u95ee\u5230\u72b6\u6001\u9875\u5185\u5bb9\u3002</li> <li>stub_status on\u5373\u6253\u5f00\u4e86\u72b6\u6001\u9875\u3002</li> <li>access_log off\u4e0d\u8bb0\u5f55\u65e5\u5fd7</li> <li>allow\u548cdeny\u53ea\u5141\u8bb8\u6307\u5b9aIP\u548cIP\u6bb5\u8bbf\u95ee\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u9875\u9762\u9700\u8981\u4fdd\u62a4\u8d77\u6765\uff0c\u5e76\u4e0d\u516c\u5f00\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u505a\u7528\u6237\u8ba4\u8bc1\u3002</li> </ul>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#_47","title":"\u6d4b\u8bd5\u548c\u7ed3\u679c\u8bf4\u660e","text":"<pre><code>\u6d4b\u8bd5\u547d\u4ee4\uff1acurl -x127.0.0.1:80 192.168.107.254\uff1a8080/status/\n\n\u7ed3\u679c\u5982\u4e0b\uff1a\nActive connections: 1 \nserver accepts handled requests\n 11 11 11 \nReading: 0 Writing: 1 Waiting: 0 \n\n\u8bf4\u660e\uff1a\nactive connections \u2013 \u6d3b\u8dc3\u7684\u8fde\u63a5\u6570\u91cf\nserver accepts handled requests \u2014 \u603b\u5171\u5904\u7406\u7684\u8fde\u63a5\u6570\u3001\u6210\u529f\u521b\u5efa\u7684\u63e1\u624b\u6b21\u6570\u3001\u603b\u5171\u5904\u7406\u7684\u8bf7\u6c42\u6b21\u6570\n\u9700\u8981\u6ce8\u610f\uff0c\u4e00\u4e2a\u8fde\u63a5\u53ef\u4ee5\u6709\u591a\u6b21\u8bf7\u6c42\u3002\nreading \u2014 \u8bfb\u53d6\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u6570.\nwriting \u2014 \u54cd\u5e94\u6570\u636e\u5230\u5ba2\u6237\u7aef\u7684\u6570\u91cf\nwaiting \u2014 \u5f00\u542f keep-alive \u7684\u60c5\u51b5\u4e0b,\u8fd9\u4e2a\u503c\u7b49\u4e8e active \u2013 (reading+writing), \u610f\u601d\u5c31\u662f Nginx \u5df2\u7ecf\u5904\u7406\u5b8c\u6b63\u5728\u7b49\u5019\u4e0b\u4e00\u6b21\u8bf7\u6c42\u6307\u4ee4\u7684\u9a7b\u7559\u8fde\u63a5.\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#31nginx-lnmp","title":"31.Nginx\u67b6\u6784-LNMP","text":"<p>Linux\uff1aLinux \u64cd\u4f5c\u7cfb\u7edf</p> <p>Nginx\uff1aWeb \u670d\u52a1\u5668</p> <p>MariaDB\uff1a\u6570\u636e\u5e93</p> <p>PHP\uff1a\u811a\u672c\u8bed\u8a00</p> <pre><code>\u914d\u7f6e\u5982\u4e0b\uff08\u5728server\u90e8\u5206\u6dfb\u52a0\uff09\uff1a\n    location ~ \\.php$ {\n        include fastcgi_params;\n        fastcgi_pass unix:/tmp/php-fcgi.sock;\n        fastcgi_index index.php;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    }\n\n\u914d\u7f6e\u8bf4\u660e\uff1a\n1 fastcgi_params\u6587\u4ef6\u5728/usr/local/nginx/conf/\u4e0b\u9762\uff0c\u5176\u5185\u5bb9\u4e3afastcgi\u76f8\u5173\u7684\u53d8\u91cf\n2 fastcgi_pass\u540e\u9762\u8ddf\u7684\u662fphp-fpm\u670d\u52a1\u76d1\u542c\u5730\u5740\uff0c\u53ef\u4ee5\u662fIP:PORT\uff0c\u4e5f\u53ef\u4ee5\u662funix socket\u5730\u5740\uff0c\u4e5f\u652f\u6301upstream\u7684\u5730\u5740\n3 fastcgi_index\u5b9a\u4e49\u7d22\u5f15\u9875\uff0c\u5982\u679c\u5728server\u5185\u5176\u4ed6\u90e8\u5206\u6709\u5b9a\u4e49index\u53c2\u6570\uff0c\u8be5\u914d\u7f6e\u53ef\u4ee5\u5ffd\u7565\n4 fastcgi_param\u8fd9\u884c\u5176\u5b9e\u53ef\u4ee5\u5728fastcgi_params\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49SCRIPT_FILENAME\u53d8\u91cf\uff0c\u8fd9\u4e2a\u53d8\u91cf\u5982\u679c\u4e0d\u5b9a\u4e49\uff0cphp\u7684\u8bf7\u6c42\u662f\u6ca1\u529e\u6cd5\u8bbf\u95ee\u7684\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#mysql","title":"\u5b89\u88c5MySQL","text":"<p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u67e5\u770b\u7cfb\u7edf\u4e2d\u662f\u5426\u5df2\u5b89\u88c5 MariaDB\u3002 </p> <pre><code>rpm -qa | grep -i mariadb\n</code></pre> <p>\u8fd4\u56de\u7ed3\u679c\u7c7b\u4f3c\u5982\u4e0b\u5185\u5bb9\uff0c\u5219\u8868\u793a\u5df2\u5b58\u5728 MariaDB\u3002</p> <p> </p> <p>\u4e3a\u907f\u514d\u5b89\u88c5\u7248\u672c\u4e0d\u540c\u9020\u6210\u51b2\u7a81\uff0c\u8bf7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u79fb\u9664\u5df2\u5b89\u88c5\u7684 MariaDB\u3002</p> <pre><code> yum -y remove mariadb-5.5.68-1.el7.x86_64 mariadb-server-5.5.68-1.el7.x86_64 mariadb-libs-5.5.68-1.el7.x86_64\n</code></pre> <p>\u82e5\u8fd4\u56de\u7ed3\u679c\u4e3a\u7a7a\uff0c\u5219\u8bf4\u660e\u672a\u9884\u5148\u5b89\u88c5\uff0c\u5219\u6267\u884c\u4e0b\u4e00\u6b65\u3002</p> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5728 <code>/etc/yum.repos.d/</code> \u4e0b\u521b\u5efa <code>MariaDB.repo</code> \u6587\u4ef6\u3002</li> </ol> <pre><code>vi /etc/yum.repos.d/MariaDB.repo\n</code></pre> <ol> <li>\u6309 i \u5207\u6362\u81f3\u7f16\u8f91\u6a21\u5f0f\uff0c\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\uff0c\u6dfb\u52a0 MariaDB \u8f6f\u4ef6\u5e93\u3002</li> </ol> <p>\u8bf4\u660e</p> <p>\u4ee5\u4e0b\u914d\u7f6e\u4f7f\u7528\u4e86\u817e\u8baf\u4e91\u955c\u50cf\u6e90\uff0c\u817e\u8baf\u4e91\u955c\u50cf\u6e90\u540c\u6b65 MariaDB \u5b98\u7f51\u6e90\u8fdb\u884c\u66f4\u65b0\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0 MariaDB 10.4 \u7248\u672c\u6e90\u5931\u6548\u95ee\u9898\uff08\u672c\u6587\u4ee5\u5728 CentOS 7.6 \u4e0a\u5b89\u88c5 MariaDB 10.4.22 \u7248\u672c\u4e3a\u4f8b\uff09\uff0c\u60a8\u53ef\u524d\u5f80 MariaDB \u5b98\u7f51 \u83b7\u53d6\u5176\u4ed6\u7248\u672c\u53ca\u64cd\u4f5c\u7cfb\u7edf\u7684 MariaDB \u8f6f\u4ef6\u5e93\u5b89\u88c5\u4fe1\u606f\u3002</p> <p>\u82e5\u60a8\u7684\u4e91\u670d\u52a1\u5668\u4f7f\u7528\u4e86 \u5185\u7f51\u670d\u52a1\uff0c\u5219\u53ef\u4ee5\u5c06 <code>mirrors.cloud.tencent.com</code> \u66ff\u6362\u4e3a <code>mirrors.tencentyun.com</code> \u5185\u7f51\u5730\u5740\uff0c\u5185\u7f51\u6d41\u91cf\u4e0d\u5360\u7528\u516c\u7f51\u6d41\u91cf\u4e14\u901f\u5ea6\u66f4\u5feb\u3002</p> <pre><code># MariaDB 10.4 CentOS repository list - created 2019-11-05 11:56 UTC\n# http://downloads.mariadb.org/mariadb/repositories/\n[mariadb]\nname = MariaDB\nbaseurl = https://mirrors.cloud.tencent.com/mariadb/yum/10.4/centos7-amd64\ngpgkey=https://mirrors.cloud.tencent.com/mariadb/yum/RPM-GPG-KEY-MariaDB\ngpgcheck=1\n</code></pre> <ol> <li> <p>\u6309 Esc\uff0c\u8f93\u5165 :wq\uff0c\u4fdd\u5b58\u6587\u4ef6\u5e76\u8fd4\u56de\u3002</p> </li> <li> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5b89\u88c5 MariaDB\u3002\u6b64\u6b65\u9aa4\u8017\u65f6\u8f83\u957f\uff0c\u8bf7\u5173\u6ce8\u5b89\u88c5\u8fdb\u5ea6\uff0c\u7b49\u5f85\u5b89\u88c5\u5b8c\u6bd5\u3002</p> </li> </ol> <pre><code>yum -y install MariaDB-client MariaDB-server\n</code></pre> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u542f\u52a8 MariaDB \u670d\u52a1\u3002</li> </ol> <pre><code>systemctl start mariadb\n</code></pre> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u8bbe\u7f6e MariaDB \u4e3a\u5f00\u673a\u81ea\u542f\u52a8\u3002</li> </ol> <pre><code>systemctl enable mariadb\n</code></pre> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u9a8c\u8bc1 MariaDB \u662f\u5426\u5b89\u88c5\u6210\u529f\u3002</li> </ol> <pre><code>mysql\n</code></pre> <p>\u663e\u793a\u7ed3\u679c\u5982\u4e0b\uff0c\u5219\u6210\u529f\u5b89\u88c5</p> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u9000\u51fa MariaDB\u3002</li> </ol> <pre><code>q\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#php","title":"\u5b89\u88c5php","text":"<ol> <li>\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u66f4\u65b0 yum \u4e2d PHP \u7684\u8f6f\u4ef6\u6e90\u3002</li> </ol> <pre><code>rpm -Uvh https://mirrors.cloud.tencent.com/epel/epel-release-latest-7.noarch.rpm\n</code></pre> <pre><code>rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\n</code></pre> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5b89\u88c5 PHP 7.2 \u6240\u9700\u8981\u7684\u5305\u3002</li> </ol> <pre><code>yum -y install mod_php72w.x86_64 php72w-cli.x86_64 php72w-common.x86_64 php72w-mysqlnd php72w-fpm.x86_64\n</code></pre> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u542f\u52a8 PHP-FPM \u670d\u52a1\u3002</li> </ol> <pre><code>systemctl start php-fpm\n</code></pre> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u8bbe\u7f6e PHP-FPM \u670d\u52a1\u4e3a\u5f00\u673a\u81ea\u542f\u52a8\u3002</li> </ol> <pre><code>systemctl enable php-fpm\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#nginx_12","title":"\u5b89\u88c5 Nginx","text":"<ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5728 <code>/etc/yum.repos.d/</code> \u4e0b\u521b\u5efa <code>nginx.repo</code> \u6587\u4ef6\u3002</li> </ol> <pre><code>vi /etc/yum.repos.d/nginx.repo\n</code></pre> <ol> <li>\u6309 i \u5207\u6362\u81f3\u7f16\u8f91\u6a21\u5f0f\uff0c\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\u3002</li> </ol> <pre><code>[nginx] \nname = nginx repo \nbaseurl = https://nginx.org/packages/mainline/centos/7/$basearch/ \ngpgcheck = 0 \nenabled = 1\n</code></pre> <ol> <li> <p>\u6309 Esc\uff0c\u8f93\u5165 :wq\uff0c\u4fdd\u5b58\u6587\u4ef6\u5e76\u8fd4\u56de\u3002</p> </li> <li> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5b89\u88c5 nginx\u3002</p> </li> </ol> <pre><code>yum install -y nginx\n</code></pre> <ol> <li>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6253\u5f00 <code>default.conf</code> \u6587\u4ef6\u3002</li> </ol> <pre><code>vim /usr/local/nginx/conf/vhost/A.conf\n</code></pre> <ol> <li> <p>\u6309 i \u5207\u6362\u81f3\u7f16\u8f91\u6a21\u5f0f\uff0c\u7f16\u8f91 <code>default.conf</code> \u6587\u4ef6\u3002</p> </li> <li> <p>\u627e\u5230 <code>server{...}</code>\uff0c\u5e76\u5c06 <code>server</code> \u5927\u62ec\u53f7\u4e2d\u76f8\u5e94\u7684\u914d\u7f6e\u4fe1\u606f\u66ff\u6362\u4e3a\u5982\u4e0b\u5185\u5bb9\u3002\u7528\u4e8e\u53d6\u6d88\u5bf9 IPv6 \u5730\u5740\u7684\u76d1\u542c\uff0c\u540c\u65f6\u914d\u7f6e Nginx\uff0c\u5b9e\u73b0\u4e0e PHP \u7684\u8054\u52a8\u3002</p> </li> </ol> <pre><code>log_format combined_realip '$remote_addr $http_x_forwarded_for [$time_local]'\n    '$host \"$request_uri\" $status'\n    '\"$http_referer\" \"$http_user_agent\"';#\u5b9a\u4e49\u4e86\u4e00\u4e2a\u540d\u4e3acombined_realip\u7684\u65e5\u5fd7\u683c\u5f0f\nserver{\n    listen 99;\n    server_name localhost;\n    root /usr/local/nginx/html;\n    index index.html index.php;\n    error_log /data/logs/localhost.err.log debug;\n    location ~* ^.+\\.(gif|jpg|png|css|js)$\n    {\n        expires 1d; #1d\u8868\u793a1\u5929\uff0c\u4e5f\u53ef\u4ee5\u752824h\u8868\u793a\u4e00\u5929\u3002\n        access_log off;\n    }\n    location /status/\n    {\n        stub_status on;\n        access_log off;\n        allow 127.0.0.1;\n        allow 192.168.107.0/24;\n        deny all;\n    }\n    location ~ .php$ {\n        fastcgi_pass   127.0.0.1:9000;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n    access_log /data/logs/localhost.acc.log combined_realip;\n}\n</code></pre> <ol> <li> <p>\u6309 Esc\uff0c\u8f93\u5165 :wq\uff0c\u4fdd\u5b58\u6587\u4ef6\u5e76\u8fd4\u56de\u3002</p> </li> <li> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 Nginx\u3002</p> </li> </ol> <pre><code>/usr/local/nginx/sbin/nginx -s reload\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#php_1","title":"\u6d4b\u8bd5\u662f\u5426\u89e3\u6790php\u6587\u4ef6","text":"<p>\u521b\u5efa\u6d4b\u8bd5\u6587\u4ef6:</p> <pre><code>echo '&lt;?php echo \"hello world php\u4e16\u754c\u4e0a\u6700\u597d\u7684\u8bed\u8a00\"; ?&gt;' &gt; /usr/local/nginx/html/2.php\nvi /usr/local/nginx/conf/vhost/A.conf\n</code></pre> <pre><code>server{\n    ...\n    location ~ .php$ {\n        fastcgi_pass   127.0.0.1:9000;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n    ...\n}\n</code></pre> <p>\u6d4b\u8bd5:</p> <pre><code>[root@localhost nginx]# curl localhost/2.php\n\u6d4b\u8bd5php\u662f\u5426\u89e3\u6790[root@localhost nginx]#\n</code></pre> <p></p>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#32nginxtomcat","title":"32.Nginx+Tomcat\u67b6\u6784","text":"<pre><code>\u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\nserver\n{\n    listen 80;\n    server_name www.liyedong.com;\n\n    location ~* \"\\.(jpg|png|jepg|js|css|xml|bmp|swf|gif|html)$\"\n    {\n        root /data/wwwroot/www.liyedong.com/;\n        access_log off;\n        expire 7d;\n    }\n\n    location /\n    {\n        proxy_pass http://127.0.0.1:8080/;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP      $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n\u8bf4\u660e\uff1a\n1 \u9996\u5148\uff0c\u628a\u5404\u79cd\u9759\u6001\u6587\u4ef6\u7684\u8bf7\u6c42\u5206\u79bb\u51fa\u6765\uff0c\u5355\u72ec\u7531nginx\u5904\u7406\u3002\n2 \u5176\u4ed6\u8bf7\u6c42\u76f4\u63a5\u4ee3\u74068080\u7aef\u53e3\uff0c\u5373tomcat\u670d\u52a1,\u4e5f\u53ef\u4f7f\u7528\u8d1f\u8f7d\u5747\u8861\u3002\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#33nginxkeepalived","title":"33.nginx+keepalived\u9ad8\u53ef\u7528\u67b6\u6784","text":"ip 192.168.107.254\uff08eth0\uff09 192.168.107.253(eth0) 192.168.107.188\uff08\u865a\u62dfip\uff09 \u73af\u5883 centos7+nginx+keepalived centos7+nginx+keepalived"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#1keepalived","title":"1\u3001keepalived","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 keepalived \u6765\u5b9e\u73b0 Nginx \u7684\u9ad8\u53ef\u7528\uff0ckeepalived \u662f\u96c6\u7fa4\u7ba1\u7406\u4e2d\u4fdd\u8bc1\u96c6\u7fa4\u9ad8\u53ef\u7528\u7684\u4e00\u4e2a\u670d\u52a1\u8f6f\u4ef6\uff0c\u7528\u6765\u9632\u6b62\u5355\u70b9\u6545\u969c\u3002Keepalived\u7684\u4f5c\u7528\u662f\u68c0\u6d4b web \u670d\u52a1\u5668\u7684\u72b6\u6001\uff0c\u5982\u679c\u6709\u4e00\u53f0 web \u670d\u52a1\u5668\u6b7b\u673a\u6216\u5de5\u4f5c\u51fa\u73b0\u6545\u969c\uff0cKeepalived \u5c06\u80fd\u68c0\u6d4b\u5230\uff0c\u5e76\u5c06\u6709\u6545\u969c\u7684 web \u670d\u52a1\u5668\u4ece\u7cfb\u7edf\u4e2d\u5254\u9664\uff0c\u5f53web\u670d\u52a1\u5668\u5de5\u4f5c\u6b63\u5e38\u540e Keepalived \u4f1a\u81ea\u52a8\u5c06\u8be5 web \u670d\u52a1\u5668\u52a0\u5165\u5230\u670d\u52a1\u5668\u7fa4\u4e2d\u3002\u8fd9\u4e9b\u5de5\u4f5c\u5168\u90e8\u90fd\u4f1a\u81ea\u52a8\u5b8c\u6210\uff0c\u4e0d\u9700\u8981\u4eba\u5de5\u5e72\u6d89\uff0c\u9700\u8981\u4eba\u5de5\u505a\u7684\u53ea\u662f\u4fee\u590d\u6545\u969c\u7684web\u670d\u52a1\u5668\u3002keepalived \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u5065\u5eb7\u68c0\u67e5\u7684\u8f6f\u4ef6\u3002</p> <p>\u9ad8\u53ef\u7528\u81f3\u5c11\u9700\u8981 2 \u53f0\u670d\u52a1\u5668\uff0c\u4e3b\u5907\u90fd\u5f97\u88c5\u4e0akeepalived\uff0c\u5f53\u8bf7\u6c42\u8bbf\u95ee\u4e3b\u670d\u52a1\u5668\u65f6\uff0c\u5907\u4efd\u670d\u52a1\u5668\u4f1a\u4e00\u76f4\u68c0\u67e5\u4e3b\u670d\u52a1\u5668\u7684\u72b6\u6001\u3002</p> <p>keepalived \u9700\u8981\u7ed1\u5b9a\u4e00\u4e2a\u865a\u62df\u5730\u5740 vip ( Virtual IP Address ) \uff0c\u8fd9\u4e2a\u865a\u62df ip \u5730\u5740\u7ed1\u5b9a\u5728\u54ea\u53f0\u670d\u52a1\u5668\u4e0a\u8bf7\u6c42\u5c31\u4f1a\u53d1\u9001\u5230\u54ea\u53f0\u670d\u52a1\u5668\uff0c\u4e00\u5f00\u59cb\u4f1a\u7ed1\u5b9a\u5728\u4e3b\u670d\u52a1\u5668\u4e0a\u3002</p> <p></p>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#2-keepalived","title":"2\u3001\u5b89\u88c5 keepalived","text":"<p>\u9996\u5148\u51c6\u5907\u4e24\u53f0\u670d\u52a1\u5668\uff0c\u8fd9\u91cc\u6211\u4eec\u51c6\u5907\u4e86\u4e24\u53f0\u865a\u62df\u673a\u3002\u5206\u522b\u5728\u8fd9\u4e24\u53f0\u670d\u52a1\u5668\u4e0a\u5b89\u88c5 Nginx \u548c keepalived\u3002</p> <p>\u5b89\u88c5 keepalived \u4f7f\u7528 yum \u65b9\u5f0f\u76f4\u63a5\u5b89\u88c5\u5373\u53ef\uff0c\u8be5\u65b9\u5f0f\u4f1a\u81ea\u52a8\u5b89\u88c5\u4f9d\u8d56\u3002\u5b89\u88c5 keepalived \u547d\u4ee4\uff1a</p> <pre><code>yum -y install keepalived\nrpm -qa keepalived\ncat /etc/keepalived/keepalived.conf  #keepalived \u914d\u7f6e\u6587\u4ef6\n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#3_3","title":"3\u3001\u5b8c\u6210\u9ad8\u53ef\u7528\u914d\u7f6e","text":"<pre><code>vi /etc/keepalived/keepalived.conf\n</code></pre> <pre><code>global_defs {\n    notification_email {   # keepalived\u670d\u52a1\u5b95\u673a\u5f02\u5e38\u51fa\u73b0\u7684\u65f6\u5019\uff0c\u53d1\u9001\u901a\u77e5\u90ae\u4ef6 \u53ef\u4ee5\u662f\u591a\u4e2a\n      acassen@firewall.loc  #  \u6536\u4ef6\u4eba\u90ae\u7bb11\n      failover@firewall.loc   #  \u6536\u4ef6\u4eba\u90ae\u7bb12\n      sysadmin@firewall.loc   #  \u6536\u4ef6\u4eba\u90ae\u7bb13\n    }\n    notification_email_from Alexandre.Cassen@firewall.loc   #\u90ae\u4ef6\u53d1\u4ef6\u4eba\n    smtp_ server 192.168.107.254  #\u4e3b\u670d\u52a1\u5668\u7684ip\u5730\u5740\u3002\u90ae\u4ef6\u670d\u52a1\u5668\u5730\u5740\n    smtp_connect_timeout 30    # \u8d85\u65f6\u65f6\u95f4\n    router_id LVS_DEVEL    # \u673a\u5668\u6807\u8bc6 \u5c40\u57df\u7f51\u5185\u552f\u4e00\u5373\u53ef\u3002 LVS_DEVEL\u8fd9\u5b57\u6bb5\u5728/etc/hosts\u6587\u4ef6\u4e2d\u770b\uff1b\u901a\u8fc7\u5b83\u8bbf\u95ee\u5230\u4e3b\u673a\n}\nvrrp_script chk_http_ port {\n    script \"/usr/local/nginx/sbin/nginx_check.sh\"   #\u68c0\u6d4b\u811a\u672c\n    interval 2   # \u68c0\u6d4b\u811a\u672c\u6267\u884c\u7684\u95f4\u9694\uff0c\u5373\u68c0\u6d4b\u811a\u672c\u6bcf\u96942s\u4f1a\u81ea\u52a8\u6267\u884c\u4e00\u6b21\n    weight 2  #\u6743\u91cd\uff0c\u5982\u679c\u8fd9\u4e2a\u811a\u672c\u68c0\u6d4b\u4e3a\u771f\uff0c\u670d\u52a1\u5668\u6743\u91cd+2\n}\nvrrp_instance VI_1 {\n    state MASTER    # \u6307\u5b9akeepalived\u7684\u89d2\u8272\uff0cMASTER\u4e3a\u4e3b\uff0cBACKUP\u4e3a\u5907\u3002\u5907\u4efd\u670d\u52a1\u5668\u4e0a\u9700\u5c06MASTER \u6539\u4e3aBACKUP\n    interface eth0  # \u901a\u4fe1\u7aef\u53e3 \u901a\u8fc7ip addr\u53ef\u4ee5\u770b\u5230\uff0c\u6839\u636e\u81ea\u5df1\u7684\u673a\u5668\u914d\u7f6e\n    virtual_router_id 51 # vrrp\u5b9e\u4f8bid  keepalived\u96c6\u7fa4\u7684\u5b9e\u4f8bid\u5fc5\u987b\u4e00\u81f4\uff0c\u5373\u4e3b\u3001\u5907\u673a\u7684virtual_router_id\u5fc5\u987b\u76f8\u540c\n    priority 100         #\u4f18\u5148\u7ea7\uff0c\u6570\u503c\u8d8a\u5927\uff0c\u83b7\u53d6\u5904\u7406\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002\u4e3b\u3001\u5907\u673a\u53d6\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff0c\u4e3b\u673a\u503c\u8f83\u5927\uff0c\u5907\u4efd\u673a\u503c\u8f83\u5c0f\n    advert_int 1    #\u5fc3\u8df3\u95f4\u9694\uff0c\u9ed8\u8ba4\u4e3a1s\u3002keepalived\u591a\u673a\u5668\u96c6\u7fa4 \u901a\u8fc7\u5fc3\u8df3\u68c0\u6d4b\u5f53\u524d\u670d\u52a1\u5668\u662f\u5426\u8fd8\u6b63\u5e38\u5de5\u4f5c\uff0c\u5982\u679c\u53d1\u9001\u5fc3\u8df3\u6ca1\u53cd\u5e94\uff0c\u5907\u4efd\u670d\u52a1\u5668\u5c31\u4f1a\u7acb\u523b\u63a5\u7ba1\uff1b\n    authentication {     # \u670d\u52a1\u5668\u4e4b\u95f4\u901a\u4fe1\u5bc6\u7801\n        auth type PASS   #\u8bbe\u7f6e\u9a8c\u8bc1\u7c7b\u578b\u548c\u5bc6\u7801\uff0cMASTER\u548cBACKUP\u5fc5\u987b\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u7801\u624d\u80fd\u6b63\u5e38\u901a\u4fe1\n        auth pass 1111\n    }\n    virtual_ipaddress { # \u81ea\u5b9a\u4e49\u865a\u62dfIP\u3002\u81ea\u5b9a\u4e49\u7684\u865a\u62dfip\u5f97\u6839\u636e\u771f\u5b9eip\u8bbe\u7f6e\u3002\u6bd4\u5982\u771f\u5b9eip\u662f192.168.91.138\uff0c\u90a3\u4e48\u865a\u62dfip\u53ef\u4ee5\u8bbe\u7f6e\u4e3a192.168.91.139~255\uff0c\u524d\u9762\u4e09\u4e2a\u6570\u5f97\u4e00\u81f4\n        192.168.107.188 # \u5b9a\u4e49\u865a\u62dfip(VIP)\uff0c\u53ef\u591a\u8bbe\uff0c\u6bcf\u884c\u4e00\u4e2a\n    }\n}\n</code></pre> <pre><code>vi /etc/keepalived/keepalived.conf\n</code></pre> <pre><code>global_defs {\n    notification_email {\n      acassen@firewall.loc\n      failover@firewall.loc\n      sysadmin@firewall.loc\n    }\n    notification_email_from Alexandre.Cassen@firewall.loc\n    smtp_ server 192.168.107.253    #\u5907\u4efd\u670d\u52a1\u5668\u7684ip\u5730\u5740\n    smtp_connect_timeout 30\n    router_id LVS_DEVEL    # LVS_DEVEL\u8fd9\u5b57\u6bb5\u5728/etc/hosts\u6587\u4ef6\u4e2d\u770b\uff1b\u901a\u8fc7\u5b83\u8bbf\u95ee\u5230\u4e3b\u673a\n}\nvrrp_script chk_http_ port {\n    script \"/usr/local/nginx/sbin/nginx_check.sh\"   #\u68c0\u6d4b\u811a\u672c\n    interval 2   # (\u68c0\u6d4b\u811a\u672c\u6267\u884c\u7684\u95f4\u9694)2s\n    weight 2  #\u6743\u91cd\uff0c\u5982\u679c\u8fd9\u4e2a\u811a\u672c\u68c0\u6d4b\u4e3a\u771f\uff0c\u670d\u52a1\u5668\u6743\u91cd+2\n}\nvrrp_instance VI_1 {\n    state BACKUP    # \u6307\u5b9akeepalived\u7684\u89d2\u8272\uff0cMASTER\u4e3a\u4e3b\uff0cBACKUP\u4e3a\u5907\u3002\u5907\u4efd\u670d\u52a1\u5668\u4e0a\u9700\u5c06MASTER \u6539\u4e3aBACKUP\n    interface eth0 # \u5f53\u524d\u8fdb\u884cvrrp\u901a\u8baf\u7684\u7f51\u7edc\u63a5\u53e3\u5361(\u5f53\u524dcentos\u7684\u7f51\u5361) \u7528ifconfig\u67e5\u770b\u4f60\u5177\u4f53\u7684\u7f51\u5361\n    virtual_router_id 51 # \u865a\u62df\u8def\u7531\u7f16\u53f7\uff0c\u4e3b\u3001\u5907\u673a\u7684virtual_router_id\u5fc5\u987b\u76f8\u540c\n    priority 90         #\u4f18\u5148\u7ea7\uff0c\u6570\u503c\u8d8a\u5927\uff0c\u83b7\u53d6\u5904\u7406\u8bf7\u6c42\u7684\u4f18\u5148\u7ea7\u8d8a\u9ad8\u3002\u4e3b\u3001\u5907\u673a\u53d6\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff0c\u4e3b\u673a\u503c\u8f83\u5927\uff0c\u5907\u4efd\u673a\u503c\u8f83\u5c0f\n    advert_int 1    # \u68c0\u67e5\u95f4\u9694\uff0c\u9ed8\u8ba4\u4e3a1s(vrrp\u7ec4\u64ad\u5468\u671f\u79d2\u6570)\uff0c\u6bcf\u96941s\u53d1\u9001\u4e00\u6b21\u5fc3\u8df3\n    authentication {     # \u6821\u9a8c\u65b9\u5f0f\uff0c \u7c7b\u578b\u662f\u5bc6\u7801\uff0c\u5bc6\u78011111\n        auth type PASS   #\u8bbe\u7f6e\u9a8c\u8bc1\u7c7b\u578b\u548c\u5bc6\u7801\uff0cMASTER\u548cBACKUP\u5fc5\u987b\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u7801\u624d\u80fd\u6b63\u5e38\u901a\u4fe1\n        auth pass 1111\n    }\n    virtual_ipaddress { # \u865b\u62dfip\n        192.168.107.188 # \u5b9a\u4e49\u865a\u62dfip(VIP)\uff0c\u53ef\u591a\u8bbe\uff0c\u6bcf\u884c\u4e00\u4e2a\n    }\n}\n</code></pre> <pre><code>#\u7f16\u8f91\u811a\u672c\nvi /usr/local/nginx/sbin/nginx_check.sh\n    #! /bin/bash\n    #\u68c0\u6d4bnginx\u662f\u5426\u542f\u52a8\u4e86\n    A=`ps -C nginx -no-header | wc - 1`\n    if [ $A -eq 0];then    #\u5982\u679cnginx\u6ca1\u6709\u542f\u52a8\u5c31\u542f\u52a8nginx \n        /usr/local/nginx/sbin/nginx    #\u901a\u8fc7Nginx\u7684\u542f\u52a8\u811a\u672c\u6765\u91cd\u542fnginx\n        sleep 2\n        if [`ps -C nginx --no-header| wc -1` -eq 0 ];then   #\u5982\u679cnginx\u91cd\u542f\u5931\u8d25\uff0c\u5219\u4e0b\u9762\u5c31\u4f1a\u505c\u6389keepalived\u670d\u52a1\uff0c\u8fdb\u884cVIP\u8f6c\u79fb\n            killall keepalived\n        fi\n    fi  \n</code></pre>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#4_3","title":"4\u3001\u5f00\u542f\u670d\u52a1\u5e76\u4e14\u6d4b\u8bd5","text":"<pre><code>/usr/local/nginx/sbin/nginx -s stop   #\u56e0\u4e3a\u5df2\u7ecf\u542f\u52a8\u4e86\uff0c\u6240\u4ee5\u5148\u5173\u95ed Nginx\n/usr/local/nginx/sbin/nginx   #\u542f\u52a8Nginx\nps -ef | grep nginx  #\u67e5\u770b Nginx \u8fdb\u7a0b\u7684\u72b6\u6001\nsystemctl start keepalived.service    #\u542f\u52a8keepalived\nps -ef | grep keepalived  #\u67e5\u770b keepalived \u8fdb\u7a0b\u7684\u72b6\u6001\n</code></pre> <p>\u5f00\u59cb\u6d4b\u8bd5</p> <pre><code>ip addr #master\u542f\u7528\u4e86\u865a\u62dfip backup\u56e0\u4e3a\u662f\u5907\u7528\u673a \u6240\u4ee5\u4f1a\u5728master\u5b95\u673a\u540e\u624d\u7ed1\u5b9a\u865a\u62dfip\n</code></pre> <p></p> <p></p> <p>\u7f16\u5199\u4e24\u4e2a\u4e0d\u4e00\u6837\u7684php\u811a\u672c\u6765\u5224\u65ad\u662f\u5426\u4f1a\u8bbf\u95ee\u5230\u5907\u7528\u673a</p> <pre><code>echo 'i am master' &gt; /usr/local/nginx/html/testkeeplived.php\necho 'i am backup' &gt; /usr/local/nginx/html/testkeeplived.php\n</code></pre> <p></p> <pre><code>systemctl stop keepalived.service   # \u5173\u95edkeepalived\n/usr/local/nginx/sbin/nginx -s stop  # \u5173\u95edNginx\n</code></pre> <p></p> <p></p> <p>\u518d\u6b21\u542f\u52a8master\u4e3b\u673a\u670d\u52a1\u89c2\u5bdfbackup\u5907\u7528\u673a\u72b6\u6001</p> <pre><code>/usr/local/nginx/sbin/nginx   #\u542f\u52a8Nginx\nsystemctl start keepalived.service\n</code></pre> <p></p> <p></p>"},{"location":"nginx/Nginx%E5%AD%A6%E4%B9%A0/#34nginx","title":"34.nginx\u8fd0\u7ef4\u89c4\u8303","text":"<pre><code>vi /etc/init.d/nginx\n</code></pre> <pre><code>#!/bin/bash\n# chkconfig: - 30 21\n# description: http service.\n# Source Function Library\n. /etc/init.d/functions\n# Nginx Settings\n\nNGINX_SBIN=\"/usr/local/nginx/sbin/nginx\"\nNGINX_CONF=\"/usr/local/nginx/conf/nginx.conf\"\nNGINX_PID=\"/usr/local/nginx/logs/nginx.pid\"\nRETVAL=0\nprog=\"Nginx\"\n\nstart() \n{\n    echo -n $\"Starting $prog: \"\n    mkdir -p /dev/shm/nginx_temp\n    daemon $NGINX_SBIN -c $NGINX_CONF\n    RETVAL=$?\n    echo\n    return $RETVAL\n}\n\nstop() \n{\n    echo -n $\"Stopping $prog: \"\n    killproc -p $NGINX_PID $NGINX_SBIN -TERM\n    rm -rf /dev/shm/nginx_temp\n    RETVAL=$?\n    echo\n    return $RETVAL\n}\n\nreload()\n{\n    echo -n $\"Reloading $prog: \"\n    killproc -p $NGINX_PID $NGINX_SBIN -HUP\n    RETVAL=$?\n    echo\n    return $RETVAL\n}\n\nrestart()\n{\n    stop\n    start\n}\n\nconfigtest()\n{\n    $NGINX_SBIN -c $NGINX_CONF -t\n    return 0\n}\n\ncase \"$1\" in\n  start)\n        start\n        ;;\n  stop)\n        stop\n        ;;\n  reload)\n        reload\n        ;;\n  restart)\n        restart\n        ;;\n  configtest)\n        configtest\n        ;;\n  *)\n        echo $\"Usage: $0 {start|stop|reload|restart|configtest}\"\n        RETVAL=1\nesac\n\nexit $RETVAL\n</code></pre> <pre><code>chmod 700 /etc/init.d/nginx\n/etc/init.d/nginx start\n/etc/init.d/nginx stop\n/etc/init.d/nginx restart\n</code></pre> <pre><code>\u5b89\u88c5\u3001\u5347\u7ea7\uff08yum\u5b89\u88c5or\u6e90\u7801\u5b89\u88c5\u3001\u7f16\u8bd1\u53c2\u6570\u3001\u5b89\u88c5\u8def\u5f84\u7b49\uff09\n\u670d\u52a1\u7ba1\u7406\uff08\u542f\u52a8\u811a\u672c\u3001\u91cd\u542f\u3001\u91cd\u8f7d\u3001\u542f\u52a8\u7528\u6237\uff09\n\u914d\u7f6e\u89c4\u8303\nLog\u683c\u5f0f\u3001\u8def\u5f84\u3001\u547d\u540d\u89c4\u5219\u548c\u5207\u5272\u7b56\u7565\nPid\u8def\u5f84\n\u865a\u62df\u4e3b\u673a\uff08\u9ed8\u8ba4\u865a\u62df\u4e3b\u673a\u3001\u865a\u62df\u4e3b\u673a\u72ec\u7acb\uff09\n\u9759\u6001\u6587\u4ef6\u65e5\u5fd7\u548c\u8fc7\u671f\u7f13\u5b58\u65f6\u95f4\n\u9632\u76d7\u94fe\n\u66f4\u6539\u914d\u7f6e\uff08\u4f7f\u7528\u81ea\u52a8\u5316\u5de5\u5177\u66f4\u6539\u914d\u7f6e\u6587\u4ef6\uff09\n\u5b89\u5168\u89c4\u8303\n\u540e\u53f0\u5730\u5740\u52a0\u7528\u6237\u8ba4\u8bc1\n\u53ef\u5199\u76ee\u5f55\u7981\u6b62\u89e3\u6790php\n\u7981\u6b62\u8bbf\u95ee.bak\u6587\u4ef6\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/","title":"Redis\u5b66\u4e60","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#_1","title":"\u51c6\u5907\u73af\u5883","text":"redis01 redis02 redis03 192.158.107.222 192.158.107.223 192.158.107.224 centos7 centos7 centos7 <pre><code>\u73af\u5883\u5305\nredis-6.2.9.tar.gz\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1redis","title":"1.redis\u7684\u7f16\u8bd1\u5b89\u88c5","text":"<pre><code>systemctl stop firewalld\ngetenforce #\u67e5\u770bselinux\nsetenforce 0 #\u4e34\u65f6\u5173\u95edselinux\n#sed -i 's/SELINUX=.*/SELINUX=disables/' /etc/selinux/config &amp;&amp; setenforce 0\ntar xf redis-6.2.9.tar.gz -C /\nmake -j2 &amp; make install\ncp redis.conf /etc/\nls -l /usr/local/bin/redis-*\n/usr/local/bin/redis-server -v\n\n#\u8bf4\u660e\u53ef\u4ee5\u901a\u8fc7scp\u547d\u4ee4\u5c06\uff0cbin/redis-*\u7684\u6240\u6709\u6587\u4ef6\u63a8\u9001\u5230\u5176\u4ed6\u76f8\u540c\u7cfb\u7edf\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u6ca1\u5fc5\u8981\u6bcf\u6b21\u5b89\u88c5\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2redis","title":"2.redis\u914d\u7f6e\u4fee\u6539\u542f\u52a8\u548c\u53c2\u6570\u8c03\u4f18","text":"<pre><code>sed -i '/^#/d;/^$/d' /etc/redis.conf\nvi /etc/redis.conf\nbind 0.0.0.0\ndaemonize yes#\u540e\u53f0\u8fd0\u884c\npidfile \"redis.pid\"\nlogfile \"redis.log\"\ndir /data/redis\nrequirepass redispwd\nmkdir -p /data/redis\nredis-server /etc/redis.conf\n</code></pre> <pre><code>#\u8c03\u6574\u6700\u5927\u6587\u4ef6\u6253\u5f00\u6570\nvi /etc/security/limits.conf\n* - nofile 65535 \n#\u5185\u6838\u53c2\u6570\u4fee\u6539\nvi /etc/sysctl.conf\nnet.core.somaxconn = 10240\nvm.overcommit_memory = 1\nsysctl -p\n\npkill redis\nredis-server /etc/redis.conf\ntail -f /data/redis/redis.log\n\n#systemctl\u7ba1\u7406redis\nvi /usr/lib/systemd/system/redis.service\n[Unit]\nDescription=redis\nAfter=network.target\n[Service]\nType=forking\nExecStart=/usr/local/bin/redis-server /etc/redis.conf\n[Install]\nWantedBy=multi-user.target\n\nsystemctl daemon-reload\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#3redis","title":"3.redis\u5e38\u7528\u6570\u636e\u7c7b\u578b\u7684\u57fa\u672c\u64cd\u4f5c","text":"<pre><code>1.redis-cli\u4f7f\u7528\u548c\u8ba4\u8bc1\u767b\u5f55\n\u5ba2\u6237\u7aef\u5de5\u5177redis-cli\u767b\u5f55\n# redis-cli                         #\u9ed8\u8ba4127.0.0.1 6379\n# redis-cli -h redis\u7684ip\n# redis-cli -h xxx -p xxx\n\nredis\u7684\u8ba4\u8bc1\n&gt;auth redispwd               #\u767b\u5f55redis\u540e\u505a\u8ba4\u8bc1\n# redis-cli -a redispwd     #\u767b\u5f55+\u8ba4\u8bc1\n\n2.Redis\u5e38\u7528\u6570\u636e\u7c7b\u578b\n\u5b57\u7b26\u4e32\n\u5217\u8868\u3001\u96c6\u5408\nhash\u54c8\u5e0c\u3001\u53d1\u5e03\u548c\u8ba2\u9605\n\n\n3.Redis\u5b57\u7b26\u4e32\u64cd\u4f5c\n&gt;set name aaa              #\u589e\u52a0key\u5e76\u8d4b\u503c\n&gt;keys *                        #\u663e\u793a\u6240\u6709\u7684key\n&gt;get name                    #\u83b7\u53d6key\u7684\u503c\n&gt;set name bbb              #\u91cd\u65b0\u7ed9key\u8d4b\u503c\n&gt;del name                    #\u5220\u9664key\n\n\u5927\u5c0f\u5199\u95ee\u9898\n\u547d\u4ee4\u4e0d\u533a\u5206\u5927\u5c0f\u5199:  &gt;GET name\nkey\u533a\u5206\u5927\u5c0f\u5199: &gt;get Name\n&gt;set name ccc            \n&gt;set Name xxx              \n\n&gt;get name\n&gt;GET name\n\n&gt;get name\n&gt;get Name\n\n\u975e\u4ea4\u4e92\u5f0f\u64cd\u4f5cRedis\n# redis-cli -a redispwd set name abc888\n# redis-cli -a redispwd get name\n# redis-cli -a redispwd del name\n\n\n\u4f7f\u7528Shell\u6279\u91cf\u5199\u5165\u6570\u636e\u5e76\u83b7\u53d6\n# for i in $(seq -w 10);do redis-cli -a redispwd set name${i} test${i}; redis-cli -a redispwd get name${i}; done 2&gt;/dev/null\n\n\n4.Redis\u5217\u8868\u548c\u96c6\u5408\u7684\u57fa\u672c\u64cd\u4f5c\n1).Redis\u5217\u8868\n\u5217\u8868\u7279\u70b9:\n\u5217\u8868\u662f\u6709\u987a\u5e8f\u7684\n\u53ef\u5199\u5165\u91cd\u590d\u7684\u6570\u636e\n\nrpush\u53f3\u6dfb\u52a0               \n\u5982\uff1a['s1','s2','s3',...]\n&gt;rpush names s1              #\u4f9d\u6b21\u5728\u5217\u8868\u53f3\u4fa7\u9010\u6b65\u6dfb\u52a0\u6570\u636e\uff0c\u8d77\u521d\u5217\u8868\u53ef\u4ee5\u4e3a\u7a7a\n&gt;rpush names s2\n&gt;rpush names s3\n&gt;rpush names s4\n&gt;rpush names s1                #\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u91cd\u590d\u7684\u6570\u636e\n&gt;lrange names 0 -1            #\u5c06\u5217\u8868\u7684\u503c\u5168\u90e8\u8bfb\u53d6\u67e5\u770b\uff0c\u6ce8\u610f:\u6700\u524d\u9762\u662fL\u7684\u5c0f\u5199\uff0c\u5927\u5c0f\u5199\u90fd\u53ef\u4ee5\n&gt;LLEN names                     #\u5217\u51fa\u5217\u8868\u7684\u957f\u5ea6\n\nRedis\u5217\u8868\u7684\u8bfb\u53d6\u8bf4\u660e\n0\u4ee3\u8868\u7b2c\u4e00\u4e2a\u503c\uff0c1\u4ee3\u8868\u7b2c\u4e8c\u4e2a\u503c\u7b49\uff0c2\u4ee3\u8868\u7b2c\u4e09\u4e2a\u503c\uff0c...\n-1\u4ee3\u8868\u6700\u540e\u4e00\u4e2a\u503c\uff0c-2\u4ee3\u8868\u5012\u4e8c\u4e2a\u503c\u7b49\n&gt;lrange names 0  2           #\u8bfb\u53d6\u7b2c1\u5230\u7b2c3\u4e2a\u5217\u8868\u503c\n&gt;lrange names 0 -2           #\u8bfb\u53d6\u7b2c1\u5230\u5012\u6570\u7b2c2\u4e2a\u5217\u8868\u503c\n\n\u5217\u8868\u5de6\u6dfb\u52a0\n\u5982\uff1a['...','b3','b2','b1']\n&gt;lpush names2 b1          #\u4f9d\u6b21\u5728\u5217\u8868\u5de6\u4fa7\u9010\u6b65\u6dfb\u52a0\u6570\u636e\uff0c\u8d77\u521d\u5217\u8868\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u6ce8\u610f:\u6700\u524d\u9762\u662fL\u7684\u5c0f\u5199\uff0c\u5927\u5c0f\u5199\u90fd\u53ef\u4ee5\n&gt;lpush names2 b2\n&gt;lpush names2 b3\n&gt;lpush names2 b4\n&gt;push names2 b1             #\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u91cd\u590d\u7684\u6570\u636e\n&gt;lrange names2 0 -1         #\u5c06\u5217\u8868\u7684\u503c\u5168\u90e8\u8bfb\u53d6\u67e5\u770b\uff0c\u6ce8\u610f:\u6700\u524d\u9762\u662fL\u7684\u5c0f\u5199\uff0c\u5927\u5c0f\u5199\u90fd\u53ef\u4ee5\n&gt; lrange names2 0 1         #\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u5230\u7b2c\u4e8c\u4e2a\u7684\u503c\n\nRedis\u5217\u8868\u5143\u7d20\u7684\u5220\u9664\n\u79fb\u9664\u5217\u8868\u4e2d\u7684\u5176\u4e2d\u4e00\u4e2a\u503c,\u5982s1\uff1a  &gt;LREM names 1 s1                #1\u662f\u4ee3\u8868\u79fb\u9664\u4e00\u4e2a\u5143\u7d20\uff0c\u56e0\u4e3a\u5217\u8868\u4e2d\u5143\u7d20\u662f\u53ef\u4ee5\u91cd\u590d\u7684,\u9700\u8981\u6307\u5b9a\u79fb\u9664\u51e0\u4e2a\u5143\u7d20,1,2...\n\u79fb\u9664\u5217\u8868\u4e2d\u6240\u6709\u91cd\u590d\u7684\u503c,\u5982s1\uff1a  &gt;LREM names2 0 b1              #0\u662f\u4ee3\u8868\u79fb\u9664\u6240\u6709\u4e2a\u6307\u5b9a\u7684\u5143\u7d20\n\n\u5217\u8868\u5f39\u51fa\u5143\u7d20\n&gt;lpop \u5217\u8868\u540d     #\u5de6\u5f39\u51fa                     #\u6ce8\u610f\u662fL\u7684\u5c0f\u5199\n&gt;rpop \u5217\u8868\u540d    #\u53f3\u5f39\u51fa\n\n2).Redis\u96c6\u5408\n\u96c6\u5408\u7279\u70b9:\n\u65e0\u987a\u5e8f\u7684\n\u4e0d\u91cd\u590d\u7684\n\nRedis\u96c6\u5408\u7684\u64cd\u4f5c\n&gt;sadd jh j1                     #\u521b\u5efa\u96c6\u5408\u5e76\u6dfb\u52a0\u5143\u7d20\uff0c\u96c6\u5408\u4e8b\u5148\u53ef\u4ee5\u6ca1\u6709\u5143\u7d20\n&gt;sadd jh j2\n&gt;sadd jh j3\n&gt;sadd jh j4\n&gt;sadd jh j1                     #\u96c6\u5408\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u91cd\u590d\u7684\u5143\u7d20\uff0c\u4f1a\u6dfb\u52a0\u5931\u8d25\uff0c\u56e0\u4e3a\u96c6\u5408\u4e0d\u5141\u8bb8\u5143\u7d20\u91cd\u590d\n&gt;SMEMBERS jh                #\u5217\u51fa\u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\n\nRedis\u96c6\u5408\u7684\u5220\u9664\n&gt;srem jh j1                   #\u5220\u9664\u96c6\u5408\u4e2d\u7684\u5143\u7d20j1\n&gt;spop jh                       #\u96c6\u5408\u968f\u673a\u5f39\u51fa\u4e00\u4e2a\u5143\u7d20\n\n\u5224\u65ad\u5143\u7d20\u662f\u5426\u5728\u96c6\u5408\u91cc\nSISMEMBER jh j1\n0\u4ee3\u8868\u4e0d\u5728\uff0c1\u4ee3\u8868\u5728\n\n\n5.Redis\u54c8\u5e0c\u548c\u8ba2\u9605\u7c7b\u578b\u57fa\u7840\u64cd\u4f5c\n1).Hash\u54c8\u5e0c\u7c7b\u578b\u6570\u636e\u64cd\u4f5c\nHash\u5199\u5165\n&gt;hset haxi name ha                     #\u521b\u5efa\u4e00\u4e2ahash\u540d\u5b57haxi,\u5728\u540d\u5b57\u91cc\u9762\u63d2\u5165\u503c\uff08\u503c\u90fd\u662f\u4ee5k-v\u5f62\u5f0f\u7684\uff0c\u53ef\u4ee5\u591a\u63d2\u5165\u51e0\u5bf9\u503c\uff09\n&gt;hset haxi location bj\n&gt;hset haxi age 18\n&gt;hset haxi sex man\nhash\u83b7\u53d6\n\u83b7\u53d6\u5168\u90e8\uff1a&gt;HGETALL haxi            #\u83b7\u53d6hash\u540d\u5b57\u91cc\u7684\u6240\u6709\u5bf9\u513fkey\u7684\u503c\n\u83b7\u53d6\u5355\u4e2a\uff1a&gt;HGET haxi name        #\u83b7\u53d6hash\u540d\u5b57\u91cc\u7684\u5355\u4e2akey\u7684\u503c\nHash\u5220\u9664\n&gt;HDEL haxi age                          #\u5220\u9664hash\u540d\u5b57\u7684\u5355\u4e2akey\n&gt;DEL haxi                                   #\u5220\u9664\u6574\u4e2ahash\nHash\u6279\u91cf\u6dfb\u52a0\n&gt;hmset haxi name hx666 age 20 location bj sex boy\n\n2).Redis\u7684\u53d1\u5e03\u8ba2\u9605\n&gt;subscribe fabu                                         #\u8ba2\u9605\u4e00\u4e2a\u9891\u9053\uff0c\u53ef\u4ee5\u5f00\u591a\u4e2a\u7a97\u53e3\u90fd\u8ba2\u9605\u8fd9\u4e2a\u9891\u9053\n&gt;publish fabu \"name shi, age 20,sex boy\"    #\u53e6\u5916\u5f00\u4e00\u4e2a\u7a97\u53e3\uff0c\u5f80\u8fd9\u4e2a\u8ba2\u9605\u9891\u9053\u91cc\u53d1\u9001\u6570\u636e\uff0c\u8fd9\u6837\u8ba2\u9605\u9891\u9053\u7684\u7a97\u53e3\u90fd\u80fd\u6536\u5230\u8be5\u6570\u636e\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#4redis","title":"4.redis\u7684\u4e0d\u540c\u5e93\u5207\u6362\u548c\u8fd0\u7ef4\u76d1\u63a7\u547d\u4ee4","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#aredis","title":"A.Redis\u4e0d\u540c\u6570\u636e\u5e93\u7684\u5207\u6362","text":"<pre><code>1).\u914d\u7f6e\u6587\u4ef6\u67e5\u770bRedis\u6709\u591a\u5c11\u4e2a\u5e93\uff1f \n\u9ed8\u8ba4\u662f16\u4e2a\n[root@localhost ~]# grep databases /etc/redis.conf \ndatabases 16\n\n2).Redis\u6570\u636e\u5e93\u7684\u5207\u6362\n&gt;select 0\n&gt;select 1\n&gt;select 16        #\u5207\u6362\u4e0d\u6210\u529f\n\n3).\u4e0d\u540c\u7684\u5e93\u6570\u636e\u662f\u72ec\u7acb\u7684\n\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u5e93\u5b58\u50a8\u4e0d\u540c\u7684\u6570\u636e\n&gt;select 0                        #\u9ed8\u8ba4\u4e5f\u662f0\u5e93\uff0c\u9ed8\u8ba4\u64cd\u4f5c\u7684\u90fd\u662f0\u5e93\n&gt;set name s0\n&gt;get name\n&gt;select 2\n&gt;set name s2\n&gt;get name\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#bredis","title":"B.Redis\u8fd0\u7ef4\u76d1\u63a7\u547d\u4ee4","text":"<pre><code>1).\u67e5\u770bkey\n&gt;RANDOMKEY    #\u968f\u673a\u83b7\u53d6\u4e00\u4e2akey\n&gt;KEYS *            #\u67e5\u770b\u6240\u6709key\uff0c\u6ce8\u610f\u963b\u585e,\u5982\u679ckey\u91cf\u7279\u522b\u5927\u65f6\u5019\uff0c\u5bb9\u6613\u5361\u6b7b\u963b\u585e\uff0c\u4e0a\u5343\u4e07\u4e0a\u767e\u4e07\u65f6\u5019\u5bb9\u6613\u963b\u585e\n&gt;SCAN 0           #\u5efa\u8bae\u4f7f\u7528,\u6bcf\u6b21\u83b7\u53d611\u4e2akey\uff0c\u53ef\u4ee5\u5faa\u73af\u83b7\u53d6\uff0c\u76f4\u5230\u83b7\u53d6\u6240\u6709key\n                       #\u4ece\u7f16\u53f70\u5f00\u59cb\uff0c\u4e2d\u95f4\u4f1a\u6709\u4e00\u4e2a\u7f16\u53f7\u63d0\u793a\uff08\u7c7b\u4f3c\u7d22\u5f15\u7f16\u53f7),\u6309\u7f16\u53f7\u63d0\u793a\u4f9d\u6b21\u5faa\u73af\u83b7\u53d6\uff0c\u76f4\u5230\u7f16\u53f7\u4e3a0\u5373\u8868\u793a\u83b7\u53d6\u5b8c\u6240\u6709\u7684key\n\n\u4f7f\u7528Shell\u6279\u91cf\u5199\u5165\u6570\u636e\u5e76\u83b7\u53d6\n# for i in $(seq -w 50);do redis-cli -a redispwd set name${i} test${i}; redis-cli -a redispwd get name${i}; done 2&gt;/dev/null\n\n2).\u76d1\u63a7\u547d\u4ee4\n# redis-cli -a redispwd --stat                                #\u76d1\u63a7Redis\u72b6\u6001\n------- data ------ --------------------- load -------------------- - child -\nkeys       mem      clients blocked requests            connections          \n18         855.93K  1       0       49 (+0)             6           \n18         855.93K  1       0       50 (+1)             6           \n18         855.93K  1       0       51 (+1)             6           \n\n\u663e\u793a\u591a\u5c11\u4e2akey(\u662f\u628a\u6240\u6709\u6570\u636e\u5e93\u7684key\u90fd\u52a0\u8d77\u6765)  \u5185\u5b58\u5360\u7528\u591a\u5c11   \u5ba2\u6237\u7aef\u6709\u591a\u5c11   redis\u7684requests\u8bf7\u6c42\u6570\u662f\u591a\u5c11  connections\u662f\u591a\u5c11\u8fde\u63a5    \n--\u591a\u51e0\u4e2a\u5ba2\u6237\u7aef\uff0c\u591a\u589e\u52a0\u51e0\u4e2akey\u5c31\u53ef\u4ee5\u9a6c\u4e0a\u53d1\u73b0\n\n# redis-cli -a redispwd monitor #\u76d1\u63a7\u6570\u636e\u64cd\u4f5c\n\u4ea4\u4e92\u5f0f\u963b\u585e\u72b6\u6001\uff0c\u5f53\u6709\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u65f6\u5019\u4f1a\u8bb0\u5f55\n--\u64cd\u4f5c\u7684\u547d\u4ee4\uff0c\u589e\u52a0\uff0c\u5220\u9664\u6570\u636e\u7b49\u90fd\u4f1a\u76d1\u63a7\u5230\n\n# redis-cli -a redispwd info  #\u76d1\u63a7\u7cfb\u7edf\u53ef\u901a\u8fc7info\u83b7\u53d6\u6570\u636e\n\n3).Info\u5e38\u7528\u4fe1\u606f\u8bf4\u660e\uff0c\u76d1\u63a7\u5de5\u5177\u4f8b\u5982Zabbix\u4f7f\u7528\nServer:                       #\u670d\u52a1\u5668\u4fe1\u606f\nClients:                      #\u5ba2\u6237\u7aef\u4fe1\u606f\nMemory:                       # Redis\u5185\u5b58\u5360\u7528\n   used_memory                #\u6570\u636e\u5360\u7528\u5185\u5b58\n   used_memory_rss            #\u5b9e\u9645\u4f7f\u7528\u5185\u5b58\n   mem_fragmentation_ratio    #\u5185\u5b58\u788e\u7247\u5316\n   maxmemory                  #\u6700\u5927\u5185\u5b58\u9650\u5236\nPersistence:                  #\u6301\u4e45\u5316\u5b58\u50a8\u4fe1\u606f\n   rdb_*\n   aof_enabled:0              #\u9ed8\u8ba4aof\u662f\u5173\u95ed\u7684\nStats:                        #\u72b6\u6001\u4fe1\u606f\uff0c\u662f\u76d1\u63a7\u91cd\u70b9\nReplication:                  #\u4e3b\u4ece\u72b6\u6001\u76d1\u63a7\u548c\u54e8\u5175\u4fe1\u606f\n   role:master\n   connected_slaves:0\nCPU:                          #sys\u3001user\u5360\u7528\nCluster:                      #Redis\u96c6\u7fa4\u4fe1\u606f\nKeyspace:                     #\u952e\u7684\u5206\u5e03\u4fe1\u606f\uff0ckey\u7684\u5206\u5e03\u7684\u5e93\u548c\u8fc7\u671f\u65f6\u95f4\u7b49\u4fe1\u606f\n\n\n4).\u5355\u72ec\u67e5\u770b\u67d0\u5757\u5185\u5bb9\n\n# redis-cli -a redispwd info Server\n\n# redis-cli -a redispwd info Clients\n\n# redis-cli -a redispwd info Memory\n\n# redis-cli -a redispwd info Persistence\n\n# redis-cli -a redispwd info Stats\n\n# redis-cli -a redispwd info Replication\n\n# redis-cli -a redispwd info CPU\n\n# redis-cli -a redispwd info Cluster\n\n# redis-cli -a redispwd info Keyspace\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#5redis","title":"5.Redis\u914d\u7f6e\u52a8\u6001\u66f4\u65b0\u548c\u5199\u5165","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1redis_1","title":"1).Redis\u66f4\u65b0\u914d\u7f6e\u7684\u4e24\u79cd\u65b9\u5f0f","text":"<pre><code>a.\u91cd\u542f\u66f4\u65b0\uff0c\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u542f\nb.\u5b9e\u65f6\u66f4\u65b0\uff0c\u4e0d\u9700\u8981\u91cd\u542f\n\n\u91cd\u542f\u66f4\u65b0\u5bc6\u7801\n# vim /etc/redis.conf\nrequirepass redispwd666\n\n\u52a8\u6001\u66f4\u65b0\u5bc6\u7801\n&gt;config get requirepass\n&gt;config set requirepass redispwd\n&gt;config rewrite                             #\u8fd0\u884c\u65f6\u914d\u7f6e\u5199\u5165\u914d\u7f6e\u6587\u4ef6\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2redis_1","title":"2).\u67e5\u770bredis\u7684\u76f8\u5173\u8fde\u63a5\u6570","text":"<pre><code>&gt;info clients                              #\u67e5\u770b\u5f53\u524d\u7684redis\u8fde\u63a5\u6570\n&gt;config get maxclients                 #\u67e5\u770bredis\u5141\u8bb8\u7684\u6700\u5927\u8fde\u63a5\u6570\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#3config","title":"3).\u5927\u90e8\u5206\u914d\u7f6e\u90fd\u80fd\u901a\u8fc7config\u547d\u4ee4\u8fdb\u884c\u66f4\u6539\uff0c\u7136\u540e\u5199\u5165\u914d\u7f6e\u6587\u4ef6\uff08\u4f7f\u7528\u6bd4\u8f83\u65b9\u4fbf)","text":"<pre><code>\u4f8b\u5982\uff1a\u4fee\u6539redis\u6700\u5927\u8fde\u63a5\u6570\n&gt; config get maxclients                   #\u67e5\u770b\u9ed8\u8ba4\u8bbe\u7f6e\uff0c\u6700\u5927\u5ba2\u6237\u7aef\u6570\u4e3a10000\n1) \"maxclients\"\n2) \"10000\"\n\n&gt;config set maxclients 20000\n\n&gt; config get maxclients                   \n1) \"maxclients\"\n2) \"20000\"\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#6redis","title":"6.redis\u591a\u7528\u6237\u7ba1\u7406","text":"<pre><code>\u8001\u7248\u672c\u6ca1\u6709\u7528\u6237\u540d\uff0c\u53ea\u6709\u5bc6\u7801\nRedis6\u5df2\u7ecf\u6709\u7528\u6237\u540d\uff0c\u9ed8\u8ba4\u7528\u6237\u540ddefault\n\n1).\u5217\u51fa\u6240\u6709\u7528\u6237\uff0c\u9ed8\u8ba4\u53ea\u6709default\u8d85\u7ea7\u7528\u6237\uff0c\u5e76\u67e5\u770bdefault\u7528\u6237\u76f8\u5173\u4fe1\u606f\n&gt;ACL LIST                      #\u5217\u51fa\u6240\u6709\u7528\u6237\uff0c\u9ed8\u8ba4\u7528\u6237\u662fdefault\n1) \"user default on #9cd9ab402f4115ed9921a7e4f7fc89330c8fe9283a8b1cdef203f7a7e622c68f ~* &amp;* +@all\"     #default\u7528\u6237\u5462\u662f\u6709\u6240\u6709\u6743\u9650\n&gt;ACL getuser default     #\u67e5\u770bdefault\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\uff0c default\u5bf9\u6240\u6709key\uff0c\u6240\u6709\u547d\u4ee4\u5747\u6709\u6743\u9650\uff0c\u6700\u9ad8\u6743\u9650\uff0c\u662f\u9ed8\u8ba4\u7528\u6237\n 1) \"flags\"\n 2) 1) \"on\"\n    2) \"allkeys\"                            #\u6240\u6709\u7684key\u90fd\u6709\u6743\u9650\n    3) \"allchannels\"\n    4) \"allcommands\"\n 3) \"passwords\"\n 4) 1) \"9cd9ab402f4115ed9921a7e4f7fc89330c8fe9283a8b1cdef203f7a7e622c68f\"\n 5) \"commands\"\n 6) \"+@all\"                                 #\u6240\u6709\u7684\u547d\u4ee4\u90fd\u6709\u6743\u9650\n 7) \"keys\"\n 8) 1) \"*\"\n 9) \"channels\"\n10) 1) \"*\"\n\n2).\u521b\u5efa\u7528\u6237\u5e76\u7ed9\u7528\u6237\u6388\u6743\n&gt; ACL CAT                                   #\u67e5\u770b\u6240\u6709\u7684\u6743\u9650\n 1) \"keyspace\"\n 2) \"read\"\n 3) \"write\"\n 4) \"set\"\n 5) \"sortedset\"\n 6) \"list\"\n 7) \"hash\"\n 8) \"string\"\n 9) \"bitmap\"\n10) \"hyperloglog\"\n11) \"geo\"\n12) \"stream\"\n13) \"pubsub\"\n14) \"admin\"\n15) \"fast\"\n16) \"slow\"\n17) \"blocking\"\n18) \"dangerous\"\n19) \"connection\"\n20) \"transaction\"\n21) \"scripting\"\n\n\n\u6848\u4f8b\uff1a\u521b\u5efatest\u7528\u6237\u53ea\u7ed9\u4e00\u4e2aget\u547d\u4ee4\u6743\u9650\u3001\u8bfb\u6743\u9650\u3001\u5e76\u4e14\u53ea\u80fdget\u662fname\u5f00\u5934\u7684key: name*\n\u4f7f\u7528default\u9ed8\u8ba4\u7528\u6237\u767b\u5f55redis\uff1a\n# redis-cli -a redispwd\n&gt; set name1 n1\n&gt; set name2 n2\n&gt; set name3 n3\n&gt;set k1 v1\n&gt;set k2 v2\n&gt;ACL SETUSER test on &gt;testpwd ~name* +get               #\u521b\u5efatest\u7528\u6237\uff0c\u5bc6\u7801\uff1atestpwd   \u8d4b\u7ed9get\u547d\u4ee4\u7684\u6743\u9650\uff0c\u53ea\u5bf9name\u5f00\u5934\u7684\u6709get\u6743\u9650\n&gt;ACL SETUSER test on &gt;testpwd ~name* +@read           #\u7ed9test\u7528\u6237\u589e\u52a0read\u6743\u9650\uff0c\u8bbe\u7f6e\u53ea\u5bf9name\u5f00\u5934\u7684key\u6709read\u6743\u9650\n&gt;ACL getuser test                                                        #\u67e5\u770btest\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\n\n&gt;ACL SETUSER t1 on &gt;t1pwd ~* +get                           #\u5bf9\u6240\u6709key\u90fd\u6709get\u6743\u9650\n&gt;ACL SETUSER t1 on &gt;t1pwd ~* +@read                      #\u5bf9\u6240\u6709key\u90fd\u6709read\u6743\u9650\n&gt;ACL getuser t1\n\n\u8ba4\u8bc1\u767b\u5f55\uff0c\u9a8c\u8bc1\u6743\u9650:\n&gt;auth test testpwd\n# redis-cli --user test --pass testpwd\n\n&gt;get name1\n\"n1\"\n&gt;get name2\n\"n2\"\n&gt;get k1\n(error) NOPERM this user has no permissions to access one of the keys used as arguments\n&gt;set k3 v3\n(error) NOPERM this user has no permissions to run the 'set' command or its subcommand\n\n\n3).\u5e38\u7528\u6743\u9650\u6848\u4f8b\uff1a\n\u6848\u4f8b1:\u521b\u5efa\u7528\u6237\u8d4b\u7ed9\u6240\u6709\u6743\u9650\uff1a              \n&gt;ACL SETUSER test1 on &gt;test1pwd ~* +@all               #\u7528\u6237\u540d:test1  \u5bc6\u7801:test1pwd\n&gt; ACL GETUSER test1                                                #\u67e5\u770btest1\u7528\u6237\u7684\u6240\u6709\u6743\u9650\n\n\u9a8c\u8bc1\u6743\u9650:\n&gt; auth test1 test1pwd\n&gt; keys *\n1) \"name1\"\n2) \"k1\"\n3) \"k2\"\n4) \"name2\"\n5) \"name3\"\n&gt; get name1\n\"n1\"\n&gt; get k1                                                                    #get\u6743\u9650\n\"v1\"\n&gt; set a b                                                                  #set\u6743\u9650\n&gt; get a\n\"b\"\n&gt; config get requirepass                                            #config\u914d\u7f6e\u6743\u9650\n1) \"requirepass\"\n2) \"redispwd\"\n&gt; ACL SETUSER t666 on &gt;t666pwd ~* +@all -config     #\u521b\u5efa\u7528\u6237\u7684\u6743\u9650\n&gt; acl getuser t666                                                     #\u67e5\u770b\u7528\u6237\u6743\u9650\n\n\n\u6848\u4f8b2:\u53bb\u9664config\u547d\u4ee4\u540e\u7684\u6240\u6709\u6743\u9650:       \n&gt;ACL SETUSER test2 on &gt;test2pwd ~* +@all -config     #\u7528\u6237\u540d:test2  \u5bc6\u7801:test2pwd\n&gt;ACL GETUSER test2                                                 #\u67e5\u770btest2\u7528\u6237\u9664\u4e86config\u547d\u4ee4\u6743\u9650\u4e4b\u5916\u7684\u6240\u6709\u6743\u9650\n\n\u9a8c\u8bc1\u6743\u9650:\n&gt; auth test2 test2pwd\n&gt; config get requirepass                            #\u6ca1\u6709config\u6743\u9650\n(error) NOPERM this user has no permissions to run the 'config' command or its subcommand\n&gt; keys *\n1) \"name1\"\n2) \"k1\"\n3) \"a\"\n4) \"k2\"\n5) \"name2\"\n6) \"name3\"\n&gt; get name1\n\"n1\"\n&gt; set a2 b2\n&gt; get a2\n\"b2\"\n&gt; ACL SETUSER t777 on &gt;t777pwd ~* +@all      #\u521b\u5efa\u7528\u6237\u7684\u6743\u9650\n&gt; acl getuser t777                                            #\u67e5\u770b\u7528\u6237\u6743\u9650\n\n\n\u6848\u4f8b3:\u521b\u5efa\u4e00\u4e2a\u7528\u6237\uff0c\u53ea\u7ed9info\u548cmomitor\u547d\u4ee4\u6743\u9650\uff1a \n&gt;ACL SETUSER monitor on &gt;monitorpwd ~* +info +monitor   #\u7528\u6237\u540d:monitor \u5bc6\u7801:monitorpwd\n\n\u6743\u9650\u8ba4\u8bc1\uff1a\n&gt; auth monitor monitorpwd\n&gt; KEYS *\n(error) NOPERM this user has no permissions to run the 'keys' command or its subcommand\n&gt; get name1\n(error) NOPERM this user has no permissions to run the 'get' command or its subcommand\n&gt; info                                              #\u6709info\u6743\u9650\n# Server\nredis_version:6.2.1\nredis_git_sha1:00000000\nredis_git_dirty:0\nredis_build_id:3bc8e110479b329d\n.....\n&gt; monitor                                      #\u6709monitor\u6743\u9650\n\u963b\u585e\u72b6\u6001\uff0c\u76d1\u63a7redis\n\n\n\u5217\u51fa\u6240\u6709\u7528\u6237:\n# redis-cli -a redispwd                 \n&gt; ACL LIST                                 #\u5217\u51fa\u6240\u6709\u7528\u6237\n\n\u5220\u9664\u7528\u6237:\n&gt; ACL DELUSER t666                   #\u5220\u9664\u7528\u6237t666\n&gt; ACL LIST\n\n\u4f7f\u7528acl\u521b\u5efa\u7528\u6237\u5199\u5165\u914d\u7f6e\u6587\u4ef6\n&gt;config rewrite      #\u91cd\u542fRedis\u7528\u6237\u4fe1\u606f\u624d\u4e0d\u4f1a\u4e22\u5931\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1","title":"\u6848\u4f8b1","text":"<pre><code>\u521b\u5efatest\u7528\u6237\u53ea\u7ed9\u4e00\u4e2aget\u547d\u4ee4\u6743\u9650\u3001\u8bfb\u6743\u9650\u3001\u5e76\u4e14\u53ea\u80fdget\u662fname\u5f00\u5934\u7684key: name*\n\u4f7f\u7528default\u9ed8\u8ba4\u7528\u6237\u767b\u5f55redis\uff1a\n# redis-cli -a redispwd\n&gt; set name1 n1\n&gt; set name2 n2\n&gt; set name3 n3\n&gt;set k1 v1\n&gt;set k2 v2\n&gt;ACL SETUSER test on &gt;testpwd ~name* +get               #\u521b\u5efatest\u7528\u6237\uff0c\u5bc6\u7801\uff1atestpwd   \u8d4b\u7ed9get\u547d\u4ee4\u7684\u6743\u9650\uff0c\u53ea\u5bf9name\u5f00\u5934\u7684\u6709get\u6743\u9650\n&gt;ACL SETUSER test on &gt;testpwd ~name* +@read           #\u7ed9test\u7528\u6237\u589e\u52a0read\u6743\u9650\uff0c\u8bbe\u7f6e\u53ea\u5bf9name\u5f00\u5934\u7684key\u6709read\u6743\u9650\n&gt;ACL getuser test                                                        #\u67e5\u770btest\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\n\n&gt;ACL SETUSER t1 on &gt;t1pwd ~* +get                           #\u5bf9\u6240\u6709key\u90fd\u6709get\u6743\u9650\n&gt;ACL SETUSER t1 on &gt;t1pwd ~* +@read                      #\u5bf9\u6240\u6709key\u90fd\u6709read\u6743\u9650\n&gt;ACL getuser t1\n\n\u8ba4\u8bc1\u767b\u5f55\uff0c\u9a8c\u8bc1\u6743\u9650:\n&gt;auth test testpwd\n# redis-cli --user test --pass testpwd\n\n&gt;get name1\n\"n1\"\n&gt;get name2\n\"n2\"\n&gt;get k1\n(error) NOPERM this user has no permissions to access one of the keys used as arguments\n&gt;set k3 v3\n(error) NOPERM this user has no permissions to run the 'set' command or its subcommand\n\n\n3).\u5e38\u7528\u6743\u9650\u6848\u4f8b\uff1a\n\u6848\u4f8b1:\u521b\u5efa\u7528\u6237\u8d4b\u7ed9\u6240\u6709\u6743\u9650\uff1a              \n&gt;ACL SETUSER test1 on &gt;test1pwd ~* +@all               #\u7528\u6237\u540d:test1  \u5bc6\u7801:test1pwd\n&gt; ACL GETUSER test1                                                #\u67e5\u770btest1\u7528\u6237\u7684\u6240\u6709\u6743\u9650\n\n\u9a8c\u8bc1\u6743\u9650:\n&gt; auth test1 test1pwd\n&gt; keys *\n1) \"name1\"\n2) \"k1\"\n3) \"k2\"\n4) \"name2\"\n5) \"name3\"\n&gt; get name1\n\"n1\"\n&gt; get k1                                                                    #get\u6743\u9650\n\"v1\"\n&gt; set a b                                                                  #set\u6743\u9650\n&gt; get a\n\"b\"\n&gt; config get requirepass                                            #config\u914d\u7f6e\u6743\u9650\n1) \"requirepass\"\n2) \"redispwd\"\n&gt; ACL SETUSER t666 on &gt;t666pwd ~* +@all -config     #\u521b\u5efa\u7528\u6237\u7684\u6743\u9650\n&gt; acl getuser t666                                                     #\u67e5\u770b\u7528\u6237\u6743\u9650\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2","title":"\u6848\u4f8b2","text":"<pre><code>\u6848\u4f8b2:\u53bb\u9664config\u547d\u4ee4\u540e\u7684\u6240\u6709\u6743\u9650:       \n&gt;ACL SETUSER test2 on &gt;test2pwd ~* +@all -config     #\u7528\u6237\u540d:test2  \u5bc6\u7801:test2pwd\n&gt;ACL GETUSER test2                                                 #\u67e5\u770btest2\u7528\u6237\u9664\u4e86config\u547d\u4ee4\u6743\u9650\u4e4b\u5916\u7684\u6240\u6709\u6743\u9650\n\n\u9a8c\u8bc1\u6743\u9650:\n&gt; auth test2 test2pwd\n&gt; config get requirepass                            #\u6ca1\u6709config\u6743\u9650\n(error) NOPERM this user has no permissions to run the 'config' command or its subcommand\n&gt; keys *\n1) \"name1\"\n2) \"k1\"\n3) \"a\"\n4) \"k2\"\n5) \"name2\"\n6) \"name3\"\n&gt; get name1\n\"n1\"\n&gt; set a2 b2\n&gt; get a2\n\"b2\"\n&gt; ACL SETUSER t777 on &gt;t777pwd ~* +@all      #\u521b\u5efa\u7528\u6237\u7684\u6743\u9650\n&gt; acl getuser t777                                            #\u67e5\u770b\u7528\u6237\u6743\u9650\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#3","title":"\u6848\u4f8b3","text":"<pre><code>\u6848\u4f8b3:\u521b\u5efa\u4e00\u4e2a\u7528\u6237\uff0c\u53ea\u7ed9info\u548cmomitor\u547d\u4ee4\u6743\u9650\uff1a \n&gt;ACL SETUSER monitor on &gt;monitorpwd ~* +info +monitor   #\u7528\u6237\u540d:monitor \u5bc6\u7801:monitorpwd\n\n\u6743\u9650\u8ba4\u8bc1\uff1a\n&gt; auth monitor monitorpwd\n&gt; KEYS *\n(error) NOPERM this user has no permissions to run the 'keys' command or its subcommand\n&gt; get name1\n(error) NOPERM this user has no permissions to run the 'get' command or its subcommand\n&gt; info                                              #\u6709info\u6743\u9650\n# Server\nredis_version:6.2.1\nredis_git_sha1:00000000\nredis_git_dirty:0\nredis_build_id:3bc8e110479b329d\n.....\n&gt; monitor                                      #\u6709monitor\u6743\u9650\n\u963b\u585e\u72b6\u6001\uff0c\u76d1\u63a7redis\n\n\n\u5217\u51fa\u6240\u6709\u7528\u6237:\n# redis-cli -a redispwd                 \n&gt; ACL LIST                                 #\u5217\u51fa\u6240\u6709\u7528\u6237\n\n\u5220\u9664\u7528\u6237:\n&gt; ACL DELUSER t666                   #\u5220\u9664\u7528\u6237t666\n&gt; ACL LIST\n\n\u4f7f\u7528acl\u521b\u5efa\u7528\u6237\u5199\u5165\u914d\u7f6e\u6587\u4ef6\n&gt;config rewrite      #\u91cd\u542fRedis\u7528\u6237\u4fe1\u606f\u624d\u4e0d\u4f1a\u4e22\u5931sh\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#7rediskey","title":"7.redis\u7684\u6162\u65e5\u5fd7\u548ckey\u7684\u6709\u6548\u671f","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#redis_1","title":"\u4e00\u3001redis\u7684\u6162\u65e5\u5fd7","text":"<pre><code>\u95ee\u9898\uff1a\u5982\u679c\u6709\u4eba\u53cd\u9988redis\u6162\uff0c\u5982\u4f55\u8fdb\u884c\u6392\u67e5\uff1f\n\n\u7cfb\u7edf\u8d44\u6e90\u60c5\u51b5\n\u67e5\u770b\u6162\u65e5\u5fd7\u60c5\u51b5\n\n1.\u67e5\u770b\u6162\u65e5\u5fd7\u7684\u9ed8\u8ba4\u914d\u7f6e\n&gt;CONFIG GET slow*                     #\u67e5\u770b\u6162\u65e5\u5fd7\u7684\u914d\u7f6e                  \n1) \"slowlog-max-len\"\n2) \"128\"                                      #\u6700\u591a\u8bb0\u5f55128\u4e2a\n3) \"slowlog-log-slower-than\"\n4) \"10000\"                                  #\u9ed8\u8ba4\u8d85\u8fc710\u6beb\u79d2\u5c31\u4f1a\u8bb0\u5f55\n\n2.\u8bbe\u7f6e\u6162\u65e5\u5fd7\u7684\u65f6\u95f4\u662f1\u6beb\u79d2\uff0c\u67e5\u8be2\u8d85\u8fc71\u6beb\u79d2\u5c31\u4e3a\u6162\u65e5\u5fd7\n&gt;config set slowlog-log-slower-than 1000     #\u8bbe\u7f6e\u6162\u65e5\u5fd7\u7684\u65f6\u95f4\u662f1\u6beb\u79d2,\u67e5\u8be2\u8d85\u8fc71\u6beb\u79d2\u5c31\u4e3a\u6162\u65e5\u5fd7\n&gt; CONFIG GET slow*                                 #\u67e5\u770b\n1) \"slowlog-max-len\"\n2) \"128\"\n3) \"slowlog-log-slower-than\"\n4) \"1000\"                                               #1\u6beb\u79d2\u4e3a\u6162\u65e5\u5fd7\n\n\n3.\u4f7f\u7528Shell\u6279\u91cf\u5199\u5165\u6570\u636e\u5e76\u83b7\u53d6\uff0c\u591a\u5199\u5165\u4e9b\u6570\u636e\uff0c\u65b9\u4fbf\u6211\u4eec\u67e5\u8be2\u6570\u636e\u5927\u7684\u65f6\u5019\u4ea7\u751f\u6162\u65e5\u5fd7\n&gt;flushall\n&gt;for i in $(seq -w 100000);do redis-cli -a redispwd set name${i} test${i}; redis-cli -a redispwd get name${i}; done 2&gt;/dev/null\n\n4.\u4ea7\u751f\u6162\u65e5\u5fd7\n&gt;KEYS *                        #\u67e5\u8be2\u4e00\u6b21\uff0c\u5f53\u64cd\u4f5c\u65f6\u95f4\u5927\u4e8e1\u6beb\u79d2\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u6761\u6162\u65e5\u5fd7\n&gt;KEYS * \n&gt;KEYS * \n....\u53ef\u4ee5\u591a\u67e5\u8be2\u51e0\u6b21\uff0c\u591a\u83b7\u53d6\u51e0\u6761\u6162\u65e5\u5fd7\n\n5.\u67e5\u8be2\u6162\u65e5\u5fd7\n&gt;SLOWLOG get               #\u9ed8\u8ba4\u83b7\u53d6\u6700\u8fd110\u6761\n&gt;SLOWLOG get 5            #\u83b7\u53d65\u6761\n&gt;SLOWLOG len               #\u6162\u65e5\u5fd7\u91cf\uff0c\u67e5\u770b\u6162\u65e5\u5fd7\u7684\u6761\u6570\n&gt;SLOWLOG reset             #\u6e05\u7a7a\u6162\u65e5\u5fd7\n\n6.Slowlog\u5404\u5b57\u6bb5\u610f\u601d\n127.0.0.1:6379&gt; SLOWLOG get\n1) 1) (integer) 115                   #\u6162\u65e5\u5fd7\u7684id\uff0c\u4ece0\u5f00\u59cb\uff0c\u7b2c115\u4e2aid\n   2) (integer) 1668215297        #\u65f6\u95f4\u6233\uff0c\u6162\u65e5\u5fd7\u4ea7\u751f\u7684\u65f6\u95f4\u70b9\uff0c\u53ef\u4ee5\u901a\u8fc7 date -d @1668215297   \u83b7\u53d6\u6162\u65e5\u5fd7\u4ea7\u751f\u7684\u65f6\u95f4\n   3) (integer) 69284                 #\u6162\u65e5\u5fd7\u8fd0\u884c\u7684\u65f6\u95f469\u6beb\u79d2\n   4) 1) \"keys\"                          #\u4ea7\u751f\u6162\u65e5\u5fd7\u7684\u547d\u4ee4\uff0c\u4e00\u822c\u662f\u5f53\u6570\u636e\u91cf\u592a\u591a\u65f6\u5019\uff0c\u8fd0\u884ckeys *\u547d\u4ee4\u4f1a\u6bd4\u8f83\u6162\n      2) \"*\"\n   5) \"127.0.0.1:60014\"\n   6) \"\"\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#rediskey","title":"\u4e8c\u3001Redis\u7684key\u7684\u6709\u6548\u671f","text":"<pre><code>\u7ed9Redis\u7684key\u8bbe\u7f6e\u6709\u6548\u671f,-1\u8868\u793a\u6c38\u4e45,-2\u4ee3\u8868Redis\u56de\u6536\u4e86\uff08key\u5df2\u7ecf\u81ea\u52a8\u5220\u9664)\n&gt;set name test1            #\u9ed8\u8ba4\u8bbe\u7f6e\u7684key\u662f\u6c38\u4e45\u6709\u6548\u7684\n&gt;get name\n\"test1\"\n&gt;ttl name                      #\u67e5\u770bkey\u7684\u72b6\u6001\uff0c\u751f\u547d\u5468\u671f\uff0c-1\u8868\u793a\u6c38\u4e45\u6709\u6548\n(integer) -1\n&gt;expire name 20           #\u65b9\u6cd51: \u7ed9key\u8bbe\u7f6e\u6709\u6548\u671f\uff0c\u5355\u4f4d:\u79d2\uff0c\u8bbe\u7f6e\u6709\u6548\u671f\u662f20s       \n\n&gt;set name2 test02 EX 20       #\u65b9\u6cd52: \u518d\u521b\u5efakey\u65f6\u5019\u76f4\u63a5\u7ed9key\u8bbe\u7f6e\u6709\u6548\u671f:20s\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#8redisredis","title":"8.Redis\u7981\u7528\u5371\u9669\u547d\u4ee4\u548cRedis\u538b\u6d4b\u5de5\u5177","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1redis_2","title":"1.Redis\u7981\u7528\u5371\u9669\u547d\u4ee4","text":"<pre><code>Redis\u5371\u9669\u7684\u547d\u4ee4\u6709\u54ea\u4e9b\uff1f\n&gt;FLUSHALL           \u4f1a\u6e05\u7a7aRedis\u6240\u6709\u6570\u636e\n&gt;FLUSHDB            \u4f1a\u6e05\u9664\u5f53\u524dDB\u6240\u6709\u6570\u636e\n&gt;KEYS *               \u5728\u952e\u8fc7\u591a\u7684\u65f6\u5019\u4f7f\u7528\u4f1a\u963b\u585e\u4e1a\u52a1\u8bf7\u6c42\uff0c\u6bd4\u5982\u6709\u4e0a\u5343\u4e07\u6570\u636e\u65f6\u5019\uff0c\u8be5\u547d\u4ee4\u4f1a\u963b\u585e\u5361\u4f4f\n\nRedis\u7981\u7528\u5371\u9669\u547d\u4ee4\u7684\u914d\u7f6e\n\u7981\u7528\u9700\u8981\u4fee\u6539redis\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u542fredis\n# vi /etc/redis.conf\nrename-command FLUSHALL \"\"\nrename-command FLUSHDB \"\"\nrename-command KEYS \"\"\n\n\u6d4b\u8bd5\u547d\u4ee4\u662f\u5426\u5931\u6548\n&gt;keys *\n\u53d1\u73b0\u8fd0\u884c\u4e0d\u4e86\n&gt;flushall \n\u8fd0\u884c\u4e0d\u4e86\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2redis_2","title":"2.Redis\u538b\u6d4b\u5de5\u5177","text":"<pre><code># redis-benchmark --help\n-c &lt;clients&gt;       Number of parallel connections (default 50)             #\u9ed8\u8ba4\u7684\u5e76\u53d1\u662f50\u4e2a\n-n &lt;requests&gt;      Total number of requests (default 100000)            #\u9ed8\u8ba4\u670910\u4e07\u4e2a\u8bf7\u6c42\n\u538b\u6d4b\u5de5\u5177\uff0c\u57fa\u672c\u5bf9redis\u91cc\u7684\u6bcf\u4e00\u4e2a\u547d\u4ee4\u90fd\u4f1a\u8fdb\u884c\u6d4b\u8bd5\u4e00\u904d\uff0c\n# redis-benchmark -a redispwd                                                     #\u7528\u9ed8\u8ba4\u7684\u5e76\u53d150\u4e2a\uff0c\u4e00\u517110\u4e07\u4e2a\u8bf7\u6c42\u5bf9redis\u8fdb\u884c\u538b\u6d4b\n# redis-benchmark -a redispwd | tee /tmp/a.log                              #\u5c06\u6d4b\u8bd5\u7684\u7ed3\u679c\u8f93\u51fa\u5230\u4e00\u4e2alog\u6587\u4ef6\n\n\u65e5\u5e38\u8f93\u51fa\u7684\u4e00\u4e2a\u7b80\u4ecb\n# vim /tmp/a.log\nPING_INLINE:                                                                      #\u6d4b\u8bd5PING\n  100000 requests completed in 1.10 seconds                          #\u4e00\u5171\u5904\u7406\u4e8610\u4e07\u4e2aPING\u8bf7\u6c42\uff0c\u57281.1\u79d2\u4e2d\u5b8c\u6210\n  50 parallel clients                                                              # 50\u4e2a\u5e76\u53d1\n  3 bytes payload                                                                 #\u6bcf\u4e2a\u8bf7\u6c42\u6570\u636e\u91cf\u662f3\u4e2a\u5b57\u8282\n  ......\n100.000% &lt;= 2.527 milliseconds (cumulative count 100000)    #\u6d4b\u8bd5PING\u7684\u4e00\u4e2a\u5ef6\u65f6\uff0c&lt;2.5\u6beb\u79d2\u7684\u6709100%\n\nSET:                                                                                   #\u6d4b\u8bd5SET\u547d\u4ee4\n  100000 requests completed in 1.07 seconds                         #\u4e00\u5171\u6267\u884c\u4e8610\u4e07\u6b21SET\u64cd\u4f5c\uff0c\u57281.07\u79d2\u4e2d\u5b8c\u6210\n  50 parallel clients                                                              #50\u4e2a\u5e76\u53d1\n  3 bytes payload                                                                #\u6bcf\u4e2a\u8bf7\u6c42\u6570\u636e\u91cf\u662f3\u4e2a\u5b57\u8282  \n  ......\n23.353% &lt;= 0.207 milliseconds (cumulative count 23353)       #%23.353\u7684\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5c0f\u4e8e0.207\u6beb\u79d2\n69.820% &lt;= 0.303 milliseconds (cumulative count 69820)       #%69.820\u7684\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5c0f\u4e8e0.303\u6beb\u79d2\n100.000% &lt;= 2.183 milliseconds (cumulative count 100000)    #%100\u7684\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5c0f\u4e8e2.183\u6beb\u79d2\nSummary:\n  throughput summary: 93370.68 requests per second             #redis\u6bcf\u79d2\u53ef\u4ee5\u5904\u740693370.68\u6b21set\u8bf7\u6c42\n  latency summary (msec):\n          avg       min       p50       p95       p99       max\n        0.302     0.072     0.247     0.599     1.111     2.183\n\nGET:                                                                                 #\u6d4b\u8bd5GET\u547d\u4ee4\n  100000 requests completed in 1.12 seconds                        #\u4e00\u5171\u6267\u884c\u4e8610\u4e07\u6b21GET\u64cd\u4f5c\uff0c\u57281.12\u79d2\u4e2d\u5b8c\u6210\n  50 parallel clients                                                              #50\u4e2a\u5e76\u53d1\n  3 bytes payload                                                                #\u6bcf\u4e2a\u8bf7\u6c42\u6570\u636e\u91cf\u662f3\u4e2a\u5b57\u8282 \n  ......\n50.000% &lt;= 0.255 milliseconds (cumulative count 52277)        #%50\u7684\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5c0f\u4e8e0.255\u6beb\u79d2\n75.000% &lt;= 0.375 milliseconds (cumulative count 75710)        #%75\u7684\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5c0f\u4e8e0.375\u6beb\u79d2\n100.000% &lt;= 2.447 milliseconds (cumulative count 100000)     #%100\u7684\u547d\u4ee4\u6267\u884c\u65f6\u95f4\u5c0f\u4e8e2.447\u6beb\u79d2\nSummary:\n  throughput summary: 89445.44 requests per second               #redis\u6bcf\u79d2\u53ef\u4ee5\u5904\u740689445.44\u6b21get\u8bf7\u6c42    \n  latency summary (msec):\n          avg       min       p50       p95       p99       max\n        0.326     0.048     0.255     0.687     1.311     2.447\n\n...\u6d4b\u8bd5\u6bcf\u4e00\u4e2a\u547d\u4ee4\uff0c\u6700\u7ec8\u7ed9\u4e00\u4e2a\u7ed3\u679c\uff1a\n\n\n# redis-benchmark -a redispwd -n 10                 #\u7528\u9ed8\u8ba4\u7684\u5e76\u53d150\u4e2a\uff0c\u4e00\u517110\u4e2a\u8bf7\u6c42\u5bf9redis\u8fdb\u884c\u538b\u6d4b\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#9redis","title":"9.Redis\u6301\u4e45\u5316\u5b58\u50a8\u7684\u4e24\u79cd\u65b9\u5f0f","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1redis_3","title":"1.Redis\u6301\u4e45\u5316\u5b58\u50a8\u7684\u4e24\u79cd\u65b9\u5f0f","text":"<pre><code>RDB\u65b9\u5f0f   RDB\u5b58\u50a8\u662fRedis\u5b9e\u73b0\u7684\u4e00\u79cd\u5b58\u50a8\u673a\u5236     (\u9ed8\u8ba4\u5f00\u542f)\nAOF\u65b9\u5f0f    AOF\u5b58\u50a8\u65b9\u5f0f\uff0c\u76f4\u63a5\u628a\u64cd\u4f5c\u7684\u547d\u4ee4\u8bb0\u5f55\u4e0b\u6765\uff0c\u4fdd\u5b58\u5230\u4e00\u4e2a\u6587\u4ef6\u91cc\uff0c\u7c7b\u4f3cmysql\u7684binlog\u65e5\u5fd7 (\u9ed8\u8ba4\u5173\u95ed)\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2redisrdb","title":"2.Redis\u7684RDB\u6301\u4e45\u5316\u5b58\u50a8","text":"<pre><code>Redis\u9ed8\u8ba4\u662f\u5f00\u542f\u4e86RDB\u5feb\u7167\u65b9\u5f0f\uff0c\u63d0\u4f9b\u6301\u4e45\u5316\u5b58\u50a8\u7684\u529f\u80fd\n\u5982\u679c\u53ea\u8ba9Redis\u505a\u7f13\u5b58\u7684\u670d\u52a1\uff0c\u4e0d\u9700\u8981\u6301\u4e45\u5316\u65f6\u5019\uff0c\u4e5f\u53ef\u4ee5\u5173\u95ed\u6240\u6709\u5b58\u50a8\u529f\u80fd\n</code></pre> <pre><code>Redis\u7684RDB\u5b58\u50a8\u65b9\u5f0f\u7684\u914d\u7f6e\uff0c\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\n&gt;config get dir                        #\u67e5\u770b\u5b58\u50a8\u8bbe\u7f6e\u7684\u8def\u5f84\n1) \"dir\"\n2) \"/data/redis\"\n&gt;config get dbfilename           #\u67e5\u770brdb\u5b58\u50a8\u7684\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u662fdump.rdb\u6587\u4ef6   \n1) \"dbfilename\"\n2) \"dump.rdb\"                      #\u8be5\u6587\u4ef6\u53ef\u4ee5\u4fdd\u8bc1redis\u7684\u6570\u636e\u4e0d\u4e22\u5931\n\n# ls /data/redis/\ndump.rdb  redis.log  redis.pid\n\n&gt;config get save                   #\u67e5\u770brdb\u9ed8\u8ba4\u7684\u5b58\u50a8\u673a\u5236\u914d\u7f6e\n3600 1 300 100 60 10000      #3600s(1\u4e2a\u5c0f\u65f6)   1(key\u7684\u4e00\u4e2a\u53d8\u5316)     300s(5\u5206\u949f)  100(key\u7684\u53d8\u5316)    60s(1\u5206\u949f)  10000(key\u7684\u53d8\u5316)\nkey\u7684\u53d8\u5316\u8d8a\u5feb\uff0c\u4fdd\u5b58\u7684\u5c31\u8d8a\u9891\u7e41\u3002 60s\u4e2d key\u53d8\u5316\u4e8610000\u4e2a\uff0c\u90a3\u4e48\u62111\u5206\u949f\u5c31\u4f1a\u7ed9\u4f60\u5b58\u4e0a\uff0c 1\u5c0f\u65f6\u624d\u53d8\u5316\u4e00\u4e2akey\uff0c\u5c311\u5c0f\u65f6\u7ed9\u4f60\u5b58\u4e00\u6b21\n\u66f4\u65b0\u5f97\u8d8a\u9891\u7e41\uff0c\u4fdd\u5b58\u5f97\u8d8a\u9891\u7e41\u3002\u53e6\u5916\uff0c\u5173\u95edredis\u670d\u52a1\u5668\u4f1a\u7acb\u9a6c\u89e6\u53d1rdb\u5b58\u50a8  \n\n\u9a8c\u8bc1\u4e00\u4e0brdb\u6301\u4e45\u5316\u5b58\u50a8\uff1a\n# redis-cli -a redispwd                                                      #\u767b\u5f55redis\u5148\u8bbe\u7f6e\u4e00\u4e9b\u6570\u636e\n&gt; set k1 v1\n&gt; set k2 v2\n&gt; set k3 v3\n&gt; keys *\n1) \"k3\"\n2) \"k2\"\n3) \"k1\"\n&gt; quit \n# ls /data/redis/\ndump.rdb  redis.log  redis.pid\n\n# systemctl stop redis                                                   #\u505c\u6b62redis\uff0c\u5c06\u6301\u4e45\u5316\u5b58\u50a8\u6587\u4ef6\u6a21\u62df\u5220\u9664\n# mv /data/redis/dump.rdb /data/redis/dump.rdb.bak\n# ls /data/redis/\ndump.rdb.bak  redis.log\n# systemctl start redis                                                 #\u518d\u91cd\u65b0\u542f\u52a8redis\n# redis-cli -a redispwd                                                 #\u53d1\u73b0\u6301\u4e45\u5316\u6570\u636e\u6587\u4ef6\u5220\u9664\u540e\uff0c\u6570\u636e\u4e22\u5931\n&gt; keys *\n(empty array)\n&gt; quit\n\u6062\u590d\u6570\u636e:\n# systemctl stop redis\n# mv /data/redis/dump.rdb.bak /data/redis/dump.rdb\n# systemctl start redis\n# redis-cli -a redispwd\n&gt; keys *\n1) \"k3\"\n2) \"k1\"\n3) \"k2\"\n\n\u8bbe\u7f6e\u5173\u95edrdb\uff1a\u9700\u8981\u5148\u5220\u9664dump.rdb\u6587\u4ef6\n&gt;config set save \"\"                       #\u5173\u95edrdb\u5feb\u7167\u6301\u4e45\u5316\u5b58\u50a8,\u6d4b\u8bd5\u7684\u4e0d\u597d\u4f7f\n&gt;config get save                          #\u67e5\u770b\n&gt;config rewrite                            #\u5199\u5165\u914d\u7f6e\u6587\u4ef6\uff0c\u6c38\u4e45\u8bbe\u7f6e                           \n&gt;config set rdbcompression no      #rdb\u6587\u4ef6\u9700\u4e0d\u9700\u8981\u538b\u7f29\uff0c\u5f53\u78c1\u76d8\u7a7a\u95f4\u6bd4\u8f83\u5927\u65f6\u5019\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e0d\u7528\u538b\u7f29\n\n\u901a\u8fc7\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u5173\u95edrdb\u6301\u4e45\u5316:  \n# vi /etc/redis.conf\nsave \"\"                                      #\u6dfb\u52a0\n#\u6ce8\u91ca\u4e0b\u9762\u7684\uff1a\n#save 3600 1\n#save 300 100\n#save 60 10000\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#rdb","title":"\u6848\u4f8b\uff1a\u5173\u95edrdb\u6301\u4e45\u5316","text":"<pre><code># rm -f /data/redis/dump.rdb         #\u5148\u5220\u9664rdb\u5feb\u7167\u6587\u4ef6\uff0c\u5426\u5219\u5373\u4f7f\u5173\u95ed\u6301\u4e45\u5316\uff0c\u8fd8\u4f1a\u901a\u8fc7\u5feb\u7167\u7ed9\u8fd8\u539f\u8fc7\u6765\n# vim /etc/redis.conf\nsave \"\"                                        #\u6dfb\u52a0\uff0c\u5173\u95ed\u6301\u4e45\u5316\n# systemctl restart redis                #\u91cd\u542fredis\n# redis-cli -a redispwd\n&gt; CONFIG GET save                     #\u67e5\u770brdb\u6301\u4e45\u5316\u914d\u7f6e\u4e3a\u7a7a\n1) \"save\"\n2) \"\"\n&gt; set k11 v11                              #\u589e\u52a0\u51e0\u4e2akey\u7684\u6570\u636e\n&gt; set k12 v12\n&gt; keys *                                      #\u67e5\u770bkey\n1) \"k12\"\n2) \"k11\"\n&gt; quit\n# systemctl restart redis               #\u91cd\u542fredis\n# redis-cli -a redispwd                  #\u91cd\u65b0\u767b\u5f55redis\uff0c\u53d1\u73b0\u91cd\u542f\u540e\u6570\u636e\u4e22\u5931\n&gt; keys *    \n(empty array)\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#3redisaof","title":"3.Redis\u7684AOF\u6301\u4e45\u5316\u5b58\u50a8","text":"<pre><code>AOF\u5b58\u50a8\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\nAOF\u5b58\u50a8\u662f\u628a\u547d\u4ee4\u76f4\u63a5\u5199\u5165\u5230\u6587\u4ef6\u4e2d\uff0c\u6587\u4ef6\u4f1a\u4e0d\u65ad\u6269\u5927\n\n1).\u5f00\u542fAOF\u524d\u5148\u5173\u95edRDB\uff08\u4e00\u822c\u5efa\u8bae\u5173\u95ed\uff0c\u6301\u4e45\u5316\u5b58\u50a8\u7528\u5176\u4e2d\u4e00\u79cd\u5c31\u884c)\uff0c\u4e5f\u80fd\u540c\u65f6\u914d\u7f6e\uff0c\u540c\u65f6\u914d\u7f6eAOF\u4f18\u5148\u751f\u6548\n# vim /etc/redis.conf\nsave \"\"                                            #\u6dfb\u52a0\n#\u6ce8\u91ca\u4e0b\u9762\u7684\uff1a\n#save 3600 1\n#save 300 100\n#save 60 10000\n# systemctl restart redis\n2).\u5f00\u542fAOF\u5b58\u50a8\u65b9\u5f0f:\n&gt;config get append*                        #\u67e5\u770bAOF\u72b6\u6001\uff0c\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\n1) \"appendonly\"\n2) \"no\"\n&gt;config set appendonly yes               #\u5f00\u542fAOF\u5b58\u50a8\n&gt;config rewrite                                #\u5199\u5165\u914d\u7f6e\u6587\u4ef6\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#aof","title":"\u6848\u4f8b\uff1a\u5f00\u542fAOF\u5b58\u50a8\u65b9\u5f0f\u6301\u4e45\u5316\u5b58\u50a8","text":"<pre><code>&gt;config get append*                        #\u67e5\u770bAOF\u72b6\u6001\uff0c\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\n1) \"appendonly\"\n2) \"no\"\n3) \"appendfilename\"\n4) \"appendonly.aof\"\n5) \"appendfsync\"\n6) \"everysec\"\n&gt;config set appendonly yes               #\u5f00\u542fAOF\u5b58\u50a8\n&gt;config rewrite                                #\u5199\u5165\u914d\u7f6e\u6587\u4ef6\n# grep appendonly /etc/redis.conf      #\u67e5\u770bredis\u914d\u7f6e\u6587\u4ef6\nappendonly yes\nappendfilename \"appendonly.aof\"\n# ls /data/redis/appendonly.aof         #\u67e5\u770bAOF\u6587\u4ef6\u7684\u8def\u5f84\n/data/redis/appendonly.aof\n# redis-cli -a redispwd                     #\u767b\u5f55redis\u5199\u5165\u6d4b\u8bd5\u6570\u636e\n&gt; set a1 b1\n&gt; set a2 b2\n&gt; keys *\n1) \"a2\"\n2) \"a1\"\n# tail -12 /data/redis/appendonly.aof    #\u67e5\u770bAOF\u6587\u4ef6\u8bb0\u5f55\u7684\u547d\u4ee4\nset\n$2\na1\n$2\nb1\n*3\n$3\nset\n$2\na2\n$2\nb2\n# systemctl restart redis                        #\u91cd\u542fredis\n# redis-cli -a redispwd                           #\u91cd\u65b0\u767b\u5f55redis\uff0c\u6570\u636e\u8fd8\u5728\uff0c\u6570\u636e\u6301\u4e45\u5316\u6ca1\u95ee\u9898\n&gt; keys *\n1) \"a1\"\n2) \"a2\"\n&gt; get a1\n\"b1\"\n\n3).AOF\u5b58\u50a8\u662f\u628a\u547d\u4ee4\u76f4\u63a5\u5199\u5165\u5230\u6587\u4ef6\u4e2d\uff0c\u6587\u4ef6\u4f1a\u4e0d\u65ad\u6269\u5927\n&gt;set a b\n&gt;set a b\n...\n#ll /data/redis/appendonly.aof              #\u6587\u4ef6\u662f\u4e00\u76f4\u5728\u589e\u5927\u7684\n\n4).AOF\u6587\u4ef6\u7684\u91cd\u5199\n\u5f53AOF\u6587\u4ef6\u589e\u5927\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4ed6\u8fdb\u884c\u91cd\u5199\uff0c\u91cd\u5199AOF\u6587\u4ef6\u53ef\u4ee5\u51cf\u5c0fAOF\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u6570\u636e\u4e0d\u4f1a\u51cf\u5c11\n\n5).\u91cd\u5199\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a\u624b\u52a8\u91cd\u5199\u548c\u81ea\u52a8\u91cd\u5199\n\u624b\u52a8\u91cd\u5199\uff1a\n&gt; BGREWRITEAOF                               #\u624b\u52a8\u91cd\u5199AOF\u6587\u4ef6\uff0c\u91cd\u5199\u540eAOF\u6587\u4ef6\u4f1a\u51cf\u5c0f\n\n\u81ea\u52a8\u91cd\u5199\uff1a\n&gt; config get *aof*                               #\u67e5\u770b\u81ea\u52a8\u91cd\u5199AOF\u6587\u4ef6\u7684\u6761\u4ef6\uff0c\u91cd\u5199\u540eAOF\u6587\u4ef6\u4f1a\u51cf\u5c0f\n 1) \"aof-rewrite-incremental-fsync\"\n 2) \"yes\"\n 3) \"aof-load-truncated\"\n 4) \"yes\"\n 5) \"aof-use-rdb-preamble\"\n 6) \"yes\"\n 7) \"aof_rewrite_cpulist\"\n 8) \"\"\n 9) \"auto-aof-rewrite-percentage\"\n10) \"100\"                                         #\u5f53\u8fbe\u5230100%\u589e\u91cf\u7684\u65f6\u5019\u4f1a\u89e6\u53d1AOF\u91cd\u5199\n11) \"auto-aof-rewrite-min-size\"\n12) \"67108864\"                                 #AOF\u6587\u4ef6&gt;67M\u65f6\u5019\u89e6\u53d1AOF\u91cd\u5199\n13) \"replicaof\"\n14) \"\"\n\u81ea\u52a8\u91cd\u5199\u7684\u6761\u4ef6\uff1a\u91cd\u5199\u6761\u4ef6\u662faof\u6587\u4ef6\u5927\u5c0f&gt;67M\uff0caof\u6587\u4ef6\u589e\u5927\u4e86\u4e00\u500d\n\n\n\u6848\u4f8b\u6f14\u793a\uff1a \u624b\u52a8\u91cd\u5199\n# ls -l /data/redis/appendonly*         #\u5148\u67e5\u770b\u4e00\u4e0bAOF\u6587\u4ef6\u7684\u5927\u5c0f\n# redis-cli -a redispwd                     #\u767b\u5f55\u4e0bredis\uff0c\u624b\u52a8\u89e6\u53d1\u91cd\u5199\n&gt; BGREWRITEAOF                          #\u624b\u52a8\u91cd\u5199AOF\u6587\u4ef6\n# ls -l /data/redis/appendonly*         #\u518d\u67e5\u770b\u4e00\u4e0bAOF\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u53d1\u73b0\u4f1a\u51cf\u5c0f\n\n\n\u6848\u4f8b\u6f14\u793a\uff1a \u81ea\u52a8\u91cd\u5199\n# ls -lh /data/redis/appendonly*        #\u5148\u67e5\u770b\u4e00\u4e0bAOF\u6587\u4ef6\u7684\u5927\u5c0f\n\u521a\u5f00\u59cb\u6bd4\u8f83\u5c0f\n# redis-benchmark -a redispwd         #\u4f7f\u7528\u538b\u6d4b\u5de5\u5177\u89e6\u53d1\u5199\u5165\u6570\u636e\uff0c\u4f7fAOF\u6587\u4ef6\u589esh\u5927    \n# ls -lh /data/redis/appendonly*        #\u4e0d\u65ad\u67e5\u770bAOF\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u53d1\u73b0\u9010\u6e10\u589e\u5927\uff0c\u5f53&gt;67M\u540e\uff0c\u4f1a\u53d8\u5c0f\uff0c\u8bf4\u660e\u8fbe\u5230\u89e6\u53d1\u6761\u4ef6\u540e\uff0c\u8fdb\u884c\u4e86\u81ea\u52a8\u91cd\u5199\n# ls -lh /data/redis/appendonly*\n# ......\n\n\n\u6ce8\u610f:\u81ea\u52a8\u89e6\u53d1\u91cd\u5199  \u5728\u4e1a\u52a1\u9ad8\u5cf0\u538b\u529b\u5927\uff0c\u5982\u679c\u91c7\u7528\u81ea\u52a8\u89e6\u53d1\u91cd\u5199\uff0c\u6709\u53ef\u80fd\u4f1a\u5f71\u54cd\u4e1a\u52a1\uff0c\u53ef\u9009\u62e9\u5728\u538b\u529b\u5c0f\u7684\u65f6\u5019\u811a\u672c\u8fd0\u884cBGREWRITEAOF\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#10redisrdbkey","title":"10.\u4f7f\u7528redis\u7684RDB\u5de5\u5177\u5206\u6790key\u7684\u5927\u5c0f","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1rediskeybigkey","title":"1.\u4ec0\u4e48\u662fRedis\u7684\u5927key\uff1f\uff08BigKey\uff09","text":"<pre><code>1.\u4ec0\u4e48\u662fRedis\u7684\u5927key\uff1f\uff08BigKey\uff09\nredis\u5b58\u50a8\u6570\u636e\u7684\u65f6\u5019\uff0c\u5f53\u67d0\u4e2akey\u7684\u503c\u6bd4\u8f83\u5927\uff08\u5305\u62ec\u5b57\u7b26\u4e32\u3001\u5217\u8868\u7b49\u6570\u636e\u7c7b\u578b\uff09\uff0ckey\u7684\u6570\u636e\u8d8a\u5927\uff0c\u5360\u7528\u7684\u5185\u5b58\u548c\u7a7a\u95f4\u5c31\u8d8a\u591a\u3002\nBigKey\uff08\u5927key\uff09\nBigkey\u6307\u7684\u662fredis\u4e2d\u4e00\u4e9bkey value\u503c\u5f88\u5927,\u8fd9\u4e9bkey\u5728\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u82b1\u8d39\u7684\u65f6\u95f4\u5f88\u5927!\n      \u64cd\u4f5cbigkey\u7684\u901a\u5e38\u6bd4\u8f83\u8017\u65f6\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u963b\u585eRedis\u53ef\u80fd\u6027\u8d8a\u5927!\u5360\u7528\u7684\u6d41\u91cf\u540c\u65f6\u4e5f\u4f1a\u53d8\u5f97\u5f88\u5927!\n      \u5927\u767d\u8bdd\u5c31\u662f\uff1abigkey\u5b9e\u9645\u6307\u4e00\u4e2akey\u5bf9\u5e94\u7684value\u5f88\u5927,\u5360\u7528\u7684\u7a7a\u95f4\u5f88\u5927!\nstring\u7c7b\u578b\u7684\u6570\u636e\uff1a   \u957f\u5ea6\u5927\u4e8e10K\uff0c\u8ba4\u4e3a\u662f\u5927key\nlist\u5217\u8868\u7c7b\u578b\u7684\u6570\u636e\uff1a \u957f\u5ea6\u5927\u4e8e10240\uff0c\u8ba4\u4e3a\u662f\u5927key\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2key","title":"2.\u5236\u9020\u4e24\u4e2a\u4e0d\u540c\u6570\u636e\u7c7b\u578b\u7684\u5927key","text":"<pre><code>\u6279\u91cf\u5199\u51651\u4e07\u4e2akey\uff0c\u4e3a\u4e86\u9a8c\u8bc1\u4e00\u4e0b\u666e\u901akey\u548c\u5927key\u5360\u7528\u5185\u5b58\u7684\u60c5\u51b5\uff0c\u6570\u636e\u91cf\u5c0f\u7684\u65f6\u5019\uff0c\u4e0d\u597d\u5bf9\u6bd4\nfor i in $(seq -w 10000);do redis-cli -a redispwd set name${i} test${i}; redis-cli -a redispwd get name${i}; done 2&gt;/dev/null\n\n\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u5927key\uff1a                      #\u5236\u9020\u4e00\u4e2a\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u5927key\n&gt; set k1 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\n\u5217\u8868\u7c7b\u578b\u7684\u5927key:                             #\u5236\u9020\u4e00\u4e2a\u5217\u8868\u7c7b\u578b\u7684\u5927key\n&gt; LPUSH name yyyyyyyy\n&gt; LPUSH name yyyyyyyy\n&gt; LPUSH name yyyyyyyy\n&gt; LPUSH name yyyyyyyy\n&gt; LPUSH name yyyyyyyy\n&gt; LPUSH name yyyyyyyy\n&gt; LPUSH name yyyyyyyy\n....\n\u5217\u8868\u5de6\u8fb9\u6dfb\u52a0\u5143\u7d20\uff0c\u591a\u6dfb\u52a0\u4e00\u4e9b\n\n&gt; keys *\n1) \"name\"\n2) \"k1\"\n3) \"namexxx\"\n......\n\n127.0.0.1:6379&gt; LLEN name\n(integer) 15\n127.0.0.1:6379&gt; LRANGE name 0 -1\n 1) \"yyyyyyyy\"\n 2) \"yyyyyyyy\"\n 3) \"yyyyyyyy\"\n 4) \"yyyyyyyy\"\n 5) \"yyyyyyyy\"\n 6) \"yyyyyyyy\"\n 7) \"yyyyyyyy\"\n 8) \"yyyyyyyy\"\n 9) \"yyyyyyyy\"\n10) \"yyyyyyyy\"\n11) \"yyyyyyyy\"\n12) \"yyyyyyyy\"\n13) \"yyyyyyyy\"\n14) \"yyyyyyyy\"\n15) \"yyyyyyyy\"\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#3key","title":"3.\u626b\u63cf\u548c\u5206\u6790\u5927key","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1_1","title":"\u65b9\u6cd51\uff1a","text":"<pre><code># redis-cli -a redispwd --bigkeys                                                                #\u626b\u63cf\u548c\u5206\u6790redis\u7684\u5927key\u5de5\u5177\n....\n[00.00%] Biggest string found so far '\"name07194\"' with 9 bytes\n[14.78%] Biggest list   found so far '\"name\"' with 15 items\n[83.13%] Biggest string found so far '\"k1\"' with 216 bytes\n...\n-------- summary -------\nSampled 10002 keys in the keyspace!\nTotal key length in bytes is 90006 (avg len 9.00)\nBiggest   list found '\"name\"' has 15 items\nBiggest string found '\"k1\"' has 216 bytes\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2_1","title":"\u65b9\u6cd52\uff1a","text":"<pre><code>\u4f7f\u7528rdb\u5de5\u5177\u5206\u6790\u5927key\uff08\u662f\u901a\u8fc7dump.rdb\u6587\u4ef6\u8fdb\u884c\u5206\u6790\u7684\uff09\nrdb\u5206\u6790\u6240\u6709key\u5927\u5c0f\uff0c\u5efa\u8bae\u62f7\u8d1d\u5230\u95f2\u7f6e\u7684\u670d\u52a1\u5668\u8fdb\u884c\u5206\u6790\n# yum -y install python36                                                                         #\u9700\u8981\u4f9d\u8d56python\u73af\u5883\n# pip3 install rdbtools==0.1.15 -i https://mirrors.aliyun.com/pypi/simple/       #\u5b89\u88c5rdb\u5de5\u5177\n#  rdb -c memory /data/redis/dump.rdb &gt;/tmp/test.csv     #\u4f7f\u7528rdb\u5de5\u5177\u5206\u6790\u5927key\u5e76\u628a\u7ed3\u679c\u8f93\u51fa\u5230\u4e00\u4e2a\u6587\u4ef6\u91cc\uff0c\u6307\u5b9ardb\u6587\u4ef6\n\u6709\u4e00\u4e2a\u8b66\u544a\uff0c\u53ef\u4ee5\u5ffd\u7565\n# cat /tmp/test.csv |head -5                                                                    #\u67e5\u770b\u6587\u4ef6\uff0c\u4e3b\u8981\u5173\u5fc3\u7684\u662fkey\u548c\u5927\u5c0f\ndatabase,type,key,size_in_bytes,encoding,num_elements,len_largest_element,expiry\n0,string,name05565,72,string,9,9,\n0,string,name07617,72,string,9,9,\n0,string,name07090,72,string,9,9,\n0,string,name03368,72,string,9,9,\n\n\u5927\u5c0f\u6392\u5e8f\n# cat /tmp/test.csv |sort -nrk 4 -t ',' |head -5         \n0,list,name,289,quicklist,15,8,\n0,string,k1,272,string,216,216,\n0,string,name10000,72,string,9,9,\n0,string,name09999,72,string,9,9,\n0,string,name09998,72,string,9,9,\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#4keykey","title":"4.\u5220\u9664\u5927key\uff0c\u89c2\u5bdf\u6027\u80fd\u5206\u6790\uff0c\u5360\u7528\u5185\u5b58\u5927\u7684key\u5df2\u7ecf\u6d88\u5931","text":"<pre><code>&gt; DEL k1\n\u7528\u5206\u6790\u5de5\u5177\u67e5\u770b\uff0c\u8be5\u5927key\u5df2\u7ecf\u4e0d\u663e\u793a\n\n# redis-cli -a redispwd --bigkeys\n...\n[00.00%] Biggest string found so far '\"name07052\"' with 9 bytes\n[28.76%] Biggest list   found so far '\"name\"' with 15 items\n\u53d1\u73b0\u5360\u7528\u5185\u5b58\u5927\u7684k1\u5df2\u7ecf\u6d88\u5931\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#11redis","title":"11.redis\u4e3b\u4ece\u590d\u5236","text":"<pre><code>1.Redis\u5355\u53f0\u670d\u52a1\u5668\u65f6\u7684\u7f3a\u70b9\n\u5982\u679c\u6301\u4e45\u5316\uff0c\u5355\u53f0\u6570\u636e\u6709\u4e22\u5931\u98ce\u9669\n\u8bfb\u5199\u538b\u529b\u90fd\u96c6\u4e2d\u5728\u4e00\u53f0\u4e0a\n\n2.Redis\u7684\u4e3b\u4ece\u590d\u5236\u6982\u5ff5\nRedis\u7684\u4e3b\u4ece\u5c31\u662f\u591a\u53f0Redis\u6570\u636e\u4e00\u81f4\n\u4e3b\u670d\u52a1\u5668\u53ef\u7528\u6765\u5199\u5165\u548c\u8bfb\u53d6\uff0c\u4ece\u670d\u52a1\u5668\u4ec5\u7528\u6765\u8bfb\u53d6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bfb\u5199\u5206\u79bb\uff0c\u964d\u4f4e\u5199\u670d\u52a1\u5668\u7684\u538b\u529b\n\n3.Redis\u7684\u4e3b\u4ece\u642d\u5efa\n\u4e3bredis\u7684\u914d\u7f6e\uff1a\n# vim /etc/redis.conf\n\u9664\u4e86\u9ed8\u8ba4\u914d\u7f6e\u5916\uff0c\u9700\u8981\u786e\u5b9a\u4e00\u4e0b\u4e0b\u9762\u7684\u914d\u7f6e:\nbind 0.0.0.0\nport 6379\ndir \"/data/redis\"\nrequirepass \"redispwd\"\npidfile \"redis.pid\"\nlogfile \"redis.log\"\ndaemonize yes\n\n\u4eceredis\u7684\u914d\u7f6e\uff1a\n# vim /etc/redis.conf\n\u9664\u4e86\u9ed8\u8ba4\u914d\u7f6e\u5916\uff0c\u9700\u8981\u786e\u5b9a\u4e00\u4e0b\u4e0b\u9762\u7684\u914d\u7f6e:\nbind 0.0.0.0\nport 6379\ndir \"/data/redis\"\nrequirepass \"redispwd\"                   #\u4eceredis\u81ea\u5df1\u7684\u5bc6\u7801\uff0c\u4e00\u822c\u4e5f\u548c\u4e3b\u8bbe\u7f6e\u7684\u76f8\u540c\npidfile \"redis.pid\"\nlogfile \"redis.log\"\ndaemonize yes\n                                                      #\u6ce8\u610f\uff1a\u4eceredis\u9700\u8981\u589e\u52a0\u4e0b\u9762\u8fd9\u4e24\u9879\uff1a\nslaveof 192.168.107.222 6379              #\u6307\u5b9a\u4e3bredis\u7684ip\u548c\u7aef\u53e3        \nmasterauth \"redispwd\"                      #\u6307\u5b9a\u4e3bredis\u7684\u5bc6\u7801\n\n\u4e3b\u4eceredis\u7684\u542f\u52a8\uff1a\n\u542f\u52a8\u4e3bredis:  # redis-server /etc/redis.conf\n\u542f\u52a8\u4eceredis:  # redis-server /etc/redis.conf\n\n\u9a8c\u8bc1redis\u4e3b\u4ece\uff1a  \u5728\u4e3bredis\u4e0a\u5199\u5165\u6570\u636e\uff0c\u5728\u4eceredis\u4e0a\u67e5\u770b\u6570\u636e\u662f\u5426\u80fd\u540c\u6b65\u8fc7\u6765\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#12redis","title":"12.redis\u7684\u54e8\u5175\u6a21\u5f0f\u4e3b\u4ece\u81ea\u52a8\u5207\u6362","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1_2","title":"1.\u67e5\u770b\u4e3b\u4ece\u72b6\u6001\u4fe1\u606f","text":"<pre><code>\u5728\u4e3bredis\u4e0a\u767b\u5f55\u67e5\u770b\uff1a  \uff08192.168.107.222\uff09\n&gt; info Replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:ip=192.168.107.223,port=6379,state=online,offset=699,lag=1\nmaster_failover_state:no-failover\nmaster_replid:a4130be34d9eed50eb27ca80a779f59ad993045c\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:699\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:699\n\n\u5728\u4ece1redis\u4e0a\u767b\u5f55\u67e5\u770b\uff1a\uff08192.168.107.223\uff09\n&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.222\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:1\nmaster_sync_in_progress:0\nslave_read_repl_offset:783\nslave_repl_offset:783\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:a4130be34d9eed50eb27ca80a779f59ad993045c\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:783\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:783\n\n\u5728\u4ece2redis\u4e0a\u767b\u5f55\u67e5\u770b\uff1a\uff08192.168.107.224\uff09\n&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.222\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:4\nmaster_sync_in_progress:0\nslave_read_repl_offset:378\nslave_repl_offset:378\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:d27ba1044b42b5d58d368229eea4af83a6da38c8\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:378\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:71\nrepl_backlog_histlen:308\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2sentinel","title":"2.\u54e8\u5175Sentinel\u5b9e\u73b0\u4e3b\u4ece\u81ea\u52a8\u5207\u6362","text":"<pre><code>\u4e3b\u4ece\u81ea\u52a8\u5207\u6362\nRedis\u4e3b\u4ece\u914d\u7f6e\u540e\uff0c\u5f53\u4e3b\u6302\u6389\u540e\uff0c\u4e1a\u52a1\u4f1a\u6709\u5f02\u5e38\nRedis\u63d0\u4f9bSentinel\u5de5\u5177\u5b9e\u73b0\u4e3b\u4ece\u81ea\u52a8\u5207\u6362\uff0c\u5b9e\u73b0redis\u7684\u9ad8\u53ef\u7528\nSentinel\u7684\u542f\u52a8\u548c\u89c2\u5bdf\n# redis-sentinel /etc/sentinel.conf\n\u4e3b\u6302\u6389\u540e\uff0c\u4ece\u5e93\u81ea\u52a8\u63d0\u5347\u4e3a\u4e3b\u5e93\u4e3b\u6062\u590d\u540e\uff0c\u81ea\u52a8\u8f6c\u4e3a\u4ece\u5e93\uff0c\u9884\u9632\u6765\u56de\u5207\u6362\u3002\n\u8981\u6c42\u4e3b\u4ece\u90fd\u9700\u8981\u8bbe\u7f6emasterauth \u8fde\u63a5\u4e3bredis\u7684\u5bc6\u7801\n\u56e0\u4e3a\u662f\u9ad8\u53ef\u7528\u6a21\u5f0f\uff0c\u4e3b\u4e5f\u6709\u53ef\u80fd\u5b95\u673a\uff0c\u5f53\u5b83\u5b95\u673a\u540e\uff0c\u5373\u4f7f\u518d\u6062\u590d\u540e\u4e5f\u662f\u4f5c\u4e3a\u4ece\u89d2\u8272\uff0c\u4e3a\u4e86\u9632\u6b62\u4f5c\u4e3a\u4ece\u89d2\u8272\u65f6\u5019\uff0c\n\u8fde\u63a5\u4e3b\u65f6\u5019\u8ba4\u8bc1\u4e0d\u4e86\uff0c\u9700\u8981\u63d0\u524d\u52a0\u4e0a\u8fde\u63a5\u4e3b\u670d\u52a1\u5668\u7684\u8ba4\u8bc1\u5bc6\u7801\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#3sentinel123","title":"3.\u54e8\u5175Sentinel\u9ad8\u53ef\u7528\u6a21\u5f0f\u642d\u5efa\uff081\u4e3b2\u4ece3\u54e8\u5175\uff09","text":"<pre><code>\u4e3a\u4e86\u9632\u6b62\u54e8\u5175\u7684\u5355\u8282\u70b9\u6545\u969c\uff0c\u4e00\u822c\u54e8\u5175\u4e5f\u505a\u6210\u9ad8\u53ef\u7528\u5f62\u5f0f\uff0c\u5373\u591a\u4e2a\u54e8\u5175\u540c\u65f6\u76d1\u63a7redis\u7684\u72b6\u6001\uff0c\u5f53\u5176\u4e2d\u4e00\u4e2a\u54e8\u5175\u6545\u969c\u65f6\u5019\uff0c\u5176\u4ed6\u54e8\u5175\u4e5f\u80fd\u7ee7\u7eed\u76d1\u63a7\u3002\n\u4e3a\u4e86\u65b9\u4fbf\u54e8\u5175\u7684\u9009\u4e3e\uff0c\u4e00\u822c\u54e8\u5175\u4e5f\u662f\u8bbe\u7f6e\u6210\u5947\u6570\u4e2a\u3002\u4e00\u822c3\u4e2a\u54e8\u5175\u5c31\u6ca1\u95ee\u9898\u3002\n\u6ce8\u610f\uff1a\u4e00\u822c\u54e8\u5175\u7684\u90e8\u7f72\u5c3d\u91cf\u4e0d\u8981\u548credis\u90e8\u7f72\u5728\u540c\u4e00\u53f0\uff0c\u9632\u6b62\u8fd9\u4e00\u53f0\u673a\u5668\u6302\u4e86\u540e\uff0credis\u548c\u54e8\u5175\u540c\u65f6\u6302\u6389\uff0c\u54e8\u5175\u8d77\u4e0d\u5230\u54e8\u5175\u7684\u4f5c\u7528\u4e86\u3002\u5f53\u7136\u591a\u53f0\u673a\u5668\uff0c\n\u591a\u4e2a\u54e8\u5175\u65f6\u5019\u4e5f\u4e0d\u5f71\u54cd\uff0c\u4e00\u53f0\u54e8\u5175\u6302\u4e86\uff0c\u8fd8\u6709\u5176\u5b83\u54e8\u5175\u3002\n\u89c4\u5212\uff1a\n192.168.107.222   \u4e3bredis    \u54e8\u51751\n192.168.107.223   \u4ece1redis  \u54e8\u51752\n192.168.107.224   \u4ece2redis  \u54e8\u51753\n\n1).\u5148\u642d\u5efaredis\u7684\u4e3b\u4ece\uff081\u4e3b2\u4ece\uff0c\u524d\u9762\u5df2\u7ecf\u4ecb\u7ecd\uff0c\u7565)\n\u5728\u4e3bredis\u4e0a\u767b\u5f55\u67e5\u770b\uff1a  \uff08192.168.107.222\uff09\n127.0.0.1:6379&gt; info Replication\n# Replication\nrole:master\nconnected_slaves:2\nslave0:ip=192.168.107.223,port=6379,state=online,offset=3216,lag=1\nslave1:ip=192.168.107.224,port=6379,state=online,offset=3216,lag=1\n\u5728\u4ece1redis\u4e0a\u767b\u5f55\u67e5\u770b\uff1a\uff08192.168.107.223\uff09\n127.0.0.1:6379&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.222\nmaster_port:6379\n\u5728\u4ece2redis\u4e0a\u767b\u5f55\u67e5\u770b\uff1a\uff08192.168.107.224\uff09\n127.0.0.1:6379&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.222\nmaster_port:6379\n\n\u6ce8\u610f\uff1a\u4e3bredis\u4e0a\u914d\u7f6e\u6587\u4ef6\u4e2d\u4e5f\u9700\u8981\u52a0\u4e0a\u4e0b\u9762\u914d\u7f6e\uff1a\u56e0\u4e3a\u662f\u9ad8\u53ef\u7528\u6a21\u5f0f\uff0c\u4e3b\u4e5f\u6709\u53ef\u80fd\u5b95\u673a\uff0c\u5f53\u5b83\u5b95\u673a\u540e\uff0c\u5373\u4f7f\u518d\u6062\u590d\u540e\u4e5f\u662f\u4f5c\u4e3a\u4ece\u89d2\u8272\u4e3a\u4e86\u9632\u6b62\u4f5c\u4e3a\u4ece\u89d2\u8272\u65f6\u5019\uff0c\u8fde\u63a5\u4e3b\u65f6\u5019\u8ba4\u8bc1\u4e0d\u4e86\uff0c\u9700\u8981\u63d0\u524d\u52a0\u4e0a\u8fde\u63a5\u4e3b\u670d\u52a1\u5668\u7684\u8ba4\u8bc1\u5bc6\u7801\n# vi /etc/redis.conf     \nmasterauth \"redispwd\"                      #\u6307\u5b9a\u4e3bredis\u7684\u5bc6\u7801\n\n2).\u914d\u7f6e3\u54e8\u5175\n# vi /etc/sentinel.conf                #3\u4e2a\u54e8\u5175\u673a\u5668\u914d\u7f6e\u90fd\u4e00\u6837\nbind 0.0.0.0\ndaemonize yes\nport 26379\ndir \"/tmp\"\nlogfile \"sentinel.log\"\nsentinel monitor testmaster 192.168.107.222 6379 2\nsentinel auth-pass testmaster redispwd\nsentinel down-after-milliseconds testmaster 5000\nsentinel failover-timeout testmaster 18000\n\n\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e:\n#port 26379  \u54e8\u5175\u7684\u4e00\u4e2a\u7aef\u53e3\n#testmaster\u662f\u968f\u4fbf\u8d77\u7684\u4e00\u4e2a\u540d\u5b57,\u8fde\u63a5\u7684\u4e3bredis\u7684\u662f:192.168.107.222, 2\u662f\u4ee3\u8868\u67092\u4e2a\u54e8\u5175\u8ba4\u4e3amaster\u6709\u95ee\u9898\u624d\u4f1a\u5207\u6362\n#redispwd \u662f\u8fde\u63a5\u4e3bredis\u7684\u5bc6\u7801,      5000 \u662f5\u79d2\u6ca1\u54cd\u5e94\u8ba4\u4e3a\u4e3b\u6302\u4e86\n#18000 \u662f\u4ece\u63d0\u5347\u4e3a\u4e3b\u7684\u8d85\u65f6\u65f6\u95f418s(\u53ef\u9002\u5f53\u8c03\u5927)\n\n3).\u542f\u52a83\u54e8\u5175\n# redis-sentinel /etc/sentinel.conf      3\u53f0\u90fd\u662f\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u542f\u52a8\n# ps -ef |grep sentinel                     3\u53f0\u67e5\u770b\u8fdb\u7a0b\nroot       1742      1  0 11:32 ?        00:00:00 redis-sentinel 0.0.0.0:26379 [sentinel]\n\n4).\u9a8c\u8bc1\u54e8\u5175\u5b9e\u73b0\u7684\u9ad8\u53ef\u7528redis\na).\u505c\u6b62\u4e3bredis\u670d\u52a1              192.168.107.222\u673a\u5668\u505c\u6b62\u4e3bredis\n# systemctl stop redis            \n\nb).\u67e5\u770b\u5176\u4ed6\u4e24\u4e2a\u4eceredis\uff0c\u5176\u4e2d\u4e00\u4e2a\u5df2\u7ecf\u63d0\u5347\u4e3a\u4e3b\n\u67e5\u770b\u4ece1redis 192.168.107.2233\n&gt; info Replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:ip=192.168.107.224,port=6379,state=online,offset=15033,lag=0\nmaster_failover_state:no-failover\nmaster_replid:3b0ca2f0c9791e973bda766dcee2f91589cce2cf\nmaster_replid2:2423087d35cac94a66bf8f88462c332220b501d5\nmaster_repl_offset:15033\nsecond_repl_offset:12498\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:15033\n\n\u67e5\u770b\u4ece2redis 192.168.107.224\n&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.223\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:1\nmaster_sync_in_progress:0\nslave_read_repl_offset:27010\nslave_repl_offset:27010\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:3b0ca2f0c9791e973bda766dcee2f91589cce2cf\nmaster_replid2:2423087d35cac94a66bf8f88462c332220b501d5\nmaster_repl_offset:27010\nsecond_repl_offset:12498\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:27010\n\n\u5e76\u4e14\u67e5\u770b\u4ece2redis\u7684\u914d\u7f6e\u6587\u4ef6\u4e5f\u81ea\u52a8\u4fee\u6539\u6210\u4e86\u6307\u5b9a\u4e86\u65b0\u4e3b\u7684ip\n# tail -2 /etc/redis.conf              #slaveof\u548creplicaof\u662f\u4e00\u6837\u7684\nreplicaof 192.168.107.223 6379\nmasterauth \"redispwd\"\n\nc).\u5f53\u4e3bredis\u6062\u590d\uff0c\u81ea\u52a8\u4f5c\u4e3a\u4ece\u670d\u52a1\u5668\uff0c\u6307\u5411\u65b0\u7684\u4e3bredis\n# systemctl start redis\n# redis-cli -a redispwd\n&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.223\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:0\nmaster_sync_in_progress:0\nslave_read_repl_offset:49223\nslave_repl_offset:49223\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:3b0ca2f0c9791e973bda766dcee2f91589cce2cf\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:49223\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:48319\nrepl_backlog_histlen:905\n\n\n\u67e5\u770b\u539f\u4e3b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e5f\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u91cd\u65b0\u6307\u5b9a\u7684\u65b0\u7684\u4e3bredis\n# tail -2 /etc/redis.conf \nmasterauth \"redispwd\"\nreplicaof 192.168.107.223 6379\n\n\n\n5).\u9a8c\u8bc1\u4e00\u4e0b\u54e8\u5175\u7684\u9ad8\u53ef\u7528\u6027\uff1a\na).\u5728\u539f\u4e3b(192.168.107.222)\u90a3\u53f0\u673a\u5668\u4e0a\uff0c\u6740\u6b7b\u4e00\u4e2a\u54e8\u5175\uff0c\u6a21\u5f0f\u4e00\u4e2a\u54e8\u5175\u670d\u52a1\u6302\u6389\n# ps -ef |grep sen\nroot       1742      1  0 11:32 ?        00:00:03 redis-sentinel 0.0.0.0:26379 [sentinel]\nroot       1779   1362  0 11:47 pts/0    00:00:00 grep --color=auto sen\n# kill 1742\n# ps -ef |grep sen\nroot       1781   1362  0 11:47 pts/0    00:00:00 grep --color=auto sen\n\nb).\u65b0\u4e3bredis\u670d\u52a1\u505c\u6b62\uff1a\uff08192.168.107.223\uff09\n# systemctl stop redis\n\nc).\u5176\u4ed6\u4e24\u4e2a\u4eceredis\u67e5\u770b\u4e3b\u4ece\u72b6\u6001\uff08192.168.107.222\u548c192.168.107.224\uff09\n192.168.107.222\uff08\u539f\u4e3b)\u67e5\u770b\uff1a     \u53ef\u4ee5\u67e5\u770b\u5230\u81ea\u5df1\u662f\u4ece\uff0c\u53c8\u91cd\u65b0\u9009\u51fa\u4e86\u4e00\u4e2a\u65b0\u4e3b130\u673a\u5668\n127.0.0.1:6379&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.224\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:2\nmaster_sync_in_progress:0\nslave_repl_offset:221763\nslave_priority:100\nslave_read_only:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:56cd835f2f4f8eee9eb1dc711f8b8e57a8b06db7\nmaster_replid2:7ffd1c6815695fef04fce6a7b1ff705f7b8a368e\nmaster_repl_offset:221763\nsecond_repl_offset:210754\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:143078\nrepl_backlog_histlen:78686\n192.168.107.224   #\uff08\u539f\u4ece2\uff09\u4e0a\u67e5\u770b\uff1a       \u81ea\u5df1\u5df2\u7ecf\u53d8\u6210\u4e86\u4e3b\n127.0.0.1:6379&gt; info Replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:ip=192.168.107.222,port=6379,state=online,offset=244883,lag=1\nmaster_failover_state:no-failover\nmaster_replid:56cd835f2f4f8eee9eb1dc711f8b8e57a8b06db7\nmaster_replid2:7ffd1c6815695fef04fce6a7b1ff705f7b8a368e\nmaster_repl_offset:244883\nsecond_repl_offset:210754\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:15\nrepl_backlog_histlen:244869\n\n\u901a\u8fc7\u8fd9\u4e2a\u6848\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5f53\u5176\u4e2d\u4e00\u4e2a\u54e8\u5175\u6302\u6389\u540e\uff0c\u5176\u4ed6\u54e8\u5175\u7167\u6837\u53ef\u4ee5\u76d1\u63a7\u76d1\u63a7redis\uff0c\u5b9e\u73b0redis\u7684\u9ad8\u53ef\u7528\u6027\n\u591a\u54e8\u5175\u6a21\u5f0f\u4e5f\u662f\u4e3a\u4e86\u52a0\u5f3a\u54e8\u5175\u670d\u52a1\u7684\u5065\u58ee\u6027\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#13redis-cluster","title":"13.redis cluster\u96c6\u7fa4\u642d\u5efa\u548c\u9ad8\u53ef\u7528\u6545\u969c\u5207\u6362\u6f14\u793a","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#1rediscluster","title":"1.Redis\u4e3b\u4ece\u6a21\u5f0f\u548ccluster\u5206\u7247\u96c6\u7fa4\u533a\u522b","text":"<pre><code>redis\u4e3b\u4ece\u6a21\u5f0f\uff0c\u662f\u6240\u6709Redis\u6570\u636e\u4e00\u81f4\uff0c\u4f46\u662fkey\u8fc7\u591a\u4e86\u4f1a\u5f71\u54cd\u6027\u80fd\ncluster\u5206\u7247\u96c6\u7fa4\uff0c\u53ef\u4ee5\u5c06\u6570\u636e\u5206\u6563\u5230\u591a\u4e2aRedis\u8282\u70b9\uff0c\u6570\u636e\u5206\u7247\u5b58\u50a8\uff0c\u80fd\u591f\u63d0\u9ad8redis\u7684\u541e\u5410\u91cf\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#2redis-cluster","title":"2.Redis Cluster\u96c6\u7fa4\u7279\u70b9","text":"<pre><code>\u6570\u636e\u5206\u7247\n\u591a\u4e2a\u5165\u53e3\n\u6545\u969c\u81ea\u52a8\u5207\u6362\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#3redis-cluster","title":"3.Redis cluster\u96c6\u7fa4\u7684\u642d\u5efa\u67b6\u6784","text":"<pre><code>Redis\u96c6\u7fa4\u81f3\u5c11\u9700\u8981\u4e09\u4e3b\u4e09\u4ece\n\u4e09\u4ece\u662f\u4fdd\u8bc1\u4e3b\u6709\u95ee\u9898\u65f6\u80fd\u591f\u5207\u6362\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#4redis_1","title":"4.Redis\u81ea\u5e26\u96c6\u7fa4\u642d\u5efa","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#a","title":"a).\u76ee\u5f55\u548c\u673a\u5668\u89c4\u5212","text":"\u76ee\u5f55 /data/cluster \u4e09\u4e3b 192.168.107.222:7000 192.168.107.223:7001 192.168.107.224:7002 \u4e09\u4ece 192.168.107.222:8000(7002\u7684\u4ece) 192.168.107.223:8001(7000\u7684\u4ece) 192.168.107.224:8002(7001\u7684\u4ece) <p>\u6ce8\u610f\uff1a\u4e0a\u9762\u8bbe\u8ba1\u662f\u4e3a\u4e86\u907f\u514d\u4e3b\u4ece\u90fd\u5728\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u9632\u6b62\u540c\u4e00\u4e2a\u8282\u70b9\u6302\u4e86\u540e\uff0c\u4e3b\u4ece\u90fd\u6302\u6389\uff0c\u5c31\u6ca1\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5bfc\u81f4\u6570\u636e\u4e22\u5931</p>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#bredis_1","title":"b).\u4fee\u6539redis\u7684\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>6\u53f0redis\u914d\u7f6e\u90fd\u4e00\u6837\uff0c\u53ea\u662f\u4e0b\u9762\u4e24\u9879\uff1a\u7aef\u53e3\u548c\u8def\u5f84\u4e0d\u4e00\u6837\nredis0\u4e0a\n# mkdir -p /data/cluster/7000\n# mkdir -p /data/cluster/8000\nredis1\u4e0a\n# mkdir -p /data/cluster/7001\n# mkdir -p /data/cluster/8001\nredis2\u4e0a\n# mkdir -p /data/cluster/7002\n# mkdir -p /data/cluster/800\n# vi /data/cluster/7000/redis.conf          \u5404\u81ea\u76ee\u5f55\u4e0b\u521b\u5efa\u914d\u7f6e\u6587\u4ef6: 7000 7001  7002  8000  8001  8002\n\u4e0b\u9762\u914d\u7f6e\u4e2d\u6ce8\u610fport\u548cdir\u7684\u7aef\u53e3\u548c\u6587\u4ef6\u76ee\u5f55\n</code></pre> <pre><code>cluster-enabled yes\nport 7000               \ndir \"/data/cluster/7000\"\nlogfile \"redis.log\"\npidfile \"redis.pid\"\ndaemonize yes\nbind 0.0.0.0\nrequirepass redispwd\nmasterauth redispwd\ntcp-backlog 1024\ntcp-keepalive 0\nloglevel notice\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\nsave 900 1\nsave 300 10\nsave 60 10000\ndbfilename \"dump.rdb\"\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nslave-priority 100\nappendonly no\nappendfilename \"appendonly.aof\"\nappendfsync everysec\nno-appendfsync-on-rewrite yes\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\nlua-time-limit 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-entries 512\nlist-max-ziplist-value 64\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#c3","title":"c).\u5148\u642d\u5efa3\u4e3b\u96c6\u7fa4","text":"<pre><code>(1).\u5148\u542f\u52a83\u4e2a\u4e3bredis   192.168.107.222:7000      192.168.107.223:7001       192.168.107.224:7002\n222\u4e0a\uff1a\n# redis-server /data/cluster/7000/redis.conf \n# ps -ef |grep redis\nroot       2285      1  1 22:55 ?        00:00:00 redis-server 0.0.0.0:7000 [cluster]\nroot       2226   1362  0 22:55 pts/0    00:00:00 grep --color=auto redis\n\n223\u4e0a\uff1a\n# redis-server /data/cluster/7001/redis.conf \n# ps -ef |grep redis\nroot       4385      1  0 22:56 ?        00:00:00 redis-server 0.0.0.0:7001 [cluster]\nroot       4354   1356  0 22:56 pts/0    00:00:00 grep --color=auto redis\n\n224\u4e0a\uff1a\n# redis-server /data/cluster/7002/redis.conf \n# ps -ef |grep redis\nroot       2298      1  0 22:57 ?        00:00:00 redis-server 0.0.0.0:7002 [cluster]\nroot       2270   1370  0 22:57 pts/0    00:00:00 grep --color=auto redis\n\n(2).\u521b\u5efa3\u4e3b\u96c6\u7fa4\uff0c\u5728\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u90fd\u53ef\u4ee5\n# redis-cli -a redispwd --cluster create 192.168.107.222:7000 192.168.107.223:7001 192.168.107.224:7002\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Performing hash slots allocation on 3 nodes...\nMaster[0] -&gt; Slots 0 - 5460\nMaster[1] -&gt; Slots 5461 - 10922\nMaster[2] -&gt; Slots 10923 - 16383\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\nCan I set the above configuration? (type 'yes' to accept): yes\n&gt;&gt;&gt; Nodes configuration updated\n&gt;&gt;&gt; Assign a different config epoch to each node\n&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n...\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.222:7000)\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\n\n\n(3).\u67e5\u770b3\u4e3b\u96c6\u7fa4\uff1a  \u5728\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u90fd\u884c\uff0c\u4e0b\u9762\u4ee57000\u7aef\u53e3\u8fd9\u4e2aredis\u4e3a\u4f8b\u67e5\u770b\u96c6\u7fa4\u4fe1\u606f\n# redis-cli -a redispwd -p 7000 cluster info\n# redis-cli -a redispwd -p 7000 cluster nodes   #\u6ce8\u610fslot\u5206\u914d\n\n# redis-cli -a redispwd -p 7000 cluster info\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\ncluster_state:ok\ncluster_slots_assigned:16384\ncluster_slots_ok:16384\ncluster_slots_pfail:0\ncluster_slots_fail:0\ncluster_known_nodes:3\ncluster_size:3\ncluster_current_epoch:3\ncluster_my_epoch:1\ncluster_stats_messages_ping_sent:174\ncluster_stats_messages_pong_sent:169\ncluster_stats_messages_sent:343\ncluster_stats_messages_ping_received:167\ncluster_stats_messages_pong_received:174\ncluster_stats_messages_meet_received:2\ncluster_stats_messages_received:343\n\n# redis-cli -a redispwd -p 7000 cluster nodes \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693043947714 2 connected 5461-10922\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693043945000 1 connected 0-5460\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693043946704 3 connected 10923-16383\n\n\n(4).\u96c6\u7fa4\u64cd\u4f5c\uff0c\u5728\u96c6\u7fa4\u4e2d\u5199\u5165\u6570\u636e   \u5728\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u4f5c\u4e3a\u5165\u53e3\u90fd\u53ef\u4ee5\uff0c\u4e0b\u9762\u4ee5222:7000\u7aef\u53e3\u7684redis\u4e3a\u4f8b\u5199\u5165\u6570\u636e\n\u96c6\u7fa4\u64cd\u4f5c\u9700\u8981\u52a0-c\u53c2\u6570\n# redis-cli -p 7000 -a redispwd              #\u4e0d\u52a0-c\u53c2\u6570\uff0c\u8868\u793a\u4e0d\u662f\u4ee5\u96c6\u7fa4\u65b9\u5f0f\u5199\u5165\uff0c\u65e0\u6cd5\u5199\u5165    \n# redis-cli -p 7000 -a redispwd -c          #\u589e\u52a0-c\u53c2\u6570\uff0c\u8868\u793a\u662f\u4ee5\u96c6\u7fa4\u65b9\u5f0f\u5199\u5165\uff0c\u53ef\u4ee5\u5199\u5165\n127.0.0.1:7000&gt; set k1 v1\n-&gt; Redirected to slot [12706] located at 192.168.107.224:7002     #\u53ef\u4ee5\u770b\u5230\u8be5key,k1\u662f\u5b58\u653e\u5230130:7002\u7684redis\nOK\n192.168.107.224:7002&gt; set k2 v2\n-&gt; Redirected to slot [449] located at 192.168.107.222:7000         #\u53ef\u4ee5\u770b\u5230\u8be5key,k2\u662f\u5b58\u653e\u5728\u672c\u673a128:7000\u7684redis\uff0c\u53ef\u4ee5\u770b\u51fa\u6570\u636e\u662f\u5206\u5e03\u5b58\u50a8\nOK\n192.168.107.222:7000&gt; keys *                                                #\u5728128:7000\u7684redis\u53ef\u4ee5\u770b\u5230\u53ea\u5b58\u50a8\u4e86k2,\u662f\u6309\u69fd\u4f4d\u5206\u914d\u6570\u636e,\u4e0d\u662f\u6309\u8282\u70b9\u5206\u914d\n1) \"k2\"\n192.168.107.222:7000&gt; get k2\n\"v2\"\n\n\u5728224:7002redis\u4e0a\u53ef\u4ee5\u67e5\u770b\u5b58\u50a8\u7684\u53e6\u4e00\u4e2ak1\n# redis-cli -p 7002 -a redispwd -c\n127.0.0.1:7002&gt; keys *\n1) \"k1\"\n127.0.0.1:7002&gt; get k1\n\"v1\"\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#d3redis","title":"d).\u589e\u52a0\u642d\u5efa3\u4ece\u96c6\u7fa4\uff0c\u5b9e\u73b0redis\u9ad8\u53ef\u7528","text":"<pre><code>(1).\u5148\u542f\u52a83\u4e2a\u4eceredis   192.168.107.222:8000      192.168.107.223:8001       192.168.107.224:8002\n222\u4e0a\uff1a\n# redis-server /data/cluster/8000/redis.conf \n# ps -ef |grep redis\nroot       2285      1  0 23:35 ?        00:00:00 redis-server 0.0.0.0:7000 [cluster]\nroot       2301      1  0 23:41 ?        00:00:00 redis-server 0.0.0.0:8000 [cluster]\nroot       2307   1362  0 23:41 pts/0    00:00:00 grep --color=auto redis\n\n223\u4e0a\uff1a\n# redis-server /data/cluster/8001/redis.conf \n# ps -ef |grep redis\nroot       4385      1  0 23:36 ?        00:00:00 redis-server 0.0.0.0:7001 [cluster]\nroot       4404      1  1 23:42 ?        00:00:00 redis-server 0.0.0.0:8001 [cluster]\nroot       4410   1356  0 23:42 pts/0    00:00:00 grep --color=auto redis\n\n224\u4e0a\uff1a\n# redis-server /data/cluster/8002/redis.conf \n# ps -ef |grep redis\nroot       2298      1  0 23:36 ?        00:00:00 redis-server 0.0.0.0:7002 [cluster]\nroot       2311      1  0 23:42 ?        00:00:00 redis-server 0.0.0.0:8002 [cluster]\nroot       2317   1370  0 23:42 pts/0    00:00:00 grep --color=auto redis\n\n(2).\u5206\u522b\u7ed93\u4e2a\u4e3b\u8282\u70b9\u6dfb\u52a0\u4ece\u5e93\uff0c\u5728\u4efb\u4f55\u4e00\u8282\u64cd\u4f5c\u5373\u53ef\uff0c\u4e0b\u9762\u4ee5\u5728128:7000\u7684redis\u4e3a\u4f8b\u64cd\u4f5c\n\u522b\u5fd8\u4e86\u4e3b\u4ece\u7684\u89c4\u5212\uff1a\n\u4e09\u4e3b\uff1a 192.168.107.222:7000                     192.168.107.223:7001                       192.168.107.224:7002\n\u4e09\u4ece\uff1a 192.168.107.222:8000(7002\u7684\u4ece)      192.168.107.223:8001(7000\u7684\u4ece)       192.168.107.224:8002(7001\u7684\u4ece)\n\u6ce8\u610f\uff1a\u4e0a\u9762\u8bbe\u8ba1\u662f\u4e3a\u4e86\u907f\u514d\u4e3b\u4ece\u90fd\u5728\u540c\u4e00\u4e2a\u8282\u70b9\uff0c\u9632\u6b62\u540c\u4e00\u4e2a\u8282\u70b9\u6302\u4e86\u540e\uff0c\u4e3b\u4ece\u90fd\u6302\u6389\uff0c\u5c31\u6ca1\u6cd5\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5bfc\u81f4\u6570\u636e\u4e22\u5931\n\n# redis-cli -a redispwd -p 7000 cluster nodes                                                       #\u67e5\u770b\u96c6\u7fa4\u7684\u5404\u4e2a\u8282\u70b9\u72b6\u6001\u548cmaster-id                \n# redis-cli -a redispwd --cluster add-node --cluster-slave --cluster-master-id  7000\u7684master-id  192.168.107.223:8001 192.168.107.222:7000\n# redis-cli -a redispwd --cluster add-node --cluster-slave --cluster-master-id  7001\u7684master-id  192.168.107.224:8002 192.168.107.223:7001\n# redis-cli -a redispwd --cluster add-node --cluster-slave --cluster-master-id  7002\u7684master-id  192.168.107.222:8000 192.168.107.224:7002\n\n\u7ed93\u4e3b\u5206\u522b\u52a0\u5165\u4ece\u8282\u70b9\u64cd\u4f5c\uff1a\n# redis-cli -a redispwd -p 7000 cluster nodes\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693044296068 2 connected 5461-10922\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693044297000 1 connected 0-5460\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693044298089 3 connected 10923-16383\n\n222master-id:c4acfb2490f7557a5e1857118360bddfaa523c9f\n223master-id:ff50bb210c08f3bd453201150be381bcb3b4f05f\n224master-id:2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095\n\u6ce8\u610f\uff1a\u4e0b\u9762\u547d\u4ee4\u4e2d\u540e\u9762\u4e24\u4e2aip\u987a\u5e8f\u4e0d\u80fd\u98a0\u5012\uff0c\u5206\u522b\u5bf9\u5e94\u7684\u4e00\u7ec4\u4e3b\u4ece\uff0cip\u987a\u5e8f\u4e3a:  \u4eceredis\u7684ip:\u4ece\u7aef\u53e3   \u4e3bredis\u7684ip:\u4e3b\u7aef\u53e3\n\n# redis-cli -a redispwd --cluster add-node --cluster-slave --cluster-master-id  c4acfb2490f7557a5e1857118360bddfaa523c9f  192.168.107.223:8001 192.168.107.222:7000      #\u6ce8\u610f:\u540e\u9762\u4e24\u4e2aip\u7684redis\u7684\u987a\u5e8f\u662f\u4e0d\u80fd\u98a0\u5012\u7684,\u5426\u5219\u52a0\u5165\u4e0d\u6210\u529f \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Adding node 192.168.107.223:8001 to cluster 192.168.107.222:7000\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.222:7000)\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\n&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.107.223:8001 to make it join the cluster.\nWaiting for the cluster to join\n\n&gt;&gt;&gt; Configure node as replica of 192.168.107.222:7000.\n[OK] New node added correctly.\n\n\n# redis-cli -a redispwd --cluster add-node --cluster-slave --cluster-master-id  ff50bb210c08f3bd453201150be381bcb3b4f05f  192.168.107.224:8002 192.168.107.223:7001    #\u6ce8\u610f:\u540e\u9762\u4e24\u4e2aip\u7684redis\u7684\u987a\u5e8f\u662f\u4e0d\u80fd\u98a0\u5012\u7684,\u5426\u5219\u52a0\u5165\u4e0d\u6210\u529f \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Adding node 192.168.107.224:8002 to cluster 192.168.107.223:7001\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.223:7001)\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: ffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001\n   slots: (0 slots) slave\n   replicates c4acfb2490f7557a5e1857118360bddfaa523c9f\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\n&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.107.224:8002 to make it join the cluster.\nWaiting for the cluster to join\n\n&gt;&gt;&gt; Configure node as replica of 192.168.107.223:7001.\n[OK] New node added correctly.\n\n\n# redis-cli -a redispwd --cluster add-node --cluster-slave --cluster-master-id  2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095   192.168.107.222:8000 192.168.107.224:7002    #\u6ce8\u610f:\u540e\u9762\u4e24\u4e2aip\u7684redis\u7684\u987a\u5e8f\u662f\u4e0d\u80fd\u98a0\u5012\u7684,\u5426\u5219\u52a0\u5165\u4e0d\u6210\u529f \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Adding node 192.168.107.222:8000 to cluster 192.168.107.224:7002\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.224:7002)\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\nS: 0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002\n   slots: (0 slots) slave\n   replicates ff50bb210c08f3bd453201150be381bcb3b4f05f\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nS: ffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001\n   slots: (0 slots) slave\n   replicates c4acfb2490f7557a5e1857118360bddfaa523c9f\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\n&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.107.222:8000 to make it join the cluster.\nWaiting for the cluster to join\n\n&gt;&gt;&gt; Configure node as replica of 192.168.107.224:7002.\n[OK] New node added correctly.\n\n\u52a0\u5165\u4ece\u8282\u70b9\u540e\u67e5\u770b\u8282\u70b9\u72b6\u6001\u548c\u5404\u81ea\u89d2\u8272\uff1a  (\u5728\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u64cd\u4f5c\u5373\u53ef\uff0c\u4e0b\u9762\u4ee5222:7000redis\u4e3a\u4f8b)\n# redis-cli -a redispwd -p 7000 cluster nodes\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693044780000 1 connected 0-5460\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693044781775 3 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693044780000 2 connected 5461-10922\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693044782785 2 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693044779756 3 connected 10923-16383\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693044781000 1 connected\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#ecluster","title":"e).\u9a8c\u8bc1cluster\u96c6\u7fa4\u4e3b\u4ece\u7684\u9ad8\u53ef\u7528\u5207\u6362","text":"<pre><code>\u5728\u4efb\u4f55\u4e00\u8282\u64cd\u4f5c\u5373\u53ef\uff0c\u4e0b\u9762\u4ee5\u5728222:7000\u7684redis\u4e3a\u4f8b\u64cd\u4f5c\n\u505c\u6b62\u5176\u4e2d222:7000\u7684\u4e3b\u5e93redis\uff0c\u67e5\u770b223:8001\u7684\u4ece\u5e93\u662f\u5426\u80fd\u63d0\u5347\u4e3a\u4e3b\u5e93\uff1a\n# ps -ef |grep redis\nroot      11692      1  0 17:49 ?        00:00:02 redis-server 0.0.0.0:7000 [cluster]\nroot      15244      1  0 18:04 ?        00:00:00 redis-server 0.0.0.0:8000 [cluster]\nroot      19270   6833  0 18:16 pts/0    00:00:00 grep --color=auto redis\n# kill 11692\n# ps -ef |grep redis\nroot      15244      1  0 18:04 ?        00:00:01 redis-server 0.0.0.0:8000 [cluster]\nroot      19452   6833  0 18:16 pts/0    00:00:00 grep --color=auto redis\n\n\u4ee5222:8000\u7684redis\u4f5c\u4e3a\u5165\u53e3\uff0c\u67e5\u770b\u8282\u70b9\u72b6\u6001\u548c\u89d2\u8272\u4fe1\u606f\uff0c\u539f\u4e3b222:7000\u5b95\u673a\uff0c\u5bf9\u5e94\u7684\u539f\u4ece223:8001\u63d0\u5347\u4e3a\u4e86\u65b0\u4e3b\n# redis-cli -a redispwd -p 8000 cluster nodes\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693045033000 1 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693045034748 3 connected 10923-16383\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 master,fail - 1693045017576 1693045013538 1 disconnected 0-5460\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 myself,slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693045032000 3 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693045032000 2 connected 5461-10922\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693045034000 2 connected\n\n\n\u5f53\u539f\u4e3b222:7000redis\u6062\u590d\uff0c\u81ea\u52a8\u4f5c\u4e3a\u4ece\u89d2\u8272\uff1a\n# redis-server /data/cluster/7000/redis.conf \n# ps -ef |grep redis\nroot       2301      1  0 Nov15 ?        00:00:04 redis-server 0.0.0.0:8000 [cluster]\nroot       2355      1  0 00:22 ?        00:00:00 redis-server 0.0.0.0:7000 [cluster]\nroot       2362   1362  0 00:22 pts/0    00:00:00 grep --color=auto redis\n\n# redis-cli -a redispwd -p 7000 cluster nodes\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,slave ffb3bd0c4d3fade126022f2f90691a9cbde30f16 0 1693045436000 4 connected\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 master - 0 1693045434216 4 connected 0-5460\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693045435000 2 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693045437245 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693045436234 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693045435226 3 connected 10923-16383\n\n\n\u5982\u679c\u8fd8\u662f\u4e60\u60ef\u4e8e\u8ba9\u539f\u6765\u4e3b\u5e93\u4f5c\u4e3a\u4f5c\u4e3a\u4e3b\u5e93\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u547d\u4ee4\uff0c\u624b\u52a8\u63d0\u5347\u4e3a\u4e3b\u5e93\u3002\n\u4ece\u5e93\u624b\u52a8\u63d0\u5347\u4e3a\u4e3b\u5e93\u7684\u65b9\u6cd5\uff1a CLUSTER FAILOVER\n\u767b\u5f55\u539f\u4e3b\u5e93\u73b0\u4ece\u5e93redis:  222:7000\n# redis-cli -a redispwd -p 7000\n127.0.0.1:7000&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.223\nmaster_port:8001\n127.0.0.1:7000&gt; CLUSTER FAILOVER\nOK\n127.0.0.1:7000&gt; info Replication\n# Replication\nrole:master\nconnected_slaves:1\n\n\u518d\u6b21\u67e5\u770b\u8282\u70b9\n# redis-cli -a redispwd -p 7000 cluster nodes\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693045574000 5 connected 0-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693045573000 5 connected\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693045574492 2 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693045575500 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693045576509 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693045573481 3 connected 10923-16383\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#14redis-cluster","title":"14.redis cluster\u96c6\u7fa4\u6dfb\u52a0\u548c\u5220\u9664\u8282\u70b9","text":""},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#_2","title":"\u73af\u5883\u51c6\u5907","text":"<pre><code>\u5728\u524d\u9762\u7684\u57fa\u7840\u4e0a\n\u589e\u52a0\u4e00\u4e2a\u4e3b\u8282\u70b9\uff1a  192.168.107.222:7003   \u4ece\u8282\u70b9 192.168.107.222:7004  \uff08\u6b63\u5e38\u4e3b\u4ece\u4e0d\u80fd\u5728\u4e00\u53f0\u673a\u5668\uff0c\u6b64\u5904\u53ea\u662f\u6f14\u793a)\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#_3","title":"\u6dfb\u52a0\u8282\u70b9","text":"<pre><code>\u67e5\u770b3\u4e3b3\u4ece\u8282\u70b9\u72b6\u6001\uff1a\n# redis-cli -a redispwd -p 7000 cluster nodes\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693048229000 5 connected 0-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693048231000 5 connected\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693048231478 2 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693048232487 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693048230000 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693048232000 3 connected 10923-16383\n\nmkdir /data/cluster/7003\nmkdir /data/cluster/7004\n\n2.\u65b0\u589e\u8282\u70b9\u4e3b\u3001\u4eceredis\u5148\u542f\u52a8\n# redis-server -v\nRedis server v=6.2.1 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=3bc8e110479b329d\n# mkdir /data/cluster/7003 -p\n# mkdir /data/cluster/7004 -p\n# cp /data/cluster/7000/redis.conf /data/cluster/7003/redis.conf /data/cluster/7004/redis.conf\n\u4fee\u6539redis\u7684\u914d\u7f6e\u6587\u4ef6\uff1a                 \u6240\u6709\u8282\u70b9\u7684redis\u914d\u7f6e\u90fd\u4e00\u6837\uff0c\u53ea\u662f\u4e0b\u9762\u4e24\u9879\uff1a\u7aef\u53e3\u548c\u8def\u5f84\u4e0d\u4e00\u6837\n# vi /data/cluster/7003/redis.conf          \u5404\u81ea\u76ee\u5f55\u4e0b\u521b\u5efa\u914d\u7f6e\u6587\u4ef6: 7003  7004\ncluster-enabled yes\nport 7003\ndir \"/data/cluster/7003\"\nlogfile \"redis.log\"\npidfile \"redis.pid\"\ndaemonize yes\nbind 0.0.0.0\nrequirepass redispwd\nmasterauth redispwd\ntcp-backlog 1024\ntcp-keepalive 0\nloglevel notice\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\nsave 900 1\nsave 300 10\nsave 60 10000\ndbfilename \"dump.rdb\"\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nslave-priority 100\nappendonly no\nappendfilename \"appendonly.aof\"\nappendfsync everysec\nno-appendfsync-on-rewrite yes\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\nlua-time-limit 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-entries 512\nlist-max-ziplist-value 64\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\n\n\u542f\u52a8\u4e24\u4e2a\u65b0\u589e\u51c6\u5907\u4f5c\u4e3a\u4e3b\u4ece\u7684redis\uff1a\n# redis-server /data/cluster/7003/redis.conf \n# redis-server /data/cluster/7004/redis.conf \n# ps -ef |grep redis\nroot      15244      1  0 18:04 ?        00:00:06 redis-server 0.0.0.0:8000 [cluster]\nroot      21855      1  0 18:23 ?        00:00:05 redis-server 0.0.0.0:7000 [cluster]\nroot      46238      1  0 19:31 ?        00:00:00 redis-server 0.0.0.0:7003 [cluster]\nroot      46286      1  0 19:31 ?        00:00:00 redis-server 0.0.0.0:7004 [cluster]\nroot      46352   6833  0 19:32 pts/0    00:00:00 grep --color=auto redis\n\n\n\n2.\u5728redis\u96c6\u7fa4\u4e2d\u52a0\u5165\u4e00\u4e2a\u65b0\u7684\u4e3b\u8282\u70b9\uff08\u5728\u4efb\u610f\u4e00\u53f0\u96c6\u7fa4\u7684\u8282\u70b9\u64cd\u4f5c\u5373\u53ef\uff0c\u6b64\u5904\u5728128:7000\u7684\u8282\u70b9\u64cd\u4f5c)\n# redis-cli -a redispwd --cluster add-node \u65b0\u8282\u70b9ip:\u65b0\u8282\u70b9\u7aef\u53e3 \u96c6\u7fa4\u4efb\u610f\u4e3b\u8282\u70b9ip:\u96c6\u7fa4\u4efb\u610f\u4e3b\u8282\u70b9\u5bf9\u5e94\u7aef\u53e3    \n\u64cd\u4f5c:\n# redis-cli -a redispwd --cluster add-node 192.168.107.222:7003 192.168.107.222:7000          \n#\u5728128:7000\u8282\u70b9\u64cd\u4f5c\uff0c\u52a0\u5165\u65b0\u4e3b\u8282\u70b9\uff0c131:7003\nWWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Adding node 192.168.107.222:7003 to cluster 192.168.107.222:7000\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.222:7000)\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: ffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001\n   slots: (0 slots) slave\n   replicates c4acfb2490f7557a5e1857118360bddfaa523c9f\nS: 0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002\n   slots: (0 slots) slave\n   replicates ff50bb210c08f3bd453201150be381bcb3b4f05f\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nS: e95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000\n   slots: (0 slots) slave\n   replicates 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\n&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.107.222:7003 to make it join the cluster.\n[OK] New node added correctly.\n\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\n&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.27.131:7003 to make it join the cluster.\n[OK] New node added correctly.\n\n\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f\uff1a\n# redis-cli -a redispwd -p 7000 cluster nodes\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693049633000 5 connected 0-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693049637676 5 connected\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693049636666 2 connected\nc8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 master - 0 1693049636000 0 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693049635000 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693049635000 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693049638684 3 connected 10923-16383\n\n\n192.168.107.222:7003 master-id:c8f152ea7f6f436a96af0a3364e721ff108fb20b\n2.\u5728redis\u96c6\u7fa4\u4e2d\u52a0\u5165\u4e00\u4e2a\u65b0\u7684\u4ece\u8282\u70b9\uff08\u5728\u4efb\u610f\u4e00\u53f0\u96c6\u7fa4\u7684\u8282\u70b9\u64cd\u4f5c\u5373\u53ef\uff0c\u6ce8\u610f\u540e\u9762\u4e24\u4e2aip\u987a\u5e8f\u5373\u53ef\uff0c\u6b64\u5904\u5728128:7000\u8282\u70b9\u673a\u5668\u64cd\u4f5c)\n\u6ce8\u610f\uff1a\u4e0b\u9762\u547d\u4ee4\u4e2d\u540e\u9762\u4e24\u4e2aip\u987a\u5e8f\u4e0d\u80fd\u98a0\u5012\uff0c\u5206\u522b\u5bf9\u5e94\u7684\u4e00\u7ec4\u4e3b\u4ece\uff0cip\u987a\u5e8f\u4e3a:  \u4eceredis\u7684ip:\u4ece\u7aef\u53e3   \u4e3bredis\u7684ip:\u4e3b\u7aef\u53e3\n# redis-cli -a redispwd --cluster add-node --cluster-slave --cluster-master-id  c8f152ea7f6f436a96af0a3364e721ff108fb20b  192.168.107.222:7004 192.168.107.222:7003        \n#\u6ce8\u610f:\u540e\u9762\u4e24\u4e2aip\u7684redis\u7684\u987a\u5e8f\u662f\u4e0d\u80fd\u98a0\u5012\u7684,\u5426\u5219\u52a0\u5165\u4e0d\u6210\u529f \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Adding node 192.168.107.222:7004 to cluster 192.168.107.222:7003\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.222:7003)\nM: c8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003\n   slots: (0 slots) master\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: 0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002\n   slots: (0 slots) slave\n   replicates ff50bb210c08f3bd453201150be381bcb3b4f05f\nS: ffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001\n   slots: (0 slots) slave\n   replicates c4acfb2490f7557a5e1857118360bddfaa523c9f\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nS: e95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000\n   slots: (0 slots) slave\n   replicates 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\n&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.107.222:7004 to make it join the cluster.\nWaiting for the cluster to join\n\n&gt;&gt;&gt; Configure node as replica of 192.168.107.222:7003.\n[OK] New node added correctly.\n\n\n\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f\uff1a\u53d1\u73b0\u65b0\u589e\u52a0\u4e3b\u4ece\u8282\u70b9\u6ca1\u6709\u95ee\u9898\uff0c\u539f\u6765\u4e3b\u8282\u70b9\u90fd\u5206\u914d\u4e86\u69fd\u4f4d\uff0c\u4f46\u65b0\u4e3b\u8282\u70b9\u6ca1\u6709\u5206\u914d\u69fd\u4f4d\uff0c\u6240\u4ee5\u4e5f\u4e0d\u4f1a\u6709\u6570\u636e\n# redis-cli -a redispwd -p 7000 cluster nodes\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693049742000 5 connected 0-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693049745622 5 connected\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693049742000 2 connected\nc8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 master - 0 1693049743000 0 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693049743000 2 connected 5461-10922\n61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 192.168.107.222:7004@17004 slave c8f152ea7f6f436a96af0a3364e721ff108fb20b 0 1693049743604 0 connected\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693049744613 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693049744000 3 connected 10923-16383\n\n\n\n3.\u7ed9\u65b0\u52a0\u4e3bredis\u5206\u914d\u69fd\u4f4d \uff08\u5728\u96c6\u7fa4\u4e2d\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u64cd\u4f5c\u5373\u53ef\uff0c\u6b64\u5904\u4ee5222:7000\u8282\u70b9\u4e0a\u64cd\u4f5c\uff09\n\u6ce8\u610f\u69fd\u4f4d\u5206\u914d\uff0c\u53ef\u4ee5\u5c06\u67d0\u4e2a\u8282\u70b9\u69fd\u4f4d\u5206\u5230\u65b0\u8282\u70b9\uff0c\u4e5f\u53ef\u5c06\u6240\u6709\u4e3b\u8282\u70b9\u518d\u505a\u4e00\u4e2a\u5e73\u5747\u5206\u914d\uff0c\u6b64\u5904\u662f\u4ece128:7000\u4e3b\u8282\u70b9\u7684\u69fd\u4f4d\u79fb\u52a8\u5230\u65b0\u4e3b\u8282\u70b9\u4e00\u90e8\u5206\uff09\n# redis-cli -a redispwd --cluster reshard 192.168.107.222:7000    #\u8fde\u63a5\u96c6\u7fa4\u4e2d\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u7684redis\n# redis-cli -a redispwd --cluster reshard 192.168.107.222:7000 \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.222:7000)\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: ffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001\n   slots: (0 slots) slave\n   replicates c4acfb2490f7557a5e1857118360bddfaa523c9f\nS: 0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002\n   slots: (0 slots) slave\n   replicates ff50bb210c08f3bd453201150be381bcb3b4f05f\nM: c8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003\n   slots: (0 slots) master\n   1 additional replica(s)\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nS: 61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 192.168.107.222:7004\n   slots: (0 slots) slave\n   replicates c8f152ea7f6f436a96af0a3364e721ff108fb20b\nS: e95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000\n   slots: (0 slots) slave\n   replicates 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\nHow many slots do you want to move (from 1 to 16384)? 2000   #\u8981\u5206\u914d\u51fa\u53bb\u591a\u5c11\u4e2a\u69fd\u4f4d\nWhat is the receiving node ID? c8f152ea7f6f436a96af0a3364e721ff108fb20b    #\u63a5\u6536\u7684redis\u7684id\u7684\u8282\u70b9\uff0c222:7003\nPlease enter all the source node IDs.\n  Type 'all' to use all the nodes as source nodes for the hash slots.\n  Type 'done' once you entered all the source nodes IDs.\nSource node #1: c4acfb2490f7557a5e1857118360bddfaa523c9f    #\u4ece\u54ea\u4e2a\u8282\u70b9id\u79fb\u52a8\u8fc7\u53bb,all\u662f\u6240\u6709\u8282\u70b9\u5e73\u5747\u5206,\u6b64\u5904\u9009\u4ece128:7000\u8282\u70b9\u79fb\u8fc7\u53bb\nSource node #2: done                             #\u4e5f\u53ef\u4ee5\u9009\u62e9\u4ece\u591a\u4e2a\u8282\u70b9id\u79fb\u52a8\u8fc7\u53bb,\u53ef\u8f93\u5165\u591a\u4e2a\u8282\u70b9id\uff0c\u6b64\u5904\u9009\u4e00\u4e2a,\u5982\u679c\u9009\u62e9\u8282\u70b9\u5b8c\u6210\u5c31\u8f93\u5165done\n....\nDo you want to proceed with the proposed reshard plan (yes/no)? yes    #\u8f93\u5165yes\uff0c\u4ed6\u5c31\u4f1a\u5e2e\u6211\u4eec\u79fb\u52a8\n...\n\n\u79fb\u52a8\u5b8c\u69fd\u4f4d\u540e\uff0c\u91cd\u65b0\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u548c\u69fd\u4f4d\u4fe1\u606f\uff1a\uff08\u5728\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u64cd\u4f5c\uff0c\u6b64\u5904\u4ee5222:7000\u8282\u70b9\u64cd\u4f5c)\n# redis-cli -a redispwd -p 7000 cluster nodes      #\u53d1\u73b0\u69fd\u4f4d\u4ece222:7000\u8282\u70b9\u5206\u8d70\u4e862000\u4e2a\u69fd\u4f4d\u7ed9222:7003\u8282\u70b9\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693050081000 5 connected 2000-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693050083000 5 connected\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693050084594 2 connected\nc8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 master - 0 1693050083585 7 connected 0-1999\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693050085000 2 connected 5461-10922\n61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 192.168.107.222:7004@17004 slave c8f152ea7f6f436a96af0a3364e721ff108fb20b 0 1693050085602 7 connected\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693050083000 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693050081565 3 connected 10923-16383\n\n\n4.\u7ed9\u65b0\u4e3b\u4eceredis\u5199\u5165\u6570\u636e\uff0c\u9a8c\u8bc1\u80fd\u6b63\u5e38\u5b58\u653e\u548c\u83b7\u53d6\u6570\u636e \uff08\u5728\u96c6\u7fa4\u4e2d\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u64cd\u4f5c\u5373\u53ef\uff0c\u6b64\u5904\u4ee5222:7000\u8282\u70b9\u4e0a\u64cd\u4f5c\uff09\n# redis-cli -a redispwd -h 192.168.107.222 -p 7003 -c\n192.168.107.222:7003&gt; set k1 v1\n-&gt; Redirected to slot [12706] located at 192.168.107.224:7002                     #\u5b58\u7684key\u5728\u4e3b\u8282\u70b9224:7002\nOK\n192.168.107.222:7003&gt; set k2 v2\n-&gt; Redirected to slot [449] located at 192.168.107.222:7003                         #\u5b58\u7684key\u5728\u4e3b\u8282\u70b9222:7003   \nOK\n192.168.107.222:7003&gt;  get k1\n-&gt; Redirected to slot [12706] located at 192.168.107.224:7002\n\"v1\"\n\n192.168.107.224:7002&gt; get k2\n-&gt; Redirected to slot [449] located at 192.168.107.222:7003\n\"v2\"\n\n\n5.\u9a8c\u8bc1\u65b0\u4e3b\u4eceredis\u7684\u9ad8\u53ef\u7528\u5207\u6362\uff08\u96c6\u7fa4\u4fe1\u606f\u67e5\u770b\u53ef\u5728\u4efb\u610f\u8282\u70b9\uff0c\u505c\u6b62\u65b0\u4e3bredis\u5728192.168.107.222\u4e0a\u64cd\u4f5c)\n1).\u505c\u6389\u65b0\u4e3bredis\u670d\u52a1\uff0c\u67e5\u770b\u65b0\u4ece\u63d0\u5347\u4e3a\u4e3b\n# ps -ef |grep redis                     #\u5728\u65b0\u4e3b222:7003\u4e0a\u64cd\u4f5c\nroot      15244      1  0 18:04 ?        00:00:08 redis-server 0.0.0.0:8000 [cluster]\nroot      21855      1  0 18:23 ?        00:00:07 redis-server 0.0.0.0:7000 [cluster]\nroot      46238      1  0 19:31 ?        00:00:02 redis-server 0.0.0.0:7003 [cluster]\nroot      46286      1  0 19:31 ?        00:00:01 redis-server 0.0.0.0:7004 [cluster]\nroot      51697   6833  0 19:46 pts/0    00:00:00 grep --color=auto redis\n\n# kill -9 46238                                   #\u505c\u6b62\u65b0\u4e3b131:7003\u8282\u70b9\n# ps -ef |grep redis\nroot      15244      1  0 18:04 ?        00:00:08 redis-server 0.0.0.0:8000 [cluster]\nroot      21855      1  0 18:23 ?        00:00:07 redis-server 0.0.0.0:7000 [cluster]\nroot      46286      1  0 19:31 ?        00:00:01 redis-server 0.0.0.0:7004 [cluster]\nroot      52095   6833  0 19:48 pts/0    00:00:00 grep --color=auto redis\n\n\n# redis-cli -a redispwd -p 7004 cluster nodes     #\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f\uff0c\u5728\u65b0\u4ece\u540e\u63d0\u5347\u4e3a\u4e3b\u7684222:7004\u4e0a\u64cd\u4f5c\uff0c\u53d1\u73b0\u65b0\u4ece222:7004\u63d0\u5347\u4e3a\u65b0\u4e3b\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693050507360 2 connected 5461-10922\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693050508371 2 connected\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 master - 0 1693050504000 5 connected 2000-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693050507000 5 connected\n61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 192.168.107.222:7004@17004 myself,master - 0 1693050507000 8 connected 0-1999\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693050506351 3 connected\n#c8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 master,fail - 1693050484145 1693050477078 7 disconnected \u8be5\u4e3b\u8282\u70b9\u5df2\u7ecf\u5173\u95ed\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693050509381 3 connected 10923-16383\n\n\n6.\u65b0\u4e3b\u6062\u590d\uff0c\u81ea\u52a8\u8f6c\u4e3a\u4ece\u89d2\u8272\uff08\u5728\u65b0\u4e3b\u4ece131\u4e0a\u64cd\u4f5c)\n# redis-server /data/cluster/7003/redis.conf                          #\u539f\u65b0\u4e3b222:7003\u8282\u70b9\u6062\u590d\n# ps -ef |grep redis\nroot      15244      1  0 18:04 ?        00:00:08 redis-server 0.0.0.0:8000 [cluster]\nroot      21855      1  0 18:23 ?        00:00:08 redis-server 0.0.0.0:7000 [cluster]\nroot      46286      1  0 19:31 ?        00:00:01 redis-server 0.0.0.0:7004 [cluster]\nroot      52830      1  0 19:50 ?        00:00:00 redis-server 0.0.0.0:7003 [cluster]\nroot      52916   6833  0 19:50 pts/0    00:00:00 grep --color=auto redis\n\n\n# redis-cli -a redispwd -p 7004 cluster nodes             #\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f\uff0c\u53d1\u73b0\u539f\u65b0\u4e3b131:7003\u81ea\u52a8\u4ee5\u4ece\u89d2\u8272\u8fd0\u884c\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693050644000 2 connected 5461-10922\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693050643000 2 connected\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 master - 0 1693050645638 5 connected 2000-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693050643000 5 connected\n#61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 192.168.107.222:7004@17004 myself,master - 0 1693050643000 8 connected 0-1999\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693050642614 3 connected\n#c8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 slave 61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 0 1693050644631 8 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693050643623 3 connected 10923-16383\n\n\n7.\u4e3a\u4e86\u4e60\u60ef\uff0c\u5c06\u539f\u65b0\u4e3b\u7684\u4ece\u89d2\u8272\u8fd8\u63d0\u5347\u4e3a\u65b0\u4e3b\u89d2\u8272\uff08\u5728\u65b0\u4e3b\u4ece222\u4e0a\u64cd\u4f5c)\n# redis-cli -a redispwd -p 7003\n127.0.0.1:7003&gt; info Replication\n# Replication\nrole:slave\nmaster_host:192.168.107.222\nmaster_port:7004\nmaster_link_status:up\nmaster_last_io_seconds_ago:5\nmaster_sync_in_progress:0\nslave_read_repl_offset:1368\nslave_repl_offset:1368\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:e376ee8f88183d53b2abc9ee67de7f401c10668b\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:1368\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1243\nrepl_backlog_histlen:126\n127.0.0.1:7003&gt; CLUSTER FAILOVER       #\u4ece\u5e93\u624b\u52a8\u63d0\u5347\u4e3a\u4e3b\u5e93\u7684\u65b9\u6cd5\n127.0.0.1:7003&gt; info Replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:ip=192.168.107.222,port=7004,state=online,offset=1410,lag=0\nmaster_failover_state:no-failover\nmaster_replid:9f7be49d29cac1d9041ac124325f3bf5144d70a4\nmaster_replid2:e376ee8f88183d53b2abc9ee67de7f401c10668b\nmaster_repl_offset:1410\nsecond_repl_offset:1411\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1243\nrepl_backlog_histlen:168\n# redis-cli -a redispwd -p 7003 cluster nodes           #\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 192.168.107.222:7004@17004 slave c8f152ea7f6f436a96af0a3364e721ff108fb20b 0 1693050759196 9 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693050760000 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693050760206 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693050758000 3 connected 10923-16383\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693050757181 5 connected\nc8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 myself,master - 0 1693050758000 9 connected 0-1999\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693050758189 2 connected\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 master - 0 1693050759000 5 connected 2000-5460\n</code></pre>"},{"location":"redis/Redis%E5%AD%A6%E4%B9%A0/#_4","title":"\u5220\u9664\u8282\u70b9","text":"<pre><code>\u5220\u9664\u4e3b\u8282\u70b9\u548c\u4ece\u8282\u70b9\uff08\u5220\u9664\u65b0\u4e3b\u8282\u70b9\u548c\u65b0\u4ece\u8282\u70b9\uff0c\u96c6\u7fa4\u76f8\u5173\u64cd\u4f5c\u53ef\u5728\u4efb\u610f\u8282\u70b9\u64cd\u4f5c\uff0c\u6b64\u5904\u5728\u65b0\u4e3b\u4ece222\u4e0a\u64cd\u4f5c)\n1).Redis\u96c6\u7fa4\u79fb\u9664\u4ece\u5e93:     \n\u79fb\u9664\u4ece\u5e93\u683c\u5f0f\uff1a\n# redis-cli -a redispwd --cluster del-node \u5bf9\u5e94\u4e3b\u5e93\u7684ip:\u4e3b\u7aef\u53e3 \u5bf9\u5e94\u4ece\u5e93\u7684id    \n\u4ece\u5e93\u79fb\u9664\u4e4b\u524d\u53ef\u4ee5\u6709\u6570\u636e\uff0c\u4f46\u79fb\u9664\u4ece\u5e93\u540e\u4f1a\u5173\u95ed\u4ece\u5e93\uff0c\u6e05\u7a7a\u6570\u636e\n\n# redis-cli -a redispwd -p 7003 cluster nodes           #\u67e5\u770b\u96c6\u7fa4\u7684\u8282\u70b9\u4fe1\u606f\u548cid\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n#61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 192.168.107.222:7004@17004 slave c8f152ea7f6f436a96af0a3364e721ff108fb20b 0 1693050759196 9 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693050760000 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693050760206 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693050758000 3 connected 10923-16383\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693050757181 5 connected\n#c8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 myself,master - 0 1693050758000 9 connected 0-1999\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693050758189 2 connected\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 master - 0 1693050759000 5 connected 2000-5460\n\n\n# redis-cli -a redispwd --cluster del-node 192.168.107.222:7003 61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24   #\u79fb\u9664\u4ece\u5e93222:7004 \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Removing node 61c1c9eb632203b3a9e021a5bf8eb1d5cee1ca24 from cluster 192.168.107.222:7003\n&gt;&gt;&gt; Sending CLUSTER FORGET messages to the cluster...\n&gt;&gt;&gt; Sending CLUSTER RESET SOFT to the deleted node.\n\n# redis-cli -a redispwd -p 7003 cluster nodes                #\u67e5\u770b\u53ea\u6709\u4e3b\u5e93131:7003\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693050884000 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693050882000 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693050881000 3 connected 10923-16383\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693050885294 5 connected\nc8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 myself,master - 0 1693050881000 9 connected 0-1999\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693050883277 2 connected\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 master - 0 1693050884284 5 connected 2000-5460\n\n\n\n2).Redis\u96c6\u7fa4\u79fb\u9664\u4e3b\u5e93:  \n\u6ce8\u610f\uff1a\u4e3b\u8282\u70b9\u5982\u679c\u6709\u6570\u636e\uff0c\u662f\u5220\u9664\u4e0d\u6389\u7684\uff0c\u5220\u9664\u4e4b\u524d\u5148\u8fdb\u884c\u4e3b\u8282\u70b9\u6570\u636e\u7684\u8fc1\u79fb\uff0c\u6b64\u5904\u5c06\u65b0\u4e3b131:7003\u8fd8\u8fc1\u79fb\u56de\u4e3b\u8282\u70b9128:7000\n\u96c6\u7fa4\u79fb\u9664\u4e3b\u8282\u70b9\u7684\u683c\u5f0f\uff1a\n# redis-cli -a redispwd --cluster del-node \u968f\u4fbf\u4e00\u4e2a\u5176\u4ed6\u4e3b\u8282\u70b9:\u4e3b\u7aef\u53e3  \u8981\u79fb\u9664\u4e3b\u8282\u70b9\u7684id\n\n# redis-cli -a redispwd -p 7003 cluster nodes      #\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n69d305ad0b4ba25b7d1d84c7ea7cb86218a28a8c 192.168.27.128:7000@17000 master - 0 1668694034612 5 connected 2000-5460\n01ab5c82622921138dd28d2b2fd2772e4ad65041 192.168.27.131:7003@17003 myself,master - 0 1668693596000 8 connected 0-1999\n122bfd4294666e2d60502f0466010783a9af12bd 192.168.27.129:8001@18001 slave 69d305ad0b4ba25b7d1d84c7ea7cb86218a28a8c 0 1668694032570 5 connected\n57c57905eea202b9fe1b47515cc4ea2851f608e6 192.168.27.130:8002@18002 slave 4301c9c511c84d99b4aa07fd53207c48da8e449e 0 1668694032368 2 connected\n4301c9c511c84d99b4aa07fd53207c48da8e449e 192.168.27.129:7001@17001 master - 0 1668694033587 2 connected 5461-10922\n781c3d1823c2efe8930eaabab7ff3c1e49b42f93 192.168.27.128:8000@18000 slave 390a2f7cb23d038982a42569f98c03cb13ff5a87 0 1668694035627 3 connected\n390a2f7cb23d038982a42569f98c03cb13ff5a87 192.168.27.130:7002@17002 master - 0 1668694031552 3 connected 10923-16383\n\n\u79fb\u9664\u65b0\u4e3b222:7003\u524d\u5148\u8fc1\u79fb\u6570\u636e\uff1a\n# redis-cli -a redispwd --cluster reshard 192.168.107.222:7003  #\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u8fde\u63a5\u96c6\u7fa4\u5373\u53ef,\u91cd\u65b0\u5206\u914d\u69fd\u4f4d,:7003\u7684\u69fd\u4f4d\u79fb\u52a8\u5230222:7000\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Performing Cluster Check (using node 192.168.107.222:7003)\nM: c8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003\n   slots:[0-1999] (2000 slots) master\nM: ff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nS: e95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000\n   slots: (0 slots) slave\n   replicates 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095\nM: 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nS: ffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001\n   slots: (0 slots) slave\n   replicates c4acfb2490f7557a5e1857118360bddfaa523c9f\nS: 0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002\n   slots: (0 slots) slave\n   replicates ff50bb210c08f3bd453201150be381bcb3b4f05f\nM: c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000\n   slots:[2000-5460] (3461 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n&gt;&gt;&gt; Check for open slots...\n&gt;&gt;&gt; Check slots coverage...\n[OK] All 16384 slots covered.\nHow many slots do you want to move (from 1 to 16384)? 2000            #\u79fb\u52a82000\u4e2a\u69fd\u4f4d\nWhat is the receiving node ID? c4acfb2490f7557a5e1857118360bddfaa523c9f     #\u63a5\u6536\u7684id\uff0c\u8ba9222:7000\u63a5\u6536\nSource node #1: c8f152ea7f6f436a96af0a3364e721ff108fb20b            #\u628a\u54ea\u4e2a\u8282\u70b9\u7684\u69fd\u4f4d\u79fb\u8d70\uff0c222:7003\nSource node #2: done                    #\u9009\u62e9\u5b8c\u6bd5\u4e86\uff0c\u8f93\u5165done\uff0c\u8ba9\u5176\u64cd\u4f5c\n...\nDo you want to proceed with the proposed reshard plan (yes/no)? yes\n...\n# redis-cli -a redispwd -p 7003 cluster nodes      #\u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f,222:7003\u7684\u69fd\u4f4d\u5df2\u7ecf\u8f6c\u79fb\u7ed9222:7000\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693051157631 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693051156000 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693051158637 3 connected 10923-16383\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693051155000 10 connected\n#c8f152ea7f6f436a96af0a3364e721ff108fb20b 192.168.107.222:7003@17003 myself,master - 0 1693051157000 9 connected\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693051156000 2 connected\n#c4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 master - 0 1693051156625 10 connected 0-5460\n\n\n\n\u6307\u5b9a\u4e3b222:7000,\u79fb\u9664\u65b0\u4e3b222:7003\u7684id:  \n# redis-cli -a redispwd --cluster del-node 192.168.107.222:7000 c8f152ea7f6f436a96af0a3364e721ff108fb20b  \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n&gt;&gt;&gt; Removing node c8f152ea7f6f436a96af0a3364e721ff108fb20b from cluster 192.168.107.222:7000\n&gt;&gt;&gt; Sending CLUSTER FORGET messages to the cluster...\n&gt;&gt;&gt; Sending CLUSTER RESET SOFT to the deleted node.\n\n\n\u4e0a\u9762\u5c06222\u4e0a\u4e3b\u4ece\u8282\u70b9\u79fb\u9664\u4e3b\u4ece\u4e4b\u524d\u90fd\u53ef\u4ee5\u4f7f\u7528\u96c6\u7fa4\u64cd\u4f5c\u547d\u4ee4\uff0c\u4f46\u4e3b\u4ece\u90fd\u79fb\u9664\u96c6\u7fa4\u540e\uff0c\u518d\u6267\u884c\u67e5\u770b\u96c6\u7fa4\u7b49\u64cd\u4f5c\u5c31\u9700\u8981\u5728\u5176\u4ed6\u96c6\u7fa4\u8282\u70b9\u4e86\n\u5728222:7000\u8282\u70b9\u67e5\u770b\u73b0\u5728\u96c6\u7fa4\u72b6\u6001\uff1a\u53d1\u73b0\u65b0\u4e3b\u65b0\u4ece\u8282\u70b9\u90fd\u5df2\u7ecf\u79fb\u9664\u51fa\u53bb\uff1a\n# redis-cli -a redispwd -p 7000 cluster nodes\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\nc4acfb2490f7557a5e1857118360bddfaa523c9f 192.168.107.222:7000@17000 myself,master - 0 1693051315000 10 connected 0-5460\nffb3bd0c4d3fade126022f2f90691a9cbde30f16 192.168.107.223:8001@18001 slave c4acfb2490f7557a5e1857118360bddfaa523c9f 0 1693051315528 10 connected\n0a42290ad59f7ac2565bb1f3c6fe2ecbe45647ca 192.168.107.224:8002@18002 slave ff50bb210c08f3bd453201150be381bcb3b4f05f 0 1693051314518 2 connected\nff50bb210c08f3bd453201150be381bcb3b4f05f 192.168.107.223:7001@17001 master - 0 1693051314000 2 connected 5461-10922\ne95d7e90e12b045e3f5bab0d27519770f46d42ae 192.168.107.222:8000@18000 slave 2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 0 1693051316535 3 connected\n2611c9f0da19d1ee2b4d4f8c4b5f7fb617fdb095 192.168.107.224:7002@17002 master - 0 1693051315000 3 connected 10923-16383\n</code></pre>"}]}