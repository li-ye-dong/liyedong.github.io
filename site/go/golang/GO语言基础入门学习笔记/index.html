
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="美少男">
      
      
        <meta name="author" content="李烨栋">
      
      
        <link rel="canonical" href="https://li-ye-dong.github.io/go/golang/GO%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
      
      
        <link rel="prev" href="../../../PDF/">
      
      
        <link rel="next" href="../../../k8s%E5%92%8C%E5%AE%B9%E5%99%A8/KubeSphere%E4%BD%93%E9%AA%8C/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>GO语言基础入门学习笔记 - 李烨栋的博客</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../static/stylesheets/google_font.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#go语言基础入门学习笔记" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="李烨栋的博客" class="md-header__button md-logo" aria-label="李烨栋的博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            李烨栋的博客
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GO语言基础入门学习笔记
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="日间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="日间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="夜间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/li-ye-dong/liyedong.github.io.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    li-ye-dong.github.io
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  知识库索引

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../PDF/" class="md-tabs__link">
          
  
    
  
  PDF

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  Go

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../k8s%E5%92%8C%E5%AE%B9%E5%99%A8/KubeSphere%E4%BD%93%E9%AA%8C/" class="md-tabs__link">
          
  
    
  
  K8s和容器

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/Nginx%E5%AD%A6%E4%B9%A0/" class="md-tabs__link">
          
  
    
  
  中间件

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%AE%89%E5%85%A8/Burp%20Suite%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/" class="md-tabs__link">
          
  
    
  
  安全

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%BC%80%E5%8F%91/FastApi%E5%AD%A6%E4%B9%A0/" class="md-tabs__link">
          
  
    
  
  开发

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/RHEL9/RHEL9-RHCE%E5%AD%A6%E4%B9%A0/" class="md-tabs__link">
          
  
    
  
  操作系统

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/MongoDB/MongoDB%20%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB/" class="md-tabs__link">
          
  
    
  
  数据库笔记

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%99%9A%E6%8B%9F%E5%8C%96/%E8%99%9A%E6%8B%9F%E5%8C%96/RVtools%E4%BD%BF%E7%94%A8/" class="md-tabs__link">
          
  
    
  
  虚拟化

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%85%B3/credly%E6%9F%A5%E7%9C%8B%E5%8B%8B%E7%AB%A0/" class="md-tabs__link">
          
  
    
  
  认证相关

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="李烨栋的博客" class="md-nav__button md-logo" aria-label="李烨栋的博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    李烨栋的博客
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/li-ye-dong/liyedong.github.io.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    li-ye-dong.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    知识库索引
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../PDF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    PDF
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Go
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Go
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Golang
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Golang
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    GO语言基础入门学习笔记
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    GO语言基础入门学习笔记
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="在这个页面">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      在这个页面
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-go-语言简介" class="md-nav__link">
    <span class="md-ellipsis">
      1. Go 语言简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Go 语言简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-什么是-go-语言" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 什么是 Go 语言
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1 什么是 Go 语言">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#主要特点" class="md-nav__link">
    <span class="md-ellipsis">
      主要特点：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#历史背景" class="md-nav__link">
    <span class="md-ellipsis">
      历史背景：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例hello-world-程序" class="md-nav__link">
    <span class="md-ellipsis">
      示例：Hello World 程序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-go-语言的特点" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Go 语言的特点
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.2 Go 语言的特点">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-简洁性" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.1 简洁性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-高性能" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.2 高性能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-并发支持" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.3 并发支持
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-内存管理" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.4 内存管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#125-强大的标准库" class="md-nav__link">
    <span class="md-ellipsis">
      1.2.5 强大的标准库
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-go-语言的应用场景" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 Go 语言的应用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.3 Go 语言的应用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-web-开发" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.1 Web 开发
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-云服务和微服务" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.2 云服务和微服务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-网络编程" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.3 网络编程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#134-系统工具和命令行工具" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.4 系统工具和命令行工具
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#135-数据处理和大数据" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.5 数据处理和大数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#136-devops-工具" class="md-nav__link">
    <span class="md-ellipsis">
      1.3.6 DevOps 工具
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-安装与配置-go-环境" class="md-nav__link">
    <span class="md-ellipsis">
      1.4 安装与配置 Go 环境
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4 安装与配置 Go 环境">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-下载并安装" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1 下载并安装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4.1 下载并安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1411-官方下载页面" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1.1 官方下载页面
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1412-安装步骤" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.1.2 安装步骤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-配置环境变量" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.2 配置环境变量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4.2 配置环境变量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos-和-linux" class="md-nav__link">
    <span class="md-ellipsis">
      macOS 和 Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#验证环境变量" class="md-nav__link">
    <span class="md-ellipsis">
      验证环境变量
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-验证安装" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.3 验证安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-配置-go-modules推荐" class="md-nav__link">
    <span class="md-ellipsis">
      1.4.4 配置 Go Modules（推荐）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.4.4 配置 Go Modules（推荐）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#启用-go-modules" class="md-nav__link">
    <span class="md-ellipsis">
      启用 Go Modules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例使用-go-modules" class="md-nav__link">
    <span class="md-ellipsis">
      示例：使用 Go Modules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-go-开发工具" class="md-nav__link">
    <span class="md-ellipsis">
      2. Go 开发工具
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Go 开发工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-常用编辑器和-ide" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 常用编辑器和 IDE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 常用编辑器和 IDE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visual-studio-code-vs-code" class="md-nav__link">
    <span class="md-ellipsis">
      Visual Studio Code (VS Code)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goland" class="md-nav__link">
    <span class="md-ellipsis">
      GoLand
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vimneovim" class="md-nav__link">
    <span class="md-ellipsis">
      Vim/Neovim
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#liteide" class="md-nav__link">
    <span class="md-ellipsis">
      LiteIDE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-go-module-管理" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Go Module 管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 Go Module 管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#初始化模块" class="md-nav__link">
    <span class="md-ellipsis">
      初始化模块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#添加依赖" class="md-nav__link">
    <span class="md-ellipsis">
      添加依赖
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#管理版本" class="md-nav__link">
    <span class="md-ellipsis">
      管理版本
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-基本语法与数据类型" class="md-nav__link">
    <span class="md-ellipsis">
      3. 基本语法与数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 基本语法与数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-第一个-go-程序" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 第一个 Go 程序
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.1 第一个 Go 程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-函数" class="md-nav__link">
    <span class="md-ellipsis">
      main 函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fmtprintln-输出" class="md-nav__link">
    <span class="md-ellipsis">
      fmt.Println() 输出
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-变量与常量" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 变量与常量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2 变量与常量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#声明变量" class="md-nav__link">
    <span class="md-ellipsis">
      声明变量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#短变量声明" class="md-nav__link">
    <span class="md-ellipsis">
      短变量声明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常量与枚举" class="md-nav__link">
    <span class="md-ellipsis">
      常量与枚举
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-数据类型" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 数据类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.3 数据类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#基本类型" class="md-nav__link">
    <span class="md-ellipsis">
      基本类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基本类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#整型" class="md-nav__link">
    <span class="md-ellipsis">
      整型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#浮点型" class="md-nav__link">
    <span class="md-ellipsis">
      浮点型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#字符串" class="md-nav__link">
    <span class="md-ellipsis">
      字符串
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#布尔型" class="md-nav__link">
    <span class="md-ellipsis">
      布尔型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#复合类型" class="md-nav__link">
    <span class="md-ellipsis">
      复合类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="复合类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#数组" class="md-nav__link">
    <span class="md-ellipsis">
      数组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#切片" class="md-nav__link">
    <span class="md-ellipsis">
      切片
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map" class="md-nav__link">
    <span class="md-ellipsis">
      Map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#结构体" class="md-nav__link">
    <span class="md-ellipsis">
      结构体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#指针" class="md-nav__link">
    <span class="md-ellipsis">
      指针
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-类型转换" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 类型转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-控制结构" class="md-nav__link">
    <span class="md-ellipsis">
      4. 控制结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. 控制结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-条件语句" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 条件语句
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 条件语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-和-else" class="md-nav__link">
    <span class="md-ellipsis">
      if 和 else
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch-语句" class="md-nav__link">
    <span class="md-ellipsis">
      switch 语句
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-循环语句" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 循环语句
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 循环语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-循环" class="md-nav__link">
    <span class="md-ellipsis">
      for 循环
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-遍历" class="md-nav__link">
    <span class="md-ellipsis">
      Range 遍历
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-跳转语句" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 跳转语句
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 跳转语句">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#break" class="md-nav__link">
    <span class="md-ellipsis">
      break
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      continue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goto" class="md-nav__link">
    <span class="md-ellipsis">
      goto
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-函数" class="md-nav__link">
    <span class="md-ellipsis">
      5. 函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. 函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-函数定义与调用" class="md-nav__link">
    <span class="md-ellipsis">
      5.1 函数定义与调用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.1 函数定义与调用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#函数的基本定义" class="md-nav__link">
    <span class="md-ellipsis">
      函数的基本定义
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#带参数的函数" class="md-nav__link">
    <span class="md-ellipsis">
      带参数的函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#带返回值的函数" class="md-nav__link">
    <span class="md-ellipsis">
      带返回值的函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#多返回值函数" class="md-nav__link">
    <span class="md-ellipsis">
      多返回值函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#命名返回值" class="md-nav__link">
    <span class="md-ellipsis">
      命名返回值
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-函数参数和返回值" class="md-nav__link">
    <span class="md-ellipsis">
      5.2 函数参数和返回值
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.2 函数参数和返回值">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#参数传递方式" class="md-nav__link">
    <span class="md-ellipsis">
      参数传递方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用指针传递参数" class="md-nav__link">
    <span class="md-ellipsis">
      使用指针传递参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#多参数函数" class="md-nav__link">
    <span class="md-ellipsis">
      多参数函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#可选参数" class="md-nav__link">
    <span class="md-ellipsis">
      可选参数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-可变参数函数" class="md-nav__link">
    <span class="md-ellipsis">
      5.3 可变参数函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.3 可变参数函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#定义可变参数函数" class="md-nav__link">
    <span class="md-ellipsis">
      定义可变参数函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用可变参数的其他示例" class="md-nav__link">
    <span class="md-ellipsis">
      使用可变参数的其他示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#将切片传递给可变参数函数" class="md-nav__link">
    <span class="md-ellipsis">
      将切片传递给可变参数函数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-匿名函数与闭包" class="md-nav__link">
    <span class="md-ellipsis">
      5.4 匿名函数与闭包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.4 匿名函数与闭包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#匿名函数" class="md-nav__link">
    <span class="md-ellipsis">
      匿名函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#闭包" class="md-nav__link">
    <span class="md-ellipsis">
      闭包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#闭包的应用场景" class="md-nav__link">
    <span class="md-ellipsis">
      闭包的应用场景
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-函数作为值和类型" class="md-nav__link">
    <span class="md-ellipsis">
      5.5 函数作为值和类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.5 函数作为值和类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#将函数赋值给变量" class="md-nav__link">
    <span class="md-ellipsis">
      将函数赋值给变量
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#将函数作为参数传递" class="md-nav__link">
    <span class="md-ellipsis">
      将函数作为参数传递
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#将函数作为返回值" class="md-nav__link">
    <span class="md-ellipsis">
      将函数作为返回值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用函数作为数据结构的元素" class="md-nav__link">
    <span class="md-ellipsis">
      使用函数作为数据结构的元素
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#函数作为接口的实现" class="md-nav__link">
    <span class="md-ellipsis">
      函数作为接口的实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-go-的内置库" class="md-nav__link">
    <span class="md-ellipsis">
      6. Go 的内置库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Go 的内置库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-fmt-包" class="md-nav__link">
    <span class="md-ellipsis">
      6.1 fmt 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.1 fmt 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用函数" class="md-nav__link">
    <span class="md-ellipsis">
      常用函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例与用法" class="md-nav__link">
    <span class="md-ellipsis">
      示例与用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-math-包" class="md-nav__link">
    <span class="md-ellipsis">
      6.2 math 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 math 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用常数" class="md-nav__link">
    <span class="md-ellipsis">
      常用常数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常用函数_1" class="md-nav__link">
    <span class="md-ellipsis">
      常用函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例与用法_1" class="md-nav__link">
    <span class="md-ellipsis">
      示例与用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_1" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-time-包" class="md-nav__link">
    <span class="md-ellipsis">
      6.3 time 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.3 time 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用功能" class="md-nav__link">
    <span class="md-ellipsis">
      常用功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#时间格式化布局" class="md-nav__link">
    <span class="md-ellipsis">
      时间格式化布局
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例与用法_2" class="md-nav__link">
    <span class="md-ellipsis">
      示例与用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_2" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-strings-包" class="md-nav__link">
    <span class="md-ellipsis">
      6.4 strings 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.4 strings 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用函数_2" class="md-nav__link">
    <span class="md-ellipsis">
      常用函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例与用法_3" class="md-nav__link">
    <span class="md-ellipsis">
      示例与用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_3" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#65-io-和-os-包" class="md-nav__link">
    <span class="md-ellipsis">
      6.5 io 和 os 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.5 io 和 os 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#io-包" class="md-nav__link">
    <span class="md-ellipsis">
      io 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="io 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用接口" class="md-nav__link">
    <span class="md-ellipsis">
      常用接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常用函数_3" class="md-nav__link">
    <span class="md-ellipsis">
      常用函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例与用法_4" class="md-nav__link">
    <span class="md-ellipsis">
      示例与用法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_4" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#os-包" class="md-nav__link">
    <span class="md-ellipsis">
      os 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="os 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#常用功能_1" class="md-nav__link">
    <span class="md-ellipsis">
      常用功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例与用法_5" class="md-nav__link">
    <span class="md-ellipsis">
      示例与用法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_5" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#66-bufio-包拓展内容" class="md-nav__link">
    <span class="md-ellipsis">
      6.6 bufio 包（拓展内容）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.6 bufio 包（拓展内容）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bufio-包简介" class="md-nav__link">
    <span class="md-ellipsis">
      bufio 包简介
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常用类型和函数" class="md-nav__link">
    <span class="md-ellipsis">
      常用类型和函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例与用法_6" class="md-nav__link">
    <span class="md-ellipsis">
      示例与用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_6" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-数据结构与集合" class="md-nav__link">
    <span class="md-ellipsis">
      7. 数据结构与集合
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. 数据结构与集合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-数组" class="md-nav__link">
    <span class="md-ellipsis">
      7.1 数组
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.1 数组">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#数组的声明与初始化" class="md-nav__link">
    <span class="md-ellipsis">
      数组的声明与初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#数组的操作" class="md-nav__link">
    <span class="md-ellipsis">
      数组的操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_7" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-切片" class="md-nav__link">
    <span class="md-ellipsis">
      7.2 切片
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2 切片">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#切片的声明与初始化" class="md-nav__link">
    <span class="md-ellipsis">
      切片的声明与初始化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#切片的操作" class="md-nav__link">
    <span class="md-ellipsis">
      切片的操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#切片的底层原理" class="md-nav__link">
    <span class="md-ellipsis">
      切片的底层原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_8" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-map" class="md-nav__link">
    <span class="md-ellipsis">
      7.3 Map
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.3 Map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#map-的声明与使用" class="md-nav__link">
    <span class="md-ellipsis">
      Map 的声明与使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map-的遍历与修改" class="md-nav__link">
    <span class="md-ellipsis">
      Map 的遍历与修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_9" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-结构体" class="md-nav__link">
    <span class="md-ellipsis">
      7.4 结构体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.4 结构体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#定义结构体" class="md-nav__link">
    <span class="md-ellipsis">
      定义结构体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#结构体实例化" class="md-nav__link">
    <span class="md-ellipsis">
      结构体实例化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#嵌套结构体" class="md-nav__link">
    <span class="md-ellipsis">
      嵌套结构体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法与结构体" class="md-nav__link">
    <span class="md-ellipsis">
      方法与结构体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_10" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-指针与结构体" class="md-nav__link">
    <span class="md-ellipsis">
      7.5 指针与结构体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.5 指针与结构体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#指针基础" class="md-nav__link">
    <span class="md-ellipsis">
      指针基础
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#指针与结构体" class="md-nav__link">
    <span class="md-ellipsis">
      指针与结构体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#指针的高级用法" class="md-nav__link">
    <span class="md-ellipsis">
      指针的高级用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_11" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-组合与接口拓展内容" class="md-nav__link">
    <span class="md-ellipsis">
      7.6 组合与接口（拓展内容）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.6 组合与接口（拓展内容）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#组合composition" class="md-nav__link">
    <span class="md-ellipsis">
      组合（Composition）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#接口interface" class="md-nav__link">
    <span class="md-ellipsis">
      接口（Interface）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_12" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-面向对象编程" class="md-nav__link">
    <span class="md-ellipsis">
      8. 面向对象编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. 面向对象编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-go-的面向对象特性" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 Go 的面向对象特性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.1 Go 的面向对象特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#封装encapsulation" class="md-nav__link">
    <span class="md-ellipsis">
      封装（Encapsulation）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法methods" class="md-nav__link">
    <span class="md-ellipsis">
      方法（Methods）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-方法" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.2 方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#方法的定义与调用" class="md-nav__link">
    <span class="md-ellipsis">
      方法的定义与调用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法的接收者" class="md-nav__link">
    <span class="md-ellipsis">
      方法的接收者
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法的嵌套与组合" class="md-nav__link">
    <span class="md-ellipsis">
      方法的嵌套与组合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-接口" class="md-nav__link">
    <span class="md-ellipsis">
      8.3 接口
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.3 接口">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#定义接口" class="md-nav__link">
    <span class="md-ellipsis">
      定义接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#实现接口" class="md-nav__link">
    <span class="md-ellipsis">
      实现接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#空接口与类型断言" class="md-nav__link">
    <span class="md-ellipsis">
      空接口与类型断言
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-组合与继承" class="md-nav__link">
    <span class="md-ellipsis">
      8.4 组合与继承
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.4 组合与继承">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#结构体嵌套" class="md-nav__link">
    <span class="md-ellipsis">
      结构体嵌套
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#多态polymorphism" class="md-nav__link">
    <span class="md-ellipsis">
      多态（Polymorphism）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85-指针与结构体" class="md-nav__link">
    <span class="md-ellipsis">
      8.5 指针与结构体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.5 指针与结构体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#指针基础_1" class="md-nav__link">
    <span class="md-ellipsis">
      指针基础
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#指针与结构体_1" class="md-nav__link">
    <span class="md-ellipsis">
      指针与结构体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#指针的高级用法_1" class="md-nav__link">
    <span class="md-ellipsis">
      指针的高级用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_13" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-并发编程" class="md-nav__link">
    <span class="md-ellipsis">
      9. 并发编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. 并发编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-什么是-goroutine" class="md-nav__link">
    <span class="md-ellipsis">
      9.1 什么是 Goroutine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 什么是 Goroutine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#启动-goroutine" class="md-nav__link">
    <span class="md-ellipsis">
      启动 Goroutine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goroutine-的调度" class="md-nav__link">
    <span class="md-ellipsis">
      Goroutine 的调度
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-通道-channel" class="md-nav__link">
    <span class="md-ellipsis">
      9.2 通道 (Channel)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.2 通道 (Channel)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#通道的定义与使用" class="md-nav__link">
    <span class="md-ellipsis">
      通道的定义与使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#缓冲通道与无缓冲通道" class="md-nav__link">
    <span class="md-ellipsis">
      缓冲通道与无缓冲通道
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#单向通道" class="md-nav__link">
    <span class="md-ellipsis">
      单向通道
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-sync-包" class="md-nav__link">
    <span class="md-ellipsis">
      9.3 sync 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.3 sync 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#waitgroup" class="md-nav__link">
    <span class="md-ellipsis">
      WaitGroup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutex" class="md-nav__link">
    <span class="md-ellipsis">
      Mutex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#once" class="md-nav__link">
    <span class="md-ellipsis">
      Once
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-context-包" class="md-nav__link">
    <span class="md-ellipsis">
      9.4 context 包
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.4 context 包">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#context-的用法" class="md-nav__link">
    <span class="md-ellipsis">
      Context 的用法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-的取消与超时" class="md-nav__link">
    <span class="md-ellipsis">
      Context 的取消与超时
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-的传递与使用" class="md-nav__link">
    <span class="md-ellipsis">
      Context 的传递与使用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-错误处理" class="md-nav__link">
    <span class="md-ellipsis">
      10. 错误处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. 错误处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-错误类型" class="md-nav__link">
    <span class="md-ellipsis">
      10.1 错误类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10.1 错误类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-接口" class="md-nav__link">
    <span class="md-ellipsis">
      error 接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#自定义错误" class="md-nav__link">
    <span class="md-ellipsis">
      自定义错误
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-panic-和-recover" class="md-nav__link">
    <span class="md-ellipsis">
      10.2 panic 和 recover
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10.2 panic 和 recover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#panic" class="md-nav__link">
    <span class="md-ellipsis">
      panic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover" class="md-nav__link">
    <span class="md-ellipsis">
      recover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#103-错误处理模式" class="md-nav__link">
    <span class="md-ellipsis">
      10.3 错误处理模式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10.3 错误处理模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#返回错误" class="md-nav__link">
    <span class="md-ellipsis">
      返回错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用封装工具处理" class="md-nav__link">
    <span class="md-ellipsis">
      使用封装工具处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用封装工具处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用fmterrorf和w进行错误包装" class="md-nav__link">
    <span class="md-ellipsis">
      使用fmt.Errorf和%w进行错误包装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用第三方库进行错误处理" class="md-nav__link">
    <span class="md-ellipsis">
      使用第三方库进行错误处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用errorsas进行错误类型转换" class="md-nav__link">
    <span class="md-ellipsis">
      使用errors.As进行错误类型转换
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#错误处理模式的选择" class="md-nav__link">
    <span class="md-ellipsis">
      错误处理模式的选择
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-文件操作" class="md-nav__link">
    <span class="md-ellipsis">
      11. 文件操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. 文件操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-文件读写" class="md-nav__link">
    <span class="md-ellipsis">
      11.1 文件读写
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.1 文件读写">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#打开与关闭文件" class="md-nav__link">
    <span class="md-ellipsis">
      打开与关闭文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#文件的读取与写入" class="md-nav__link">
    <span class="md-ellipsis">
      文件的读取与写入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_14" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-文件夹操作" class="md-nav__link">
    <span class="md-ellipsis">
      11.2 文件夹操作
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.2 文件夹操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#创建与删除文件夹" class="md-nav__link">
    <span class="md-ellipsis">
      创建与删除文件夹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#遍历文件夹" class="md-nav__link">
    <span class="md-ellipsis">
      遍历文件夹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_15" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-文件信息" class="md-nav__link">
    <span class="md-ellipsis">
      11.3 文件信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.3 文件信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#获取文件信息" class="md-nav__link">
    <span class="md-ellipsis">
      获取文件信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例获取目录信息" class="md-nav__link">
    <span class="md-ellipsis">
      示例：获取目录信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#文件权限与模式" class="md-nav__link">
    <span class="md-ellipsis">
      文件权限与模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#获取符号链接的目标" class="md-nav__link">
    <span class="md-ellipsis">
      获取符号链接的目标
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_16" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-文件信息拓展内容" class="md-nav__link">
    <span class="md-ellipsis">
      11.4 文件信息（拓展内容）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.4 文件信息（拓展内容）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#获取文件元数据" class="md-nav__link">
    <span class="md-ellipsis">
      获取文件元数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#修改文件权限" class="md-nav__link">
    <span class="md-ellipsis">
      修改文件权限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#重命名文件" class="md-nav__link">
    <span class="md-ellipsis">
      重命名文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#获取文件大小和修改时间" class="md-nav__link">
    <span class="md-ellipsis">
      获取文件大小和修改时间
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_17" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-网络编程" class="md-nav__link">
    <span class="md-ellipsis">
      12. 网络编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. 网络编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-http-编程" class="md-nav__link">
    <span class="md-ellipsis">
      12.1 HTTP 编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.1 HTTP 编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用-nethttp-包" class="md-nav__link">
    <span class="md-ellipsis">
      使用 net/http 包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建-http-服务" class="md-nav__link">
    <span class="md-ellipsis">
      创建 HTTP 服务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-客户端" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP 客户端
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_18" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-socket-编程" class="md-nav__link">
    <span class="md-ellipsis">
      12.2 Socket 编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.2 Socket 编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcp-服务端与客户端" class="md-nav__link">
    <span class="md-ellipsis">
      TCP 服务端与客户端
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#udp-服务端与客户端" class="md-nav__link">
    <span class="md-ellipsis">
      UDP 服务端与客户端
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_19" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-网络请求与响应" class="md-nav__link">
    <span class="md-ellipsis">
      12.3 网络请求与响应
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.3 网络请求与响应">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#构建和处理http请求" class="md-nav__link">
    <span class="md-ellipsis">
      构建和处理HTTP请求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#管理socket数据的发送与接收" class="md-nav__link">
    <span class="md-ellipsis">
      管理Socket数据的发送与接收
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_20" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-网络请求与响应拓展内容" class="md-nav__link">
    <span class="md-ellipsis">
      12.4 网络请求与响应（拓展内容）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.4 网络请求与响应（拓展内容）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#构建http请求" class="md-nav__link">
    <span class="md-ellipsis">
      构建HTTP请求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#处理http响应" class="md-nav__link">
    <span class="md-ellipsis">
      处理HTTP响应
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#高级http功能" class="md-nav__link">
    <span class="md-ellipsis">
      高级HTTP功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_21" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-socket-编程拓展内容" class="md-nav__link">
    <span class="md-ellipsis">
      12.4 Socket 编程（拓展内容）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12.4 Socket 编程（拓展内容）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#建立socket连接" class="md-nav__link">
    <span class="md-ellipsis">
      建立Socket连接
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#socket数据的发送与接收" class="md-nav__link">
    <span class="md-ellipsis">
      Socket数据的发送与接收
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用socket的高级功能" class="md-nav__link">
    <span class="md-ellipsis">
      使用Socket的高级功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_22" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#125-总结" class="md-nav__link">
    <span class="md-ellipsis">
      12.5 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-测试" class="md-nav__link">
    <span class="md-ellipsis">
      13. 测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. 测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-单元测试" class="md-nav__link">
    <span class="md-ellipsis">
      13.1 单元测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.1 单元测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用-testing-包" class="md-nav__link">
    <span class="md-ellipsis">
      使用 testing 包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#编写测试用例" class="md-nav__link">
    <span class="md-ellipsis">
      编写测试用例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-testing-包的其他功能" class="md-nav__link">
    <span class="md-ellipsis">
      使用 testing 包的其他功能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用 testing 包的其他功能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#基准测试benchmark-tests" class="md-nav__link">
    <span class="md-ellipsis">
      基准测试（Benchmark Tests）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例测试example-tests" class="md-nav__link">
    <span class="md-ellipsis">
      示例测试（Example Tests）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#运行测试" class="md-nav__link">
    <span class="md-ellipsis">
      运行测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-性能测试" class="md-nav__link">
    <span class="md-ellipsis">
      13.2 性能测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.2 性能测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benchmark-测试" class="md-nav__link">
    <span class="md-ellipsis">
      benchmark 测试
    </span>
  </a>
  
    <nav class="md-nav" aria-label="benchmark 测试">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#编写基准测试" class="md-nav__link">
    <span class="md-ellipsis">
      编写基准测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#运行基准测试" class="md-nav__link">
    <span class="md-ellipsis">
      运行基准测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#优化基准测试" class="md-nav__link">
    <span class="md-ellipsis">
      优化基准测试
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#基准测试结果解释" class="md-nav__link">
    <span class="md-ellipsis">
      基准测试结果解释
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#结合基准测试进行性能优化" class="md-nav__link">
    <span class="md-ellipsis">
      结合基准测试进行性能优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_23" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-测试覆盖率" class="md-nav__link">
    <span class="md-ellipsis">
      13.3 测试覆盖率
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13.3 测试覆盖率">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#测试覆盖率概述" class="md-nav__link">
    <span class="md-ellipsis">
      测试覆盖率概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#生成覆盖率报告" class="md-nav__link">
    <span class="md-ellipsis">
      生成覆盖率报告
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#分析覆盖率报告" class="md-nav__link">
    <span class="md-ellipsis">
      分析覆盖率报告
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#提高测试覆盖率的策略" class="md-nav__link">
    <span class="md-ellipsis">
      提高测试覆盖率的策略
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#注意事项_24" class="md-nav__link">
    <span class="md-ellipsis">
      注意事项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#134-总结" class="md-nav__link">
    <span class="md-ellipsis">
      13.4 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-常用工具与最佳实践" class="md-nav__link">
    <span class="md-ellipsis">
      14. 常用工具与最佳实践
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14. 常用工具与最佳实践">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-go-常用命令" class="md-nav__link">
    <span class="md-ellipsis">
      14.1 Go 常用命令
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14.1 Go 常用命令">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-build" class="md-nav__link">
    <span class="md-ellipsis">
      go build
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-run" class="md-nav__link">
    <span class="md-ellipsis">
      go run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-test" class="md-nav__link">
    <span class="md-ellipsis">
      go test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-fmt" class="md-nav__link">
    <span class="md-ellipsis">
      go fmt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#go-mod" class="md-nav__link">
    <span class="md-ellipsis">
      go mod
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-go-代码风格" class="md-nav__link">
    <span class="md-ellipsis">
      14.2 Go 代码风格
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14.2 Go 代码风格">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用-go-fmt-统一代码格式" class="md-nav__link">
    <span class="md-ellipsis">
      使用 go fmt 统一代码格式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#命名约定" class="md-nav__link">
    <span class="md-ellipsis">
      命名约定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#避免过长的函数和方法" class="md-nav__link">
    <span class="md-ellipsis">
      避免过长的函数和方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#错误处理" class="md-nav__link">
    <span class="md-ellipsis">
      错误处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用接口简化代码" class="md-nav__link">
    <span class="md-ellipsis">
      使用接口简化代码
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-日志处理" class="md-nav__link">
    <span class="md-ellipsis">
      14.3 日志处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14.3 日志处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用-log-包" class="md-nav__link">
    <span class="md-ellipsis">
      使用 log 包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#第三方日志库" class="md-nav__link">
    <span class="md-ellipsis">
      第三方日志库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第三方日志库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logrus" class="md-nav__link">
    <span class="md-ellipsis">
      logrus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zap" class="md-nav__link">
    <span class="md-ellipsis">
      zap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zerolog" class="md-nav__link">
    <span class="md-ellipsis">
      zerolog
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-性能优化" class="md-nav__link">
    <span class="md-ellipsis">
      14.4 性能优化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14.4 性能优化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#使用-pprof" class="md-nav__link">
    <span class="md-ellipsis">
      使用 pprof
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常见性能问题与解决方案" class="md-nav__link">
    <span class="md-ellipsis">
      常见性能问题与解决方案
    </span>
  </a>
  
    <nav class="md-nav" aria-label="常见性能问题与解决方案">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-高cpu使用率" class="md-nav__link">
    <span class="md-ellipsis">
      1. 高CPU使用率
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-内存泄漏" class="md-nav__link">
    <span class="md-ellipsis">
      2. 内存泄漏
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-过度的垃圾回收" class="md-nav__link">
    <span class="md-ellipsis">
      3. 过度的垃圾回收
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#性能分析工具" class="md-nav__link">
    <span class="md-ellipsis">
      性能分析工具
    </span>
  </a>
  
    <nav class="md-nav" aria-label="性能分析工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trace" class="md-nav__link">
    <span class="md-ellipsis">
      trace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#第三方性能分析工具" class="md-nav__link">
    <span class="md-ellipsis">
      第三方性能分析工具
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-总结" class="md-nav__link">
    <span class="md-ellipsis">
      14.5 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-项目实战" class="md-nav__link">
    <span class="md-ellipsis">
      15. 项目实战
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15. 项目实战">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151-简单的-web-应用" class="md-nav__link">
    <span class="md-ellipsis">
      15.1 简单的 Web 应用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.1 简单的 Web 应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-项目概述" class="md-nav__link">
    <span class="md-ellipsis">
      1. 项目概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-项目结构" class="md-nav__link">
    <span class="md-ellipsis">
      2. 项目结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-编写-html-模板" class="md-nav__link">
    <span class="md-ellipsis">
      3. 编写 HTML 模板
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-添加样式表" class="md-nav__link">
    <span class="md-ellipsis">
      4. 添加样式表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-编写-go-代码" class="md-nav__link">
    <span class="md-ellipsis">
      5. 编写 Go 代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-运行应用程序" class="md-nav__link">
    <span class="md-ellipsis">
      6. 运行应用程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-代码解析" class="md-nav__link">
    <span class="md-ellipsis">
      7. 代码解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-扩展功能" class="md-nav__link">
    <span class="md-ellipsis">
      8. 扩展功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#152-restful-api-开发" class="md-nav__link">
    <span class="md-ellipsis">
      15.2 RESTful API 开发
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.2 RESTful API 开发">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-项目概述_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 项目概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-项目结构_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. 项目结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-初始化项目" class="md-nav__link">
    <span class="md-ellipsis">
      3. 初始化项目
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-定义用户模型" class="md-nav__link">
    <span class="md-ellipsis">
      4. 定义用户模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-定义响应工具" class="md-nav__link">
    <span class="md-ellipsis">
      5. 定义响应工具
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-编写处理器" class="md-nav__link">
    <span class="md-ellipsis">
      6. 编写处理器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-配置路由" class="md-nav__link">
    <span class="md-ellipsis">
      7. 配置路由
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-编写主程序" class="md-nav__link">
    <span class="md-ellipsis">
      8. 编写主程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-运行和测试api" class="md-nav__link">
    <span class="md-ellipsis">
      9. 运行和测试API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. 运行和测试API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-创建用户" class="md-nav__link">
    <span class="md-ellipsis">
      1. 创建用户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-获取所有用户" class="md-nav__link">
    <span class="md-ellipsis">
      2. 获取所有用户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-获取单个用户" class="md-nav__link">
    <span class="md-ellipsis">
      3. 获取单个用户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-更新用户" class="md-nav__link">
    <span class="md-ellipsis">
      4. 更新用户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-删除用户" class="md-nav__link">
    <span class="md-ellipsis">
      5. 删除用户
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-获取已删除的用户" class="md-nav__link">
    <span class="md-ellipsis">
      6. 获取已删除的用户
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-代码解析" class="md-nav__link">
    <span class="md-ellipsis">
      10. 代码解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-扩展功能" class="md-nav__link">
    <span class="md-ellipsis">
      11. 扩展功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#153-文件上传与下载" class="md-nav__link">
    <span class="md-ellipsis">
      15.3 文件上传与下载
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.3 文件上传与下载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-项目概述_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. 项目概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-项目结构_2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 项目结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-初始化项目_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. 初始化项目
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-创建html模板" class="md-nav__link">
    <span class="md-ellipsis">
      4. 创建HTML模板
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-添加样式表" class="md-nav__link">
    <span class="md-ellipsis">
      5. 添加样式表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-编写-go-代码" class="md-nav__link">
    <span class="md-ellipsis">
      6. 编写 Go 代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-运行应用程序" class="md-nav__link">
    <span class="md-ellipsis">
      7. 运行应用程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-测试文件上传和下载" class="md-nav__link">
    <span class="md-ellipsis">
      8. 测试文件上传和下载
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. 测试文件上传和下载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-上传文件" class="md-nav__link">
    <span class="md-ellipsis">
      1. 上传文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-查看文件列表" class="md-nav__link">
    <span class="md-ellipsis">
      2. 查看文件列表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-下载文件" class="md-nav__link">
    <span class="md-ellipsis">
      3. 下载文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-代码解析" class="md-nav__link">
    <span class="md-ellipsis">
      9. 代码解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-扩展功能" class="md-nav__link">
    <span class="md-ellipsis">
      10. 扩展功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#154-并发爬虫" class="md-nav__link">
    <span class="md-ellipsis">
      15.4 并发爬虫
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.4 并发爬虫">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-项目概述_3" class="md-nav__link">
    <span class="md-ellipsis">
      1. 项目概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-项目结构_3" class="md-nav__link">
    <span class="md-ellipsis">
      2. 项目结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-初始化项目_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. 初始化项目
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-安装依赖" class="md-nav__link">
    <span class="md-ellipsis">
      4. 安装依赖
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-编写url工具函数" class="md-nav__link">
    <span class="md-ellipsis">
      5. 编写URL工具函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-编写爬虫逻辑" class="md-nav__link">
    <span class="md-ellipsis">
      6. 编写爬虫逻辑
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-编写主程序" class="md-nav__link">
    <span class="md-ellipsis">
      7. 编写主程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-运行爬虫" class="md-nav__link">
    <span class="md-ellipsis">
      8. 运行爬虫
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-代码解析_1" class="md-nav__link">
    <span class="md-ellipsis">
      9. 代码解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-扩展功能_1" class="md-nav__link">
    <span class="md-ellipsis">
      10. 扩展功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#155-分布式任务调度" class="md-nav__link">
    <span class="md-ellipsis">
      15.5 分布式任务调度
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.5 分布式任务调度">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-项目概述_4" class="md-nav__link">
    <span class="md-ellipsis">
      1. 项目概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-项目结构_4" class="md-nav__link">
    <span class="md-ellipsis">
      2. 项目结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-选择技术栈" class="md-nav__link">
    <span class="md-ellipsis">
      3. 选择技术栈
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-安装依赖_1" class="md-nav__link">
    <span class="md-ellipsis">
      4. 安装依赖
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-定义任务模型" class="md-nav__link">
    <span class="md-ellipsis">
      5. 定义任务模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-编写响应工具" class="md-nav__link">
    <span class="md-ellipsis">
      6. 编写响应工具
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-编写调度器" class="md-nav__link">
    <span class="md-ellipsis">
      7. 编写调度器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-编写工作节点" class="md-nav__link">
    <span class="md-ellipsis">
      8. 编写工作节点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-编写主程序" class="md-nav__link">
    <span class="md-ellipsis">
      9. 编写主程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-运行调度器和工作节点" class="md-nav__link">
    <span class="md-ellipsis">
      10. 运行调度器和工作节点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-测试任务提交和执行" class="md-nav__link">
    <span class="md-ellipsis">
      11. 测试任务提交和执行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. 测试任务提交和执行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-提交任务" class="md-nav__link">
    <span class="md-ellipsis">
      1. 提交任务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-提交休眠任务" class="md-nav__link">
    <span class="md-ellipsis">
      2. 提交休眠任务
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-查看任务队列" class="md-nav__link">
    <span class="md-ellipsis">
      3. 查看任务队列
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-代码解析" class="md-nav__link">
    <span class="md-ellipsis">
      12. 代码解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-扩展功能" class="md-nav__link">
    <span class="md-ellipsis">
      13. 扩展功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#156-总结" class="md-nav__link">
    <span class="md-ellipsis">
      15.6 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#16-进一步学习" class="md-nav__link">
    <span class="md-ellipsis">
      16. 进一步学习
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16. 进一步学习">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161-深入理解-go-的垃圾回收" class="md-nav__link">
    <span class="md-ellipsis">
      16.1 深入理解 Go 的垃圾回收
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1 深入理解 Go 的垃圾回收">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-垃圾回收的基本概念" class="md-nav__link">
    <span class="md-ellipsis">
      1. 垃圾回收的基本概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-go-垃圾回收器的工作原理" class="md-nav__link">
    <span class="md-ellipsis">
      2. Go 垃圾回收器的工作原理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-垃圾回收的触发条件" class="md-nav__link">
    <span class="md-ellipsis">
      3. 垃圾回收的触发条件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-垃圾回收的调优" class="md-nav__link">
    <span class="md-ellipsis">
      4. 垃圾回收的调优
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-gc对性能的影响" class="md-nav__link">
    <span class="md-ellipsis">
      5. GC对性能的影响
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-实践中的gc优化" class="md-nav__link">
    <span class="md-ellipsis">
      6. 实践中的GC优化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#162-go-的内存模型" class="md-nav__link">
    <span class="md-ellipsis">
      16.2 Go 的内存模型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.2 Go 的内存模型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-内存分配栈与堆" class="md-nav__link">
    <span class="md-ellipsis">
      1. 内存分配：栈与堆
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-指针与引用" class="md-nav__link">
    <span class="md-ellipsis">
      2. 指针与引用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-并发与内存模型" class="md-nav__link">
    <span class="md-ellipsis">
      3. 并发与内存模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-内存模型的最佳实践" class="md-nav__link">
    <span class="md-ellipsis">
      4. 内存模型的最佳实践
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#163-开源框架与库" class="md-nav__link">
    <span class="md-ellipsis">
      16.3 开源框架与库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.3 开源框架与库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-gin" class="md-nav__link">
    <span class="md-ellipsis">
      1. Gin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Gin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#特点" class="md-nav__link">
    <span class="md-ellipsis">
      特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#安装" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例构建一个简单的restful-api" class="md-nav__link">
    <span class="md-ellipsis">
      示例：构建一个简单的RESTful API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#中间件示例" class="md-nav__link">
    <span class="md-ellipsis">
      中间件示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-beego" class="md-nav__link">
    <span class="md-ellipsis">
      2. Beego
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Beego">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#特点_1" class="md-nav__link">
    <span class="md-ellipsis">
      特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#安装_1" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例构建一个简单的web应用" class="md-nav__link">
    <span class="md-ellipsis">
      示例：构建一个简单的Web应用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orm-示例" class="md-nav__link">
    <span class="md-ellipsis">
      ORM 示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beego-的优势" class="md-nav__link">
    <span class="md-ellipsis">
      Beego 的优势
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-gorm" class="md-nav__link">
    <span class="md-ellipsis">
      3. Gorm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Gorm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#特点_2" class="md-nav__link">
    <span class="md-ellipsis">
      特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#安装_2" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#示例使用gorm进行数据库操作" class="md-nav__link">
    <span class="md-ellipsis">
      示例：使用Gorm进行数据库操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gorm-的高级功能" class="md-nav__link">
    <span class="md-ellipsis">
      Gorm 的高级功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gorm-的优势" class="md-nav__link">
    <span class="md-ellipsis">
      Gorm 的优势
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#与beego的集成" class="md-nav__link">
    <span class="md-ellipsis">
      与Beego的集成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-选择适合的框架与库" class="md-nav__link">
    <span class="md-ellipsis">
      4. 选择适合的框架与库
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#164-总结" class="md-nav__link">
    <span class="md-ellipsis">
      16.4 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../k8s%E5%92%8C%E5%AE%B9%E5%99%A8/KubeSphere%E4%BD%93%E9%AA%8C/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    K8s和容器
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/Nginx%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    中间件
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%AE%89%E5%85%A8/Burp%20Suite%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    安全
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%BC%80%E5%8F%91/FastApi%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    开发
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/RHEL9/RHEL9-RHCE%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    操作系统
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/MongoDB/MongoDB%20%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    数据库笔记
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../%E8%99%9A%E6%8B%9F%E5%8C%96/%E8%99%9A%E6%8B%9F%E5%8C%96/RVtools%E4%BD%BF%E7%94%A8/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    虚拟化
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%85%B3/credly%E6%9F%A5%E7%9C%8B%E5%8B%8B%E7%AB%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    认证相关
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="go语言基础入门学习笔记">GO语言基础入门学习笔记<a class="headerlink" href="#go语言基础入门学习笔记" title="Permanent link">&para;</a></h1>
<h2 id="1-go-语言简介">1. Go 语言简介<a class="headerlink" href="#1-go-语言简介" title="Permanent link">&para;</a></h2>
<h3 id="11-什么是-go-语言">1.1 什么是 Go 语言<a class="headerlink" href="#11-什么是-go-语言" title="Permanent link">&para;</a></h3>
<p><strong>Go语言</strong>，通常被称为<strong>Golang</strong>，是由Google在2007年开始开发，并在2009年正式发布的一种开源编程语言。Go语言的设计初衷是解决大型软件开发中的效率和可维护性问题，特别是在多核处理器和网络化系统的背景下。</p>
<h4 id="主要特点">主要特点：<a class="headerlink" href="#主要特点" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>编译型语言</strong>：Go代码编译为机器码，执行效率高。</li>
<li><strong>静态类型</strong>：在编译时进行类型检查，减少运行时错误。</li>
<li><strong>简洁性</strong>：语法简洁，易于学习和使用。</li>
<li><strong>并发支持</strong>：内置对并发编程的支持，利用goroutines和channels简化并发任务的实现。</li>
<li><strong>垃圾回收</strong>：自动内存管理，减少内存泄漏和其他相关问题。</li>
<li><strong>跨平台</strong>：支持多种操作系统和架构，包括Windows、macOS、Linux等。</li>
</ul>
<h4 id="历史背景">历史背景：<a class="headerlink" href="#历史背景" title="Permanent link">&para;</a></h4>
<p>Go语言由Robert Griesemer、Rob Pike和Ken Thompson等人在Google开发，旨在提高开发效率，同时保持高性能和可靠性。它结合了C语言的高性能和现代语言的易用性，被广泛应用于系统编程、网络服务和分布式系统等领域。</p>
<h4 id="示例hello-world-程序">示例：Hello World 程序<a class="headerlink" href="#示例hello-world-程序" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释</strong>：</p>
<ul>
<li><code>package main</code>：定义一个可执行程序的包名。</li>
<li><code>import "fmt"</code>：导入格式化I/O的包。</li>
<li><code>func main()</code>：程序的入口函数。</li>
<li><code>fmt.Println("Hello, World!")</code>：输出字符串到控制台。</li>
</ul>
<h3 id="12-go-语言的特点">1.2 Go 语言的特点<a class="headerlink" href="#12-go-语言的特点" title="Permanent link">&para;</a></h3>
<p>Go语言具有多种独特的特性，使其在现代编程语言中脱颖而出。以下是一些关键特点：</p>
<h4 id="121-简洁性">1.2.1 简洁性<a class="headerlink" href="#121-简洁性" title="Permanent link">&para;</a></h4>
<p>Go语言的设计强调简洁和清晰，减少了冗余和复杂性。例如，不需要头文件，代码组织简单直观。</p>
<p><strong>示例：简洁的变量声明</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="c1">// 短变量声明</span>
</code></pre></div></td></tr></table></div>
<h4 id="122-高性能">1.2.2 高性能<a class="headerlink" href="#122-高性能" title="Permanent link">&para;</a></h4>
<p>由于Go是编译型语言，编译后的可执行文件直接运行在机器上，性能接近C/C++。此外，Go的并发模型使其在处理高并发任务时表现出色。</p>
<h4 id="123-并发支持">1.2.3 并发支持<a class="headerlink" href="#123-并发支持" title="Permanent link">&para;</a></h4>
<p>Go内置了对并发编程的支持，主要通过<strong>goroutines</strong>和<strong>channels</strong>实现。</p>
<ul>
<li><strong>Goroutines</strong>：轻量级线程，可以轻松创建数千个goroutine而不会显著增加系统负担。</li>
<li><strong>Channels</strong>：用于在goroutines之间传递数据，实现安全的并发通信。</li>
</ul>
<p><strong>示例：并发执行任务</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">say</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="p">}</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">say</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 在新goroutine中执行</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="nx">say</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1">// 在主goroutine中执行</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出</strong>（顺序可能不同）：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>hello
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>world
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>hello
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>world
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>...
</code></pre></div></td></tr></table></div>
<h4 id="124-内存管理">1.2.4 内存管理<a class="headerlink" href="#124-内存管理" title="Permanent link">&para;</a></h4>
<p>Go拥有自动垃圾回收（Garbage Collection）机制，自动管理内存分配和释放，减轻开发者的负担，避免内存泄漏和悬挂指针等问题。</p>
<h4 id="125-强大的标准库">1.2.5 强大的标准库<a class="headerlink" href="#125-强大的标准库" title="Permanent link">&para;</a></h4>
<p>Go的标准库功能丰富，涵盖网络、I/O、文本处理、加密等多个方面，极大地提高了开发效率。</p>
<p><strong>示例：HTTP服务器</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">helloHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="p">}</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">helloHandler</span><span class="p">)</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Server is listening on port 8080...&quot;</span><span class="p">)</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="13-go-语言的应用场景">1.3 Go 语言的应用场景<a class="headerlink" href="#13-go-语言的应用场景" title="Permanent link">&para;</a></h3>
<p>Go语言由于其高性能、并发支持和简洁性，被广泛应用于多个领域。以下是一些主要的应用场景：</p>
<h4 id="131-web-开发">1.3.1 Web 开发<a class="headerlink" href="#131-web-开发" title="Permanent link">&para;</a></h4>
<p>Go适用于开发高性能的Web服务器和Web应用。其标准库提供了强大的HTTP支持，第三方框架如Gin、Beego进一步简化了Web开发。</p>
<p><strong>示例：简单的Web服务器</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Welcome to Go Web Server!&quot;</span><span class="p">)</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="p">}</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Starting server at port 8080&quot;</span><span class="p">)</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="132-云服务和微服务">1.3.2 云服务和微服务<a class="headerlink" href="#132-云服务和微服务" title="Permanent link">&para;</a></h4>
<p>Go的高并发性能和高效的内存管理使其成为开发云服务和微服务的理想选择。许多云平台和微服务架构的组件都是用Go编写的，如Docker和Kubernetes。</p>
<h4 id="133-网络编程">1.3.3 网络编程<a class="headerlink" href="#133-网络编程" title="Permanent link">&para;</a></h4>
<p>Go在网络编程方面表现出色，提供了丰富的网络库，支持TCP/UDP、HTTP、WebSocket等协议，适合开发高性能的网络应用。</p>
<p><strong>示例：TCP服务器</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">        </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Connection closed.&quot;</span><span class="p">)</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">        </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Echo: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">message</span><span class="p">))</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="p">}</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">    </span><span class="nx">listener</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8081&quot;</span><span class="p">)</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Error starting TCP server:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;TCP server listening on port 8081&quot;</span><span class="p">)</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">        </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Accept</span><span class="p">()</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Error accepting connection:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="134-系统工具和命令行工具">1.3.4 系统工具和命令行工具<a class="headerlink" href="#134-系统工具和命令行工具" title="Permanent link">&para;</a></h4>
<p>Go的静态编译特性使其生成的二进制文件独立且易于部署，非常适合开发各种系统工具和命令行应用。</p>
<p><strong>示例：简单的命令行工具</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="s">&quot;flag&quot;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="p">)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a name to say hello to&quot;</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, %s!\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">name</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>运行：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>-name<span class="o">=</span>Go
</code></pre></div></td></tr></table></div>
<p>输出：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>Hello, Go!
</code></pre></div></td></tr></table></div>
<h4 id="135-数据处理和大数据">1.3.5 数据处理和大数据<a class="headerlink" href="#135-数据处理和大数据" title="Permanent link">&para;</a></h4>
<p>Go的高效性能和并发能力使其在数据处理和大数据应用中表现出色，适合开发数据管道、ETL工具和实时数据处理系统。</p>
<h4 id="136-devops-工具">1.3.6 DevOps 工具<a class="headerlink" href="#136-devops-工具" title="Permanent link">&para;</a></h4>
<p>许多现代DevOps工具使用Go编写，如Terraform、Kubernetes的kubectl、Prometheus等，利用Go的跨平台特性和高效性能，实现了强大的功能和易用性。</p>
<h3 id="14-安装与配置-go-环境">1.4 安装与配置 Go 环境<a class="headerlink" href="#14-安装与配置-go-环境" title="Permanent link">&para;</a></h3>
<p>在开始编写Go代码之前，需要安装并配置Go开发环境。以下是详细的步骤指南。</p>
<h4 id="141-下载并安装">1.4.1 下载并安装<a class="headerlink" href="#141-下载并安装" title="Permanent link">&para;</a></h4>
<h5 id="1411-官方下载页面">1.4.1.1 官方下载页面<a class="headerlink" href="#1411-官方下载页面" title="Permanent link">&para;</a></h5>
<p>访问Go语言的<a href="https://golang.org/dl/">官方下载页面</a>以获取最新版本的Go安装包。选择适合你操作系统和架构的安装包。</p>
<h5 id="1412-安装步骤">1.4.1.2 安装步骤<a class="headerlink" href="#1412-安装步骤" title="Permanent link">&para;</a></h5>
<p><strong>Windows</strong></p>
<ol>
<li><strong>下载</strong>：选择Windows版本的安装包（通常是<code>.msi</code>文件）。</li>
<li><strong>运行安装包</strong>：双击下载的<code>.msi</code>文件，按照安装向导完成安装。</li>
<li><strong>默认安装路径</strong>：通常安装在<code>C:\Go</code>目录下。</li>
</ol>
<p><strong>macOS</strong></p>
<ol>
<li><strong>下载</strong>：选择macOS版本的安装包（<code>.pkg</code>文件）。</li>
<li><strong>运行安装包</strong>：双击下载的<code>.pkg</code>文件，按照安装向导完成安装。</li>
<li><strong>默认安装路径</strong>：通常安装在<code>/usr/local/go</code>目录下。</li>
</ol>
<p><strong>Linux</strong></p>
<ol>
<li>
<p><strong>下载</strong>：选择Linux版本的压缩包（<code>.tar.gz</code>文件）。</p>
</li>
<li>
<p><strong>解压安装包</strong>：</p>
</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>tar<span class="w"> </span>-C<span class="w"> </span>/usr/local<span class="w"> </span>-xzf<span class="w"> </span>go1.XX.X.linux-amd64.tar.gz
</code></pre></div></td></tr></table></div>
<p>其中<code>go1.XX.X.linux-amd64.tar.gz</code>是你下载的Go版本文件。</p>
<ol>
<li><strong>设置权限</strong>（可选）：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>root:root<span class="w"> </span>/usr/local/go
</code></pre></div></td></tr></table></div>
<h4 id="142-配置环境变量">1.4.2 配置环境变量<a class="headerlink" href="#142-配置环境变量" title="Permanent link">&para;</a></h4>
<p>正确配置环境变量是确保Go开发环境正常工作的关键步骤。以下是各操作系统的配置方法。</p>
<h5 id="windows">Windows<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h5>
<ol>
<li><strong>打开环境变量设置</strong>：</li>
<li>右键点击“此电脑”或“我的电脑”，选择“属性”。</li>
<li>点击“高级系统设置”。</li>
<li>点击“环境变量”按钮。</li>
<li><strong>设置<code>GOROOT</code></strong>（可选）：</li>
<li>在“系统变量”中点击“新建”。</li>
<li>变量名：<code>GOROOT</code></li>
<li>变量值：<code>C:\Go</code>（假设Go安装在C盘根目录下）</li>
<li><strong>设置<code>GOPATH</code></strong>：</li>
<li><code>GOPATH</code>是你的工作空间，存放你的Go项目和第三方包。</li>
<li>在“系统变量”中点击“新建”。</li>
<li>变量名：<code>GOPATH</code></li>
<li>变量值：例如<code>C:\Users\YourName\go</code></li>
<li><strong>更新<code>PATH</code>变量</strong>：</li>
<li>在“系统变量”中找到<code>Path</code>，点击“编辑”。</li>
<li>添加以下路径：<ul>
<li><code>%GOROOT%\bin</code></li>
<li><code>%GOPATH%\bin</code></li>
</ul>
</li>
</ol>
<h5 id="macos-和-linux">macOS 和 Linux<a class="headerlink" href="#macos-和-linux" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p><strong>打开终端</strong>。</p>
</li>
<li>
<p><strong>编辑配置文件</strong>：</p>
</li>
<li>
<p>如果使用的是Bash，编辑<code>~/.bashrc</code>或<code>~/.bash_profile</code>。</p>
</li>
<li>
<p>如果使用的是Zsh，编辑<code>~/.zshrc</code>。</p>
</li>
<li>
<p><strong>添加以下内容</strong>：</p>
</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># 设置GOROOT（可选）</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GOROOT</span><span class="o">=</span>/usr/local/go
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="c1"># 设置GOPATH</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GOPATH</span><span class="o">=</span><span class="nv">$HOME</span>/go
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="c1"># 更新PATH</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$GOROOT</span>/bin:<span class="nv">$GOPATH</span>/bin
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>应用更改</strong>：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nb">source</span><span class="w"> </span>~/.bashrc<span class="w">  </span><span class="c1"># 或者 source ~/.zshrc</span>
</code></pre></div></td></tr></table></div>
<h5 id="验证环境变量">验证环境变量<a class="headerlink" href="#验证环境变量" title="Permanent link">&para;</a></h5>
<p>无论使用哪种操作系统，完成环境变量配置后，可以通过以下命令验证安装是否成功。</p>
<h4 id="143-验证安装">1.4.3 验证安装<a class="headerlink" href="#143-验证安装" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>检查Go版本</strong>：</li>
</ol>
<p>打开终端或命令提示符，输入以下命令：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a>go<span class="w"> </span>version
</code></pre></div></td></tr></table></div>
<p><strong>预期输出</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a>go version go1.XX.X [操作系统/架构]
</code></pre></div></td></tr></table></div>
<p>例如：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a>go version go1.20.3 darwin/amd64
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>设置工作空间目录</strong></li>
</ol>
<p>确保<code>GOPATH</code>目录存在。如果不存在，可以手动创建：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GOPATH</span>/src
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GOPATH</span>/bin
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GOPATH</span>/pkg
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>编写并运行第一个Go程序</strong></li>
</ol>
<p>创建一个简单的Go程序以验证开发环境。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GOPATH</span>/src/hello
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$GOPATH</span>/src/hello
</code></pre></div></td></tr></table></div>
<p>创建<code>hello.go</code>文件：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span>
<span class="normal"><a href="#__codelineno-19-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, Go!&quot;</span><span class="p">)</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>编译并运行</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>go<span class="w"> </span>run<span class="w"> </span>hello.go
</code></pre></div></td></tr></table></div>
<p><strong>预期输出</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a>Hello, Go!
</code></pre></div></td></tr></table></div>
<p><strong>编译为可执行文件</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>go<span class="w"> </span>build<span class="w"> </span>hello.go
</code></pre></div></td></tr></table></div>
<p>这将在当前目录生成一个名为<code>hello</code>（或<code>hello.exe</code>在Windows上的可执行文件）。运行它：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>./hello
</code></pre></div></td></tr></table></div>
<p><strong>预期输出</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>Hello, Go!
</code></pre></div></td></tr></table></div>
<h4 id="144-配置-go-modules推荐">1.4.4 配置 Go Modules（推荐）<a class="headerlink" href="#144-配置-go-modules推荐" title="Permanent link">&para;</a></h4>
<p>自Go 1.11起，Go引入了<strong>Go Modules</strong>，用于管理项目的依赖关系，解决了之前GOPATH的一些限制。推荐在新项目中使用Go Modules。</p>
<h5 id="启用-go-modules">启用 Go Modules<a class="headerlink" href="#启用-go-modules" title="Permanent link">&para;</a></h5>
<ol>
<li><strong>设置环境变量</strong>：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GO111MODULE</span><span class="o">=</span>on
</code></pre></div></td></tr></table></div>
<p>可以将其添加到你的shell配置文件中以永久生效。</p>
<ol>
<li><strong>初始化模块</strong>：</li>
</ol>
<p>在你的项目目录中运行：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>github.com/yourusername/yourproject
</code></pre></div></td></tr></table></div>
<p>这将创建一个<code>go.mod</code>文件，记录项目的模块路径和依赖关系。</p>
<h5 id="示例使用-go-modules">示例：使用 Go Modules<a class="headerlink" href="#示例使用-go-modules" title="Permanent link">&para;</a></h5>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$GOPATH</span>/src/github.com/yourusername/yourproject
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$GOPATH</span>/src/github.com/yourusername/yourproject
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>github.com/yourusername/yourproject
</code></pre></div></td></tr></table></div>
<p>然后，你可以像之前一样编写Go代码，并使用<code>go build</code>、<code>go run</code>等命令进行开发。</p>
<h2 id="2-go-开发工具">2. Go 开发工具<a class="headerlink" href="#2-go-开发工具" title="Permanent link">&para;</a></h2>
<p>在Go语言的开发过程中，选择合适的编辑器或集成开发环境（IDE）以及有效地管理项目的依赖关系和模块是至关重要的。本章将详细介绍常用的编辑器和IDE，以及Go模块管理的相关知识。</p>
<h3 id="21-常用编辑器和-ide">2.1 常用编辑器和 IDE<a class="headerlink" href="#21-常用编辑器和-ide" title="Permanent link">&para;</a></h3>
<p>选择适合的编辑器或IDE可以大大提高开发效率和代码质量。以下是几款常用的编辑器和IDE，以及它们在Go开发中的优势和配置方法。</p>
<h4 id="visual-studio-code-vs-code">Visual Studio Code (VS Code)<a class="headerlink" href="#visual-studio-code-vs-code" title="Permanent link">&para;</a></h4>
<p><strong>简介</strong>： Visual Studio Code 是由微软开发的一款免费、开源的跨平台代码编辑器，支持Windows、macOS和Linux。凭借其丰富的插件生态系统，VS Code 成为Go开发者的首选编辑器之一。</p>
<p><strong>主要特点</strong>：</p>
<ul>
<li><strong>插件丰富</strong>：通过安装Go插件，提供语法高亮、代码自动补全、调试、代码格式化等功能。</li>
<li><strong>轻量级</strong>：启动速度快，占用资源少，适合各种开发环境。</li>
<li><strong>集成终端</strong>：内置终端方便运行Go命令和调试程序。</li>
<li><strong>Git集成</strong>：内置Git支持，方便版本控制操作。</li>
</ul>
<p><strong>安装与配置</strong>：</p>
<ol>
<li><strong>下载与安装</strong>：</li>
<li>访问<a href="https://code.visualstudio.com/">Visual Studio Code官网</a>下载适合操作系统的安装包并安装。</li>
<li><strong>安装Go插件</strong>：</li>
<li>打开VS Code。</li>
<li>点击左侧的扩展图标（或按下 <code>Ctrl+Shift+X</code>）。</li>
<li>在搜索框中输入<code>Go</code>，选择由<code>golang</code>官方维护的插件并安装。</li>
<li><strong>配置Go环境</strong>：</li>
<li>打开设置（<code>Ctrl+,</code>）。</li>
<li>搜索<code>Go</code>，根据需要调整相关配置，如<code>GOROOT</code>、<code>GOPATH</code>等。</li>
<li>推荐启用<code>Go Modules</code>支持，确保<code>GO111MODULE</code>设置为<code>on</code>。</li>
<li><strong>安装必要的工具</strong>：</li>
<li>打开一个Go文件时，VS Code可能会提示安装一些工具，如<code>gopls</code>（Go语言服务器）、<code>delve</code>（调试工具）等。按照提示安装这些工具以增强开发体验。</li>
</ol>
<p><strong>示例：编写和运行Hello World程序</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, VS Code!&quot;</span><span class="p">)</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>保存文件为<code>hello.go</code>。</p>
</li>
<li>
<p>打开集成终端（`Ctrl+``）。</p>
</li>
<li>
<p>运行程序：</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>go run hello.go
</code></pre></div></td></tr></table></div>
<ul>
<li>输出：</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a>Hello, VS Code!
</code></pre></div></td></tr></table></div>
<p><strong>调试配置</strong>：</p>
<ul>
<li>在VS Code中，点击左侧的调试图标（或按下 <code>Ctrl+Shift+D</code>）。</li>
<li>点击“创建一个launch.json文件”并选择<code>Go</code>。</li>
<li>配置完成后，可以设置断点并启动调试，查看变量值、调用堆栈等信息。</li>
</ul>
<h4 id="goland">GoLand<a class="headerlink" href="#goland" title="Permanent link">&para;</a></h4>
<p><strong>简介</strong>： GoLand 是由JetBrains开发的一款专业的Go语言集成开发环境。作为商业软件，GoLand 提供了强大的功能和深度的Go语言支持，适合专业开发者和大型项目。</p>
<p><strong>主要特点</strong>：</p>
<ul>
<li><strong>智能代码补全</strong>：提供上下文相关的代码建议和自动补全功能，提升编码效率。</li>
<li><strong>强大的调试器</strong>：内置调试器支持断点、变量监视、表达式评估等功能，方便排查问题。</li>
<li><strong>代码重构</strong>：支持多种代码重构操作，如重命名、提取方法、改变函数签名等，保持代码整洁。</li>
<li><strong>集成测试</strong>：方便编写和运行单元测试及集成测试，支持测试覆盖率分析。</li>
<li><strong>版本控制集成</strong>：内置对Git、SVN等版本控制系统的支持，简化版本管理操作。</li>
</ul>
<p><strong>安装与配置</strong>：</p>
<ol>
<li><strong>下载与安装</strong>：</li>
<li>访问<a href="https://www.jetbrains.com/go/">GoLand官网</a>下载适合操作系统的安装包并安装。</li>
<li>提供30天免费试用，之后需要购买许可证。</li>
<li><strong>首次启动配置</strong>：</li>
<li>启动GoLand，按照向导配置Go SDK路径。</li>
<li>设置项目的<code>GOPATH</code>和模块设置（推荐使用Go Modules）。</li>
<li><strong>安装插件</strong>：</li>
<li>虽然GoLand已经内置了丰富的功能，但可以根据需要安装其他插件，如Docker、Kubernetes等，扩展开发环境功能。</li>
</ol>
<p><strong>示例：编写和运行Hello World程序</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span>
<span class="normal"><a href="#__codelineno-31-5">5</a></span>
<span class="normal"><a href="#__codelineno-31-6">6</a></span>
<span class="normal"><a href="#__codelineno-31-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, GoLand!&quot;</span><span class="p">)</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>在GoLand中创建一个新的Go项目或文件。</p>
</li>
<li>
<p>编写上述代码并运行（点击运行按钮或使用快捷键 <code>Shift+F10</code>）。</p>
</li>
<li>
<p>输出：</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>Hello, GoLand!
</code></pre></div></td></tr></table></div>
<p><strong>调试配置</strong>：</p>
<ul>
<li>设置断点：点击代码行号旁边。</li>
<li>启动调试：点击调试按钮或使用快捷键 <code>Shift+F9</code>。</li>
<li>在调试面板中查看变量、调用堆栈和控制执行流程，帮助快速定位和解决问题。</li>
</ul>
<h4 id="vimneovim">Vim/Neovim<a class="headerlink" href="#vimneovim" title="Permanent link">&para;</a></h4>
<p><strong>简介</strong>： Vim 是一款高度可定制化的文本编辑器，适合喜欢键盘操作和命令行界面的开发者。Neovim 是Vim的一个分支，增加了更多现代化的功能和扩展性。</p>
<p><strong>主要特点</strong>：</p>
<ul>
<li><strong>高效快捷</strong>：通过键盘快捷键和命令实现快速编辑，提高编码效率。</li>
<li><strong>高度可定制</strong>：通过配置文件和插件系统扩展功能，满足个性化需求。</li>
<li><strong>轻量级</strong>：占用资源少，适合在低配置或远程服务器上使用，适合进行服务器端开发。</li>
<li><strong>强大的社区支持</strong>：丰富的插件和配置资源，帮助提升开发体验。</li>
</ul>
<p><strong>安装与配置</strong>：</p>
<ol>
<li>
<p><strong>安装Vim/Neovim</strong>：</p>
</li>
<li>
<p>Vim</p>
<p>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a>sudo apt-get install vim
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Neovim</p>
<p>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>sudo apt-get install neovim
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong>安装插件管理器</strong>：</p>
</li>
<li>
<p>推荐使用</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a>vim-plug
</code></pre></div></td></tr></table></div>
<p>：</p>
<ul>
<li>下载并安装</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a>vim-plug
</code></pre></div></td></tr></table></div>
<p>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a>curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
</code></pre></div></td></tr></table></div>
<ul>
<li>对于Neovim：</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong>配置Go插件</strong>：</p>
</li>
<li>
<p>编辑</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a>~/.vimrc
</code></pre></div></td></tr></table></div>
<p>（Vim）或</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>~/.config/nvim/init.vim
</code></pre></div></td></tr></table></div>
<p>（Neovim），添加以下内容以安装</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a>vim-go
</code></pre></div></td></tr></table></div>
<p>插件：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">VimL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="k">call</span> plug#begin<span class="p">(</span><span class="s1">&#39;~/.vim/plugged&#39;</span><span class="p">)</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>Plug <span class="s1">&#39;fatih/vim-go&#39;</span><span class="p">,</span> { <span class="s1">&#39;do&#39;</span>: <span class="s1">&#39;:GoUpdateBinaries&#39;</span> }
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="k">call</span> plug#<span class="k">end</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>安装插件：在编辑器中运行命令<code>PlugInstall</code>。</p>
</li>
<li>
<p><strong>配置Go环境</strong>：</p>
</li>
<li>
<p>确保环境变量<code>GOROOT</code>和<code>GOPATH</code>正确设置，并将<code>$GOPATH/bin</code>添加到<code>PATH</code>中。</p>
</li>
<li>
<p>安装必要的Go工具，如</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a>gopls
</code></pre></div></td></tr></table></div>
<p>（语言服务器）和</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a>delve
</code></pre></div></td></tr></table></div>
<p>（调试工具）：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a>go install golang.org/x/tools/gopls@latest
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>go install github.com/go-delve/delve/cmd/dlv@latest
</code></pre></div></td></tr></table></div>
</li>
</ol>
<p><strong>示例：编写和运行Hello World程序</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span>
<span class="normal"><a href="#__codelineno-46-6">6</a></span>
<span class="normal"><a href="#__codelineno-46-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, Vim/Neovim!&quot;</span><span class="p">)</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>保存文件为<code>hello.go</code>。</p>
</li>
<li>
<p>在终端中运行：</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a>go run hello.go
</code></pre></div></td></tr></table></div>
<ul>
<li>输出：</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a>Hello, Vim/Neovim!
</code></pre></div></td></tr></table></div>
<p><strong>调试配置</strong>：</p>
<ul>
<li>使用</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a>delve
</code></pre></div></td></tr></table></div>
<p>进行调试：</p>
<ul>
<li>
<p>启动调试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a>dlv debug hello.go
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>设置断点、查看变量等操作通过<code>delve</code>命令进行。</p>
</li>
</ul>
<h4 id="liteide">LiteIDE<a class="headerlink" href="#liteide" title="Permanent link">&para;</a></h4>
<p><strong>简介</strong>： LiteIDE 是专为Go语言设计的轻量级集成开发环境，支持Windows、macOS和Linux。它提供了开箱即用的Go开发支持，适合初学者和希望使用专门工具的开发者。</p>
<p><strong>主要特点</strong>：</p>
<ul>
<li><strong>专为Go设计</strong>：内置对Go语言的全面支持，包括语法高亮、代码补全、调试等功能。</li>
<li><strong>简单易用</strong>：界面简洁，易于上手，无需复杂配置。</li>
<li><strong>集成工具</strong>：内置Go编译、运行和调试工具，简化开发流程。</li>
<li><strong>跨平台</strong>：支持多种操作系统，方便在不同环境中使用。</li>
</ul>
<p><strong>安装与配置</strong>：</p>
<ol>
<li><strong>下载与安装</strong>：</li>
<li>访问<a href="https://liteide.org/">LiteIDE官网</a>下载适合操作系统的安装包并安装。</li>
<li><strong>首次启动配置</strong>：</li>
<li>启动LiteIDE，按照向导配置Go SDK路径。</li>
<li>设置项目的<code>GOPATH</code>和模块设置（推荐使用Go Modules）。</li>
<li><strong>配置编辑器</strong>：</li>
<li>LiteIDE已经预配置了Go的开发环境，用户可以根据需要调整主题、快捷键等设置。</li>
</ol>
<p><strong>示例：编写和运行Hello World程序</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span>
<span class="normal"><a href="#__codelineno-51-2">2</a></span>
<span class="normal"><a href="#__codelineno-51-3">3</a></span>
<span class="normal"><a href="#__codelineno-51-4">4</a></span>
<span class="normal"><a href="#__codelineno-51-5">5</a></span>
<span class="normal"><a href="#__codelineno-51-6">6</a></span>
<span class="normal"><a href="#__codelineno-51-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, LiteIDE!&quot;</span><span class="p">)</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>在LiteIDE中创建一个新的Go项目或文件。</p>
</li>
<li>
<p>编写上述代码并点击运行按钮。</p>
</li>
<li>
<p>输出：</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a>Hello, LiteIDE!
</code></pre></div></td></tr></table></div>
<p><strong>调试配置</strong>：</p>
<ul>
<li>在代码行号旁点击设置断点。</li>
<li>点击调试按钮启动调试，会打开调试面板，允许查看变量值、调用堆栈等信息。</li>
</ul>
<h3 id="22-go-module-管理">2.2 Go Module 管理<a class="headerlink" href="#22-go-module-管理" title="Permanent link">&para;</a></h3>
<p>Go Modules 是Go语言官方引入的依赖管理系统，自Go 1.11版本开始引入，并在Go 1.13中成为默认模式。它解决了之前GOPATH模式下的一些限制，提供了更加灵活和可靠的依赖管理方式。</p>
<h4 id="初始化模块">初始化模块<a class="headerlink" href="#初始化模块" title="Permanent link">&para;</a></h4>
<p>在使用Go Modules之前，需要在项目中初始化模块，这样Go工具链才能正确地管理依赖关系。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><strong>创建项目目录</strong>：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a>mkdir -p ~/go/src/github.com/yourusername/yourproject
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>cd ~/go/src/github.com/yourusername/yourproject
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>初始化模块</strong>： 使用<code>go mod init</code>命令初始化模块，指定模块路径（通常是项目的仓库地址）：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a>go mod init github.com/yourusername/yourproject
</code></pre></div></td></tr></table></div>
<p>这将生成一个<code>go.mod</code>文件，记录模块路径和Go版本。</p>
<p><strong>示例</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a>go mod init github.com/johndoe/myapp
</code></pre></div></td></tr></table></div>
<p>生成的<code>go.mod</code>文件内容可能如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span>
<span class="normal"><a href="#__codelineno-56-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a>module github.com/johndoe/myapp
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a>go 1.20
</code></pre></div></td></tr></table></div>
<h4 id="添加依赖">添加依赖<a class="headerlink" href="#添加依赖" title="Permanent link">&para;</a></h4>
<p>随着项目的发展，可能需要引入第三方库或模块。Go Modules使得添加和管理这些依赖变得简单。</p>
<p><strong>步骤</strong>：</p>
<ol>
<li><strong>导入包</strong>： 在代码中导入需要的第三方包。例如：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;github.com/gin-gonic/gin&quot;</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>获取依赖</strong>： 运行<code>go get</code>命令获取依赖并更新<code>go.mod</code>和<code>go.sum</code>文件：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a>go get github.com/gin-gonic/gin
</code></pre></div></td></tr></table></div>
<p>这将自动下载该包及其依赖，并记录在<code>go.mod</code>文件中。</p>
<p><strong>示例</strong>：</p>
<p>假设需要使用Gin框架编写Web应用，首先导入Gin包：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="w">    </span><span class="s">&quot;github.com/gin-gonic/gin&quot;</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="p">)</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a><span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">Default</span><span class="p">()</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">GET</span><span class="p">(</span><span class="s">&quot;/ping&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><span class="w">            </span><span class="s">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pong&quot;</span><span class="p">,</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span><span class="w"> </span><span class="c1">// 默认监听端口 8080</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>然后运行：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a>go get github.com/gin-gonic/gin
</code></pre></div></td></tr></table></div>
<p><strong>效果</strong>：</p>
<ul>
<li>
<p><code>go.mod
  <div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a>文件中会添加：
</code></pre></div></td></tr></table></div>
  require github.com/gin-gonic/gin v1.7.7</code></p>
</li>
<li>
<p><code>go.sum</code>文件中记录了依赖的校验和，确保依赖的完整性和一致性。</p>
</li>
</ul>
<h4 id="管理版本">管理版本<a class="headerlink" href="#管理版本" title="Permanent link">&para;</a></h4>
<p>Go Modules 支持对依赖版本的精确控制，允许开发者指定使用特定版本的依赖，或者升级/降级依赖版本。</p>
<p><strong>查看依赖版本</strong>： 使用<code>go list -m all</code>命令查看所有依赖及其版本：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a>go list -m all
</code></pre></div></td></tr></table></div>
<p><strong>升级依赖</strong>： 使用<code>go get</code>命令指定版本升级依赖：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a>go get github.com/gin-gonic/gin@v1.8.0
</code></pre></div></td></tr></table></div>
<p>这将升级Gin框架到1.8.0版本，并更新<code>go.mod</code>和<code>go.sum</code>文件。</p>
<p><strong>降级依赖</strong>： 同样使用<code>go get</code>命令指定较低版本降级依赖：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a>go get github.com/gin-gonic/gin@v1.7.7
</code></pre></div></td></tr></table></div>
<p><strong>移除不需要的依赖</strong>： 使用<code>go mod tidy</code>命令清理未使用的依赖：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a>go mod tidy
</code></pre></div></td></tr></table></div>
<p>这将移除<code>go.mod</code>和<code>go.sum</code>中未使用的依赖，保持依赖文件的整洁。</p>
<p><strong>替换依赖源</strong>： 在某些情况下，可能需要替换依赖源，例如使用私有仓库或镜像。可以在<code>go.mod</code>文件中添加<code>replace</code>指令：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a>replace github.com/old/dependency =&gt; github.com/new/dependency v1.2.3
</code></pre></div></td></tr></table></div>
<p><strong>示例</strong>：</p>
<p>假设需要将<code>github.com/gin-gonic/gin</code>替换为本地开发版本：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a>replace github.com/gin-gonic/gin =&gt; ../local/gin
</code></pre></div></td></tr></table></div>
<p>这将指向本地路径<code>../local/gin</code>，方便进行本地调试和开发。</p>
<p><strong>版本管理策略</strong>：</p>
<ul>
<li><strong>语义化版本控制（SemVer）</strong>：Go Modules 使用语义化版本控制，版本号格式为<code>vMAJOR.MINOR.PATCH</code>，例如<code>v1.2.3</code>。</li>
<li><strong>版本兼容性</strong>：遵循语义化版本控制，MAJOR版本变更表示不兼容的API修改，MINOR版本增加向后兼容的功能，PATCH版本修复BUG。</li>
<li><strong>依赖锁定</strong>：<code>go.sum</code>文件记录了所有依赖的具体版本和校验和，确保不同环境下构建的一致性。</li>
</ul>
<p><strong>依赖冲突解决</strong>：</p>
<p>在项目中可能会遇到不同依赖对同一包的不同版本需求。Go Modules 会根据依赖关系图选择最适合的版本，并尽量满足所有依赖的要求。如果无法自动解决，可以手动指定需要的版本。</p>
<p><strong>示例</strong>：</p>
<p>项目A依赖包X v1.0.0和包Y v2.0.0，包Y v2.0.0又依赖包X v1.1.0。Go Modules 会选择包X v1.1.0，因为它是最高版本且向后兼容。</p>
<p><strong>手动指定版本</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a>go get github.com/some/package@v1.1.0
</code></pre></div></td></tr></table></div>
<p>这将强制使用指定版本，覆盖自动选择的版本。</p>
<h2 id="3-基本语法与数据类型">3. 基本语法与数据类型<a class="headerlink" href="#3-基本语法与数据类型" title="Permanent link">&para;</a></h2>
<p>Go语言作为一种静态类型、编译型语言，拥有简洁且高效的语法结构。本章将深入介绍Go的基本语法和数据类型，帮助你建立扎实的编程基础。</p>
<h3 id="31-第一个-go-程序">3.1 第一个 Go 程序<a class="headerlink" href="#31-第一个-go-程序" title="Permanent link">&para;</a></h3>
<p>编写第一个Go程序是学习任何编程语言的传统步骤。通过一个简单的“Hello, World!”程序，你将了解Go程序的基本结构和运行方式。</p>
<h4 id="main-函数"><code>main</code> 函数<a class="headerlink" href="#main-函数" title="Permanent link">&para;</a></h4>
<p>每个Go程序的执行都从<code>main</code>包的<code>main</code>函数开始。<code>main</code>函数是程序的入口点，定义了程序启动时执行的代码。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span>
<span class="normal"><a href="#__codelineno-69-2">2</a></span>
<span class="normal"><a href="#__codelineno-69-3">3</a></span>
<span class="normal"><a href="#__codelineno-69-4">4</a></span>
<span class="normal"><a href="#__codelineno-69-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="w">    </span><span class="c1">// 程序入口</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>package main</code>: 声明当前文件属于<code>main</code>包。<code>main</code>包是可执行程序的入口包。</li>
<li><code>func main()</code>: 定义<code>main</code>函数，这是程序的起始点。</li>
</ul>
<h4 id="fmtprintln-输出"><code>fmt.Println()</code> 输出<a class="headerlink" href="#fmtprintln-输出" title="Permanent link">&para;</a></h4>
<p><code>fmt</code>包是Go的标准输入输出包，提供了格式化的I/O函数。<code>fmt.Println()</code>用于在控制台输出文本并换行。</p>
<p><strong>完整的“Hello, World!”程序：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span>
<span class="normal"><a href="#__codelineno-70-4">4</a></span>
<span class="normal"><a href="#__codelineno-70-5">5</a></span>
<span class="normal"><a href="#__codelineno-70-6">6</a></span>
<span class="normal"><a href="#__codelineno-70-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>import "fmt"</code>: 导入<code>fmt</code>包，以便使用其提供的函数。</li>
<li><code>fmt.Println("Hello, World!")</code>: 输出字符串“Hello, World!”到控制台，并换行。</li>
</ul>
<p><strong>运行程序：</strong></p>
<ol>
<li>
<p>保存文件为<code>hello.go</code>。</p>
</li>
<li>
<p>在终端中导航到文件所在目录。</p>
</li>
<li>
<p>执行命令：</p>
</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a>go run hello.go
</code></pre></div></td></tr></table></div>
<ol>
<li>输出：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a>Hello, World!
</code></pre></div></td></tr></table></div>
<p><strong>编译并运行：</strong></p>
<ol>
<li>编译程序：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a>go build hello.go
</code></pre></div></td></tr></table></div>
<p>这将生成一个可执行文件</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a>hello
</code></pre></div></td></tr></table></div>
<p>（在Windows上为</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a>hello.exe
</code></pre></div></td></tr></table></div>
<p>）。</p>
<ol>
<li>运行可执行文件：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a>./hello
</code></pre></div></td></tr></table></div>
<ol>
<li>输出：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a>Hello, World!
</code></pre></div></td></tr></table></div>
<h3 id="32-变量与常量">3.2 变量与常量<a class="headerlink" href="#32-变量与常量" title="Permanent link">&para;</a></h3>
<p>变量和常量是编程语言中存储和管理数据的基本单元。Go语言提供了多种方式来声明和使用变量和常量。</p>
<h4 id="声明变量">声明变量<a class="headerlink" href="#声明变量" title="Permanent link">&para;</a></h4>
<p>在Go中，变量使用<code>var</code>关键字声明，后跟变量名和类型。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span>
<span class="normal"><a href="#__codelineno-78-3">3</a></span>
<span class="normal"><a href="#__codelineno-78-4">4</a></span>
<span class="normal"><a href="#__codelineno-78-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="nx">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span>
</code></pre></div></td></tr></table></div>
<p>也可以在声明时赋值：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span>
</code></pre></div></td></tr></table></div>
<p>Go支持类型推断，即编译器可以根据赋值自动推断变量类型：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span><span class="w">          </span><span class="c1">// age为int</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w">    </span><span class="c1">// name为string</span>
</code></pre></div></td></tr></table></div>
<h4 id="短变量声明">短变量声明<a class="headerlink" href="#短变量声明" title="Permanent link">&para;</a></h4>
<p>在函数内部，可以使用短变量声明语法<code>:=</code>来声明并初始化变量，而无需显式指定类型。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span>
<span class="normal"><a href="#__codelineno-81-2">2</a></span>
<span class="normal"><a href="#__codelineno-81-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="nx">isStudent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kc">true</span>
</code></pre></div></td></tr></table></div>
<p>等同于：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span>
<span class="normal"><a href="#__codelineno-82-2">2</a></span>
<span class="normal"><a href="#__codelineno-82-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">isStudent</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
</code></pre></div></td></tr></table></div>
<h4 id="常量与枚举">常量与枚举<a class="headerlink" href="#常量与枚举" title="Permanent link">&para;</a></h4>
<p>常量使用<code>const</code>关键字声明，其值在编译时确定，且不可修改。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1">1</a></span>
<span class="normal"><a href="#__codelineno-83-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">Pi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.14159</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">Greeting</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span>
</code></pre></div></td></tr></table></div>
<p>Go不直接支持枚举类型，但可以使用常量组合<code>iota</code>来模拟枚举。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span>
<span class="normal"><a href="#__codelineno-84-2">2</a></span>
<span class="normal"><a href="#__codelineno-84-3">3</a></span>
<span class="normal"><a href="#__codelineno-84-4">4</a></span>
<span class="normal"><a href="#__codelineno-84-5">5</a></span>
<span class="normal"><a href="#__codelineno-84-6">6</a></span>
<span class="normal"><a href="#__codelineno-84-7">7</a></span>
<span class="normal"><a href="#__codelineno-84-8">8</a></span>
<span class="normal"><a href="#__codelineno-84-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="w">    </span><span class="nx">Sunday</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">iota</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="w">    </span><span class="nx">Monday</span>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a><span class="w">    </span><span class="nx">Tuesday</span>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><span class="w">    </span><span class="nx">Wednesday</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a><span class="w">    </span><span class="nx">Thursday</span>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a><span class="w">    </span><span class="nx">Friday</span>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a><span class="w">    </span><span class="nx">Saturday</span>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>iota</code>是Go的一个预声明标识符，表示常量组中的索引，从0开始。</li>
<li>上述代码定义了一组代表星期的常量，分别为0到6。</li>
</ul>
<p><strong>使用枚举模拟：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-85-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-85-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-85-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-85-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-85-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-85-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-85-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-85-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-85-10">10</a></span>
<span class="normal"><a href="#__codelineno-85-11">11</a></span>
<span class="normal"><a href="#__codelineno-85-12">12</a></span>
<span class="normal"><a href="#__codelineno-85-13">13</a></span>
<span class="normal"><a href="#__codelineno-85-14">14</a></span>
<span class="normal"><a href="#__codelineno-85-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-85-4" name="__codelineno-85-4"></a>
<a id="__codelineno-85-5" name="__codelineno-85-5"></a><span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-85-6" name="__codelineno-85-6"></a><span class="w">    </span><span class="nx">Red</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">iota</span>
<a id="__codelineno-85-7" name="__codelineno-85-7"></a><span class="w">    </span><span class="nx">Green</span>
<a id="__codelineno-85-8" name="__codelineno-85-8"></a><span class="w">    </span><span class="nx">Blue</span>
<a id="__codelineno-85-9" name="__codelineno-85-9"></a><span class="p">)</span>
<a id="__codelineno-85-10" name="__codelineno-85-10"></a>
<a id="__codelineno-85-11" name="__codelineno-85-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-12" name="__codelineno-85-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Red</span><span class="p">)</span><span class="w">    </span><span class="c1">// 输出: 0</span>
<a id="__codelineno-85-13" name="__codelineno-85-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Green</span><span class="p">)</span><span class="w">  </span><span class="c1">// 输出: 1</span>
<a id="__codelineno-85-14" name="__codelineno-85-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Blue</span><span class="p">)</span><span class="w">   </span><span class="c1">// 输出: 2</span>
<a id="__codelineno-85-15" name="__codelineno-85-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="33-数据类型">3.3 数据类型<a class="headerlink" href="#33-数据类型" title="Permanent link">&para;</a></h3>
<p>Go语言提供了多种数据类型，分为基本类型和复合类型。掌握这些数据类型是编写有效Go程序的基础。</p>
<h4 id="基本类型">基本类型<a class="headerlink" href="#基本类型" title="Permanent link">&para;</a></h4>
<h5 id="整型">整型<a class="headerlink" href="#整型" title="Permanent link">&para;</a></h5>
<p>Go支持多种整型，包括有符号和无符号类型，以及不同位数的类型。</p>
<ul>
<li>有符号整型：<code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code>, <code>int</code></li>
<li>无符号整型：<code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>, <code>uint</code></li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span>
<span class="normal"><a href="#__codelineno-86-3">3</a></span>
<span class="normal"><a href="#__codelineno-86-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10000000000</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="kt">uint8</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">255</span>
</code></pre></div></td></tr></table></div>
<h5 id="浮点型">浮点型<a class="headerlink" href="#浮点型" title="Permanent link">&para;</a></h5>
<p>Go支持<code>float32</code>和<code>float64</code>两种浮点类型。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">pi</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.14</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.718281828459045</span>
</code></pre></div></td></tr></table></div>
<h5 id="字符串">字符串<a class="headerlink" href="#字符串" title="Permanent link">&para;</a></h5>
<p>字符串是由字符组成的序列，使用双引号<code>"</code>或反引号```包裹。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span>
<span class="normal"><a href="#__codelineno-88-2">2</a></span>
<span class="normal"><a href="#__codelineno-88-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">greeting</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">multiline</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">`This is a</span>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="s">multiline string.`</span>
</code></pre></div></td></tr></table></div>
<p>字符串是不可变的，无法直接修改单个字符。</p>
<h5 id="布尔型">布尔型<a class="headerlink" href="#布尔型" title="Permanent link">&para;</a></h5>
<p>布尔类型表示真或假，使用<code>bool</code>类型。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span>
<span class="normal"><a href="#__codelineno-89-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">isGoFun</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">isStudent</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div></td></tr></table></div>
<h4 id="复合类型">复合类型<a class="headerlink" href="#复合类型" title="Permanent link">&para;</a></h4>
<p>复合类型是由多个基本类型组成的类型，包括数组、切片、Map、结构体和指针。</p>
<h5 id="数组">数组<a class="headerlink" href="#数组" title="Permanent link">&para;</a></h5>
<p>数组是具有固定大小和相同类型元素的有序集合。</p>
<p><strong>声明和初始化：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span>
<span class="normal"><a href="#__codelineno-90-2">2</a></span>
<span class="normal"><a href="#__codelineno-90-3">3</a></span>
<span class="normal"><a href="#__codelineno-90-4">4</a></span>
<span class="normal"><a href="#__codelineno-90-5">5</a></span>
<span class="normal"><a href="#__codelineno-90-6">6</a></span>
<span class="normal"><a href="#__codelineno-90-7">7</a></span>
<span class="normal"><a href="#__codelineno-90-8">8</a></span>
<span class="normal"><a href="#__codelineno-90-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-90-4" name="__codelineno-90-4"></a>
<a id="__codelineno-90-5" name="__codelineno-90-5"></a><span class="c1">// 声明并初始化</span>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">arr2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cherry&quot;</span><span class="p">}</span>
<a id="__codelineno-90-7" name="__codelineno-90-7"></a>
<a id="__codelineno-90-8" name="__codelineno-90-8"></a><span class="c1">// 使用省略长度</span>
<a id="__codelineno-90-9" name="__codelineno-90-9"></a><span class="nx">arr3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">float64</span><span class="p">{</span><span class="mf">1.1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.3</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>遍历数组：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span>
<span class="normal"><a href="#__codelineno-91-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">arr2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Index: %d, Value: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="切片">切片<a class="headerlink" href="#切片" title="Permanent link">&para;</a></h5>
<p>切片是基于数组的动态数据结构，比数组更灵活和强大。切片的长度和容量可以动态变化。</p>
<p><strong>声明和初始化：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span>
<span class="normal"><a href="#__codelineno-92-3">3</a></span>
<span class="normal"><a href="#__codelineno-92-4">4</a></span>
<span class="normal"><a href="#__codelineno-92-5">5</a></span>
<span class="normal"><a href="#__codelineno-92-6">6</a></span>
<span class="normal"><a href="#__codelineno-92-7">7</a></span>
<span class="normal"><a href="#__codelineno-92-8">8</a></span>
<span class="normal"><a href="#__codelineno-92-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="c1">// 空切片</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="c1">// 使用make函数</span>
<a id="__codelineno-92-5" name="__codelineno-92-5"></a><span class="nx">s1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c1">// 长度为5，元素初始化为0</span>
<a id="__codelineno-92-6" name="__codelineno-92-6"></a><span class="nx">s2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// 长度为3，容量为10</span>
<a id="__codelineno-92-7" name="__codelineno-92-7"></a>
<a id="__codelineno-92-8" name="__codelineno-92-8"></a><span class="c1">// 字面量初始化</span>
<a id="__codelineno-92-9" name="__codelineno-92-9"></a><span class="nx">s3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>添加元素：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span>
<span class="normal"><a href="#__codelineno-93-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="nx">s4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="nx">s4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s4</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>切片截取：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span>
<span class="normal"><a href="#__codelineno-94-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="nx">s5</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="nx">sub</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s5</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="c1">// 包含索引1和2，不包含3</span>
<a id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">sub</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [2 3]</span>
</code></pre></div></td></tr></table></div>
<p><strong>切片的底层原理：</strong> 切片由指向数组的指针、长度和容量组成。切片的容量表示从切片的起始位置到底层数组末尾的元素数量。</p>
<h5 id="map">Map<a class="headerlink" href="#map" title="Permanent link">&para;</a></h5>
<p>Map是键值对的无序集合，键和值可以是不同的类型。Map在Go中作为内置数据类型提供，类似于Python的字典或Java的HashMap。</p>
<p><strong>声明和初始化：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-95-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-95-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-95-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-95-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-95-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-95-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-95-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-95-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-95-10">10</a></span>
<span class="normal"><a href="#__codelineno-95-11">11</a></span>
<span class="normal"><a href="#__codelineno-95-12">12</a></span>
<span class="normal"><a href="#__codelineno-95-13">13</a></span>
<span class="normal"><a href="#__codelineno-95-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="c1">// 声明为空Map</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="c1">// 使用make初始化</span>
<a id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="nx">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-95-6" name="__codelineno-95-6"></a>
<a id="__codelineno-95-7" name="__codelineno-95-7"></a><span class="c1">// 声明并初始化</span>
<a id="__codelineno-95-8" name="__codelineno-95-8"></a><span class="nx">m1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span>
<a id="__codelineno-95-9" name="__codelineno-95-9"></a><span class="w">    </span><span class="s">&quot;apple&quot;</span><span class="p">:</span><span class="w">  </span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-95-10" name="__codelineno-95-10"></a><span class="w">    </span><span class="s">&quot;banana&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-95-11" name="__codelineno-95-11"></a><span class="p">}</span>
<a id="__codelineno-95-12" name="__codelineno-95-12"></a>
<a id="__codelineno-95-13" name="__codelineno-95-13"></a><span class="c1">// 使用简短声明</span>
<a id="__codelineno-95-14" name="__codelineno-95-14"></a><span class="nx">m2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>添加和访问元素：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1">1</a></span>
<span class="normal"><a href="#__codelineno-96-2">2</a></span>
<span class="normal"><a href="#__codelineno-96-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="nx">m</span><span class="p">[</span><span class="s">&quot;orange&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">7</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">[</span><span class="s">&quot;apple&quot;</span><span class="p">]</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;apple:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>删除元素：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="nb">delete</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>检查键是否存在：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span>
<span class="normal"><a href="#__codelineno-98-2">2</a></span>
<span class="normal"><a href="#__codelineno-98-3">3</a></span>
<span class="normal"><a href="#__codelineno-98-4">4</a></span>
<span class="normal"><a href="#__codelineno-98-5">5</a></span>
<span class="normal"><a href="#__codelineno-98-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">m</span><span class="p">[</span><span class="s">&quot;banana&quot;</span><span class="p">]</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;banana exists with value:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;banana does not exist&quot;</span><span class="p">)</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>遍历Map：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span>
<span class="normal"><a href="#__codelineno-99-2">2</a></span>
<span class="normal"><a href="#__codelineno-99-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="k">for</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Key: %s, Value: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="结构体">结构体<a class="headerlink" href="#结构体" title="Permanent link">&para;</a></h5>
<p>结构体是由多个字段组成的复合数据类型，可以包含不同类型的数据。</p>
<p><strong>定义和使用结构体：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-100-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-100-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-100-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-100-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-100-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-100-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-100-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-100-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-100-10">10</a></span>
<span class="normal"><a href="#__codelineno-100-11">11</a></span>
<span class="normal"><a href="#__codelineno-100-12">12</a></span>
<span class="normal"><a href="#__codelineno-100-13">13</a></span>
<span class="normal"><a href="#__codelineno-100-14">14</a></span>
<span class="normal"><a href="#__codelineno-100-15">15</a></span>
<span class="normal"><a href="#__codelineno-100-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-100-3" name="__codelineno-100-3"></a><span class="w">    </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<a id="__codelineno-100-4" name="__codelineno-100-4"></a><span class="p">}</span>
<a id="__codelineno-100-5" name="__codelineno-100-5"></a>
<a id="__codelineno-100-6" name="__codelineno-100-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-7" name="__codelineno-100-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="nx">Person</span>
<a id="__codelineno-100-8" name="__codelineno-100-8"></a><span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span>
<a id="__codelineno-100-9" name="__codelineno-100-9"></a><span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">Age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-100-10" name="__codelineno-100-10"></a>
<a id="__codelineno-100-11" name="__codelineno-100-11"></a><span class="w">    </span><span class="c1">// 使用字面量初始化</span>
<a id="__codelineno-100-12" name="__codelineno-100-12"></a><span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">}</span>
<a id="__codelineno-100-13" name="__codelineno-100-13"></a>
<a id="__codelineno-100-14" name="__codelineno-100-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
<a id="__codelineno-100-15" name="__codelineno-100-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p2</span><span class="p">)</span>
<a id="__codelineno-100-16" name="__codelineno-100-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>嵌套结构体：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-101-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-101-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-101-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-101-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-101-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-101-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-101-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-101-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-101-10">10</a></span>
<span class="normal"><a href="#__codelineno-101-11">11</a></span>
<span class="normal"><a href="#__codelineno-101-12">12</a></span>
<span class="normal"><a href="#__codelineno-101-13">13</a></span>
<span class="normal"><a href="#__codelineno-101-14">14</a></span>
<span class="normal"><a href="#__codelineno-101-15">15</a></span>
<span class="normal"><a href="#__codelineno-101-16">16</a></span>
<span class="normal"><a href="#__codelineno-101-17">17</a></span>
<span class="normal"><a href="#__codelineno-101-18">18</a></span>
<span class="normal"><a href="#__codelineno-101-19">19</a></span>
<span class="normal"><a href="#__codelineno-101-20">20</a></span>
<span class="normal"><a href="#__codelineno-101-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="w">    </span><span class="nx">City</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="w">    </span><span class="nx">ZipCode</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="p">}</span>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a>
<a id="__codelineno-101-6" name="__codelineno-101-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Employee</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-7" name="__codelineno-101-7"></a><span class="w">    </span><span class="nx">Person</span>
<a id="__codelineno-101-8" name="__codelineno-101-8"></a><span class="w">    </span><span class="nx">Address</span>
<a id="__codelineno-101-9" name="__codelineno-101-9"></a><span class="w">    </span><span class="nx">Position</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-101-10" name="__codelineno-101-10"></a><span class="p">}</span>
<a id="__codelineno-101-11" name="__codelineno-101-11"></a>
<a id="__codelineno-101-12" name="__codelineno-101-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-13" name="__codelineno-101-13"></a><span class="w">    </span><span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Employee</span><span class="p">{</span>
<a id="__codelineno-101-14" name="__codelineno-101-14"></a><span class="w">        </span><span class="nx">Person</span><span class="p">:</span><span class="w">   </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">},</span>
<a id="__codelineno-101-15" name="__codelineno-101-15"></a><span class="w">        </span><span class="nx">Address</span><span class="p">:</span><span class="w">  </span><span class="nx">Address</span><span class="p">{</span><span class="nx">City</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New York&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ZipCode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10001&quot;</span><span class="p">},</span>
<a id="__codelineno-101-16" name="__codelineno-101-16"></a><span class="w">        </span><span class="nx">Position</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Developer&quot;</span><span class="p">,</span>
<a id="__codelineno-101-17" name="__codelineno-101-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-18" name="__codelineno-101-18"></a>
<a id="__codelineno-101-19" name="__codelineno-101-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
<a id="__codelineno-101-20" name="__codelineno-101-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;City:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Address</span><span class="p">.</span><span class="nx">City</span><span class="p">)</span>
<a id="__codelineno-101-21" name="__codelineno-101-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>方法与结构体：</strong></p>
<p>Go支持为结构体类型定义方法。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-102-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-102-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-102-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-102-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-102-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-102-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-102-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-102-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-102-10">10</a></span>
<span class="normal"><a href="#__codelineno-102-11">11</a></span>
<span class="normal"><a href="#__codelineno-102-12">12</a></span>
<span class="normal"><a href="#__codelineno-102-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="w">    </span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a><span class="p">}</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a>
<a id="__codelineno-102-5" name="__codelineno-102-5"></a><span class="c1">// 方法接收者为指针类型</span>
<a id="__codelineno-102-6" name="__codelineno-102-6"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-7" name="__codelineno-102-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span>
<a id="__codelineno-102-8" name="__codelineno-102-8"></a><span class="p">}</span>
<a id="__codelineno-102-9" name="__codelineno-102-9"></a>
<a id="__codelineno-102-10" name="__codelineno-102-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-11" name="__codelineno-102-11"></a><span class="w">    </span><span class="nx">rect</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-102-12" name="__codelineno-102-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Area:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">Area</span><span class="p">())</span>
<a id="__codelineno-102-13" name="__codelineno-102-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="指针">指针<a class="headerlink" href="#指针" title="Permanent link">&para;</a></h5>
<p>指针是存储变量内存地址的变量。Go中使用指针可以提高程序的性能，避免大量数据的复制。</p>
<p><strong>声明和使用指针：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-103-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-103-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-103-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-103-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-103-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-103-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-103-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-103-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-103-10">10</a></span>
<span class="normal"><a href="#__codelineno-103-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span><span class="w"> </span><span class="c1">// p指向a的地址</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a>
<a id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w">       </span><span class="c1">// 输出: a: 10</span>
<a id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;p:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w">       </span><span class="c1">// 输出: p: 地址值</span>
<a id="__codelineno-103-7" name="__codelineno-103-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;*p:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w">     </span><span class="c1">// 输出: *p: 10</span>
<a id="__codelineno-103-8" name="__codelineno-103-8"></a>
<a id="__codelineno-103-9" name="__codelineno-103-9"></a><span class="w">    </span><span class="o">*</span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="c1">// 通过指针修改a的值</span>
<a id="__codelineno-103-10" name="__codelineno-103-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a after:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: a after: 20</span>
<a id="__codelineno-103-11" name="__codelineno-103-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>指针与函数：</strong></p>
<p>使用指针作为函数参数，可以在函数中修改传入的变量。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span>
<span class="normal"><a href="#__codelineno-104-2">2</a></span>
<span class="normal"><a href="#__codelineno-104-3">3</a></span>
<span class="normal"><a href="#__codelineno-104-4">4</a></span>
<span class="normal"><a href="#__codelineno-104-5">5</a></span>
<span class="normal"><a href="#__codelineno-104-6">6</a></span>
<span class="normal"><a href="#__codelineno-104-7">7</a></span>
<span class="normal"><a href="#__codelineno-104-8">8</a></span>
<span class="normal"><a href="#__codelineno-104-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">increment</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="w">    </span><span class="o">*</span><span class="nx">n</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a><span class="p">}</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a>
<a id="__codelineno-104-5" name="__codelineno-104-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-6" name="__codelineno-104-6"></a><span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">5</span>
<a id="__codelineno-104-7" name="__codelineno-104-7"></a><span class="w">    </span><span class="nx">increment</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">)</span>
<a id="__codelineno-104-8" name="__codelineno-104-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a after increment:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: a after increment: 6</span>
<a id="__codelineno-104-9" name="__codelineno-104-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="34-类型转换">3.4 类型转换<a class="headerlink" href="#34-类型转换" title="Permanent link">&para;</a></h3>
<p>在Go中，不同类型之间的转换需要显式进行，称为类型转换。Go不支持隐式类型转换，以确保类型安全。</p>
<p><strong>语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1">1</a></span>
<span class="normal"><a href="#__codelineno-105-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-106-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-106-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-106-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-106-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-106-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-106-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-106-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-106-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-106-10">10</a></span>
<span class="normal"><a href="#__codelineno-106-11">11</a></span>
<span class="normal"><a href="#__codelineno-106-12">12</a></span>
<span class="normal"><a href="#__codelineno-106-13">13</a></span>
<span class="normal"><a href="#__codelineno-106-14">14</a></span>
<span class="normal"><a href="#__codelineno-106-15">15</a></span>
<span class="normal"><a href="#__codelineno-106-16">16</a></span>
<span class="normal"><a href="#__codelineno-106-17">17</a></span>
<span class="normal"><a href="#__codelineno-106-18">18</a></span>
<span class="normal"><a href="#__codelineno-106-19">19</a></span>
<span class="normal"><a href="#__codelineno-106-20">20</a></span>
<span class="normal"><a href="#__codelineno-106-21">21</a></span>
<span class="normal"><a href="#__codelineno-106-22">22</a></span>
<span class="normal"><a href="#__codelineno-106-23">23</a></span>
<span class="normal"><a href="#__codelineno-106-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a>
<a id="__codelineno-106-5" name="__codelineno-106-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-6" name="__codelineno-106-6"></a><span class="w">    </span><span class="c1">// 整型与浮点型转换</span>
<a id="__codelineno-106-7" name="__codelineno-106-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span>
<a id="__codelineno-106-8" name="__codelineno-106-8"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<a id="__codelineno-106-9" name="__codelineno-106-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="c1">// 会截断小数部分</span>
<a id="__codelineno-106-10" name="__codelineno-106-10"></a>
<a id="__codelineno-106-11" name="__codelineno-106-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 5 5.0 5</span>
<a id="__codelineno-106-12" name="__codelineno-106-12"></a>
<a id="__codelineno-106-13" name="__codelineno-106-13"></a><span class="w">    </span><span class="c1">// 字符串与字节切片转换</span>
<a id="__codelineno-106-14" name="__codelineno-106-14"></a><span class="w">    </span><span class="nx">str</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span>
<a id="__codelineno-106-15" name="__codelineno-106-15"></a><span class="w">    </span><span class="nx">bytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
<a id="__codelineno-106-16" name="__codelineno-106-16"></a><span class="w">    </span><span class="nx">str2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span>
<a id="__codelineno-106-17" name="__codelineno-106-17"></a>
<a id="__codelineno-106-18" name="__codelineno-106-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">str2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Hello [72 101 108 108 111] Hello</span>
<a id="__codelineno-106-19" name="__codelineno-106-19"></a>
<a id="__codelineno-106-20" name="__codelineno-106-20"></a><span class="w">    </span><span class="c1">// 类型之间的转换示例：int到string（需要转换为字符）</span>
<a id="__codelineno-106-21" name="__codelineno-106-21"></a><span class="w">    </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">65</span>
<a id="__codelineno-106-22" name="__codelineno-106-22"></a><span class="w">    </span><span class="nx">char</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-106-23" name="__codelineno-106-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">char</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: &#39;A&#39;</span>
<a id="__codelineno-106-24" name="__codelineno-106-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>注意事项：</strong></p>
<ul>
<li>只能在兼容类型之间转换，如整数类型之间、浮点类型之间。</li>
<li>字符串与字节切片之间的转换需要使用<code>[]byte</code>和<code>string</code>类型转换。</li>
<li>类型转换可能导致数据丢失，如将<code>float64</code>转换为<code>int</code>会截断小数部分。</li>
</ul>
<p><strong>更多示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-107-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-107-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-107-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-107-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-107-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-107-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-107-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-107-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-107-10">10</a></span>
<span class="normal"><a href="#__codelineno-107-11">11</a></span>
<span class="normal"><a href="#__codelineno-107-12">12</a></span>
<span class="normal"><a href="#__codelineno-107-13">13</a></span>
<span class="normal"><a href="#__codelineno-107-14">14</a></span>
<span class="normal"><a href="#__codelineno-107-15">15</a></span>
<span class="normal"><a href="#__codelineno-107-16">16</a></span>
<span class="normal"><a href="#__codelineno-107-17">17</a></span>
<span class="normal"><a href="#__codelineno-107-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="c1">// 将int转换为float64</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">42</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a><span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 42</span>
<a id="__codelineno-107-5" name="__codelineno-107-5"></a>
<a id="__codelineno-107-6" name="__codelineno-107-6"></a><span class="c1">// 将float64转换为int</span>
<a id="__codelineno-107-7" name="__codelineno-107-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.14</span>
<a id="__codelineno-107-8" name="__codelineno-107-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span>
<a id="__codelineno-107-9" name="__codelineno-107-9"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 3</span>
<a id="__codelineno-107-10" name="__codelineno-107-10"></a>
<a id="__codelineno-107-11" name="__codelineno-107-11"></a><span class="c1">// 将string转换为[]rune</span>
<a id="__codelineno-107-12" name="__codelineno-107-12"></a><span class="nx">str</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;你好&quot;</span>
<a id="__codelineno-107-13" name="__codelineno-107-13"></a><span class="nx">runes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">rune</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
<a id="__codelineno-107-14" name="__codelineno-107-14"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">runes</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [20320 22909]</span>
<a id="__codelineno-107-15" name="__codelineno-107-15"></a>
<a id="__codelineno-107-16" name="__codelineno-107-16"></a><span class="c1">// 将[]rune转换为string</span>
<a id="__codelineno-107-17" name="__codelineno-107-17"></a><span class="nx">str2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">runes</span><span class="p">)</span>
<a id="__codelineno-107-18" name="__codelineno-107-18"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">str2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 你好</span>
</code></pre></div></td></tr></table></div>
<p><strong>类型转换与算术运算：</strong></p>
<p>在进行算术运算时，操作数必须是相同类型。否则，需要先进行类型转换。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-108-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-108-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-108-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-108-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-108-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-108-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-108-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-108-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-108-10">10</a></span>
<span class="normal"><a href="#__codelineno-108-11">11</a></span>
<span class="normal"><a href="#__codelineno-108-12">12</a></span>
<span class="normal"><a href="#__codelineno-108-13">13</a></span>
<span class="normal"><a href="#__codelineno-108-14">14</a></span>
<span class="normal"><a href="#__codelineno-108-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-108-4" name="__codelineno-108-4"></a>
<a id="__codelineno-108-5" name="__codelineno-108-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-6" name="__codelineno-108-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-108-7" name="__codelineno-108-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.14</span>
<a id="__codelineno-108-8" name="__codelineno-108-8"></a>
<a id="__codelineno-108-9" name="__codelineno-108-9"></a><span class="w">    </span><span class="c1">// 错误：不能直接相加不同类型</span>
<a id="__codelineno-108-10" name="__codelineno-108-10"></a><span class="w">    </span><span class="c1">// c := a + b</span>
<a id="__codelineno-108-11" name="__codelineno-108-11"></a>
<a id="__codelineno-108-12" name="__codelineno-108-12"></a><span class="w">    </span><span class="c1">// 正确：先转换类型</span>
<a id="__codelineno-108-13" name="__codelineno-108-13"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-108-14" name="__codelineno-108-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 13.14</span>
<a id="__codelineno-108-15" name="__codelineno-108-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="4-控制结构">4. 控制结构<a class="headerlink" href="#4-控制结构" title="Permanent link">&para;</a></h2>
<p>控制结构是编程语言中用于控制程序流程的语句。在Go语言中，控制结构包括条件语句、循环语句和跳转语句。这些结构使得程序能够根据不同的条件执行不同的代码块，或者重复执行某些操作。以下将详细介绍Go语言中的各种控制结构，并通过具体的示例进行说明。</p>
<h3 id="41-条件语句">4.1 条件语句<a class="headerlink" href="#41-条件语句" title="Permanent link">&para;</a></h3>
<p>条件语句用于根据某个条件的真假来决定是否执行某段代码。在Go语言中，主要有<code>if</code>和<code>switch</code>两种条件语句。</p>
<h4 id="if-和-else"><code>if</code> 和 <code>else</code><a class="headerlink" href="#if-和-else" title="Permanent link">&para;</a></h4>
<p><code>if</code>语句是最基本的条件语句，用于在满足特定条件时执行某段代码。<code>else</code>语句则用于在条件不满足时执行另一段代码。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1">1</a></span>
<span class="normal"><a href="#__codelineno-109-2">2</a></span>
<span class="normal"><a href="#__codelineno-109-3">3</a></span>
<span class="normal"><a href="#__codelineno-109-4">4</a></span>
<span class="normal"><a href="#__codelineno-109-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">条件</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a><span class="w">    </span><span class="c1">// 条件为真时执行的代码</span>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a><span class="w">    </span><span class="c1">// 条件为假时执行的代码</span>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-110-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-110-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-110-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-110-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-110-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-110-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-110-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-110-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-110-10">10</a></span>
<span class="normal"><a href="#__codelineno-110-11">11</a></span>
<span class="normal"><a href="#__codelineno-110-12">12</a></span>
<span class="normal"><a href="#__codelineno-110-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-110-4" name="__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-6" name="__codelineno-110-6"></a><span class="w">    </span><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-110-7" name="__codelineno-110-7"></a>
<a id="__codelineno-110-8" name="__codelineno-110-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-9" name="__codelineno-110-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;成年人&quot;</span><span class="p">)</span>
<a id="__codelineno-110-10" name="__codelineno-110-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-11" name="__codelineno-110-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;未成年人&quot;</span><span class="p">)</span>
<a id="__codelineno-110-12" name="__codelineno-110-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-110-13" name="__codelineno-110-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>如果<code>age</code>大于或等于18，输出“成年人”。</li>
<li>否则，输出“未成年人”。</li>
</ul>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a>成年人
</code></pre></div></td></tr></table></div>
<p><strong>带有<code>else if</code>的条件判断：</strong></p>
<p>Go语言允许在<code>if</code>和<code>else</code>之间添加多个<code>else if</code>来处理更多的条件。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-112-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-112-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-112-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-112-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-112-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-112-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-112-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-112-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-112-10">10</a></span>
<span class="normal"><a href="#__codelineno-112-11">11</a></span>
<span class="normal"><a href="#__codelineno-112-12">12</a></span>
<span class="normal"><a href="#__codelineno-112-13">13</a></span>
<span class="normal"><a href="#__codelineno-112-14">14</a></span>
<span class="normal"><a href="#__codelineno-112-15">15</a></span>
<span class="normal"><a href="#__codelineno-112-16">16</a></span>
<span class="normal"><a href="#__codelineno-112-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-112-2" name="__codelineno-112-2"></a>
<a id="__codelineno-112-3" name="__codelineno-112-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-112-4" name="__codelineno-112-4"></a>
<a id="__codelineno-112-5" name="__codelineno-112-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-6" name="__codelineno-112-6"></a><span class="w">    </span><span class="nx">score</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">85</span>
<a id="__codelineno-112-7" name="__codelineno-112-7"></a>
<a id="__codelineno-112-8" name="__codelineno-112-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-9" name="__codelineno-112-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;优秀&quot;</span><span class="p">)</span>
<a id="__codelineno-112-10" name="__codelineno-112-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">70</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-11" name="__codelineno-112-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;良好&quot;</span><span class="p">)</span>
<a id="__codelineno-112-12" name="__codelineno-112-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-13" name="__codelineno-112-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;及格&quot;</span><span class="p">)</span>
<a id="__codelineno-112-14" name="__codelineno-112-14"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-15" name="__codelineno-112-15"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;不及格&quot;</span><span class="p">)</span>
<a id="__codelineno-112-16" name="__codelineno-112-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-112-17" name="__codelineno-112-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>根据<code>score</code>的值，输出相应的评价。</li>
</ul>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a>良好
</code></pre></div></td></tr></table></div>
<p><strong>在<code>if</code>语句中初始化变量：</strong></p>
<p>Go语言允许在<code>if</code>语句中初始化变量，这些变量的作用域仅限于<code>if</code>和对应的<code>else</code>块内。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-114-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-114-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-114-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-114-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-114-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-114-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-114-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-114-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-114-10">10</a></span>
<span class="normal"><a href="#__codelineno-114-11">11</a></span>
<span class="normal"><a href="#__codelineno-114-12">12</a></span>
<span class="normal"><a href="#__codelineno-114-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a>
<a id="__codelineno-114-3" name="__codelineno-114-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-114-4" name="__codelineno-114-4"></a>
<a id="__codelineno-114-5" name="__codelineno-114-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-6" name="__codelineno-114-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">num</span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-7" name="__codelineno-114-7"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;是偶数&quot;</span><span class="p">)</span>
<a id="__codelineno-114-8" name="__codelineno-114-8"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-9" name="__codelineno-114-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;是奇数&quot;</span><span class="p">)</span>
<a id="__codelineno-114-10" name="__codelineno-114-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-114-11" name="__codelineno-114-11"></a>
<a id="__codelineno-114-12" name="__codelineno-114-12"></a><span class="w">    </span><span class="c1">// fmt.Println(num) // 这里会报错，num在if语句外不可见</span>
<a id="__codelineno-114-13" name="__codelineno-114-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>在<code>if</code>语句中声明变量<code>num</code>并初始化为10。</li>
<li>检查<code>num</code>是否为偶数，并输出相应的结果。</li>
<li><code>num</code>的作用域仅限于<code>if</code>和<code>else</code>块内，外部无法访问。</li>
</ul>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a>10 是偶数
</code></pre></div></td></tr></table></div>
<h4 id="switch-语句"><code>switch</code> 语句<a class="headerlink" href="#switch-语句" title="Permanent link">&para;</a></h4>
<p><code>switch</code>语句用于根据不同的值执行不同的代码块。与多个<code>if-else</code>语句相比，<code>switch</code>语句更加简洁和易读。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span>
<span class="normal"><a href="#__codelineno-116-2">2</a></span>
<span class="normal"><a href="#__codelineno-116-3">3</a></span>
<span class="normal"><a href="#__codelineno-116-4">4</a></span>
<span class="normal"><a href="#__codelineno-116-5">5</a></span>
<span class="normal"><a href="#__codelineno-116-6">6</a></span>
<span class="normal"><a href="#__codelineno-116-7">7</a></span>
<span class="normal"><a href="#__codelineno-116-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="k">switch</span><span class="w"> </span><span class="nx">表达式</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-2" name="__codelineno-116-2"></a><span class="k">case</span><span class="w"> </span><span class="nx">值1</span><span class="p">:</span>
<a id="__codelineno-116-3" name="__codelineno-116-3"></a><span class="w">    </span><span class="c1">// 当表达式等于值1时执行的代码</span>
<a id="__codelineno-116-4" name="__codelineno-116-4"></a><span class="k">case</span><span class="w"> </span><span class="nx">值2</span><span class="p">:</span>
<a id="__codelineno-116-5" name="__codelineno-116-5"></a><span class="w">    </span><span class="c1">// 当表达式等于值2时执行的代码</span>
<a id="__codelineno-116-6" name="__codelineno-116-6"></a><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-116-7" name="__codelineno-116-7"></a><span class="w">    </span><span class="c1">// 当表达式不匹配任何case时执行的代码</span>
<a id="__codelineno-116-8" name="__codelineno-116-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-117-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-117-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-117-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-117-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-117-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-117-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-117-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-117-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-117-10">10</a></span>
<span class="normal"><a href="#__codelineno-117-11">11</a></span>
<span class="normal"><a href="#__codelineno-117-12">12</a></span>
<span class="normal"><a href="#__codelineno-117-13">13</a></span>
<span class="normal"><a href="#__codelineno-117-14">14</a></span>
<span class="normal"><a href="#__codelineno-117-15">15</a></span>
<span class="normal"><a href="#__codelineno-117-16">16</a></span>
<span class="normal"><a href="#__codelineno-117-17">17</a></span>
<span class="normal"><a href="#__codelineno-117-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a>
<a id="__codelineno-117-5" name="__codelineno-117-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-6" name="__codelineno-117-6"></a><span class="w">    </span><span class="nx">day</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;星期三&quot;</span>
<a id="__codelineno-117-7" name="__codelineno-117-7"></a>
<a id="__codelineno-117-8" name="__codelineno-117-8"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">day</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-9" name="__codelineno-117-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;星期一&quot;</span><span class="p">:</span>
<a id="__codelineno-117-10" name="__codelineno-117-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;今天是星期一&quot;</span><span class="p">)</span>
<a id="__codelineno-117-11" name="__codelineno-117-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;星期二&quot;</span><span class="p">:</span>
<a id="__codelineno-117-12" name="__codelineno-117-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;今天是星期二&quot;</span><span class="p">)</span>
<a id="__codelineno-117-13" name="__codelineno-117-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;星期三&quot;</span><span class="p">:</span>
<a id="__codelineno-117-14" name="__codelineno-117-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;今天是星期三&quot;</span><span class="p">)</span>
<a id="__codelineno-117-15" name="__codelineno-117-15"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-117-16" name="__codelineno-117-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;未知的星期&quot;</span><span class="p">)</span>
<a id="__codelineno-117-17" name="__codelineno-117-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-117-18" name="__codelineno-117-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>根据变量<code>day</code>的值，匹配对应的<code>case</code>并执行相应的代码。</li>
<li>如果<code>day</code>不匹配任何<code>case</code>，则执行<code>default</code>块。</li>
</ul>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a>今天是星期三
</code></pre></div></td></tr></table></div>
<p><strong><code>switch</code>语句中的表达式省略：</strong></p>
<p>当省略<code>switch</code>语句中的表达式时，它相当于<code>switch true</code>，可以用于复杂的条件判断。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-119-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-119-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-119-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-119-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-119-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-119-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-119-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-119-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-119-10">10</a></span>
<span class="normal"><a href="#__codelineno-119-11">11</a></span>
<span class="normal"><a href="#__codelineno-119-12">12</a></span>
<span class="normal"><a href="#__codelineno-119-13">13</a></span>
<span class="normal"><a href="#__codelineno-119-14">14</a></span>
<span class="normal"><a href="#__codelineno-119-15">15</a></span>
<span class="normal"><a href="#__codelineno-119-16">16</a></span>
<span class="normal"><a href="#__codelineno-119-17">17</a></span>
<span class="normal"><a href="#__codelineno-119-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-119-2" name="__codelineno-119-2"></a>
<a id="__codelineno-119-3" name="__codelineno-119-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-119-4" name="__codelineno-119-4"></a>
<a id="__codelineno-119-5" name="__codelineno-119-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-6" name="__codelineno-119-6"></a><span class="w">    </span><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">25</span>
<a id="__codelineno-119-7" name="__codelineno-119-7"></a>
<a id="__codelineno-119-8" name="__codelineno-119-8"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-9" name="__codelineno-119-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">18</span><span class="p">:</span>
<a id="__codelineno-119-10" name="__codelineno-119-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;未成年人&quot;</span><span class="p">)</span>
<a id="__codelineno-119-11" name="__codelineno-119-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">30</span><span class="p">:</span>
<a id="__codelineno-119-12" name="__codelineno-119-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;年轻人&quot;</span><span class="p">)</span>
<a id="__codelineno-119-13" name="__codelineno-119-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="p">:</span>
<a id="__codelineno-119-14" name="__codelineno-119-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;中年人&quot;</span><span class="p">)</span>
<a id="__codelineno-119-15" name="__codelineno-119-15"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-119-16" name="__codelineno-119-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;老年人&quot;</span><span class="p">)</span>
<a id="__codelineno-119-17" name="__codelineno-119-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-119-18" name="__codelineno-119-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>根据多个条件判断，输出相应的结果。</li>
</ul>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a>年轻人
</code></pre></div></td></tr></table></div>
<p><strong>多值匹配：</strong></p>
<p>一个<code>case</code>可以匹配多个值，使用逗号分隔。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-121-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-121-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-121-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-121-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-121-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-121-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-121-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-121-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-121-10">10</a></span>
<span class="normal"><a href="#__codelineno-121-11">11</a></span>
<span class="normal"><a href="#__codelineno-121-12">12</a></span>
<span class="normal"><a href="#__codelineno-121-13">13</a></span>
<span class="normal"><a href="#__codelineno-121-14">14</a></span>
<span class="normal"><a href="#__codelineno-121-15">15</a></span>
<span class="normal"><a href="#__codelineno-121-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-121-4" name="__codelineno-121-4"></a>
<a id="__codelineno-121-5" name="__codelineno-121-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-6" name="__codelineno-121-6"></a><span class="w">    </span><span class="nx">fruit</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;苹果&quot;</span>
<a id="__codelineno-121-7" name="__codelineno-121-7"></a>
<a id="__codelineno-121-8" name="__codelineno-121-8"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">fruit</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-9" name="__codelineno-121-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;苹果&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;香蕉&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;橙子&quot;</span><span class="p">:</span>
<a id="__codelineno-121-10" name="__codelineno-121-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;常见水果&quot;</span><span class="p">)</span>
<a id="__codelineno-121-11" name="__codelineno-121-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;榴莲&quot;</span><span class="p">:</span>
<a id="__codelineno-121-12" name="__codelineno-121-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;热带水果&quot;</span><span class="p">)</span>
<a id="__codelineno-121-13" name="__codelineno-121-13"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-121-14" name="__codelineno-121-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;未知水果&quot;</span><span class="p">)</span>
<a id="__codelineno-121-15" name="__codelineno-121-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-121-16" name="__codelineno-121-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a>常见水果
</code></pre></div></td></tr></table></div>
<p><strong><code>fallthrough</code>关键字：</strong></p>
<p><code>fallthrough</code>用于强制执行下一个<code>case</code>的代码，即使下一个<code>case</code>的条件不满足。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-123-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-123-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-123-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-123-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-123-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-123-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-123-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-123-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-123-10">10</a></span>
<span class="normal"><a href="#__codelineno-123-11">11</a></span>
<span class="normal"><a href="#__codelineno-123-12">12</a></span>
<span class="normal"><a href="#__codelineno-123-13">13</a></span>
<span class="normal"><a href="#__codelineno-123-14">14</a></span>
<span class="normal"><a href="#__codelineno-123-15">15</a></span>
<span class="normal"><a href="#__codelineno-123-16">16</a></span>
<span class="normal"><a href="#__codelineno-123-17">17</a></span>
<span class="normal"><a href="#__codelineno-123-18">18</a></span>
<span class="normal"><a href="#__codelineno-123-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a>
<a id="__codelineno-123-3" name="__codelineno-123-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-123-4" name="__codelineno-123-4"></a>
<a id="__codelineno-123-5" name="__codelineno-123-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-6" name="__codelineno-123-6"></a><span class="w">    </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-123-7" name="__codelineno-123-7"></a>
<a id="__codelineno-123-8" name="__codelineno-123-8"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-9" name="__codelineno-123-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-123-10" name="__codelineno-123-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;一&quot;</span><span class="p">)</span>
<a id="__codelineno-123-11" name="__codelineno-123-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-123-12" name="__codelineno-123-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;二&quot;</span><span class="p">)</span>
<a id="__codelineno-123-13" name="__codelineno-123-13"></a><span class="w">        </span><span class="k">fallthrough</span>
<a id="__codelineno-123-14" name="__codelineno-123-14"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-123-15" name="__codelineno-123-15"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;三&quot;</span><span class="p">)</span>
<a id="__codelineno-123-16" name="__codelineno-123-16"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-123-17" name="__codelineno-123-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;其他数字&quot;</span><span class="p">)</span>
<a id="__codelineno-123-18" name="__codelineno-123-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-123-19" name="__codelineno-123-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>当<code>num</code>为2时，执行<code>case 2</code>中的代码。</li>
<li><code>fallthrough</code>强制执行<code>case 3</code>中的代码，即使<code>num</code>不等于3。</li>
</ul>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1">1</a></span>
<span class="normal"><a href="#__codelineno-124-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1"></a>二
<a id="__codelineno-124-2" name="__codelineno-124-2"></a>三
</code></pre></div></td></tr></table></div>
<h3 id="42-循环语句">4.2 循环语句<a class="headerlink" href="#42-循环语句" title="Permanent link">&para;</a></h3>
<p>循环语句用于重复执行一段代码，直到满足特定条件。在Go语言中，<code>for</code>是唯一的循环语句，但它可以用多种方式实现不同类型的循环。此外，<code>range</code>关键字用于遍历数组、切片、Map和字符串。</p>
<h4 id="for-循环"><code>for</code> 循环<a class="headerlink" href="#for-循环" title="Permanent link">&para;</a></h4>
<p><code>for</code>循环是Go语言中唯一的循环语句，可以实现传统的计数循环、条件循环和无限循环。</p>
<p><strong>1. 计数循环</strong></p>
<p>用于在已知循环次数的情况下重复执行代码。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1">1</a></span>
<span class="normal"><a href="#__codelineno-125-2">2</a></span>
<span class="normal"><a href="#__codelineno-125-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="k">for</span><span class="w"> </span><span class="nx">初始化语句</span><span class="p">;</span><span class="w"> </span><span class="nx">条件表达式</span><span class="p">;</span><span class="w"> </span><span class="nx">后置语句</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-2" name="__codelineno-125-2"></a><span class="w">    </span><span class="c1">// 循环体</span>
<a id="__codelineno-125-3" name="__codelineno-125-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1">1</a></span>
<span class="normal"><a href="#__codelineno-126-2">2</a></span>
<span class="normal"><a href="#__codelineno-126-3">3</a></span>
<span class="normal"><a href="#__codelineno-126-4">4</a></span>
<span class="normal"><a href="#__codelineno-126-5">5</a></span>
<span class="normal"><a href="#__codelineno-126-6">6</a></span>
<span class="normal"><a href="#__codelineno-126-7">7</a></span>
<span class="normal"><a href="#__codelineno-126-8">8</a></span>
<span class="normal"><a href="#__codelineno-126-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-126-2" name="__codelineno-126-2"></a>
<a id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-126-4" name="__codelineno-126-4"></a>
<a id="__codelineno-126-5" name="__codelineno-126-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-6" name="__codelineno-126-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-7" name="__codelineno-126-7"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计数循环，i =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-126-8" name="__codelineno-126-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-126-9" name="__codelineno-126-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1">1</a></span>
<span class="normal"><a href="#__codelineno-127-2">2</a></span>
<span class="normal"><a href="#__codelineno-127-3">3</a></span>
<span class="normal"><a href="#__codelineno-127-4">4</a></span>
<span class="normal"><a href="#__codelineno-127-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1"></a>计数循环，i = 0
<a id="__codelineno-127-2" name="__codelineno-127-2"></a>计数循环，i = 1
<a id="__codelineno-127-3" name="__codelineno-127-3"></a>计数循环，i = 2
<a id="__codelineno-127-4" name="__codelineno-127-4"></a>计数循环，i = 3
<a id="__codelineno-127-5" name="__codelineno-127-5"></a>计数循环，i = 4
</code></pre></div></td></tr></table></div>
<p><strong>2. 条件循环</strong></p>
<p>仅根据条件表达式来控制循环是否继续执行，类似于<code>while</code>循环。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-128-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-128-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-128-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-128-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-128-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-128-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-128-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-128-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-128-10">10</a></span>
<span class="normal"><a href="#__codelineno-128-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-128-2" name="__codelineno-128-2"></a>
<a id="__codelineno-128-3" name="__codelineno-128-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-128-4" name="__codelineno-128-4"></a>
<a id="__codelineno-128-5" name="__codelineno-128-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-128-6" name="__codelineno-128-6"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-128-7" name="__codelineno-128-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-128-8" name="__codelineno-128-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;条件循环，i =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-128-9" name="__codelineno-128-9"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-128-10" name="__codelineno-128-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-128-11" name="__codelineno-128-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1">1</a></span>
<span class="normal"><a href="#__codelineno-129-2">2</a></span>
<span class="normal"><a href="#__codelineno-129-3">3</a></span>
<span class="normal"><a href="#__codelineno-129-4">4</a></span>
<span class="normal"><a href="#__codelineno-129-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1"></a>条件循环，i = 0
<a id="__codelineno-129-2" name="__codelineno-129-2"></a>条件循环，i = 1
<a id="__codelineno-129-3" name="__codelineno-129-3"></a>条件循环，i = 2
<a id="__codelineno-129-4" name="__codelineno-129-4"></a>条件循环，i = 3
<a id="__codelineno-129-5" name="__codelineno-129-5"></a>条件循环，i = 4
</code></pre></div></td></tr></table></div>
<p><strong>3. 无限循环</strong></p>
<p>不设置条件表达式，使循环无限执行，直到使用<code>break</code>或其他跳转语句终止。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-130-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-130-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-130-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-130-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-130-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-130-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-130-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-130-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-130-10">10</a></span>
<span class="normal"><a href="#__codelineno-130-11">11</a></span>
<span class="normal"><a href="#__codelineno-130-12">12</a></span>
<span class="normal"><a href="#__codelineno-130-13">13</a></span>
<span class="normal"><a href="#__codelineno-130-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-130-2" name="__codelineno-130-2"></a>
<a id="__codelineno-130-3" name="__codelineno-130-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-130-4" name="__codelineno-130-4"></a>
<a id="__codelineno-130-5" name="__codelineno-130-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-6" name="__codelineno-130-6"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-130-7" name="__codelineno-130-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-8" name="__codelineno-130-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-9" name="__codelineno-130-9"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-130-10" name="__codelineno-130-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-130-11" name="__codelineno-130-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;无限循环，i =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-130-12" name="__codelineno-130-12"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-130-13" name="__codelineno-130-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-130-14" name="__codelineno-130-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1">1</a></span>
<span class="normal"><a href="#__codelineno-131-2">2</a></span>
<span class="normal"><a href="#__codelineno-131-3">3</a></span>
<span class="normal"><a href="#__codelineno-131-4">4</a></span>
<span class="normal"><a href="#__codelineno-131-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1"></a>无限循环，i = 0
<a id="__codelineno-131-2" name="__codelineno-131-2"></a>无限循环，i = 1
<a id="__codelineno-131-3" name="__codelineno-131-3"></a>无限循环，i = 2
<a id="__codelineno-131-4" name="__codelineno-131-4"></a>无限循环，i = 3
<a id="__codelineno-131-5" name="__codelineno-131-5"></a>无限循环，i = 4
</code></pre></div></td></tr></table></div>
<p><strong>嵌套<code>for</code>循环：</strong></p>
<p>可以在一个<code>for</code>循环内部嵌套另一个<code>for</code>循环，用于处理多维数据或复杂的迭代逻辑。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-132-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-132-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-132-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-132-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-132-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-132-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-132-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-132-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-132-10">10</a></span>
<span class="normal"><a href="#__codelineno-132-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-132-2" name="__codelineno-132-2"></a>
<a id="__codelineno-132-3" name="__codelineno-132-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-132-4" name="__codelineno-132-4"></a>
<a id="__codelineno-132-5" name="__codelineno-132-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-132-6" name="__codelineno-132-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-132-7" name="__codelineno-132-7"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-132-8" name="__codelineno-132-8"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;i=%d, j=%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="p">)</span>
<a id="__codelineno-132-9" name="__codelineno-132-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-132-10" name="__codelineno-132-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-132-11" name="__codelineno-132-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-133-1">1</a></span>
<span class="normal"><a href="#__codelineno-133-2">2</a></span>
<span class="normal"><a href="#__codelineno-133-3">3</a></span>
<span class="normal"><a href="#__codelineno-133-4">4</a></span>
<span class="normal"><a href="#__codelineno-133-5">5</a></span>
<span class="normal"><a href="#__codelineno-133-6">6</a></span>
<span class="normal"><a href="#__codelineno-133-7">7</a></span>
<span class="normal"><a href="#__codelineno-133-8">8</a></span>
<span class="normal"><a href="#__codelineno-133-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1"></a>i=1, j=1
<a id="__codelineno-133-2" name="__codelineno-133-2"></a>i=1, j=2
<a id="__codelineno-133-3" name="__codelineno-133-3"></a>i=1, j=3
<a id="__codelineno-133-4" name="__codelineno-133-4"></a>i=2, j=1
<a id="__codelineno-133-5" name="__codelineno-133-5"></a>i=2, j=2
<a id="__codelineno-133-6" name="__codelineno-133-6"></a>i=2, j=3
<a id="__codelineno-133-7" name="__codelineno-133-7"></a>i=3, j=1
<a id="__codelineno-133-8" name="__codelineno-133-8"></a>i=3, j=2
<a id="__codelineno-133-9" name="__codelineno-133-9"></a>i=3, j=3
</code></pre></div></td></tr></table></div>
<h4 id="range-遍历">Range 遍历<a class="headerlink" href="#range-遍历" title="Permanent link">&para;</a></h4>
<p><code>range</code>关键字用于遍历数组、切片、Map、字符串等数据结构，提供了一种简洁的方式来访问集合中的元素。</p>
<p><strong>1. 遍历数组和切片</strong></p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-134-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-134-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-134-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-134-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-134-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-134-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-134-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-134-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-134-10">10</a></span>
<span class="normal"><a href="#__codelineno-134-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-134-2" name="__codelineno-134-2"></a>
<a id="__codelineno-134-3" name="__codelineno-134-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-134-4" name="__codelineno-134-4"></a>
<a id="__codelineno-134-5" name="__codelineno-134-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-6" name="__codelineno-134-6"></a><span class="w">    </span><span class="nx">numbers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">}</span>
<a id="__codelineno-134-7" name="__codelineno-134-7"></a>
<a id="__codelineno-134-8" name="__codelineno-134-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">numbers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-9" name="__codelineno-134-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Index: %d, Value: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span>
<a id="__codelineno-134-10" name="__codelineno-134-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-134-11" name="__codelineno-134-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-135-1">1</a></span>
<span class="normal"><a href="#__codelineno-135-2">2</a></span>
<span class="normal"><a href="#__codelineno-135-3">3</a></span>
<span class="normal"><a href="#__codelineno-135-4">4</a></span>
<span class="normal"><a href="#__codelineno-135-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1"></a>Index: 0, Value: 10
<a id="__codelineno-135-2" name="__codelineno-135-2"></a>Index: 1, Value: 20
<a id="__codelineno-135-3" name="__codelineno-135-3"></a>Index: 2, Value: 30
<a id="__codelineno-135-4" name="__codelineno-135-4"></a>Index: 3, Value: 40
<a id="__codelineno-135-5" name="__codelineno-135-5"></a>Index: 4, Value: 50
</code></pre></div></td></tr></table></div>
<p><strong>只需要值，忽略索引：</strong></p>
<p>使用<code>_</code>来忽略索引。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-136-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-136-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-136-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-136-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-136-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-136-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-136-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-136-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-136-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-136-10">10</a></span>
<span class="normal"><a href="#__codelineno-136-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-136-2" name="__codelineno-136-2"></a>
<a id="__codelineno-136-3" name="__codelineno-136-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-136-4" name="__codelineno-136-4"></a>
<a id="__codelineno-136-5" name="__codelineno-136-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-136-6" name="__codelineno-136-6"></a><span class="w">    </span><span class="nx">fruits</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;苹果&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;香蕉&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;橙子&quot;</span><span class="p">}</span>
<a id="__codelineno-136-7" name="__codelineno-136-7"></a>
<a id="__codelineno-136-8" name="__codelineno-136-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">fruit</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">fruits</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-136-9" name="__codelineno-136-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;水果:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fruit</span><span class="p">)</span>
<a id="__codelineno-136-10" name="__codelineno-136-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-136-11" name="__codelineno-136-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-137-1">1</a></span>
<span class="normal"><a href="#__codelineno-137-2">2</a></span>
<span class="normal"><a href="#__codelineno-137-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1"></a>水果: 苹果
<a id="__codelineno-137-2" name="__codelineno-137-2"></a>水果: 香蕉
<a id="__codelineno-137-3" name="__codelineno-137-3"></a>水果: 橙子
</code></pre></div></td></tr></table></div>
<p><strong>2. 遍历Map</strong></p>
<p>遍历Map时，<code>range</code>返回键和值。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-138-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-138-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-138-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-138-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-138-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-138-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-138-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-138-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-138-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-138-10">10</a></span>
<span class="normal"><a href="#__codelineno-138-11">11</a></span>
<span class="normal"><a href="#__codelineno-138-12">12</a></span>
<span class="normal"><a href="#__codelineno-138-13">13</a></span>
<span class="normal"><a href="#__codelineno-138-14">14</a></span>
<span class="normal"><a href="#__codelineno-138-15">15</a></span>
<span class="normal"><a href="#__codelineno-138-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-138-2" name="__codelineno-138-2"></a>
<a id="__codelineno-138-3" name="__codelineno-138-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-138-4" name="__codelineno-138-4"></a>
<a id="__codelineno-138-5" name="__codelineno-138-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-138-6" name="__codelineno-138-6"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-138-7" name="__codelineno-138-7"></a><span class="w">        </span><span class="s">&quot;中国&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<a id="__codelineno-138-8" name="__codelineno-138-8"></a><span class="w">        </span><span class="s">&quot;美国&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;华盛顿&quot;</span><span class="p">,</span>
<a id="__codelineno-138-9" name="__codelineno-138-9"></a><span class="w">        </span><span class="s">&quot;日本&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;东京&quot;</span><span class="p">,</span>
<a id="__codelineno-138-10" name="__codelineno-138-10"></a><span class="w">        </span><span class="s">&quot;德国&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;柏林&quot;</span><span class="p">,</span>
<a id="__codelineno-138-11" name="__codelineno-138-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-138-12" name="__codelineno-138-12"></a>
<a id="__codelineno-138-13" name="__codelineno-138-13"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">country</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">capitals</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-138-14" name="__codelineno-138-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s 的首都是 %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">country</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="p">)</span>
<a id="__codelineno-138-15" name="__codelineno-138-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-138-16" name="__codelineno-138-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-139-1">1</a></span>
<span class="normal"><a href="#__codelineno-139-2">2</a></span>
<span class="normal"><a href="#__codelineno-139-3">3</a></span>
<span class="normal"><a href="#__codelineno-139-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1"></a>中国 的首都是 北京
<a id="__codelineno-139-2" name="__codelineno-139-2"></a>美国 的首都是 华盛顿
<a id="__codelineno-139-3" name="__codelineno-139-3"></a>日本 的首都是 东京
<a id="__codelineno-139-4" name="__codelineno-139-4"></a>德国 的首都是 柏林
</code></pre></div></td></tr></table></div>
<p><strong>3. 遍历字符串</strong></p>
<p>遍历字符串时，<code>range</code>按Unicode代码点进行遍历，返回索引和字符。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-140-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-140-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-140-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-140-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-140-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-140-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-140-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-140-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-140-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-140-10">10</a></span>
<span class="normal"><a href="#__codelineno-140-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-140-2" name="__codelineno-140-2"></a>
<a id="__codelineno-140-3" name="__codelineno-140-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-140-4" name="__codelineno-140-4"></a>
<a id="__codelineno-140-5" name="__codelineno-140-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-140-6" name="__codelineno-140-6"></a><span class="w">    </span><span class="nx">str</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Hello, 世界&quot;</span>
<a id="__codelineno-140-7" name="__codelineno-140-7"></a>
<a id="__codelineno-140-8" name="__codelineno-140-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">char</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">str</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-140-9" name="__codelineno-140-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;索引: %d, 字符: %c\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">char</span><span class="p">)</span>
<a id="__codelineno-140-10" name="__codelineno-140-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-140-11" name="__codelineno-140-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-141-1">1</a></span>
<span class="normal"><a href="#__codelineno-141-2">2</a></span>
<span class="normal"><a href="#__codelineno-141-3">3</a></span>
<span class="normal"><a href="#__codelineno-141-4">4</a></span>
<span class="normal"><a href="#__codelineno-141-5">5</a></span>
<span class="normal"><a href="#__codelineno-141-6">6</a></span>
<span class="normal"><a href="#__codelineno-141-7">7</a></span>
<span class="normal"><a href="#__codelineno-141-8">8</a></span>
<span class="normal"><a href="#__codelineno-141-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1"></a>索引: 0, 字符: H
<a id="__codelineno-141-2" name="__codelineno-141-2"></a>索引: 1, 字符: e
<a id="__codelineno-141-3" name="__codelineno-141-3"></a>索引: 2, 字符: l
<a id="__codelineno-141-4" name="__codelineno-141-4"></a>索引: 3, 字符: l
<a id="__codelineno-141-5" name="__codelineno-141-5"></a>索引: 4, 字符: o
<a id="__codelineno-141-6" name="__codelineno-141-6"></a>索引: 5, 字符: ,
<a id="__codelineno-141-7" name="__codelineno-141-7"></a>索引: 6, 字符:  
<a id="__codelineno-141-8" name="__codelineno-141-8"></a>索引: 7, 字符: 世
<a id="__codelineno-141-9" name="__codelineno-141-9"></a>索引: 10, 字符: 界
</code></pre></div></td></tr></table></div>
<p><strong>注意事项：</strong></p>
<ul>
<li>字符串中的多字节字符（如中文）在<code>range</code>遍历时，索引表示字符的起始字节位置，而非字符数。</li>
</ul>
<p><strong>4. Range遍历的高级用法</strong></p>
<p><strong>示例：修改切片中的元素</strong></p>
<p>需要注意的是，使用<code>range</code>遍历切片时，返回的是元素的副本，直接修改不会影响原切片。如果需要修改原切片，应使用索引。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-142-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-142-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-142-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-142-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-142-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-142-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-142-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-142-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-142-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-142-10">10</a></span>
<span class="normal"><a href="#__codelineno-142-11">11</a></span>
<span class="normal"><a href="#__codelineno-142-12">12</a></span>
<span class="normal"><a href="#__codelineno-142-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-142-2" name="__codelineno-142-2"></a>
<a id="__codelineno-142-3" name="__codelineno-142-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-142-4" name="__codelineno-142-4"></a>
<a id="__codelineno-142-5" name="__codelineno-142-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-6" name="__codelineno-142-6"></a><span class="w">    </span><span class="nx">numbers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-142-7" name="__codelineno-142-7"></a>
<a id="__codelineno-142-8" name="__codelineno-142-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">numbers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-9" name="__codelineno-142-9"></a><span class="w">        </span><span class="nx">numbers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-142-10" name="__codelineno-142-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-11" name="__codelineno-142-11"></a>
<a id="__codelineno-142-12" name="__codelineno-142-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">numbers</span><span class="p">)</span>
<a id="__codelineno-142-13" name="__codelineno-142-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-143-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1"></a>修改后的切片: [2 4 6 8 10]
</code></pre></div></td></tr></table></div>
<h3 id="43-跳转语句">4.3 跳转语句<a class="headerlink" href="#43-跳转语句" title="Permanent link">&para;</a></h3>
<p>跳转语句用于在循环或条件语句中控制程序的执行流程。Go语言中常用的跳转语句包括<code>break</code>、<code>continue</code>和<code>goto</code>。</p>
<h4 id="break"><code>break</code><a class="headerlink" href="#break" title="Permanent link">&para;</a></h4>
<p><code>break</code>语句用于终止最近的<code>for</code>、<code>switch</code>或<code>select</code>语句。</p>
<p><strong>示例：提前退出循环</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-144-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-144-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-144-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-144-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-144-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-144-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-144-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-144-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-144-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-144-10">10</a></span>
<span class="normal"><a href="#__codelineno-144-11">11</a></span>
<span class="normal"><a href="#__codelineno-144-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-144-2" name="__codelineno-144-2"></a>
<a id="__codelineno-144-3" name="__codelineno-144-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-144-4" name="__codelineno-144-4"></a>
<a id="__codelineno-144-5" name="__codelineno-144-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-144-6" name="__codelineno-144-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-144-7" name="__codelineno-144-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-144-8" name="__codelineno-144-8"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-144-9" name="__codelineno-144-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-144-10" name="__codelineno-144-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;i =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-144-11" name="__codelineno-144-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-144-12" name="__codelineno-144-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-145-1">1</a></span>
<span class="normal"><a href="#__codelineno-145-2">2</a></span>
<span class="normal"><a href="#__codelineno-145-3">3</a></span>
<span class="normal"><a href="#__codelineno-145-4">4</a></span>
<span class="normal"><a href="#__codelineno-145-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1"></a>i = 1
<a id="__codelineno-145-2" name="__codelineno-145-2"></a>i = 2
<a id="__codelineno-145-3" name="__codelineno-145-3"></a>i = 3
<a id="__codelineno-145-4" name="__codelineno-145-4"></a>i = 4
<a id="__codelineno-145-5" name="__codelineno-145-5"></a>i = 5
</code></pre></div></td></tr></table></div>
<p><strong>在<code>switch</code>语句中使用<code>break</code></strong></p>
<p>虽然<code>switch</code>语句默认不会自动贯穿到下一个<code>case</code>，但可以显式使用<code>break</code>来提前退出<code>switch</code>。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-146-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-146-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-146-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-146-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-146-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-146-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-146-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-146-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-146-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-146-10">10</a></span>
<span class="normal"><a href="#__codelineno-146-11">11</a></span>
<span class="normal"><a href="#__codelineno-146-12">12</a></span>
<span class="normal"><a href="#__codelineno-146-13">13</a></span>
<span class="normal"><a href="#__codelineno-146-14">14</a></span>
<span class="normal"><a href="#__codelineno-146-15">15</a></span>
<span class="normal"><a href="#__codelineno-146-16">16</a></span>
<span class="normal"><a href="#__codelineno-146-17">17</a></span>
<span class="normal"><a href="#__codelineno-146-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-146-2" name="__codelineno-146-2"></a>
<a id="__codelineno-146-3" name="__codelineno-146-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-146-4" name="__codelineno-146-4"></a>
<a id="__codelineno-146-5" name="__codelineno-146-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-146-6" name="__codelineno-146-6"></a><span class="w">    </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-146-7" name="__codelineno-146-7"></a>
<a id="__codelineno-146-8" name="__codelineno-146-8"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-146-9" name="__codelineno-146-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-146-10" name="__codelineno-146-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;一&quot;</span><span class="p">)</span>
<a id="__codelineno-146-11" name="__codelineno-146-11"></a><span class="w">        </span><span class="k">break</span>
<a id="__codelineno-146-12" name="__codelineno-146-12"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-146-13" name="__codelineno-146-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;二&quot;</span><span class="p">)</span>
<a id="__codelineno-146-14" name="__codelineno-146-14"></a><span class="w">        </span><span class="k">break</span>
<a id="__codelineno-146-15" name="__codelineno-146-15"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-146-16" name="__codelineno-146-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;其他数字&quot;</span><span class="p">)</span>
<a id="__codelineno-146-17" name="__codelineno-146-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-146-18" name="__codelineno-146-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-147-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1"></a>二
</code></pre></div></td></tr></table></div>
<h4 id="continue"><code>continue</code><a class="headerlink" href="#continue" title="Permanent link">&para;</a></h4>
<p><code>continue</code>语句用于跳过当前循环的剩余部分，立即开始下一次循环迭代。</p>
<p><strong>示例：跳过偶数</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-148-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-148-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-148-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-148-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-148-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-148-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-148-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-148-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-148-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-148-10">10</a></span>
<span class="normal"><a href="#__codelineno-148-11">11</a></span>
<span class="normal"><a href="#__codelineno-148-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-148-2" name="__codelineno-148-2"></a>
<a id="__codelineno-148-3" name="__codelineno-148-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-148-4" name="__codelineno-148-4"></a>
<a id="__codelineno-148-5" name="__codelineno-148-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-148-6" name="__codelineno-148-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-148-7" name="__codelineno-148-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-148-8" name="__codelineno-148-8"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-148-9" name="__codelineno-148-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-148-10" name="__codelineno-148-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;奇数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-148-11" name="__codelineno-148-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-148-12" name="__codelineno-148-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-149-1">1</a></span>
<span class="normal"><a href="#__codelineno-149-2">2</a></span>
<span class="normal"><a href="#__codelineno-149-3">3</a></span>
<span class="normal"><a href="#__codelineno-149-4">4</a></span>
<span class="normal"><a href="#__codelineno-149-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1"></a>奇数: 1
<a id="__codelineno-149-2" name="__codelineno-149-2"></a>奇数: 3
<a id="__codelineno-149-3" name="__codelineno-149-3"></a>奇数: 5
<a id="__codelineno-149-4" name="__codelineno-149-4"></a>奇数: 7
<a id="__codelineno-149-5" name="__codelineno-149-5"></a>奇数: 9
</code></pre></div></td></tr></table></div>
<p><strong>在嵌套循环中使用<code>continue</code></strong></p>
<p><code>continue</code>只会影响最近的一层循环。如果需要影响外层循环，可以使用标签（Label）。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-150-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-150-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-150-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-150-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-150-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-150-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-150-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-150-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-150-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-150-10">10</a></span>
<span class="normal"><a href="#__codelineno-150-11">11</a></span>
<span class="normal"><a href="#__codelineno-150-12">12</a></span>
<span class="normal"><a href="#__codelineno-150-13">13</a></span>
<span class="normal"><a href="#__codelineno-150-14">14</a></span>
<span class="normal"><a href="#__codelineno-150-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-150-2" name="__codelineno-150-2"></a>
<a id="__codelineno-150-3" name="__codelineno-150-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-150-4" name="__codelineno-150-4"></a>
<a id="__codelineno-150-5" name="__codelineno-150-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-150-6" name="__codelineno-150-6"></a><span class="nx">OuterLoop</span><span class="p">:</span>
<a id="__codelineno-150-7" name="__codelineno-150-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-150-8" name="__codelineno-150-8"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-150-9" name="__codelineno-150-9"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-150-10" name="__codelineno-150-10"></a><span class="w">                </span><span class="k">continue</span><span class="w"> </span><span class="nx">OuterLoop</span>
<a id="__codelineno-150-11" name="__codelineno-150-11"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-150-12" name="__codelineno-150-12"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;i=%d, j=%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="p">)</span>
<a id="__codelineno-150-13" name="__codelineno-150-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-150-14" name="__codelineno-150-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-150-15" name="__codelineno-150-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-151-1">1</a></span>
<span class="normal"><a href="#__codelineno-151-2">2</a></span>
<span class="normal"><a href="#__codelineno-151-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1"></a>i=1, j=1
<a id="__codelineno-151-2" name="__codelineno-151-2"></a>i=2, j=1
<a id="__codelineno-151-3" name="__codelineno-151-3"></a>i=3, j=1
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>当<code>j</code>等于2时，<code>continue OuterLoop</code>跳过当前的外层循环迭代，开始下一次<code>i</code>的循环。</li>
</ul>
<h4 id="goto"><code>goto</code><a class="headerlink" href="#goto" title="Permanent link">&para;</a></h4>
<p><code>goto</code>语句用于无条件地跳转到程序中指定的标签位置。虽然<code>goto</code>可以实现复杂的跳转逻辑，但过度使用会导致代码难以理解和维护，因此应谨慎使用。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-152-1">1</a></span>
<span class="normal"><a href="#__codelineno-152-2">2</a></span>
<span class="normal"><a href="#__codelineno-152-3">3</a></span>
<span class="normal"><a href="#__codelineno-152-4">4</a></span>
<span class="normal"><a href="#__codelineno-152-5">5</a></span>
<span class="normal"><a href="#__codelineno-152-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1"></a><span class="k">goto</span><span class="w"> </span><span class="nx">标签名</span>
<a id="__codelineno-152-2" name="__codelineno-152-2"></a>
<a id="__codelineno-152-3" name="__codelineno-152-3"></a><span class="o">...</span>
<a id="__codelineno-152-4" name="__codelineno-152-4"></a>
<a id="__codelineno-152-5" name="__codelineno-152-5"></a><span class="nx">标签名</span><span class="p">:</span>
<a id="__codelineno-152-6" name="__codelineno-152-6"></a><span class="w">    </span><span class="c1">// 跳转到此处执行的代码</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-153-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-153-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-153-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-153-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-153-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-153-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-153-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-153-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-153-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-153-10">10</a></span>
<span class="normal"><a href="#__codelineno-153-11">11</a></span>
<span class="normal"><a href="#__codelineno-153-12">12</a></span>
<span class="normal"><a href="#__codelineno-153-13">13</a></span>
<span class="normal"><a href="#__codelineno-153-14">14</a></span>
<span class="normal"><a href="#__codelineno-153-15">15</a></span>
<span class="normal"><a href="#__codelineno-153-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-153-2" name="__codelineno-153-2"></a>
<a id="__codelineno-153-3" name="__codelineno-153-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-153-4" name="__codelineno-153-4"></a>
<a id="__codelineno-153-5" name="__codelineno-153-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-153-6" name="__codelineno-153-6"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-153-7" name="__codelineno-153-7"></a>
<a id="__codelineno-153-8" name="__codelineno-153-8"></a><span class="nx">Loop</span><span class="p">:</span>
<a id="__codelineno-153-9" name="__codelineno-153-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-153-10" name="__codelineno-153-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;i =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-153-11" name="__codelineno-153-11"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-153-12" name="__codelineno-153-12"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="nx">Loop</span>
<a id="__codelineno-153-13" name="__codelineno-153-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-153-14" name="__codelineno-153-14"></a>
<a id="__codelineno-153-15" name="__codelineno-153-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;循环结束&quot;</span><span class="p">)</span>
<a id="__codelineno-153-16" name="__codelineno-153-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-154-1">1</a></span>
<span class="normal"><a href="#__codelineno-154-2">2</a></span>
<span class="normal"><a href="#__codelineno-154-3">3</a></span>
<span class="normal"><a href="#__codelineno-154-4">4</a></span>
<span class="normal"><a href="#__codelineno-154-5">5</a></span>
<span class="normal"><a href="#__codelineno-154-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1"></a>i = 0
<a id="__codelineno-154-2" name="__codelineno-154-2"></a>i = 1
<a id="__codelineno-154-3" name="__codelineno-154-3"></a>i = 2
<a id="__codelineno-154-4" name="__codelineno-154-4"></a>i = 3
<a id="__codelineno-154-5" name="__codelineno-154-5"></a>i = 4
<a id="__codelineno-154-6" name="__codelineno-154-6"></a>循环结束
</code></pre></div></td></tr></table></div>
<p><strong>注意事项：</strong></p>
<ul>
<li>标签名必须以字母开头，可以包含字母、数字和下划线。</li>
<li>标签作用域在整个函数内，可以跨越条件语句和循环语句。</li>
</ul>
<p><strong>示例：跳出多层循环</strong></p>
<p>使用标签可以方便地跳出嵌套循环。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-155-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-155-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-155-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-155-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-155-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-155-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-155-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-155-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-155-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-155-10">10</a></span>
<span class="normal"><a href="#__codelineno-155-11">11</a></span>
<span class="normal"><a href="#__codelineno-155-12">12</a></span>
<span class="normal"><a href="#__codelineno-155-13">13</a></span>
<span class="normal"><a href="#__codelineno-155-14">14</a></span>
<span class="normal"><a href="#__codelineno-155-15">15</a></span>
<span class="normal"><a href="#__codelineno-155-16">16</a></span>
<span class="normal"><a href="#__codelineno-155-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-155-2" name="__codelineno-155-2"></a>
<a id="__codelineno-155-3" name="__codelineno-155-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-155-4" name="__codelineno-155-4"></a>
<a id="__codelineno-155-5" name="__codelineno-155-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-6" name="__codelineno-155-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-7" name="__codelineno-155-7"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-8" name="__codelineno-155-8"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-9" name="__codelineno-155-9"></a><span class="w">                </span><span class="k">goto</span><span class="w"> </span><span class="nx">EndLoop</span>
<a id="__codelineno-155-10" name="__codelineno-155-10"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-155-11" name="__codelineno-155-11"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;i=%d, j=%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="p">)</span>
<a id="__codelineno-155-12" name="__codelineno-155-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-155-13" name="__codelineno-155-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-155-14" name="__codelineno-155-14"></a>
<a id="__codelineno-155-15" name="__codelineno-155-15"></a><span class="nx">EndLoop</span><span class="p">:</span>
<a id="__codelineno-155-16" name="__codelineno-155-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;跳出循环&quot;</span><span class="p">)</span>
<a id="__codelineno-155-17" name="__codelineno-155-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-156-1">1</a></span>
<span class="normal"><a href="#__codelineno-156-2">2</a></span>
<span class="normal"><a href="#__codelineno-156-3">3</a></span>
<span class="normal"><a href="#__codelineno-156-4">4</a></span>
<span class="normal"><a href="#__codelineno-156-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1"></a>i=1, j=1
<a id="__codelineno-156-2" name="__codelineno-156-2"></a>i=1, j=2
<a id="__codelineno-156-3" name="__codelineno-156-3"></a>i=1, j=3
<a id="__codelineno-156-4" name="__codelineno-156-4"></a>i=2, j=1
<a id="__codelineno-156-5" name="__codelineno-156-5"></a>跳出循环
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>当<code>i</code>等于2且<code>j</code>等于2时，执行<code>goto EndLoop</code>，跳出所有循环，执行标签<code>EndLoop</code>后的代码。</li>
</ul>
<p><strong>使用<code>goto</code>实现错误处理</strong></p>
<p>在某些情况下，<code>goto</code>可以用于简化错误处理，尤其是在资源清理和多重退出点的场景中。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-157-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-157-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-157-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-157-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-157-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-157-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-157-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-157-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-157-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-157-10">10</a></span>
<span class="normal"><a href="#__codelineno-157-11">11</a></span>
<span class="normal"><a href="#__codelineno-157-12">12</a></span>
<span class="normal"><a href="#__codelineno-157-13">13</a></span>
<span class="normal"><a href="#__codelineno-157-14">14</a></span>
<span class="normal"><a href="#__codelineno-157-15">15</a></span>
<span class="normal"><a href="#__codelineno-157-16">16</a></span>
<span class="normal"><a href="#__codelineno-157-17">17</a></span>
<span class="normal"><a href="#__codelineno-157-18">18</a></span>
<span class="normal"><a href="#__codelineno-157-19">19</a></span>
<span class="normal"><a href="#__codelineno-157-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-157-2" name="__codelineno-157-2"></a>
<a id="__codelineno-157-3" name="__codelineno-157-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-157-4" name="__codelineno-157-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-157-5" name="__codelineno-157-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-157-6" name="__codelineno-157-6"></a><span class="p">)</span>
<a id="__codelineno-157-7" name="__codelineno-157-7"></a>
<a id="__codelineno-157-8" name="__codelineno-157-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-157-9" name="__codelineno-157-9"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;nonexistent.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-157-10" name="__codelineno-157-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-157-11" name="__codelineno-157-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误：无法打开文件&quot;</span><span class="p">)</span>
<a id="__codelineno-157-12" name="__codelineno-157-12"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="nx">Cleanup</span>
<a id="__codelineno-157-13" name="__codelineno-157-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-157-14" name="__codelineno-157-14"></a>
<a id="__codelineno-157-15" name="__codelineno-157-15"></a><span class="w">    </span><span class="c1">// 执行文件操作</span>
<a id="__codelineno-157-16" name="__codelineno-157-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件打开成功&quot;</span><span class="p">)</span>
<a id="__codelineno-157-17" name="__codelineno-157-17"></a>
<a id="__codelineno-157-18" name="__codelineno-157-18"></a><span class="nx">Cleanup</span><span class="p">:</span>
<a id="__codelineno-157-19" name="__codelineno-157-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;执行清理操作&quot;</span><span class="p">)</span>
<a id="__codelineno-157-20" name="__codelineno-157-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-158-1">1</a></span>
<span class="normal"><a href="#__codelineno-158-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1"></a>错误：无法打开文件
<a id="__codelineno-158-2" name="__codelineno-158-2"></a>执行清理操作
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>如果打开文件失败，使用<code>goto Cleanup</code>跳转到清理代码块，确保资源正确释放或其他必要的清理操作。</li>
</ul>
<h2 id="5-函数">5. 函数<a class="headerlink" href="#5-函数" title="Permanent link">&para;</a></h2>
<p>函数是编程中的基本构建块，用于封装可重用的代码逻辑。Go语言中的函数功能强大，支持多种特性，如多返回值、可变参数、匿名函数、闭包以及将函数作为值和类型传递。理解和掌握函数的使用对于编写高效、可维护的Go程序至关重要。本章将详细介绍Go语言中的函数，包括函数的定义与调用、参数和返回值、可变参数函数、匿名函数与闭包，以及函数作为值和类型的应用。</p>
<h3 id="51-函数定义与调用">5.1 函数定义与调用<a class="headerlink" href="#51-函数定义与调用" title="Permanent link">&para;</a></h3>
<h4 id="函数的基本定义">函数的基本定义<a class="headerlink" href="#函数的基本定义" title="Permanent link">&para;</a></h4>
<p>在Go语言中，函数使用<code>func</code>关键字定义。函数可以包含参数和返回值，也可以没有。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-159-1">1</a></span>
<span class="normal"><a href="#__codelineno-159-2">2</a></span>
<span class="normal"><a href="#__codelineno-159-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">函数名</span><span class="p">(</span><span class="nx">参数列表</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">返回值列表</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-159-2" name="__codelineno-159-2"></a><span class="w">    </span><span class="c1">// 函数体</span>
<a id="__codelineno-159-3" name="__codelineno-159-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>func</code>: 函数定义的关键字。</li>
<li><code>函数名</code>: 函数的名称，遵循标识符命名规则。</li>
<li><code>参数列表</code>: 函数接受的参数，可以有多个，每个参数需要指定类型。</li>
<li><code>返回值列表</code>: 函数返回的值，可以有多个，需指定类型。</li>
<li><code>函数体</code>: 包含函数执行的代码。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-160-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-160-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-160-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-160-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-160-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-160-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-160-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-160-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-160-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-160-10">10</a></span>
<span class="normal"><a href="#__codelineno-160-11">11</a></span>
<span class="normal"><a href="#__codelineno-160-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-160-2" name="__codelineno-160-2"></a>
<a id="__codelineno-160-3" name="__codelineno-160-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-160-4" name="__codelineno-160-4"></a>
<a id="__codelineno-160-5" name="__codelineno-160-5"></a><span class="c1">// 定义一个简单的函数，不接受参数，也不返回值</span>
<a id="__codelineno-160-6" name="__codelineno-160-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sayHello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-160-7" name="__codelineno-160-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, Go!&quot;</span><span class="p">)</span>
<a id="__codelineno-160-8" name="__codelineno-160-8"></a><span class="p">}</span>
<a id="__codelineno-160-9" name="__codelineno-160-9"></a>
<a id="__codelineno-160-10" name="__codelineno-160-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-160-11" name="__codelineno-160-11"></a><span class="w">    </span><span class="nx">sayHello</span><span class="p">()</span><span class="w"> </span><span class="c1">// 调用函数</span>
<a id="__codelineno-160-12" name="__codelineno-160-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-161-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1"></a>Hello, Go!
</code></pre></div></td></tr></table></div>
<h4 id="带参数的函数">带参数的函数<a class="headerlink" href="#带参数的函数" title="Permanent link">&para;</a></h4>
<p>函数可以接受多个参数，每个参数需要指定类型。参数之间用逗号分隔。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-162-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-162-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-162-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-162-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-162-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-162-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-162-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-162-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-162-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-162-10">10</a></span>
<span class="normal"><a href="#__codelineno-162-11">11</a></span>
<span class="normal"><a href="#__codelineno-162-12">12</a></span>
<span class="normal"><a href="#__codelineno-162-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-162-2" name="__codelineno-162-2"></a>
<a id="__codelineno-162-3" name="__codelineno-162-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-162-4" name="__codelineno-162-4"></a>
<a id="__codelineno-162-5" name="__codelineno-162-5"></a><span class="c1">// 定义一个函数，接受两个整数参数并打印它们的和</span>
<a id="__codelineno-162-6" name="__codelineno-162-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-162-7" name="__codelineno-162-7"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-162-8" name="__codelineno-162-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Sum:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sum</span><span class="p">)</span>
<a id="__codelineno-162-9" name="__codelineno-162-9"></a><span class="p">}</span>
<a id="__codelineno-162-10" name="__codelineno-162-10"></a>
<a id="__codelineno-162-11" name="__codelineno-162-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-162-12" name="__codelineno-162-12"></a><span class="w">    </span><span class="nx">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 调用函数，传递参数5和3</span>
<a id="__codelineno-162-13" name="__codelineno-162-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-163-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1"></a>Sum: 8
</code></pre></div></td></tr></table></div>
<p><strong>参数类型简写：</strong></p>
<p>当连续的参数具有相同的类型时，可以简化参数类型的声明。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-164-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-164-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-164-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-164-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-164-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-164-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-164-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-164-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-164-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-164-10">10</a></span>
<span class="normal"><a href="#__codelineno-164-11">11</a></span>
<span class="normal"><a href="#__codelineno-164-12">12</a></span>
<span class="normal"><a href="#__codelineno-164-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-164-2" name="__codelineno-164-2"></a>
<a id="__codelineno-164-3" name="__codelineno-164-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-164-4" name="__codelineno-164-4"></a>
<a id="__codelineno-164-5" name="__codelineno-164-5"></a><span class="c1">// 简化参数类型声明</span>
<a id="__codelineno-164-6" name="__codelineno-164-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">multiply</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-164-7" name="__codelineno-164-7"></a><span class="w">    </span><span class="nx">product</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-164-8" name="__codelineno-164-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Product:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">product</span><span class="p">)</span>
<a id="__codelineno-164-9" name="__codelineno-164-9"></a><span class="p">}</span>
<a id="__codelineno-164-10" name="__codelineno-164-10"></a>
<a id="__codelineno-164-11" name="__codelineno-164-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-164-12" name="__codelineno-164-12"></a><span class="w">    </span><span class="nx">multiply</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="c1">// 调用函数，传递参数4和6</span>
<a id="__codelineno-164-13" name="__codelineno-164-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-165-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-165-1" name="__codelineno-165-1"></a>Product: 24
</code></pre></div></td></tr></table></div>
<h4 id="带返回值的函数">带返回值的函数<a class="headerlink" href="#带返回值的函数" title="Permanent link">&para;</a></h4>
<p>函数可以返回一个或多个值。返回值需要在函数定义中指定。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-166-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-166-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-166-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-166-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-166-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-166-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-166-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-166-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-166-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-166-10">10</a></span>
<span class="normal"><a href="#__codelineno-166-11">11</a></span>
<span class="normal"><a href="#__codelineno-166-12">12</a></span>
<span class="normal"><a href="#__codelineno-166-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-166-1" name="__codelineno-166-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-166-2" name="__codelineno-166-2"></a>
<a id="__codelineno-166-3" name="__codelineno-166-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-166-4" name="__codelineno-166-4"></a>
<a id="__codelineno-166-5" name="__codelineno-166-5"></a><span class="c1">// 定义一个函数，接受两个整数参数并返回它们的和</span>
<a id="__codelineno-166-6" name="__codelineno-166-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-166-7" name="__codelineno-166-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-166-8" name="__codelineno-166-8"></a><span class="p">}</span>
<a id="__codelineno-166-9" name="__codelineno-166-9"></a>
<a id="__codelineno-166-10" name="__codelineno-166-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-166-11" name="__codelineno-166-11"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="c1">// 调用函数，并接收返回值</span>
<a id="__codelineno-166-12" name="__codelineno-166-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Sum:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sum</span><span class="p">)</span>
<a id="__codelineno-166-13" name="__codelineno-166-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-167-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-167-1" name="__codelineno-167-1"></a>Sum: 25
</code></pre></div></td></tr></table></div>
<h4 id="多返回值函数">多返回值函数<a class="headerlink" href="#多返回值函数" title="Permanent link">&para;</a></h4>
<p>Go语言支持函数返回多个值，这在错误处理和复杂数据返回时非常有用。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-168-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-168-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-168-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-168-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-168-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-168-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-168-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-168-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-168-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-168-10">10</a></span>
<span class="normal"><a href="#__codelineno-168-11">11</a></span>
<span class="normal"><a href="#__codelineno-168-12">12</a></span>
<span class="normal"><a href="#__codelineno-168-13">13</a></span>
<span class="normal"><a href="#__codelineno-168-14">14</a></span>
<span class="normal"><a href="#__codelineno-168-15">15</a></span>
<span class="normal"><a href="#__codelineno-168-16">16</a></span>
<span class="normal"><a href="#__codelineno-168-17">17</a></span>
<span class="normal"><a href="#__codelineno-168-18">18</a></span>
<span class="normal"><a href="#__codelineno-168-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-168-1" name="__codelineno-168-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-168-2" name="__codelineno-168-2"></a>
<a id="__codelineno-168-3" name="__codelineno-168-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-168-4" name="__codelineno-168-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-168-5" name="__codelineno-168-5"></a><span class="w">    </span><span class="s">&quot;math&quot;</span>
<a id="__codelineno-168-6" name="__codelineno-168-6"></a><span class="p">)</span>
<a id="__codelineno-168-7" name="__codelineno-168-7"></a>
<a id="__codelineno-168-8" name="__codelineno-168-8"></a><span class="c1">// 定义一个函数，返回两个值：平方根和平方</span>
<a id="__codelineno-168-9" name="__codelineno-168-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">calculate</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-168-10" name="__codelineno-168-10"></a><span class="w">    </span><span class="nx">sqrt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Sqrt</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-168-11" name="__codelineno-168-11"></a><span class="w">    </span><span class="nx">square</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">x</span>
<a id="__codelineno-168-12" name="__codelineno-168-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sqrt</span><span class="p">,</span><span class="w"> </span><span class="nx">square</span>
<a id="__codelineno-168-13" name="__codelineno-168-13"></a><span class="p">}</span>
<a id="__codelineno-168-14" name="__codelineno-168-14"></a>
<a id="__codelineno-168-15" name="__codelineno-168-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-168-16" name="__codelineno-168-16"></a><span class="w">    </span><span class="nx">number</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">16.0</span>
<a id="__codelineno-168-17" name="__codelineno-168-17"></a><span class="w">    </span><span class="nx">sqrt</span><span class="p">,</span><span class="w"> </span><span class="nx">square</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">calculate</span><span class="p">(</span><span class="nx">number</span><span class="p">)</span><span class="w"> </span><span class="c1">// 接收多个返回值</span>
<a id="__codelineno-168-18" name="__codelineno-168-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Number: %.2f, Square Root: %.2f, Square: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">number</span><span class="p">,</span><span class="w"> </span><span class="nx">sqrt</span><span class="p">,</span><span class="w"> </span><span class="nx">square</span><span class="p">)</span>
<a id="__codelineno-168-19" name="__codelineno-168-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-169-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-169-1" name="__codelineno-169-1"></a>Number: 16.00, Square Root: 4.00, Square: 256.00
</code></pre></div></td></tr></table></div>
<h4 id="命名返回值">命名返回值<a class="headerlink" href="#命名返回值" title="Permanent link">&para;</a></h4>
<p>函数的返回值可以命名，这样在函数体内可以直接使用这些名字，并且可以使用<code>return</code>语句直接返回。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-170-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-170-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-170-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-170-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-170-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-170-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-170-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-170-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-170-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-170-10">10</a></span>
<span class="normal"><a href="#__codelineno-170-11">11</a></span>
<span class="normal"><a href="#__codelineno-170-12">12</a></span>
<span class="normal"><a href="#__codelineno-170-13">13</a></span>
<span class="normal"><a href="#__codelineno-170-14">14</a></span>
<span class="normal"><a href="#__codelineno-170-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-170-1" name="__codelineno-170-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-170-2" name="__codelineno-170-2"></a>
<a id="__codelineno-170-3" name="__codelineno-170-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-170-4" name="__codelineno-170-4"></a>
<a id="__codelineno-170-5" name="__codelineno-170-5"></a><span class="c1">// 定义一个函数，返回两个命名的返回值</span>
<a id="__codelineno-170-6" name="__codelineno-170-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">divide</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">quotient</span><span class="w"> </span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="nx">remainder</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-170-7" name="__codelineno-170-7"></a><span class="w">    </span><span class="nx">quotient</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-170-8" name="__codelineno-170-8"></a><span class="w">    </span><span class="nx">remainder</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Mod</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-170-9" name="__codelineno-170-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="c1">// 自动返回命名的返回值</span>
<a id="__codelineno-170-10" name="__codelineno-170-10"></a><span class="p">}</span>
<a id="__codelineno-170-11" name="__codelineno-170-11"></a>
<a id="__codelineno-170-12" name="__codelineno-170-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-170-13" name="__codelineno-170-13"></a><span class="w">    </span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">divide</span><span class="p">(</span><span class="mf">10.5</span><span class="p">,</span><span class="w"> </span><span class="mf">3.2</span><span class="p">)</span>
<a id="__codelineno-170-14" name="__codelineno-170-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Quotient: %.2f, Remainder: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-170-15" name="__codelineno-170-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-171-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-171-1" name="__codelineno-171-1"></a>Quotient: 3.28, Remainder: 0.90
</code></pre></div></td></tr></table></div>
<h3 id="52-函数参数和返回值">5.2 函数参数和返回值<a class="headerlink" href="#52-函数参数和返回值" title="Permanent link">&para;</a></h3>
<p>函数参数和返回值是函数与外界交互的主要方式。Go语言在参数传递和返回值处理上有其独特的特性。</p>
<h4 id="参数传递方式">参数传递方式<a class="headerlink" href="#参数传递方式" title="Permanent link">&para;</a></h4>
<p>Go语言中的参数传递是按值传递，这意味着函数接收到的是参数的副本，对副本的修改不会影响原始变量。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-172-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-172-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-172-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-172-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-172-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-172-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-172-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-172-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-172-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-172-10">10</a></span>
<span class="normal"><a href="#__codelineno-172-11">11</a></span>
<span class="normal"><a href="#__codelineno-172-12">12</a></span>
<span class="normal"><a href="#__codelineno-172-13">13</a></span>
<span class="normal"><a href="#__codelineno-172-14">14</a></span>
<span class="normal"><a href="#__codelineno-172-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-172-1" name="__codelineno-172-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-172-2" name="__codelineno-172-2"></a>
<a id="__codelineno-172-3" name="__codelineno-172-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-172-4" name="__codelineno-172-4"></a>
<a id="__codelineno-172-5" name="__codelineno-172-5"></a><span class="c1">// 定义一个函数，尝试修改参数的值</span>
<a id="__codelineno-172-6" name="__codelineno-172-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">modifyValue</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-172-7" name="__codelineno-172-7"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span>
<a id="__codelineno-172-8" name="__codelineno-172-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Inside modifyValue:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-172-9" name="__codelineno-172-9"></a><span class="p">}</span>
<a id="__codelineno-172-10" name="__codelineno-172-10"></a>
<a id="__codelineno-172-11" name="__codelineno-172-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-172-12" name="__codelineno-172-12"></a><span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">50</span>
<a id="__codelineno-172-13" name="__codelineno-172-13"></a><span class="w">    </span><span class="nx">modifyValue</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<a id="__codelineno-172-14" name="__codelineno-172-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After modifyValue:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// a的值不会被修改</span>
<a id="__codelineno-172-15" name="__codelineno-172-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-173-1">1</a></span>
<span class="normal"><a href="#__codelineno-173-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-173-1" name="__codelineno-173-1"></a>Inside modifyValue: 100
<a id="__codelineno-173-2" name="__codelineno-173-2"></a>After modifyValue: 50
</code></pre></div></td></tr></table></div>
<h4 id="使用指针传递参数">使用指针传递参数<a class="headerlink" href="#使用指针传递参数" title="Permanent link">&para;</a></h4>
<p>为了在函数内部修改外部变量的值，可以使用指针传递参数。指针传递允许函数直接访问和修改变量的内存地址。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-174-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-174-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-174-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-174-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-174-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-174-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-174-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-174-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-174-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-174-10">10</a></span>
<span class="normal"><a href="#__codelineno-174-11">11</a></span>
<span class="normal"><a href="#__codelineno-174-12">12</a></span>
<span class="normal"><a href="#__codelineno-174-13">13</a></span>
<span class="normal"><a href="#__codelineno-174-14">14</a></span>
<span class="normal"><a href="#__codelineno-174-15">15</a></span>
<span class="normal"><a href="#__codelineno-174-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-174-1" name="__codelineno-174-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-174-2" name="__codelineno-174-2"></a>
<a id="__codelineno-174-3" name="__codelineno-174-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-174-4" name="__codelineno-174-4"></a>
<a id="__codelineno-174-5" name="__codelineno-174-5"></a><span class="c1">// 定义一个函数，使用指针修改参数的值</span>
<a id="__codelineno-174-6" name="__codelineno-174-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">modifyPointer</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-174-7" name="__codelineno-174-7"></a><span class="w">    </span><span class="o">*</span><span class="nx">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span>
<a id="__codelineno-174-8" name="__codelineno-174-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Inside modifyPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-174-9" name="__codelineno-174-9"></a><span class="p">}</span>
<a id="__codelineno-174-10" name="__codelineno-174-10"></a>
<a id="__codelineno-174-11" name="__codelineno-174-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-174-12" name="__codelineno-174-12"></a><span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">50</span>
<a id="__codelineno-174-13" name="__codelineno-174-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Before modifyPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span>
<a id="__codelineno-174-14" name="__codelineno-174-14"></a><span class="w">    </span><span class="nx">modifyPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 传递变量a的地址</span>
<a id="__codelineno-174-15" name="__codelineno-174-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After modifyPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// a的值被修改</span>
<a id="__codelineno-174-16" name="__codelineno-174-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-175-1">1</a></span>
<span class="normal"><a href="#__codelineno-175-2">2</a></span>
<span class="normal"><a href="#__codelineno-175-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-175-1" name="__codelineno-175-1"></a>Before modifyPointer: 50
<a id="__codelineno-175-2" name="__codelineno-175-2"></a>Inside modifyPointer: 100
<a id="__codelineno-175-3" name="__codelineno-175-3"></a>After modifyPointer: 100
</code></pre></div></td></tr></table></div>
<h4 id="多参数函数">多参数函数<a class="headerlink" href="#多参数函数" title="Permanent link">&para;</a></h4>
<p>Go语言支持多个参数的函数，可以组合使用不同类型的参数。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-176-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-176-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-176-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-176-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-176-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-176-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-176-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-176-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-176-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-176-10">10</a></span>
<span class="normal"><a href="#__codelineno-176-11">11</a></span>
<span class="normal"><a href="#__codelineno-176-12">12</a></span>
<span class="normal"><a href="#__codelineno-176-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-176-1" name="__codelineno-176-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-176-2" name="__codelineno-176-2"></a>
<a id="__codelineno-176-3" name="__codelineno-176-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-176-4" name="__codelineno-176-4"></a>
<a id="__codelineno-176-5" name="__codelineno-176-5"></a><span class="c1">// 定义一个函数，接受多个不同类型的参数</span>
<a id="__codelineno-176-6" name="__codelineno-176-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">printDetails</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-176-7" name="__codelineno-176-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Name: %s, Age: %d, Height: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">)</span>
<a id="__codelineno-176-8" name="__codelineno-176-8"></a><span class="p">}</span>
<a id="__codelineno-176-9" name="__codelineno-176-9"></a>
<a id="__codelineno-176-10" name="__codelineno-176-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-176-11" name="__codelineno-176-11"></a><span class="w">    </span><span class="nx">printDetails</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mf">5.6</span><span class="p">)</span>
<a id="__codelineno-176-12" name="__codelineno-176-12"></a><span class="w">    </span><span class="nx">printDetails</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mf">5.9</span><span class="p">)</span>
<a id="__codelineno-176-13" name="__codelineno-176-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-177-1">1</a></span>
<span class="normal"><a href="#__codelineno-177-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-177-1" name="__codelineno-177-1"></a>Name: Alice, Age: 30, Height: 5.60
<a id="__codelineno-177-2" name="__codelineno-177-2"></a>Name: Bob, Age: 25, Height: 5.90
</code></pre></div></td></tr></table></div>
<h4 id="可选参数">可选参数<a class="headerlink" href="#可选参数" title="Permanent link">&para;</a></h4>
<p>Go语言不直接支持可选参数，但可以通过参数的组合和使用指针来模拟实现。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-178-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-178-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-178-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-178-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-178-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-178-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-178-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-178-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-178-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-178-10">10</a></span>
<span class="normal"><a href="#__codelineno-178-11">11</a></span>
<span class="normal"><a href="#__codelineno-178-12">12</a></span>
<span class="normal"><a href="#__codelineno-178-13">13</a></span>
<span class="normal"><a href="#__codelineno-178-14">14</a></span>
<span class="normal"><a href="#__codelineno-178-15">15</a></span>
<span class="normal"><a href="#__codelineno-178-16">16</a></span>
<span class="normal"><a href="#__codelineno-178-17">17</a></span>
<span class="normal"><a href="#__codelineno-178-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-178-1" name="__codelineno-178-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-178-2" name="__codelineno-178-2"></a>
<a id="__codelineno-178-3" name="__codelineno-178-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-178-4" name="__codelineno-178-4"></a>
<a id="__codelineno-178-5" name="__codelineno-178-5"></a><span class="c1">// 定义一个函数，使用指针模拟可选参数</span>
<a id="__codelineno-178-6" name="__codelineno-178-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">greet</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">*</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-7" name="__codelineno-178-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-8" name="__codelineno-178-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, %s %s!\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">title</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span>
<a id="__codelineno-178-9" name="__codelineno-178-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-10" name="__codelineno-178-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, %s!\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span>
<a id="__codelineno-178-11" name="__codelineno-178-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-178-12" name="__codelineno-178-12"></a><span class="p">}</span>
<a id="__codelineno-178-13" name="__codelineno-178-13"></a>
<a id="__codelineno-178-14" name="__codelineno-178-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-15" name="__codelineno-178-15"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Dr.&quot;</span>
<a id="__codelineno-178-16" name="__codelineno-178-16"></a><span class="w">    </span><span class="nx">greet</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">title</span><span class="p">)</span><span class="w"> </span><span class="c1">// 使用标题</span>
<a id="__codelineno-178-17" name="__codelineno-178-17"></a><span class="w">    </span><span class="nx">greet</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w">      </span><span class="c1">// 不使用标题</span>
<a id="__codelineno-178-18" name="__codelineno-178-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-179-1">1</a></span>
<span class="normal"><a href="#__codelineno-179-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-179-1" name="__codelineno-179-1"></a>Hello, Dr. Alice!
<a id="__codelineno-179-2" name="__codelineno-179-2"></a>Hello, Bob!
</code></pre></div></td></tr></table></div>
<h3 id="53-可变参数函数">5.3 可变参数函数<a class="headerlink" href="#53-可变参数函数" title="Permanent link">&para;</a></h3>
<p>可变参数函数允许函数接受任意数量的参数。这在处理不确定数量输入时非常有用。Go语言通过在参数类型前加<code>...</code>来定义可变参数。</p>
<h4 id="定义可变参数函数">定义可变参数函数<a class="headerlink" href="#定义可变参数函数" title="Permanent link">&para;</a></h4>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-180-1">1</a></span>
<span class="normal"><a href="#__codelineno-180-2">2</a></span>
<span class="normal"><a href="#__codelineno-180-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-180-1" name="__codelineno-180-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">函数名</span><span class="p">(</span><span class="nx">参数类型</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="nx">参数类型</span><span class="p">)</span><span class="w"> </span><span class="nx">返回值类型</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-180-2" name="__codelineno-180-2"></a><span class="w">    </span><span class="c1">// 函数体</span>
<a id="__codelineno-180-3" name="__codelineno-180-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-181-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-181-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-181-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-181-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-181-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-181-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-181-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-181-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-181-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-181-10">10</a></span>
<span class="normal"><a href="#__codelineno-181-11">11</a></span>
<span class="normal"><a href="#__codelineno-181-12">12</a></span>
<span class="normal"><a href="#__codelineno-181-13">13</a></span>
<span class="normal"><a href="#__codelineno-181-14">14</a></span>
<span class="normal"><a href="#__codelineno-181-15">15</a></span>
<span class="normal"><a href="#__codelineno-181-16">16</a></span>
<span class="normal"><a href="#__codelineno-181-17">17</a></span>
<span class="normal"><a href="#__codelineno-181-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-181-1" name="__codelineno-181-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-181-2" name="__codelineno-181-2"></a>
<a id="__codelineno-181-3" name="__codelineno-181-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-181-4" name="__codelineno-181-4"></a>
<a id="__codelineno-181-5" name="__codelineno-181-5"></a><span class="c1">// 定义一个函数，接受可变数量的整数参数并求和</span>
<a id="__codelineno-181-6" name="__codelineno-181-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sum</span><span class="p">(</span><span class="nx">nums</span><span class="w"> </span><span class="o">...</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-181-7" name="__codelineno-181-7"></a><span class="w">    </span><span class="nx">total</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-181-8" name="__codelineno-181-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">nums</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-181-9" name="__codelineno-181-9"></a><span class="w">        </span><span class="nx">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">num</span>
<a id="__codelineno-181-10" name="__codelineno-181-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-181-11" name="__codelineno-181-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">total</span>
<a id="__codelineno-181-12" name="__codelineno-181-12"></a><span class="p">}</span>
<a id="__codelineno-181-13" name="__codelineno-181-13"></a>
<a id="__codelineno-181-14" name="__codelineno-181-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-181-15" name="__codelineno-181-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w">       </span><span class="c1">// 输出: 6</span>
<a id="__codelineno-181-16" name="__codelineno-181-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">sum</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: 100</span>
<a id="__codelineno-181-17" name="__codelineno-181-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">sum</span><span class="p">())</span><span class="w">              </span><span class="c1">// 输出: 0</span>
<a id="__codelineno-181-18" name="__codelineno-181-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-182-1">1</a></span>
<span class="normal"><a href="#__codelineno-182-2">2</a></span>
<span class="normal"><a href="#__codelineno-182-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-182-1" name="__codelineno-182-1"></a>6
<a id="__codelineno-182-2" name="__codelineno-182-2"></a>100
<a id="__codelineno-182-3" name="__codelineno-182-3"></a>0
</code></pre></div></td></tr></table></div>
<h4 id="使用可变参数的其他示例">使用可变参数的其他示例<a class="headerlink" href="#使用可变参数的其他示例" title="Permanent link">&para;</a></h4>
<p><strong>示例1：打印多个字符串</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-183-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-183-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-183-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-183-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-183-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-183-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-183-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-183-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-183-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-183-10">10</a></span>
<span class="normal"><a href="#__codelineno-183-11">11</a></span>
<span class="normal"><a href="#__codelineno-183-12">12</a></span>
<span class="normal"><a href="#__codelineno-183-13">13</a></span>
<span class="normal"><a href="#__codelineno-183-14">14</a></span>
<span class="normal"><a href="#__codelineno-183-15">15</a></span>
<span class="normal"><a href="#__codelineno-183-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-183-1" name="__codelineno-183-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-183-2" name="__codelineno-183-2"></a>
<a id="__codelineno-183-3" name="__codelineno-183-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-183-4" name="__codelineno-183-4"></a>
<a id="__codelineno-183-5" name="__codelineno-183-5"></a><span class="c1">// 定义一个函数，接受可变数量的字符串参数并打印</span>
<a id="__codelineno-183-6" name="__codelineno-183-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">printStrings</span><span class="p">(</span><span class="nx">strs</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-183-7" name="__codelineno-183-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">strs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-183-8" name="__codelineno-183-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-183-9" name="__codelineno-183-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-183-10" name="__codelineno-183-10"></a><span class="p">}</span>
<a id="__codelineno-183-11" name="__codelineno-183-11"></a>
<a id="__codelineno-183-12" name="__codelineno-183-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-183-13" name="__codelineno-183-13"></a><span class="w">    </span><span class="nx">printStrings</span><span class="p">(</span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;is&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fun&quot;</span><span class="p">)</span>
<a id="__codelineno-183-14" name="__codelineno-183-14"></a><span class="w">    </span><span class="nx">printStrings</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">)</span>
<a id="__codelineno-183-15" name="__codelineno-183-15"></a><span class="w">    </span><span class="nx">printStrings</span><span class="p">()</span>
<a id="__codelineno-183-16" name="__codelineno-183-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-184-1">1</a></span>
<span class="normal"><a href="#__codelineno-184-2">2</a></span>
<span class="normal"><a href="#__codelineno-184-3">3</a></span>
<span class="normal"><a href="#__codelineno-184-4">4</a></span>
<span class="normal"><a href="#__codelineno-184-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-184-1" name="__codelineno-184-1"></a>Go
<a id="__codelineno-184-2" name="__codelineno-184-2"></a>is
<a id="__codelineno-184-3" name="__codelineno-184-3"></a>fun
<a id="__codelineno-184-4" name="__codelineno-184-4"></a>Hello
<a id="__codelineno-184-5" name="__codelineno-184-5"></a>World
</code></pre></div></td></tr></table></div>
<p><strong>示例2：计算多个浮点数的平均值</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-185-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-185-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-185-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-185-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-185-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-185-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-185-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-185-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-185-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-185-10">10</a></span>
<span class="normal"><a href="#__codelineno-185-11">11</a></span>
<span class="normal"><a href="#__codelineno-185-12">12</a></span>
<span class="normal"><a href="#__codelineno-185-13">13</a></span>
<span class="normal"><a href="#__codelineno-185-14">14</a></span>
<span class="normal"><a href="#__codelineno-185-15">15</a></span>
<span class="normal"><a href="#__codelineno-185-16">16</a></span>
<span class="normal"><a href="#__codelineno-185-17">17</a></span>
<span class="normal"><a href="#__codelineno-185-18">18</a></span>
<span class="normal"><a href="#__codelineno-185-19">19</a></span>
<span class="normal"><a href="#__codelineno-185-20">20</a></span>
<span class="normal"><a href="#__codelineno-185-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-185-1" name="__codelineno-185-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-185-2" name="__codelineno-185-2"></a>
<a id="__codelineno-185-3" name="__codelineno-185-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-185-4" name="__codelineno-185-4"></a>
<a id="__codelineno-185-5" name="__codelineno-185-5"></a><span class="c1">// 定义一个函数，接受可变数量的浮点数参数并计算平均值</span>
<a id="__codelineno-185-6" name="__codelineno-185-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">average</span><span class="p">(</span><span class="nx">nums</span><span class="w"> </span><span class="o">...</span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-185-7" name="__codelineno-185-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-185-8" name="__codelineno-185-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-185-9" name="__codelineno-185-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-185-10" name="__codelineno-185-10"></a><span class="w">    </span><span class="nx">total</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">0.0</span>
<a id="__codelineno-185-11" name="__codelineno-185-11"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">nums</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-185-12" name="__codelineno-185-12"></a><span class="w">        </span><span class="nx">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">num</span>
<a id="__codelineno-185-13" name="__codelineno-185-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-185-14" name="__codelineno-185-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">total</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">nums</span><span class="p">))</span>
<a id="__codelineno-185-15" name="__codelineno-185-15"></a><span class="p">}</span>
<a id="__codelineno-185-16" name="__codelineno-185-16"></a>
<a id="__codelineno-185-17" name="__codelineno-185-17"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-185-18" name="__codelineno-185-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Average: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">average</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">,</span><span class="w"> </span><span class="mf">3.5</span><span class="p">))</span><span class="w">       </span><span class="c1">// 输出: Average: 2.50</span>
<a id="__codelineno-185-19" name="__codelineno-185-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Average: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">average</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="w"> </span><span class="mf">20.0</span><span class="p">))</span><span class="w">         </span><span class="c1">// 输出: Average: 15.00</span>
<a id="__codelineno-185-20" name="__codelineno-185-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Average: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">average</span><span class="p">())</span><span class="w">                  </span><span class="c1">// 输出: Average: 0.00</span>
<a id="__codelineno-185-21" name="__codelineno-185-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-186-1">1</a></span>
<span class="normal"><a href="#__codelineno-186-2">2</a></span>
<span class="normal"><a href="#__codelineno-186-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-186-1" name="__codelineno-186-1"></a>Average: 2.50
<a id="__codelineno-186-2" name="__codelineno-186-2"></a>Average: 15.00
<a id="__codelineno-186-3" name="__codelineno-186-3"></a>Average: 0.00
</code></pre></div></td></tr></table></div>
<h4 id="将切片传递给可变参数函数">将切片传递给可变参数函数<a class="headerlink" href="#将切片传递给可变参数函数" title="Permanent link">&para;</a></h4>
<p>如果已经有一个切片，可以使用<code>...</code>操作符将切片元素作为可变参数传递给函数。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-187-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-187-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-187-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-187-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-187-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-187-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-187-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-187-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-187-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-187-10">10</a></span>
<span class="normal"><a href="#__codelineno-187-11">11</a></span>
<span class="normal"><a href="#__codelineno-187-12">12</a></span>
<span class="normal"><a href="#__codelineno-187-13">13</a></span>
<span class="normal"><a href="#__codelineno-187-14">14</a></span>
<span class="normal"><a href="#__codelineno-187-15">15</a></span>
<span class="normal"><a href="#__codelineno-187-16">16</a></span>
<span class="normal"><a href="#__codelineno-187-17">17</a></span>
<span class="normal"><a href="#__codelineno-187-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-187-1" name="__codelineno-187-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-187-2" name="__codelineno-187-2"></a>
<a id="__codelineno-187-3" name="__codelineno-187-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-187-4" name="__codelineno-187-4"></a>
<a id="__codelineno-187-5" name="__codelineno-187-5"></a><span class="c1">// 定义一个函数，接受可变数量的整数参数并求和</span>
<a id="__codelineno-187-6" name="__codelineno-187-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sum</span><span class="p">(</span><span class="nx">nums</span><span class="w"> </span><span class="o">...</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-187-7" name="__codelineno-187-7"></a><span class="w">    </span><span class="nx">total</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-187-8" name="__codelineno-187-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">nums</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-187-9" name="__codelineno-187-9"></a><span class="w">        </span><span class="nx">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">num</span>
<a id="__codelineno-187-10" name="__codelineno-187-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-187-11" name="__codelineno-187-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">total</span>
<a id="__codelineno-187-12" name="__codelineno-187-12"></a><span class="p">}</span>
<a id="__codelineno-187-13" name="__codelineno-187-13"></a>
<a id="__codelineno-187-14" name="__codelineno-187-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-187-15" name="__codelineno-187-15"></a><span class="w">    </span><span class="nx">numbers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">}</span>
<a id="__codelineno-187-16" name="__codelineno-187-16"></a><span class="w">    </span><span class="nx">total</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sum</span><span class="p">(</span><span class="nx">numbers</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="c1">// 使用...将切片传递为可变参数</span>
<a id="__codelineno-187-17" name="__codelineno-187-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Total:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">total</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Total: 15</span>
<a id="__codelineno-187-18" name="__codelineno-187-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-188-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-188-1" name="__codelineno-188-1"></a>Total: 15
</code></pre></div></td></tr></table></div>
<h3 id="54-匿名函数与闭包">5.4 匿名函数与闭包<a class="headerlink" href="#54-匿名函数与闭包" title="Permanent link">&para;</a></h3>
<h4 id="匿名函数">匿名函数<a class="headerlink" href="#匿名函数" title="Permanent link">&para;</a></h4>
<p>匿名函数是没有名称的函数，可以在定义时直接调用，或赋值给变量以便后续使用。匿名函数在需要临时使用函数逻辑时非常有用。</p>
<p><strong>示例1：立即调用匿名函数</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-189-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-189-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-189-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-189-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-189-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-189-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-189-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-189-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-189-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-189-10">10</a></span>
<span class="normal"><a href="#__codelineno-189-11">11</a></span>
<span class="normal"><a href="#__codelineno-189-12">12</a></span>
<span class="normal"><a href="#__codelineno-189-13">13</a></span>
<span class="normal"><a href="#__codelineno-189-14">14</a></span>
<span class="normal"><a href="#__codelineno-189-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-189-1" name="__codelineno-189-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-189-2" name="__codelineno-189-2"></a>
<a id="__codelineno-189-3" name="__codelineno-189-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-189-4" name="__codelineno-189-4"></a>
<a id="__codelineno-189-5" name="__codelineno-189-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-189-6" name="__codelineno-189-6"></a><span class="w">    </span><span class="c1">// 定义并立即调用匿名函数</span>
<a id="__codelineno-189-7" name="__codelineno-189-7"></a><span class="w">    </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-189-8" name="__codelineno-189-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;This is an anonymous function!&quot;</span><span class="p">)</span>
<a id="__codelineno-189-9" name="__codelineno-189-9"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-189-10" name="__codelineno-189-10"></a>
<a id="__codelineno-189-11" name="__codelineno-189-11"></a><span class="w">    </span><span class="c1">// 带参数的匿名函数</span>
<a id="__codelineno-189-12" name="__codelineno-189-12"></a><span class="w">    </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-189-13" name="__codelineno-189-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Sum: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-189-14" name="__codelineno-189-14"></a><span class="w">    </span><span class="p">}(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-189-15" name="__codelineno-189-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-190-1">1</a></span>
<span class="normal"><a href="#__codelineno-190-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-190-1" name="__codelineno-190-1"></a>This is an anonymous function!
<a id="__codelineno-190-2" name="__codelineno-190-2"></a>Sum: 7
</code></pre></div></td></tr></table></div>
<p><strong>示例2：将匿名函数赋值给变量</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-191-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-191-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-191-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-191-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-191-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-191-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-191-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-191-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-191-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-191-10">10</a></span>
<span class="normal"><a href="#__codelineno-191-11">11</a></span>
<span class="normal"><a href="#__codelineno-191-12">12</a></span>
<span class="normal"><a href="#__codelineno-191-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-191-1" name="__codelineno-191-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-191-2" name="__codelineno-191-2"></a>
<a id="__codelineno-191-3" name="__codelineno-191-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-191-4" name="__codelineno-191-4"></a>
<a id="__codelineno-191-5" name="__codelineno-191-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-191-6" name="__codelineno-191-6"></a><span class="w">    </span><span class="c1">// 将匿名函数赋值给变量</span>
<a id="__codelineno-191-7" name="__codelineno-191-7"></a><span class="w">    </span><span class="nx">greet</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-191-8" name="__codelineno-191-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, %s!\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span>
<a id="__codelineno-191-9" name="__codelineno-191-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-191-10" name="__codelineno-191-10"></a>
<a id="__codelineno-191-11" name="__codelineno-191-11"></a><span class="w">    </span><span class="nx">greet</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">)</span>
<a id="__codelineno-191-12" name="__codelineno-191-12"></a><span class="w">    </span><span class="nx">greet</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">)</span>
<a id="__codelineno-191-13" name="__codelineno-191-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-192-1">1</a></span>
<span class="normal"><a href="#__codelineno-192-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-192-1" name="__codelineno-192-1"></a>Hello, Alice!
<a id="__codelineno-192-2" name="__codelineno-192-2"></a>Hello, Bob!
</code></pre></div></td></tr></table></div>
<h4 id="闭包">闭包<a class="headerlink" href="#闭包" title="Permanent link">&para;</a></h4>
<p>闭包是指一个函数可以访问其外部作用域中的变量，即使外部函数已经返回。闭包允许函数“记住”并操作其定义时的环境变量。</p>
<p><strong>示例1：简单闭包</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-193-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-193-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-193-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-193-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-193-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-193-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-193-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-193-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-193-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-193-10">10</a></span>
<span class="normal"><a href="#__codelineno-193-11">11</a></span>
<span class="normal"><a href="#__codelineno-193-12">12</a></span>
<span class="normal"><a href="#__codelineno-193-13">13</a></span>
<span class="normal"><a href="#__codelineno-193-14">14</a></span>
<span class="normal"><a href="#__codelineno-193-15">15</a></span>
<span class="normal"><a href="#__codelineno-193-16">16</a></span>
<span class="normal"><a href="#__codelineno-193-17">17</a></span>
<span class="normal"><a href="#__codelineno-193-18">18</a></span>
<span class="normal"><a href="#__codelineno-193-19">19</a></span>
<span class="normal"><a href="#__codelineno-193-20">20</a></span>
<span class="normal"><a href="#__codelineno-193-21">21</a></span>
<span class="normal"><a href="#__codelineno-193-22">22</a></span>
<span class="normal"><a href="#__codelineno-193-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-193-1" name="__codelineno-193-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-193-2" name="__codelineno-193-2"></a>
<a id="__codelineno-193-3" name="__codelineno-193-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-193-4" name="__codelineno-193-4"></a>
<a id="__codelineno-193-5" name="__codelineno-193-5"></a><span class="c1">// 定义一个生成器函数，返回一个闭包</span>
<a id="__codelineno-193-6" name="__codelineno-193-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">generator</span><span class="p">()</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-193-7" name="__codelineno-193-7"></a><span class="w">    </span><span class="nx">count</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-193-8" name="__codelineno-193-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-193-9" name="__codelineno-193-9"></a><span class="w">        </span><span class="nx">count</span><span class="o">++</span>
<a id="__codelineno-193-10" name="__codelineno-193-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span>
<a id="__codelineno-193-11" name="__codelineno-193-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-193-12" name="__codelineno-193-12"></a><span class="p">}</span>
<a id="__codelineno-193-13" name="__codelineno-193-13"></a>
<a id="__codelineno-193-14" name="__codelineno-193-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-193-15" name="__codelineno-193-15"></a><span class="w">    </span><span class="nx">next</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">generator</span><span class="p">()</span>
<a id="__codelineno-193-16" name="__codelineno-193-16"></a>
<a id="__codelineno-193-17" name="__codelineno-193-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">next</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出: 1</span>
<a id="__codelineno-193-18" name="__codelineno-193-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">next</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出: 2</span>
<a id="__codelineno-193-19" name="__codelineno-193-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">next</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出: 3</span>
<a id="__codelineno-193-20" name="__codelineno-193-20"></a>
<a id="__codelineno-193-21" name="__codelineno-193-21"></a><span class="w">    </span><span class="nx">another</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">generator</span><span class="p">()</span>
<a id="__codelineno-193-22" name="__codelineno-193-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">another</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出: 1</span>
<a id="__codelineno-193-23" name="__codelineno-193-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-194-1">1</a></span>
<span class="normal"><a href="#__codelineno-194-2">2</a></span>
<span class="normal"><a href="#__codelineno-194-3">3</a></span>
<span class="normal"><a href="#__codelineno-194-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-194-1" name="__codelineno-194-1"></a>1
<a id="__codelineno-194-2" name="__codelineno-194-2"></a>2
<a id="__codelineno-194-3" name="__codelineno-194-3"></a>3
<a id="__codelineno-194-4" name="__codelineno-194-4"></a>1
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>generator</code>函数返回一个匿名函数，该匿名函数访问并修改外部变量<code>count</code>。</li>
<li>每次调用<code>next()</code>时，<code>count</code>都会递增。</li>
<li><code>another</code>是另一个闭包实例，拥有独立的<code>count</code>变量。</li>
</ul>
<p><strong>示例2：闭包与参数</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-195-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-195-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-195-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-195-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-195-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-195-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-195-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-195-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-195-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-195-10">10</a></span>
<span class="normal"><a href="#__codelineno-195-11">11</a></span>
<span class="normal"><a href="#__codelineno-195-12">12</a></span>
<span class="normal"><a href="#__codelineno-195-13">13</a></span>
<span class="normal"><a href="#__codelineno-195-14">14</a></span>
<span class="normal"><a href="#__codelineno-195-15">15</a></span>
<span class="normal"><a href="#__codelineno-195-16">16</a></span>
<span class="normal"><a href="#__codelineno-195-17">17</a></span>
<span class="normal"><a href="#__codelineno-195-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-195-1" name="__codelineno-195-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-195-2" name="__codelineno-195-2"></a>
<a id="__codelineno-195-3" name="__codelineno-195-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-195-4" name="__codelineno-195-4"></a>
<a id="__codelineno-195-5" name="__codelineno-195-5"></a><span class="c1">// 定义一个函数，返回一个闭包，该闭包会将输入乘以指定的因子</span>
<a id="__codelineno-195-6" name="__codelineno-195-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">multiplier</span><span class="p">(</span><span class="nx">factor</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-195-7" name="__codelineno-195-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-195-8" name="__codelineno-195-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">factor</span>
<a id="__codelineno-195-9" name="__codelineno-195-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-195-10" name="__codelineno-195-10"></a><span class="p">}</span>
<a id="__codelineno-195-11" name="__codelineno-195-11"></a>
<a id="__codelineno-195-12" name="__codelineno-195-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-195-13" name="__codelineno-195-13"></a><span class="w">    </span><span class="nx">double</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">multiplier</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-195-14" name="__codelineno-195-14"></a><span class="w">    </span><span class="nx">triple</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">multiplier</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-195-15" name="__codelineno-195-15"></a>
<a id="__codelineno-195-16" name="__codelineno-195-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Double 5:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">double</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: Double 5: 10</span>
<a id="__codelineno-195-17" name="__codelineno-195-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Triple 5:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">triple</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: Triple 5: 15</span>
<a id="__codelineno-195-18" name="__codelineno-195-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-196-1">1</a></span>
<span class="normal"><a href="#__codelineno-196-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-196-1" name="__codelineno-196-1"></a>Double 5: 10
<a id="__codelineno-196-2" name="__codelineno-196-2"></a>Triple 5: 15
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>multiplier</code>函数接受一个<code>factor</code>参数，并返回一个闭包。</li>
<li>该闭包接受一个整数<code>x</code>，并返回<code>x</code>乘以<code>factor</code>的结果。</li>
<li><code>double</code>和<code>triple</code>是两个不同的闭包实例，分别将输入数值乘以2和3。</li>
</ul>
<h4 id="闭包的应用场景">闭包的应用场景<a class="headerlink" href="#闭包的应用场景" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>延迟执行</strong>：将某些操作延迟到特定条件下执行。</li>
<li><strong>数据封装</strong>：封装数据，保护数据不被外部直接修改。</li>
<li><strong>回调函数</strong>：作为回调函数传递给其他函数，以实现灵活的功能扩展。</li>
</ul>
<p><strong>示例：延迟执行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-197-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-197-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-197-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-197-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-197-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-197-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-197-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-197-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-197-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-197-10">10</a></span>
<span class="normal"><a href="#__codelineno-197-11">11</a></span>
<span class="normal"><a href="#__codelineno-197-12">12</a></span>
<span class="normal"><a href="#__codelineno-197-13">13</a></span>
<span class="normal"><a href="#__codelineno-197-14">14</a></span>
<span class="normal"><a href="#__codelineno-197-15">15</a></span>
<span class="normal"><a href="#__codelineno-197-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-197-1" name="__codelineno-197-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-197-2" name="__codelineno-197-2"></a>
<a id="__codelineno-197-3" name="__codelineno-197-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-197-4" name="__codelineno-197-4"></a>
<a id="__codelineno-197-5" name="__codelineno-197-5"></a><span class="c1">// 定义一个函数，接受一个函数作为参数</span>
<a id="__codelineno-197-6" name="__codelineno-197-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">performOperation</span><span class="p">(</span><span class="nx">operation</span><span class="w"> </span><span class="kd">func</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-7" name="__codelineno-197-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;准备执行操作...&quot;</span><span class="p">)</span>
<a id="__codelineno-197-8" name="__codelineno-197-8"></a><span class="w">    </span><span class="nx">operation</span><span class="p">()</span>
<a id="__codelineno-197-9" name="__codelineno-197-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;操作执行完毕。&quot;</span><span class="p">)</span>
<a id="__codelineno-197-10" name="__codelineno-197-10"></a><span class="p">}</span>
<a id="__codelineno-197-11" name="__codelineno-197-11"></a>
<a id="__codelineno-197-12" name="__codelineno-197-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-13" name="__codelineno-197-13"></a><span class="w">    </span><span class="nx">performOperation</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-14" name="__codelineno-197-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;这是一个延迟执行的匿名函数。&quot;</span><span class="p">)</span>
<a id="__codelineno-197-15" name="__codelineno-197-15"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-197-16" name="__codelineno-197-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-198-1">1</a></span>
<span class="normal"><a href="#__codelineno-198-2">2</a></span>
<span class="normal"><a href="#__codelineno-198-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-198-1" name="__codelineno-198-1"></a>准备执行操作...
<a id="__codelineno-198-2" name="__codelineno-198-2"></a>这是一个延迟执行的匿名函数。
<a id="__codelineno-198-3" name="__codelineno-198-3"></a>操作执行完毕。
</code></pre></div></td></tr></table></div>
<h3 id="55-函数作为值和类型">5.5 函数作为值和类型<a class="headerlink" href="#55-函数作为值和类型" title="Permanent link">&para;</a></h3>
<p>在Go语言中，函数可以作为值来传递和使用。这意味着函数可以被赋值给变量、作为参数传递给其他函数，甚至作为返回值返回。这种特性使得Go语言在函数式编程方面具有很大的灵活性。</p>
<h4 id="将函数赋值给变量">将函数赋值给变量<a class="headerlink" href="#将函数赋值给变量" title="Permanent link">&para;</a></h4>
<p>函数可以被赋值给变量，从而实现对函数的引用和调用。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-199-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-199-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-199-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-199-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-199-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-199-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-199-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-199-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-199-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-199-10">10</a></span>
<span class="normal"><a href="#__codelineno-199-11">11</a></span>
<span class="normal"><a href="#__codelineno-199-12">12</a></span>
<span class="normal"><a href="#__codelineno-199-13">13</a></span>
<span class="normal"><a href="#__codelineno-199-14">14</a></span>
<span class="normal"><a href="#__codelineno-199-15">15</a></span>
<span class="normal"><a href="#__codelineno-199-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-199-1" name="__codelineno-199-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-199-2" name="__codelineno-199-2"></a>
<a id="__codelineno-199-3" name="__codelineno-199-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-199-4" name="__codelineno-199-4"></a>
<a id="__codelineno-199-5" name="__codelineno-199-5"></a><span class="c1">// 定义一个简单的函数</span>
<a id="__codelineno-199-6" name="__codelineno-199-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sayHello</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-199-7" name="__codelineno-199-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">)</span>
<a id="__codelineno-199-8" name="__codelineno-199-8"></a><span class="p">}</span>
<a id="__codelineno-199-9" name="__codelineno-199-9"></a>
<a id="__codelineno-199-10" name="__codelineno-199-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-199-11" name="__codelineno-199-11"></a><span class="w">    </span><span class="c1">// 将函数赋值给变量</span>
<a id="__codelineno-199-12" name="__codelineno-199-12"></a><span class="w">    </span><span class="nx">greeting</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sayHello</span>
<a id="__codelineno-199-13" name="__codelineno-199-13"></a>
<a id="__codelineno-199-14" name="__codelineno-199-14"></a><span class="w">    </span><span class="c1">// 调用通过变量引用的函数</span>
<a id="__codelineno-199-15" name="__codelineno-199-15"></a><span class="w">    </span><span class="nx">greeting</span><span class="p">()</span><span class="w"> </span><span class="c1">// 输出: Hello!</span>
<a id="__codelineno-199-16" name="__codelineno-199-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-200-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-200-1" name="__codelineno-200-1"></a>Hello!
</code></pre></div></td></tr></table></div>
<h4 id="将函数作为参数传递">将函数作为参数传递<a class="headerlink" href="#将函数作为参数传递" title="Permanent link">&para;</a></h4>
<p>函数可以作为参数传递给其他函数，允许更高层次的抽象和代码复用。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-201-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-201-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-201-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-201-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-201-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-201-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-201-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-201-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-201-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-201-10">10</a></span>
<span class="normal"><a href="#__codelineno-201-11">11</a></span>
<span class="normal"><a href="#__codelineno-201-12">12</a></span>
<span class="normal"><a href="#__codelineno-201-13">13</a></span>
<span class="normal"><a href="#__codelineno-201-14">14</a></span>
<span class="normal"><a href="#__codelineno-201-15">15</a></span>
<span class="normal"><a href="#__codelineno-201-16">16</a></span>
<span class="normal"><a href="#__codelineno-201-17">17</a></span>
<span class="normal"><a href="#__codelineno-201-18">18</a></span>
<span class="normal"><a href="#__codelineno-201-19">19</a></span>
<span class="normal"><a href="#__codelineno-201-20">20</a></span>
<span class="normal"><a href="#__codelineno-201-21">21</a></span>
<span class="normal"><a href="#__codelineno-201-22">22</a></span>
<span class="normal"><a href="#__codelineno-201-23">23</a></span>
<span class="normal"><a href="#__codelineno-201-24">24</a></span>
<span class="normal"><a href="#__codelineno-201-25">25</a></span>
<span class="normal"><a href="#__codelineno-201-26">26</a></span>
<span class="normal"><a href="#__codelineno-201-27">27</a></span>
<span class="normal"><a href="#__codelineno-201-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-201-1" name="__codelineno-201-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-201-2" name="__codelineno-201-2"></a>
<a id="__codelineno-201-3" name="__codelineno-201-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-201-4" name="__codelineno-201-4"></a>
<a id="__codelineno-201-5" name="__codelineno-201-5"></a><span class="c1">// 定义一个函数类型</span>
<a id="__codelineno-201-6" name="__codelineno-201-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">operation</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-201-7" name="__codelineno-201-7"></a>
<a id="__codelineno-201-8" name="__codelineno-201-8"></a><span class="c1">// 定义一个函数，接受另一个函数作为参数</span>
<a id="__codelineno-201-9" name="__codelineno-201-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">compute</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">op</span><span class="w"> </span><span class="nx">operation</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-10" name="__codelineno-201-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">op</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-201-11" name="__codelineno-201-11"></a><span class="p">}</span>
<a id="__codelineno-201-12" name="__codelineno-201-12"></a>
<a id="__codelineno-201-13" name="__codelineno-201-13"></a><span class="c1">// 定义具体的操作函数</span>
<a id="__codelineno-201-14" name="__codelineno-201-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-15" name="__codelineno-201-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-201-16" name="__codelineno-201-16"></a><span class="p">}</span>
<a id="__codelineno-201-17" name="__codelineno-201-17"></a>
<a id="__codelineno-201-18" name="__codelineno-201-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">multiply</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-19" name="__codelineno-201-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-201-20" name="__codelineno-201-20"></a><span class="p">}</span>
<a id="__codelineno-201-21" name="__codelineno-201-21"></a>
<a id="__codelineno-201-22" name="__codelineno-201-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-23" name="__codelineno-201-23"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">compute</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nx">add</span><span class="p">)</span>
<a id="__codelineno-201-24" name="__codelineno-201-24"></a><span class="w">    </span><span class="nx">product</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">compute</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nx">multiply</span><span class="p">)</span>
<a id="__codelineno-201-25" name="__codelineno-201-25"></a>
<a id="__codelineno-201-26" name="__codelineno-201-26"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Sum:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sum</span><span class="p">)</span><span class="w">         </span><span class="c1">// 输出: Sum: 8</span>
<a id="__codelineno-201-27" name="__codelineno-201-27"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Product:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Product: 15</span>
<a id="__codelineno-201-28" name="__codelineno-201-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-202-1">1</a></span>
<span class="normal"><a href="#__codelineno-202-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-202-1" name="__codelineno-202-1"></a>Sum: 8
<a id="__codelineno-202-2" name="__codelineno-202-2"></a>Product: 15
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>operation</code>是一个函数类型，接受两个整数并返回一个整数。</li>
<li><code>compute</code>函数接受两个整数和一个<code>operation</code>类型的函数作为参数，并返回操作结果。</li>
<li><code>add</code>和<code>multiply</code>是具体的操作函数，分别实现加法和乘法。</li>
</ul>
<h4 id="将函数作为返回值">将函数作为返回值<a class="headerlink" href="#将函数作为返回值" title="Permanent link">&para;</a></h4>
<p>函数可以作为其他函数的返回值，允许动态生成函数或实现高阶函数的功能。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-203-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-203-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-203-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-203-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-203-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-203-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-203-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-203-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-203-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-203-10">10</a></span>
<span class="normal"><a href="#__codelineno-203-11">11</a></span>
<span class="normal"><a href="#__codelineno-203-12">12</a></span>
<span class="normal"><a href="#__codelineno-203-13">13</a></span>
<span class="normal"><a href="#__codelineno-203-14">14</a></span>
<span class="normal"><a href="#__codelineno-203-15">15</a></span>
<span class="normal"><a href="#__codelineno-203-16">16</a></span>
<span class="normal"><a href="#__codelineno-203-17">17</a></span>
<span class="normal"><a href="#__codelineno-203-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-203-1" name="__codelineno-203-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-203-2" name="__codelineno-203-2"></a>
<a id="__codelineno-203-3" name="__codelineno-203-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-203-4" name="__codelineno-203-4"></a>
<a id="__codelineno-203-5" name="__codelineno-203-5"></a><span class="c1">// 定义一个函数，返回一个函数，该返回函数会将输入数值加上指定的值</span>
<a id="__codelineno-203-6" name="__codelineno-203-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-203-7" name="__codelineno-203-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">y</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-203-8" name="__codelineno-203-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">y</span>
<a id="__codelineno-203-9" name="__codelineno-203-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-203-10" name="__codelineno-203-10"></a><span class="p">}</span>
<a id="__codelineno-203-11" name="__codelineno-203-11"></a>
<a id="__codelineno-203-12" name="__codelineno-203-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-203-13" name="__codelineno-203-13"></a><span class="w">    </span><span class="nx">addFive</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-203-14" name="__codelineno-203-14"></a><span class="w">    </span><span class="nx">addTen</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">adder</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-203-15" name="__codelineno-203-15"></a>
<a id="__codelineno-203-16" name="__codelineno-203-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;5 + 3 =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">addFive</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="w">  </span><span class="c1">// 输出: 5 + 3 = 8</span>
<a id="__codelineno-203-17" name="__codelineno-203-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;10 + 7 =&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">addTen</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span><span class="w">  </span><span class="c1">// 输出: 10 + 7 = 17</span>
<a id="__codelineno-203-18" name="__codelineno-203-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-204-1">1</a></span>
<span class="normal"><a href="#__codelineno-204-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-204-1" name="__codelineno-204-1"></a>5 + 3 = 8
<a id="__codelineno-204-2" name="__codelineno-204-2"></a>10 + 7 = 17
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>adder</code>函数接受一个整数<code>x</code>，并返回一个匿名函数，该匿名函数接受另一个整数<code>y</code>，返回<code>x + y</code>的结果。</li>
<li><code>addFive</code>和<code>addTen</code>分别是不同的闭包实例，绑定了不同的<code>x</code>值。</li>
</ul>
<h4 id="使用函数作为数据结构的元素">使用函数作为数据结构的元素<a class="headerlink" href="#使用函数作为数据结构的元素" title="Permanent link">&para;</a></h4>
<p>函数可以被存储在数据结构中，如切片、Map等，提供更高的灵活性和扩展性。</p>
<p><strong>示例1：将函数存储在切片中</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-205-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-205-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-205-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-205-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-205-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-205-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-205-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-205-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-205-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-205-10">10</a></span>
<span class="normal"><a href="#__codelineno-205-11">11</a></span>
<span class="normal"><a href="#__codelineno-205-12">12</a></span>
<span class="normal"><a href="#__codelineno-205-13">13</a></span>
<span class="normal"><a href="#__codelineno-205-14">14</a></span>
<span class="normal"><a href="#__codelineno-205-15">15</a></span>
<span class="normal"><a href="#__codelineno-205-16">16</a></span>
<span class="normal"><a href="#__codelineno-205-17">17</a></span>
<span class="normal"><a href="#__codelineno-205-18">18</a></span>
<span class="normal"><a href="#__codelineno-205-19">19</a></span>
<span class="normal"><a href="#__codelineno-205-20">20</a></span>
<span class="normal"><a href="#__codelineno-205-21">21</a></span>
<span class="normal"><a href="#__codelineno-205-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-205-1" name="__codelineno-205-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-205-2" name="__codelineno-205-2"></a>
<a id="__codelineno-205-3" name="__codelineno-205-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-205-4" name="__codelineno-205-4"></a>
<a id="__codelineno-205-5" name="__codelineno-205-5"></a><span class="c1">// 定义一个函数类型</span>
<a id="__codelineno-205-6" name="__codelineno-205-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">operation</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-205-7" name="__codelineno-205-7"></a>
<a id="__codelineno-205-8" name="__codelineno-205-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-9" name="__codelineno-205-9"></a><span class="w">    </span><span class="c1">// 创建一个存储函数的切片</span>
<a id="__codelineno-205-10" name="__codelineno-205-10"></a><span class="w">    </span><span class="nx">operations</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">operation</span><span class="p">{</span>
<a id="__codelineno-205-11" name="__codelineno-205-11"></a><span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-205-12" name="__codelineno-205-12"></a><span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-205-13" name="__codelineno-205-13"></a><span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-205-14" name="__codelineno-205-14"></a><span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-205-15" name="__codelineno-205-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-16" name="__codelineno-205-16"></a>
<a id="__codelineno-205-17" name="__codelineno-205-17"></a><span class="w">    </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span>
<a id="__codelineno-205-18" name="__codelineno-205-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">op</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">operations</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-19" name="__codelineno-205-19"></a><span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">op</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-205-20" name="__codelineno-205-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<a id="__codelineno-205-21" name="__codelineno-205-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-22" name="__codelineno-205-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-206-1">1</a></span>
<span class="normal"><a href="#__codelineno-206-2">2</a></span>
<span class="normal"><a href="#__codelineno-206-3">3</a></span>
<span class="normal"><a href="#__codelineno-206-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-206-1" name="__codelineno-206-1"></a>25
<a id="__codelineno-206-2" name="__codelineno-206-2"></a>15
<a id="__codelineno-206-3" name="__codelineno-206-3"></a>100
<a id="__codelineno-206-4" name="__codelineno-206-4"></a>4
</code></pre></div></td></tr></table></div>
<p><strong>示例2：将函数存储在Map中</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-207-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-207-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-207-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-207-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-207-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-207-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-207-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-207-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-207-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-207-10">10</a></span>
<span class="normal"><a href="#__codelineno-207-11">11</a></span>
<span class="normal"><a href="#__codelineno-207-12">12</a></span>
<span class="normal"><a href="#__codelineno-207-13">13</a></span>
<span class="normal"><a href="#__codelineno-207-14">14</a></span>
<span class="normal"><a href="#__codelineno-207-15">15</a></span>
<span class="normal"><a href="#__codelineno-207-16">16</a></span>
<span class="normal"><a href="#__codelineno-207-17">17</a></span>
<span class="normal"><a href="#__codelineno-207-18">18</a></span>
<span class="normal"><a href="#__codelineno-207-19">19</a></span>
<span class="normal"><a href="#__codelineno-207-20">20</a></span>
<span class="normal"><a href="#__codelineno-207-21">21</a></span>
<span class="normal"><a href="#__codelineno-207-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-207-1" name="__codelineno-207-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-207-2" name="__codelineno-207-2"></a>
<a id="__codelineno-207-3" name="__codelineno-207-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-207-4" name="__codelineno-207-4"></a>
<a id="__codelineno-207-5" name="__codelineno-207-5"></a><span class="c1">// 定义一个函数类型</span>
<a id="__codelineno-207-6" name="__codelineno-207-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">operation</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-207-7" name="__codelineno-207-7"></a>
<a id="__codelineno-207-8" name="__codelineno-207-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-207-9" name="__codelineno-207-9"></a><span class="w">    </span><span class="c1">// 创建一个存储函数的Map</span>
<a id="__codelineno-207-10" name="__codelineno-207-10"></a><span class="w">    </span><span class="nx">operations</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">operation</span><span class="p">{</span>
<a id="__codelineno-207-11" name="__codelineno-207-11"></a><span class="w">        </span><span class="s">&quot;add&quot;</span><span class="p">:</span><span class="w">      </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-207-12" name="__codelineno-207-12"></a><span class="w">        </span><span class="s">&quot;subtract&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-207-13" name="__codelineno-207-13"></a><span class="w">        </span><span class="s">&quot;multiply&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-207-14" name="__codelineno-207-14"></a><span class="w">        </span><span class="s">&quot;divide&quot;</span><span class="p">:</span><span class="w">   </span><span class="kd">func</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-207-15" name="__codelineno-207-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-207-16" name="__codelineno-207-16"></a>
<a id="__codelineno-207-17" name="__codelineno-207-17"></a><span class="w">    </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-207-18" name="__codelineno-207-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">op</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">operations</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-207-19" name="__codelineno-207-19"></a><span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">op</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-207-20" name="__codelineno-207-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<a id="__codelineno-207-21" name="__codelineno-207-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-207-22" name="__codelineno-207-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-208-1">1</a></span>
<span class="normal"><a href="#__codelineno-208-2">2</a></span>
<span class="normal"><a href="#__codelineno-208-3">3</a></span>
<span class="normal"><a href="#__codelineno-208-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-208-1" name="__codelineno-208-1"></a>add: 18
<a id="__codelineno-208-2" name="__codelineno-208-2"></a>subtract: 12
<a id="__codelineno-208-3" name="__codelineno-208-3"></a>multiply: 45
<a id="__codelineno-208-4" name="__codelineno-208-4"></a>divide: 5
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>在第一个示例中，函数被存储在切片中，可以通过索引访问和调用。</li>
<li>在第二个示例中，函数被存储在Map中，通过键名访问和调用，提供更具语义化的调用方式。</li>
</ul>
<h4 id="函数作为接口的实现">函数作为接口的实现<a class="headerlink" href="#函数作为接口的实现" title="Permanent link">&para;</a></h4>
<p>Go语言中的接口类型可以包含函数类型，使得接口的实现更加灵活。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-209-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-209-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-209-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-209-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-209-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-209-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-209-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-209-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-209-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-209-10">10</a></span>
<span class="normal"><a href="#__codelineno-209-11">11</a></span>
<span class="normal"><a href="#__codelineno-209-12">12</a></span>
<span class="normal"><a href="#__codelineno-209-13">13</a></span>
<span class="normal"><a href="#__codelineno-209-14">14</a></span>
<span class="normal"><a href="#__codelineno-209-15">15</a></span>
<span class="normal"><a href="#__codelineno-209-16">16</a></span>
<span class="normal"><a href="#__codelineno-209-17">17</a></span>
<span class="normal"><a href="#__codelineno-209-18">18</a></span>
<span class="normal"><a href="#__codelineno-209-19">19</a></span>
<span class="normal"><a href="#__codelineno-209-20">20</a></span>
<span class="normal"><a href="#__codelineno-209-21">21</a></span>
<span class="normal"><a href="#__codelineno-209-22">22</a></span>
<span class="normal"><a href="#__codelineno-209-23">23</a></span>
<span class="normal"><a href="#__codelineno-209-24">24</a></span>
<span class="normal"><a href="#__codelineno-209-25">25</a></span>
<span class="normal"><a href="#__codelineno-209-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-209-1" name="__codelineno-209-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-209-2" name="__codelineno-209-2"></a>
<a id="__codelineno-209-3" name="__codelineno-209-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-209-4" name="__codelineno-209-4"></a>
<a id="__codelineno-209-5" name="__codelineno-209-5"></a><span class="c1">// 定义一个接口，包含一个函数方法</span>
<a id="__codelineno-209-6" name="__codelineno-209-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Greeter</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-7" name="__codelineno-209-7"></a><span class="w">    </span><span class="nx">Greet</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-209-8" name="__codelineno-209-8"></a><span class="p">}</span>
<a id="__codelineno-209-9" name="__codelineno-209-9"></a>
<a id="__codelineno-209-10" name="__codelineno-209-10"></a><span class="c1">// 定义一个结构体，实现Greeter接口</span>
<a id="__codelineno-209-11" name="__codelineno-209-11"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-12" name="__codelineno-209-12"></a><span class="w">    </span><span class="nx">greeting</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-209-13" name="__codelineno-209-13"></a><span class="p">}</span>
<a id="__codelineno-209-14" name="__codelineno-209-14"></a>
<a id="__codelineno-209-15" name="__codelineno-209-15"></a><span class="c1">// 实现Greet方法</span>
<a id="__codelineno-209-16" name="__codelineno-209-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">Greet</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-17" name="__codelineno-209-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s, %s!&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">greeting</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span>
<a id="__codelineno-209-18" name="__codelineno-209-18"></a><span class="p">}</span>
<a id="__codelineno-209-19" name="__codelineno-209-19"></a>
<a id="__codelineno-209-20" name="__codelineno-209-20"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-21" name="__codelineno-209-21"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">greeter</span><span class="w"> </span><span class="nx">Greeter</span>
<a id="__codelineno-209-22" name="__codelineno-209-22"></a><span class="w">    </span><span class="nx">greeter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">greeting</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">}</span>
<a id="__codelineno-209-23" name="__codelineno-209-23"></a>
<a id="__codelineno-209-24" name="__codelineno-209-24"></a><span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">greeter</span><span class="p">.</span><span class="nx">Greet</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">)</span>
<a id="__codelineno-209-25" name="__codelineno-209-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Hello, Alice!</span>
<a id="__codelineno-209-26" name="__codelineno-209-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-210-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-210-1" name="__codelineno-210-1"></a>Hello, Alice!
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Greeter</code>接口定义了一个<code>Greet</code>方法。</li>
<li><code>Person</code>结构体实现了<code>Greet</code>方法，从而满足<code>Greeter</code>接口。</li>
<li>通过接口类型变量<code>greeter</code>可以调用具体实现的<code>Greet</code>方法。</li>
</ul>
<h2 id="6-go-的内置库">6. Go 的内置库<a class="headerlink" href="#6-go-的内置库" title="Permanent link">&para;</a></h2>
<p>Go语言的标准库（Standard Library）是其一大优势，提供了丰富的功能模块，涵盖了从基本输入输出到复杂的网络编程等各个方面。这些内置库不仅功能强大，而且经过优化，性能优异。本章将详细介绍几个常用的内置库，包括<code>fmt</code>、<code>math</code>、<code>time</code>、<code>strings</code>以及<code>io</code>和<code>os</code>包。每个包将通过具体的示例和详细的解释，帮助你深入理解其用法和注意事项。</p>
<h3 id="61-fmt-包">6.1 <code>fmt</code> 包<a class="headerlink" href="#61-fmt-包" title="Permanent link">&para;</a></h3>
<p><code>fmt</code>包是Go语言中用于格式化输入和输出的标准库，提供了多种格式化的函数，类似于C语言中的<code>printf</code>和<code>scanf</code>。</p>
<h4 id="常用函数">常用函数<a class="headerlink" href="#常用函数" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>Print</code>系列函数</strong>：</li>
<li><code>fmt.Print()</code>: 直接输出到标准输出，不带任何格式。</li>
<li><code>fmt.Println()</code>: 输出并在末尾添加换行符。</li>
<li><code>fmt.Printf()</code>: 根据格式化字符串输出。</li>
<li><strong><code>Scan</code>系列函数</strong>：</li>
<li><code>fmt.Scan()</code>: 从标准输入中读取数据。</li>
<li><code>fmt.Scanln()</code>: 从标准输入中读取数据，直到换行。</li>
<li><code>fmt.Scanf()</code>: 根据格式化字符串读取输入。</li>
</ul>
<h4 id="示例与用法">示例与用法<a class="headerlink" href="#示例与用法" title="Permanent link">&para;</a></h4>
<p><strong>1. 基本输出</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-211-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-211-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-211-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-211-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-211-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-211-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-211-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-211-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-211-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-211-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-211-1" name="__codelineno-211-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-211-2" name="__codelineno-211-2"></a>
<a id="__codelineno-211-3" name="__codelineno-211-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-211-4" name="__codelineno-211-4"></a>
<a id="__codelineno-211-5" name="__codelineno-211-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-211-6" name="__codelineno-211-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span>
<a id="__codelineno-211-7" name="__codelineno-211-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-211-8" name="__codelineno-211-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;Name: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;, Age: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">)</span>
<a id="__codelineno-211-9" name="__codelineno-211-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">()</span><span class="w"> </span><span class="c1">// 输出: Name: Alice, Age: 30</span>
<a id="__codelineno-211-10" name="__codelineno-211-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 带换行输出</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-212-1">1</a></span>
<span class="normal"><a href="#__codelineno-212-2">2</a></span>
<span class="normal"><a href="#__codelineno-212-3">3</a></span>
<span class="normal"><a href="#__codelineno-212-4">4</a></span>
<span class="normal"><a href="#__codelineno-212-5">5</a></span>
<span class="normal"><a href="#__codelineno-212-6">6</a></span>
<span class="normal"><a href="#__codelineno-212-7">7</a></span>
<span class="normal"><a href="#__codelineno-212-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-212-1" name="__codelineno-212-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-212-2" name="__codelineno-212-2"></a>
<a id="__codelineno-212-3" name="__codelineno-212-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-212-4" name="__codelineno-212-4"></a>
<a id="__codelineno-212-5" name="__codelineno-212-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-212-6" name="__codelineno-212-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-212-7" name="__codelineno-212-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Go语言真有趣！&quot;</span><span class="p">)</span>
<a id="__codelineno-212-8" name="__codelineno-212-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-213-1">1</a></span>
<span class="normal"><a href="#__codelineno-213-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-213-1" name="__codelineno-213-1"></a>Hello, World!
<a id="__codelineno-213-2" name="__codelineno-213-2"></a>Go语言真有趣！
</code></pre></div></td></tr></table></div>
<p><strong>3. 格式化输出</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-214-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-214-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-214-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-214-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-214-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-214-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-214-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-214-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-214-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-214-10">10</a></span>
<span class="normal"><a href="#__codelineno-214-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-214-1" name="__codelineno-214-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-214-2" name="__codelineno-214-2"></a>
<a id="__codelineno-214-3" name="__codelineno-214-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-214-4" name="__codelineno-214-4"></a>
<a id="__codelineno-214-5" name="__codelineno-214-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-214-6" name="__codelineno-214-6"></a><span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span>
<a id="__codelineno-214-7" name="__codelineno-214-7"></a><span class="w">    </span><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">25</span>
<a id="__codelineno-214-8" name="__codelineno-214-8"></a><span class="w">    </span><span class="nx">height</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">175.5</span>
<a id="__codelineno-214-9" name="__codelineno-214-9"></a>
<a id="__codelineno-214-10" name="__codelineno-214-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Name: %s, Age: %d, Height: %.1f cm\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">)</span>
<a id="__codelineno-214-11" name="__codelineno-214-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-215-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-215-1" name="__codelineno-215-1"></a>Name: Bob, Age: 25, Height: 175.5 cm
</code></pre></div></td></tr></table></div>
<p><strong>4. 读取输入</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-216-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-216-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-216-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-216-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-216-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-216-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-216-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-216-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-216-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-216-10">10</a></span>
<span class="normal"><a href="#__codelineno-216-11">11</a></span>
<span class="normal"><a href="#__codelineno-216-12">12</a></span>
<span class="normal"><a href="#__codelineno-216-13">13</a></span>
<span class="normal"><a href="#__codelineno-216-14">14</a></span>
<span class="normal"><a href="#__codelineno-216-15">15</a></span>
<span class="normal"><a href="#__codelineno-216-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-216-1" name="__codelineno-216-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-216-2" name="__codelineno-216-2"></a>
<a id="__codelineno-216-3" name="__codelineno-216-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-216-4" name="__codelineno-216-4"></a>
<a id="__codelineno-216-5" name="__codelineno-216-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-216-6" name="__codelineno-216-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-216-7" name="__codelineno-216-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-216-8" name="__codelineno-216-8"></a>
<a id="__codelineno-216-9" name="__codelineno-216-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;请输入你的名字: &quot;</span><span class="p">)</span>
<a id="__codelineno-216-10" name="__codelineno-216-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">name</span><span class="p">)</span>
<a id="__codelineno-216-11" name="__codelineno-216-11"></a>
<a id="__codelineno-216-12" name="__codelineno-216-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;请输入你的年龄: &quot;</span><span class="p">)</span>
<a id="__codelineno-216-13" name="__codelineno-216-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">age</span><span class="p">)</span>
<a id="__codelineno-216-14" name="__codelineno-216-14"></a>
<a id="__codelineno-216-15" name="__codelineno-216-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;你好，%s！你 %d 岁。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">)</span>
<a id="__codelineno-216-16" name="__codelineno-216-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-217-1">1</a></span>
<span class="normal"><a href="#__codelineno-217-2">2</a></span>
<span class="normal"><a href="#__codelineno-217-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-217-1" name="__codelineno-217-1"></a>请输入你的名字: Charlie
<a id="__codelineno-217-2" name="__codelineno-217-2"></a>请输入你的年龄: 28
<a id="__codelineno-217-3" name="__codelineno-217-3"></a>你好，Charlie！你 28 岁。
</code></pre></div></td></tr></table></div>
<p><strong>5. 使用<code>fmt.Sprintf</code></strong></p>
<p><code>fmt.Sprintf</code>函数用于格式化字符串并返回结果，而不是直接输出。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-218-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-218-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-218-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-218-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-218-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-218-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-218-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-218-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-218-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-218-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-218-1" name="__codelineno-218-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-218-2" name="__codelineno-218-2"></a>
<a id="__codelineno-218-3" name="__codelineno-218-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-218-4" name="__codelineno-218-4"></a>
<a id="__codelineno-218-5" name="__codelineno-218-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-218-6" name="__codelineno-218-6"></a><span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span>
<a id="__codelineno-218-7" name="__codelineno-218-7"></a><span class="w">    </span><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">22</span>
<a id="__codelineno-218-8" name="__codelineno-218-8"></a><span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Name: %s, Age: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">)</span>
<a id="__codelineno-218-9" name="__codelineno-218-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-218-10" name="__codelineno-218-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-219-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-219-1" name="__codelineno-219-1"></a>Name: Diana, Age: 22
</code></pre></div></td></tr></table></div>
<h4 id="注意事项">注意事项<a class="headerlink" href="#注意事项" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>占位符类型匹配</strong>：确保<code>fmt.Printf</code>等函数中的占位符类型与传递的参数类型匹配，否则可能导致格式化错误或意外输出。</li>
</ul>
<p><strong>示例错误：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-220-1">1</a></span>
<span class="normal"><a href="#__codelineno-220-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-220-1" name="__codelineno-220-1"></a><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-220-2" name="__codelineno-220-2"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Age: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">)</span><span class="w"> </span><span class="c1">// 错误：%s用于字符串，age是int</span>
</code></pre></div></td></tr></table></div>
<p><strong>正确用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-221-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-221-1" name="__codelineno-221-1"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Age: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>引用变量</strong>：在<code>fmt.Scan</code>系列函数中，必须传递变量的地址（使用<code>&amp;</code>符号），否则会导致编译错误。</li>
</ul>
<p><strong>错误示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-222-1">1</a></span>
<span class="normal"><a href="#__codelineno-222-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-222-1" name="__codelineno-222-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">age</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-222-2" name="__codelineno-222-2"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="nx">age</span><span class="p">)</span><span class="w"> </span><span class="c1">// 错误：需要传递变量的地址</span>
</code></pre></div></td></tr></table></div>
<p><strong>正确示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-223-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-223-1" name="__codelineno-223-1"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">age</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>缓冲问题</strong>：在使用<code>fmt.Scan</code>系列函数时，输入缓冲可能导致意外行为，特别是在混合使用<code>Scan</code>和<code>Scanln</code>时。建议统一使用一种扫描方法，并在需要时清理缓冲区。</li>
</ul>
<h3 id="62-math-包">6.2 <code>math</code> 包<a class="headerlink" href="#62-math-包" title="Permanent link">&para;</a></h3>
<p><code>math</code>包提供了基本的数学常数和数学函数，支持浮点数运算。它包含了大量的数学函数，如三角函数、指数函数、对数函数等。</p>
<h4 id="常用常数">常用常数<a class="headerlink" href="#常用常数" title="Permanent link">&para;</a></h4>
<ul>
<li><code>math.Pi</code>: 圆周率π，值为3.14159265358979323846。</li>
<li><code>math.E</code>: 自然常数e，值为2.71828182845904523536。</li>
<li><code>math.MaxFloat64</code>: 最大的float64值。</li>
</ul>
<h4 id="常用函数_1">常用函数<a class="headerlink" href="#常用函数_1" title="Permanent link">&para;</a></h4>
<ul>
<li>指数与对数</li>
</ul>
<p>：</p>
<ul>
<li><code>math.Pow(x, y)</code>: 计算x的y次幂。</li>
<li><code>math.Sqrt(x)</code>: 计算x的平方根。</li>
<li><code>math.Log(x)</code>: 计算x的自然对数（以e为底）。</li>
<li>
<p><code>math.Log10(x)</code>: 计算x的以10为底的对数。</p>
</li>
<li>
<p>三角函数</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>math.Sin(x)</code>: 计算x的正弦值。</li>
<li><code>math.Cos(x)</code>: 计算x的余弦值。</li>
<li><code>math.Tan(x)</code>: 计算x的正切值。</li>
<li>
<p><code>math.Asin(x)</code>, <code>math.Acos(x)</code>, <code>math.Atan(x)</code>: 反三角函数。</p>
</li>
<li>
<p>舍入与取整</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>math.Floor(x)</code>: 向下取整。</li>
<li><code>math.Ceil(x)</code>: 向上取整。</li>
<li>
<p><code>math.Round(x)</code>: 四舍五入。</p>
</li>
<li>
<p>绝对值</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p><code>math.Abs(x)</code>: 计算x的绝对值。</p>
</li>
<li>
<p>最值</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>math.Max(x, y)</code>: 返回x和y中的较大值。</li>
<li><code>math.Min(x, y)</code>: 返回x和y中的较小值。</li>
</ul>
<h4 id="示例与用法_1">示例与用法<a class="headerlink" href="#示例与用法_1" title="Permanent link">&para;</a></h4>
<p><strong>1. 计算幂和平方根</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-224-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-224-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-224-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-224-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-224-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-224-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-224-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-224-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-224-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-224-10">10</a></span>
<span class="normal"><a href="#__codelineno-224-11">11</a></span>
<span class="normal"><a href="#__codelineno-224-12">12</a></span>
<span class="normal"><a href="#__codelineno-224-13">13</a></span>
<span class="normal"><a href="#__codelineno-224-14">14</a></span>
<span class="normal"><a href="#__codelineno-224-15">15</a></span>
<span class="normal"><a href="#__codelineno-224-16">16</a></span>
<span class="normal"><a href="#__codelineno-224-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-224-1" name="__codelineno-224-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-224-2" name="__codelineno-224-2"></a>
<a id="__codelineno-224-3" name="__codelineno-224-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-224-4" name="__codelineno-224-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-224-5" name="__codelineno-224-5"></a><span class="w">    </span><span class="s">&quot;math&quot;</span>
<a id="__codelineno-224-6" name="__codelineno-224-6"></a><span class="p">)</span>
<a id="__codelineno-224-7" name="__codelineno-224-7"></a>
<a id="__codelineno-224-8" name="__codelineno-224-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-224-9" name="__codelineno-224-9"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">2.0</span>
<a id="__codelineno-224-10" name="__codelineno-224-10"></a><span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">3.0</span>
<a id="__codelineno-224-11" name="__codelineno-224-11"></a>
<a id="__codelineno-224-12" name="__codelineno-224-12"></a><span class="w">    </span><span class="nx">power</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Pow</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<a id="__codelineno-224-13" name="__codelineno-224-13"></a><span class="w">    </span><span class="nx">sqrt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Sqrt</span><span class="p">(</span><span class="mf">16.0</span><span class="p">)</span>
<a id="__codelineno-224-14" name="__codelineno-224-14"></a>
<a id="__codelineno-224-15" name="__codelineno-224-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%.1f 的 %.1f 次幂是 %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">power</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 2.0 的 3.0 次幂是 8.0</span>
<a id="__codelineno-224-16" name="__codelineno-224-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;16 的平方根是 %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sqrt</span><span class="p">)</span><span class="w">               </span><span class="c1">// 输出: 16 的平方根是 4.0</span>
<a id="__codelineno-224-17" name="__codelineno-224-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 计算对数和指数</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-225-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-225-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-225-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-225-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-225-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-225-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-225-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-225-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-225-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-225-10">10</a></span>
<span class="normal"><a href="#__codelineno-225-11">11</a></span>
<span class="normal"><a href="#__codelineno-225-12">12</a></span>
<span class="normal"><a href="#__codelineno-225-13">13</a></span>
<span class="normal"><a href="#__codelineno-225-14">14</a></span>
<span class="normal"><a href="#__codelineno-225-15">15</a></span>
<span class="normal"><a href="#__codelineno-225-16">16</a></span>
<span class="normal"><a href="#__codelineno-225-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-225-1" name="__codelineno-225-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-225-2" name="__codelineno-225-2"></a>
<a id="__codelineno-225-3" name="__codelineno-225-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-225-4" name="__codelineno-225-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-225-5" name="__codelineno-225-5"></a><span class="w">    </span><span class="s">&quot;math&quot;</span>
<a id="__codelineno-225-6" name="__codelineno-225-6"></a><span class="p">)</span>
<a id="__codelineno-225-7" name="__codelineno-225-7"></a>
<a id="__codelineno-225-8" name="__codelineno-225-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-225-9" name="__codelineno-225-9"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">10.0</span>
<a id="__codelineno-225-10" name="__codelineno-225-10"></a><span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Log</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w">       </span><span class="c1">// 自然对数</span>
<a id="__codelineno-225-11" name="__codelineno-225-11"></a><span class="w">    </span><span class="nx">log10</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Log10</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w">   </span><span class="c1">// 以10为底的对数</span>
<a id="__codelineno-225-12" name="__codelineno-225-12"></a><span class="w">    </span><span class="nx">exp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Exp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="w">     </span><span class="c1">// e的1次幂</span>
<a id="__codelineno-225-13" name="__codelineno-225-13"></a>
<a id="__codelineno-225-14" name="__codelineno-225-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;自然对数 ln(%.1f) = %.4f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">)</span><span class="w">   </span><span class="c1">// 输出: 自然对数 ln(10.0) = 2.3026</span>
<a id="__codelineno-225-15" name="__codelineno-225-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;以10为底的对数 log10(%.1f) = %.4f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">log10</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 以10为底的对数 log10(10.0) = 1.0000</span>
<a id="__codelineno-225-16" name="__codelineno-225-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;e 的 1 次幂是 %.4f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">exp</span><span class="p">)</span><span class="w">               </span><span class="c1">// 输出: e 的 1 次幂是 2.7183</span>
<a id="__codelineno-225-17" name="__codelineno-225-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 使用三角函数</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-226-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-226-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-226-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-226-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-226-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-226-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-226-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-226-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-226-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-226-10">10</a></span>
<span class="normal"><a href="#__codelineno-226-11">11</a></span>
<span class="normal"><a href="#__codelineno-226-12">12</a></span>
<span class="normal"><a href="#__codelineno-226-13">13</a></span>
<span class="normal"><a href="#__codelineno-226-14">14</a></span>
<span class="normal"><a href="#__codelineno-226-15">15</a></span>
<span class="normal"><a href="#__codelineno-226-16">16</a></span>
<span class="normal"><a href="#__codelineno-226-17">17</a></span>
<span class="normal"><a href="#__codelineno-226-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-226-1" name="__codelineno-226-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-226-2" name="__codelineno-226-2"></a>
<a id="__codelineno-226-3" name="__codelineno-226-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-226-4" name="__codelineno-226-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-226-5" name="__codelineno-226-5"></a><span class="w">    </span><span class="s">&quot;math&quot;</span>
<a id="__codelineno-226-6" name="__codelineno-226-6"></a><span class="p">)</span>
<a id="__codelineno-226-7" name="__codelineno-226-7"></a>
<a id="__codelineno-226-8" name="__codelineno-226-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-226-9" name="__codelineno-226-9"></a><span class="w">    </span><span class="nx">angle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Pi</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="c1">// 45度</span>
<a id="__codelineno-226-10" name="__codelineno-226-10"></a>
<a id="__codelineno-226-11" name="__codelineno-226-11"></a><span class="w">    </span><span class="nx">sin</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
<a id="__codelineno-226-12" name="__codelineno-226-12"></a><span class="w">    </span><span class="nx">cos</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
<a id="__codelineno-226-13" name="__codelineno-226-13"></a><span class="w">    </span><span class="nx">tan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Tan</span><span class="p">(</span><span class="nx">angle</span><span class="p">)</span>
<a id="__codelineno-226-14" name="__codelineno-226-14"></a>
<a id="__codelineno-226-15" name="__codelineno-226-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;sin(45°) = %.4f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sin</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: sin(45°) = 0.7071</span>
<a id="__codelineno-226-16" name="__codelineno-226-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;cos(45°) = %.4f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">cos</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: cos(45°) = 0.7071</span>
<a id="__codelineno-226-17" name="__codelineno-226-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;tan(45°) = %.4f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tan</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: tan(45°) = 1.0000</span>
<a id="__codelineno-226-18" name="__codelineno-226-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 舍入与取整</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-227-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-227-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-227-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-227-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-227-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-227-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-227-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-227-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-227-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-227-10">10</a></span>
<span class="normal"><a href="#__codelineno-227-11">11</a></span>
<span class="normal"><a href="#__codelineno-227-12">12</a></span>
<span class="normal"><a href="#__codelineno-227-13">13</a></span>
<span class="normal"><a href="#__codelineno-227-14">14</a></span>
<span class="normal"><a href="#__codelineno-227-15">15</a></span>
<span class="normal"><a href="#__codelineno-227-16">16</a></span>
<span class="normal"><a href="#__codelineno-227-17">17</a></span>
<span class="normal"><a href="#__codelineno-227-18">18</a></span>
<span class="normal"><a href="#__codelineno-227-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-227-1" name="__codelineno-227-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-227-2" name="__codelineno-227-2"></a>
<a id="__codelineno-227-3" name="__codelineno-227-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-227-4" name="__codelineno-227-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-227-5" name="__codelineno-227-5"></a><span class="w">    </span><span class="s">&quot;math&quot;</span>
<a id="__codelineno-227-6" name="__codelineno-227-6"></a><span class="p">)</span>
<a id="__codelineno-227-7" name="__codelineno-227-7"></a>
<a id="__codelineno-227-8" name="__codelineno-227-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-227-9" name="__codelineno-227-9"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">3.7</span>
<a id="__codelineno-227-10" name="__codelineno-227-10"></a><span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">3.2</span>
<a id="__codelineno-227-11" name="__codelineno-227-11"></a>
<a id="__codelineno-227-12" name="__codelineno-227-12"></a><span class="w">    </span><span class="nx">floorX</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Floor</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-227-13" name="__codelineno-227-13"></a><span class="w">    </span><span class="nx">ceilY</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Ceil</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
<a id="__codelineno-227-14" name="__codelineno-227-14"></a><span class="w">    </span><span class="nx">roundX</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Round</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-227-15" name="__codelineno-227-15"></a>
<a id="__codelineno-227-16" name="__codelineno-227-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Floor(%.1f) = %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">floorX</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Floor(3.7) = 3.0</span>
<a id="__codelineno-227-17" name="__codelineno-227-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Ceil(%.1f) = %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">ceilY</span><span class="p">)</span><span class="w">   </span><span class="c1">// 输出: Ceil(3.2) = 4.0</span>
<a id="__codelineno-227-18" name="__codelineno-227-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Round(%.1f) = %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">roundX</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Round(3.7) = 4.0</span>
<a id="__codelineno-227-19" name="__codelineno-227-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>5. 计算绝对值和最值</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-228-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-228-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-228-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-228-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-228-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-228-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-228-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-228-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-228-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-228-10">10</a></span>
<span class="normal"><a href="#__codelineno-228-11">11</a></span>
<span class="normal"><a href="#__codelineno-228-12">12</a></span>
<span class="normal"><a href="#__codelineno-228-13">13</a></span>
<span class="normal"><a href="#__codelineno-228-14">14</a></span>
<span class="normal"><a href="#__codelineno-228-15">15</a></span>
<span class="normal"><a href="#__codelineno-228-16">16</a></span>
<span class="normal"><a href="#__codelineno-228-17">17</a></span>
<span class="normal"><a href="#__codelineno-228-18">18</a></span>
<span class="normal"><a href="#__codelineno-228-19">19</a></span>
<span class="normal"><a href="#__codelineno-228-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-228-1" name="__codelineno-228-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-228-2" name="__codelineno-228-2"></a>
<a id="__codelineno-228-3" name="__codelineno-228-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-228-4" name="__codelineno-228-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-228-5" name="__codelineno-228-5"></a><span class="w">    </span><span class="s">&quot;math&quot;</span>
<a id="__codelineno-228-6" name="__codelineno-228-6"></a><span class="p">)</span>
<a id="__codelineno-228-7" name="__codelineno-228-7"></a>
<a id="__codelineno-228-8" name="__codelineno-228-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-228-9" name="__codelineno-228-9"></a><span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">-</span><span class="mf">5.5</span>
<a id="__codelineno-228-10" name="__codelineno-228-10"></a><span class="w">    </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">10.2</span>
<a id="__codelineno-228-11" name="__codelineno-228-11"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mf">7.8</span>
<a id="__codelineno-228-12" name="__codelineno-228-12"></a>
<a id="__codelineno-228-13" name="__codelineno-228-13"></a><span class="w">    </span><span class="nx">absA</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<a id="__codelineno-228-14" name="__codelineno-228-14"></a><span class="w">    </span><span class="nx">maxVal</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">)</span>
<a id="__codelineno-228-15" name="__codelineno-228-15"></a><span class="w">    </span><span class="nx">minVal</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-228-16" name="__codelineno-228-16"></a>
<a id="__codelineno-228-17" name="__codelineno-228-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Abs(-5.5) = %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">absA</span><span class="p">)</span><span class="w">       </span><span class="c1">// 输出: Abs(-5.5) = 5.5</span>
<a id="__codelineno-228-18" name="__codelineno-228-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Max(10.2, 7.8) = %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">maxVal</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Max(10.2, 7.8) = 10.2</span>
<a id="__codelineno-228-19" name="__codelineno-228-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Min(-5.5, 10.2) = %.1f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">minVal</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Min(-5.5, 10.2) = -5.5</span>
<a id="__codelineno-228-20" name="__codelineno-228-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_1">注意事项<a class="headerlink" href="#注意事项_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>参数类型</strong>：<code>math</code>包中的函数通常接受和返回<code>float64</code>类型，使用时需确保参数类型匹配。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-229-1">1</a></span>
<span class="normal"><a href="#__codelineno-229-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-229-1" name="__codelineno-229-1"></a><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="c1">// int类型</span>
<a id="__codelineno-229-2" name="__codelineno-229-2"></a><span class="nx">sqrt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Sqrt</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span><span class="w"> </span><span class="c1">// 转换为float64</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>错误处理</strong>：某些函数在输入不合法时会返回特殊值（如NaN或Inf），需要进行错误检查。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-230-1">1</a></span>
<span class="normal"><a href="#__codelineno-230-2">2</a></span>
<span class="normal"><a href="#__codelineno-230-3">3</a></span>
<span class="normal"><a href="#__codelineno-230-4">4</a></span>
<span class="normal"><a href="#__codelineno-230-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-230-1" name="__codelineno-230-1"></a><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-230-2" name="__codelineno-230-2"></a><span class="nx">sqrt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">Sqrt</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-230-3" name="__codelineno-230-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">math</span><span class="p">.</span><span class="nx">IsNaN</span><span class="p">(</span><span class="nx">sqrt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-230-4" name="__codelineno-230-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;无法计算负数的平方根&quot;</span><span class="p">)</span>
<a id="__codelineno-230-5" name="__codelineno-230-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="63-time-包">6.3 <code>time</code> 包<a class="headerlink" href="#63-time-包" title="Permanent link">&para;</a></h3>
<p><code>time</code>包提供了时间和日期的功能，包括获取当前时间、格式化时间、计时器、定时任务等。它在处理时间相关的任务时非常有用。</p>
<h4 id="常用功能">常用功能<a class="headerlink" href="#常用功能" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>获取当前时间</strong>：</li>
<li><code>time.Now()</code>: 返回当前本地时间。</li>
<li><strong>时间格式化与解析</strong>：</li>
<li><code>time.Format(layout string)</code>: 根据指定的布局格式化时间。</li>
<li><code>time.Parse(layout, value string) (Time, error)</code>: 解析字符串为时间。</li>
<li><strong>时间比较</strong>：</li>
<li><code>t1.Before(t2)</code>, <code>t1.After(t2)</code>, <code>t1.Equal(t2)</code>: 比较两个时间的先后。</li>
<li><strong>时间运算</strong>：</li>
<li><code>t.Add(d Duration)</code>: 添加时间间隔。</li>
<li><code>t.Sub(u Time)</code>: 计算两个时间之间的差值。</li>
<li><strong>定时器与计时器</strong>：</li>
<li><code>time.Sleep(d Duration)</code>: 暂停当前goroutine指定的时间。</li>
<li><code>time.Tick(d Duration)</code>: 返回一个channel，每隔指定时间发送当前时间。</li>
<li><code>time.NewTimer(d Duration)</code>, <code>time.NewTicker(d Duration)</code>: 创建定时器和计时器。</li>
</ul>
<h4 id="时间格式化布局">时间格式化布局<a class="headerlink" href="#时间格式化布局" title="Permanent link">&para;</a></h4>
<p>Go使用一个特殊的时间布局来定义时间格式，布局使用参考时间<code>Mon Jan 2 15:04:05 MST 2006</code>中的数值。</p>
<p><strong>常见布局示例</strong>：</p>
<ul>
<li><code>"2006-01-02"</code>: 年-月-日</li>
<li><code>"02/01/2006"</code>: 日/月/年</li>
<li><code>"15:04:05"</code>: 时:分:秒（24小时制）</li>
<li><code>"03:04:05 PM"</code>: 时:分:秒（12小时制）</li>
</ul>
<h4 id="示例与用法_2">示例与用法<a class="headerlink" href="#示例与用法_2" title="Permanent link">&para;</a></h4>
<p><strong>1. 获取当前时间</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-231-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-231-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-231-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-231-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-231-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-231-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-231-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-231-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-231-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-231-10">10</a></span>
<span class="normal"><a href="#__codelineno-231-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-231-1" name="__codelineno-231-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-231-2" name="__codelineno-231-2"></a>
<a id="__codelineno-231-3" name="__codelineno-231-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-231-4" name="__codelineno-231-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-231-5" name="__codelineno-231-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-231-6" name="__codelineno-231-6"></a><span class="p">)</span>
<a id="__codelineno-231-7" name="__codelineno-231-7"></a>
<a id="__codelineno-231-8" name="__codelineno-231-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-231-9" name="__codelineno-231-9"></a><span class="w">    </span><span class="nx">currentTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<a id="__codelineno-231-10" name="__codelineno-231-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;当前时间:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">)</span>
<a id="__codelineno-231-11" name="__codelineno-231-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-232-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-232-1" name="__codelineno-232-1"></a>当前时间: 2024-04-27 14:30:45.123456789 +0800 CST m=+0.000000001
</code></pre></div></td></tr></table></div>
<p><strong>2. 时间格式化</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-233-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-233-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-233-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-233-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-233-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-233-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-233-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-233-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-233-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-233-10">10</a></span>
<span class="normal"><a href="#__codelineno-233-11">11</a></span>
<span class="normal"><a href="#__codelineno-233-12">12</a></span>
<span class="normal"><a href="#__codelineno-233-13">13</a></span>
<span class="normal"><a href="#__codelineno-233-14">14</a></span>
<span class="normal"><a href="#__codelineno-233-15">15</a></span>
<span class="normal"><a href="#__codelineno-233-16">16</a></span>
<span class="normal"><a href="#__codelineno-233-17">17</a></span>
<span class="normal"><a href="#__codelineno-233-18">18</a></span>
<span class="normal"><a href="#__codelineno-233-19">19</a></span>
<span class="normal"><a href="#__codelineno-233-20">20</a></span>
<span class="normal"><a href="#__codelineno-233-21">21</a></span>
<span class="normal"><a href="#__codelineno-233-22">22</a></span>
<span class="normal"><a href="#__codelineno-233-23">23</a></span>
<span class="normal"><a href="#__codelineno-233-24">24</a></span>
<span class="normal"><a href="#__codelineno-233-25">25</a></span>
<span class="normal"><a href="#__codelineno-233-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-233-1" name="__codelineno-233-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-233-2" name="__codelineno-233-2"></a>
<a id="__codelineno-233-3" name="__codelineno-233-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-233-4" name="__codelineno-233-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-233-5" name="__codelineno-233-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-233-6" name="__codelineno-233-6"></a><span class="p">)</span>
<a id="__codelineno-233-7" name="__codelineno-233-7"></a>
<a id="__codelineno-233-8" name="__codelineno-233-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-233-9" name="__codelineno-233-9"></a><span class="w">    </span><span class="nx">currentTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<a id="__codelineno-233-10" name="__codelineno-233-10"></a>
<a id="__codelineno-233-11" name="__codelineno-233-11"></a><span class="w">    </span><span class="c1">// 格式化为 &quot;YYYY-MM-DD&quot;</span>
<a id="__codelineno-233-12" name="__codelineno-233-12"></a><span class="w">    </span><span class="nx">formattedDate</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02&quot;</span><span class="p">)</span>
<a id="__codelineno-233-13" name="__codelineno-233-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;格式化日期:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">formattedDate</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 格式化日期: 2024-04-27</span>
<a id="__codelineno-233-14" name="__codelineno-233-14"></a>
<a id="__codelineno-233-15" name="__codelineno-233-15"></a><span class="w">    </span><span class="c1">// 格式化为 &quot;DD/MM/YYYY&quot;</span>
<a id="__codelineno-233-16" name="__codelineno-233-16"></a><span class="w">    </span><span class="nx">formattedDate2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;02/01/2006&quot;</span><span class="p">)</span>
<a id="__codelineno-233-17" name="__codelineno-233-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;格式化日期:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">formattedDate2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 格式化日期: 27/04/2024</span>
<a id="__codelineno-233-18" name="__codelineno-233-18"></a>
<a id="__codelineno-233-19" name="__codelineno-233-19"></a><span class="w">    </span><span class="c1">// 格式化为 &quot;HH:MM:SS&quot;</span>
<a id="__codelineno-233-20" name="__codelineno-233-20"></a><span class="w">    </span><span class="nx">formattedTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;15:04:05&quot;</span><span class="p">)</span>
<a id="__codelineno-233-21" name="__codelineno-233-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;格式化时间:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">formattedTime</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 格式化时间: 14:30:45</span>
<a id="__codelineno-233-22" name="__codelineno-233-22"></a>
<a id="__codelineno-233-23" name="__codelineno-233-23"></a><span class="w">    </span><span class="c1">// 格式化为 &quot;HH:MM:SS PM&quot;</span>
<a id="__codelineno-233-24" name="__codelineno-233-24"></a><span class="w">    </span><span class="nx">formattedTime2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">currentTime</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;03:04:05 PM&quot;</span><span class="p">)</span>
<a id="__codelineno-233-25" name="__codelineno-233-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;格式化时间:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">formattedTime2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 格式化时间: 02:30:45 PM</span>
<a id="__codelineno-233-26" name="__codelineno-233-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 时间解析</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-234-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-234-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-234-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-234-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-234-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-234-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-234-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-234-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-234-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-234-10">10</a></span>
<span class="normal"><a href="#__codelineno-234-11">11</a></span>
<span class="normal"><a href="#__codelineno-234-12">12</a></span>
<span class="normal"><a href="#__codelineno-234-13">13</a></span>
<span class="normal"><a href="#__codelineno-234-14">14</a></span>
<span class="normal"><a href="#__codelineno-234-15">15</a></span>
<span class="normal"><a href="#__codelineno-234-16">16</a></span>
<span class="normal"><a href="#__codelineno-234-17">17</a></span>
<span class="normal"><a href="#__codelineno-234-18">18</a></span>
<span class="normal"><a href="#__codelineno-234-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-234-1" name="__codelineno-234-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-234-2" name="__codelineno-234-2"></a>
<a id="__codelineno-234-3" name="__codelineno-234-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-234-4" name="__codelineno-234-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-234-5" name="__codelineno-234-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-234-6" name="__codelineno-234-6"></a><span class="p">)</span>
<a id="__codelineno-234-7" name="__codelineno-234-7"></a>
<a id="__codelineno-234-8" name="__codelineno-234-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-234-9" name="__codelineno-234-9"></a><span class="w">    </span><span class="nx">layout</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;2006-01-02 15:04:05&quot;</span>
<a id="__codelineno-234-10" name="__codelineno-234-10"></a><span class="w">    </span><span class="nx">str</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;2024-04-27 14:30:45&quot;</span>
<a id="__codelineno-234-11" name="__codelineno-234-11"></a>
<a id="__codelineno-234-12" name="__codelineno-234-12"></a><span class="w">    </span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">layout</span><span class="p">,</span><span class="w"> </span><span class="nx">str</span><span class="p">)</span>
<a id="__codelineno-234-13" name="__codelineno-234-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-234-14" name="__codelineno-234-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;解析时间出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-234-15" name="__codelineno-234-15"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-234-16" name="__codelineno-234-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-234-17" name="__codelineno-234-17"></a>
<a id="__codelineno-234-18" name="__codelineno-234-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;解析后的时间:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<a id="__codelineno-234-19" name="__codelineno-234-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-235-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-235-1" name="__codelineno-235-1"></a>解析后的时间: 2024-04-27 14:30:45 +0000 UTC
</code></pre></div></td></tr></table></div>
<p><strong>4. 时间比较</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-236-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-236-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-236-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-236-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-236-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-236-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-236-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-236-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-236-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-236-10">10</a></span>
<span class="normal"><a href="#__codelineno-236-11">11</a></span>
<span class="normal"><a href="#__codelineno-236-12">12</a></span>
<span class="normal"><a href="#__codelineno-236-13">13</a></span>
<span class="normal"><a href="#__codelineno-236-14">14</a></span>
<span class="normal"><a href="#__codelineno-236-15">15</a></span>
<span class="normal"><a href="#__codelineno-236-16">16</a></span>
<span class="normal"><a href="#__codelineno-236-17">17</a></span>
<span class="normal"><a href="#__codelineno-236-18">18</a></span>
<span class="normal"><a href="#__codelineno-236-19">19</a></span>
<span class="normal"><a href="#__codelineno-236-20">20</a></span>
<span class="normal"><a href="#__codelineno-236-21">21</a></span>
<span class="normal"><a href="#__codelineno-236-22">22</a></span>
<span class="normal"><a href="#__codelineno-236-23">23</a></span>
<span class="normal"><a href="#__codelineno-236-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-236-1" name="__codelineno-236-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-236-2" name="__codelineno-236-2"></a>
<a id="__codelineno-236-3" name="__codelineno-236-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-236-4" name="__codelineno-236-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-236-5" name="__codelineno-236-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-236-6" name="__codelineno-236-6"></a><span class="p">)</span>
<a id="__codelineno-236-7" name="__codelineno-236-7"></a>
<a id="__codelineno-236-8" name="__codelineno-236-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-236-9" name="__codelineno-236-9"></a><span class="w">    </span><span class="nx">t1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<a id="__codelineno-236-10" name="__codelineno-236-10"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-236-11" name="__codelineno-236-11"></a><span class="w">    </span><span class="nx">t2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<a id="__codelineno-236-12" name="__codelineno-236-12"></a>
<a id="__codelineno-236-13" name="__codelineno-236-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">t1</span><span class="p">.</span><span class="nx">Before</span><span class="p">(</span><span class="nx">t2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-236-14" name="__codelineno-236-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;t1 在 t2 之前&quot;</span><span class="p">)</span>
<a id="__codelineno-236-15" name="__codelineno-236-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-236-16" name="__codelineno-236-16"></a>
<a id="__codelineno-236-17" name="__codelineno-236-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">t2</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="nx">t1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-236-18" name="__codelineno-236-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;t2 在 t1 之后&quot;</span><span class="p">)</span>
<a id="__codelineno-236-19" name="__codelineno-236-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-236-20" name="__codelineno-236-20"></a>
<a id="__codelineno-236-21" name="__codelineno-236-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">t1</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-236-22" name="__codelineno-236-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;t1 和 t1 相等&quot;</span><span class="p">)</span>
<a id="__codelineno-236-23" name="__codelineno-236-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-236-24" name="__codelineno-236-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-237-1">1</a></span>
<span class="normal"><a href="#__codelineno-237-2">2</a></span>
<span class="normal"><a href="#__codelineno-237-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-237-1" name="__codelineno-237-1"></a>t1 在 t2 之前
<a id="__codelineno-237-2" name="__codelineno-237-2"></a>t2 在 t1 之后
<a id="__codelineno-237-3" name="__codelineno-237-3"></a>t1 和 t1 相等
</code></pre></div></td></tr></table></div>
<p><strong>5. 时间运算</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-238-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-238-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-238-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-238-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-238-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-238-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-238-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-238-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-238-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-238-10">10</a></span>
<span class="normal"><a href="#__codelineno-238-11">11</a></span>
<span class="normal"><a href="#__codelineno-238-12">12</a></span>
<span class="normal"><a href="#__codelineno-238-13">13</a></span>
<span class="normal"><a href="#__codelineno-238-14">14</a></span>
<span class="normal"><a href="#__codelineno-238-15">15</a></span>
<span class="normal"><a href="#__codelineno-238-16">16</a></span>
<span class="normal"><a href="#__codelineno-238-17">17</a></span>
<span class="normal"><a href="#__codelineno-238-18">18</a></span>
<span class="normal"><a href="#__codelineno-238-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-238-1" name="__codelineno-238-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-238-2" name="__codelineno-238-2"></a>
<a id="__codelineno-238-3" name="__codelineno-238-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-238-4" name="__codelineno-238-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-238-5" name="__codelineno-238-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-238-6" name="__codelineno-238-6"></a><span class="p">)</span>
<a id="__codelineno-238-7" name="__codelineno-238-7"></a>
<a id="__codelineno-238-8" name="__codelineno-238-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-238-9" name="__codelineno-238-9"></a><span class="w">    </span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<a id="__codelineno-238-10" name="__codelineno-238-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;当前时间:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<a id="__codelineno-238-11" name="__codelineno-238-11"></a>
<a id="__codelineno-238-12" name="__codelineno-238-12"></a><span class="w">    </span><span class="c1">// 添加时间</span>
<a id="__codelineno-238-13" name="__codelineno-238-13"></a><span class="w">    </span><span class="nx">later</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">48</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="p">)</span>
<a id="__codelineno-238-14" name="__codelineno-238-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;48小时后:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">later</span><span class="p">)</span>
<a id="__codelineno-238-15" name="__codelineno-238-15"></a>
<a id="__codelineno-238-16" name="__codelineno-238-16"></a><span class="w">    </span><span class="c1">// 计算时间差</span>
<a id="__codelineno-238-17" name="__codelineno-238-17"></a><span class="w">    </span><span class="nx">diff</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">later</span><span class="p">.</span><span class="nx">Sub</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>
<a id="__codelineno-238-18" name="__codelineno-238-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;时间差:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">diff</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 时间差: 48h0m0s</span>
<a id="__codelineno-238-19" name="__codelineno-238-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>6. 定时器与计时器</strong></p>
<p><strong>示例1：使用<code>time.Sleep</code>暂停</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-239-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-239-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-239-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-239-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-239-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-239-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-239-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-239-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-239-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-239-10">10</a></span>
<span class="normal"><a href="#__codelineno-239-11">11</a></span>
<span class="normal"><a href="#__codelineno-239-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-239-1" name="__codelineno-239-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-239-2" name="__codelineno-239-2"></a>
<a id="__codelineno-239-3" name="__codelineno-239-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-239-4" name="__codelineno-239-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-239-5" name="__codelineno-239-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-239-6" name="__codelineno-239-6"></a><span class="p">)</span>
<a id="__codelineno-239-7" name="__codelineno-239-7"></a>
<a id="__codelineno-239-8" name="__codelineno-239-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-239-9" name="__codelineno-239-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;开始睡眠...&quot;</span><span class="p">)</span>
<a id="__codelineno-239-10" name="__codelineno-239-10"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-239-11" name="__codelineno-239-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;醒来了！&quot;</span><span class="p">)</span>
<a id="__codelineno-239-12" name="__codelineno-239-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-240-1">1</a></span>
<span class="normal"><a href="#__codelineno-240-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-240-1" name="__codelineno-240-1"></a>开始睡眠...
<a id="__codelineno-240-2" name="__codelineno-240-2"></a>醒来了！
</code></pre></div></td></tr></table></div>
<p><strong>示例2：使用<code>time.Tick</code>定时执行任务</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-241-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-241-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-241-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-241-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-241-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-241-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-241-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-241-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-241-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-241-10">10</a></span>
<span class="normal"><a href="#__codelineno-241-11">11</a></span>
<span class="normal"><a href="#__codelineno-241-12">12</a></span>
<span class="normal"><a href="#__codelineno-241-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-241-1" name="__codelineno-241-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-241-2" name="__codelineno-241-2"></a>
<a id="__codelineno-241-3" name="__codelineno-241-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-241-4" name="__codelineno-241-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-241-5" name="__codelineno-241-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-241-6" name="__codelineno-241-6"></a><span class="p">)</span>
<a id="__codelineno-241-7" name="__codelineno-241-7"></a>
<a id="__codelineno-241-8" name="__codelineno-241-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-241-9" name="__codelineno-241-9"></a><span class="w">    </span><span class="nx">ticker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Tick</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-241-10" name="__codelineno-241-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ticker</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-241-11" name="__codelineno-241-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;当前时间:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<a id="__codelineno-241-12" name="__codelineno-241-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-241-13" name="__codelineno-241-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-242-1">1</a></span>
<span class="normal"><a href="#__codelineno-242-2">2</a></span>
<span class="normal"><a href="#__codelineno-242-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-242-1" name="__codelineno-242-1"></a>当前时间: 2024-04-27 14:30:45.123456789 +0800 CST m=+1.000000001
<a id="__codelineno-242-2" name="__codelineno-242-2"></a>当前时间: 2024-04-27 14:30:46.123456789 +0800 CST m=+2.000000001
<a id="__codelineno-242-3" name="__codelineno-242-3"></a>...
</code></pre></div></td></tr></table></div>
<p><strong>示例3：使用<code>time.NewTimer</code></strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-243-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-243-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-243-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-243-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-243-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-243-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-243-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-243-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-243-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-243-10">10</a></span>
<span class="normal"><a href="#__codelineno-243-11">11</a></span>
<span class="normal"><a href="#__codelineno-243-12">12</a></span>
<span class="normal"><a href="#__codelineno-243-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-243-1" name="__codelineno-243-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-243-2" name="__codelineno-243-2"></a>
<a id="__codelineno-243-3" name="__codelineno-243-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-243-4" name="__codelineno-243-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-243-5" name="__codelineno-243-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-243-6" name="__codelineno-243-6"></a><span class="p">)</span>
<a id="__codelineno-243-7" name="__codelineno-243-7"></a>
<a id="__codelineno-243-8" name="__codelineno-243-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-243-9" name="__codelineno-243-9"></a><span class="w">    </span><span class="nx">timer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">NewTimer</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-243-10" name="__codelineno-243-10"></a>
<a id="__codelineno-243-11" name="__codelineno-243-11"></a><span class="w">    </span><span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span>
<a id="__codelineno-243-12" name="__codelineno-243-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;3秒后触发的事件&quot;</span><span class="p">)</span>
<a id="__codelineno-243-13" name="__codelineno-243-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-244-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-244-1" name="__codelineno-244-1"></a>3秒后触发的事件
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_2">注意事项<a class="headerlink" href="#注意事项_2" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>避免资源泄露</strong>：使用<code>time.Tick</code>时，要确保程序不会无限制地使用资源，因为<code>Tick</code>会持续发送信号。可以使用<code>time.NewTicker</code>并在不需要时停止它。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-245-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-245-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-245-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-245-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-245-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-245-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-245-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-245-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-245-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-245-10">10</a></span>
<span class="normal"><a href="#__codelineno-245-11">11</a></span>
<span class="normal"><a href="#__codelineno-245-12">12</a></span>
<span class="normal"><a href="#__codelineno-245-13">13</a></span>
<span class="normal"><a href="#__codelineno-245-14">14</a></span>
<span class="normal"><a href="#__codelineno-245-15">15</a></span>
<span class="normal"><a href="#__codelineno-245-16">16</a></span>
<span class="normal"><a href="#__codelineno-245-17">17</a></span>
<span class="normal"><a href="#__codelineno-245-18">18</a></span>
<span class="normal"><a href="#__codelineno-245-19">19</a></span>
<span class="normal"><a href="#__codelineno-245-20">20</a></span>
<span class="normal"><a href="#__codelineno-245-21">21</a></span>
<span class="normal"><a href="#__codelineno-245-22">22</a></span>
<span class="normal"><a href="#__codelineno-245-23">23</a></span>
<span class="normal"><a href="#__codelineno-245-24">24</a></span>
<span class="normal"><a href="#__codelineno-245-25">25</a></span>
<span class="normal"><a href="#__codelineno-245-26">26</a></span>
<span class="normal"><a href="#__codelineno-245-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-245-1" name="__codelineno-245-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-245-2" name="__codelineno-245-2"></a>
<a id="__codelineno-245-3" name="__codelineno-245-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-245-4" name="__codelineno-245-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-245-5" name="__codelineno-245-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-245-6" name="__codelineno-245-6"></a><span class="p">)</span>
<a id="__codelineno-245-7" name="__codelineno-245-7"></a>
<a id="__codelineno-245-8" name="__codelineno-245-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-245-9" name="__codelineno-245-9"></a><span class="w">    </span><span class="nx">ticker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">NewTicker</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-245-10" name="__codelineno-245-10"></a><span class="w">    </span><span class="nx">done</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span>
<a id="__codelineno-245-11" name="__codelineno-245-11"></a>
<a id="__codelineno-245-12" name="__codelineno-245-12"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-245-13" name="__codelineno-245-13"></a><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-245-14" name="__codelineno-245-14"></a><span class="w">        </span><span class="nx">done</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-245-15" name="__codelineno-245-15"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-245-16" name="__codelineno-245-16"></a>
<a id="__codelineno-245-17" name="__codelineno-245-17"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-245-18" name="__codelineno-245-18"></a><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-245-19" name="__codelineno-245-19"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
<a id="__codelineno-245-20" name="__codelineno-245-20"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Tick at&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">t</span><span class="p">)</span>
<a id="__codelineno-245-21" name="__codelineno-245-21"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">done</span><span class="p">:</span>
<a id="__codelineno-245-22" name="__codelineno-245-22"></a><span class="w">            </span><span class="nx">ticker</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>
<a id="__codelineno-245-23" name="__codelineno-245-23"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Ticker stopped&quot;</span><span class="p">)</span>
<a id="__codelineno-245-24" name="__codelineno-245-24"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-245-25" name="__codelineno-245-25"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-245-26" name="__codelineno-245-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-245-27" name="__codelineno-245-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-246-1">1</a></span>
<span class="normal"><a href="#__codelineno-246-2">2</a></span>
<span class="normal"><a href="#__codelineno-246-3">3</a></span>
<span class="normal"><a href="#__codelineno-246-4">4</a></span>
<span class="normal"><a href="#__codelineno-246-5">5</a></span>
<span class="normal"><a href="#__codelineno-246-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-246-1" name="__codelineno-246-1"></a>Tick at 2024-04-27 14:30:45 +0800 CST m=+1.000000001
<a id="__codelineno-246-2" name="__codelineno-246-2"></a>Tick at 2024-04-27 14:30:46 +0800 CST m=+2.000000002
<a id="__codelineno-246-3" name="__codelineno-246-3"></a>Tick at 2024-04-27 14:30:47 +0800 CST m=+3.000000003
<a id="__codelineno-246-4" name="__codelineno-246-4"></a>Tick at 2024-04-27 14:30:48 +0800 CST m=+4.000000004
<a id="__codelineno-246-5" name="__codelineno-246-5"></a>Tick at 2024-04-27 14:30:49 +0800 CST m=+5.000000005
<a id="__codelineno-246-6" name="__codelineno-246-6"></a>Ticker stopped
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>线程安全</strong>：<code>time</code>包中的函数是线程安全的，可以在多个goroutine中安全使用。</li>
</ul>
<h3 id="64-strings-包">6.4 <code>strings</code> 包<a class="headerlink" href="#64-strings-包" title="Permanent link">&para;</a></h3>
<p><code>strings</code>包提供了处理字符串的各种函数，如查找、替换、拆分、连接等。它在文本处理和解析中非常有用。</p>
<h4 id="常用函数_2">常用函数<a class="headerlink" href="#常用函数_2" title="Permanent link">&para;</a></h4>
<ul>
<li>查找与包含</li>
</ul>
<p>：</p>
<ul>
<li><code>strings.Contains(s, substr string) bool</code>: 判断字符串<code>s</code>是否包含子字符串<code>substr</code>。</li>
<li><code>strings.HasPrefix(s, prefix string) bool</code>: 判断字符串<code>s</code>是否以<code>prefix</code>开头。</li>
<li><code>strings.HasSuffix(s, suffix string) bool</code>: 判断字符串<code>s</code>是否以<code>suffix</code>结尾。</li>
<li>
<p><code>strings.Index(s, substr string) int</code>: 返回子字符串<code>substr</code>在字符串<code>s</code>中的第一个索引，未找到返回-1。</p>
</li>
<li>
<p>替换</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p><code>strings.Replace(s, old, new string, n int) string</code>: 替换字符串<code>s</code>中前<code>n</code>个<code>old</code>为<code>new</code>。如果<code>n</code>为-1，则替换所有。</p>
</li>
<li>
<p>拆分与连接</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>strings.Split(s, sep string) []string</code>: 根据分隔符<code>sep</code>拆分字符串<code>s</code>，返回子字符串切片。</li>
<li>
<p><code>strings.Join(a []string, sep string) string</code>: 将字符串切片<code>a</code>用分隔符<code>sep</code>连接成一个字符串。</p>
</li>
<li>
<p>大小写转换</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>strings.ToUpper(s string) string</code>: 将字符串<code>s</code>转换为大写。</li>
<li>
<p><code>strings.ToLower(s string) string</code>: 将字符串<code>s</code>转换为小写。</p>
</li>
<li>
<p>修剪与填充</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>strings.TrimSpace(s string) string</code>: 去除字符串<code>s</code>两端的空白字符。</li>
<li>
<p><code>strings.Trim(s, cutset string) string</code>: 去除字符串<code>s</code>两端包含在<code>cutset</code>中的字符。</p>
</li>
<li>
<p>其他</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>strings.Repeat(s string, count int) string</code>: 重复字符串<code>s</code>指定次数<code>count</code>。</li>
<li><code>strings.Fields(s string) []string</code>: 根据空白字符拆分字符串<code>s</code>，返回字段切片。</li>
<li><code>strings.Join(a []string, sep string) string</code>: 将字符串切片<code>a</code>用分隔符<code>sep</code>连接成一个字符串。</li>
</ul>
<h4 id="示例与用法_3">示例与用法<a class="headerlink" href="#示例与用法_3" title="Permanent link">&para;</a></h4>
<p><strong>1. 判断包含关系</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-247-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-247-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-247-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-247-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-247-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-247-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-247-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-247-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-247-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-247-10">10</a></span>
<span class="normal"><a href="#__codelineno-247-11">11</a></span>
<span class="normal"><a href="#__codelineno-247-12">12</a></span>
<span class="normal"><a href="#__codelineno-247-13">13</a></span>
<span class="normal"><a href="#__codelineno-247-14">14</a></span>
<span class="normal"><a href="#__codelineno-247-15">15</a></span>
<span class="normal"><a href="#__codelineno-247-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-247-1" name="__codelineno-247-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-247-2" name="__codelineno-247-2"></a>
<a id="__codelineno-247-3" name="__codelineno-247-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-247-4" name="__codelineno-247-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-247-5" name="__codelineno-247-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-247-6" name="__codelineno-247-6"></a><span class="p">)</span>
<a id="__codelineno-247-7" name="__codelineno-247-7"></a>
<a id="__codelineno-247-8" name="__codelineno-247-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-247-9" name="__codelineno-247-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Hello, Go Language!&quot;</span>
<a id="__codelineno-247-10" name="__codelineno-247-10"></a>
<a id="__codelineno-247-11" name="__codelineno-247-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Go&quot;</span><span class="p">))</span><span class="w">          </span><span class="c1">// 输出: true</span>
<a id="__codelineno-247-12" name="__codelineno-247-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">))</span><span class="w">      </span><span class="c1">// 输出: false</span>
<a id="__codelineno-247-13" name="__codelineno-247-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">HasPrefix</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">))</span><span class="w">      </span><span class="c1">// 输出: true</span>
<a id="__codelineno-247-14" name="__codelineno-247-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">HasSuffix</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Language!&quot;</span><span class="p">))</span><span class="w">  </span><span class="c1">// 输出: true</span>
<a id="__codelineno-247-15" name="__codelineno-247-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">HasSuffix</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Go&quot;</span><span class="p">))</span><span class="w">         </span><span class="c1">// 输出: false</span>
<a id="__codelineno-247-16" name="__codelineno-247-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 查找子字符串的位置</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-248-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-248-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-248-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-248-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-248-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-248-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-248-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-248-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-248-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-248-10">10</a></span>
<span class="normal"><a href="#__codelineno-248-11">11</a></span>
<span class="normal"><a href="#__codelineno-248-12">12</a></span>
<span class="normal"><a href="#__codelineno-248-13">13</a></span>
<span class="normal"><a href="#__codelineno-248-14">14</a></span>
<span class="normal"><a href="#__codelineno-248-15">15</a></span>
<span class="normal"><a href="#__codelineno-248-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-248-1" name="__codelineno-248-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-248-2" name="__codelineno-248-2"></a>
<a id="__codelineno-248-3" name="__codelineno-248-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-248-4" name="__codelineno-248-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-248-5" name="__codelineno-248-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-248-6" name="__codelineno-248-6"></a><span class="p">)</span>
<a id="__codelineno-248-7" name="__codelineno-248-7"></a>
<a id="__codelineno-248-8" name="__codelineno-248-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-248-9" name="__codelineno-248-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Go is an open-source programming language.&quot;</span>
<a id="__codelineno-248-10" name="__codelineno-248-10"></a>
<a id="__codelineno-248-11" name="__codelineno-248-11"></a><span class="w">    </span><span class="nx">index</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;open&quot;</span><span class="p">)</span>
<a id="__codelineno-248-12" name="__codelineno-248-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Index of &#39;open&#39;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Index of &#39;open&#39;: 10</span>
<a id="__codelineno-248-13" name="__codelineno-248-13"></a>
<a id="__codelineno-248-14" name="__codelineno-248-14"></a><span class="w">    </span><span class="nx">index</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">)</span>
<a id="__codelineno-248-15" name="__codelineno-248-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Index of &#39;Python&#39;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Index of &#39;Python&#39;: -1</span>
<a id="__codelineno-248-16" name="__codelineno-248-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 替换字符串</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-249-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-249-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-249-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-249-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-249-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-249-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-249-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-249-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-249-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-249-10">10</a></span>
<span class="normal"><a href="#__codelineno-249-11">11</a></span>
<span class="normal"><a href="#__codelineno-249-12">12</a></span>
<span class="normal"><a href="#__codelineno-249-13">13</a></span>
<span class="normal"><a href="#__codelineno-249-14">14</a></span>
<span class="normal"><a href="#__codelineno-249-15">15</a></span>
<span class="normal"><a href="#__codelineno-249-16">16</a></span>
<span class="normal"><a href="#__codelineno-249-17">17</a></span>
<span class="normal"><a href="#__codelineno-249-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-249-1" name="__codelineno-249-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-249-2" name="__codelineno-249-2"></a>
<a id="__codelineno-249-3" name="__codelineno-249-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-249-4" name="__codelineno-249-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-249-5" name="__codelineno-249-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-249-6" name="__codelineno-249-6"></a><span class="p">)</span>
<a id="__codelineno-249-7" name="__codelineno-249-7"></a>
<a id="__codelineno-249-8" name="__codelineno-249-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-249-9" name="__codelineno-249-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;I love Go. Go is awesome.&quot;</span>
<a id="__codelineno-249-10" name="__codelineno-249-10"></a>
<a id="__codelineno-249-11" name="__codelineno-249-11"></a><span class="w">    </span><span class="c1">// 替换第一个 &quot;Go&quot; 为 &quot;Golang&quot;</span>
<a id="__codelineno-249-12" name="__codelineno-249-12"></a><span class="w">    </span><span class="nx">newStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Golang&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-249-13" name="__codelineno-249-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">newStr</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: I love Golang. Go is awesome.</span>
<a id="__codelineno-249-14" name="__codelineno-249-14"></a>
<a id="__codelineno-249-15" name="__codelineno-249-15"></a><span class="w">    </span><span class="c1">// 替换所有 &quot;Go&quot; 为 &quot;Golang&quot;</span>
<a id="__codelineno-249-16" name="__codelineno-249-16"></a><span class="w">    </span><span class="nx">newStrAll</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Golang&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-249-17" name="__codelineno-249-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">newStrAll</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: I love Golang. Golang is awesome.</span>
<a id="__codelineno-249-18" name="__codelineno-249-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 拆分与连接字符串</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-250-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-250-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-250-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-250-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-250-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-250-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-250-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-250-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-250-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-250-10">10</a></span>
<span class="normal"><a href="#__codelineno-250-11">11</a></span>
<span class="normal"><a href="#__codelineno-250-12">12</a></span>
<span class="normal"><a href="#__codelineno-250-13">13</a></span>
<span class="normal"><a href="#__codelineno-250-14">14</a></span>
<span class="normal"><a href="#__codelineno-250-15">15</a></span>
<span class="normal"><a href="#__codelineno-250-16">16</a></span>
<span class="normal"><a href="#__codelineno-250-17">17</a></span>
<span class="normal"><a href="#__codelineno-250-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-250-1" name="__codelineno-250-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-250-2" name="__codelineno-250-2"></a>
<a id="__codelineno-250-3" name="__codelineno-250-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-250-4" name="__codelineno-250-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-250-5" name="__codelineno-250-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-250-6" name="__codelineno-250-6"></a><span class="p">)</span>
<a id="__codelineno-250-7" name="__codelineno-250-7"></a>
<a id="__codelineno-250-8" name="__codelineno-250-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-250-9" name="__codelineno-250-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;apple,banana,cherry&quot;</span>
<a id="__codelineno-250-10" name="__codelineno-250-10"></a>
<a id="__codelineno-250-11" name="__codelineno-250-11"></a><span class="w">    </span><span class="c1">// 拆分字符串</span>
<a id="__codelineno-250-12" name="__codelineno-250-12"></a><span class="w">    </span><span class="nx">fruits</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<a id="__codelineno-250-13" name="__codelineno-250-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fruits</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [apple banana cherry]</span>
<a id="__codelineno-250-14" name="__codelineno-250-14"></a>
<a id="__codelineno-250-15" name="__codelineno-250-15"></a><span class="w">    </span><span class="c1">// 连接字符串</span>
<a id="__codelineno-250-16" name="__codelineno-250-16"></a><span class="w">    </span><span class="nx">joined</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">fruits</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; | &quot;</span><span class="p">)</span>
<a id="__codelineno-250-17" name="__codelineno-250-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">joined</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: apple | banana | cherry</span>
<a id="__codelineno-250-18" name="__codelineno-250-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>5. 大小写转换</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-251-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-251-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-251-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-251-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-251-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-251-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-251-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-251-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-251-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-251-10">10</a></span>
<span class="normal"><a href="#__codelineno-251-11">11</a></span>
<span class="normal"><a href="#__codelineno-251-12">12</a></span>
<span class="normal"><a href="#__codelineno-251-13">13</a></span>
<span class="normal"><a href="#__codelineno-251-14">14</a></span>
<span class="normal"><a href="#__codelineno-251-15">15</a></span>
<span class="normal"><a href="#__codelineno-251-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-251-1" name="__codelineno-251-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-251-2" name="__codelineno-251-2"></a>
<a id="__codelineno-251-3" name="__codelineno-251-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-251-4" name="__codelineno-251-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-251-5" name="__codelineno-251-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-251-6" name="__codelineno-251-6"></a><span class="p">)</span>
<a id="__codelineno-251-7" name="__codelineno-251-7"></a>
<a id="__codelineno-251-8" name="__codelineno-251-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-251-9" name="__codelineno-251-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Go Language&quot;</span>
<a id="__codelineno-251-10" name="__codelineno-251-10"></a>
<a id="__codelineno-251-11" name="__codelineno-251-11"></a><span class="w">    </span><span class="nx">upper</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-251-12" name="__codelineno-251-12"></a><span class="w">    </span><span class="nx">lower</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-251-13" name="__codelineno-251-13"></a>
<a id="__codelineno-251-14" name="__codelineno-251-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Uppercase:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">upper</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Uppercase: GO LANGUAGE</span>
<a id="__codelineno-251-15" name="__codelineno-251-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Lowercase:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">lower</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Lowercase: go language</span>
<a id="__codelineno-251-16" name="__codelineno-251-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>6. 修剪字符串</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-252-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-252-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-252-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-252-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-252-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-252-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-252-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-252-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-252-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-252-10">10</a></span>
<span class="normal"><a href="#__codelineno-252-11">11</a></span>
<span class="normal"><a href="#__codelineno-252-12">12</a></span>
<span class="normal"><a href="#__codelineno-252-13">13</a></span>
<span class="normal"><a href="#__codelineno-252-14">14</a></span>
<span class="normal"><a href="#__codelineno-252-15">15</a></span>
<span class="normal"><a href="#__codelineno-252-16">16</a></span>
<span class="normal"><a href="#__codelineno-252-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-252-1" name="__codelineno-252-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-252-2" name="__codelineno-252-2"></a>
<a id="__codelineno-252-3" name="__codelineno-252-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-252-4" name="__codelineno-252-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-252-5" name="__codelineno-252-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-252-6" name="__codelineno-252-6"></a><span class="p">)</span>
<a id="__codelineno-252-7" name="__codelineno-252-7"></a>
<a id="__codelineno-252-8" name="__codelineno-252-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-252-9" name="__codelineno-252-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;  Hello, Go!  &quot;</span>
<a id="__codelineno-252-10" name="__codelineno-252-10"></a>
<a id="__codelineno-252-11" name="__codelineno-252-11"></a><span class="w">    </span><span class="nx">trimmed</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSpace</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-252-12" name="__codelineno-252-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Trimmed:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">trimmed</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Trimmed: Hello, Go!</span>
<a id="__codelineno-252-13" name="__codelineno-252-13"></a>
<a id="__codelineno-252-14" name="__codelineno-252-14"></a><span class="w">    </span><span class="nx">s2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;---Go---&quot;</span>
<a id="__codelineno-252-15" name="__codelineno-252-15"></a><span class="w">    </span><span class="nx">trimmed2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Trim</span><span class="p">(</span><span class="nx">s2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">)</span>
<a id="__codelineno-252-16" name="__codelineno-252-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Trimmed:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">trimmed2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Trimmed: Go</span>
<a id="__codelineno-252-17" name="__codelineno-252-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>7. 重复与分割</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-253-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-253-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-253-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-253-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-253-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-253-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-253-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-253-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-253-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-253-10">10</a></span>
<span class="normal"><a href="#__codelineno-253-11">11</a></span>
<span class="normal"><a href="#__codelineno-253-12">12</a></span>
<span class="normal"><a href="#__codelineno-253-13">13</a></span>
<span class="normal"><a href="#__codelineno-253-14">14</a></span>
<span class="normal"><a href="#__codelineno-253-15">15</a></span>
<span class="normal"><a href="#__codelineno-253-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-253-1" name="__codelineno-253-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-253-2" name="__codelineno-253-2"></a>
<a id="__codelineno-253-3" name="__codelineno-253-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-253-4" name="__codelineno-253-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-253-5" name="__codelineno-253-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-253-6" name="__codelineno-253-6"></a><span class="p">)</span>
<a id="__codelineno-253-7" name="__codelineno-253-7"></a>
<a id="__codelineno-253-8" name="__codelineno-253-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-253-9" name="__codelineno-253-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Go&quot;</span>
<a id="__codelineno-253-10" name="__codelineno-253-10"></a><span class="w">    </span><span class="nx">repeated</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Repeat</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-253-11" name="__codelineno-253-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Repeated:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">repeated</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Repeated: GoGoGo</span>
<a id="__codelineno-253-12" name="__codelineno-253-12"></a>
<a id="__codelineno-253-13" name="__codelineno-253-13"></a><span class="w">    </span><span class="nx">s3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Go is fun&quot;</span>
<a id="__codelineno-253-14" name="__codelineno-253-14"></a><span class="w">    </span><span class="nx">fields</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Fields</span><span class="p">(</span><span class="nx">s3</span><span class="p">)</span>
<a id="__codelineno-253-15" name="__codelineno-253-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Fields:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fields</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Fields: [Go is fun]</span>
<a id="__codelineno-253-16" name="__codelineno-253-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_3">注意事项<a class="headerlink" href="#注意事项_3" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>不可变性</strong>：<code>strings</code>包中的函数不会修改原始字符串，而是返回新的字符串。这是因为字符串在Go中是不可变的。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-254-1">1</a></span>
<span class="normal"><a href="#__codelineno-254-2">2</a></span>
<span class="normal"><a href="#__codelineno-254-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-254-1" name="__codelineno-254-1"></a><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span>
<a id="__codelineno-254-2" name="__codelineno-254-2"></a><span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-254-3" name="__codelineno-254-3"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Hello</span>
</code></pre></div></td></tr></table></div>
<p>需要将结果赋值给新变量：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-255-1">1</a></span>
<span class="normal"><a href="#__codelineno-255-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-255-1" name="__codelineno-255-1"></a><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToUpper</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-255-2" name="__codelineno-255-2"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: HELLO</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>区分大小写</strong>：大多数函数是区分大小写的，如<code>Contains</code>、<code>HasPrefix</code>等。如果需要不区分大小写的比较，可以先转换为统一的大小写再比较。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-256-1">1</a></span>
<span class="normal"><a href="#__codelineno-256-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-256-1" name="__codelineno-256-1"></a><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Go Language&quot;</span>
<a id="__codelineno-256-2" name="__codelineno-256-2"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;go&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: true</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Unicode支持</strong>：<code>strings</code>包函数支持Unicode字符，但需要注意一些函数的行为，如<code>Index</code>和<code>Contains</code>基于字节而不是字符。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-257-1">1</a></span>
<span class="normal"><a href="#__codelineno-257-2">2</a></span>
<span class="normal"><a href="#__codelineno-257-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-257-1" name="__codelineno-257-1"></a><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;你好，Go语言&quot;</span>
<a id="__codelineno-257-2" name="__codelineno-257-2"></a><span class="nx">index</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Index</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Go&quot;</span><span class="p">)</span>
<a id="__codelineno-257-3" name="__codelineno-257-3"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Index of &#39;Go&#39;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Index of &#39;Go&#39;: 6</span>
</code></pre></div></td></tr></table></div>
<h3 id="65-io-和-os-包">6.5 <code>io</code> 和 <code>os</code> 包<a class="headerlink" href="#65-io-和-os-包" title="Permanent link">&para;</a></h3>
<p><code>io</code>和<code>os</code>包是Go语言中用于处理输入输出和操作系统交互的重要标准库。<code>io</code>包提供了基础的输入输出接口和工具，而<code>os</code>包则提供了对操作系统功能的访问，如文件操作、环境变量、进程管理等。</p>
<h4 id="io-包"><code>io</code> 包<a class="headerlink" href="#io-包" title="Permanent link">&para;</a></h4>
<p><code>io</code>包定义了基本的I/O接口，如<code>Reader</code>、<code>Writer</code>、<code>Closer</code>等，并提供了实用的函数和工具来操作这些接口。</p>
<h5 id="常用接口">常用接口<a class="headerlink" href="#常用接口" title="Permanent link">&para;</a></h5>
<ul>
<li><strong><code>Reader</code></strong>：定义了读取数据的方法。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-258-1">1</a></span>
<span class="normal"><a href="#__codelineno-258-2">2</a></span>
<span class="normal"><a href="#__codelineno-258-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-258-1" name="__codelineno-258-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Reader</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-258-2" name="__codelineno-258-2"></a><span class="w">    </span><span class="nx">Read</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<a id="__codelineno-258-3" name="__codelineno-258-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong><code>Writer</code></strong>：定义了写入数据的方法。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-259-1">1</a></span>
<span class="normal"><a href="#__codelineno-259-2">2</a></span>
<span class="normal"><a href="#__codelineno-259-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-259-1" name="__codelineno-259-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Writer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-259-2" name="__codelineno-259-2"></a><span class="w">    </span><span class="nx">Write</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<a id="__codelineno-259-3" name="__codelineno-259-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong><code>Closer</code></strong>：定义了关闭资源的方法。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-260-1">1</a></span>
<span class="normal"><a href="#__codelineno-260-2">2</a></span>
<span class="normal"><a href="#__codelineno-260-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-260-1" name="__codelineno-260-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Closer</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-260-2" name="__codelineno-260-2"></a><span class="w">    </span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-260-3" name="__codelineno-260-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="常用函数_3">常用函数<a class="headerlink" href="#常用函数_3" title="Permanent link">&para;</a></h5>
<ul>
<li><strong><code>io.Copy(dst Writer, src Reader) (written int64, err error)</code></strong>：从<code>src</code>读取数据并写入到<code>dst</code>，直到EOF或错误。</li>
<li><strong><code>io.ReadAll(r Reader) ([]byte, error)</code></strong>：读取所有数据直到EOF并返回。</li>
<li><strong><code>io.WriteString(w Writer, s string) (n int, err error)</code></strong>：将字符串写入到<code>Writer</code>。</li>
</ul>
<h5 id="示例与用法_4">示例与用法<a class="headerlink" href="#示例与用法_4" title="Permanent link">&para;</a></h5>
<p><strong>1. 使用<code>io.Copy</code>复制文件内容</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-261-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-261-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-261-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-261-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-261-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-261-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-261-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-261-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-261-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-261-10">10</a></span>
<span class="normal"><a href="#__codelineno-261-11">11</a></span>
<span class="normal"><a href="#__codelineno-261-12">12</a></span>
<span class="normal"><a href="#__codelineno-261-13">13</a></span>
<span class="normal"><a href="#__codelineno-261-14">14</a></span>
<span class="normal"><a href="#__codelineno-261-15">15</a></span>
<span class="normal"><a href="#__codelineno-261-16">16</a></span>
<span class="normal"><a href="#__codelineno-261-17">17</a></span>
<span class="normal"><a href="#__codelineno-261-18">18</a></span>
<span class="normal"><a href="#__codelineno-261-19">19</a></span>
<span class="normal"><a href="#__codelineno-261-20">20</a></span>
<span class="normal"><a href="#__codelineno-261-21">21</a></span>
<span class="normal"><a href="#__codelineno-261-22">22</a></span>
<span class="normal"><a href="#__codelineno-261-23">23</a></span>
<span class="normal"><a href="#__codelineno-261-24">24</a></span>
<span class="normal"><a href="#__codelineno-261-25">25</a></span>
<span class="normal"><a href="#__codelineno-261-26">26</a></span>
<span class="normal"><a href="#__codelineno-261-27">27</a></span>
<span class="normal"><a href="#__codelineno-261-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-261-1" name="__codelineno-261-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-261-2" name="__codelineno-261-2"></a>
<a id="__codelineno-261-3" name="__codelineno-261-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-261-4" name="__codelineno-261-4"></a><span class="w">    </span><span class="s">&quot;io&quot;</span>
<a id="__codelineno-261-5" name="__codelineno-261-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-261-6" name="__codelineno-261-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-261-7" name="__codelineno-261-7"></a><span class="p">)</span>
<a id="__codelineno-261-8" name="__codelineno-261-8"></a>
<a id="__codelineno-261-9" name="__codelineno-261-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-261-10" name="__codelineno-261-10"></a><span class="w">    </span><span class="nx">srcFile</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;source.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-261-11" name="__codelineno-261-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-261-12" name="__codelineno-261-12"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-261-13" name="__codelineno-261-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-261-14" name="__codelineno-261-14"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">srcFile</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-261-15" name="__codelineno-261-15"></a>
<a id="__codelineno-261-16" name="__codelineno-261-16"></a><span class="w">    </span><span class="nx">dstFile</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;destination.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-261-17" name="__codelineno-261-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-261-18" name="__codelineno-261-18"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-261-19" name="__codelineno-261-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-261-20" name="__codelineno-261-20"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">dstFile</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-261-21" name="__codelineno-261-21"></a>
<a id="__codelineno-261-22" name="__codelineno-261-22"></a><span class="w">    </span><span class="nx">bytesCopied</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">dstFile</span><span class="p">,</span><span class="w"> </span><span class="nx">srcFile</span><span class="p">)</span>
<a id="__codelineno-261-23" name="__codelineno-261-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-261-24" name="__codelineno-261-24"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-261-25" name="__codelineno-261-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-261-26" name="__codelineno-261-26"></a>
<a id="__codelineno-261-27" name="__codelineno-261-27"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Copied %d bytes.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytesCopied</span><span class="p">)</span>
<a id="__codelineno-261-28" name="__codelineno-261-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 读取所有数据</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-262-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-262-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-262-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-262-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-262-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-262-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-262-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-262-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-262-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-262-10">10</a></span>
<span class="normal"><a href="#__codelineno-262-11">11</a></span>
<span class="normal"><a href="#__codelineno-262-12">12</a></span>
<span class="normal"><a href="#__codelineno-262-13">13</a></span>
<span class="normal"><a href="#__codelineno-262-14">14</a></span>
<span class="normal"><a href="#__codelineno-262-15">15</a></span>
<span class="normal"><a href="#__codelineno-262-16">16</a></span>
<span class="normal"><a href="#__codelineno-262-17">17</a></span>
<span class="normal"><a href="#__codelineno-262-18">18</a></span>
<span class="normal"><a href="#__codelineno-262-19">19</a></span>
<span class="normal"><a href="#__codelineno-262-20">20</a></span>
<span class="normal"><a href="#__codelineno-262-21">21</a></span>
<span class="normal"><a href="#__codelineno-262-22">22</a></span>
<span class="normal"><a href="#__codelineno-262-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-262-1" name="__codelineno-262-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-262-2" name="__codelineno-262-2"></a>
<a id="__codelineno-262-3" name="__codelineno-262-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-262-4" name="__codelineno-262-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-262-5" name="__codelineno-262-5"></a><span class="w">    </span><span class="s">&quot;io&quot;</span>
<a id="__codelineno-262-6" name="__codelineno-262-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-262-7" name="__codelineno-262-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-262-8" name="__codelineno-262-8"></a><span class="p">)</span>
<a id="__codelineno-262-9" name="__codelineno-262-9"></a>
<a id="__codelineno-262-10" name="__codelineno-262-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-262-11" name="__codelineno-262-11"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-262-12" name="__codelineno-262-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-262-13" name="__codelineno-262-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-262-14" name="__codelineno-262-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-262-15" name="__codelineno-262-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-262-16" name="__codelineno-262-16"></a>
<a id="__codelineno-262-17" name="__codelineno-262-17"></a><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-262-18" name="__codelineno-262-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-262-19" name="__codelineno-262-19"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-262-20" name="__codelineno-262-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-262-21" name="__codelineno-262-21"></a>
<a id="__codelineno-262-22" name="__codelineno-262-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-262-23" name="__codelineno-262-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 写入字符串到文件</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-263-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-263-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-263-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-263-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-263-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-263-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-263-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-263-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-263-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-263-10">10</a></span>
<span class="normal"><a href="#__codelineno-263-11">11</a></span>
<span class="normal"><a href="#__codelineno-263-12">12</a></span>
<span class="normal"><a href="#__codelineno-263-13">13</a></span>
<span class="normal"><a href="#__codelineno-263-14">14</a></span>
<span class="normal"><a href="#__codelineno-263-15">15</a></span>
<span class="normal"><a href="#__codelineno-263-16">16</a></span>
<span class="normal"><a href="#__codelineno-263-17">17</a></span>
<span class="normal"><a href="#__codelineno-263-18">18</a></span>
<span class="normal"><a href="#__codelineno-263-19">19</a></span>
<span class="normal"><a href="#__codelineno-263-20">20</a></span>
<span class="normal"><a href="#__codelineno-263-21">21</a></span>
<span class="normal"><a href="#__codelineno-263-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-263-1" name="__codelineno-263-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-263-2" name="__codelineno-263-2"></a>
<a id="__codelineno-263-3" name="__codelineno-263-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-263-4" name="__codelineno-263-4"></a><span class="w">    </span><span class="s">&quot;io&quot;</span>
<a id="__codelineno-263-5" name="__codelineno-263-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-263-6" name="__codelineno-263-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-263-7" name="__codelineno-263-7"></a><span class="p">)</span>
<a id="__codelineno-263-8" name="__codelineno-263-8"></a>
<a id="__codelineno-263-9" name="__codelineno-263-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-263-10" name="__codelineno-263-10"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-263-11" name="__codelineno-263-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-263-12" name="__codelineno-263-12"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-263-13" name="__codelineno-263-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-263-14" name="__codelineno-263-14"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-263-15" name="__codelineno-263-15"></a>
<a id="__codelineno-263-16" name="__codelineno-263-16"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, Go!\n&quot;</span><span class="p">)</span>
<a id="__codelineno-263-17" name="__codelineno-263-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-263-18" name="__codelineno-263-18"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-263-19" name="__codelineno-263-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-263-20" name="__codelineno-263-20"></a>
<a id="__codelineno-263-21" name="__codelineno-263-21"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;写入成功&quot;</span><span class="p">)</span>
<a id="__codelineno-263-22" name="__codelineno-263-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_4">注意事项<a class="headerlink" href="#注意事项_4" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>错误处理</strong>：I/O操作容易出错，务必处理返回的错误，避免程序崩溃或数据丢失。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-264-1">1</a></span>
<span class="normal"><a href="#__codelineno-264-2">2</a></span>
<span class="normal"><a href="#__codelineno-264-3">3</a></span>
<span class="normal"><a href="#__codelineno-264-4">4</a></span>
<span class="normal"><a href="#__codelineno-264-5">5</a></span>
<span class="normal"><a href="#__codelineno-264-6">6</a></span>
<span class="normal"><a href="#__codelineno-264-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-264-1" name="__codelineno-264-1"></a><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;nonexistent.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-264-2" name="__codelineno-264-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-264-3" name="__codelineno-264-3"></a><span class="w">    </span><span class="c1">// 处理错误，如提示用户文件不存在</span>
<a id="__codelineno-264-4" name="__codelineno-264-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-264-5" name="__codelineno-264-5"></a><span class="w">    </span><span class="k">return</span>
<a id="__codelineno-264-6" name="__codelineno-264-6"></a><span class="p">}</span>
<a id="__codelineno-264-7" name="__codelineno-264-7"></a><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>资源管理</strong>：使用<code>defer</code>关键字确保文件或其他资源在使用完毕后被正确关闭，避免资源泄露。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-265-1">1</a></span>
<span class="normal"><a href="#__codelineno-265-2">2</a></span>
<span class="normal"><a href="#__codelineno-265-3">3</a></span>
<span class="normal"><a href="#__codelineno-265-4">4</a></span>
<span class="normal"><a href="#__codelineno-265-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-265-1" name="__codelineno-265-1"></a><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-265-2" name="__codelineno-265-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-265-3" name="__codelineno-265-3"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-265-4" name="__codelineno-265-4"></a><span class="p">}</span>
<a id="__codelineno-265-5" name="__codelineno-265-5"></a><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>缓冲与效率</strong>：对于大量数据的读取和写入，可以使用缓冲（如<code>bufio</code>包）提高效率。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-266-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-266-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-266-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-266-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-266-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-266-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-266-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-266-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-266-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-266-10">10</a></span>
<span class="normal"><a href="#__codelineno-266-11">11</a></span>
<span class="normal"><a href="#__codelineno-266-12">12</a></span>
<span class="normal"><a href="#__codelineno-266-13">13</a></span>
<span class="normal"><a href="#__codelineno-266-14">14</a></span>
<span class="normal"><a href="#__codelineno-266-15">15</a></span>
<span class="normal"><a href="#__codelineno-266-16">16</a></span>
<span class="normal"><a href="#__codelineno-266-17">17</a></span>
<span class="normal"><a href="#__codelineno-266-18">18</a></span>
<span class="normal"><a href="#__codelineno-266-19">19</a></span>
<span class="normal"><a href="#__codelineno-266-20">20</a></span>
<span class="normal"><a href="#__codelineno-266-21">21</a></span>
<span class="normal"><a href="#__codelineno-266-22">22</a></span>
<span class="normal"><a href="#__codelineno-266-23">23</a></span>
<span class="normal"><a href="#__codelineno-266-24">24</a></span>
<span class="normal"><a href="#__codelineno-266-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-266-1" name="__codelineno-266-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-266-2" name="__codelineno-266-2"></a>
<a id="__codelineno-266-3" name="__codelineno-266-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-266-4" name="__codelineno-266-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-266-5" name="__codelineno-266-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-266-6" name="__codelineno-266-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-266-7" name="__codelineno-266-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-266-8" name="__codelineno-266-8"></a><span class="p">)</span>
<a id="__codelineno-266-9" name="__codelineno-266-9"></a>
<a id="__codelineno-266-10" name="__codelineno-266-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-266-11" name="__codelineno-266-11"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;largefile.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-266-12" name="__codelineno-266-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-266-13" name="__codelineno-266-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-266-14" name="__codelineno-266-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-266-15" name="__codelineno-266-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-266-16" name="__codelineno-266-16"></a>
<a id="__codelineno-266-17" name="__codelineno-266-17"></a><span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-266-18" name="__codelineno-266-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-266-19" name="__codelineno-266-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">())</span>
<a id="__codelineno-266-20" name="__codelineno-266-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-266-21" name="__codelineno-266-21"></a>
<a id="__codelineno-266-22" name="__codelineno-266-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-266-23" name="__codelineno-266-23"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-266-24" name="__codelineno-266-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-266-25" name="__codelineno-266-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="os-包"><code>os</code> 包<a class="headerlink" href="#os-包" title="Permanent link">&para;</a></h4>
<p><code>os</code>包提供了与操作系统交互的功能，如文件操作、环境变量、进程管理等。它是进行系统级编程的重要工具。</p>
<h5 id="常用功能_1">常用功能<a class="headerlink" href="#常用功能_1" title="Permanent link">&para;</a></h5>
<ul>
<li>文件操作</li>
</ul>
<p>：</p>
<ul>
<li><code>os.Open(name string) (*os.File, error)</code>: 打开文件。</li>
<li><code>os.Create(name string) (*os.File, error)</code>: 创建文件。</li>
<li><code>os.Remove(name string) error</code>: 删除文件。</li>
<li>
<p><code>os.Rename(oldname, newname string) error</code>: 重命名文件。</p>
</li>
<li>
<p>环境变量</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>os.Getenv(key string) string</code>: 获取环境变量的值。</li>
<li><code>os.Setenv(key, value string) error</code>: 设置环境变量。</li>
<li>
<p><code>os.Unsetenv(key string) error</code>: 删除环境变量。</p>
</li>
<li>
<p>进程管理</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>os.Exit(code int)</code>: 终止程序并返回状态码。</li>
<li>
<p><code>os.Args</code>: 获取命令行参数。</p>
</li>
<li>
<p>目录操作</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>os.Mkdir(name string, perm os.FileMode) error</code>: 创建目录。</li>
<li><code>os.RemoveAll(path string) error</code>: 删除目录及其内容。</li>
</ul>
<h5 id="示例与用法_5">示例与用法<a class="headerlink" href="#示例与用法_5" title="Permanent link">&para;</a></h5>
<p><strong>1. 文件操作</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-267-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-267-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-267-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-267-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-267-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-267-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-267-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-267-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-267-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-267-10">10</a></span>
<span class="normal"><a href="#__codelineno-267-11">11</a></span>
<span class="normal"><a href="#__codelineno-267-12">12</a></span>
<span class="normal"><a href="#__codelineno-267-13">13</a></span>
<span class="normal"><a href="#__codelineno-267-14">14</a></span>
<span class="normal"><a href="#__codelineno-267-15">15</a></span>
<span class="normal"><a href="#__codelineno-267-16">16</a></span>
<span class="normal"><a href="#__codelineno-267-17">17</a></span>
<span class="normal"><a href="#__codelineno-267-18">18</a></span>
<span class="normal"><a href="#__codelineno-267-19">19</a></span>
<span class="normal"><a href="#__codelineno-267-20">20</a></span>
<span class="normal"><a href="#__codelineno-267-21">21</a></span>
<span class="normal"><a href="#__codelineno-267-22">22</a></span>
<span class="normal"><a href="#__codelineno-267-23">23</a></span>
<span class="normal"><a href="#__codelineno-267-24">24</a></span>
<span class="normal"><a href="#__codelineno-267-25">25</a></span>
<span class="normal"><a href="#__codelineno-267-26">26</a></span>
<span class="normal"><a href="#__codelineno-267-27">27</a></span>
<span class="normal"><a href="#__codelineno-267-28">28</a></span>
<span class="normal"><a href="#__codelineno-267-29">29</a></span>
<span class="normal"><a href="#__codelineno-267-30">30</a></span>
<span class="normal"><a href="#__codelineno-267-31">31</a></span>
<span class="normal"><a href="#__codelineno-267-32">32</a></span>
<span class="normal"><a href="#__codelineno-267-33">33</a></span>
<span class="normal"><a href="#__codelineno-267-34">34</a></span>
<span class="normal"><a href="#__codelineno-267-35">35</a></span>
<span class="normal"><a href="#__codelineno-267-36">36</a></span>
<span class="normal"><a href="#__codelineno-267-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-267-1" name="__codelineno-267-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-267-2" name="__codelineno-267-2"></a>
<a id="__codelineno-267-3" name="__codelineno-267-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-267-4" name="__codelineno-267-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-267-5" name="__codelineno-267-5"></a><span class="w">    </span><span class="s">&quot;io&quot;</span>
<a id="__codelineno-267-6" name="__codelineno-267-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-267-7" name="__codelineno-267-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-267-8" name="__codelineno-267-8"></a><span class="p">)</span>
<a id="__codelineno-267-9" name="__codelineno-267-9"></a>
<a id="__codelineno-267-10" name="__codelineno-267-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-267-11" name="__codelineno-267-11"></a><span class="w">    </span><span class="c1">// 创建文件</span>
<a id="__codelineno-267-12" name="__codelineno-267-12"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-267-13" name="__codelineno-267-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-267-14" name="__codelineno-267-14"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-267-15" name="__codelineno-267-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-267-16" name="__codelineno-267-16"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-267-17" name="__codelineno-267-17"></a>
<a id="__codelineno-267-18" name="__codelineno-267-18"></a><span class="w">    </span><span class="c1">// 写入数据</span>
<a id="__codelineno-267-19" name="__codelineno-267-19"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;This is an example file.\n&quot;</span><span class="p">)</span>
<a id="__codelineno-267-20" name="__codelineno-267-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-267-21" name="__codelineno-267-21"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-267-22" name="__codelineno-267-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-267-23" name="__codelineno-267-23"></a>
<a id="__codelineno-267-24" name="__codelineno-267-24"></a><span class="w">    </span><span class="c1">// 重命名文件</span>
<a id="__codelineno-267-25" name="__codelineno-267-25"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Rename</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;renamed_example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-267-26" name="__codelineno-267-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-267-27" name="__codelineno-267-27"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-267-28" name="__codelineno-267-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-267-29" name="__codelineno-267-29"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件已重命名为 renamed_example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-267-30" name="__codelineno-267-30"></a>
<a id="__codelineno-267-31" name="__codelineno-267-31"></a><span class="w">    </span><span class="c1">// 删除文件</span>
<a id="__codelineno-267-32" name="__codelineno-267-32"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">&quot;renamed_example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-267-33" name="__codelineno-267-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-267-34" name="__codelineno-267-34"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-267-35" name="__codelineno-267-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-267-36" name="__codelineno-267-36"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件已删除&quot;</span><span class="p">)</span>
<a id="__codelineno-267-37" name="__codelineno-267-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-268-1">1</a></span>
<span class="normal"><a href="#__codelineno-268-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-268-1" name="__codelineno-268-1"></a>文件已重命名为 renamed_example.txt
<a id="__codelineno-268-2" name="__codelineno-268-2"></a>文件已删除
</code></pre></div></td></tr></table></div>
<p><strong>2. 环境变量操作</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-269-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-269-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-269-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-269-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-269-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-269-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-269-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-269-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-269-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-269-10">10</a></span>
<span class="normal"><a href="#__codelineno-269-11">11</a></span>
<span class="normal"><a href="#__codelineno-269-12">12</a></span>
<span class="normal"><a href="#__codelineno-269-13">13</a></span>
<span class="normal"><a href="#__codelineno-269-14">14</a></span>
<span class="normal"><a href="#__codelineno-269-15">15</a></span>
<span class="normal"><a href="#__codelineno-269-16">16</a></span>
<span class="normal"><a href="#__codelineno-269-17">17</a></span>
<span class="normal"><a href="#__codelineno-269-18">18</a></span>
<span class="normal"><a href="#__codelineno-269-19">19</a></span>
<span class="normal"><a href="#__codelineno-269-20">20</a></span>
<span class="normal"><a href="#__codelineno-269-21">21</a></span>
<span class="normal"><a href="#__codelineno-269-22">22</a></span>
<span class="normal"><a href="#__codelineno-269-23">23</a></span>
<span class="normal"><a href="#__codelineno-269-24">24</a></span>
<span class="normal"><a href="#__codelineno-269-25">25</a></span>
<span class="normal"><a href="#__codelineno-269-26">26</a></span>
<span class="normal"><a href="#__codelineno-269-27">27</a></span>
<span class="normal"><a href="#__codelineno-269-28">28</a></span>
<span class="normal"><a href="#__codelineno-269-29">29</a></span>
<span class="normal"><a href="#__codelineno-269-30">30</a></span>
<span class="normal"><a href="#__codelineno-269-31">31</a></span>
<span class="normal"><a href="#__codelineno-269-32">32</a></span>
<span class="normal"><a href="#__codelineno-269-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-269-1" name="__codelineno-269-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-269-2" name="__codelineno-269-2"></a>
<a id="__codelineno-269-3" name="__codelineno-269-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-269-4" name="__codelineno-269-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-269-5" name="__codelineno-269-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-269-6" name="__codelineno-269-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-269-7" name="__codelineno-269-7"></a><span class="p">)</span>
<a id="__codelineno-269-8" name="__codelineno-269-8"></a>
<a id="__codelineno-269-9" name="__codelineno-269-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-269-10" name="__codelineno-269-10"></a><span class="w">    </span><span class="c1">// 获取环境变量</span>
<a id="__codelineno-269-11" name="__codelineno-269-11"></a><span class="w">    </span><span class="nx">home</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;HOME&quot;</span><span class="p">)</span>
<a id="__codelineno-269-12" name="__codelineno-269-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;HOME:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">home</span><span class="p">)</span>
<a id="__codelineno-269-13" name="__codelineno-269-13"></a>
<a id="__codelineno-269-14" name="__codelineno-269-14"></a><span class="w">    </span><span class="c1">// 设置环境变量</span>
<a id="__codelineno-269-15" name="__codelineno-269-15"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Setenv</span><span class="p">(</span><span class="s">&quot;MY_VAR&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, Environment!&quot;</span><span class="p">)</span>
<a id="__codelineno-269-16" name="__codelineno-269-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-269-17" name="__codelineno-269-17"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-269-18" name="__codelineno-269-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-269-19" name="__codelineno-269-19"></a>
<a id="__codelineno-269-20" name="__codelineno-269-20"></a><span class="w">    </span><span class="c1">// 获取新设置的环境变量</span>
<a id="__codelineno-269-21" name="__codelineno-269-21"></a><span class="w">    </span><span class="nx">myVar</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;MY_VAR&quot;</span><span class="p">)</span>
<a id="__codelineno-269-22" name="__codelineno-269-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;MY_VAR:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myVar</span><span class="p">)</span>
<a id="__codelineno-269-23" name="__codelineno-269-23"></a>
<a id="__codelineno-269-24" name="__codelineno-269-24"></a><span class="w">    </span><span class="c1">// 删除环境变量</span>
<a id="__codelineno-269-25" name="__codelineno-269-25"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Unsetenv</span><span class="p">(</span><span class="s">&quot;MY_VAR&quot;</span><span class="p">)</span>
<a id="__codelineno-269-26" name="__codelineno-269-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-269-27" name="__codelineno-269-27"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-269-28" name="__codelineno-269-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-269-29" name="__codelineno-269-29"></a>
<a id="__codelineno-269-30" name="__codelineno-269-30"></a><span class="w">    </span><span class="c1">// 尝试获取已删除的环境变量</span>
<a id="__codelineno-269-31" name="__codelineno-269-31"></a><span class="w">    </span><span class="nx">myVar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;MY_VAR&quot;</span><span class="p">)</span>
<a id="__codelineno-269-32" name="__codelineno-269-32"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;MY_VAR after unset:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myVar</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出为空字符串</span>
<a id="__codelineno-269-33" name="__codelineno-269-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-270-1">1</a></span>
<span class="normal"><a href="#__codelineno-270-2">2</a></span>
<span class="normal"><a href="#__codelineno-270-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-270-1" name="__codelineno-270-1"></a>HOME: /home/username
<a id="__codelineno-270-2" name="__codelineno-270-2"></a>MY_VAR: Hello, Environment!
<a id="__codelineno-270-3" name="__codelineno-270-3"></a>MY_VAR after unset:
</code></pre></div></td></tr></table></div>
<p><strong>3. 进程管理与命令行参数</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-271-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-271-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-271-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-271-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-271-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-271-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-271-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-271-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-271-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-271-10">10</a></span>
<span class="normal"><a href="#__codelineno-271-11">11</a></span>
<span class="normal"><a href="#__codelineno-271-12">12</a></span>
<span class="normal"><a href="#__codelineno-271-13">13</a></span>
<span class="normal"><a href="#__codelineno-271-14">14</a></span>
<span class="normal"><a href="#__codelineno-271-15">15</a></span>
<span class="normal"><a href="#__codelineno-271-16">16</a></span>
<span class="normal"><a href="#__codelineno-271-17">17</a></span>
<span class="normal"><a href="#__codelineno-271-18">18</a></span>
<span class="normal"><a href="#__codelineno-271-19">19</a></span>
<span class="normal"><a href="#__codelineno-271-20">20</a></span>
<span class="normal"><a href="#__codelineno-271-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-271-1" name="__codelineno-271-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-271-2" name="__codelineno-271-2"></a>
<a id="__codelineno-271-3" name="__codelineno-271-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-271-4" name="__codelineno-271-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-271-5" name="__codelineno-271-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-271-6" name="__codelineno-271-6"></a><span class="p">)</span>
<a id="__codelineno-271-7" name="__codelineno-271-7"></a>
<a id="__codelineno-271-8" name="__codelineno-271-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-271-9" name="__codelineno-271-9"></a><span class="w">    </span><span class="c1">// 获取命令行参数</span>
<a id="__codelineno-271-10" name="__codelineno-271-10"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span>
<a id="__codelineno-271-11" name="__codelineno-271-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;命令行参数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span>
<a id="__codelineno-271-12" name="__codelineno-271-12"></a>
<a id="__codelineno-271-13" name="__codelineno-271-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-271-14" name="__codelineno-271-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;第一个参数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-271-15" name="__codelineno-271-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-271-16" name="__codelineno-271-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;没有传递任何参数&quot;</span><span class="p">)</span>
<a id="__codelineno-271-17" name="__codelineno-271-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-271-18" name="__codelineno-271-18"></a>
<a id="__codelineno-271-19" name="__codelineno-271-19"></a><span class="w">    </span><span class="c1">// 终止程序</span>
<a id="__codelineno-271-20" name="__codelineno-271-20"></a><span class="w">    </span><span class="c1">// os.Exit(1) // 取消注释将终止程序</span>
<a id="__codelineno-271-21" name="__codelineno-271-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-272-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-272-1" name="__codelineno-272-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>arg1<span class="w"> </span>arg2
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-273-1">1</a></span>
<span class="normal"><a href="#__codelineno-273-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-273-1" name="__codelineno-273-1"></a>命令行参数: [/tmp/go-build123456789/b001/exe/main arg1 arg2]
<a id="__codelineno-273-2" name="__codelineno-273-2"></a>第一个参数: arg1
</code></pre></div></td></tr></table></div>
<p><strong>4. 目录操作</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-274-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-274-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-274-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-274-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-274-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-274-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-274-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-274-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-274-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-274-10">10</a></span>
<span class="normal"><a href="#__codelineno-274-11">11</a></span>
<span class="normal"><a href="#__codelineno-274-12">12</a></span>
<span class="normal"><a href="#__codelineno-274-13">13</a></span>
<span class="normal"><a href="#__codelineno-274-14">14</a></span>
<span class="normal"><a href="#__codelineno-274-15">15</a></span>
<span class="normal"><a href="#__codelineno-274-16">16</a></span>
<span class="normal"><a href="#__codelineno-274-17">17</a></span>
<span class="normal"><a href="#__codelineno-274-18">18</a></span>
<span class="normal"><a href="#__codelineno-274-19">19</a></span>
<span class="normal"><a href="#__codelineno-274-20">20</a></span>
<span class="normal"><a href="#__codelineno-274-21">21</a></span>
<span class="normal"><a href="#__codelineno-274-22">22</a></span>
<span class="normal"><a href="#__codelineno-274-23">23</a></span>
<span class="normal"><a href="#__codelineno-274-24">24</a></span>
<span class="normal"><a href="#__codelineno-274-25">25</a></span>
<span class="normal"><a href="#__codelineno-274-26">26</a></span>
<span class="normal"><a href="#__codelineno-274-27">27</a></span>
<span class="normal"><a href="#__codelineno-274-28">28</a></span>
<span class="normal"><a href="#__codelineno-274-29">29</a></span>
<span class="normal"><a href="#__codelineno-274-30">30</a></span>
<span class="normal"><a href="#__codelineno-274-31">31</a></span>
<span class="normal"><a href="#__codelineno-274-32">32</a></span>
<span class="normal"><a href="#__codelineno-274-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-274-1" name="__codelineno-274-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-274-2" name="__codelineno-274-2"></a>
<a id="__codelineno-274-3" name="__codelineno-274-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-274-4" name="__codelineno-274-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-274-5" name="__codelineno-274-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-274-6" name="__codelineno-274-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-274-7" name="__codelineno-274-7"></a><span class="p">)</span>
<a id="__codelineno-274-8" name="__codelineno-274-8"></a>
<a id="__codelineno-274-9" name="__codelineno-274-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-274-10" name="__codelineno-274-10"></a><span class="w">    </span><span class="nx">dirName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;testdir&quot;</span>
<a id="__codelineno-274-11" name="__codelineno-274-11"></a>
<a id="__codelineno-274-12" name="__codelineno-274-12"></a><span class="w">    </span><span class="c1">// 创建目录</span>
<a id="__codelineno-274-13" name="__codelineno-274-13"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Mkdir</span><span class="p">(</span><span class="nx">dirName</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>
<a id="__codelineno-274-14" name="__codelineno-274-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-274-15" name="__codelineno-274-15"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-274-16" name="__codelineno-274-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-274-17" name="__codelineno-274-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;目录已创建:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dirName</span><span class="p">)</span>
<a id="__codelineno-274-18" name="__codelineno-274-18"></a>
<a id="__codelineno-274-19" name="__codelineno-274-19"></a><span class="w">    </span><span class="c1">// 创建多级目录</span>
<a id="__codelineno-274-20" name="__codelineno-274-20"></a><span class="w">    </span><span class="nx">multiDir</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;parent/child/grandchild&quot;</span>
<a id="__codelineno-274-21" name="__codelineno-274-21"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">MkdirAll</span><span class="p">(</span><span class="nx">multiDir</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>
<a id="__codelineno-274-22" name="__codelineno-274-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-274-23" name="__codelineno-274-23"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-274-24" name="__codelineno-274-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-274-25" name="__codelineno-274-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;多级目录已创建:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">multiDir</span><span class="p">)</span>
<a id="__codelineno-274-26" name="__codelineno-274-26"></a>
<a id="__codelineno-274-27" name="__codelineno-274-27"></a><span class="w">    </span><span class="c1">// 删除目录</span>
<a id="__codelineno-274-28" name="__codelineno-274-28"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">RemoveAll</span><span class="p">(</span><span class="s">&quot;parent&quot;</span><span class="p">)</span>
<a id="__codelineno-274-29" name="__codelineno-274-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-274-30" name="__codelineno-274-30"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-274-31" name="__codelineno-274-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-274-32" name="__codelineno-274-32"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;目录已删除:&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;parent&quot;</span><span class="p">)</span>
<a id="__codelineno-274-33" name="__codelineno-274-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-275-1">1</a></span>
<span class="normal"><a href="#__codelineno-275-2">2</a></span>
<span class="normal"><a href="#__codelineno-275-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-275-1" name="__codelineno-275-1"></a>目录已创建: testdir
<a id="__codelineno-275-2" name="__codelineno-275-2"></a>多级目录已创建: parent/child/grandchild
<a id="__codelineno-275-3" name="__codelineno-275-3"></a>目录已删除: parent
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_5">注意事项<a class="headerlink" href="#注意事项_5" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>权限设置</strong>：在创建文件或目录时，需正确设置权限（<code>os.FileMode</code>），以确保安全性和可访问性。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-276-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-276-1" name="__codelineno-276-1"></a><span class="nx">os</span><span class="p">.</span><span class="nx">Mkdir</span><span class="p">(</span><span class="s">&quot;secure_dir&quot;</span><span class="p">,</span><span class="w"> </span><span class="mo">0700</span><span class="p">)</span><span class="w"> </span><span class="c1">// 仅所有者可读、写、执行</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>路径分隔符</strong>：在跨平台开发时，注意路径分隔符的不同（Windows使用<code>\</code>，Unix/Linux使用<code>/</code>）。可以使用<code>filepath</code>包提供的函数来处理路径。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-277-1">1</a></span>
<span class="normal"><a href="#__codelineno-277-2">2</a></span>
<span class="normal"><a href="#__codelineno-277-3">3</a></span>
<span class="normal"><a href="#__codelineno-277-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-277-1" name="__codelineno-277-1"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;path/filepath&quot;</span>
<a id="__codelineno-277-2" name="__codelineno-277-2"></a>
<a id="__codelineno-277-3" name="__codelineno-277-3"></a><span class="nx">path</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="s">&quot;parent&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;child&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;file.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-277-4" name="__codelineno-277-4"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="c1">// 在Windows上输出: parent\child\file.txt</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>错误处理</strong>：所有文件和目录操作都可能失败，必须检查和处理错误，防止程序崩溃或数据丢失。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-278-1">1</a></span>
<span class="normal"><a href="#__codelineno-278-2">2</a></span>
<span class="normal"><a href="#__codelineno-278-3">3</a></span>
<span class="normal"><a href="#__codelineno-278-4">4</a></span>
<span class="normal"><a href="#__codelineno-278-5">5</a></span>
<span class="normal"><a href="#__codelineno-278-6">6</a></span>
<span class="normal"><a href="#__codelineno-278-7">7</a></span>
<span class="normal"><a href="#__codelineno-278-8">8</a></span>
<span class="normal"><a href="#__codelineno-278-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-278-1" name="__codelineno-278-1"></a><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-278-2" name="__codelineno-278-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-278-3" name="__codelineno-278-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-278-4" name="__codelineno-278-4"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-278-5" name="__codelineno-278-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-278-6" name="__codelineno-278-6"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-278-7" name="__codelineno-278-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-278-8" name="__codelineno-278-8"></a><span class="p">}</span>
<a id="__codelineno-278-9" name="__codelineno-278-9"></a><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="66-bufio-包拓展内容">6.6 <code>bufio</code> 包（拓展内容）<a class="headerlink" href="#66-bufio-包拓展内容" title="Permanent link">&para;</a></h3>
<p>虽然用户没有列出<code>bufio</code>包，但在处理I/O时，使用缓冲可以显著提高效率和性能，因此这里提供对<code>bufio</code>包的简要介绍。</p>
<h4 id="bufio-包简介"><code>bufio</code> 包简介<a class="headerlink" href="#bufio-包简介" title="Permanent link">&para;</a></h4>
<p><code>bufio</code>包提供了带缓冲的I/O操作，允许你以更高效的方式读取和写入数据，尤其适合处理大量数据或需要频繁I/O操作的场景。</p>
<h4 id="常用类型和函数">常用类型和函数<a class="headerlink" href="#常用类型和函数" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>bufio.Reader</code></strong>：带缓冲的读取器，提供了按行、按字节、按特定分隔符读取数据的方法。</li>
<li><code>NewReader(r io.Reader) *Reader</code>: 创建一个新的带缓冲的读取器。</li>
<li><code>ReadString(delim byte) (string, error)</code>: 读取直到指定的分隔符。</li>
<li><code>ReadBytes(delim byte) ([]byte, error)</code>: 读取直到指定的分隔符，返回字节切片。</li>
<li><code>ReadLine() (line []byte, isPrefix bool, err error)</code>: 读取一行，不包括换行符。</li>
<li><strong><code>bufio.Writer</code></strong>：带缓冲的写入器，提供了高效的写入方法。</li>
<li><code>NewWriter(w io.Writer) *Writer</code>: 创建一个新的带缓冲的写入器。</li>
<li><code>WriteString(s string) (int, error)</code>: 写入字符串。</li>
<li><code>Flush() error</code>: 将缓冲区的数据写入底层的<code>io.Writer</code>。</li>
</ul>
<h4 id="示例与用法_6">示例与用法<a class="headerlink" href="#示例与用法_6" title="Permanent link">&para;</a></h4>
<p><strong>1. 使用<code>bufio.Reader</code>读取文件按行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-279-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-279-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-279-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-279-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-279-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-279-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-279-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-279-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-279-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-279-10">10</a></span>
<span class="normal"><a href="#__codelineno-279-11">11</a></span>
<span class="normal"><a href="#__codelineno-279-12">12</a></span>
<span class="normal"><a href="#__codelineno-279-13">13</a></span>
<span class="normal"><a href="#__codelineno-279-14">14</a></span>
<span class="normal"><a href="#__codelineno-279-15">15</a></span>
<span class="normal"><a href="#__codelineno-279-16">16</a></span>
<span class="normal"><a href="#__codelineno-279-17">17</a></span>
<span class="normal"><a href="#__codelineno-279-18">18</a></span>
<span class="normal"><a href="#__codelineno-279-19">19</a></span>
<span class="normal"><a href="#__codelineno-279-20">20</a></span>
<span class="normal"><a href="#__codelineno-279-21">21</a></span>
<span class="normal"><a href="#__codelineno-279-22">22</a></span>
<span class="normal"><a href="#__codelineno-279-23">23</a></span>
<span class="normal"><a href="#__codelineno-279-24">24</a></span>
<span class="normal"><a href="#__codelineno-279-25">25</a></span>
<span class="normal"><a href="#__codelineno-279-26">26</a></span>
<span class="normal"><a href="#__codelineno-279-27">27</a></span>
<span class="normal"><a href="#__codelineno-279-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-279-1" name="__codelineno-279-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-279-2" name="__codelineno-279-2"></a>
<a id="__codelineno-279-3" name="__codelineno-279-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-279-4" name="__codelineno-279-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-279-5" name="__codelineno-279-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-279-6" name="__codelineno-279-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-279-7" name="__codelineno-279-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-279-8" name="__codelineno-279-8"></a><span class="p">)</span>
<a id="__codelineno-279-9" name="__codelineno-279-9"></a>
<a id="__codelineno-279-10" name="__codelineno-279-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-279-11" name="__codelineno-279-11"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-279-12" name="__codelineno-279-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-279-13" name="__codelineno-279-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-279-14" name="__codelineno-279-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-279-15" name="__codelineno-279-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-279-16" name="__codelineno-279-16"></a>
<a id="__codelineno-279-17" name="__codelineno-279-17"></a><span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-279-18" name="__codelineno-279-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-279-19" name="__codelineno-279-19"></a><span class="w">        </span><span class="nx">line</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
<a id="__codelineno-279-20" name="__codelineno-279-20"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-279-21" name="__codelineno-279-21"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;EOF&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-279-22" name="__codelineno-279-22"></a><span class="w">                </span><span class="k">break</span>
<a id="__codelineno-279-23" name="__codelineno-279-23"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-279-24" name="__codelineno-279-24"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-279-25" name="__codelineno-279-25"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-279-26" name="__codelineno-279-26"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span>
<a id="__codelineno-279-27" name="__codelineno-279-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-279-28" name="__codelineno-279-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 使用<code>bufio.Writer</code>写入文件</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-280-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-280-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-280-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-280-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-280-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-280-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-280-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-280-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-280-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-280-10">10</a></span>
<span class="normal"><a href="#__codelineno-280-11">11</a></span>
<span class="normal"><a href="#__codelineno-280-12">12</a></span>
<span class="normal"><a href="#__codelineno-280-13">13</a></span>
<span class="normal"><a href="#__codelineno-280-14">14</a></span>
<span class="normal"><a href="#__codelineno-280-15">15</a></span>
<span class="normal"><a href="#__codelineno-280-16">16</a></span>
<span class="normal"><a href="#__codelineno-280-17">17</a></span>
<span class="normal"><a href="#__codelineno-280-18">18</a></span>
<span class="normal"><a href="#__codelineno-280-19">19</a></span>
<span class="normal"><a href="#__codelineno-280-20">20</a></span>
<span class="normal"><a href="#__codelineno-280-21">21</a></span>
<span class="normal"><a href="#__codelineno-280-22">22</a></span>
<span class="normal"><a href="#__codelineno-280-23">23</a></span>
<span class="normal"><a href="#__codelineno-280-24">24</a></span>
<span class="normal"><a href="#__codelineno-280-25">25</a></span>
<span class="normal"><a href="#__codelineno-280-26">26</a></span>
<span class="normal"><a href="#__codelineno-280-27">27</a></span>
<span class="normal"><a href="#__codelineno-280-28">28</a></span>
<span class="normal"><a href="#__codelineno-280-29">29</a></span>
<span class="normal"><a href="#__codelineno-280-30">30</a></span>
<span class="normal"><a href="#__codelineno-280-31">31</a></span>
<span class="normal"><a href="#__codelineno-280-32">32</a></span>
<span class="normal"><a href="#__codelineno-280-33">33</a></span>
<span class="normal"><a href="#__codelineno-280-34">34</a></span>
<span class="normal"><a href="#__codelineno-280-35">35</a></span>
<span class="normal"><a href="#__codelineno-280-36">36</a></span>
<span class="normal"><a href="#__codelineno-280-37">37</a></span>
<span class="normal"><a href="#__codelineno-280-38">38</a></span>
<span class="normal"><a href="#__codelineno-280-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-280-1" name="__codelineno-280-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-280-2" name="__codelineno-280-2"></a>
<a id="__codelineno-280-3" name="__codelineno-280-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-280-4" name="__codelineno-280-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-280-5" name="__codelineno-280-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-280-6" name="__codelineno-280-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-280-7" name="__codelineno-280-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-280-8" name="__codelineno-280-8"></a><span class="p">)</span>
<a id="__codelineno-280-9" name="__codelineno-280-9"></a>
<a id="__codelineno-280-10" name="__codelineno-280-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-280-11" name="__codelineno-280-11"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-280-12" name="__codelineno-280-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-280-13" name="__codelineno-280-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-280-14" name="__codelineno-280-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-280-15" name="__codelineno-280-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-280-16" name="__codelineno-280-16"></a>
<a id="__codelineno-280-17" name="__codelineno-280-17"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-280-18" name="__codelineno-280-18"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">writer</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;Hello, Buffered World!\n&quot;</span><span class="p">)</span>
<a id="__codelineno-280-19" name="__codelineno-280-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-280-20" name="__codelineno-280-20"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-280-21" name="__codelineno-280-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-280-22" name="__codelineno-280-22"></a>
<a id="__codelineno-280-23" name="__codelineno-280-23"></a><span class="w">    </span><span class="c1">// 写入多个字符串</span>
<a id="__codelineno-280-24" name="__codelineno-280-24"></a><span class="w">    </span><span class="nx">lines</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Line 1\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Line 2\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Line 3\n&quot;</span><span class="p">}</span>
<a id="__codelineno-280-25" name="__codelineno-280-25"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-280-26" name="__codelineno-280-26"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">writer</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span>
<a id="__codelineno-280-27" name="__codelineno-280-27"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-280-28" name="__codelineno-280-28"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-280-29" name="__codelineno-280-29"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-280-30" name="__codelineno-280-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-280-31" name="__codelineno-280-31"></a>
<a id="__codelineno-280-32" name="__codelineno-280-32"></a><span class="w">    </span><span class="c1">// 刷新缓冲区，确保所有数据写入文件</span>
<a id="__codelineno-280-33" name="__codelineno-280-33"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">writer</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span>
<a id="__codelineno-280-34" name="__codelineno-280-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-280-35" name="__codelineno-280-35"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-280-36" name="__codelineno-280-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-280-37" name="__codelineno-280-37"></a>
<a id="__codelineno-280-38" name="__codelineno-280-38"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;写入完成&quot;</span><span class="p">)</span>
<a id="__codelineno-280-39" name="__codelineno-280-39"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 使用<code>bufio.Scanner</code>读取文件按行</strong></p>
<p>虽然不是<code>bufio</code>包的一部分，但<code>bufio.Scanner</code>是常用的按行读取工具。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-281-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-281-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-281-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-281-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-281-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-281-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-281-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-281-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-281-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-281-10">10</a></span>
<span class="normal"><a href="#__codelineno-281-11">11</a></span>
<span class="normal"><a href="#__codelineno-281-12">12</a></span>
<span class="normal"><a href="#__codelineno-281-13">13</a></span>
<span class="normal"><a href="#__codelineno-281-14">14</a></span>
<span class="normal"><a href="#__codelineno-281-15">15</a></span>
<span class="normal"><a href="#__codelineno-281-16">16</a></span>
<span class="normal"><a href="#__codelineno-281-17">17</a></span>
<span class="normal"><a href="#__codelineno-281-18">18</a></span>
<span class="normal"><a href="#__codelineno-281-19">19</a></span>
<span class="normal"><a href="#__codelineno-281-20">20</a></span>
<span class="normal"><a href="#__codelineno-281-21">21</a></span>
<span class="normal"><a href="#__codelineno-281-22">22</a></span>
<span class="normal"><a href="#__codelineno-281-23">23</a></span>
<span class="normal"><a href="#__codelineno-281-24">24</a></span>
<span class="normal"><a href="#__codelineno-281-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-281-1" name="__codelineno-281-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-281-2" name="__codelineno-281-2"></a>
<a id="__codelineno-281-3" name="__codelineno-281-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-281-4" name="__codelineno-281-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-281-5" name="__codelineno-281-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-281-6" name="__codelineno-281-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-281-7" name="__codelineno-281-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-281-8" name="__codelineno-281-8"></a><span class="p">)</span>
<a id="__codelineno-281-9" name="__codelineno-281-9"></a>
<a id="__codelineno-281-10" name="__codelineno-281-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-281-11" name="__codelineno-281-11"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-281-12" name="__codelineno-281-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-281-13" name="__codelineno-281-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-281-14" name="__codelineno-281-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-281-15" name="__codelineno-281-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-281-16" name="__codelineno-281-16"></a>
<a id="__codelineno-281-17" name="__codelineno-281-17"></a><span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-281-18" name="__codelineno-281-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-281-19" name="__codelineno-281-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">())</span>
<a id="__codelineno-281-20" name="__codelineno-281-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-281-21" name="__codelineno-281-21"></a>
<a id="__codelineno-281-22" name="__codelineno-281-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-281-23" name="__codelineno-281-23"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-281-24" name="__codelineno-281-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-281-25" name="__codelineno-281-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_6">注意事项<a class="headerlink" href="#注意事项_6" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>缓冲区大小</strong>：默认情况下，<code>bufio</code>使用4KB的缓冲区。对于特殊需求，可以使用<code>bufio.NewReaderSize</code>和<code>bufio.NewWriterSize</code>自定义缓冲区大小。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-282-1">1</a></span>
<span class="normal"><a href="#__codelineno-282-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-282-1" name="__codelineno-282-1"></a><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReaderSize</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="w"> </span><span class="c1">// 16KB缓冲区</span>
<a id="__codelineno-282-2" name="__codelineno-282-2"></a><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewWriterSize</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><strong>及时刷新</strong>：在使用<code>bufio.Writer</code>时，务必调用<code>Flush</code>方法，确保缓冲区中的数据被写入底层的<code>io.Writer</code>。</p>
</li>
<li>
<p><strong>错误处理</strong>：在读取和写入过程中，注意检查和处理错误，确保程序的健壮性。</p>
</li>
</ul>
<h2 id="7-数据结构与集合">7. 数据结构与集合<a class="headerlink" href="#7-数据结构与集合" title="Permanent link">&para;</a></h2>
<p>数据结构是编程中用于组织和存储数据的方式，直接影响程序的效率和性能。Go语言提供了多种内置的数据结构，如数组、切片、Map和结构体，支持不同类型的数据管理和操作。本章将详细介绍Go语言中的主要数据结构与集合，涵盖它们的定义、使用方法、操作技巧以及底层原理。通过丰富的示例和深入的解释，帮助你全面掌握Go语言的数据结构，为构建高效、可维护的程序奠定坚实的基础。</p>
<h3 id="71-数组">7.1 数组<a class="headerlink" href="#71-数组" title="Permanent link">&para;</a></h3>
<p>数组是具有固定大小和相同类型元素的有序集合。在Go语言中，数组的长度是其类型的一部分，这意味着具有不同长度的数组属于不同的类型。</p>
<h4 id="数组的声明与初始化">数组的声明与初始化<a class="headerlink" href="#数组的声明与初始化" title="Permanent link">&para;</a></h4>
<p><strong>1. 声明数组</strong></p>
<p>使用<code>var</code>关键字声明数组时，需要指定数组的长度和元素类型。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-283-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-283-1" name="__codelineno-283-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>arr</code>是一个长度为5的整型数组。</li>
<li>所有元素默认初始化为0。</li>
</ul>
<p><strong>2. 声明并初始化数组</strong></p>
<p>可以在声明数组的同时为其元素赋值。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-284-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-284-1" name="__codelineno-284-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">string</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cherry&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>简化声明：</strong></p>
<p>当声明和初始化数组时，Go可以根据初始化的元素数量自动推断数组的长度。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-285-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-285-1" name="__codelineno-285-1"></a><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cherry&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>使用省略长度</strong></p>
<p>通过使用<code>...</code>，Go可以根据初始化的元素数量自动确定数组的长度。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-286-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-286-1" name="__codelineno-286-1"></a><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">float64</span><span class="p">{</span><span class="mf">1.1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.2</span><span class="p">,</span><span class="w"> </span><span class="mf">3.3</span><span class="p">,</span><span class="w"> </span><span class="mf">4.4</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 多维数组</strong></p>
<p>Go支持多维数组，最常见的是二维数组。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-287-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-287-1" name="__codelineno-287-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">matrix</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="kt">int</span>
</code></pre></div></td></tr></table></div>
<p><strong>初始化二维数组：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-288-1">1</a></span>
<span class="normal"><a href="#__codelineno-288-2">2</a></span>
<span class="normal"><a href="#__codelineno-288-3">3</a></span>
<span class="normal"><a href="#__codelineno-288-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-288-1" name="__codelineno-288-1"></a><span class="nx">matrix</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span>
<a id="__codelineno-288-2" name="__codelineno-288-2"></a><span class="w">    </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<a id="__codelineno-288-3" name="__codelineno-288-3"></a><span class="w">    </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span>
<a id="__codelineno-288-4" name="__codelineno-288-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>完整示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-289-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-289-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-289-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-289-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-289-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-289-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-289-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-289-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-289-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-289-10">10</a></span>
<span class="normal"><a href="#__codelineno-289-11">11</a></span>
<span class="normal"><a href="#__codelineno-289-12">12</a></span>
<span class="normal"><a href="#__codelineno-289-13">13</a></span>
<span class="normal"><a href="#__codelineno-289-14">14</a></span>
<span class="normal"><a href="#__codelineno-289-15">15</a></span>
<span class="normal"><a href="#__codelineno-289-16">16</a></span>
<span class="normal"><a href="#__codelineno-289-17">17</a></span>
<span class="normal"><a href="#__codelineno-289-18">18</a></span>
<span class="normal"><a href="#__codelineno-289-19">19</a></span>
<span class="normal"><a href="#__codelineno-289-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-289-1" name="__codelineno-289-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-289-2" name="__codelineno-289-2"></a>
<a id="__codelineno-289-3" name="__codelineno-289-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-289-4" name="__codelineno-289-4"></a>
<a id="__codelineno-289-5" name="__codelineno-289-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-289-6" name="__codelineno-289-6"></a><span class="w">    </span><span class="c1">// 声明并初始化一维数组</span>
<a id="__codelineno-289-7" name="__codelineno-289-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-289-8" name="__codelineno-289-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;一维数组:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">)</span>
<a id="__codelineno-289-9" name="__codelineno-289-9"></a>
<a id="__codelineno-289-10" name="__codelineno-289-10"></a><span class="w">    </span><span class="c1">// 使用省略长度声明数组</span>
<a id="__codelineno-289-11" name="__codelineno-289-11"></a><span class="w">    </span><span class="nx">arr2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">}</span>
<a id="__codelineno-289-12" name="__codelineno-289-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;省略长度的一维数组:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr2</span><span class="p">)</span>
<a id="__codelineno-289-13" name="__codelineno-289-13"></a>
<a id="__codelineno-289-14" name="__codelineno-289-14"></a><span class="w">    </span><span class="c1">// 声明并初始化二维数组</span>
<a id="__codelineno-289-15" name="__codelineno-289-15"></a><span class="w">    </span><span class="nx">matrix</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span>
<a id="__codelineno-289-16" name="__codelineno-289-16"></a><span class="w">        </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<a id="__codelineno-289-17" name="__codelineno-289-17"></a><span class="w">        </span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">},</span>
<a id="__codelineno-289-18" name="__codelineno-289-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-289-19" name="__codelineno-289-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;二维数组:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">matrix</span><span class="p">)</span>
<a id="__codelineno-289-20" name="__codelineno-289-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-290-1">1</a></span>
<span class="normal"><a href="#__codelineno-290-2">2</a></span>
<span class="normal"><a href="#__codelineno-290-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-290-1" name="__codelineno-290-1"></a>一维数组: [1 2 3 4 5]
<a id="__codelineno-290-2" name="__codelineno-290-2"></a>省略长度的一维数组: [Go Python Java]
<a id="__codelineno-290-3" name="__codelineno-290-3"></a>二维数组: [[1 2 3] [4 5 6]]
</code></pre></div></td></tr></table></div>
<h4 id="数组的操作">数组的操作<a class="headerlink" href="#数组的操作" title="Permanent link">&para;</a></h4>
<p><strong>1. 访问数组元素</strong></p>
<p>通过索引访问数组元素，索引从0开始。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-291-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-291-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-291-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-291-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-291-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-291-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-291-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-291-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-291-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-291-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-291-1" name="__codelineno-291-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-291-2" name="__codelineno-291-2"></a>
<a id="__codelineno-291-3" name="__codelineno-291-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-291-4" name="__codelineno-291-4"></a>
<a id="__codelineno-291-5" name="__codelineno-291-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-291-6" name="__codelineno-291-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cherry&quot;</span><span class="p">}</span>
<a id="__codelineno-291-7" name="__codelineno-291-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;第一个元素:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="c1">// 输出: apple</span>
<a id="__codelineno-291-8" name="__codelineno-291-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;第二个元素:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="c1">// 输出: banana</span>
<a id="__codelineno-291-9" name="__codelineno-291-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;第三个元素:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="c1">// 输出: cherry</span>
<a id="__codelineno-291-10" name="__codelineno-291-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 修改数组元素</strong></p>
<p>数组元素是可修改的，只需通过索引赋值。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-292-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-292-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-292-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-292-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-292-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-292-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-292-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-292-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-292-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-292-10">10</a></span>
<span class="normal"><a href="#__codelineno-292-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-292-1" name="__codelineno-292-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-292-2" name="__codelineno-292-2"></a>
<a id="__codelineno-292-3" name="__codelineno-292-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-292-4" name="__codelineno-292-4"></a>
<a id="__codelineno-292-5" name="__codelineno-292-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-292-6" name="__codelineno-292-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span>
<a id="__codelineno-292-7" name="__codelineno-292-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原数组:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">)</span>
<a id="__codelineno-292-8" name="__codelineno-292-8"></a>
<a id="__codelineno-292-9" name="__codelineno-292-9"></a><span class="w">    </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">25</span>
<a id="__codelineno-292-10" name="__codelineno-292-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的数组:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [10 25 30]</span>
<a id="__codelineno-292-11" name="__codelineno-292-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 遍历数组</strong></p>
<p>使用<code>for</code>循环或<code>range</code>关键字遍历数组。</p>
<p><strong>使用传统<code>for</code>循环：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-293-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-293-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-293-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-293-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-293-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-293-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-293-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-293-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-293-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-293-10">10</a></span>
<span class="normal"><a href="#__codelineno-293-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-293-1" name="__codelineno-293-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-293-2" name="__codelineno-293-2"></a>
<a id="__codelineno-293-3" name="__codelineno-293-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-293-4" name="__codelineno-293-4"></a>
<a id="__codelineno-293-5" name="__codelineno-293-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-293-6" name="__codelineno-293-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cherry&quot;</span><span class="p">}</span>
<a id="__codelineno-293-7" name="__codelineno-293-7"></a>
<a id="__codelineno-293-8" name="__codelineno-293-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-293-9" name="__codelineno-293-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;元素 %d: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
<a id="__codelineno-293-10" name="__codelineno-293-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-293-11" name="__codelineno-293-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>使用<code>range</code>遍历：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-294-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-294-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-294-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-294-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-294-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-294-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-294-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-294-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-294-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-294-10">10</a></span>
<span class="normal"><a href="#__codelineno-294-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-294-1" name="__codelineno-294-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-294-2" name="__codelineno-294-2"></a>
<a id="__codelineno-294-3" name="__codelineno-294-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-294-4" name="__codelineno-294-4"></a>
<a id="__codelineno-294-5" name="__codelineno-294-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-294-6" name="__codelineno-294-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cherry&quot;</span><span class="p">}</span>
<a id="__codelineno-294-7" name="__codelineno-294-7"></a>
<a id="__codelineno-294-8" name="__codelineno-294-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-294-9" name="__codelineno-294-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;元素 %d: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">)</span>
<a id="__codelineno-294-10" name="__codelineno-294-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-294-11" name="__codelineno-294-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 数组长度</strong></p>
<p>数组的长度是其类型的一部分，可以通过<code>len</code>函数获取。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-295-1">1</a></span>
<span class="normal"><a href="#__codelineno-295-2">2</a></span>
<span class="normal"><a href="#__codelineno-295-3">3</a></span>
<span class="normal"><a href="#__codelineno-295-4">4</a></span>
<span class="normal"><a href="#__codelineno-295-5">5</a></span>
<span class="normal"><a href="#__codelineno-295-6">6</a></span>
<span class="normal"><a href="#__codelineno-295-7">7</a></span>
<span class="normal"><a href="#__codelineno-295-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-295-1" name="__codelineno-295-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-295-2" name="__codelineno-295-2"></a>
<a id="__codelineno-295-3" name="__codelineno-295-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-295-4" name="__codelineno-295-4"></a>
<a id="__codelineno-295-5" name="__codelineno-295-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-295-6" name="__codelineno-295-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-295-7" name="__codelineno-295-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;数组长度:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">arr</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: 5</span>
<a id="__codelineno-295-8" name="__codelineno-295-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>5. 数组作为函数参数</strong></p>
<p>在Go中，数组作为函数参数时，会复制整个数组。因此，对于大数组，推荐使用指针或切片。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-296-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-296-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-296-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-296-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-296-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-296-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-296-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-296-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-296-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-296-10">10</a></span>
<span class="normal"><a href="#__codelineno-296-11">11</a></span>
<span class="normal"><a href="#__codelineno-296-12">12</a></span>
<span class="normal"><a href="#__codelineno-296-13">13</a></span>
<span class="normal"><a href="#__codelineno-296-14">14</a></span>
<span class="normal"><a href="#__codelineno-296-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-296-1" name="__codelineno-296-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-296-2" name="__codelineno-296-2"></a>
<a id="__codelineno-296-3" name="__codelineno-296-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-296-4" name="__codelineno-296-4"></a>
<a id="__codelineno-296-5" name="__codelineno-296-5"></a><span class="c1">// 函数接收数组参数</span>
<a id="__codelineno-296-6" name="__codelineno-296-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">printArray</span><span class="p">(</span><span class="nx">arr</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-296-7" name="__codelineno-296-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">arr</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-296-8" name="__codelineno-296-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-296-9" name="__codelineno-296-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-296-10" name="__codelineno-296-10"></a><span class="p">}</span>
<a id="__codelineno-296-11" name="__codelineno-296-11"></a>
<a id="__codelineno-296-12" name="__codelineno-296-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-296-13" name="__codelineno-296-13"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-296-14" name="__codelineno-296-14"></a><span class="w">    </span><span class="nx">printArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span>
<a id="__codelineno-296-15" name="__codelineno-296-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-297-1">1</a></span>
<span class="normal"><a href="#__codelineno-297-2">2</a></span>
<span class="normal"><a href="#__codelineno-297-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-297-1" name="__codelineno-297-1"></a>1
<a id="__codelineno-297-2" name="__codelineno-297-2"></a>2
<a id="__codelineno-297-3" name="__codelineno-297-3"></a>3
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_7">注意事项<a class="headerlink" href="#注意事项_7" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>固定长度</strong>：数组的长度在声明时固定，无法动态改变。如果需要动态长度，建议使用切片。</p>
</li>
<li>
<p><strong>类型区别</strong>：不同长度的数组属于不同类型，即<code>[3]int</code>与<code>[4]int</code>是不同的类型。</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-298-1">1</a></span>
<span class="normal"><a href="#__codelineno-298-2">2</a></span>
<span class="normal"><a href="#__codelineno-298-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-298-1" name="__codelineno-298-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span>
<a id="__codelineno-298-2" name="__codelineno-298-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="kt">int</span>
<a id="__codelineno-298-3" name="__codelineno-298-3"></a><span class="c1">// a = b // 编译错误: cannot use b (type [4]int) as type [3]int in assignment</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>数组拷贝</strong>：数组作为值类型会被复制。因此，在函数中修改数组不会影响原数组，除非使用指针传递。</li>
</ul>
<h3 id="72-切片">7.2 切片<a class="headerlink" href="#72-切片" title="Permanent link">&para;</a></h3>
<p>切片是基于数组的动态数据结构，比数组更灵活和强大。切片的长度和容量可以动态变化，是Go语言中最常用的数据结构之一。</p>
<h4 id="切片的声明与初始化">切片的声明与初始化<a class="headerlink" href="#切片的声明与初始化" title="Permanent link">&para;</a></h4>
<p><strong>1. 声明切片</strong></p>
<p>切片不需要在声明时指定长度，可以通过多种方式声明。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-299-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-299-1" name="__codelineno-299-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>s</code>是一个整型切片，初始为<code>nil</code>。</li>
</ul>
<p><strong>2. 使用<code>make</code>函数创建切片</strong></p>
<p><code>make</code>函数用于创建切片、Map和Channel。对于切片，<code>make</code>需要指定类型、长度和可选的容量。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-300-1">1</a></span>
<span class="normal"><a href="#__codelineno-300-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-300-1" name="__codelineno-300-1"></a><span class="nx">s1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">          </span><span class="c1">// 长度为5，容量为5，元素初始化为0</span>
<a id="__codelineno-300-2" name="__codelineno-300-2"></a><span class="nx">s2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w">      </span><span class="c1">// 长度为3，容量为10</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 字面量初始化</strong></p>
<p>可以在声明时通过字面量赋值初始化切片。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-301-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-301-1" name="__codelineno-301-1"></a><span class="nx">s3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 从数组或其他切片创建切片</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-302-1">1</a></span>
<span class="normal"><a href="#__codelineno-302-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-302-1" name="__codelineno-302-1"></a><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-302-2" name="__codelineno-302-2"></a><span class="nx">s4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="c1">// 包含索引1、2、3，即 [2, 3, 4]</span>
</code></pre></div></td></tr></table></div>
<p><strong>5. 使用<code>append</code>函数扩展切片</strong></p>
<p>切片的长度可以通过<code>append</code>函数动态增长。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-303-1">1</a></span>
<span class="normal"><a href="#__codelineno-303-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-303-1" name="__codelineno-303-1"></a><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-303-2" name="__codelineno-303-2"></a><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c1">// s现在为 [1, 2, 3, 4, 5]</span>
</code></pre></div></td></tr></table></div>
<p><strong>完整示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-304-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-304-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-304-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-304-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-304-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-304-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-304-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-304-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-304-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-304-10">10</a></span>
<span class="normal"><a href="#__codelineno-304-11">11</a></span>
<span class="normal"><a href="#__codelineno-304-12">12</a></span>
<span class="normal"><a href="#__codelineno-304-13">13</a></span>
<span class="normal"><a href="#__codelineno-304-14">14</a></span>
<span class="normal"><a href="#__codelineno-304-15">15</a></span>
<span class="normal"><a href="#__codelineno-304-16">16</a></span>
<span class="normal"><a href="#__codelineno-304-17">17</a></span>
<span class="normal"><a href="#__codelineno-304-18">18</a></span>
<span class="normal"><a href="#__codelineno-304-19">19</a></span>
<span class="normal"><a href="#__codelineno-304-20">20</a></span>
<span class="normal"><a href="#__codelineno-304-21">21</a></span>
<span class="normal"><a href="#__codelineno-304-22">22</a></span>
<span class="normal"><a href="#__codelineno-304-23">23</a></span>
<span class="normal"><a href="#__codelineno-304-24">24</a></span>
<span class="normal"><a href="#__codelineno-304-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-304-1" name="__codelineno-304-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-304-2" name="__codelineno-304-2"></a>
<a id="__codelineno-304-3" name="__codelineno-304-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-304-4" name="__codelineno-304-4"></a>
<a id="__codelineno-304-5" name="__codelineno-304-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-304-6" name="__codelineno-304-6"></a><span class="w">    </span><span class="c1">// 使用make创建切片</span>
<a id="__codelineno-304-7" name="__codelineno-304-7"></a><span class="w">    </span><span class="nx">s1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-304-8" name="__codelineno-304-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;s1:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [0 0 0 0 0]</span>
<a id="__codelineno-304-9" name="__codelineno-304-9"></a>
<a id="__codelineno-304-10" name="__codelineno-304-10"></a><span class="w">    </span><span class="nx">s2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-304-11" name="__codelineno-304-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;s2:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [0 0 0]</span>
<a id="__codelineno-304-12" name="__codelineno-304-12"></a>
<a id="__codelineno-304-13" name="__codelineno-304-13"></a><span class="w">    </span><span class="c1">// 字面量初始化</span>
<a id="__codelineno-304-14" name="__codelineno-304-14"></a><span class="w">    </span><span class="nx">s3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Java&quot;</span><span class="p">}</span>
<a id="__codelineno-304-15" name="__codelineno-304-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;s3:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [Go Python Java]</span>
<a id="__codelineno-304-16" name="__codelineno-304-16"></a>
<a id="__codelineno-304-17" name="__codelineno-304-17"></a><span class="w">    </span><span class="c1">// 从数组创建切片</span>
<a id="__codelineno-304-18" name="__codelineno-304-18"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-304-19" name="__codelineno-304-19"></a><span class="w">    </span><span class="nx">s4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-304-20" name="__codelineno-304-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;s4:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s4</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [2 3 4]</span>
<a id="__codelineno-304-21" name="__codelineno-304-21"></a>
<a id="__codelineno-304-22" name="__codelineno-304-22"></a><span class="w">    </span><span class="c1">// 使用append扩展切片</span>
<a id="__codelineno-304-23" name="__codelineno-304-23"></a><span class="w">    </span><span class="nx">s4</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-304-24" name="__codelineno-304-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;s4 after append:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s4</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [2 3 4 6 7]</span>
<a id="__codelineno-304-25" name="__codelineno-304-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-305-1">1</a></span>
<span class="normal"><a href="#__codelineno-305-2">2</a></span>
<span class="normal"><a href="#__codelineno-305-3">3</a></span>
<span class="normal"><a href="#__codelineno-305-4">4</a></span>
<span class="normal"><a href="#__codelineno-305-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-305-1" name="__codelineno-305-1"></a>s1: [0 0 0 0 0]
<a id="__codelineno-305-2" name="__codelineno-305-2"></a>s2: [0 0 0]
<a id="__codelineno-305-3" name="__codelineno-305-3"></a>s3: [Go Python Java]
<a id="__codelineno-305-4" name="__codelineno-305-4"></a>s4: [2 3 4]
<a id="__codelineno-305-5" name="__codelineno-305-5"></a>s4 after append: [2 3 4 6 7]
</code></pre></div></td></tr></table></div>
<h4 id="切片的操作">切片的操作<a class="headerlink" href="#切片的操作" title="Permanent link">&para;</a></h4>
<p><strong>1. 添加元素</strong></p>
<p>使用<code>append</code>函数向切片添加元素，可以添加单个或多个元素。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-306-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-306-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-306-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-306-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-306-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-306-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-306-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-306-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-306-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-306-10">10</a></span>
<span class="normal"><a href="#__codelineno-306-11">11</a></span>
<span class="normal"><a href="#__codelineno-306-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-306-1" name="__codelineno-306-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-306-2" name="__codelineno-306-2"></a>
<a id="__codelineno-306-3" name="__codelineno-306-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-306-4" name="__codelineno-306-4"></a>
<a id="__codelineno-306-5" name="__codelineno-306-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-306-6" name="__codelineno-306-6"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-306-7" name="__codelineno-306-7"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-306-8" name="__codelineno-306-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;添加一个元素:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [1 2 3 4]</span>
<a id="__codelineno-306-9" name="__codelineno-306-9"></a>
<a id="__codelineno-306-10" name="__codelineno-306-10"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-306-11" name="__codelineno-306-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;添加多个元素:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [1 2 3 4 5 6]</span>
<a id="__codelineno-306-12" name="__codelineno-306-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 删除元素</strong></p>
<p>Go语言没有内置的删除函数，但可以通过切片操作实现。</p>
<p><strong>示例：删除索引为2的元素</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-307-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-307-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-307-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-307-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-307-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-307-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-307-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-307-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-307-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-307-10">10</a></span>
<span class="normal"><a href="#__codelineno-307-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-307-1" name="__codelineno-307-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-307-2" name="__codelineno-307-2"></a>
<a id="__codelineno-307-3" name="__codelineno-307-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-307-4" name="__codelineno-307-4"></a>
<a id="__codelineno-307-5" name="__codelineno-307-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-307-6" name="__codelineno-307-6"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-307-7" name="__codelineno-307-7"></a><span class="w">    </span><span class="nx">index</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="c1">// 删除元素3</span>
<a id="__codelineno-307-8" name="__codelineno-307-8"></a>
<a id="__codelineno-307-9" name="__codelineno-307-9"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">[:</span><span class="nx">index</span><span class="p">],</span><span class="w"> </span><span class="nx">s</span><span class="p">[</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-307-10" name="__codelineno-307-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;删除元素后的切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [1 2 4 5]</span>
<a id="__codelineno-307-11" name="__codelineno-307-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 修改元素</strong></p>
<p>直接通过索引修改切片中的元素。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-308-1">1</a></span>
<span class="normal"><a href="#__codelineno-308-2">2</a></span>
<span class="normal"><a href="#__codelineno-308-3">3</a></span>
<span class="normal"><a href="#__codelineno-308-4">4</a></span>
<span class="normal"><a href="#__codelineno-308-5">5</a></span>
<span class="normal"><a href="#__codelineno-308-6">6</a></span>
<span class="normal"><a href="#__codelineno-308-7">7</a></span>
<span class="normal"><a href="#__codelineno-308-8">8</a></span>
<span class="normal"><a href="#__codelineno-308-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-308-1" name="__codelineno-308-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-308-2" name="__codelineno-308-2"></a>
<a id="__codelineno-308-3" name="__codelineno-308-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-308-4" name="__codelineno-308-4"></a>
<a id="__codelineno-308-5" name="__codelineno-308-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-308-6" name="__codelineno-308-6"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cherry&quot;</span><span class="p">}</span>
<a id="__codelineno-308-7" name="__codelineno-308-7"></a><span class="w">    </span><span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;blueberry&quot;</span>
<a id="__codelineno-308-8" name="__codelineno-308-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [apple blueberry cherry]</span>
<a id="__codelineno-308-9" name="__codelineno-308-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 切片截取</strong></p>
<p>通过切片操作可以创建子切片，指定起始和结束索引。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-309-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-309-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-309-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-309-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-309-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-309-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-309-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-309-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-309-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-309-10">10</a></span>
<span class="normal"><a href="#__codelineno-309-11">11</a></span>
<span class="normal"><a href="#__codelineno-309-12">12</a></span>
<span class="normal"><a href="#__codelineno-309-13">13</a></span>
<span class="normal"><a href="#__codelineno-309-14">14</a></span>
<span class="normal"><a href="#__codelineno-309-15">15</a></span>
<span class="normal"><a href="#__codelineno-309-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-309-1" name="__codelineno-309-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-309-2" name="__codelineno-309-2"></a>
<a id="__codelineno-309-3" name="__codelineno-309-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-309-4" name="__codelineno-309-4"></a>
<a id="__codelineno-309-5" name="__codelineno-309-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-309-6" name="__codelineno-309-6"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">}</span>
<a id="__codelineno-309-7" name="__codelineno-309-7"></a>
<a id="__codelineno-309-8" name="__codelineno-309-8"></a><span class="w">    </span><span class="nx">sub1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-309-9" name="__codelineno-309-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;sub1:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sub1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [20 30 40]</span>
<a id="__codelineno-309-10" name="__codelineno-309-10"></a>
<a id="__codelineno-309-11" name="__codelineno-309-11"></a><span class="w">    </span><span class="nx">sub2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-309-12" name="__codelineno-309-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;sub2:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sub2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [10 20 30]</span>
<a id="__codelineno-309-13" name="__codelineno-309-13"></a>
<a id="__codelineno-309-14" name="__codelineno-309-14"></a><span class="w">    </span><span class="nx">sub3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<a id="__codelineno-309-15" name="__codelineno-309-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;sub3:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sub3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [30 40 50]</span>
<a id="__codelineno-309-16" name="__codelineno-309-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>5. 复制切片</strong></p>
<p>使用<code>copy</code>函数复制切片内容。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-310-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-310-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-310-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-310-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-310-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-310-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-310-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-310-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-310-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-310-10">10</a></span>
<span class="normal"><a href="#__codelineno-310-11">11</a></span>
<span class="normal"><a href="#__codelineno-310-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-310-1" name="__codelineno-310-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-310-2" name="__codelineno-310-2"></a>
<a id="__codelineno-310-3" name="__codelineno-310-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-310-4" name="__codelineno-310-4"></a>
<a id="__codelineno-310-5" name="__codelineno-310-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-310-6" name="__codelineno-310-6"></a><span class="w">    </span><span class="nx">src</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-310-7" name="__codelineno-310-7"></a><span class="w">    </span><span class="nx">dst</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">src</span><span class="p">))</span>
<a id="__codelineno-310-8" name="__codelineno-310-8"></a>
<a id="__codelineno-310-9" name="__codelineno-310-9"></a><span class="w">    </span><span class="nb">copy</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span><span class="w"> </span><span class="nx">src</span><span class="p">)</span>
<a id="__codelineno-310-10" name="__codelineno-310-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;源切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">src</span><span class="p">)</span>
<a id="__codelineno-310-11" name="__codelineno-310-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;目标切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dst</span><span class="p">)</span>
<a id="__codelineno-310-12" name="__codelineno-310-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-311-1">1</a></span>
<span class="normal"><a href="#__codelineno-311-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-311-1" name="__codelineno-311-1"></a>源切片: [1 2 3 4 5]
<a id="__codelineno-311-2" name="__codelineno-311-2"></a>目标切片: [1 2 3 4 5]
</code></pre></div></td></tr></table></div>
<p><strong>6. 切片的容量</strong></p>
<p>切片的容量是从切片的起始位置到底层数组末尾的元素数量。使用<code>cap</code>函数可以获取切片的容量。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-312-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-312-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-312-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-312-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-312-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-312-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-312-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-312-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-312-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-312-10">10</a></span>
<span class="normal"><a href="#__codelineno-312-11">11</a></span>
<span class="normal"><a href="#__codelineno-312-12">12</a></span>
<span class="normal"><a href="#__codelineno-312-13">13</a></span>
<span class="normal"><a href="#__codelineno-312-14">14</a></span>
<span class="normal"><a href="#__codelineno-312-15">15</a></span>
<span class="normal"><a href="#__codelineno-312-16">16</a></span>
<span class="normal"><a href="#__codelineno-312-17">17</a></span>
<span class="normal"><a href="#__codelineno-312-18">18</a></span>
<span class="normal"><a href="#__codelineno-312-19">19</a></span>
<span class="normal"><a href="#__codelineno-312-20">20</a></span>
<span class="normal"><a href="#__codelineno-312-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-312-1" name="__codelineno-312-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-312-2" name="__codelineno-312-2"></a>
<a id="__codelineno-312-3" name="__codelineno-312-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-312-4" name="__codelineno-312-4"></a>
<a id="__codelineno-312-5" name="__codelineno-312-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-312-6" name="__codelineno-312-6"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-312-7" name="__codelineno-312-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w">              </span><span class="c1">// 输出: [0 0 0]</span>
<a id="__codelineno-312-8" name="__codelineno-312-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;长度:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w">        </span><span class="c1">// 输出: 3</span>
<a id="__codelineno-312-9" name="__codelineno-312-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;容量:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w">        </span><span class="c1">// 输出: 5</span>
<a id="__codelineno-312-10" name="__codelineno-312-10"></a>
<a id="__codelineno-312-11" name="__codelineno-312-11"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-312-12" name="__codelineno-312-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;切片 after append:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [0 0 0 1 2]</span>
<a id="__codelineno-312-13" name="__codelineno-312-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;长度:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w">          </span><span class="c1">// 输出: 5</span>
<a id="__codelineno-312-14" name="__codelineno-312-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;容量:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w">          </span><span class="c1">// 输出: 5</span>
<a id="__codelineno-312-15" name="__codelineno-312-15"></a>
<a id="__codelineno-312-16" name="__codelineno-312-16"></a><span class="w">    </span><span class="c1">// 再次添加元素，容量会自动增长</span>
<a id="__codelineno-312-17" name="__codelineno-312-17"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-312-18" name="__codelineno-312-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;切片 after second append:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [0 0 0 1 2 3]</span>
<a id="__codelineno-312-19" name="__codelineno-312-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;长度:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w">                </span><span class="c1">// 输出: 6</span>
<a id="__codelineno-312-20" name="__codelineno-312-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;容量:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w">                </span><span class="c1">// 输出: 10 (通常会翻倍)</span>
<a id="__codelineno-312-21" name="__codelineno-312-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-313-1">1</a></span>
<span class="normal"><a href="#__codelineno-313-2">2</a></span>
<span class="normal"><a href="#__codelineno-313-3">3</a></span>
<span class="normal"><a href="#__codelineno-313-4">4</a></span>
<span class="normal"><a href="#__codelineno-313-5">5</a></span>
<span class="normal"><a href="#__codelineno-313-6">6</a></span>
<span class="normal"><a href="#__codelineno-313-7">7</a></span>
<span class="normal"><a href="#__codelineno-313-8">8</a></span>
<span class="normal"><a href="#__codelineno-313-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-313-1" name="__codelineno-313-1"></a>切片: [0 0 0]
<a id="__codelineno-313-2" name="__codelineno-313-2"></a>长度: 3
<a id="__codelineno-313-3" name="__codelineno-313-3"></a>容量: 5
<a id="__codelineno-313-4" name="__codelineno-313-4"></a>切片 after append: [0 0 0 1 2]
<a id="__codelineno-313-5" name="__codelineno-313-5"></a>长度: 5
<a id="__codelineno-313-6" name="__codelineno-313-6"></a>容量: 5
<a id="__codelineno-313-7" name="__codelineno-313-7"></a>切片 after second append: [0 0 0 1 2 3]
<a id="__codelineno-313-8" name="__codelineno-313-8"></a>长度: 6
<a id="__codelineno-313-9" name="__codelineno-313-9"></a>容量: 10
</code></pre></div></td></tr></table></div>
<h4 id="切片的底层原理">切片的底层原理<a class="headerlink" href="#切片的底层原理" title="Permanent link">&para;</a></h4>
<p>切片在Go语言中是一个引用类型，包含三个部分：</p>
<ol>
<li><strong>指针</strong>：指向底层数组的第一个元素。</li>
<li><strong>长度</strong>（len）：切片中的元素数量。</li>
<li><strong>容量</strong>（cap）：从切片的起始位置到底层数组末尾的元素数量。</li>
</ol>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-314-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-314-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-314-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-314-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-314-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-314-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-314-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-314-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-314-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-314-10">10</a></span>
<span class="normal"><a href="#__codelineno-314-11">11</a></span>
<span class="normal"><a href="#__codelineno-314-12">12</a></span>
<span class="normal"><a href="#__codelineno-314-13">13</a></span>
<span class="normal"><a href="#__codelineno-314-14">14</a></span>
<span class="normal"><a href="#__codelineno-314-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-314-1" name="__codelineno-314-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-314-2" name="__codelineno-314-2"></a>
<a id="__codelineno-314-3" name="__codelineno-314-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-314-4" name="__codelineno-314-4"></a>
<a id="__codelineno-314-5" name="__codelineno-314-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-314-6" name="__codelineno-314-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-314-7" name="__codelineno-314-7"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-314-8" name="__codelineno-314-8"></a>
<a id="__codelineno-314-9" name="__codelineno-314-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;数组: %v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">)</span>
<a id="__codelineno-314-10" name="__codelineno-314-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;切片: %v, len=%d, cap=%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: [2 3 4], len=3, cap=4</span>
<a id="__codelineno-314-11" name="__codelineno-314-11"></a>
<a id="__codelineno-314-12" name="__codelineno-314-12"></a><span class="w">    </span><span class="c1">// 修改切片中的元素</span>
<a id="__codelineno-314-13" name="__codelineno-314-13"></a><span class="w">    </span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-314-14" name="__codelineno-314-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的数组:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [1 20 3 4 5]</span>
<a id="__codelineno-314-15" name="__codelineno-314-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-315-1">1</a></span>
<span class="normal"><a href="#__codelineno-315-2">2</a></span>
<span class="normal"><a href="#__codelineno-315-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-315-1" name="__codelineno-315-1"></a>数组: [1 2 3 4 5]
<a id="__codelineno-315-2" name="__codelineno-315-2"></a>切片: [2 3 4], len=3, cap=4
<a id="__codelineno-315-3" name="__codelineno-315-3"></a>修改后的数组: [1 20 3 4 5]
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>切片<code>s</code>指向数组<code>arr</code>的索引1到3。</li>
<li>修改切片中的元素也会影响底层数组。</li>
</ul>
<p><strong>容量的影响：</strong></p>
<ul>
<li>当切片的容量足够时，使用<code>append</code>不会重新分配底层数组。</li>
<li>当容量不足时，<code>append</code>会分配一个新的底层数组，将原有数据复制过来。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-316-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-316-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-316-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-316-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-316-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-316-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-316-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-316-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-316-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-316-10">10</a></span>
<span class="normal"><a href="#__codelineno-316-11">11</a></span>
<span class="normal"><a href="#__codelineno-316-12">12</a></span>
<span class="normal"><a href="#__codelineno-316-13">13</a></span>
<span class="normal"><a href="#__codelineno-316-14">14</a></span>
<span class="normal"><a href="#__codelineno-316-15">15</a></span>
<span class="normal"><a href="#__codelineno-316-16">16</a></span>
<span class="normal"><a href="#__codelineno-316-17">17</a></span>
<span class="normal"><a href="#__codelineno-316-18">18</a></span>
<span class="normal"><a href="#__codelineno-316-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-316-1" name="__codelineno-316-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-316-2" name="__codelineno-316-2"></a>
<a id="__codelineno-316-3" name="__codelineno-316-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-316-4" name="__codelineno-316-4"></a>
<a id="__codelineno-316-5" name="__codelineno-316-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-316-6" name="__codelineno-316-6"></a><span class="w">    </span><span class="nx">arr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-316-7" name="__codelineno-316-7"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">arr</span><span class="p">[:]</span>
<a id="__codelineno-316-8" name="__codelineno-316-8"></a>
<a id="__codelineno-316-9" name="__codelineno-316-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;切片: %v, len=%d, cap=%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: [1 2 3], len=3, cap=3</span>
<a id="__codelineno-316-10" name="__codelineno-316-10"></a>
<a id="__codelineno-316-11" name="__codelineno-316-11"></a><span class="w">    </span><span class="c1">// 使用append添加元素，容量不足，会创建新数组</span>
<a id="__codelineno-316-12" name="__codelineno-316-12"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-316-13" name="__codelineno-316-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;切片 after append: %v, len=%d, cap=%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span><span class="w"> </span><span class="nb">cap</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: [1 2 3 4], len=4, cap=6</span>
<a id="__codelineno-316-14" name="__codelineno-316-14"></a>
<a id="__codelineno-316-15" name="__codelineno-316-15"></a><span class="w">    </span><span class="c1">// 修改新切片，不影响原数组</span>
<a id="__codelineno-316-16" name="__codelineno-316-16"></a><span class="w">    </span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-316-17" name="__codelineno-316-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;切片 after modification:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [10 2 3 4]</span>
<a id="__codelineno-316-18" name="__codelineno-316-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原数组:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arr</span><span class="p">)</span><span class="w">                </span><span class="c1">// 输出: [1 2 3]</span>
<a id="__codelineno-316-19" name="__codelineno-316-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-317-1">1</a></span>
<span class="normal"><a href="#__codelineno-317-2">2</a></span>
<span class="normal"><a href="#__codelineno-317-3">3</a></span>
<span class="normal"><a href="#__codelineno-317-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-317-1" name="__codelineno-317-1"></a>切片: [1 2 3], len=3, cap=3
<a id="__codelineno-317-2" name="__codelineno-317-2"></a>切片 after append: [1 2 3 4], len=4, cap=6
<a id="__codelineno-317-3" name="__codelineno-317-3"></a>切片 after modification: [10 2 3 4]
<a id="__codelineno-317-4" name="__codelineno-317-4"></a>原数组: [1 2 3]
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>初始切片<code>s</code>的容量为3。</li>
<li><code>append</code>操作导致切片容量增长，并分配了新的底层数组。</li>
<li>修改新切片不影响原数组。</li>
</ul>
<h4 id="注意事项_8">注意事项<a class="headerlink" href="#注意事项_8" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>切片与数组的关系</strong>：切片是对数组的引用，修改切片会影响底层数组，反之亦然。</li>
<li><strong>内存管理</strong>：切片本身不存储数据，数据存储在底层数组中。切片可以通过多个切片引用同一个底层数组，可能导致数据共享和竞态条件。</li>
<li><strong>切片的零值</strong>：<code>var s []int</code>声明的切片是<code>nil</code>，长度和容量均为0。可以通过<code>append</code>或<code>make</code>初始化切片。</li>
</ul>
<h3 id="73-map">7.3 Map<a class="headerlink" href="#73-map" title="Permanent link">&para;</a></h3>
<p>Map是键值对的无序集合，键和值可以是不同的类型。Map在Go中作为内置数据类型提供，类似于Python的字典或Java的HashMap。它在快速查找、插入和删除数据方面表现出色。</p>
<h4 id="map-的声明与使用">Map 的声明与使用<a class="headerlink" href="#map-的声明与使用" title="Permanent link">&para;</a></h4>
<p><strong>1. 声明Map</strong></p>
<p>使用<code>var</code>关键字声明Map时，需要指定键和值的类型。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-318-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-318-1" name="__codelineno-318-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">capitals</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>capitals</code>是一个键类型为<code>string</code>，值类型为<code>string</code>的Map。</li>
<li>初始值为<code>nil</code>，需要使用<code>make</code>函数初始化。</li>
</ul>
<p><strong>2. 使用<code>make</code>初始化Map</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-319-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-319-1" name="__codelineno-319-1"></a><span class="nx">capitals</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 声明并初始化Map</strong></p>
<p>可以在声明时通过字面量赋值初始化Map。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-320-1">1</a></span>
<span class="normal"><a href="#__codelineno-320-2">2</a></span>
<span class="normal"><a href="#__codelineno-320-3">3</a></span>
<span class="normal"><a href="#__codelineno-320-4">4</a></span>
<span class="normal"><a href="#__codelineno-320-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-320-1" name="__codelineno-320-1"></a><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-320-2" name="__codelineno-320-2"></a><span class="w">    </span><span class="s">&quot;中国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<a id="__codelineno-320-3" name="__codelineno-320-3"></a><span class="w">    </span><span class="s">&quot;美国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;华盛顿&quot;</span><span class="p">,</span>
<a id="__codelineno-320-4" name="__codelineno-320-4"></a><span class="w">    </span><span class="s">&quot;日本&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;东京&quot;</span><span class="p">,</span>
<a id="__codelineno-320-5" name="__codelineno-320-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 添加和访问元素</strong></p>
<p>通过键访问或添加元素。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-321-1">1</a></span>
<span class="normal"><a href="#__codelineno-321-2">2</a></span>
<span class="normal"><a href="#__codelineno-321-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-321-1" name="__codelineno-321-1"></a><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;德国&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;柏林&quot;</span><span class="w"> </span><span class="c1">// 添加元素</span>
<a id="__codelineno-321-2" name="__codelineno-321-2"></a><span class="nx">capital</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;美国&quot;</span><span class="p">]</span><span class="w"> </span><span class="c1">// 访问元素</span>
<a id="__codelineno-321-3" name="__codelineno-321-3"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;美国的首都是:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 美国的首都是: 华盛顿</span>
</code></pre></div></td></tr></table></div>
<p><strong>5. 完整示例</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-322-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-322-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-322-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-322-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-322-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-322-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-322-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-322-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-322-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-322-10">10</a></span>
<span class="normal"><a href="#__codelineno-322-11">11</a></span>
<span class="normal"><a href="#__codelineno-322-12">12</a></span>
<span class="normal"><a href="#__codelineno-322-13">13</a></span>
<span class="normal"><a href="#__codelineno-322-14">14</a></span>
<span class="normal"><a href="#__codelineno-322-15">15</a></span>
<span class="normal"><a href="#__codelineno-322-16">16</a></span>
<span class="normal"><a href="#__codelineno-322-17">17</a></span>
<span class="normal"><a href="#__codelineno-322-18">18</a></span>
<span class="normal"><a href="#__codelineno-322-19">19</a></span>
<span class="normal"><a href="#__codelineno-322-20">20</a></span>
<span class="normal"><a href="#__codelineno-322-21">21</a></span>
<span class="normal"><a href="#__codelineno-322-22">22</a></span>
<span class="normal"><a href="#__codelineno-322-23">23</a></span>
<span class="normal"><a href="#__codelineno-322-24">24</a></span>
<span class="normal"><a href="#__codelineno-322-25">25</a></span>
<span class="normal"><a href="#__codelineno-322-26">26</a></span>
<span class="normal"><a href="#__codelineno-322-27">27</a></span>
<span class="normal"><a href="#__codelineno-322-28">28</a></span>
<span class="normal"><a href="#__codelineno-322-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-322-1" name="__codelineno-322-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-322-2" name="__codelineno-322-2"></a>
<a id="__codelineno-322-3" name="__codelineno-322-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-322-4" name="__codelineno-322-4"></a>
<a id="__codelineno-322-5" name="__codelineno-322-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-322-6" name="__codelineno-322-6"></a><span class="w">    </span><span class="c1">// 声明并初始化Map</span>
<a id="__codelineno-322-7" name="__codelineno-322-7"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-322-8" name="__codelineno-322-8"></a><span class="w">        </span><span class="s">&quot;中国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<a id="__codelineno-322-9" name="__codelineno-322-9"></a><span class="w">        </span><span class="s">&quot;美国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;华盛顿&quot;</span><span class="p">,</span>
<a id="__codelineno-322-10" name="__codelineno-322-10"></a><span class="w">        </span><span class="s">&quot;日本&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;东京&quot;</span><span class="p">,</span>
<a id="__codelineno-322-11" name="__codelineno-322-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-322-12" name="__codelineno-322-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原始Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-322-13" name="__codelineno-322-13"></a>
<a id="__codelineno-322-14" name="__codelineno-322-14"></a><span class="w">    </span><span class="c1">// 添加元素</span>
<a id="__codelineno-322-15" name="__codelineno-322-15"></a><span class="w">    </span><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;德国&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;柏林&quot;</span>
<a id="__codelineno-322-16" name="__codelineno-322-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;添加德国后的Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-322-17" name="__codelineno-322-17"></a>
<a id="__codelineno-322-18" name="__codelineno-322-18"></a><span class="w">    </span><span class="c1">// 访问元素</span>
<a id="__codelineno-322-19" name="__codelineno-322-19"></a><span class="w">    </span><span class="nx">capital</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;美国&quot;</span><span class="p">]</span>
<a id="__codelineno-322-20" name="__codelineno-322-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;美国的首都是:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="p">)</span>
<a id="__codelineno-322-21" name="__codelineno-322-21"></a>
<a id="__codelineno-322-22" name="__codelineno-322-22"></a><span class="w">    </span><span class="c1">// 修改元素</span>
<a id="__codelineno-322-23" name="__codelineno-322-23"></a><span class="w">    </span><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;日本&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;大阪&quot;</span>
<a id="__codelineno-322-24" name="__codelineno-322-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改日本后的Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-322-25" name="__codelineno-322-25"></a>
<a id="__codelineno-322-26" name="__codelineno-322-26"></a><span class="w">    </span><span class="c1">// 删除元素</span>
<a id="__codelineno-322-27" name="__codelineno-322-27"></a><span class="w">    </span><span class="nb">delete</span><span class="p">(</span><span class="nx">capitals</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;德国&quot;</span><span class="p">)</span>
<a id="__codelineno-322-28" name="__codelineno-322-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;删除德国后的Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-322-29" name="__codelineno-322-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-323-1">1</a></span>
<span class="normal"><a href="#__codelineno-323-2">2</a></span>
<span class="normal"><a href="#__codelineno-323-3">3</a></span>
<span class="normal"><a href="#__codelineno-323-4">4</a></span>
<span class="normal"><a href="#__codelineno-323-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-323-1" name="__codelineno-323-1"></a>原始Map: map[中国:北京 美国:华盛顿 日本:东京]
<a id="__codelineno-323-2" name="__codelineno-323-2"></a>添加德国后的Map: map[中国:北京 美国:华盛顿 德国:柏林 日本:东京]
<a id="__codelineno-323-3" name="__codelineno-323-3"></a>美国的首都是: 华盛顿
<a id="__codelineno-323-4" name="__codelineno-323-4"></a>修改日本后的Map: map[中国:北京 美国:华盛顿 德国:柏林 日本:大阪]
<a id="__codelineno-323-5" name="__codelineno-323-5"></a>删除德国后的Map: map[中国:北京 美国:华盛顿 日本:大阪]
</code></pre></div></td></tr></table></div>
<h4 id="map-的遍历与修改">Map 的遍历与修改<a class="headerlink" href="#map-的遍历与修改" title="Permanent link">&para;</a></h4>
<p><strong>1. 遍历Map</strong></p>
<p>使用<code>for</code>循环结合<code>range</code>关键字遍历Map。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-324-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-324-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-324-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-324-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-324-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-324-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-324-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-324-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-324-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-324-10">10</a></span>
<span class="normal"><a href="#__codelineno-324-11">11</a></span>
<span class="normal"><a href="#__codelineno-324-12">12</a></span>
<span class="normal"><a href="#__codelineno-324-13">13</a></span>
<span class="normal"><a href="#__codelineno-324-14">14</a></span>
<span class="normal"><a href="#__codelineno-324-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-324-1" name="__codelineno-324-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-324-2" name="__codelineno-324-2"></a>
<a id="__codelineno-324-3" name="__codelineno-324-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-324-4" name="__codelineno-324-4"></a>
<a id="__codelineno-324-5" name="__codelineno-324-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-324-6" name="__codelineno-324-6"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-324-7" name="__codelineno-324-7"></a><span class="w">        </span><span class="s">&quot;中国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<a id="__codelineno-324-8" name="__codelineno-324-8"></a><span class="w">        </span><span class="s">&quot;美国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;华盛顿&quot;</span><span class="p">,</span>
<a id="__codelineno-324-9" name="__codelineno-324-9"></a><span class="w">        </span><span class="s">&quot;日本&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;东京&quot;</span><span class="p">,</span>
<a id="__codelineno-324-10" name="__codelineno-324-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-324-11" name="__codelineno-324-11"></a>
<a id="__codelineno-324-12" name="__codelineno-324-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">country</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">capitals</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-324-13" name="__codelineno-324-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s 的首都是 %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">country</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="p">)</span>
<a id="__codelineno-324-14" name="__codelineno-324-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-324-15" name="__codelineno-324-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-325-1">1</a></span>
<span class="normal"><a href="#__codelineno-325-2">2</a></span>
<span class="normal"><a href="#__codelineno-325-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-325-1" name="__codelineno-325-1"></a>中国 的首都是 北京
<a id="__codelineno-325-2" name="__codelineno-325-2"></a>美国 的首都是 华盛顿
<a id="__codelineno-325-3" name="__codelineno-325-3"></a>日本 的首都是 东京
</code></pre></div></td></tr></table></div>
<p><strong>2. 仅遍历键或值</strong></p>
<p>如果只需要键或值，可以使用<code>_</code>忽略不需要的部分。</p>
<p><strong>仅遍历键：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-326-1">1</a></span>
<span class="normal"><a href="#__codelineno-326-2">2</a></span>
<span class="normal"><a href="#__codelineno-326-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-326-1" name="__codelineno-326-1"></a><span class="k">for</span><span class="w"> </span><span class="nx">country</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">capitals</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-326-2" name="__codelineno-326-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;国家:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">country</span><span class="p">)</span>
<a id="__codelineno-326-3" name="__codelineno-326-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>仅遍历值：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-327-1">1</a></span>
<span class="normal"><a href="#__codelineno-327-2">2</a></span>
<span class="normal"><a href="#__codelineno-327-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-327-1" name="__codelineno-327-1"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">capitals</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-327-2" name="__codelineno-327-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;首都:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="p">)</span>
<a id="__codelineno-327-3" name="__codelineno-327-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 修改Map元素</strong></p>
<p>在遍历过程中可以直接修改Map的元素。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-328-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-328-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-328-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-328-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-328-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-328-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-328-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-328-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-328-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-328-10">10</a></span>
<span class="normal"><a href="#__codelineno-328-11">11</a></span>
<span class="normal"><a href="#__codelineno-328-12">12</a></span>
<span class="normal"><a href="#__codelineno-328-13">13</a></span>
<span class="normal"><a href="#__codelineno-328-14">14</a></span>
<span class="normal"><a href="#__codelineno-328-15">15</a></span>
<span class="normal"><a href="#__codelineno-328-16">16</a></span>
<span class="normal"><a href="#__codelineno-328-17">17</a></span>
<span class="normal"><a href="#__codelineno-328-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-328-1" name="__codelineno-328-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-328-2" name="__codelineno-328-2"></a>
<a id="__codelineno-328-3" name="__codelineno-328-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-328-4" name="__codelineno-328-4"></a>
<a id="__codelineno-328-5" name="__codelineno-328-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-328-6" name="__codelineno-328-6"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-328-7" name="__codelineno-328-7"></a><span class="w">        </span><span class="s">&quot;中国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<a id="__codelineno-328-8" name="__codelineno-328-8"></a><span class="w">        </span><span class="s">&quot;美国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;华盛顿&quot;</span><span class="p">,</span>
<a id="__codelineno-328-9" name="__codelineno-328-9"></a><span class="w">        </span><span class="s">&quot;日本&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;东京&quot;</span><span class="p">,</span>
<a id="__codelineno-328-10" name="__codelineno-328-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-328-11" name="__codelineno-328-11"></a>
<a id="__codelineno-328-12" name="__codelineno-328-12"></a><span class="w">    </span><span class="c1">// 修改所有首都名称</span>
<a id="__codelineno-328-13" name="__codelineno-328-13"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">country</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">capitals</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-328-14" name="__codelineno-328-14"></a><span class="w">        </span><span class="nx">capitals</span><span class="p">[</span><span class="nx">country</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;首都-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">capitals</span><span class="p">[</span><span class="nx">country</span><span class="p">]</span>
<a id="__codelineno-328-15" name="__codelineno-328-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-328-16" name="__codelineno-328-16"></a>
<a id="__codelineno-328-17" name="__codelineno-328-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-328-18" name="__codelineno-328-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-329-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-329-1" name="__codelineno-329-1"></a>修改后的Map: map[中国:首都-北京 美国:首都-华盛顿 日本:首都-东京]
</code></pre></div></td></tr></table></div>
<p><strong>4. 检查键是否存在</strong></p>
<p>在访问Map的元素时，可以同时检查键是否存在。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-330-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-330-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-330-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-330-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-330-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-330-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-330-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-330-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-330-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-330-10">10</a></span>
<span class="normal"><a href="#__codelineno-330-11">11</a></span>
<span class="normal"><a href="#__codelineno-330-12">12</a></span>
<span class="normal"><a href="#__codelineno-330-13">13</a></span>
<span class="normal"><a href="#__codelineno-330-14">14</a></span>
<span class="normal"><a href="#__codelineno-330-15">15</a></span>
<span class="normal"><a href="#__codelineno-330-16">16</a></span>
<span class="normal"><a href="#__codelineno-330-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-330-1" name="__codelineno-330-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-330-2" name="__codelineno-330-2"></a>
<a id="__codelineno-330-3" name="__codelineno-330-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-330-4" name="__codelineno-330-4"></a>
<a id="__codelineno-330-5" name="__codelineno-330-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-330-6" name="__codelineno-330-6"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-330-7" name="__codelineno-330-7"></a><span class="w">        </span><span class="s">&quot;中国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<a id="__codelineno-330-8" name="__codelineno-330-8"></a><span class="w">        </span><span class="s">&quot;美国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;华盛顿&quot;</span><span class="p">,</span>
<a id="__codelineno-330-9" name="__codelineno-330-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-330-10" name="__codelineno-330-10"></a>
<a id="__codelineno-330-11" name="__codelineno-330-11"></a><span class="w">    </span><span class="nx">capital</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;日本&quot;</span><span class="p">]</span>
<a id="__codelineno-330-12" name="__codelineno-330-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-330-13" name="__codelineno-330-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;日本的首都是:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capital</span><span class="p">)</span>
<a id="__codelineno-330-14" name="__codelineno-330-14"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-330-15" name="__codelineno-330-15"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;日本的首都不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-330-16" name="__codelineno-330-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-330-17" name="__codelineno-330-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-331-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-331-1" name="__codelineno-331-1"></a>日本的首都不存在
</code></pre></div></td></tr></table></div>
<p><strong>5. 使用<code>delete</code>函数删除元素</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-332-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-332-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-332-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-332-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-332-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-332-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-332-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-332-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-332-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-332-10">10</a></span>
<span class="normal"><a href="#__codelineno-332-11">11</a></span>
<span class="normal"><a href="#__codelineno-332-12">12</a></span>
<span class="normal"><a href="#__codelineno-332-13">13</a></span>
<span class="normal"><a href="#__codelineno-332-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-332-1" name="__codelineno-332-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-332-2" name="__codelineno-332-2"></a>
<a id="__codelineno-332-3" name="__codelineno-332-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-332-4" name="__codelineno-332-4"></a>
<a id="__codelineno-332-5" name="__codelineno-332-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-332-6" name="__codelineno-332-6"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-332-7" name="__codelineno-332-7"></a><span class="w">        </span><span class="s">&quot;中国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<a id="__codelineno-332-8" name="__codelineno-332-8"></a><span class="w">        </span><span class="s">&quot;美国&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;华盛顿&quot;</span><span class="p">,</span>
<a id="__codelineno-332-9" name="__codelineno-332-9"></a><span class="w">        </span><span class="s">&quot;日本&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;东京&quot;</span><span class="p">,</span>
<a id="__codelineno-332-10" name="__codelineno-332-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-332-11" name="__codelineno-332-11"></a>
<a id="__codelineno-332-12" name="__codelineno-332-12"></a><span class="w">    </span><span class="nb">delete</span><span class="p">(</span><span class="nx">capitals</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;美国&quot;</span><span class="p">)</span>
<a id="__codelineno-332-13" name="__codelineno-332-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;删除美国后的Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-332-14" name="__codelineno-332-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-333-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-333-1" name="__codelineno-333-1"></a>删除美国后的Map: map[中国:北京 日本:东京]
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_9">注意事项<a class="headerlink" href="#注意事项_9" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Map的零值</strong>：未初始化的Map为<code>nil</code>，不能进行读写操作。需要使用<code>make</code>或字面量初始化Map。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-334-1">1</a></span>
<span class="normal"><a href="#__codelineno-334-2">2</a></span>
<span class="normal"><a href="#__codelineno-334-3">3</a></span>
<span class="normal"><a href="#__codelineno-334-4">4</a></span>
<span class="normal"><a href="#__codelineno-334-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-334-1" name="__codelineno-334-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<a id="__codelineno-334-2" name="__codelineno-334-2"></a><span class="c1">// m[&quot;key&quot;] = 1 // 运行时错误: assignment to entry in nil map</span>
<a id="__codelineno-334-3" name="__codelineno-334-3"></a>
<a id="__codelineno-334-4" name="__codelineno-334-4"></a><span class="nx">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-334-5" name="__codelineno-334-5"></a><span class="nx">m</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1">// 正确</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Map的无序性</strong>：Map中的元素是无序的，遍历时元素的顺序是不确定的。如果需要有序的数据结构，建议使用切片或其他结构。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-335-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-335-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-335-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-335-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-335-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-335-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-335-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-335-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-335-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-335-10">10</a></span>
<span class="normal"><a href="#__codelineno-335-11">11</a></span>
<span class="normal"><a href="#__codelineno-335-12">12</a></span>
<span class="normal"><a href="#__codelineno-335-13">13</a></span>
<span class="normal"><a href="#__codelineno-335-14">14</a></span>
<span class="normal"><a href="#__codelineno-335-15">15</a></span>
<span class="normal"><a href="#__codelineno-335-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-335-1" name="__codelineno-335-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-335-2" name="__codelineno-335-2"></a>
<a id="__codelineno-335-3" name="__codelineno-335-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-335-4" name="__codelineno-335-4"></a>
<a id="__codelineno-335-5" name="__codelineno-335-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-335-6" name="__codelineno-335-6"></a><span class="w">    </span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{</span>
<a id="__codelineno-335-7" name="__codelineno-335-7"></a><span class="w">        </span><span class="s">&quot;apple&quot;</span><span class="p">:</span><span class="w">  </span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-335-8" name="__codelineno-335-8"></a><span class="w">        </span><span class="s">&quot;banana&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-335-9" name="__codelineno-335-9"></a><span class="w">        </span><span class="s">&quot;cherry&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-335-10" name="__codelineno-335-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-335-11" name="__codelineno-335-11"></a>
<a id="__codelineno-335-12" name="__codelineno-335-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-335-13" name="__codelineno-335-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-335-14" name="__codelineno-335-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-335-15" name="__codelineno-335-15"></a><span class="w">    </span><span class="c1">// 输出顺序不确定</span>
<a id="__codelineno-335-16" name="__codelineno-335-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Map的键类型</strong>：Map的键必须是可比较的类型，如布尔型、数字、字符串、指针、接口和结构体（前提是结构体的所有字段都是可比较的）。切片、Map和函数类型不能作为键。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-336-1">1</a></span>
<span class="normal"><a href="#__codelineno-336-2">2</a></span>
<span class="normal"><a href="#__codelineno-336-3">3</a></span>
<span class="normal"><a href="#__codelineno-336-4">4</a></span>
<span class="normal"><a href="#__codelineno-336-5">5</a></span>
<span class="normal"><a href="#__codelineno-336-6">6</a></span>
<span class="normal"><a href="#__codelineno-336-7">7</a></span>
<span class="normal"><a href="#__codelineno-336-8">8</a></span>
<span class="normal"><a href="#__codelineno-336-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-336-1" name="__codelineno-336-1"></a><span class="c1">// 合法键类型</span>
<a id="__codelineno-336-2" name="__codelineno-336-2"></a><span class="nx">m1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{}</span>
<a id="__codelineno-336-3" name="__codelineno-336-3"></a><span class="nx">m2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span><span class="p">{}</span>
<a id="__codelineno-336-4" name="__codelineno-336-4"></a><span class="nx">m3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kd">struct</span><span class="p">{</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}]</span><span class="kt">float64</span><span class="p">{}</span>
<a id="__codelineno-336-5" name="__codelineno-336-5"></a>
<a id="__codelineno-336-6" name="__codelineno-336-6"></a><span class="c1">// 非法键类型</span>
<a id="__codelineno-336-7" name="__codelineno-336-7"></a><span class="c1">// m4 := map[[]int]string{}      // 编译错误: invalid map key type []int</span>
<a id="__codelineno-336-8" name="__codelineno-336-8"></a><span class="c1">// m5 := map[map[string]int]int{} // 编译错误: invalid map key type map[string]int</span>
<a id="__codelineno-336-9" name="__codelineno-336-9"></a><span class="c1">// m6 := map[func(){}]bool{}     // 编译错误: invalid map key type func()</span>
</code></pre></div></td></tr></table></div>
<h3 id="74-结构体">7.4 结构体<a class="headerlink" href="#74-结构体" title="Permanent link">&para;</a></h3>
<p>结构体是由多个字段组成的复合数据类型，可以包含不同类型的数据。结构体在Go语言中用于创建自定义的数据类型，方便组织和管理复杂的数据。</p>
<h4 id="定义结构体">定义结构体<a class="headerlink" href="#定义结构体" title="Permanent link">&para;</a></h4>
<p>使用<code>type</code>关键字定义结构体。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-337-1">1</a></span>
<span class="normal"><a href="#__codelineno-337-2">2</a></span>
<span class="normal"><a href="#__codelineno-337-3">3</a></span>
<span class="normal"><a href="#__codelineno-337-4">4</a></span>
<span class="normal"><a href="#__codelineno-337-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-337-1" name="__codelineno-337-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">StructName</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-337-2" name="__codelineno-337-2"></a><span class="w">    </span><span class="nx">Field1</span><span class="w"> </span><span class="nx">Type1</span>
<a id="__codelineno-337-3" name="__codelineno-337-3"></a><span class="w">    </span><span class="nx">Field2</span><span class="w"> </span><span class="nx">Type2</span>
<a id="__codelineno-337-4" name="__codelineno-337-4"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-337-5" name="__codelineno-337-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-338-1">1</a></span>
<span class="normal"><a href="#__codelineno-338-2">2</a></span>
<span class="normal"><a href="#__codelineno-338-3">3</a></span>
<span class="normal"><a href="#__codelineno-338-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-338-1" name="__codelineno-338-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-338-2" name="__codelineno-338-2"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-338-3" name="__codelineno-338-3"></a><span class="w">    </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<a id="__codelineno-338-4" name="__codelineno-338-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>嵌入结构体</strong></p>
<p>结构体可以嵌入其他结构体，实现类似继承的功能。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-339-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-339-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-339-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-339-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-339-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-339-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-339-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-339-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-339-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-339-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-339-1" name="__codelineno-339-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-339-2" name="__codelineno-339-2"></a><span class="w">    </span><span class="nx">City</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-339-3" name="__codelineno-339-3"></a><span class="w">    </span><span class="nx">ZipCode</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-339-4" name="__codelineno-339-4"></a><span class="p">}</span>
<a id="__codelineno-339-5" name="__codelineno-339-5"></a>
<a id="__codelineno-339-6" name="__codelineno-339-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Employee</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-339-7" name="__codelineno-339-7"></a><span class="w">    </span><span class="nx">Person</span>
<a id="__codelineno-339-8" name="__codelineno-339-8"></a><span class="w">    </span><span class="nx">Address</span>
<a id="__codelineno-339-9" name="__codelineno-339-9"></a><span class="w">    </span><span class="nx">Position</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-339-10" name="__codelineno-339-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="结构体实例化">结构体实例化<a class="headerlink" href="#结构体实例化" title="Permanent link">&para;</a></h4>
<p><strong>1. 使用字面量</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-340-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-340-1" name="__codelineno-340-1"></a><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 不指定字段名</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-341-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-341-1" name="__codelineno-341-1"></a><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 使用<code>new</code>关键字</strong></p>
<p><code>new</code>函数返回指向新分配的零值的指针。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-342-1">1</a></span>
<span class="normal"><a href="#__codelineno-342-2">2</a></span>
<span class="normal"><a href="#__codelineno-342-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-342-1" name="__codelineno-342-1"></a><span class="nx">p3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">Person</span><span class="p">)</span>
<a id="__codelineno-342-2" name="__codelineno-342-2"></a><span class="nx">p3</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span>
<a id="__codelineno-342-3" name="__codelineno-342-3"></a><span class="nx">p3</span><span class="p">.</span><span class="nx">Age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">28</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 部分初始化</strong></p>
<p>未初始化的字段会使用类型的零值。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-343-1">1</a></span>
<span class="normal"><a href="#__codelineno-343-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-343-1" name="__codelineno-343-1"></a><span class="nx">p4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">}</span>
<a id="__codelineno-343-2" name="__codelineno-343-2"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">p4</span><span class="p">.</span><span class="nx">Age</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 0</span>
</code></pre></div></td></tr></table></div>
<p><strong>完整示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-344-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-344-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-344-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-344-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-344-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-344-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-344-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-344-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-344-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-344-10">10</a></span>
<span class="normal"><a href="#__codelineno-344-11">11</a></span>
<span class="normal"><a href="#__codelineno-344-12">12</a></span>
<span class="normal"><a href="#__codelineno-344-13">13</a></span>
<span class="normal"><a href="#__codelineno-344-14">14</a></span>
<span class="normal"><a href="#__codelineno-344-15">15</a></span>
<span class="normal"><a href="#__codelineno-344-16">16</a></span>
<span class="normal"><a href="#__codelineno-344-17">17</a></span>
<span class="normal"><a href="#__codelineno-344-18">18</a></span>
<span class="normal"><a href="#__codelineno-344-19">19</a></span>
<span class="normal"><a href="#__codelineno-344-20">20</a></span>
<span class="normal"><a href="#__codelineno-344-21">21</a></span>
<span class="normal"><a href="#__codelineno-344-22">22</a></span>
<span class="normal"><a href="#__codelineno-344-23">23</a></span>
<span class="normal"><a href="#__codelineno-344-24">24</a></span>
<span class="normal"><a href="#__codelineno-344-25">25</a></span>
<span class="normal"><a href="#__codelineno-344-26">26</a></span>
<span class="normal"><a href="#__codelineno-344-27">27</a></span>
<span class="normal"><a href="#__codelineno-344-28">28</a></span>
<span class="normal"><a href="#__codelineno-344-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-344-1" name="__codelineno-344-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-344-2" name="__codelineno-344-2"></a>
<a id="__codelineno-344-3" name="__codelineno-344-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-344-4" name="__codelineno-344-4"></a>
<a id="__codelineno-344-5" name="__codelineno-344-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-344-6" name="__codelineno-344-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-344-7" name="__codelineno-344-7"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-344-8" name="__codelineno-344-8"></a><span class="w">    </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<a id="__codelineno-344-9" name="__codelineno-344-9"></a><span class="p">}</span>
<a id="__codelineno-344-10" name="__codelineno-344-10"></a>
<a id="__codelineno-344-11" name="__codelineno-344-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-344-12" name="__codelineno-344-12"></a><span class="w">    </span><span class="c1">// 使用字面量初始化</span>
<a id="__codelineno-344-13" name="__codelineno-344-13"></a><span class="w">    </span><span class="nx">p1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">}</span>
<a id="__codelineno-344-14" name="__codelineno-344-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;p1:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p1</span><span class="p">)</span>
<a id="__codelineno-344-15" name="__codelineno-344-15"></a>
<a id="__codelineno-344-16" name="__codelineno-344-16"></a><span class="w">    </span><span class="c1">// 不指定字段名</span>
<a id="__codelineno-344-17" name="__codelineno-344-17"></a><span class="w">    </span><span class="nx">p2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">}</span>
<a id="__codelineno-344-18" name="__codelineno-344-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;p2:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">)</span>
<a id="__codelineno-344-19" name="__codelineno-344-19"></a>
<a id="__codelineno-344-20" name="__codelineno-344-20"></a><span class="w">    </span><span class="c1">// 使用new关键字</span>
<a id="__codelineno-344-21" name="__codelineno-344-21"></a><span class="w">    </span><span class="nx">p3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">Person</span><span class="p">)</span>
<a id="__codelineno-344-22" name="__codelineno-344-22"></a><span class="w">    </span><span class="nx">p3</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span>
<a id="__codelineno-344-23" name="__codelineno-344-23"></a><span class="w">    </span><span class="nx">p3</span><span class="p">.</span><span class="nx">Age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">28</span>
<a id="__codelineno-344-24" name="__codelineno-344-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;p3:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">p3</span><span class="p">)</span>
<a id="__codelineno-344-25" name="__codelineno-344-25"></a>
<a id="__codelineno-344-26" name="__codelineno-344-26"></a><span class="w">    </span><span class="c1">// 部分初始化</span>
<a id="__codelineno-344-27" name="__codelineno-344-27"></a><span class="w">    </span><span class="nx">p4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Diana&quot;</span><span class="p">}</span>
<a id="__codelineno-344-28" name="__codelineno-344-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;p4:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p4</span><span class="p">)</span>
<a id="__codelineno-344-29" name="__codelineno-344-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-345-1">1</a></span>
<span class="normal"><a href="#__codelineno-345-2">2</a></span>
<span class="normal"><a href="#__codelineno-345-3">3</a></span>
<span class="normal"><a href="#__codelineno-345-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-345-1" name="__codelineno-345-1"></a>p1: {Alice 30}
<a id="__codelineno-345-2" name="__codelineno-345-2"></a>p2: {Bob 25}
<a id="__codelineno-345-3" name="__codelineno-345-3"></a>p3: {Charlie 28}
<a id="__codelineno-345-4" name="__codelineno-345-4"></a>p4: {Diana 0}
</code></pre></div></td></tr></table></div>
<h4 id="嵌套结构体">嵌套结构体<a class="headerlink" href="#嵌套结构体" title="Permanent link">&para;</a></h4>
<p>结构体可以嵌入其他结构体，实现数据的层次化管理。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-346-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-346-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-346-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-346-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-346-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-346-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-346-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-346-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-346-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-346-10">10</a></span>
<span class="normal"><a href="#__codelineno-346-11">11</a></span>
<span class="normal"><a href="#__codelineno-346-12">12</a></span>
<span class="normal"><a href="#__codelineno-346-13">13</a></span>
<span class="normal"><a href="#__codelineno-346-14">14</a></span>
<span class="normal"><a href="#__codelineno-346-15">15</a></span>
<span class="normal"><a href="#__codelineno-346-16">16</a></span>
<span class="normal"><a href="#__codelineno-346-17">17</a></span>
<span class="normal"><a href="#__codelineno-346-18">18</a></span>
<span class="normal"><a href="#__codelineno-346-19">19</a></span>
<span class="normal"><a href="#__codelineno-346-20">20</a></span>
<span class="normal"><a href="#__codelineno-346-21">21</a></span>
<span class="normal"><a href="#__codelineno-346-22">22</a></span>
<span class="normal"><a href="#__codelineno-346-23">23</a></span>
<span class="normal"><a href="#__codelineno-346-24">24</a></span>
<span class="normal"><a href="#__codelineno-346-25">25</a></span>
<span class="normal"><a href="#__codelineno-346-26">26</a></span>
<span class="normal"><a href="#__codelineno-346-27">27</a></span>
<span class="normal"><a href="#__codelineno-346-28">28</a></span>
<span class="normal"><a href="#__codelineno-346-29">29</a></span>
<span class="normal"><a href="#__codelineno-346-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-346-1" name="__codelineno-346-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-346-2" name="__codelineno-346-2"></a>
<a id="__codelineno-346-3" name="__codelineno-346-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-346-4" name="__codelineno-346-4"></a>
<a id="__codelineno-346-5" name="__codelineno-346-5"></a><span class="c1">// 定义Address结构体</span>
<a id="__codelineno-346-6" name="__codelineno-346-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-346-7" name="__codelineno-346-7"></a><span class="w">    </span><span class="nx">City</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-346-8" name="__codelineno-346-8"></a><span class="w">    </span><span class="nx">ZipCode</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-346-9" name="__codelineno-346-9"></a><span class="p">}</span>
<a id="__codelineno-346-10" name="__codelineno-346-10"></a>
<a id="__codelineno-346-11" name="__codelineno-346-11"></a><span class="c1">// 定义Person结构体</span>
<a id="__codelineno-346-12" name="__codelineno-346-12"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-346-13" name="__codelineno-346-13"></a><span class="w">    </span><span class="nx">Name</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-346-14" name="__codelineno-346-14"></a><span class="w">    </span><span class="nx">Age</span><span class="w">     </span><span class="kt">int</span>
<a id="__codelineno-346-15" name="__codelineno-346-15"></a><span class="w">    </span><span class="nx">Address</span><span class="w"> </span><span class="nx">Address</span>
<a id="__codelineno-346-16" name="__codelineno-346-16"></a><span class="p">}</span>
<a id="__codelineno-346-17" name="__codelineno-346-17"></a>
<a id="__codelineno-346-18" name="__codelineno-346-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-346-19" name="__codelineno-346-19"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<a id="__codelineno-346-20" name="__codelineno-346-20"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Eve&quot;</span><span class="p">,</span>
<a id="__codelineno-346-21" name="__codelineno-346-21"></a><span class="w">        </span><span class="nx">Age</span><span class="p">:</span><span class="w">  </span><span class="mi">35</span><span class="p">,</span>
<a id="__codelineno-346-22" name="__codelineno-346-22"></a><span class="w">        </span><span class="nx">Address</span><span class="p">:</span><span class="w"> </span><span class="nx">Address</span><span class="p">{</span>
<a id="__codelineno-346-23" name="__codelineno-346-23"></a><span class="w">            </span><span class="nx">City</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;New York&quot;</span><span class="p">,</span>
<a id="__codelineno-346-24" name="__codelineno-346-24"></a><span class="w">            </span><span class="nx">ZipCode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10001&quot;</span><span class="p">,</span>
<a id="__codelineno-346-25" name="__codelineno-346-25"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-346-26" name="__codelineno-346-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-346-27" name="__codelineno-346-27"></a>
<a id="__codelineno-346-28" name="__codelineno-346-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Person:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span>
<a id="__codelineno-346-29" name="__codelineno-346-29"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;City:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Address</span><span class="p">.</span><span class="nx">City</span><span class="p">)</span>
<a id="__codelineno-346-30" name="__codelineno-346-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-347-1">1</a></span>
<span class="normal"><a href="#__codelineno-347-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-347-1" name="__codelineno-347-1"></a>Person: {Eve 35 {New York 10001}}
<a id="__codelineno-347-2" name="__codelineno-347-2"></a>City: New York
</code></pre></div></td></tr></table></div>
<p><strong>匿名嵌入结构体</strong></p>
<p>通过匿名字段，可以直接访问嵌套结构体的字段，类似于继承。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-348-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-348-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-348-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-348-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-348-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-348-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-348-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-348-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-348-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-348-10">10</a></span>
<span class="normal"><a href="#__codelineno-348-11">11</a></span>
<span class="normal"><a href="#__codelineno-348-12">12</a></span>
<span class="normal"><a href="#__codelineno-348-13">13</a></span>
<span class="normal"><a href="#__codelineno-348-14">14</a></span>
<span class="normal"><a href="#__codelineno-348-15">15</a></span>
<span class="normal"><a href="#__codelineno-348-16">16</a></span>
<span class="normal"><a href="#__codelineno-348-17">17</a></span>
<span class="normal"><a href="#__codelineno-348-18">18</a></span>
<span class="normal"><a href="#__codelineno-348-19">19</a></span>
<span class="normal"><a href="#__codelineno-348-20">20</a></span>
<span class="normal"><a href="#__codelineno-348-21">21</a></span>
<span class="normal"><a href="#__codelineno-348-22">22</a></span>
<span class="normal"><a href="#__codelineno-348-23">23</a></span>
<span class="normal"><a href="#__codelineno-348-24">24</a></span>
<span class="normal"><a href="#__codelineno-348-25">25</a></span>
<span class="normal"><a href="#__codelineno-348-26">26</a></span>
<span class="normal"><a href="#__codelineno-348-27">27</a></span>
<span class="normal"><a href="#__codelineno-348-28">28</a></span>
<span class="normal"><a href="#__codelineno-348-29">29</a></span>
<span class="normal"><a href="#__codelineno-348-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-348-1" name="__codelineno-348-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-348-2" name="__codelineno-348-2"></a>
<a id="__codelineno-348-3" name="__codelineno-348-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-348-4" name="__codelineno-348-4"></a>
<a id="__codelineno-348-5" name="__codelineno-348-5"></a><span class="c1">// 定义Address结构体</span>
<a id="__codelineno-348-6" name="__codelineno-348-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-348-7" name="__codelineno-348-7"></a><span class="w">    </span><span class="nx">City</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-348-8" name="__codelineno-348-8"></a><span class="w">    </span><span class="nx">ZipCode</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-348-9" name="__codelineno-348-9"></a><span class="p">}</span>
<a id="__codelineno-348-10" name="__codelineno-348-10"></a>
<a id="__codelineno-348-11" name="__codelineno-348-11"></a><span class="c1">// 定义Person结构体，匿名嵌入Address</span>
<a id="__codelineno-348-12" name="__codelineno-348-12"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-348-13" name="__codelineno-348-13"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-348-14" name="__codelineno-348-14"></a><span class="w">    </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<a id="__codelineno-348-15" name="__codelineno-348-15"></a><span class="w">    </span><span class="nx">Address</span>
<a id="__codelineno-348-16" name="__codelineno-348-16"></a><span class="p">}</span>
<a id="__codelineno-348-17" name="__codelineno-348-17"></a>
<a id="__codelineno-348-18" name="__codelineno-348-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-348-19" name="__codelineno-348-19"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<a id="__codelineno-348-20" name="__codelineno-348-20"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Frank&quot;</span><span class="p">,</span>
<a id="__codelineno-348-21" name="__codelineno-348-21"></a><span class="w">        </span><span class="nx">Age</span><span class="p">:</span><span class="w">  </span><span class="mi">40</span><span class="p">,</span>
<a id="__codelineno-348-22" name="__codelineno-348-22"></a><span class="w">        </span><span class="nx">Address</span><span class="p">:</span><span class="w"> </span><span class="nx">Address</span><span class="p">{</span>
<a id="__codelineno-348-23" name="__codelineno-348-23"></a><span class="w">            </span><span class="nx">City</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Los Angeles&quot;</span><span class="p">,</span>
<a id="__codelineno-348-24" name="__codelineno-348-24"></a><span class="w">            </span><span class="nx">ZipCode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;90001&quot;</span><span class="p">,</span>
<a id="__codelineno-348-25" name="__codelineno-348-25"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-348-26" name="__codelineno-348-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-348-27" name="__codelineno-348-27"></a>
<a id="__codelineno-348-28" name="__codelineno-348-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Person:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span>
<a id="__codelineno-348-29" name="__codelineno-348-29"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;City:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">City</span><span class="p">)</span><span class="w"> </span><span class="c1">// 直接访问嵌套结构体的字段</span>
<a id="__codelineno-348-30" name="__codelineno-348-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-349-1">1</a></span>
<span class="normal"><a href="#__codelineno-349-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-349-1" name="__codelineno-349-1"></a>Person: {Frank 40 {Los Angeles 90001}}
<a id="__codelineno-349-2" name="__codelineno-349-2"></a>City: Los Angeles
</code></pre></div></td></tr></table></div>
<h4 id="方法与结构体">方法与结构体<a class="headerlink" href="#方法与结构体" title="Permanent link">&para;</a></h4>
<p>Go语言支持为结构体类型定义方法，使得结构体更具行为性。</p>
<p><strong>1. 定义方法</strong></p>
<p>方法是在特定类型上定义的函数。通过方法，可以操作结构体的字段。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-350-1">1</a></span>
<span class="normal"><a href="#__codelineno-350-2">2</a></span>
<span class="normal"><a href="#__codelineno-350-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-350-1" name="__codelineno-350-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">receiver</span><span class="w"> </span><span class="nx">StructType</span><span class="p">)</span><span class="w"> </span><span class="nx">MethodName</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="nx">returnTypes</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-350-2" name="__codelineno-350-2"></a><span class="w">    </span><span class="c1">// 方法体</span>
<a id="__codelineno-350-3" name="__codelineno-350-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-351-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-351-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-351-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-351-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-351-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-351-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-351-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-351-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-351-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-351-10">10</a></span>
<span class="normal"><a href="#__codelineno-351-11">11</a></span>
<span class="normal"><a href="#__codelineno-351-12">12</a></span>
<span class="normal"><a href="#__codelineno-351-13">13</a></span>
<span class="normal"><a href="#__codelineno-351-14">14</a></span>
<span class="normal"><a href="#__codelineno-351-15">15</a></span>
<span class="normal"><a href="#__codelineno-351-16">16</a></span>
<span class="normal"><a href="#__codelineno-351-17">17</a></span>
<span class="normal"><a href="#__codelineno-351-18">18</a></span>
<span class="normal"><a href="#__codelineno-351-19">19</a></span>
<span class="normal"><a href="#__codelineno-351-20">20</a></span>
<span class="normal"><a href="#__codelineno-351-21">21</a></span>
<span class="normal"><a href="#__codelineno-351-22">22</a></span>
<span class="normal"><a href="#__codelineno-351-23">23</a></span>
<span class="normal"><a href="#__codelineno-351-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-351-1" name="__codelineno-351-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-351-2" name="__codelineno-351-2"></a>
<a id="__codelineno-351-3" name="__codelineno-351-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-351-4" name="__codelineno-351-4"></a>
<a id="__codelineno-351-5" name="__codelineno-351-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-351-6" name="__codelineno-351-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-351-7" name="__codelineno-351-7"></a><span class="w">    </span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-351-8" name="__codelineno-351-8"></a><span class="p">}</span>
<a id="__codelineno-351-9" name="__codelineno-351-9"></a>
<a id="__codelineno-351-10" name="__codelineno-351-10"></a><span class="c1">// 定义方法计算面积</span>
<a id="__codelineno-351-11" name="__codelineno-351-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-351-12" name="__codelineno-351-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span>
<a id="__codelineno-351-13" name="__codelineno-351-13"></a><span class="p">}</span>
<a id="__codelineno-351-14" name="__codelineno-351-14"></a>
<a id="__codelineno-351-15" name="__codelineno-351-15"></a><span class="c1">// 定义方法计算周长</span>
<a id="__codelineno-351-16" name="__codelineno-351-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Perimeter</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-351-17" name="__codelineno-351-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span><span class="p">)</span>
<a id="__codelineno-351-18" name="__codelineno-351-18"></a><span class="p">}</span>
<a id="__codelineno-351-19" name="__codelineno-351-19"></a>
<a id="__codelineno-351-20" name="__codelineno-351-20"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-351-21" name="__codelineno-351-21"></a><span class="w">    </span><span class="nx">rect</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-351-22" name="__codelineno-351-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;面积:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">Area</span><span class="p">())</span><span class="w">         </span><span class="c1">// 输出: 面积: 50</span>
<a id="__codelineno-351-23" name="__codelineno-351-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;周长:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">Perimeter</span><span class="p">())</span><span class="w">   </span><span class="c1">// 输出: 周长: 30</span>
<a id="__codelineno-351-24" name="__codelineno-351-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 方法的接收者</strong></p>
<p>接收者可以是值类型或指针类型。使用指针接收者可以修改结构体的字段，避免复制整个结构体。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-352-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-352-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-352-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-352-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-352-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-352-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-352-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-352-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-352-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-352-10">10</a></span>
<span class="normal"><a href="#__codelineno-352-11">11</a></span>
<span class="normal"><a href="#__codelineno-352-12">12</a></span>
<span class="normal"><a href="#__codelineno-352-13">13</a></span>
<span class="normal"><a href="#__codelineno-352-14">14</a></span>
<span class="normal"><a href="#__codelineno-352-15">15</a></span>
<span class="normal"><a href="#__codelineno-352-16">16</a></span>
<span class="normal"><a href="#__codelineno-352-17">17</a></span>
<span class="normal"><a href="#__codelineno-352-18">18</a></span>
<span class="normal"><a href="#__codelineno-352-19">19</a></span>
<span class="normal"><a href="#__codelineno-352-20">20</a></span>
<span class="normal"><a href="#__codelineno-352-21">21</a></span>
<span class="normal"><a href="#__codelineno-352-22">22</a></span>
<span class="normal"><a href="#__codelineno-352-23">23</a></span>
<span class="normal"><a href="#__codelineno-352-24">24</a></span>
<span class="normal"><a href="#__codelineno-352-25">25</a></span>
<span class="normal"><a href="#__codelineno-352-26">26</a></span>
<span class="normal"><a href="#__codelineno-352-27">27</a></span>
<span class="normal"><a href="#__codelineno-352-28">28</a></span>
<span class="normal"><a href="#__codelineno-352-29">29</a></span>
<span class="normal"><a href="#__codelineno-352-30">30</a></span>
<span class="normal"><a href="#__codelineno-352-31">31</a></span>
<span class="normal"><a href="#__codelineno-352-32">32</a></span>
<span class="normal"><a href="#__codelineno-352-33">33</a></span>
<span class="normal"><a href="#__codelineno-352-34">34</a></span>
<span class="normal"><a href="#__codelineno-352-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-352-1" name="__codelineno-352-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-352-2" name="__codelineno-352-2"></a>
<a id="__codelineno-352-3" name="__codelineno-352-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-352-4" name="__codelineno-352-4"></a>
<a id="__codelineno-352-5" name="__codelineno-352-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-352-6" name="__codelineno-352-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Counter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-352-7" name="__codelineno-352-7"></a><span class="w">    </span><span class="nx">count</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-352-8" name="__codelineno-352-8"></a><span class="p">}</span>
<a id="__codelineno-352-9" name="__codelineno-352-9"></a>
<a id="__codelineno-352-10" name="__codelineno-352-10"></a><span class="c1">// 值接收者方法</span>
<a id="__codelineno-352-11" name="__codelineno-352-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Counter</span><span class="p">)</span><span class="w"> </span><span class="nx">Increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-352-12" name="__codelineno-352-12"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<a id="__codelineno-352-13" name="__codelineno-352-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Inside Increment (value receiver):&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-352-14" name="__codelineno-352-14"></a><span class="p">}</span>
<a id="__codelineno-352-15" name="__codelineno-352-15"></a>
<a id="__codelineno-352-16" name="__codelineno-352-16"></a><span class="c1">// 指针接收者方法</span>
<a id="__codelineno-352-17" name="__codelineno-352-17"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Counter</span><span class="p">)</span><span class="w"> </span><span class="nx">IncrementPointer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-352-18" name="__codelineno-352-18"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<a id="__codelineno-352-19" name="__codelineno-352-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Inside IncrementPointer (pointer receiver):&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-352-20" name="__codelineno-352-20"></a><span class="p">}</span>
<a id="__codelineno-352-21" name="__codelineno-352-21"></a>
<a id="__codelineno-352-22" name="__codelineno-352-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-352-23" name="__codelineno-352-23"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Counter</span><span class="p">{</span><span class="nx">count</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">}</span>
<a id="__codelineno-352-24" name="__codelineno-352-24"></a>
<a id="__codelineno-352-25" name="__codelineno-352-25"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Increment</span><span class="p">()</span><span class="w"> </span><span class="c1">// 修改的是副本</span>
<a id="__codelineno-352-26" name="__codelineno-352-26"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After Increment:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-352-27" name="__codelineno-352-27"></a>
<a id="__codelineno-352-28" name="__codelineno-352-28"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">IncrementPointer</span><span class="p">()</span><span class="w"> </span><span class="c1">// 修改的是原始值</span>
<a id="__codelineno-352-29" name="__codelineno-352-29"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After IncrementPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 11</span>
<a id="__codelineno-352-30" name="__codelineno-352-30"></a>
<a id="__codelineno-352-31" name="__codelineno-352-31"></a><span class="w">    </span><span class="c1">// 使用指针变量</span>
<a id="__codelineno-352-32" name="__codelineno-352-32"></a><span class="w">    </span><span class="nx">cp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">c</span>
<a id="__codelineno-352-33" name="__codelineno-352-33"></a><span class="w">    </span><span class="nx">cp</span><span class="p">.</span><span class="nx">IncrementPointer</span><span class="p">()</span>
<a id="__codelineno-352-34" name="__codelineno-352-34"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After cp.IncrementPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 12</span>
<a id="__codelineno-352-35" name="__codelineno-352-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-353-1">1</a></span>
<span class="normal"><a href="#__codelineno-353-2">2</a></span>
<span class="normal"><a href="#__codelineno-353-3">3</a></span>
<span class="normal"><a href="#__codelineno-353-4">4</a></span>
<span class="normal"><a href="#__codelineno-353-5">5</a></span>
<span class="normal"><a href="#__codelineno-353-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-353-1" name="__codelineno-353-1"></a>Inside Increment (value receiver): 11
<a id="__codelineno-353-2" name="__codelineno-353-2"></a>After Increment: 10
<a id="__codelineno-353-3" name="__codelineno-353-3"></a>Inside IncrementPointer (pointer receiver): 11
<a id="__codelineno-353-4" name="__codelineno-353-4"></a>After IncrementPointer: 11
<a id="__codelineno-353-5" name="__codelineno-353-5"></a>Inside IncrementPointer (pointer receiver): 12
<a id="__codelineno-353-6" name="__codelineno-353-6"></a>After cp.IncrementPointer: 12
</code></pre></div></td></tr></table></div>
<p><strong>3. 方法的作用</strong></p>
<p>方法可以提供结构体的行为和操作，增强代码的可读性和可维护性。例如，可以为结构体定义打印、验证、计算等功能。</p>
<p><strong>示例：验证结构体字段</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-354-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-354-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-354-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-354-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-354-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-354-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-354-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-354-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-354-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-354-10">10</a></span>
<span class="normal"><a href="#__codelineno-354-11">11</a></span>
<span class="normal"><a href="#__codelineno-354-12">12</a></span>
<span class="normal"><a href="#__codelineno-354-13">13</a></span>
<span class="normal"><a href="#__codelineno-354-14">14</a></span>
<span class="normal"><a href="#__codelineno-354-15">15</a></span>
<span class="normal"><a href="#__codelineno-354-16">16</a></span>
<span class="normal"><a href="#__codelineno-354-17">17</a></span>
<span class="normal"><a href="#__codelineno-354-18">18</a></span>
<span class="normal"><a href="#__codelineno-354-19">19</a></span>
<span class="normal"><a href="#__codelineno-354-20">20</a></span>
<span class="normal"><a href="#__codelineno-354-21">21</a></span>
<span class="normal"><a href="#__codelineno-354-22">22</a></span>
<span class="normal"><a href="#__codelineno-354-23">23</a></span>
<span class="normal"><a href="#__codelineno-354-24">24</a></span>
<span class="normal"><a href="#__codelineno-354-25">25</a></span>
<span class="normal"><a href="#__codelineno-354-26">26</a></span>
<span class="normal"><a href="#__codelineno-354-27">27</a></span>
<span class="normal"><a href="#__codelineno-354-28">28</a></span>
<span class="normal"><a href="#__codelineno-354-29">29</a></span>
<span class="normal"><a href="#__codelineno-354-30">30</a></span>
<span class="normal"><a href="#__codelineno-354-31">31</a></span>
<span class="normal"><a href="#__codelineno-354-32">32</a></span>
<span class="normal"><a href="#__codelineno-354-33">33</a></span>
<span class="normal"><a href="#__codelineno-354-34">34</a></span>
<span class="normal"><a href="#__codelineno-354-35">35</a></span>
<span class="normal"><a href="#__codelineno-354-36">36</a></span>
<span class="normal"><a href="#__codelineno-354-37">37</a></span>
<span class="normal"><a href="#__codelineno-354-38">38</a></span>
<span class="normal"><a href="#__codelineno-354-39">39</a></span>
<span class="normal"><a href="#__codelineno-354-40">40</a></span>
<span class="normal"><a href="#__codelineno-354-41">41</a></span>
<span class="normal"><a href="#__codelineno-354-42">42</a></span>
<span class="normal"><a href="#__codelineno-354-43">43</a></span>
<span class="normal"><a href="#__codelineno-354-44">44</a></span>
<span class="normal"><a href="#__codelineno-354-45">45</a></span>
<span class="normal"><a href="#__codelineno-354-46">46</a></span>
<span class="normal"><a href="#__codelineno-354-47">47</a></span>
<span class="normal"><a href="#__codelineno-354-48">48</a></span>
<span class="normal"><a href="#__codelineno-354-49">49</a></span>
<span class="normal"><a href="#__codelineno-354-50">50</a></span>
<span class="normal"><a href="#__codelineno-354-51">51</a></span>
<span class="normal"><a href="#__codelineno-354-52">52</a></span>
<span class="normal"><a href="#__codelineno-354-53">53</a></span>
<span class="normal"><a href="#__codelineno-354-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-354-1" name="__codelineno-354-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-354-2" name="__codelineno-354-2"></a>
<a id="__codelineno-354-3" name="__codelineno-354-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-354-4" name="__codelineno-354-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-354-5" name="__codelineno-354-5"></a><span class="w">    </span><span class="s">&quot;errors&quot;</span>
<a id="__codelineno-354-6" name="__codelineno-354-6"></a><span class="p">)</span>
<a id="__codelineno-354-7" name="__codelineno-354-7"></a>
<a id="__codelineno-354-8" name="__codelineno-354-8"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-354-9" name="__codelineno-354-9"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-10" name="__codelineno-354-10"></a><span class="w">    </span><span class="nx">Username</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-354-11" name="__codelineno-354-11"></a><span class="w">    </span><span class="nx">Email</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-354-12" name="__codelineno-354-12"></a><span class="w">    </span><span class="nx">Age</span><span class="w">      </span><span class="kt">int</span>
<a id="__codelineno-354-13" name="__codelineno-354-13"></a><span class="p">}</span>
<a id="__codelineno-354-14" name="__codelineno-354-14"></a>
<a id="__codelineno-354-15" name="__codelineno-354-15"></a><span class="c1">// 定义方法验证User</span>
<a id="__codelineno-354-16" name="__codelineno-354-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Validate</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-17" name="__codelineno-354-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">Username</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-18" name="__codelineno-354-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;用户名不能为空&quot;</span><span class="p">)</span>
<a id="__codelineno-354-19" name="__codelineno-354-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-354-20" name="__codelineno-354-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">Email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-21" name="__codelineno-354-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;邮箱不能为空&quot;</span><span class="p">)</span>
<a id="__codelineno-354-22" name="__codelineno-354-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-354-23" name="__codelineno-354-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">Age</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">Age</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">150</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-24" name="__codelineno-354-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;年龄不合法&quot;</span><span class="p">)</span>
<a id="__codelineno-354-25" name="__codelineno-354-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-354-26" name="__codelineno-354-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-354-27" name="__codelineno-354-27"></a><span class="p">}</span>
<a id="__codelineno-354-28" name="__codelineno-354-28"></a>
<a id="__codelineno-354-29" name="__codelineno-354-29"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-30" name="__codelineno-354-30"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-354-31" name="__codelineno-354-31"></a><span class="w">        </span><span class="nx">Username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;john_doe&quot;</span><span class="p">,</span>
<a id="__codelineno-354-32" name="__codelineno-354-32"></a><span class="w">        </span><span class="nx">Email</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;john@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-354-33" name="__codelineno-354-33"></a><span class="w">        </span><span class="nx">Age</span><span class="p">:</span><span class="w">      </span><span class="mi">28</span><span class="p">,</span>
<a id="__codelineno-354-34" name="__codelineno-354-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-354-35" name="__codelineno-354-35"></a>
<a id="__codelineno-354-36" name="__codelineno-354-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Validate</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-37" name="__codelineno-354-37"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;验证失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-354-38" name="__codelineno-354-38"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-39" name="__codelineno-354-39"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;用户信息合法&quot;</span><span class="p">)</span>
<a id="__codelineno-354-40" name="__codelineno-354-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-354-41" name="__codelineno-354-41"></a>
<a id="__codelineno-354-42" name="__codelineno-354-42"></a><span class="w">    </span><span class="c1">// 测试不合法的用户</span>
<a id="__codelineno-354-43" name="__codelineno-354-43"></a><span class="w">    </span><span class="nx">invalidUser</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-354-44" name="__codelineno-354-44"></a><span class="w">        </span><span class="nx">Username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-354-45" name="__codelineno-354-45"></a><span class="w">        </span><span class="nx">Email</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;invalid@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-354-46" name="__codelineno-354-46"></a><span class="w">        </span><span class="nx">Age</span><span class="p">:</span><span class="w">      </span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-354-47" name="__codelineno-354-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-354-48" name="__codelineno-354-48"></a>
<a id="__codelineno-354-49" name="__codelineno-354-49"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">invalidUser</span><span class="p">.</span><span class="nx">Validate</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-50" name="__codelineno-354-50"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;验证失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 验证失败: 用户名不能为空</span>
<a id="__codelineno-354-51" name="__codelineno-354-51"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-354-52" name="__codelineno-354-52"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;用户信息合法&quot;</span><span class="p">)</span>
<a id="__codelineno-354-53" name="__codelineno-354-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-354-54" name="__codelineno-354-54"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-355-1">1</a></span>
<span class="normal"><a href="#__codelineno-355-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-355-1" name="__codelineno-355-1"></a>用户信息合法
<a id="__codelineno-355-2" name="__codelineno-355-2"></a>验证失败: 用户名不能为空
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_10">注意事项<a class="headerlink" href="#注意事项_10" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>接收者的选择</strong>：根据方法是否需要修改结构体的字段，选择值接收者或指针接收者。一般情况下，使用指针接收者可以避免复制结构体，提升性能，且可以修改结构体的字段。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-356-1">1</a></span>
<span class="normal"><a href="#__codelineno-356-2">2</a></span>
<span class="normal"><a href="#__codelineno-356-3">3</a></span>
<span class="normal"><a href="#__codelineno-356-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-356-1" name="__codelineno-356-1"></a><span class="c1">// 修改结构体字段</span>
<a id="__codelineno-356-2" name="__codelineno-356-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">SetName</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-356-3" name="__codelineno-356-3"></a><span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">name</span>
<a id="__codelineno-356-4" name="__codelineno-356-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><strong>方法的命名</strong>：方法名应简洁明了，能够清晰描述方法的功能。例如，<code>CalculateArea</code>、<code>PrintDetails</code>等。</p>
</li>
<li>
<p><strong>方法与函数的区别</strong>：方法是与特定类型相关联的函数，而函数是独立的。合理使用方法可以提升代码的可读性和组织性。</p>
</li>
</ul>
<h3 id="75-指针与结构体">7.5 指针与结构体<a class="headerlink" href="#75-指针与结构体" title="Permanent link">&para;</a></h3>
<p>指针是存储变量内存地址的变量。在Go语言中，指针与结构体结合使用，可以提高程序的性能，避免大量数据的复制，同时实现对结构体的修改和共享。</p>
<h4 id="指针基础">指针基础<a class="headerlink" href="#指针基础" title="Permanent link">&para;</a></h4>
<p><strong>1. 声明指针</strong></p>
<p>使用<code>*</code>符号声明指针类型。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-357-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-357-1" name="__codelineno-357-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>p</code>是一个指向<code>int</code>类型的指针，初始值为<code>nil</code>。</li>
</ul>
<p><strong>2. 获取变量的地址</strong></p>
<p>使用<code>&amp;</code>符号获取变量的内存地址。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-358-1">1</a></span>
<span class="normal"><a href="#__codelineno-358-2">2</a></span>
<span class="normal"><a href="#__codelineno-358-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-358-1" name="__codelineno-358-1"></a><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-358-2" name="__codelineno-358-2"></a><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span>
<a id="__codelineno-358-3" name="__codelineno-358-3"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a的地址:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: a的地址: 0xc0000140b0</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 解引用指针</strong></p>
<p>使用<code>*</code>符号访问指针指向的值。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-359-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-359-1" name="__codelineno-359-1"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;p指向的值:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: p指向的值: 10</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 修改指针指向的值</strong></p>
<p>通过指针修改变量的值。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-360-1">1</a></span>
<span class="normal"><a href="#__codelineno-360-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-360-1" name="__codelineno-360-1"></a><span class="o">*</span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-360-2" name="__codelineno-360-2"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的a:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 修改后的a: 20</span>
</code></pre></div></td></tr></table></div>
<p><strong>完整示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-361-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-361-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-361-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-361-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-361-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-361-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-361-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-361-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-361-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-361-10">10</a></span>
<span class="normal"><a href="#__codelineno-361-11">11</a></span>
<span class="normal"><a href="#__codelineno-361-12">12</a></span>
<span class="normal"><a href="#__codelineno-361-13">13</a></span>
<span class="normal"><a href="#__codelineno-361-14">14</a></span>
<span class="normal"><a href="#__codelineno-361-15">15</a></span>
<span class="normal"><a href="#__codelineno-361-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-361-1" name="__codelineno-361-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-361-2" name="__codelineno-361-2"></a>
<a id="__codelineno-361-3" name="__codelineno-361-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-361-4" name="__codelineno-361-4"></a>
<a id="__codelineno-361-5" name="__codelineno-361-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-361-6" name="__codelineno-361-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-361-7" name="__codelineno-361-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span>
<a id="__codelineno-361-8" name="__codelineno-361-8"></a>
<a id="__codelineno-361-9" name="__codelineno-361-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;变量a的值:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w">         </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-361-10" name="__codelineno-361-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;指针p的地址:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w">       </span><span class="c1">// 输出: a的地址</span>
<a id="__codelineno-361-11" name="__codelineno-361-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;指针p指向的值:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w">     </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-361-12" name="__codelineno-361-12"></a>
<a id="__codelineno-361-13" name="__codelineno-361-13"></a><span class="w">    </span><span class="c1">// 修改指针指向的值</span>
<a id="__codelineno-361-14" name="__codelineno-361-14"></a><span class="w">    </span><span class="o">*</span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-361-15" name="__codelineno-361-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的a:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w">         </span><span class="c1">// 输出: 30</span>
<a id="__codelineno-361-16" name="__codelineno-361-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-362-1">1</a></span>
<span class="normal"><a href="#__codelineno-362-2">2</a></span>
<span class="normal"><a href="#__codelineno-362-3">3</a></span>
<span class="normal"><a href="#__codelineno-362-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-362-1" name="__codelineno-362-1"></a>变量a的值: 10
<a id="__codelineno-362-2" name="__codelineno-362-2"></a>指针p的地址: 0xc0000140b0
<a id="__codelineno-362-3" name="__codelineno-362-3"></a>指针p指向的值: 10
<a id="__codelineno-362-4" name="__codelineno-362-4"></a>修改后的a: 30
</code></pre></div></td></tr></table></div>
<h4 id="指针与结构体">指针与结构体<a class="headerlink" href="#指针与结构体" title="Permanent link">&para;</a></h4>
<p>将指针与结构体结合使用，可以避免复制整个结构体，尤其是当结构体较大时，提高程序的性能。此外，通过指针，可以在函数中修改结构体的字段。</p>
<p><strong>1. 定义结构体并使用指针</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-363-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-363-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-363-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-363-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-363-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-363-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-363-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-363-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-363-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-363-10">10</a></span>
<span class="normal"><a href="#__codelineno-363-11">11</a></span>
<span class="normal"><a href="#__codelineno-363-12">12</a></span>
<span class="normal"><a href="#__codelineno-363-13">13</a></span>
<span class="normal"><a href="#__codelineno-363-14">14</a></span>
<span class="normal"><a href="#__codelineno-363-15">15</a></span>
<span class="normal"><a href="#__codelineno-363-16">16</a></span>
<span class="normal"><a href="#__codelineno-363-17">17</a></span>
<span class="normal"><a href="#__codelineno-363-18">18</a></span>
<span class="normal"><a href="#__codelineno-363-19">19</a></span>
<span class="normal"><a href="#__codelineno-363-20">20</a></span>
<span class="normal"><a href="#__codelineno-363-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-363-1" name="__codelineno-363-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-363-2" name="__codelineno-363-2"></a>
<a id="__codelineno-363-3" name="__codelineno-363-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-363-4" name="__codelineno-363-4"></a>
<a id="__codelineno-363-5" name="__codelineno-363-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-363-6" name="__codelineno-363-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-363-7" name="__codelineno-363-7"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-363-8" name="__codelineno-363-8"></a><span class="w">    </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<a id="__codelineno-363-9" name="__codelineno-363-9"></a><span class="p">}</span>
<a id="__codelineno-363-10" name="__codelineno-363-10"></a>
<a id="__codelineno-363-11" name="__codelineno-363-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-363-12" name="__codelineno-363-12"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">}</span>
<a id="__codelineno-363-13" name="__codelineno-363-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原始结构体:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {Alice 25}</span>
<a id="__codelineno-363-14" name="__codelineno-363-14"></a>
<a id="__codelineno-363-15" name="__codelineno-363-15"></a><span class="w">    </span><span class="c1">// 获取结构体的指针</span>
<a id="__codelineno-363-16" name="__codelineno-363-16"></a><span class="w">    </span><span class="nx">ptr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">p</span>
<a id="__codelineno-363-17" name="__codelineno-363-17"></a>
<a id="__codelineno-363-18" name="__codelineno-363-18"></a><span class="w">    </span><span class="c1">// 修改指针指向的结构体字段</span>
<a id="__codelineno-363-19" name="__codelineno-363-19"></a><span class="w">    </span><span class="nx">ptr</span><span class="p">.</span><span class="nx">Age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">26</span>
<a id="__codelineno-363-20" name="__codelineno-363-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的结构体:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {Alice 26}</span>
<a id="__codelineno-363-21" name="__codelineno-363-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 结构体指针作为函数参数</strong></p>
<p>通过将结构体指针作为函数参数，可以在函数中修改结构体的字段，而无需返回修改后的结构体。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-364-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-364-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-364-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-364-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-364-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-364-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-364-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-364-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-364-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-364-10">10</a></span>
<span class="normal"><a href="#__codelineno-364-11">11</a></span>
<span class="normal"><a href="#__codelineno-364-12">12</a></span>
<span class="normal"><a href="#__codelineno-364-13">13</a></span>
<span class="normal"><a href="#__codelineno-364-14">14</a></span>
<span class="normal"><a href="#__codelineno-364-15">15</a></span>
<span class="normal"><a href="#__codelineno-364-16">16</a></span>
<span class="normal"><a href="#__codelineno-364-17">17</a></span>
<span class="normal"><a href="#__codelineno-364-18">18</a></span>
<span class="normal"><a href="#__codelineno-364-19">19</a></span>
<span class="normal"><a href="#__codelineno-364-20">20</a></span>
<span class="normal"><a href="#__codelineno-364-21">21</a></span>
<span class="normal"><a href="#__codelineno-364-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-364-1" name="__codelineno-364-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-364-2" name="__codelineno-364-2"></a>
<a id="__codelineno-364-3" name="__codelineno-364-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-364-4" name="__codelineno-364-4"></a>
<a id="__codelineno-364-5" name="__codelineno-364-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-364-6" name="__codelineno-364-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-364-7" name="__codelineno-364-7"></a><span class="w">    </span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-364-8" name="__codelineno-364-8"></a><span class="p">}</span>
<a id="__codelineno-364-9" name="__codelineno-364-9"></a>
<a id="__codelineno-364-10" name="__codelineno-364-10"></a><span class="c1">// 定义函数，接受结构体指针并修改字段</span>
<a id="__codelineno-364-11" name="__codelineno-364-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Resize</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Rectangle</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-364-12" name="__codelineno-364-12"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">width</span>
<a id="__codelineno-364-13" name="__codelineno-364-13"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">height</span>
<a id="__codelineno-364-14" name="__codelineno-364-14"></a><span class="p">}</span>
<a id="__codelineno-364-15" name="__codelineno-364-15"></a>
<a id="__codelineno-364-16" name="__codelineno-364-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-364-17" name="__codelineno-364-17"></a><span class="w">    </span><span class="nx">rect</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-364-18" name="__codelineno-364-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原始矩形:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {10 5}</span>
<a id="__codelineno-364-19" name="__codelineno-364-19"></a>
<a id="__codelineno-364-20" name="__codelineno-364-20"></a><span class="w">    </span><span class="nx">Resize</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">rect</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-364-21" name="__codelineno-364-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的矩形:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {20 10}</span>
<a id="__codelineno-364-22" name="__codelineno-364-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 指针与方法接收者</strong></p>
<p>前面章节中提到方法接收者可以是指针类型，这样可以在方法中修改结构体的字段。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-365-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-365-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-365-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-365-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-365-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-365-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-365-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-365-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-365-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-365-10">10</a></span>
<span class="normal"><a href="#__codelineno-365-11">11</a></span>
<span class="normal"><a href="#__codelineno-365-12">12</a></span>
<span class="normal"><a href="#__codelineno-365-13">13</a></span>
<span class="normal"><a href="#__codelineno-365-14">14</a></span>
<span class="normal"><a href="#__codelineno-365-15">15</a></span>
<span class="normal"><a href="#__codelineno-365-16">16</a></span>
<span class="normal"><a href="#__codelineno-365-17">17</a></span>
<span class="normal"><a href="#__codelineno-365-18">18</a></span>
<span class="normal"><a href="#__codelineno-365-19">19</a></span>
<span class="normal"><a href="#__codelineno-365-20">20</a></span>
<span class="normal"><a href="#__codelineno-365-21">21</a></span>
<span class="normal"><a href="#__codelineno-365-22">22</a></span>
<span class="normal"><a href="#__codelineno-365-23">23</a></span>
<span class="normal"><a href="#__codelineno-365-24">24</a></span>
<span class="normal"><a href="#__codelineno-365-25">25</a></span>
<span class="normal"><a href="#__codelineno-365-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-365-1" name="__codelineno-365-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-365-2" name="__codelineno-365-2"></a>
<a id="__codelineno-365-3" name="__codelineno-365-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-365-4" name="__codelineno-365-4"></a>
<a id="__codelineno-365-5" name="__codelineno-365-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-365-6" name="__codelineno-365-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Counter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-365-7" name="__codelineno-365-7"></a><span class="w">    </span><span class="nx">count</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-365-8" name="__codelineno-365-8"></a><span class="p">}</span>
<a id="__codelineno-365-9" name="__codelineno-365-9"></a>
<a id="__codelineno-365-10" name="__codelineno-365-10"></a><span class="c1">// 定义指针接收者方法</span>
<a id="__codelineno-365-11" name="__codelineno-365-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Counter</span><span class="p">)</span><span class="w"> </span><span class="nx">Increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-365-12" name="__codelineno-365-12"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<a id="__codelineno-365-13" name="__codelineno-365-13"></a><span class="p">}</span>
<a id="__codelineno-365-14" name="__codelineno-365-14"></a>
<a id="__codelineno-365-15" name="__codelineno-365-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-365-16" name="__codelineno-365-16"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Counter</span><span class="p">{</span><span class="nx">count</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
<a id="__codelineno-365-17" name="__codelineno-365-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;初始计数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 0</span>
<a id="__codelineno-365-18" name="__codelineno-365-18"></a>
<a id="__codelineno-365-19" name="__codelineno-365-19"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Increment</span><span class="p">()</span>
<a id="__codelineno-365-20" name="__codelineno-365-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计数 after Increment:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 1</span>
<a id="__codelineno-365-21" name="__codelineno-365-21"></a>
<a id="__codelineno-365-22" name="__codelineno-365-22"></a><span class="w">    </span><span class="c1">// 使用指针变量</span>
<a id="__codelineno-365-23" name="__codelineno-365-23"></a><span class="w">    </span><span class="nx">cp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">c</span>
<a id="__codelineno-365-24" name="__codelineno-365-24"></a><span class="w">    </span><span class="nx">cp</span><span class="p">.</span><span class="nx">Increment</span><span class="p">()</span>
<a id="__codelineno-365-25" name="__codelineno-365-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计数 after cp.Increment:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 2</span>
<a id="__codelineno-365-26" name="__codelineno-365-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-366-1">1</a></span>
<span class="normal"><a href="#__codelineno-366-2">2</a></span>
<span class="normal"><a href="#__codelineno-366-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-366-1" name="__codelineno-366-1"></a>初始计数: 0
<a id="__codelineno-366-2" name="__codelineno-366-2"></a>计数 after Increment: 1
<a id="__codelineno-366-3" name="__codelineno-366-3"></a>计数 after cp.Increment: 2
</code></pre></div></td></tr></table></div>
<h4 id="指针的高级用法">指针的高级用法<a class="headerlink" href="#指针的高级用法" title="Permanent link">&para;</a></h4>
<p><strong>1. 指针与切片</strong></p>
<p>切片本身是一个引用类型，包含指向底层数组的指针。可以通过指针修改切片元素。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-367-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-367-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-367-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-367-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-367-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-367-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-367-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-367-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-367-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-367-10">10</a></span>
<span class="normal"><a href="#__codelineno-367-11">11</a></span>
<span class="normal"><a href="#__codelineno-367-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-367-1" name="__codelineno-367-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-367-2" name="__codelineno-367-2"></a>
<a id="__codelineno-367-3" name="__codelineno-367-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-367-4" name="__codelineno-367-4"></a>
<a id="__codelineno-367-5" name="__codelineno-367-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-367-6" name="__codelineno-367-6"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-367-7" name="__codelineno-367-7"></a><span class="w">    </span><span class="nx">ptr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">s</span>
<a id="__codelineno-367-8" name="__codelineno-367-8"></a>
<a id="__codelineno-367-9" name="__codelineno-367-9"></a><span class="w">    </span><span class="c1">// 修改切片元素</span>
<a id="__codelineno-367-10" name="__codelineno-367-10"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="nx">ptr</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-367-11" name="__codelineno-367-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [1 20 3]</span>
<a id="__codelineno-367-12" name="__codelineno-367-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 指针与Map</strong></p>
<p>Map是引用类型，使用指针传递Map不会带来额外的性能开销。通常不需要使用指针传递Map，但在某些情况下可以提高灵活性。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-368-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-368-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-368-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-368-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-368-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-368-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-368-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-368-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-368-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-368-10">10</a></span>
<span class="normal"><a href="#__codelineno-368-11">11</a></span>
<span class="normal"><a href="#__codelineno-368-12">12</a></span>
<span class="normal"><a href="#__codelineno-368-13">13</a></span>
<span class="normal"><a href="#__codelineno-368-14">14</a></span>
<span class="normal"><a href="#__codelineno-368-15">15</a></span>
<span class="normal"><a href="#__codelineno-368-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-368-1" name="__codelineno-368-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-368-2" name="__codelineno-368-2"></a>
<a id="__codelineno-368-3" name="__codelineno-368-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-368-4" name="__codelineno-368-4"></a>
<a id="__codelineno-368-5" name="__codelineno-368-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-368-6" name="__codelineno-368-6"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<a id="__codelineno-368-7" name="__codelineno-368-7"></a><span class="w">    </span><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;中国&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;北京&quot;</span>
<a id="__codelineno-368-8" name="__codelineno-368-8"></a><span class="w">    </span><span class="nx">capitals</span><span class="p">[</span><span class="s">&quot;美国&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;华盛顿&quot;</span>
<a id="__codelineno-368-9" name="__codelineno-368-9"></a>
<a id="__codelineno-368-10" name="__codelineno-368-10"></a><span class="w">    </span><span class="nx">modifyMap</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-368-11" name="__codelineno-368-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: map[中国:北京 美国:纽约]</span>
<a id="__codelineno-368-12" name="__codelineno-368-12"></a><span class="p">}</span>
<a id="__codelineno-368-13" name="__codelineno-368-13"></a>
<a id="__codelineno-368-14" name="__codelineno-368-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">modifyMap</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-368-15" name="__codelineno-368-15"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="nx">m</span><span class="p">)[</span><span class="s">&quot;美国&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;纽约&quot;</span>
<a id="__codelineno-368-16" name="__codelineno-368-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 指针数组</strong></p>
<p>数组中可以存储指针类型的元素，适用于需要引用和共享数据的场景。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-369-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-369-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-369-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-369-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-369-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-369-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-369-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-369-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-369-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-369-10">10</a></span>
<span class="normal"><a href="#__codelineno-369-11">11</a></span>
<span class="normal"><a href="#__codelineno-369-12">12</a></span>
<span class="normal"><a href="#__codelineno-369-13">13</a></span>
<span class="normal"><a href="#__codelineno-369-14">14</a></span>
<span class="normal"><a href="#__codelineno-369-15">15</a></span>
<span class="normal"><a href="#__codelineno-369-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-369-1" name="__codelineno-369-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-369-2" name="__codelineno-369-2"></a>
<a id="__codelineno-369-3" name="__codelineno-369-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-369-4" name="__codelineno-369-4"></a>
<a id="__codelineno-369-5" name="__codelineno-369-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-369-6" name="__codelineno-369-6"></a><span class="w">    </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-369-7" name="__codelineno-369-7"></a><span class="w">    </span><span class="nx">ptrArr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="kt">int</span><span class="p">{</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">c</span><span class="p">}</span>
<a id="__codelineno-369-8" name="__codelineno-369-8"></a>
<a id="__codelineno-369-9" name="__codelineno-369-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">ptr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ptrArr</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-369-10" name="__codelineno-369-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ptrArr[%d] 指向的值: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">ptr</span><span class="p">)</span>
<a id="__codelineno-369-11" name="__codelineno-369-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-369-12" name="__codelineno-369-12"></a>
<a id="__codelineno-369-13" name="__codelineno-369-13"></a><span class="w">    </span><span class="c1">// 修改通过指针数组修改原始变量</span>
<a id="__codelineno-369-14" name="__codelineno-369-14"></a><span class="w">    </span><span class="o">*</span><span class="nx">ptrArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-369-15" name="__codelineno-369-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的a:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-369-16" name="__codelineno-369-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-370-1">1</a></span>
<span class="normal"><a href="#__codelineno-370-2">2</a></span>
<span class="normal"><a href="#__codelineno-370-3">3</a></span>
<span class="normal"><a href="#__codelineno-370-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-370-1" name="__codelineno-370-1"></a>ptrArr[0] 指向的值: 1
<a id="__codelineno-370-2" name="__codelineno-370-2"></a>ptrArr[1] 指向的值: 2
<a id="__codelineno-370-3" name="__codelineno-370-3"></a>ptrArr[2] 指向的值: 3
<a id="__codelineno-370-4" name="__codelineno-370-4"></a>修改后的a: 10
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_11">注意事项<a class="headerlink" href="#注意事项_11" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>指针的零值</strong>：未初始化的指针为<code>nil</code>。在使用指针前，确保其已被正确初始化，避免运行时错误。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-371-1">1</a></span>
<span class="normal"><a href="#__codelineno-371-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-371-1" name="__codelineno-371-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span>
<a id="__codelineno-371-2" name="__codelineno-371-2"></a><span class="c1">// fmt.Println(*p) // 运行时错误: invalid memory address or nil pointer dereference</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>避免悬挂指针</strong>：确保指针指向的变量在指针使用期间保持有效，避免指针指向已经释放或超出作用域的变量。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-372-1">1</a></span>
<span class="normal"><a href="#__codelineno-372-2">2</a></span>
<span class="normal"><a href="#__codelineno-372-3">3</a></span>
<span class="normal"><a href="#__codelineno-372-4">4</a></span>
<span class="normal"><a href="#__codelineno-372-5">5</a></span>
<span class="normal"><a href="#__codelineno-372-6">6</a></span>
<span class="normal"><a href="#__codelineno-372-7">7</a></span>
<span class="normal"><a href="#__codelineno-372-8">8</a></span>
<span class="normal"><a href="#__codelineno-372-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-372-1" name="__codelineno-372-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">getPointer</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-372-2" name="__codelineno-372-2"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-372-3" name="__codelineno-372-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">x</span>
<a id="__codelineno-372-4" name="__codelineno-372-4"></a><span class="p">}</span>
<a id="__codelineno-372-5" name="__codelineno-372-5"></a>
<a id="__codelineno-372-6" name="__codelineno-372-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-372-7" name="__codelineno-372-7"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getPointer</span><span class="p">()</span>
<a id="__codelineno-372-8" name="__codelineno-372-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不安全：x已经超出作用域，可能导致未定义行为</span>
<a id="__codelineno-372-9" name="__codelineno-372-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>使用指针优化性能</strong>：对于大型结构体，使用指针传递可以避免复制整个结构体，提高性能。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-373-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-373-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-373-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-373-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-373-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-373-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-373-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-373-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-373-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-373-10">10</a></span>
<span class="normal"><a href="#__codelineno-373-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-373-1" name="__codelineno-373-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">LargeStruct</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-373-2" name="__codelineno-373-2"></a><span class="w">    </span><span class="nx">Data</span><span class="w"> </span><span class="p">[</span><span class="mi">1000</span><span class="p">]</span><span class="kt">int</span>
<a id="__codelineno-373-3" name="__codelineno-373-3"></a><span class="p">}</span>
<a id="__codelineno-373-4" name="__codelineno-373-4"></a>
<a id="__codelineno-373-5" name="__codelineno-373-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ls</span><span class="w"> </span><span class="nx">LargeStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 复制整个结构体</span>
<a id="__codelineno-373-6" name="__codelineno-373-6"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-373-7" name="__codelineno-373-7"></a><span class="p">}</span>
<a id="__codelineno-373-8" name="__codelineno-373-8"></a>
<a id="__codelineno-373-9" name="__codelineno-373-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">processPointer</span><span class="p">(</span><span class="nx">ls</span><span class="w"> </span><span class="o">*</span><span class="nx">LargeStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 传递指针</span>
<a id="__codelineno-373-10" name="__codelineno-373-10"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-373-11" name="__codelineno-373-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>nil指针检查</strong>：在使用指针前，最好检查指针是否为<code>nil</code>，以避免运行时错误。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-374-1">1</a></span>
<span class="normal"><a href="#__codelineno-374-2">2</a></span>
<span class="normal"><a href="#__codelineno-374-3">3</a></span>
<span class="normal"><a href="#__codelineno-374-4">4</a></span>
<span class="normal"><a href="#__codelineno-374-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-374-1" name="__codelineno-374-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-374-2" name="__codelineno-374-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">p</span><span class="p">)</span>
<a id="__codelineno-374-3" name="__codelineno-374-3"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-374-4" name="__codelineno-374-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;指针为nil&quot;</span><span class="p">)</span>
<a id="__codelineno-374-5" name="__codelineno-374-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="76-组合与接口拓展内容">7.6 组合与接口（拓展内容）<a class="headerlink" href="#76-组合与接口拓展内容" title="Permanent link">&para;</a></h3>
<p>虽然用户没有列出<code>组合与接口</code>，在数据结构与集合章节中，了解结构体的组合以及接口的使用也是非常重要的。因此，这里提供对组合和接口的简要介绍。</p>
<h4 id="组合composition">组合（Composition）<a class="headerlink" href="#组合composition" title="Permanent link">&para;</a></h4>
<p>组合是通过嵌入一个结构体到另一个结构体中，实现代码复用和功能扩展的一种方式。通过组合，可以创建复杂的数据结构，同时保持代码的简洁和模块化。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-375-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-375-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-375-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-375-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-375-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-375-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-375-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-375-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-375-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-375-10">10</a></span>
<span class="normal"><a href="#__codelineno-375-11">11</a></span>
<span class="normal"><a href="#__codelineno-375-12">12</a></span>
<span class="normal"><a href="#__codelineno-375-13">13</a></span>
<span class="normal"><a href="#__codelineno-375-14">14</a></span>
<span class="normal"><a href="#__codelineno-375-15">15</a></span>
<span class="normal"><a href="#__codelineno-375-16">16</a></span>
<span class="normal"><a href="#__codelineno-375-17">17</a></span>
<span class="normal"><a href="#__codelineno-375-18">18</a></span>
<span class="normal"><a href="#__codelineno-375-19">19</a></span>
<span class="normal"><a href="#__codelineno-375-20">20</a></span>
<span class="normal"><a href="#__codelineno-375-21">21</a></span>
<span class="normal"><a href="#__codelineno-375-22">22</a></span>
<span class="normal"><a href="#__codelineno-375-23">23</a></span>
<span class="normal"><a href="#__codelineno-375-24">24</a></span>
<span class="normal"><a href="#__codelineno-375-25">25</a></span>
<span class="normal"><a href="#__codelineno-375-26">26</a></span>
<span class="normal"><a href="#__codelineno-375-27">27</a></span>
<span class="normal"><a href="#__codelineno-375-28">28</a></span>
<span class="normal"><a href="#__codelineno-375-29">29</a></span>
<span class="normal"><a href="#__codelineno-375-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-375-1" name="__codelineno-375-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-375-2" name="__codelineno-375-2"></a>
<a id="__codelineno-375-3" name="__codelineno-375-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-375-4" name="__codelineno-375-4"></a>
<a id="__codelineno-375-5" name="__codelineno-375-5"></a><span class="c1">// 定义基本结构体</span>
<a id="__codelineno-375-6" name="__codelineno-375-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-375-7" name="__codelineno-375-7"></a><span class="w">    </span><span class="nx">City</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-375-8" name="__codelineno-375-8"></a><span class="w">    </span><span class="nx">ZipCode</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-375-9" name="__codelineno-375-9"></a><span class="p">}</span>
<a id="__codelineno-375-10" name="__codelineno-375-10"></a>
<a id="__codelineno-375-11" name="__codelineno-375-11"></a><span class="c1">// 定义复合结构体，通过组合Address</span>
<a id="__codelineno-375-12" name="__codelineno-375-12"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-375-13" name="__codelineno-375-13"></a><span class="w">    </span><span class="nx">Name</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-375-14" name="__codelineno-375-14"></a><span class="w">    </span><span class="nx">Age</span><span class="w">     </span><span class="kt">int</span>
<a id="__codelineno-375-15" name="__codelineno-375-15"></a><span class="w">    </span><span class="nx">Address</span><span class="w"> </span><span class="c1">// 组合</span>
<a id="__codelineno-375-16" name="__codelineno-375-16"></a><span class="p">}</span>
<a id="__codelineno-375-17" name="__codelineno-375-17"></a>
<a id="__codelineno-375-18" name="__codelineno-375-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-375-19" name="__codelineno-375-19"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<a id="__codelineno-375-20" name="__codelineno-375-20"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Grace&quot;</span><span class="p">,</span>
<a id="__codelineno-375-21" name="__codelineno-375-21"></a><span class="w">        </span><span class="nx">Age</span><span class="p">:</span><span class="w">  </span><span class="mi">28</span><span class="p">,</span>
<a id="__codelineno-375-22" name="__codelineno-375-22"></a><span class="w">        </span><span class="nx">Address</span><span class="p">:</span><span class="w"> </span><span class="nx">Address</span><span class="p">{</span>
<a id="__codelineno-375-23" name="__codelineno-375-23"></a><span class="w">            </span><span class="nx">City</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;San Francisco&quot;</span><span class="p">,</span>
<a id="__codelineno-375-24" name="__codelineno-375-24"></a><span class="w">            </span><span class="nx">ZipCode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;94105&quot;</span><span class="p">,</span>
<a id="__codelineno-375-25" name="__codelineno-375-25"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-375-26" name="__codelineno-375-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-375-27" name="__codelineno-375-27"></a>
<a id="__codelineno-375-28" name="__codelineno-375-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Person: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span>
<a id="__codelineno-375-29" name="__codelineno-375-29"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;City:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">City</span><span class="p">)</span><span class="w"> </span><span class="c1">// 直接访问组合结构体的字段</span>
<a id="__codelineno-375-30" name="__codelineno-375-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-376-1">1</a></span>
<span class="normal"><a href="#__codelineno-376-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-376-1" name="__codelineno-376-1"></a>Person: {Name:Grace Age:28 Address:{City:San Francisco ZipCode:94105}}
<a id="__codelineno-376-2" name="__codelineno-376-2"></a>City: San Francisco
</code></pre></div></td></tr></table></div>
<p><strong>优势：</strong></p>
<ul>
<li><strong>代码复用</strong>：通过组合，可以复用已有的结构体，减少重复代码。</li>
<li><strong>灵活性</strong>：组合比继承更灵活，避免了继承带来的复杂性。</li>
</ul>
<h4 id="接口interface">接口（Interface）<a class="headerlink" href="#接口interface" title="Permanent link">&para;</a></h4>
<p>接口定义了一组方法签名，任何实现了这些方法的类型都满足该接口。接口提供了多态性，使得代码更加灵活和可扩展。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-377-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-377-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-377-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-377-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-377-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-377-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-377-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-377-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-377-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-377-10">10</a></span>
<span class="normal"><a href="#__codelineno-377-11">11</a></span>
<span class="normal"><a href="#__codelineno-377-12">12</a></span>
<span class="normal"><a href="#__codelineno-377-13">13</a></span>
<span class="normal"><a href="#__codelineno-377-14">14</a></span>
<span class="normal"><a href="#__codelineno-377-15">15</a></span>
<span class="normal"><a href="#__codelineno-377-16">16</a></span>
<span class="normal"><a href="#__codelineno-377-17">17</a></span>
<span class="normal"><a href="#__codelineno-377-18">18</a></span>
<span class="normal"><a href="#__codelineno-377-19">19</a></span>
<span class="normal"><a href="#__codelineno-377-20">20</a></span>
<span class="normal"><a href="#__codelineno-377-21">21</a></span>
<span class="normal"><a href="#__codelineno-377-22">22</a></span>
<span class="normal"><a href="#__codelineno-377-23">23</a></span>
<span class="normal"><a href="#__codelineno-377-24">24</a></span>
<span class="normal"><a href="#__codelineno-377-25">25</a></span>
<span class="normal"><a href="#__codelineno-377-26">26</a></span>
<span class="normal"><a href="#__codelineno-377-27">27</a></span>
<span class="normal"><a href="#__codelineno-377-28">28</a></span>
<span class="normal"><a href="#__codelineno-377-29">29</a></span>
<span class="normal"><a href="#__codelineno-377-30">30</a></span>
<span class="normal"><a href="#__codelineno-377-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-377-1" name="__codelineno-377-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-377-2" name="__codelineno-377-2"></a>
<a id="__codelineno-377-3" name="__codelineno-377-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-377-4" name="__codelineno-377-4"></a>
<a id="__codelineno-377-5" name="__codelineno-377-5"></a><span class="c1">// 定义接口</span>
<a id="__codelineno-377-6" name="__codelineno-377-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Greeter</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-377-7" name="__codelineno-377-7"></a><span class="w">    </span><span class="nx">Greet</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-377-8" name="__codelineno-377-8"></a><span class="p">}</span>
<a id="__codelineno-377-9" name="__codelineno-377-9"></a>
<a id="__codelineno-377-10" name="__codelineno-377-10"></a><span class="c1">// 定义实现接口的结构体</span>
<a id="__codelineno-377-11" name="__codelineno-377-11"></a><span class="kd">type</span><span class="w"> </span><span class="nx">EnglishGreeter</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<a id="__codelineno-377-12" name="__codelineno-377-12"></a>
<a id="__codelineno-377-13" name="__codelineno-377-13"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">eg</span><span class="w"> </span><span class="nx">EnglishGreeter</span><span class="p">)</span><span class="w"> </span><span class="nx">Greet</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-377-14" name="__codelineno-377-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Hello, &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;!&quot;</span>
<a id="__codelineno-377-15" name="__codelineno-377-15"></a><span class="p">}</span>
<a id="__codelineno-377-16" name="__codelineno-377-16"></a>
<a id="__codelineno-377-17" name="__codelineno-377-17"></a><span class="kd">type</span><span class="w"> </span><span class="nx">ChineseGreeter</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<a id="__codelineno-377-18" name="__codelineno-377-18"></a>
<a id="__codelineno-377-19" name="__codelineno-377-19"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cg</span><span class="w"> </span><span class="nx">ChineseGreeter</span><span class="p">)</span><span class="w"> </span><span class="nx">Greet</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-377-20" name="__codelineno-377-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;你好，&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;！&quot;</span>
<a id="__codelineno-377-21" name="__codelineno-377-21"></a><span class="p">}</span>
<a id="__codelineno-377-22" name="__codelineno-377-22"></a>
<a id="__codelineno-377-23" name="__codelineno-377-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-377-24" name="__codelineno-377-24"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="nx">Greeter</span>
<a id="__codelineno-377-25" name="__codelineno-377-25"></a>
<a id="__codelineno-377-26" name="__codelineno-377-26"></a><span class="w">    </span><span class="nx">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">EnglishGreeter</span><span class="p">{}</span>
<a id="__codelineno-377-27" name="__codelineno-377-27"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Greet</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: Hello, Alice!</span>
<a id="__codelineno-377-28" name="__codelineno-377-28"></a>
<a id="__codelineno-377-29" name="__codelineno-377-29"></a><span class="w">    </span><span class="nx">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ChineseGreeter</span><span class="p">{}</span>
<a id="__codelineno-377-30" name="__codelineno-377-30"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Greet</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">))</span><span class="w">   </span><span class="c1">// 输出: 你好，Bob！</span>
<a id="__codelineno-377-31" name="__codelineno-377-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-378-1">1</a></span>
<span class="normal"><a href="#__codelineno-378-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-378-1" name="__codelineno-378-1"></a>Hello, Alice!
<a id="__codelineno-378-2" name="__codelineno-378-2"></a>你好，Bob！
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Greeter</code>接口定义了一个<code>Greet</code>方法。</li>
<li><code>EnglishGreeter</code>和<code>ChineseGreeter</code>结构体实现了<code>Greet</code>方法，满足<code>Greeter</code>接口。</li>
<li>通过接口类型变量<code>g</code>，可以调用不同实现的<code>Greet</code>方法，实现多态性。</li>
</ul>
<p><strong>接口的优势：</strong></p>
<ul>
<li><strong>解耦合</strong>：通过接口，可以将代码模块之间的依赖解耦，提高代码的灵活性和可维护性。</li>
<li><strong>多态性</strong>：同一接口可以由不同类型实现，允许不同的对象以统一的方式被处理。</li>
<li><strong>可扩展性</strong>：无需修改现有代码，只需实现新的接口即可扩展功能。</li>
</ul>
<h4 id="注意事项_12">注意事项<a class="headerlink" href="#注意事项_12" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>接口隐式实现</strong>：在Go语言中，类型只需实现接口的方法，不需要显式声明实现关系。这种隐式实现提高了代码的灵活性和简洁性。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-379-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-379-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-379-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-379-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-379-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-379-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-379-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-379-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-379-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-379-10">10</a></span>
<span class="normal"><a href="#__codelineno-379-11">11</a></span>
<span class="normal"><a href="#__codelineno-379-12">12</a></span>
<span class="normal"><a href="#__codelineno-379-13">13</a></span>
<span class="normal"><a href="#__codelineno-379-14">14</a></span>
<span class="normal"><a href="#__codelineno-379-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-379-1" name="__codelineno-379-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Reader</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-379-2" name="__codelineno-379-2"></a><span class="w">    </span><span class="nx">Read</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<a id="__codelineno-379-3" name="__codelineno-379-3"></a><span class="p">}</span>
<a id="__codelineno-379-4" name="__codelineno-379-4"></a>
<a id="__codelineno-379-5" name="__codelineno-379-5"></a><span class="kd">type</span><span class="w"> </span><span class="nx">MyReader</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<a id="__codelineno-379-6" name="__codelineno-379-6"></a>
<a id="__codelineno-379-7" name="__codelineno-379-7"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">MyReader</span><span class="p">)</span><span class="w"> </span><span class="nx">Read</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-379-8" name="__codelineno-379-8"></a><span class="w">    </span><span class="c1">// 实现Read方法</span>
<a id="__codelineno-379-9" name="__codelineno-379-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-379-10" name="__codelineno-379-10"></a><span class="p">}</span>
<a id="__codelineno-379-11" name="__codelineno-379-11"></a>
<a id="__codelineno-379-12" name="__codelineno-379-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-379-13" name="__codelineno-379-13"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="nx">Reader</span>
<a id="__codelineno-379-14" name="__codelineno-379-14"></a><span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">MyReader</span><span class="p">{}</span>
<a id="__codelineno-379-15" name="__codelineno-379-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>空接口（<code>interface{}</code>）</strong>：空接口可以表示任何类型，是实现通用数据结构和函数的重要工具。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-380-1">1</a></span>
<span class="normal"><a href="#__codelineno-380-2">2</a></span>
<span class="normal"><a href="#__codelineno-380-3">3</a></span>
<span class="normal"><a href="#__codelineno-380-4">4</a></span>
<span class="normal"><a href="#__codelineno-380-5">5</a></span>
<span class="normal"><a href="#__codelineno-380-6">6</a></span>
<span class="normal"><a href="#__codelineno-380-7">7</a></span>
<span class="normal"><a href="#__codelineno-380-8">8</a></span>
<span class="normal"><a href="#__codelineno-380-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-380-1" name="__codelineno-380-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">printAnything</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-380-2" name="__codelineno-380-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<a id="__codelineno-380-3" name="__codelineno-380-3"></a><span class="p">}</span>
<a id="__codelineno-380-4" name="__codelineno-380-4"></a>
<a id="__codelineno-380-5" name="__codelineno-380-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-380-6" name="__codelineno-380-6"></a><span class="w">    </span><span class="nx">printAnything</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-380-7" name="__codelineno-380-7"></a><span class="w">    </span><span class="nx">printAnything</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">)</span>
<a id="__codelineno-380-8" name="__codelineno-380-8"></a><span class="w">    </span><span class="nx">printAnything</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<a id="__codelineno-380-9" name="__codelineno-380-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-381-1">1</a></span>
<span class="normal"><a href="#__codelineno-381-2">2</a></span>
<span class="normal"><a href="#__codelineno-381-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-381-1" name="__codelineno-381-1"></a>100
<a id="__codelineno-381-2" name="__codelineno-381-2"></a>Hello
<a id="__codelineno-381-3" name="__codelineno-381-3"></a>true
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>类型断言和类型切换</strong>：在使用接口时，可能需要进行类型断言或类型切换，以访问具体类型的方法或字段。</li>
</ul>
<p><strong>类型断言示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-382-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-382-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-382-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-382-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-382-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-382-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-382-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-382-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-382-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-382-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-382-1" name="__codelineno-382-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-382-2" name="__codelineno-382-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Go Language&quot;</span>
<a id="__codelineno-382-3" name="__codelineno-382-3"></a>
<a id="__codelineno-382-4" name="__codelineno-382-4"></a><span class="w">    </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
<a id="__codelineno-382-5" name="__codelineno-382-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-382-6" name="__codelineno-382-6"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;字符串长度:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span>
<a id="__codelineno-382-7" name="__codelineno-382-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-382-8" name="__codelineno-382-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;不是字符串类型&quot;</span><span class="p">)</span>
<a id="__codelineno-382-9" name="__codelineno-382-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-382-10" name="__codelineno-382-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>类型切换示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-383-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-383-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-383-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-383-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-383-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-383-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-383-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-383-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-383-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-383-10">10</a></span>
<span class="normal"><a href="#__codelineno-383-11">11</a></span>
<span class="normal"><a href="#__codelineno-383-12">12</a></span>
<span class="normal"><a href="#__codelineno-383-13">13</a></span>
<span class="normal"><a href="#__codelineno-383-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-383-1" name="__codelineno-383-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-383-2" name="__codelineno-383-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.14</span>
<a id="__codelineno-383-3" name="__codelineno-383-3"></a>
<a id="__codelineno-383-4" name="__codelineno-383-4"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-383-5" name="__codelineno-383-5"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">int</span><span class="p">:</span>
<a id="__codelineno-383-6" name="__codelineno-383-6"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;整数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-383-7" name="__codelineno-383-7"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">float64</span><span class="p">:</span>
<a id="__codelineno-383-8" name="__codelineno-383-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;浮点数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-383-9" name="__codelineno-383-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">string</span><span class="p">:</span>
<a id="__codelineno-383-10" name="__codelineno-383-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;字符串:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-383-11" name="__codelineno-383-11"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-383-12" name="__codelineno-383-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;未知类型&quot;</span><span class="p">)</span>
<a id="__codelineno-383-13" name="__codelineno-383-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-383-14" name="__codelineno-383-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="8-面向对象编程">8. 面向对象编程<a class="headerlink" href="#8-面向对象编程" title="Permanent link">&para;</a></h2>
<p>面向对象编程（Object-Oriented Programming，简称OOP）是一种编程范式，通过将数据和行为封装在对象中，以提高代码的可重用性、可维护性和扩展性。虽然Go语言不像传统的OOP语言（如Java、C++）那样提供类和继承的概念，但它通过结构体、方法、接口以及组合等特性，充分支持面向对象的编程风格。本章将详细介绍Go语言中的面向对象编程特性，包括方法、接口、组合与继承等内容。通过丰富的示例和深入的解释，帮助你全面理解和应用这些特性。</p>
<h3 id="81-go-的面向对象特性">8.1 Go 的面向对象特性<a class="headerlink" href="#81-go-的面向对象特性" title="Permanent link">&para;</a></h3>
<p>Go语言虽然没有类（Class）和继承（Inheritance）的概念，但它通过以下几个关键特性实现了面向对象编程的核心理念：</p>
<ul>
<li><strong>结构体（Structs）</strong>：用于定义具有多个字段的复合数据类型，类似于其他语言中的类。</li>
<li><strong>方法（Methods）</strong>：可以为结构体类型定义方法，赋予结构体行为。</li>
<li><strong>接口（Interfaces）</strong>：定义了一组方法签名，任何实现了这些方法的类型都满足该接口，实现了多态性。</li>
<li><strong>组合（Composition）</strong>：通过结构体嵌套实现代码复用和类型扩展，代替传统的继承。</li>
<li><strong>多态（Polymorphism）</strong>：通过接口实现不同类型的统一操作。</li>
</ul>
<h4 id="封装encapsulation">封装（Encapsulation）<a class="headerlink" href="#封装encapsulation" title="Permanent link">&para;</a></h4>
<p>封装是OOP的核心概念之一，通过封装，可以隐藏对象的内部实现细节，仅暴露必要的接口。Go通过导出（首字母大写）和未导出（首字母小写）的标识符实现封装。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-384-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-384-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-384-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-384-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-384-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-384-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-384-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-384-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-384-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-384-10">10</a></span>
<span class="normal"><a href="#__codelineno-384-11">11</a></span>
<span class="normal"><a href="#__codelineno-384-12">12</a></span>
<span class="normal"><a href="#__codelineno-384-13">13</a></span>
<span class="normal"><a href="#__codelineno-384-14">14</a></span>
<span class="normal"><a href="#__codelineno-384-15">15</a></span>
<span class="normal"><a href="#__codelineno-384-16">16</a></span>
<span class="normal"><a href="#__codelineno-384-17">17</a></span>
<span class="normal"><a href="#__codelineno-384-18">18</a></span>
<span class="normal"><a href="#__codelineno-384-19">19</a></span>
<span class="normal"><a href="#__codelineno-384-20">20</a></span>
<span class="normal"><a href="#__codelineno-384-21">21</a></span>
<span class="normal"><a href="#__codelineno-384-22">22</a></span>
<span class="normal"><a href="#__codelineno-384-23">23</a></span>
<span class="normal"><a href="#__codelineno-384-24">24</a></span>
<span class="normal"><a href="#__codelineno-384-25">25</a></span>
<span class="normal"><a href="#__codelineno-384-26">26</a></span>
<span class="normal"><a href="#__codelineno-384-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-384-1" name="__codelineno-384-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-384-2" name="__codelineno-384-2"></a>
<a id="__codelineno-384-3" name="__codelineno-384-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-384-4" name="__codelineno-384-4"></a>
<a id="__codelineno-384-5" name="__codelineno-384-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-384-6" name="__codelineno-384-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-384-7" name="__codelineno-384-7"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="c1">// 导出字段</span>
<a id="__codelineno-384-8" name="__codelineno-384-8"></a><span class="w">    </span><span class="nx">age</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="c1">// 未导出字段</span>
<a id="__codelineno-384-9" name="__codelineno-384-9"></a><span class="p">}</span>
<a id="__codelineno-384-10" name="__codelineno-384-10"></a>
<a id="__codelineno-384-11" name="__codelineno-384-11"></a><span class="c1">// 定义方法访问未导出字段</span>
<a id="__codelineno-384-12" name="__codelineno-384-12"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">GetAge</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-384-13" name="__codelineno-384-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span>
<a id="__codelineno-384-14" name="__codelineno-384-14"></a><span class="p">}</span>
<a id="__codelineno-384-15" name="__codelineno-384-15"></a>
<a id="__codelineno-384-16" name="__codelineno-384-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">SetAge</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-384-17" name="__codelineno-384-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-384-18" name="__codelineno-384-18"></a><span class="w">        </span><span class="nx">p</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span>
<a id="__codelineno-384-19" name="__codelineno-384-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-384-20" name="__codelineno-384-20"></a><span class="p">}</span>
<a id="__codelineno-384-21" name="__codelineno-384-21"></a>
<a id="__codelineno-384-22" name="__codelineno-384-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-384-23" name="__codelineno-384-23"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">}</span>
<a id="__codelineno-384-24" name="__codelineno-384-24"></a><span class="w">    </span><span class="c1">// p.age = 30 // 编译错误: age 是未导出的字段</span>
<a id="__codelineno-384-25" name="__codelineno-384-25"></a><span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">SetAge</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-384-26" name="__codelineno-384-26"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Name: %s, Age: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">GetAge</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出: Name: Alice, Age: 30</span>
<a id="__codelineno-384-27" name="__codelineno-384-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-385-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-385-1" name="__codelineno-385-1"></a>Name: Alice, Age: 30
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Person</code>结构体中，<code>Name</code>字段是导出的，可以在包外访问，而<code>age</code>字段是未导出的，只能在包内访问。</li>
<li>通过<code>GetAge</code>和<code>SetAge</code>方法，控制对<code>age</code>字段的访问和修改，实现了封装。</li>
</ul>
<h4 id="方法methods">方法（Methods）<a class="headerlink" href="#方法methods" title="Permanent link">&para;</a></h4>
<p>方法是与特定类型关联的函数，赋予类型特定的行为。在Go中，方法的定义与函数类似，只是在函数名前添加接收者（Receiver）部分。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-386-1">1</a></span>
<span class="normal"><a href="#__codelineno-386-2">2</a></span>
<span class="normal"><a href="#__codelineno-386-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-386-1" name="__codelineno-386-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">receiver</span><span class="w"> </span><span class="nx">Type</span><span class="p">)</span><span class="w"> </span><span class="nx">MethodName</span><span class="p">(</span><span class="nx">parameters</span><span class="p">)</span><span class="w"> </span><span class="nx">returnTypes</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-386-2" name="__codelineno-386-2"></a><span class="w">    </span><span class="c1">// 方法体</span>
<a id="__codelineno-386-3" name="__codelineno-386-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-387-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-387-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-387-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-387-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-387-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-387-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-387-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-387-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-387-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-387-10">10</a></span>
<span class="normal"><a href="#__codelineno-387-11">11</a></span>
<span class="normal"><a href="#__codelineno-387-12">12</a></span>
<span class="normal"><a href="#__codelineno-387-13">13</a></span>
<span class="normal"><a href="#__codelineno-387-14">14</a></span>
<span class="normal"><a href="#__codelineno-387-15">15</a></span>
<span class="normal"><a href="#__codelineno-387-16">16</a></span>
<span class="normal"><a href="#__codelineno-387-17">17</a></span>
<span class="normal"><a href="#__codelineno-387-18">18</a></span>
<span class="normal"><a href="#__codelineno-387-19">19</a></span>
<span class="normal"><a href="#__codelineno-387-20">20</a></span>
<span class="normal"><a href="#__codelineno-387-21">21</a></span>
<span class="normal"><a href="#__codelineno-387-22">22</a></span>
<span class="normal"><a href="#__codelineno-387-23">23</a></span>
<span class="normal"><a href="#__codelineno-387-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-387-1" name="__codelineno-387-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-387-2" name="__codelineno-387-2"></a>
<a id="__codelineno-387-3" name="__codelineno-387-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-387-4" name="__codelineno-387-4"></a>
<a id="__codelineno-387-5" name="__codelineno-387-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-387-6" name="__codelineno-387-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-387-7" name="__codelineno-387-7"></a><span class="w">    </span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-387-8" name="__codelineno-387-8"></a><span class="p">}</span>
<a id="__codelineno-387-9" name="__codelineno-387-9"></a>
<a id="__codelineno-387-10" name="__codelineno-387-10"></a><span class="c1">// 定义方法计算面积</span>
<a id="__codelineno-387-11" name="__codelineno-387-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-387-12" name="__codelineno-387-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span>
<a id="__codelineno-387-13" name="__codelineno-387-13"></a><span class="p">}</span>
<a id="__codelineno-387-14" name="__codelineno-387-14"></a>
<a id="__codelineno-387-15" name="__codelineno-387-15"></a><span class="c1">// 定义方法计算周长</span>
<a id="__codelineno-387-16" name="__codelineno-387-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Perimeter</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-387-17" name="__codelineno-387-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span><span class="p">)</span>
<a id="__codelineno-387-18" name="__codelineno-387-18"></a><span class="p">}</span>
<a id="__codelineno-387-19" name="__codelineno-387-19"></a>
<a id="__codelineno-387-20" name="__codelineno-387-20"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-387-21" name="__codelineno-387-21"></a><span class="w">    </span><span class="nx">rect</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-387-22" name="__codelineno-387-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;面积: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">Area</span><span class="p">())</span><span class="w">         </span><span class="c1">// 输出: 面积: 50.00</span>
<a id="__codelineno-387-23" name="__codelineno-387-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;周长: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">.</span><span class="nx">Perimeter</span><span class="p">())</span><span class="w">   </span><span class="c1">// 输出: 周长: 30.00</span>
<a id="__codelineno-387-24" name="__codelineno-387-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-388-1">1</a></span>
<span class="normal"><a href="#__codelineno-388-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-388-1" name="__codelineno-388-1"></a>面积: 50.00
<a id="__codelineno-388-2" name="__codelineno-388-2"></a>周长: 30.00
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Rectangle</code>结构体定义了矩形的宽度和高度。</li>
<li><code>Area</code>和<code>Perimeter</code>方法分别计算矩形的面积和周长。</li>
</ul>
<p><strong>指针接收者与值接收者：</strong></p>
<p>方法的接收者可以是值类型或指针类型。选择哪种接收者取决于方法是否需要修改接收者的字段，以及是否希望避免大结构体的复制。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-389-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-389-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-389-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-389-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-389-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-389-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-389-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-389-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-389-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-389-10">10</a></span>
<span class="normal"><a href="#__codelineno-389-11">11</a></span>
<span class="normal"><a href="#__codelineno-389-12">12</a></span>
<span class="normal"><a href="#__codelineno-389-13">13</a></span>
<span class="normal"><a href="#__codelineno-389-14">14</a></span>
<span class="normal"><a href="#__codelineno-389-15">15</a></span>
<span class="normal"><a href="#__codelineno-389-16">16</a></span>
<span class="normal"><a href="#__codelineno-389-17">17</a></span>
<span class="normal"><a href="#__codelineno-389-18">18</a></span>
<span class="normal"><a href="#__codelineno-389-19">19</a></span>
<span class="normal"><a href="#__codelineno-389-20">20</a></span>
<span class="normal"><a href="#__codelineno-389-21">21</a></span>
<span class="normal"><a href="#__codelineno-389-22">22</a></span>
<span class="normal"><a href="#__codelineno-389-23">23</a></span>
<span class="normal"><a href="#__codelineno-389-24">24</a></span>
<span class="normal"><a href="#__codelineno-389-25">25</a></span>
<span class="normal"><a href="#__codelineno-389-26">26</a></span>
<span class="normal"><a href="#__codelineno-389-27">27</a></span>
<span class="normal"><a href="#__codelineno-389-28">28</a></span>
<span class="normal"><a href="#__codelineno-389-29">29</a></span>
<span class="normal"><a href="#__codelineno-389-30">30</a></span>
<span class="normal"><a href="#__codelineno-389-31">31</a></span>
<span class="normal"><a href="#__codelineno-389-32">32</a></span>
<span class="normal"><a href="#__codelineno-389-33">33</a></span>
<span class="normal"><a href="#__codelineno-389-34">34</a></span>
<span class="normal"><a href="#__codelineno-389-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-389-1" name="__codelineno-389-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-389-2" name="__codelineno-389-2"></a>
<a id="__codelineno-389-3" name="__codelineno-389-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-389-4" name="__codelineno-389-4"></a>
<a id="__codelineno-389-5" name="__codelineno-389-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-389-6" name="__codelineno-389-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Counter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-389-7" name="__codelineno-389-7"></a><span class="w">    </span><span class="nx">count</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-389-8" name="__codelineno-389-8"></a><span class="p">}</span>
<a id="__codelineno-389-9" name="__codelineno-389-9"></a>
<a id="__codelineno-389-10" name="__codelineno-389-10"></a><span class="c1">// 值接收者方法</span>
<a id="__codelineno-389-11" name="__codelineno-389-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Counter</span><span class="p">)</span><span class="w"> </span><span class="nx">IncrementValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-389-12" name="__codelineno-389-12"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<a id="__codelineno-389-13" name="__codelineno-389-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Inside IncrementValue:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-389-14" name="__codelineno-389-14"></a><span class="p">}</span>
<a id="__codelineno-389-15" name="__codelineno-389-15"></a>
<a id="__codelineno-389-16" name="__codelineno-389-16"></a><span class="c1">// 指针接收者方法</span>
<a id="__codelineno-389-17" name="__codelineno-389-17"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Counter</span><span class="p">)</span><span class="w"> </span><span class="nx">IncrementPointer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-389-18" name="__codelineno-389-18"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<a id="__codelineno-389-19" name="__codelineno-389-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Inside IncrementPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-389-20" name="__codelineno-389-20"></a><span class="p">}</span>
<a id="__codelineno-389-21" name="__codelineno-389-21"></a>
<a id="__codelineno-389-22" name="__codelineno-389-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-389-23" name="__codelineno-389-23"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Counter</span><span class="p">{</span><span class="nx">count</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">}</span>
<a id="__codelineno-389-24" name="__codelineno-389-24"></a>
<a id="__codelineno-389-25" name="__codelineno-389-25"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">IncrementValue</span><span class="p">()</span><span class="w"> </span><span class="c1">// 修改的是副本</span>
<a id="__codelineno-389-26" name="__codelineno-389-26"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After IncrementValue:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-389-27" name="__codelineno-389-27"></a>
<a id="__codelineno-389-28" name="__codelineno-389-28"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">IncrementPointer</span><span class="p">()</span><span class="w"> </span><span class="c1">// 修改的是原始值</span>
<a id="__codelineno-389-29" name="__codelineno-389-29"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After IncrementPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 11</span>
<a id="__codelineno-389-30" name="__codelineno-389-30"></a>
<a id="__codelineno-389-31" name="__codelineno-389-31"></a><span class="w">    </span><span class="c1">// 使用指针变量调用方法</span>
<a id="__codelineno-389-32" name="__codelineno-389-32"></a><span class="w">    </span><span class="nx">cp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">c</span>
<a id="__codelineno-389-33" name="__codelineno-389-33"></a><span class="w">    </span><span class="nx">cp</span><span class="p">.</span><span class="nx">IncrementPointer</span><span class="p">()</span>
<a id="__codelineno-389-34" name="__codelineno-389-34"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;After cp.IncrementPointer:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 12</span>
<a id="__codelineno-389-35" name="__codelineno-389-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-390-1">1</a></span>
<span class="normal"><a href="#__codelineno-390-2">2</a></span>
<span class="normal"><a href="#__codelineno-390-3">3</a></span>
<span class="normal"><a href="#__codelineno-390-4">4</a></span>
<span class="normal"><a href="#__codelineno-390-5">5</a></span>
<span class="normal"><a href="#__codelineno-390-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-390-1" name="__codelineno-390-1"></a>Inside IncrementValue: 11
<a id="__codelineno-390-2" name="__codelineno-390-2"></a>After IncrementValue: 10
<a id="__codelineno-390-3" name="__codelineno-390-3"></a>Inside IncrementPointer: 11
<a id="__codelineno-390-4" name="__codelineno-390-4"></a>After IncrementPointer: 11
<a id="__codelineno-390-5" name="__codelineno-390-5"></a>Inside IncrementPointer: 12
<a id="__codelineno-390-6" name="__codelineno-390-6"></a>After cp.IncrementPointer: 12
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>IncrementValue</code>方法接收者为值类型，只修改方法内部的副本，不影响原始结构体。</li>
<li><code>IncrementPointer</code>方法接收者为指针类型，修改的是原始结构体的字段。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li>一致性：建议为同一类型的方法统一使用值接收者或指针接收者，避免混淆。</li>
<li>性能：对于大型结构体，使用指针接收者可以避免复制，提高性能。</li>
<li>可修改性：使用指针接收者可以在方法中修改接收者的字段。</li>
</ul>
<h3 id="82-方法">8.2 方法<a class="headerlink" href="#82-方法" title="Permanent link">&para;</a></h3>
<p>方法是与特定类型关联的函数，赋予类型特定的行为。Go语言中的方法可以定义在结构体类型上，使得结构体不仅具有数据，还具有行为。</p>
<h4 id="方法的定义与调用">方法的定义与调用<a class="headerlink" href="#方法的定义与调用" title="Permanent link">&para;</a></h4>
<p><strong>定义方法：</strong></p>
<p>方法的定义与函数类似，不同之处在于方法有一个接收者（Receiver），用于指定该方法属于哪个类型。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-391-1">1</a></span>
<span class="normal"><a href="#__codelineno-391-2">2</a></span>
<span class="normal"><a href="#__codelineno-391-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-391-1" name="__codelineno-391-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">receiver</span><span class="w"> </span><span class="nx">Type</span><span class="p">)</span><span class="w"> </span><span class="nx">MethodName</span><span class="p">(</span><span class="nx">parameters</span><span class="p">)</span><span class="w"> </span><span class="nx">returnTypes</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-391-2" name="__codelineno-391-2"></a><span class="w">    </span><span class="c1">// 方法体</span>
<a id="__codelineno-391-3" name="__codelineno-391-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>receiver</code>：接收者，通常是结构体类型的实例，可以是值类型或指针类型。</li>
<li><code>Type</code>：接收者的类型。</li>
<li><code>MethodName</code>：方法名称。</li>
<li><code>parameters</code>：方法的参数列表。</li>
<li><code>returnTypes</code>：方法的返回值类型。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-392-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-392-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-392-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-392-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-392-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-392-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-392-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-392-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-392-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-392-10">10</a></span>
<span class="normal"><a href="#__codelineno-392-11">11</a></span>
<span class="normal"><a href="#__codelineno-392-12">12</a></span>
<span class="normal"><a href="#__codelineno-392-13">13</a></span>
<span class="normal"><a href="#__codelineno-392-14">14</a></span>
<span class="normal"><a href="#__codelineno-392-15">15</a></span>
<span class="normal"><a href="#__codelineno-392-16">16</a></span>
<span class="normal"><a href="#__codelineno-392-17">17</a></span>
<span class="normal"><a href="#__codelineno-392-18">18</a></span>
<span class="normal"><a href="#__codelineno-392-19">19</a></span>
<span class="normal"><a href="#__codelineno-392-20">20</a></span>
<span class="normal"><a href="#__codelineno-392-21">21</a></span>
<span class="normal"><a href="#__codelineno-392-22">22</a></span>
<span class="normal"><a href="#__codelineno-392-23">23</a></span>
<span class="normal"><a href="#__codelineno-392-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-392-1" name="__codelineno-392-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-392-2" name="__codelineno-392-2"></a>
<a id="__codelineno-392-3" name="__codelineno-392-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-392-4" name="__codelineno-392-4"></a>
<a id="__codelineno-392-5" name="__codelineno-392-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-392-6" name="__codelineno-392-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Circle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-392-7" name="__codelineno-392-7"></a><span class="w">    </span><span class="nx">Radius</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-392-8" name="__codelineno-392-8"></a><span class="p">}</span>
<a id="__codelineno-392-9" name="__codelineno-392-9"></a>
<a id="__codelineno-392-10" name="__codelineno-392-10"></a><span class="c1">// 定义方法计算面积</span>
<a id="__codelineno-392-11" name="__codelineno-392-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-392-12" name="__codelineno-392-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">3.14159</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span>
<a id="__codelineno-392-13" name="__codelineno-392-13"></a><span class="p">}</span>
<a id="__codelineno-392-14" name="__codelineno-392-14"></a>
<a id="__codelineno-392-15" name="__codelineno-392-15"></a><span class="c1">// 定义方法计算周长</span>
<a id="__codelineno-392-16" name="__codelineno-392-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="nx">Circumference</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-392-17" name="__codelineno-392-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3.14159</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span>
<a id="__codelineno-392-18" name="__codelineno-392-18"></a><span class="p">}</span>
<a id="__codelineno-392-19" name="__codelineno-392-19"></a>
<a id="__codelineno-392-20" name="__codelineno-392-20"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-392-21" name="__codelineno-392-21"></a><span class="w">    </span><span class="nx">circle</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Circle</span><span class="p">{</span><span class="nx">Radius</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-392-22" name="__codelineno-392-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;面积: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">Area</span><span class="p">())</span><span class="w">               </span><span class="c1">// 输出: 面积: 78.54</span>
<a id="__codelineno-392-23" name="__codelineno-392-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;周长: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">circle</span><span class="p">.</span><span class="nx">Circumference</span><span class="p">())</span><span class="w">     </span><span class="c1">// 输出: 周长: 31.42</span>
<a id="__codelineno-392-24" name="__codelineno-392-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-393-1">1</a></span>
<span class="normal"><a href="#__codelineno-393-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-393-1" name="__codelineno-393-1"></a>面积: 78.54
<a id="__codelineno-393-2" name="__codelineno-393-2"></a>周长: 31.42
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Circle</code>结构体定义了圆的半径。</li>
<li><code>Area</code>和<code>Circumference</code>方法分别计算圆的面积和周长。</li>
</ul>
<h4 id="方法的接收者">方法的接收者<a class="headerlink" href="#方法的接收者" title="Permanent link">&para;</a></h4>
<p>方法的接收者可以是值类型或指针类型，不同类型的接收者具有不同的行为和性能影响。</p>
<p><strong>值接收者（Value Receiver）：</strong></p>
<ul>
<li>接收者为值类型时，方法接收的是类型的副本。</li>
<li>在方法中对接收者的修改不会影响原始变量。</li>
<li>适用于不需要修改接收者数据的方法。</li>
</ul>
<p><strong>指针接收者（Pointer Receiver）：</strong></p>
<ul>
<li>接收者为指针类型时，方法接收的是类型的地址。</li>
<li>可以在方法中修改接收者的字段，影响原始变量。</li>
<li>避免大结构体的复制，提高性能。</li>
<li>适用于需要修改接收者数据的方法。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-394-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-394-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-394-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-394-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-394-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-394-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-394-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-394-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-394-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-394-10">10</a></span>
<span class="normal"><a href="#__codelineno-394-11">11</a></span>
<span class="normal"><a href="#__codelineno-394-12">12</a></span>
<span class="normal"><a href="#__codelineno-394-13">13</a></span>
<span class="normal"><a href="#__codelineno-394-14">14</a></span>
<span class="normal"><a href="#__codelineno-394-15">15</a></span>
<span class="normal"><a href="#__codelineno-394-16">16</a></span>
<span class="normal"><a href="#__codelineno-394-17">17</a></span>
<span class="normal"><a href="#__codelineno-394-18">18</a></span>
<span class="normal"><a href="#__codelineno-394-19">19</a></span>
<span class="normal"><a href="#__codelineno-394-20">20</a></span>
<span class="normal"><a href="#__codelineno-394-21">21</a></span>
<span class="normal"><a href="#__codelineno-394-22">22</a></span>
<span class="normal"><a href="#__codelineno-394-23">23</a></span>
<span class="normal"><a href="#__codelineno-394-24">24</a></span>
<span class="normal"><a href="#__codelineno-394-25">25</a></span>
<span class="normal"><a href="#__codelineno-394-26">26</a></span>
<span class="normal"><a href="#__codelineno-394-27">27</a></span>
<span class="normal"><a href="#__codelineno-394-28">28</a></span>
<span class="normal"><a href="#__codelineno-394-29">29</a></span>
<span class="normal"><a href="#__codelineno-394-30">30</a></span>
<span class="normal"><a href="#__codelineno-394-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-394-1" name="__codelineno-394-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-394-2" name="__codelineno-394-2"></a>
<a id="__codelineno-394-3" name="__codelineno-394-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-394-4" name="__codelineno-394-4"></a>
<a id="__codelineno-394-5" name="__codelineno-394-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-394-6" name="__codelineno-394-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">BankAccount</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-394-7" name="__codelineno-394-7"></a><span class="w">    </span><span class="nx">Owner</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-394-8" name="__codelineno-394-8"></a><span class="w">    </span><span class="nx">Balance</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-394-9" name="__codelineno-394-9"></a><span class="p">}</span>
<a id="__codelineno-394-10" name="__codelineno-394-10"></a>
<a id="__codelineno-394-11" name="__codelineno-394-11"></a><span class="c1">// 值接收者方法</span>
<a id="__codelineno-394-12" name="__codelineno-394-12"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ba</span><span class="w"> </span><span class="nx">BankAccount</span><span class="p">)</span><span class="w"> </span><span class="nx">DepositValue</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-394-13" name="__codelineno-394-13"></a><span class="w">    </span><span class="nx">ba</span><span class="p">.</span><span class="nx">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">amount</span>
<a id="__codelineno-394-14" name="__codelineno-394-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[DepositValue] 新余额: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ba</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)</span>
<a id="__codelineno-394-15" name="__codelineno-394-15"></a><span class="p">}</span>
<a id="__codelineno-394-16" name="__codelineno-394-16"></a>
<a id="__codelineno-394-17" name="__codelineno-394-17"></a><span class="c1">// 指针接收者方法</span>
<a id="__codelineno-394-18" name="__codelineno-394-18"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ba</span><span class="w"> </span><span class="o">*</span><span class="nx">BankAccount</span><span class="p">)</span><span class="w"> </span><span class="nx">DepositPointer</span><span class="p">(</span><span class="nx">amount</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-394-19" name="__codelineno-394-19"></a><span class="w">    </span><span class="nx">ba</span><span class="p">.</span><span class="nx">Balance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">amount</span>
<a id="__codelineno-394-20" name="__codelineno-394-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;[DepositPointer] 新余额: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ba</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)</span>
<a id="__codelineno-394-21" name="__codelineno-394-21"></a><span class="p">}</span>
<a id="__codelineno-394-22" name="__codelineno-394-22"></a>
<a id="__codelineno-394-23" name="__codelineno-394-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-394-24" name="__codelineno-394-24"></a><span class="w">    </span><span class="nx">account</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">BankAccount</span><span class="p">{</span><span class="nx">Owner</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;John Doe&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Balance</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">}</span>
<a id="__codelineno-394-25" name="__codelineno-394-25"></a>
<a id="__codelineno-394-26" name="__codelineno-394-26"></a><span class="w">    </span><span class="nx">account</span><span class="p">.</span><span class="nx">DepositValue</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="w">     </span><span class="c1">// 修改的是副本</span>
<a id="__codelineno-394-27" name="__codelineno-394-27"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;余额 after DepositValue: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 1000.00</span>
<a id="__codelineno-394-28" name="__codelineno-394-28"></a>
<a id="__codelineno-394-29" name="__codelineno-394-29"></a><span class="w">    </span><span class="nx">account</span><span class="p">.</span><span class="nx">DepositPointer</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="w">   </span><span class="c1">// 修改的是原始变量</span>
<a id="__codelineno-394-30" name="__codelineno-394-30"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;余额 after DepositPointer: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">account</span><span class="p">.</span><span class="nx">Balance</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 1500.00</span>
<a id="__codelineno-394-31" name="__codelineno-394-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-395-1">1</a></span>
<span class="normal"><a href="#__codelineno-395-2">2</a></span>
<span class="normal"><a href="#__codelineno-395-3">3</a></span>
<span class="normal"><a href="#__codelineno-395-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-395-1" name="__codelineno-395-1"></a>[DepositValue] 新余额: 1500.00
<a id="__codelineno-395-2" name="__codelineno-395-2"></a>余额 after DepositValue: 1000.00
<a id="__codelineno-395-3" name="__codelineno-395-3"></a>[DepositPointer] 新余额: 1500.00
<a id="__codelineno-395-4" name="__codelineno-395-4"></a>余额 after DepositPointer: 1500.00
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>DepositValue</code>方法接收者为值类型，仅修改方法内部的副本，原始余额不变。</li>
<li><code>DepositPointer</code>方法接收者为指针类型，修改的是原始余额。</li>
</ul>
<p><strong>选择接收者类型的建议：</strong></p>
<ul>
<li>如果方法需要修改接收者的字段，使用指针接收者。</li>
<li>对于大型结构体，使用指针接收者以避免复制，提高性能。</li>
<li>如果方法不需要修改接收者，并且结构体较小，使用值接收者。</li>
<li>为保持一致性，建议为同一类型的方法统一使用指针接收者或值接收者。</li>
</ul>
<h4 id="方法的嵌套与组合">方法的嵌套与组合<a class="headerlink" href="#方法的嵌套与组合" title="Permanent link">&para;</a></h4>
<p>虽然Go语言不支持类的继承，但可以通过结构体嵌套和组合实现类似的功能，赋予结构体更丰富的行为。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-396-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-396-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-396-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-396-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-396-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-396-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-396-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-396-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-396-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-396-10">10</a></span>
<span class="normal"><a href="#__codelineno-396-11">11</a></span>
<span class="normal"><a href="#__codelineno-396-12">12</a></span>
<span class="normal"><a href="#__codelineno-396-13">13</a></span>
<span class="normal"><a href="#__codelineno-396-14">14</a></span>
<span class="normal"><a href="#__codelineno-396-15">15</a></span>
<span class="normal"><a href="#__codelineno-396-16">16</a></span>
<span class="normal"><a href="#__codelineno-396-17">17</a></span>
<span class="normal"><a href="#__codelineno-396-18">18</a></span>
<span class="normal"><a href="#__codelineno-396-19">19</a></span>
<span class="normal"><a href="#__codelineno-396-20">20</a></span>
<span class="normal"><a href="#__codelineno-396-21">21</a></span>
<span class="normal"><a href="#__codelineno-396-22">22</a></span>
<span class="normal"><a href="#__codelineno-396-23">23</a></span>
<span class="normal"><a href="#__codelineno-396-24">24</a></span>
<span class="normal"><a href="#__codelineno-396-25">25</a></span>
<span class="normal"><a href="#__codelineno-396-26">26</a></span>
<span class="normal"><a href="#__codelineno-396-27">27</a></span>
<span class="normal"><a href="#__codelineno-396-28">28</a></span>
<span class="normal"><a href="#__codelineno-396-29">29</a></span>
<span class="normal"><a href="#__codelineno-396-30">30</a></span>
<span class="normal"><a href="#__codelineno-396-31">31</a></span>
<span class="normal"><a href="#__codelineno-396-32">32</a></span>
<span class="normal"><a href="#__codelineno-396-33">33</a></span>
<span class="normal"><a href="#__codelineno-396-34">34</a></span>
<span class="normal"><a href="#__codelineno-396-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-396-1" name="__codelineno-396-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-396-2" name="__codelineno-396-2"></a>
<a id="__codelineno-396-3" name="__codelineno-396-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-396-4" name="__codelineno-396-4"></a>
<a id="__codelineno-396-5" name="__codelineno-396-5"></a><span class="c1">// 定义基础结构体</span>
<a id="__codelineno-396-6" name="__codelineno-396-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Animal</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-396-7" name="__codelineno-396-7"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-396-8" name="__codelineno-396-8"></a><span class="p">}</span>
<a id="__codelineno-396-9" name="__codelineno-396-9"></a>
<a id="__codelineno-396-10" name="__codelineno-396-10"></a><span class="c1">// 定义方法</span>
<a id="__codelineno-396-11" name="__codelineno-396-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="nx">Animal</span><span class="p">)</span><span class="w"> </span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-396-12" name="__codelineno-396-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s makes a sound.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-396-13" name="__codelineno-396-13"></a><span class="p">}</span>
<a id="__codelineno-396-14" name="__codelineno-396-14"></a>
<a id="__codelineno-396-15" name="__codelineno-396-15"></a><span class="c1">// 定义子结构体，通过嵌套结构体实现组合</span>
<a id="__codelineno-396-16" name="__codelineno-396-16"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-396-17" name="__codelineno-396-17"></a><span class="w">    </span><span class="nx">Animal</span>
<a id="__codelineno-396-18" name="__codelineno-396-18"></a><span class="w">    </span><span class="nx">Breed</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-396-19" name="__codelineno-396-19"></a><span class="p">}</span>
<a id="__codelineno-396-20" name="__codelineno-396-20"></a>
<a id="__codelineno-396-21" name="__codelineno-396-21"></a><span class="c1">// 重写Speak方法</span>
<a id="__codelineno-396-22" name="__codelineno-396-22"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="nx">Dog</span><span class="p">)</span><span class="w"> </span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-396-23" name="__codelineno-396-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s barks.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-396-24" name="__codelineno-396-24"></a><span class="p">}</span>
<a id="__codelineno-396-25" name="__codelineno-396-25"></a>
<a id="__codelineno-396-26" name="__codelineno-396-26"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-396-27" name="__codelineno-396-27"></a><span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Animal</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Generic Animal&quot;</span><span class="p">}</span>
<a id="__codelineno-396-28" name="__codelineno-396-28"></a><span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="c1">// 输出: Generic Animal makes a sound.</span>
<a id="__codelineno-396-29" name="__codelineno-396-29"></a>
<a id="__codelineno-396-30" name="__codelineno-396-30"></a><span class="w">    </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Dog</span><span class="p">{</span>
<a id="__codelineno-396-31" name="__codelineno-396-31"></a><span class="w">        </span><span class="nx">Animal</span><span class="p">:</span><span class="w"> </span><span class="nx">Animal</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Buddy&quot;</span><span class="p">},</span>
<a id="__codelineno-396-32" name="__codelineno-396-32"></a><span class="w">        </span><span class="nx">Breed</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Golden Retriever&quot;</span><span class="p">,</span>
<a id="__codelineno-396-33" name="__codelineno-396-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-396-34" name="__codelineno-396-34"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="c1">// 输出: Buddy barks.</span>
<a id="__codelineno-396-35" name="__codelineno-396-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-397-1">1</a></span>
<span class="normal"><a href="#__codelineno-397-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-397-1" name="__codelineno-397-1"></a>Generic Animal makes a sound.
<a id="__codelineno-397-2" name="__codelineno-397-2"></a>Buddy barks.
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Dog</code>结构体通过嵌套<code>Animal</code>结构体，实现了<code>Animal</code>的字段和方法。</li>
<li><code>Dog</code>结构体重写了<code>Animal</code>的<code>Speak</code>方法，实现了多态性。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li>Go语言不支持方法的覆盖（Override）和继承（Inheritance），但可以通过组合和接口实现类似的功能。</li>
<li>通过结构体嵌套，可以实现代码复用和类型扩展，增强结构体的功能。</li>
</ul>
<h3 id="83-接口">8.3 接口<a class="headerlink" href="#83-接口" title="Permanent link">&para;</a></h3>
<p>接口（Interface）是Go语言中实现多态性的核心机制。接口定义了一组方法的签名，任何实现了这些方法的类型都满足该接口。通过接口，可以编写更加灵活和可扩展的代码。</p>
<h4 id="定义接口">定义接口<a class="headerlink" href="#定义接口" title="Permanent link">&para;</a></h4>
<p>接口使用<code>type</code>关键字和<code>interface</code>关键字定义，包含了一组方法签名。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-398-1">1</a></span>
<span class="normal"><a href="#__codelineno-398-2">2</a></span>
<span class="normal"><a href="#__codelineno-398-3">3</a></span>
<span class="normal"><a href="#__codelineno-398-4">4</a></span>
<span class="normal"><a href="#__codelineno-398-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-398-1" name="__codelineno-398-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">InterfaceName</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-398-2" name="__codelineno-398-2"></a><span class="w">    </span><span class="nx">Method1</span><span class="p">(</span><span class="nx">parameters</span><span class="p">)</span><span class="w"> </span><span class="nx">returnTypes</span>
<a id="__codelineno-398-3" name="__codelineno-398-3"></a><span class="w">    </span><span class="nx">Method2</span><span class="p">(</span><span class="nx">parameters</span><span class="p">)</span><span class="w"> </span><span class="nx">returnTypes</span>
<a id="__codelineno-398-4" name="__codelineno-398-4"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-398-5" name="__codelineno-398-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-399-1">1</a></span>
<span class="normal"><a href="#__codelineno-399-2">2</a></span>
<span class="normal"><a href="#__codelineno-399-3">3</a></span>
<span class="normal"><a href="#__codelineno-399-4">4</a></span>
<span class="normal"><a href="#__codelineno-399-5">5</a></span>
<span class="normal"><a href="#__codelineno-399-6">6</a></span>
<span class="normal"><a href="#__codelineno-399-7">7</a></span>
<span class="normal"><a href="#__codelineno-399-8">8</a></span>
<span class="normal"><a href="#__codelineno-399-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-399-1" name="__codelineno-399-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-399-2" name="__codelineno-399-2"></a>
<a id="__codelineno-399-3" name="__codelineno-399-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-399-4" name="__codelineno-399-4"></a>
<a id="__codelineno-399-5" name="__codelineno-399-5"></a><span class="c1">// 定义接口</span>
<a id="__codelineno-399-6" name="__codelineno-399-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Shape</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-399-7" name="__codelineno-399-7"></a><span class="w">    </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-399-8" name="__codelineno-399-8"></a><span class="w">    </span><span class="nx">Perimeter</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-399-9" name="__codelineno-399-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Shape</code>接口定义了两个方法：<code>Area</code>和<code>Perimeter</code>，均返回<code>float64</code>类型的值。</li>
</ul>
<h4 id="实现接口">实现接口<a class="headerlink" href="#实现接口" title="Permanent link">&para;</a></h4>
<p>在Go语言中，不需要显式声明一个类型实现了某个接口，只需定义了接口中的所有方法即可。这样的隐式实现机制提高了代码的灵活性和简洁性。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-400-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-400-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-400-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-400-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-400-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-400-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-400-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-400-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-400-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-400-10">10</a></span>
<span class="normal"><a href="#__codelineno-400-11">11</a></span>
<span class="normal"><a href="#__codelineno-400-12">12</a></span>
<span class="normal"><a href="#__codelineno-400-13">13</a></span>
<span class="normal"><a href="#__codelineno-400-14">14</a></span>
<span class="normal"><a href="#__codelineno-400-15">15</a></span>
<span class="normal"><a href="#__codelineno-400-16">16</a></span>
<span class="normal"><a href="#__codelineno-400-17">17</a></span>
<span class="normal"><a href="#__codelineno-400-18">18</a></span>
<span class="normal"><a href="#__codelineno-400-19">19</a></span>
<span class="normal"><a href="#__codelineno-400-20">20</a></span>
<span class="normal"><a href="#__codelineno-400-21">21</a></span>
<span class="normal"><a href="#__codelineno-400-22">22</a></span>
<span class="normal"><a href="#__codelineno-400-23">23</a></span>
<span class="normal"><a href="#__codelineno-400-24">24</a></span>
<span class="normal"><a href="#__codelineno-400-25">25</a></span>
<span class="normal"><a href="#__codelineno-400-26">26</a></span>
<span class="normal"><a href="#__codelineno-400-27">27</a></span>
<span class="normal"><a href="#__codelineno-400-28">28</a></span>
<span class="normal"><a href="#__codelineno-400-29">29</a></span>
<span class="normal"><a href="#__codelineno-400-30">30</a></span>
<span class="normal"><a href="#__codelineno-400-31">31</a></span>
<span class="normal"><a href="#__codelineno-400-32">32</a></span>
<span class="normal"><a href="#__codelineno-400-33">33</a></span>
<span class="normal"><a href="#__codelineno-400-34">34</a></span>
<span class="normal"><a href="#__codelineno-400-35">35</a></span>
<span class="normal"><a href="#__codelineno-400-36">36</a></span>
<span class="normal"><a href="#__codelineno-400-37">37</a></span>
<span class="normal"><a href="#__codelineno-400-38">38</a></span>
<span class="normal"><a href="#__codelineno-400-39">39</a></span>
<span class="normal"><a href="#__codelineno-400-40">40</a></span>
<span class="normal"><a href="#__codelineno-400-41">41</a></span>
<span class="normal"><a href="#__codelineno-400-42">42</a></span>
<span class="normal"><a href="#__codelineno-400-43">43</a></span>
<span class="normal"><a href="#__codelineno-400-44">44</a></span>
<span class="normal"><a href="#__codelineno-400-45">45</a></span>
<span class="normal"><a href="#__codelineno-400-46">46</a></span>
<span class="normal"><a href="#__codelineno-400-47">47</a></span>
<span class="normal"><a href="#__codelineno-400-48">48</a></span>
<span class="normal"><a href="#__codelineno-400-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-400-1" name="__codelineno-400-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-400-2" name="__codelineno-400-2"></a>
<a id="__codelineno-400-3" name="__codelineno-400-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-400-4" name="__codelineno-400-4"></a>
<a id="__codelineno-400-5" name="__codelineno-400-5"></a><span class="c1">// 定义接口</span>
<a id="__codelineno-400-6" name="__codelineno-400-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Shape</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-7" name="__codelineno-400-7"></a><span class="w">    </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-400-8" name="__codelineno-400-8"></a><span class="w">    </span><span class="nx">Perimeter</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-400-9" name="__codelineno-400-9"></a><span class="p">}</span>
<a id="__codelineno-400-10" name="__codelineno-400-10"></a>
<a id="__codelineno-400-11" name="__codelineno-400-11"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-400-12" name="__codelineno-400-12"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-13" name="__codelineno-400-13"></a><span class="w">    </span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-400-14" name="__codelineno-400-14"></a><span class="p">}</span>
<a id="__codelineno-400-15" name="__codelineno-400-15"></a>
<a id="__codelineno-400-16" name="__codelineno-400-16"></a><span class="c1">// 实现接口方法</span>
<a id="__codelineno-400-17" name="__codelineno-400-17"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-18" name="__codelineno-400-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span>
<a id="__codelineno-400-19" name="__codelineno-400-19"></a><span class="p">}</span>
<a id="__codelineno-400-20" name="__codelineno-400-20"></a>
<a id="__codelineno-400-21" name="__codelineno-400-21"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">)</span><span class="w"> </span><span class="nx">Perimeter</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-22" name="__codelineno-400-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span><span class="p">)</span>
<a id="__codelineno-400-23" name="__codelineno-400-23"></a><span class="p">}</span>
<a id="__codelineno-400-24" name="__codelineno-400-24"></a>
<a id="__codelineno-400-25" name="__codelineno-400-25"></a><span class="c1">// 定义另一个结构体</span>
<a id="__codelineno-400-26" name="__codelineno-400-26"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Circle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-27" name="__codelineno-400-27"></a><span class="w">    </span><span class="nx">Radius</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-400-28" name="__codelineno-400-28"></a><span class="p">}</span>
<a id="__codelineno-400-29" name="__codelineno-400-29"></a>
<a id="__codelineno-400-30" name="__codelineno-400-30"></a><span class="c1">// 实现接口方法</span>
<a id="__codelineno-400-31" name="__codelineno-400-31"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="nx">Area</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-32" name="__codelineno-400-32"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">3.14159</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span>
<a id="__codelineno-400-33" name="__codelineno-400-33"></a><span class="p">}</span>
<a id="__codelineno-400-34" name="__codelineno-400-34"></a>
<a id="__codelineno-400-35" name="__codelineno-400-35"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="nx">Circle</span><span class="p">)</span><span class="w"> </span><span class="nx">Perimeter</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-36" name="__codelineno-400-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3.14159</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Radius</span>
<a id="__codelineno-400-37" name="__codelineno-400-37"></a><span class="p">}</span>
<a id="__codelineno-400-38" name="__codelineno-400-38"></a>
<a id="__codelineno-400-39" name="__codelineno-400-39"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-400-40" name="__codelineno-400-40"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="nx">Shape</span>
<a id="__codelineno-400-41" name="__codelineno-400-41"></a>
<a id="__codelineno-400-42" name="__codelineno-400-42"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-400-43" name="__codelineno-400-43"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Rectangle Area: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Area</span><span class="p">())</span><span class="w">         </span><span class="c1">// 输出: Rectangle Area: 50.00</span>
<a id="__codelineno-400-44" name="__codelineno-400-44"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Rectangle Perimeter: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Perimeter</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出: Rectangle Perimeter: 30.00</span>
<a id="__codelineno-400-45" name="__codelineno-400-45"></a>
<a id="__codelineno-400-46" name="__codelineno-400-46"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Circle</span><span class="p">{</span><span class="nx">Radius</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">}</span>
<a id="__codelineno-400-47" name="__codelineno-400-47"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Circle Area: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Area</span><span class="p">())</span><span class="w">            </span><span class="c1">// 输出: Circle Area: 153.94</span>
<a id="__codelineno-400-48" name="__codelineno-400-48"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Circle Perimeter: %.2f\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Perimeter</span><span class="p">())</span><span class="w">  </span><span class="c1">// 输出: Circle Perimeter: 43.98</span>
<a id="__codelineno-400-49" name="__codelineno-400-49"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-401-1">1</a></span>
<span class="normal"><a href="#__codelineno-401-2">2</a></span>
<span class="normal"><a href="#__codelineno-401-3">3</a></span>
<span class="normal"><a href="#__codelineno-401-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-401-1" name="__codelineno-401-1"></a>Rectangle Area: 50.00
<a id="__codelineno-401-2" name="__codelineno-401-2"></a>Rectangle Perimeter: 30.00
<a id="__codelineno-401-3" name="__codelineno-401-3"></a>Circle Area: 153.94
<a id="__codelineno-401-4" name="__codelineno-401-4"></a>Circle Perimeter: 43.98
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Rectangle</code>和<code>Circle</code>结构体分别实现了<code>Shape</code>接口的所有方法。</li>
<li>通过接口变量<code>s</code>，可以统一调用不同类型的<code>Shape</code>的<code>Area</code>和<code>Perimeter</code>方法，实现多态性。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li>一个类型实现了接口中的所有方法，就自动满足该接口，无需显式声明。</li>
<li>接口可以嵌套其他接口，增强接口的功能。</li>
</ul>
<h4 id="空接口与类型断言">空接口与类型断言<a class="headerlink" href="#空接口与类型断言" title="Permanent link">&para;</a></h4>
<p><strong>空接口（Empty Interface）：</strong></p>
<p>空接口<code>interface{}</code>不包含任何方法签名，所有类型都满足空接口。它通常用于需要处理任意类型的数据。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-402-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-402-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-402-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-402-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-402-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-402-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-402-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-402-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-402-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-402-10">10</a></span>
<span class="normal"><a href="#__codelineno-402-11">11</a></span>
<span class="normal"><a href="#__codelineno-402-12">12</a></span>
<span class="normal"><a href="#__codelineno-402-13">13</a></span>
<span class="normal"><a href="#__codelineno-402-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-402-1" name="__codelineno-402-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-402-2" name="__codelineno-402-2"></a>
<a id="__codelineno-402-3" name="__codelineno-402-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-402-4" name="__codelineno-402-4"></a>
<a id="__codelineno-402-5" name="__codelineno-402-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">printAnything</span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-402-6" name="__codelineno-402-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<a id="__codelineno-402-7" name="__codelineno-402-7"></a><span class="p">}</span>
<a id="__codelineno-402-8" name="__codelineno-402-8"></a>
<a id="__codelineno-402-9" name="__codelineno-402-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-402-10" name="__codelineno-402-10"></a><span class="w">    </span><span class="nx">printAnything</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-402-11" name="__codelineno-402-11"></a><span class="w">    </span><span class="nx">printAnything</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-402-12" name="__codelineno-402-12"></a><span class="w">    </span><span class="nx">printAnything</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<a id="__codelineno-402-13" name="__codelineno-402-13"></a><span class="w">    </span><span class="nx">printAnything</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span>
<a id="__codelineno-402-14" name="__codelineno-402-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-403-1">1</a></span>
<span class="normal"><a href="#__codelineno-403-2">2</a></span>
<span class="normal"><a href="#__codelineno-403-3">3</a></span>
<span class="normal"><a href="#__codelineno-403-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-403-1" name="__codelineno-403-1"></a>100
<a id="__codelineno-403-2" name="__codelineno-403-2"></a>Hello, World!
<a id="__codelineno-403-3" name="__codelineno-403-3"></a>true
<a id="__codelineno-403-4" name="__codelineno-403-4"></a>3.14
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>printAnything</code>函数接受一个空接口类型的参数，可以接收任何类型的值。</li>
</ul>
<p><strong>类型断言（Type Assertion）：</strong></p>
<p>类型断言用于将接口类型转换为具体类型。它可以检查接口值是否持有特定的类型，并安全地转换。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-404-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-404-1" name="__codelineno-404-1"></a><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">interfaceValue</span><span class="p">.(</span><span class="nx">ConcreteType</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>value</code>：转换后的具体类型值。</li>
<li><code>ok</code>：布尔值，表示转换是否成功。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-405-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-405-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-405-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-405-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-405-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-405-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-405-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-405-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-405-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-405-10">10</a></span>
<span class="normal"><a href="#__codelineno-405-11">11</a></span>
<span class="normal"><a href="#__codelineno-405-12">12</a></span>
<span class="normal"><a href="#__codelineno-405-13">13</a></span>
<span class="normal"><a href="#__codelineno-405-14">14</a></span>
<span class="normal"><a href="#__codelineno-405-15">15</a></span>
<span class="normal"><a href="#__codelineno-405-16">16</a></span>
<span class="normal"><a href="#__codelineno-405-17">17</a></span>
<span class="normal"><a href="#__codelineno-405-18">18</a></span>
<span class="normal"><a href="#__codelineno-405-19">19</a></span>
<span class="normal"><a href="#__codelineno-405-20">20</a></span>
<span class="normal"><a href="#__codelineno-405-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-405-1" name="__codelineno-405-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-405-2" name="__codelineno-405-2"></a>
<a id="__codelineno-405-3" name="__codelineno-405-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-405-4" name="__codelineno-405-4"></a>
<a id="__codelineno-405-5" name="__codelineno-405-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-405-6" name="__codelineno-405-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Go Language&quot;</span>
<a id="__codelineno-405-7" name="__codelineno-405-7"></a>
<a id="__codelineno-405-8" name="__codelineno-405-8"></a><span class="w">    </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
<a id="__codelineno-405-9" name="__codelineno-405-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-405-10" name="__codelineno-405-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;字符串长度:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span><span class="w"> </span><span class="c1">// 输出: 字符串长度: 12</span>
<a id="__codelineno-405-11" name="__codelineno-405-11"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-405-12" name="__codelineno-405-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;不是字符串类型&quot;</span><span class="p">)</span>
<a id="__codelineno-405-13" name="__codelineno-405-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-405-14" name="__codelineno-405-14"></a>
<a id="__codelineno-405-15" name="__codelineno-405-15"></a><span class="w">    </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-405-16" name="__codelineno-405-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-405-17" name="__codelineno-405-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;整数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">)</span>
<a id="__codelineno-405-18" name="__codelineno-405-18"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-405-19" name="__codelineno-405-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;不是整数类型&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 不是整数类型</span>
<a id="__codelineno-405-20" name="__codelineno-405-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-405-21" name="__codelineno-405-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-406-1">1</a></span>
<span class="normal"><a href="#__codelineno-406-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-406-1" name="__codelineno-406-1"></a>字符串长度: 12
<a id="__codelineno-406-2" name="__codelineno-406-2"></a>不是整数类型
</code></pre></div></td></tr></table></div>
<p><strong>类型切换（Type Switch）：</strong></p>
<p>类型切换用于根据接口值的实际类型执行不同的代码块。它是一种更简洁和安全的方式来处理多种类型。</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-407-1">1</a></span>
<span class="normal"><a href="#__codelineno-407-2">2</a></span>
<span class="normal"><a href="#__codelineno-407-3">3</a></span>
<span class="normal"><a href="#__codelineno-407-4">4</a></span>
<span class="normal"><a href="#__codelineno-407-5">5</a></span>
<span class="normal"><a href="#__codelineno-407-6">6</a></span>
<span class="normal"><a href="#__codelineno-407-7">7</a></span>
<span class="normal"><a href="#__codelineno-407-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-407-1" name="__codelineno-407-1"></a><span class="k">switch</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">interfaceValue</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-407-2" name="__codelineno-407-2"></a><span class="k">case</span><span class="w"> </span><span class="nx">Type1</span><span class="p">:</span>
<a id="__codelineno-407-3" name="__codelineno-407-3"></a><span class="w">    </span><span class="c1">// 处理Type1</span>
<a id="__codelineno-407-4" name="__codelineno-407-4"></a><span class="k">case</span><span class="w"> </span><span class="nx">Type2</span><span class="p">:</span>
<a id="__codelineno-407-5" name="__codelineno-407-5"></a><span class="w">    </span><span class="c1">// 处理Type2</span>
<a id="__codelineno-407-6" name="__codelineno-407-6"></a><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-407-7" name="__codelineno-407-7"></a><span class="w">    </span><span class="c1">// 处理其他类型</span>
<a id="__codelineno-407-8" name="__codelineno-407-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-408-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-408-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-408-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-408-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-408-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-408-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-408-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-408-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-408-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-408-10">10</a></span>
<span class="normal"><a href="#__codelineno-408-11">11</a></span>
<span class="normal"><a href="#__codelineno-408-12">12</a></span>
<span class="normal"><a href="#__codelineno-408-13">13</a></span>
<span class="normal"><a href="#__codelineno-408-14">14</a></span>
<span class="normal"><a href="#__codelineno-408-15">15</a></span>
<span class="normal"><a href="#__codelineno-408-16">16</a></span>
<span class="normal"><a href="#__codelineno-408-17">17</a></span>
<span class="normal"><a href="#__codelineno-408-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-408-1" name="__codelineno-408-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-408-2" name="__codelineno-408-2"></a>
<a id="__codelineno-408-3" name="__codelineno-408-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-408-4" name="__codelineno-408-4"></a>
<a id="__codelineno-408-5" name="__codelineno-408-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-408-6" name="__codelineno-408-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">3.14</span>
<a id="__codelineno-408-7" name="__codelineno-408-7"></a>
<a id="__codelineno-408-8" name="__codelineno-408-8"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-408-9" name="__codelineno-408-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">int</span><span class="p">:</span>
<a id="__codelineno-408-10" name="__codelineno-408-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;整数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-408-11" name="__codelineno-408-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">float64</span><span class="p">:</span>
<a id="__codelineno-408-12" name="__codelineno-408-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;浮点数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-408-13" name="__codelineno-408-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="kt">string</span><span class="p">:</span>
<a id="__codelineno-408-14" name="__codelineno-408-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;字符串:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<a id="__codelineno-408-15" name="__codelineno-408-15"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-408-16" name="__codelineno-408-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;未知类型&quot;</span><span class="p">)</span>
<a id="__codelineno-408-17" name="__codelineno-408-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-408-18" name="__codelineno-408-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-409-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-409-1" name="__codelineno-409-1"></a>浮点数: 3.14
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>type</code>关键字用于检测接口值的实际类型，并在不同的<code>case</code>中执行相应的代码块。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>安全性</strong>：类型断言和类型切换可以防止运行时错误，确保类型转换的安全性。</li>
<li><strong>性能</strong>：频繁的类型断言可能会影响性能，应在必要时使用。</li>
</ul>
<h3 id="84-组合与继承">8.4 组合与继承<a class="headerlink" href="#84-组合与继承" title="Permanent link">&para;</a></h3>
<p>Go语言不支持传统的类继承，但通过结构体嵌套和组合，可以实现代码复用和类型扩展的功能。此外，通过接口，可以实现多态性，使得不同类型能够以统一的方式被处理。</p>
<h4 id="结构体嵌套">结构体嵌套<a class="headerlink" href="#结构体嵌套" title="Permanent link">&para;</a></h4>
<p>结构体嵌套（Struct Embedding）是Go语言中实现组合的方式之一。通过将一个结构体嵌入到另一个结构体中，可以复用嵌入结构体的字段和方法。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-410-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-410-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-410-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-410-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-410-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-410-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-410-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-410-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-410-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-410-10">10</a></span>
<span class="normal"><a href="#__codelineno-410-11">11</a></span>
<span class="normal"><a href="#__codelineno-410-12">12</a></span>
<span class="normal"><a href="#__codelineno-410-13">13</a></span>
<span class="normal"><a href="#__codelineno-410-14">14</a></span>
<span class="normal"><a href="#__codelineno-410-15">15</a></span>
<span class="normal"><a href="#__codelineno-410-16">16</a></span>
<span class="normal"><a href="#__codelineno-410-17">17</a></span>
<span class="normal"><a href="#__codelineno-410-18">18</a></span>
<span class="normal"><a href="#__codelineno-410-19">19</a></span>
<span class="normal"><a href="#__codelineno-410-20">20</a></span>
<span class="normal"><a href="#__codelineno-410-21">21</a></span>
<span class="normal"><a href="#__codelineno-410-22">22</a></span>
<span class="normal"><a href="#__codelineno-410-23">23</a></span>
<span class="normal"><a href="#__codelineno-410-24">24</a></span>
<span class="normal"><a href="#__codelineno-410-25">25</a></span>
<span class="normal"><a href="#__codelineno-410-26">26</a></span>
<span class="normal"><a href="#__codelineno-410-27">27</a></span>
<span class="normal"><a href="#__codelineno-410-28">28</a></span>
<span class="normal"><a href="#__codelineno-410-29">29</a></span>
<span class="normal"><a href="#__codelineno-410-30">30</a></span>
<span class="normal"><a href="#__codelineno-410-31">31</a></span>
<span class="normal"><a href="#__codelineno-410-32">32</a></span>
<span class="normal"><a href="#__codelineno-410-33">33</a></span>
<span class="normal"><a href="#__codelineno-410-34">34</a></span>
<span class="normal"><a href="#__codelineno-410-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-410-1" name="__codelineno-410-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-410-2" name="__codelineno-410-2"></a>
<a id="__codelineno-410-3" name="__codelineno-410-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-410-4" name="__codelineno-410-4"></a>
<a id="__codelineno-410-5" name="__codelineno-410-5"></a><span class="c1">// 定义基础结构体</span>
<a id="__codelineno-410-6" name="__codelineno-410-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Address</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-410-7" name="__codelineno-410-7"></a><span class="w">    </span><span class="nx">City</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-410-8" name="__codelineno-410-8"></a><span class="w">    </span><span class="nx">ZipCode</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-410-9" name="__codelineno-410-9"></a><span class="p">}</span>
<a id="__codelineno-410-10" name="__codelineno-410-10"></a>
<a id="__codelineno-410-11" name="__codelineno-410-11"></a><span class="c1">// 定义Person结构体，嵌套Address</span>
<a id="__codelineno-410-12" name="__codelineno-410-12"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-410-13" name="__codelineno-410-13"></a><span class="w">    </span><span class="nx">Name</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-410-14" name="__codelineno-410-14"></a><span class="w">    </span><span class="nx">Age</span><span class="w">     </span><span class="kt">int</span>
<a id="__codelineno-410-15" name="__codelineno-410-15"></a><span class="w">    </span><span class="nx">Address</span><span class="w"> </span><span class="c1">// 嵌入结构体，实现组合</span>
<a id="__codelineno-410-16" name="__codelineno-410-16"></a><span class="p">}</span>
<a id="__codelineno-410-17" name="__codelineno-410-17"></a>
<a id="__codelineno-410-18" name="__codelineno-410-18"></a><span class="c1">// 定义方法</span>
<a id="__codelineno-410-19" name="__codelineno-410-19"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="nx">Person</span><span class="p">)</span><span class="w"> </span><span class="nx">Greet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-410-20" name="__codelineno-410-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hello, my name is %s. I am %d years old.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Age</span><span class="p">)</span>
<a id="__codelineno-410-21" name="__codelineno-410-21"></a><span class="p">}</span>
<a id="__codelineno-410-22" name="__codelineno-410-22"></a>
<a id="__codelineno-410-23" name="__codelineno-410-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-410-24" name="__codelineno-410-24"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span>
<a id="__codelineno-410-25" name="__codelineno-410-25"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Eve&quot;</span><span class="p">,</span>
<a id="__codelineno-410-26" name="__codelineno-410-26"></a><span class="w">        </span><span class="nx">Age</span><span class="p">:</span><span class="w">  </span><span class="mi">28</span><span class="p">,</span>
<a id="__codelineno-410-27" name="__codelineno-410-27"></a><span class="w">        </span><span class="nx">Address</span><span class="p">:</span><span class="w"> </span><span class="nx">Address</span><span class="p">{</span>
<a id="__codelineno-410-28" name="__codelineno-410-28"></a><span class="w">            </span><span class="nx">City</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;New York&quot;</span><span class="p">,</span>
<a id="__codelineno-410-29" name="__codelineno-410-29"></a><span class="w">            </span><span class="nx">ZipCode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10001&quot;</span><span class="p">,</span>
<a id="__codelineno-410-30" name="__codelineno-410-30"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-410-31" name="__codelineno-410-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-410-32" name="__codelineno-410-32"></a>
<a id="__codelineno-410-33" name="__codelineno-410-33"></a><span class="w">    </span><span class="nx">p</span><span class="p">.</span><span class="nx">Greet</span><span class="p">()</span><span class="w"> </span><span class="c1">// 输出: Hello, my name is Eve. I am 28 years old.</span>
<a id="__codelineno-410-34" name="__codelineno-410-34"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;City:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">City</span><span class="p">)</span><span class="w"> </span><span class="c1">// 直接访问嵌套结构体的字段，输出: City: New York</span>
<a id="__codelineno-410-35" name="__codelineno-410-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-411-1">1</a></span>
<span class="normal"><a href="#__codelineno-411-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-411-1" name="__codelineno-411-1"></a>Hello, my name is Eve. I am 28 years old.
<a id="__codelineno-411-2" name="__codelineno-411-2"></a>City: New York
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Person</code>结构体嵌套了<code>Address</code>结构体，<code>Person</code>可以直接访问<code>Address</code>的字段和方法。</li>
<li>通过嵌套结构体，实现了字段和方法的复用，类似于继承。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>命名冲突</strong>：如果嵌套结构体中有与外层结构体同名的字段或方法，会导致命名冲突。Go语言会优先选择外层结构体的字段或方法。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-412-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-412-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-412-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-412-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-412-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-412-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-412-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-412-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-412-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-412-10">10</a></span>
<span class="normal"><a href="#__codelineno-412-11">11</a></span>
<span class="normal"><a href="#__codelineno-412-12">12</a></span>
<span class="normal"><a href="#__codelineno-412-13">13</a></span>
<span class="normal"><a href="#__codelineno-412-14">14</a></span>
<span class="normal"><a href="#__codelineno-412-15">15</a></span>
<span class="normal"><a href="#__codelineno-412-16">16</a></span>
<span class="normal"><a href="#__codelineno-412-17">17</a></span>
<span class="normal"><a href="#__codelineno-412-18">18</a></span>
<span class="normal"><a href="#__codelineno-412-19">19</a></span>
<span class="normal"><a href="#__codelineno-412-20">20</a></span>
<span class="normal"><a href="#__codelineno-412-21">21</a></span>
<span class="normal"><a href="#__codelineno-412-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-412-1" name="__codelineno-412-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-412-2" name="__codelineno-412-2"></a>
<a id="__codelineno-412-3" name="__codelineno-412-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-412-4" name="__codelineno-412-4"></a>
<a id="__codelineno-412-5" name="__codelineno-412-5"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Animal</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-412-6" name="__codelineno-412-6"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-412-7" name="__codelineno-412-7"></a><span class="p">}</span>
<a id="__codelineno-412-8" name="__codelineno-412-8"></a>
<a id="__codelineno-412-9" name="__codelineno-412-9"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-412-10" name="__codelineno-412-10"></a><span class="w">    </span><span class="nx">Animal</span>
<a id="__codelineno-412-11" name="__codelineno-412-11"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="c1">// 与嵌套的Animal结构体中的Name字段冲突</span>
<a id="__codelineno-412-12" name="__codelineno-412-12"></a><span class="p">}</span>
<a id="__codelineno-412-13" name="__codelineno-412-13"></a>
<a id="__codelineno-412-14" name="__codelineno-412-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-412-15" name="__codelineno-412-15"></a><span class="w">    </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Dog</span><span class="p">{</span>
<a id="__codelineno-412-16" name="__codelineno-412-16"></a><span class="w">        </span><span class="nx">Animal</span><span class="p">:</span><span class="w"> </span><span class="nx">Animal</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Generic Animal&quot;</span><span class="p">},</span>
<a id="__codelineno-412-17" name="__codelineno-412-17"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;Buddy&quot;</span><span class="p">,</span>
<a id="__codelineno-412-18" name="__codelineno-412-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-412-19" name="__codelineno-412-19"></a>
<a id="__codelineno-412-20" name="__codelineno-412-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Dog&#39;s Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span><span class="w">         </span><span class="c1">// 输出: Buddy</span>
<a id="__codelineno-412-21" name="__codelineno-412-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Animal&#39;s Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Animal</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: Generic Animal</span>
<a id="__codelineno-412-22" name="__codelineno-412-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-413-1">1</a></span>
<span class="normal"><a href="#__codelineno-413-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-413-1" name="__codelineno-413-1"></a>Dog&#39;s Name: Buddy
<a id="__codelineno-413-2" name="__codelineno-413-2"></a>Animal&#39;s Name: Generic Animal
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>方法继承</strong>：嵌套结构体的方法也会被外层结构体继承，可以直接调用。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-414-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-414-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-414-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-414-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-414-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-414-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-414-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-414-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-414-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-414-10">10</a></span>
<span class="normal"><a href="#__codelineno-414-11">11</a></span>
<span class="normal"><a href="#__codelineno-414-12">12</a></span>
<span class="normal"><a href="#__codelineno-414-13">13</a></span>
<span class="normal"><a href="#__codelineno-414-14">14</a></span>
<span class="normal"><a href="#__codelineno-414-15">15</a></span>
<span class="normal"><a href="#__codelineno-414-16">16</a></span>
<span class="normal"><a href="#__codelineno-414-17">17</a></span>
<span class="normal"><a href="#__codelineno-414-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-414-1" name="__codelineno-414-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-414-2" name="__codelineno-414-2"></a>
<a id="__codelineno-414-3" name="__codelineno-414-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-414-4" name="__codelineno-414-4"></a>
<a id="__codelineno-414-5" name="__codelineno-414-5"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Animal</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<a id="__codelineno-414-6" name="__codelineno-414-6"></a>
<a id="__codelineno-414-7" name="__codelineno-414-7"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="nx">Animal</span><span class="p">)</span><span class="w"> </span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-414-8" name="__codelineno-414-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Animal speaks&quot;</span><span class="p">)</span>
<a id="__codelineno-414-9" name="__codelineno-414-9"></a><span class="p">}</span>
<a id="__codelineno-414-10" name="__codelineno-414-10"></a>
<a id="__codelineno-414-11" name="__codelineno-414-11"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-414-12" name="__codelineno-414-12"></a><span class="w">    </span><span class="nx">Animal</span>
<a id="__codelineno-414-13" name="__codelineno-414-13"></a><span class="p">}</span>
<a id="__codelineno-414-14" name="__codelineno-414-14"></a>
<a id="__codelineno-414-15" name="__codelineno-414-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-414-16" name="__codelineno-414-16"></a><span class="w">    </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Dog</span><span class="p">{}</span>
<a id="__codelineno-414-17" name="__codelineno-414-17"></a><span class="w">    </span><span class="nx">d</span><span class="p">.</span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="c1">// 调用嵌套结构体的方法，输出: Animal speaks</span>
<a id="__codelineno-414-18" name="__codelineno-414-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="多态polymorphism">多态（Polymorphism）<a class="headerlink" href="#多态polymorphism" title="Permanent link">&para;</a></h4>
<p>多态性允许不同类型的对象以统一的接口进行交互。在Go语言中，通过接口实现多态性，使得不同类型的对象能够实现相同的方法集合，从而可以被同一个接口变量引用和调用。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-415-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-415-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-415-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-415-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-415-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-415-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-415-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-415-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-415-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-415-10">10</a></span>
<span class="normal"><a href="#__codelineno-415-11">11</a></span>
<span class="normal"><a href="#__codelineno-415-12">12</a></span>
<span class="normal"><a href="#__codelineno-415-13">13</a></span>
<span class="normal"><a href="#__codelineno-415-14">14</a></span>
<span class="normal"><a href="#__codelineno-415-15">15</a></span>
<span class="normal"><a href="#__codelineno-415-16">16</a></span>
<span class="normal"><a href="#__codelineno-415-17">17</a></span>
<span class="normal"><a href="#__codelineno-415-18">18</a></span>
<span class="normal"><a href="#__codelineno-415-19">19</a></span>
<span class="normal"><a href="#__codelineno-415-20">20</a></span>
<span class="normal"><a href="#__codelineno-415-21">21</a></span>
<span class="normal"><a href="#__codelineno-415-22">22</a></span>
<span class="normal"><a href="#__codelineno-415-23">23</a></span>
<span class="normal"><a href="#__codelineno-415-24">24</a></span>
<span class="normal"><a href="#__codelineno-415-25">25</a></span>
<span class="normal"><a href="#__codelineno-415-26">26</a></span>
<span class="normal"><a href="#__codelineno-415-27">27</a></span>
<span class="normal"><a href="#__codelineno-415-28">28</a></span>
<span class="normal"><a href="#__codelineno-415-29">29</a></span>
<span class="normal"><a href="#__codelineno-415-30">30</a></span>
<span class="normal"><a href="#__codelineno-415-31">31</a></span>
<span class="normal"><a href="#__codelineno-415-32">32</a></span>
<span class="normal"><a href="#__codelineno-415-33">33</a></span>
<span class="normal"><a href="#__codelineno-415-34">34</a></span>
<span class="normal"><a href="#__codelineno-415-35">35</a></span>
<span class="normal"><a href="#__codelineno-415-36">36</a></span>
<span class="normal"><a href="#__codelineno-415-37">37</a></span>
<span class="normal"><a href="#__codelineno-415-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-415-1" name="__codelineno-415-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-415-2" name="__codelineno-415-2"></a>
<a id="__codelineno-415-3" name="__codelineno-415-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-415-4" name="__codelineno-415-4"></a>
<a id="__codelineno-415-5" name="__codelineno-415-5"></a><span class="c1">// 定义接口</span>
<a id="__codelineno-415-6" name="__codelineno-415-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Speaker</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-415-7" name="__codelineno-415-7"></a><span class="w">    </span><span class="nx">Speak</span><span class="p">()</span>
<a id="__codelineno-415-8" name="__codelineno-415-8"></a><span class="p">}</span>
<a id="__codelineno-415-9" name="__codelineno-415-9"></a>
<a id="__codelineno-415-10" name="__codelineno-415-10"></a><span class="c1">// 定义结构体1</span>
<a id="__codelineno-415-11" name="__codelineno-415-11"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Human</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-415-12" name="__codelineno-415-12"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-415-13" name="__codelineno-415-13"></a><span class="p">}</span>
<a id="__codelineno-415-14" name="__codelineno-415-14"></a>
<a id="__codelineno-415-15" name="__codelineno-415-15"></a><span class="c1">// 实现接口方法</span>
<a id="__codelineno-415-16" name="__codelineno-415-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="nx">Human</span><span class="p">)</span><span class="w"> </span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-415-17" name="__codelineno-415-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Hi, I am %s.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-415-18" name="__codelineno-415-18"></a><span class="p">}</span>
<a id="__codelineno-415-19" name="__codelineno-415-19"></a>
<a id="__codelineno-415-20" name="__codelineno-415-20"></a><span class="c1">// 定义结构体2</span>
<a id="__codelineno-415-21" name="__codelineno-415-21"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-415-22" name="__codelineno-415-22"></a><span class="w">    </span><span class="nx">Breed</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-415-23" name="__codelineno-415-23"></a><span class="p">}</span>
<a id="__codelineno-415-24" name="__codelineno-415-24"></a>
<a id="__codelineno-415-25" name="__codelineno-415-25"></a><span class="c1">// 实现接口方法</span>
<a id="__codelineno-415-26" name="__codelineno-415-26"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">d</span><span class="w"> </span><span class="nx">Dog</span><span class="p">)</span><span class="w"> </span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-415-27" name="__codelineno-415-27"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Woof! I am a %s.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">Breed</span><span class="p">)</span>
<a id="__codelineno-415-28" name="__codelineno-415-28"></a><span class="p">}</span>
<a id="__codelineno-415-29" name="__codelineno-415-29"></a>
<a id="__codelineno-415-30" name="__codelineno-415-30"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-415-31" name="__codelineno-415-31"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="nx">Speaker</span>
<a id="__codelineno-415-32" name="__codelineno-415-32"></a>
<a id="__codelineno-415-33" name="__codelineno-415-33"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Human</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">}</span>
<a id="__codelineno-415-34" name="__codelineno-415-34"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="c1">// 输出: Hi, I am Alice.</span>
<a id="__codelineno-415-35" name="__codelineno-415-35"></a>
<a id="__codelineno-415-36" name="__codelineno-415-36"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Dog</span><span class="p">{</span><span class="nx">Breed</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Golden Retriever&quot;</span><span class="p">}</span>
<a id="__codelineno-415-37" name="__codelineno-415-37"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">Speak</span><span class="p">()</span><span class="w"> </span><span class="c1">// 输出: Woof! I am a Golden Retriever.</span>
<a id="__codelineno-415-38" name="__codelineno-415-38"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-416-1">1</a></span>
<span class="normal"><a href="#__codelineno-416-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-416-1" name="__codelineno-416-1"></a>Hi, I am Alice.
<a id="__codelineno-416-2" name="__codelineno-416-2"></a>Woof! I am a Golden Retriever.
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Speaker</code>接口定义了一个<code>Speak</code>方法。</li>
<li><code>Human</code>和<code>Dog</code>结构体分别实现了<code>Speak</code>方法。</li>
<li>通过接口变量<code>s</code>，可以引用不同类型的对象，实现多态性。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>接口的实现是隐式的</strong>：只要类型实现了接口中的所有方法，就自动满足该接口，无需显式声明。</li>
<li><strong>接口变量的动态类型</strong>：接口变量在运行时可以持有不同类型的值，实现灵活的多态性。</li>
</ul>
<h3 id="85-指针与结构体">8.5 指针与结构体<a class="headerlink" href="#85-指针与结构体" title="Permanent link">&para;</a></h3>
<p>指针是存储变量内存地址的变量。在Go语言中，指针与结构体结合使用，可以提高程序的性能，避免大量数据的复制，同时实现对结构体的修改和共享。通过指针，可以有效地管理内存和数据，特别是在处理大型结构体或需要频繁修改数据时尤为重要。</p>
<h4 id="指针基础_1">指针基础<a class="headerlink" href="#指针基础_1" title="Permanent link">&para;</a></h4>
<p><strong>1. 声明指针</strong></p>
<p>使用<code>*</code>符号声明指针类型。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-417-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-417-1" name="__codelineno-417-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>p</code>是一个指向<code>int</code>类型的指针，初始值为<code>nil</code>。</li>
</ul>
<p><strong>2. 获取变量的地址</strong></p>
<p>使用<code>&amp;</code>符号获取变量的内存地址。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-418-1">1</a></span>
<span class="normal"><a href="#__codelineno-418-2">2</a></span>
<span class="normal"><a href="#__codelineno-418-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-418-1" name="__codelineno-418-1"></a><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-418-2" name="__codelineno-418-2"></a><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span>
<a id="__codelineno-418-3" name="__codelineno-418-3"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a的地址:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: a的地址: 0xc0000140b0</span>
</code></pre></div></td></tr></table></div>
<p><strong>3. 解引用指针</strong></p>
<p>使用<code>*</code>符号访问指针指向的值。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-419-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-419-1" name="__codelineno-419-1"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;p指向的值:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: p指向的值: 10</span>
</code></pre></div></td></tr></table></div>
<p><strong>4. 修改指针指向的值</strong></p>
<p>通过指针修改变量的值。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-420-1">1</a></span>
<span class="normal"><a href="#__codelineno-420-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-420-1" name="__codelineno-420-1"></a><span class="o">*</span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-420-2" name="__codelineno-420-2"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的a:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 修改后的a: 20</span>
</code></pre></div></td></tr></table></div>
<p><strong>完整示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-421-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-421-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-421-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-421-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-421-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-421-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-421-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-421-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-421-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-421-10">10</a></span>
<span class="normal"><a href="#__codelineno-421-11">11</a></span>
<span class="normal"><a href="#__codelineno-421-12">12</a></span>
<span class="normal"><a href="#__codelineno-421-13">13</a></span>
<span class="normal"><a href="#__codelineno-421-14">14</a></span>
<span class="normal"><a href="#__codelineno-421-15">15</a></span>
<span class="normal"><a href="#__codelineno-421-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-421-1" name="__codelineno-421-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-421-2" name="__codelineno-421-2"></a>
<a id="__codelineno-421-3" name="__codelineno-421-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-421-4" name="__codelineno-421-4"></a>
<a id="__codelineno-421-5" name="__codelineno-421-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-421-6" name="__codelineno-421-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-421-7" name="__codelineno-421-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span>
<a id="__codelineno-421-8" name="__codelineno-421-8"></a>
<a id="__codelineno-421-9" name="__codelineno-421-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;变量a的值:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w">         </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-421-10" name="__codelineno-421-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;指针p的地址:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w">       </span><span class="c1">// 输出: a的地址</span>
<a id="__codelineno-421-11" name="__codelineno-421-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;指针p指向的值:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w">     </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-421-12" name="__codelineno-421-12"></a>
<a id="__codelineno-421-13" name="__codelineno-421-13"></a><span class="w">    </span><span class="c1">// 修改指针指向的值</span>
<a id="__codelineno-421-14" name="__codelineno-421-14"></a><span class="w">    </span><span class="o">*</span><span class="nx">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-421-15" name="__codelineno-421-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的a:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w">         </span><span class="c1">// 输出: 30</span>
<a id="__codelineno-421-16" name="__codelineno-421-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-422-1">1</a></span>
<span class="normal"><a href="#__codelineno-422-2">2</a></span>
<span class="normal"><a href="#__codelineno-422-3">3</a></span>
<span class="normal"><a href="#__codelineno-422-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-422-1" name="__codelineno-422-1"></a>变量a的值: 10
<a id="__codelineno-422-2" name="__codelineno-422-2"></a>指针p的地址: 0xc0000140b0
<a id="__codelineno-422-3" name="__codelineno-422-3"></a>指针p指向的值: 10
<a id="__codelineno-422-4" name="__codelineno-422-4"></a>修改后的a: 30
</code></pre></div></td></tr></table></div>
<h4 id="指针与结构体_1">指针与结构体<a class="headerlink" href="#指针与结构体_1" title="Permanent link">&para;</a></h4>
<p>将指针与结构体结合使用，可以避免复制整个结构体，尤其是当结构体较大时，提高程序的性能。此外，通过指针，可以在函数中修改结构体的字段。</p>
<p><strong>1. 定义结构体并使用指针</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-423-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-423-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-423-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-423-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-423-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-423-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-423-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-423-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-423-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-423-10">10</a></span>
<span class="normal"><a href="#__codelineno-423-11">11</a></span>
<span class="normal"><a href="#__codelineno-423-12">12</a></span>
<span class="normal"><a href="#__codelineno-423-13">13</a></span>
<span class="normal"><a href="#__codelineno-423-14">14</a></span>
<span class="normal"><a href="#__codelineno-423-15">15</a></span>
<span class="normal"><a href="#__codelineno-423-16">16</a></span>
<span class="normal"><a href="#__codelineno-423-17">17</a></span>
<span class="normal"><a href="#__codelineno-423-18">18</a></span>
<span class="normal"><a href="#__codelineno-423-19">19</a></span>
<span class="normal"><a href="#__codelineno-423-20">20</a></span>
<span class="normal"><a href="#__codelineno-423-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-423-1" name="__codelineno-423-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-423-2" name="__codelineno-423-2"></a>
<a id="__codelineno-423-3" name="__codelineno-423-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-423-4" name="__codelineno-423-4"></a>
<a id="__codelineno-423-5" name="__codelineno-423-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-423-6" name="__codelineno-423-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Person</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-423-7" name="__codelineno-423-7"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-423-8" name="__codelineno-423-8"></a><span class="w">    </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<a id="__codelineno-423-9" name="__codelineno-423-9"></a><span class="p">}</span>
<a id="__codelineno-423-10" name="__codelineno-423-10"></a>
<a id="__codelineno-423-11" name="__codelineno-423-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-423-12" name="__codelineno-423-12"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Person</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">}</span>
<a id="__codelineno-423-13" name="__codelineno-423-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原始结构体:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {Alice 25}</span>
<a id="__codelineno-423-14" name="__codelineno-423-14"></a>
<a id="__codelineno-423-15" name="__codelineno-423-15"></a><span class="w">    </span><span class="c1">// 获取结构体的指针</span>
<a id="__codelineno-423-16" name="__codelineno-423-16"></a><span class="w">    </span><span class="nx">ptr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">p</span>
<a id="__codelineno-423-17" name="__codelineno-423-17"></a>
<a id="__codelineno-423-18" name="__codelineno-423-18"></a><span class="w">    </span><span class="c1">// 修改指针指向的结构体字段</span>
<a id="__codelineno-423-19" name="__codelineno-423-19"></a><span class="w">    </span><span class="nx">ptr</span><span class="p">.</span><span class="nx">Age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">26</span>
<a id="__codelineno-423-20" name="__codelineno-423-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的结构体:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {Alice 26}</span>
<a id="__codelineno-423-21" name="__codelineno-423-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-424-1">1</a></span>
<span class="normal"><a href="#__codelineno-424-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-424-1" name="__codelineno-424-1"></a>原始结构体: {Alice 25}
<a id="__codelineno-424-2" name="__codelineno-424-2"></a>修改后的结构体: {Alice 26}
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>ptr</code>是指向<code>Person</code>结构体<code>p</code>的指针。</li>
<li>通过指针<code>ptr</code>修改<code>Age</code>字段，直接影响原始结构体<code>p</code>。</li>
</ul>
<p><strong>2. 结构体指针作为函数参数</strong></p>
<p>通过将结构体指针作为函数参数，可以在函数中修改结构体的字段，而无需返回修改后的结构体。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-425-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-425-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-425-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-425-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-425-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-425-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-425-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-425-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-425-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-425-10">10</a></span>
<span class="normal"><a href="#__codelineno-425-11">11</a></span>
<span class="normal"><a href="#__codelineno-425-12">12</a></span>
<span class="normal"><a href="#__codelineno-425-13">13</a></span>
<span class="normal"><a href="#__codelineno-425-14">14</a></span>
<span class="normal"><a href="#__codelineno-425-15">15</a></span>
<span class="normal"><a href="#__codelineno-425-16">16</a></span>
<span class="normal"><a href="#__codelineno-425-17">17</a></span>
<span class="normal"><a href="#__codelineno-425-18">18</a></span>
<span class="normal"><a href="#__codelineno-425-19">19</a></span>
<span class="normal"><a href="#__codelineno-425-20">20</a></span>
<span class="normal"><a href="#__codelineno-425-21">21</a></span>
<span class="normal"><a href="#__codelineno-425-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-425-1" name="__codelineno-425-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-425-2" name="__codelineno-425-2"></a>
<a id="__codelineno-425-3" name="__codelineno-425-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-425-4" name="__codelineno-425-4"></a>
<a id="__codelineno-425-5" name="__codelineno-425-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-425-6" name="__codelineno-425-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-425-7" name="__codelineno-425-7"></a><span class="w">    </span><span class="nx">Width</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="w"> </span><span class="kt">float64</span>
<a id="__codelineno-425-8" name="__codelineno-425-8"></a><span class="p">}</span>
<a id="__codelineno-425-9" name="__codelineno-425-9"></a>
<a id="__codelineno-425-10" name="__codelineno-425-10"></a><span class="c1">// 定义函数，接受结构体指针并修改字段</span>
<a id="__codelineno-425-11" name="__codelineno-425-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Resize</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Rectangle</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-425-12" name="__codelineno-425-12"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">width</span>
<a id="__codelineno-425-13" name="__codelineno-425-13"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">height</span>
<a id="__codelineno-425-14" name="__codelineno-425-14"></a><span class="p">}</span>
<a id="__codelineno-425-15" name="__codelineno-425-15"></a>
<a id="__codelineno-425-16" name="__codelineno-425-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-425-17" name="__codelineno-425-17"></a><span class="w">    </span><span class="nx">rect</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Rectangle</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nx">Height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<a id="__codelineno-425-18" name="__codelineno-425-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原始矩形:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {10 5}</span>
<a id="__codelineno-425-19" name="__codelineno-425-19"></a>
<a id="__codelineno-425-20" name="__codelineno-425-20"></a><span class="w">    </span><span class="nx">Resize</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">rect</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-425-21" name="__codelineno-425-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的矩形:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rect</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: {20 10}</span>
<a id="__codelineno-425-22" name="__codelineno-425-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-426-1">1</a></span>
<span class="normal"><a href="#__codelineno-426-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-426-1" name="__codelineno-426-1"></a>原始矩形: {10 5}
<a id="__codelineno-426-2" name="__codelineno-426-2"></a>修改后的矩形: {20 10}
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Resize</code>函数接受<code>Rectangle</code>结构体的指针，通过指针修改结构体的<code>Width</code>和<code>Height</code>字段。</li>
</ul>
<p><strong>3. 指针接收者方法</strong></p>
<p>前面章节中提到方法接收者可以是指针类型，这样可以在方法中修改结构体的字段。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-427-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-427-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-427-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-427-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-427-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-427-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-427-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-427-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-427-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-427-10">10</a></span>
<span class="normal"><a href="#__codelineno-427-11">11</a></span>
<span class="normal"><a href="#__codelineno-427-12">12</a></span>
<span class="normal"><a href="#__codelineno-427-13">13</a></span>
<span class="normal"><a href="#__codelineno-427-14">14</a></span>
<span class="normal"><a href="#__codelineno-427-15">15</a></span>
<span class="normal"><a href="#__codelineno-427-16">16</a></span>
<span class="normal"><a href="#__codelineno-427-17">17</a></span>
<span class="normal"><a href="#__codelineno-427-18">18</a></span>
<span class="normal"><a href="#__codelineno-427-19">19</a></span>
<span class="normal"><a href="#__codelineno-427-20">20</a></span>
<span class="normal"><a href="#__codelineno-427-21">21</a></span>
<span class="normal"><a href="#__codelineno-427-22">22</a></span>
<span class="normal"><a href="#__codelineno-427-23">23</a></span>
<span class="normal"><a href="#__codelineno-427-24">24</a></span>
<span class="normal"><a href="#__codelineno-427-25">25</a></span>
<span class="normal"><a href="#__codelineno-427-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-427-1" name="__codelineno-427-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-427-2" name="__codelineno-427-2"></a>
<a id="__codelineno-427-3" name="__codelineno-427-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-427-4" name="__codelineno-427-4"></a>
<a id="__codelineno-427-5" name="__codelineno-427-5"></a><span class="c1">// 定义结构体</span>
<a id="__codelineno-427-6" name="__codelineno-427-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Counter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-427-7" name="__codelineno-427-7"></a><span class="w">    </span><span class="nx">count</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-427-8" name="__codelineno-427-8"></a><span class="p">}</span>
<a id="__codelineno-427-9" name="__codelineno-427-9"></a>
<a id="__codelineno-427-10" name="__codelineno-427-10"></a><span class="c1">// 定义指针接收者方法</span>
<a id="__codelineno-427-11" name="__codelineno-427-11"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Counter</span><span class="p">)</span><span class="w"> </span><span class="nx">Increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-427-12" name="__codelineno-427-12"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span>
<a id="__codelineno-427-13" name="__codelineno-427-13"></a><span class="p">}</span>
<a id="__codelineno-427-14" name="__codelineno-427-14"></a>
<a id="__codelineno-427-15" name="__codelineno-427-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-427-16" name="__codelineno-427-16"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Counter</span><span class="p">{</span><span class="nx">count</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
<a id="__codelineno-427-17" name="__codelineno-427-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;初始计数:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 0</span>
<a id="__codelineno-427-18" name="__codelineno-427-18"></a>
<a id="__codelineno-427-19" name="__codelineno-427-19"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Increment</span><span class="p">()</span>
<a id="__codelineno-427-20" name="__codelineno-427-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计数 after Increment:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 1</span>
<a id="__codelineno-427-21" name="__codelineno-427-21"></a>
<a id="__codelineno-427-22" name="__codelineno-427-22"></a><span class="w">    </span><span class="c1">// 使用指针变量</span>
<a id="__codelineno-427-23" name="__codelineno-427-23"></a><span class="w">    </span><span class="nx">cp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">c</span>
<a id="__codelineno-427-24" name="__codelineno-427-24"></a><span class="w">    </span><span class="nx">cp</span><span class="p">.</span><span class="nx">Increment</span><span class="p">()</span>
<a id="__codelineno-427-25" name="__codelineno-427-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;计数 after cp.Increment:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 2</span>
<a id="__codelineno-427-26" name="__codelineno-427-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-428-1">1</a></span>
<span class="normal"><a href="#__codelineno-428-2">2</a></span>
<span class="normal"><a href="#__codelineno-428-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-428-1" name="__codelineno-428-1"></a>初始计数: 0
<a id="__codelineno-428-2" name="__codelineno-428-2"></a>计数 after Increment: 1
<a id="__codelineno-428-3" name="__codelineno-428-3"></a>计数 after cp.Increment: 2
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Increment</code>方法使用指针接收者，可以直接修改<code>Counter</code>结构体的<code>count</code>字段。</li>
</ul>
<h4 id="指针的高级用法_1">指针的高级用法<a class="headerlink" href="#指针的高级用法_1" title="Permanent link">&para;</a></h4>
<p><strong>1. 指针与切片</strong></p>
<p>切片本身是引用类型，包含指向底层数组的指针。通过指针，可以修改切片的元素，或在函数中传递切片指针以实现更灵活的操作。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-429-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-429-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-429-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-429-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-429-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-429-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-429-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-429-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-429-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-429-10">10</a></span>
<span class="normal"><a href="#__codelineno-429-11">11</a></span>
<span class="normal"><a href="#__codelineno-429-12">12</a></span>
<span class="normal"><a href="#__codelineno-429-13">13</a></span>
<span class="normal"><a href="#__codelineno-429-14">14</a></span>
<span class="normal"><a href="#__codelineno-429-15">15</a></span>
<span class="normal"><a href="#__codelineno-429-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-429-1" name="__codelineno-429-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-429-2" name="__codelineno-429-2"></a>
<a id="__codelineno-429-3" name="__codelineno-429-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-429-4" name="__codelineno-429-4"></a>
<a id="__codelineno-429-5" name="__codelineno-429-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">modifySlice</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="p">[]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-429-6" name="__codelineno-429-6"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="nx">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span>
<a id="__codelineno-429-7" name="__codelineno-429-7"></a><span class="w">    </span><span class="o">*</span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="o">*</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span>
<a id="__codelineno-429-8" name="__codelineno-429-8"></a><span class="p">}</span>
<a id="__codelineno-429-9" name="__codelineno-429-9"></a>
<a id="__codelineno-429-10" name="__codelineno-429-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-429-11" name="__codelineno-429-11"></a><span class="w">    </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-429-12" name="__codelineno-429-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;原始切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [1 2 3]</span>
<a id="__codelineno-429-13" name="__codelineno-429-13"></a>
<a id="__codelineno-429-14" name="__codelineno-429-14"></a><span class="w">    </span><span class="nx">modifySlice</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-429-15" name="__codelineno-429-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的切片:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: [100 2 3 200]</span>
<a id="__codelineno-429-16" name="__codelineno-429-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-430-1">1</a></span>
<span class="normal"><a href="#__codelineno-430-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-430-1" name="__codelineno-430-1"></a>原始切片: [1 2 3]
<a id="__codelineno-430-2" name="__codelineno-430-2"></a>修改后的切片: [100 2 3 200]
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>modifySlice</code>函数接受切片的指针，通过指针修改切片的第一个元素，并添加新的元素。</li>
</ul>
<p><strong>2. 指针与Map</strong></p>
<p>Map是引用类型，通常不需要使用指针传递Map，因为Map本身就是引用的。但在某些情况下，可以使用指针传递Map，以便在函数中重新分配或替换整个Map。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-431-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-431-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-431-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-431-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-431-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-431-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-431-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-431-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-431-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-431-10">10</a></span>
<span class="normal"><a href="#__codelineno-431-11">11</a></span>
<span class="normal"><a href="#__codelineno-431-12">12</a></span>
<span class="normal"><a href="#__codelineno-431-13">13</a></span>
<span class="normal"><a href="#__codelineno-431-14">14</a></span>
<span class="normal"><a href="#__codelineno-431-15">15</a></span>
<span class="normal"><a href="#__codelineno-431-16">16</a></span>
<span class="normal"><a href="#__codelineno-431-17">17</a></span>
<span class="normal"><a href="#__codelineno-431-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-431-1" name="__codelineno-431-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-431-2" name="__codelineno-431-2"></a>
<a id="__codelineno-431-3" name="__codelineno-431-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-431-4" name="__codelineno-431-4"></a>
<a id="__codelineno-431-5" name="__codelineno-431-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">modifyMap</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="o">*</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-431-6" name="__codelineno-431-6"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="nx">m</span><span class="p">)[</span><span class="s">&quot;Germany&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Berlin&quot;</span>
<a id="__codelineno-431-7" name="__codelineno-431-7"></a><span class="p">}</span>
<a id="__codelineno-431-8" name="__codelineno-431-8"></a>
<a id="__codelineno-431-9" name="__codelineno-431-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-431-10" name="__codelineno-431-10"></a><span class="w">    </span><span class="nx">capitals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-431-11" name="__codelineno-431-11"></a><span class="w">        </span><span class="s">&quot;China&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Beijing&quot;</span><span class="p">,</span>
<a id="__codelineno-431-12" name="__codelineno-431-12"></a><span class="w">        </span><span class="s">&quot;USA&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Washington&quot;</span><span class="p">,</span>
<a id="__codelineno-431-13" name="__codelineno-431-13"></a><span class="w">        </span><span class="s">&quot;Japan&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Tokyo&quot;</span><span class="p">,</span>
<a id="__codelineno-431-14" name="__codelineno-431-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-431-15" name="__codelineno-431-15"></a>
<a id="__codelineno-431-16" name="__codelineno-431-16"></a><span class="w">    </span><span class="nx">modifyMap</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">capitals</span><span class="p">)</span>
<a id="__codelineno-431-17" name="__codelineno-431-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的Map:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capitals</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: map[China:Beijing Germany:Berlin Japan:Tokyo USA:Washington]</span>
<a id="__codelineno-431-18" name="__codelineno-431-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-432-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-432-1" name="__codelineno-432-1"></a>修改后的Map: map[China:Beijing Germany:Berlin Japan:Tokyo USA:Washington]
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>modifyMap</code>函数接受Map的指针，通过指针添加新的键值对到Map中。</li>
</ul>
<p><strong>3. 指针数组</strong></p>
<p>数组中可以存储指针类型的元素，适用于需要引用和共享数据的场景。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-433-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-433-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-433-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-433-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-433-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-433-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-433-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-433-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-433-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-433-10">10</a></span>
<span class="normal"><a href="#__codelineno-433-11">11</a></span>
<span class="normal"><a href="#__codelineno-433-12">12</a></span>
<span class="normal"><a href="#__codelineno-433-13">13</a></span>
<span class="normal"><a href="#__codelineno-433-14">14</a></span>
<span class="normal"><a href="#__codelineno-433-15">15</a></span>
<span class="normal"><a href="#__codelineno-433-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-433-1" name="__codelineno-433-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-433-2" name="__codelineno-433-2"></a>
<a id="__codelineno-433-3" name="__codelineno-433-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-433-4" name="__codelineno-433-4"></a>
<a id="__codelineno-433-5" name="__codelineno-433-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-433-6" name="__codelineno-433-6"></a><span class="w">    </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-433-7" name="__codelineno-433-7"></a><span class="w">    </span><span class="nx">ptrArr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="kt">int</span><span class="p">{</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">c</span><span class="p">}</span>
<a id="__codelineno-433-8" name="__codelineno-433-8"></a>
<a id="__codelineno-433-9" name="__codelineno-433-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">ptr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">ptrArr</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-433-10" name="__codelineno-433-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ptrArr[%d] 指向的值: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">ptr</span><span class="p">)</span>
<a id="__codelineno-433-11" name="__codelineno-433-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-433-12" name="__codelineno-433-12"></a>
<a id="__codelineno-433-13" name="__codelineno-433-13"></a><span class="w">    </span><span class="c1">// 修改通过指针数组修改原始变量</span>
<a id="__codelineno-433-14" name="__codelineno-433-14"></a><span class="w">    </span><span class="o">*</span><span class="nx">ptrArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-433-15" name="__codelineno-433-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的a:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 10</span>
<a id="__codelineno-433-16" name="__codelineno-433-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-434-1">1</a></span>
<span class="normal"><a href="#__codelineno-434-2">2</a></span>
<span class="normal"><a href="#__codelineno-434-3">3</a></span>
<span class="normal"><a href="#__codelineno-434-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-434-1" name="__codelineno-434-1"></a>ptrArr[0] 指向的值: 1
<a id="__codelineno-434-2" name="__codelineno-434-2"></a>ptrArr[1] 指向的值: 2
<a id="__codelineno-434-3" name="__codelineno-434-3"></a>ptrArr[2] 指向的值: 3
<a id="__codelineno-434-4" name="__codelineno-434-4"></a>修改后的a: 10
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>ptrArr</code>是一个存储指向<code>int</code>类型的指针数组。</li>
<li>通过指针数组，可以修改原始变量<code>a</code>的值。</li>
</ul>
<h4 id="注意事项_13">注意事项<a class="headerlink" href="#注意事项_13" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>指针的零值</strong>：未初始化的指针为<code>nil</code>。在使用指针前，确保其已被正确初始化，避免运行时错误。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-435-1">1</a></span>
<span class="normal"><a href="#__codelineno-435-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-435-1" name="__codelineno-435-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span>
<a id="__codelineno-435-2" name="__codelineno-435-2"></a><span class="c1">// fmt.Println(*p) // 运行时错误: invalid memory address or nil pointer dereference</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>避免悬挂指针</strong>：确保指针指向的变量在指针使用期间保持有效，避免指针指向已经释放或超出作用域的变量。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-436-1">1</a></span>
<span class="normal"><a href="#__codelineno-436-2">2</a></span>
<span class="normal"><a href="#__codelineno-436-3">3</a></span>
<span class="normal"><a href="#__codelineno-436-4">4</a></span>
<span class="normal"><a href="#__codelineno-436-5">5</a></span>
<span class="normal"><a href="#__codelineno-436-6">6</a></span>
<span class="normal"><a href="#__codelineno-436-7">7</a></span>
<span class="normal"><a href="#__codelineno-436-8">8</a></span>
<span class="normal"><a href="#__codelineno-436-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-436-1" name="__codelineno-436-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">getPointer</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-436-2" name="__codelineno-436-2"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-436-3" name="__codelineno-436-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">x</span>
<a id="__codelineno-436-4" name="__codelineno-436-4"></a><span class="p">}</span>
<a id="__codelineno-436-5" name="__codelineno-436-5"></a>
<a id="__codelineno-436-6" name="__codelineno-436-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-436-7" name="__codelineno-436-7"></a><span class="w">    </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getPointer</span><span class="p">()</span>
<a id="__codelineno-436-8" name="__codelineno-436-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不安全：x 已经超出作用域，可能导致未定义行为</span>
<a id="__codelineno-436-9" name="__codelineno-436-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解决方案：</strong> 使用堆分配（通过<code>new</code>函数或返回结构体实例）确保变量在函数外仍然有效。</p>
<ul>
<li><strong>使用指针优化性能</strong>：对于大型结构体，使用指针传递可以避免复制整个结构体，提高性能。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-437-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-437-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-437-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-437-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-437-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-437-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-437-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-437-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-437-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-437-10">10</a></span>
<span class="normal"><a href="#__codelineno-437-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-437-1" name="__codelineno-437-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">LargeStruct</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-437-2" name="__codelineno-437-2"></a><span class="w">    </span><span class="nx">Data</span><span class="w"> </span><span class="p">[</span><span class="mi">1000</span><span class="p">]</span><span class="kt">int</span>
<a id="__codelineno-437-3" name="__codelineno-437-3"></a><span class="p">}</span>
<a id="__codelineno-437-4" name="__codelineno-437-4"></a>
<a id="__codelineno-437-5" name="__codelineno-437-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">ls</span><span class="w"> </span><span class="nx">LargeStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 复制整个结构体</span>
<a id="__codelineno-437-6" name="__codelineno-437-6"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-437-7" name="__codelineno-437-7"></a><span class="p">}</span>
<a id="__codelineno-437-8" name="__codelineno-437-8"></a>
<a id="__codelineno-437-9" name="__codelineno-437-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">processPointer</span><span class="p">(</span><span class="nx">ls</span><span class="w"> </span><span class="o">*</span><span class="nx">LargeStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 传递指针</span>
<a id="__codelineno-437-10" name="__codelineno-437-10"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-437-11" name="__codelineno-437-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>nil指针检查</strong>：在使用指针前，最好检查指针是否为<code>nil</code>，以避免运行时错误。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-438-1">1</a></span>
<span class="normal"><a href="#__codelineno-438-2">2</a></span>
<span class="normal"><a href="#__codelineno-438-3">3</a></span>
<span class="normal"><a href="#__codelineno-438-4">4</a></span>
<span class="normal"><a href="#__codelineno-438-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-438-1" name="__codelineno-438-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-438-2" name="__codelineno-438-2"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">p</span><span class="p">)</span>
<a id="__codelineno-438-3" name="__codelineno-438-3"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-438-4" name="__codelineno-438-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;指针为nil&quot;</span><span class="p">)</span>
<a id="__codelineno-438-5" name="__codelineno-438-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="9-并发编程">9. 并发编程<a class="headerlink" href="#9-并发编程" title="Permanent link">&para;</a></h2>
<p>并发编程是现代软件开发中不可或缺的部分，特别是在处理高性能、高响应性的应用程序时。Go语言以其内置的并发机制著称，提供了简洁而强大的工具来编写并发程序。本章将深入探讨Go语言中的并发编程特性，包括Goroutine、通道（Channel）、<code>sync</code>包以及<code>context</code>包。通过详细的示例和解释，帮助你理解并掌握Go语言的并发编程模型，从而编写高效、可靠的并发应用程序。</p>
<h3 id="91-什么是-goroutine">9.1 什么是 Goroutine<a class="headerlink" href="#91-什么是-goroutine" title="Permanent link">&para;</a></h3>
<p>Goroutine是Go语言中的轻量级线程，由Go运行时管理。与操作系统线程相比，Goroutine消耗的内存更少，启动和销毁的开销也更低，使得在一个程序中同时运行数百万个Goroutine成为可能。</p>
<h4 id="启动-goroutine">启动 Goroutine<a class="headerlink" href="#启动-goroutine" title="Permanent link">&para;</a></h4>
<p>要启动一个Goroutine，只需在函数调用前加上<code>go</code>关键字。被<code>go</code>关键字调用的函数将以并发方式执行，与调用它的函数同时运行。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-439-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-439-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-439-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-439-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-439-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-439-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-439-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-439-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-439-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-439-10">10</a></span>
<span class="normal"><a href="#__codelineno-439-11">11</a></span>
<span class="normal"><a href="#__codelineno-439-12">12</a></span>
<span class="normal"><a href="#__codelineno-439-13">13</a></span>
<span class="normal"><a href="#__codelineno-439-14">14</a></span>
<span class="normal"><a href="#__codelineno-439-15">15</a></span>
<span class="normal"><a href="#__codelineno-439-16">16</a></span>
<span class="normal"><a href="#__codelineno-439-17">17</a></span>
<span class="normal"><a href="#__codelineno-439-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-439-1" name="__codelineno-439-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-439-2" name="__codelineno-439-2"></a>
<a id="__codelineno-439-3" name="__codelineno-439-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-439-4" name="__codelineno-439-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-439-5" name="__codelineno-439-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-439-6" name="__codelineno-439-6"></a><span class="p">)</span>
<a id="__codelineno-439-7" name="__codelineno-439-7"></a>
<a id="__codelineno-439-8" name="__codelineno-439-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">say</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-439-9" name="__codelineno-439-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-439-10" name="__codelineno-439-10"></a><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<a id="__codelineno-439-11" name="__codelineno-439-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<a id="__codelineno-439-12" name="__codelineno-439-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-439-13" name="__codelineno-439-13"></a><span class="p">}</span>
<a id="__codelineno-439-14" name="__codelineno-439-14"></a>
<a id="__codelineno-439-15" name="__codelineno-439-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-439-16" name="__codelineno-439-16"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">say</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 启动一个Goroutine</span>
<a id="__codelineno-439-17" name="__codelineno-439-17"></a><span class="w">    </span><span class="nx">say</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1">// 在主Goroutine中运行</span>
<a id="__codelineno-439-18" name="__codelineno-439-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-440-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-440-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-440-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-440-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-440-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-440-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-440-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-440-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-440-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-440-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-440-1" name="__codelineno-440-1"></a>hello
<a id="__codelineno-440-2" name="__codelineno-440-2"></a>world
<a id="__codelineno-440-3" name="__codelineno-440-3"></a>hello
<a id="__codelineno-440-4" name="__codelineno-440-4"></a>world
<a id="__codelineno-440-5" name="__codelineno-440-5"></a>hello
<a id="__codelineno-440-6" name="__codelineno-440-6"></a>world
<a id="__codelineno-440-7" name="__codelineno-440-7"></a>hello
<a id="__codelineno-440-8" name="__codelineno-440-8"></a>world
<a id="__codelineno-440-9" name="__codelineno-440-9"></a>hello
<a id="__codelineno-440-10" name="__codelineno-440-10"></a>world
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>主函数<code>main</code>启动了一个Goroutine来执行<code>say("world")</code>。</li>
<li>同时，主Goroutine继续执行<code>say("hello")</code>。</li>
<li>两个Goroutine交替输出"hello"和"world"。</li>
</ul>
<h4 id="goroutine-的调度">Goroutine 的调度<a class="headerlink" href="#goroutine-的调度" title="Permanent link">&para;</a></h4>
<p>Go运行时内置的调度器负责管理Goroutine的执行。调度器将多个Goroutine映射到有限数量的操作系统线程上，采用M:N调度模型（M个Goroutine映射到N个OS线程）。调度器会根据Goroutine的状态（运行、就绪、阻塞）动态分配资源，以实现高效的并发执行。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-441-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-441-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-441-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-441-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-441-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-441-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-441-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-441-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-441-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-441-10">10</a></span>
<span class="normal"><a href="#__codelineno-441-11">11</a></span>
<span class="normal"><a href="#__codelineno-441-12">12</a></span>
<span class="normal"><a href="#__codelineno-441-13">13</a></span>
<span class="normal"><a href="#__codelineno-441-14">14</a></span>
<span class="normal"><a href="#__codelineno-441-15">15</a></span>
<span class="normal"><a href="#__codelineno-441-16">16</a></span>
<span class="normal"><a href="#__codelineno-441-17">17</a></span>
<span class="normal"><a href="#__codelineno-441-18">18</a></span>
<span class="normal"><a href="#__codelineno-441-19">19</a></span>
<span class="normal"><a href="#__codelineno-441-20">20</a></span>
<span class="normal"><a href="#__codelineno-441-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-441-1" name="__codelineno-441-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-441-2" name="__codelineno-441-2"></a>
<a id="__codelineno-441-3" name="__codelineno-441-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-441-4" name="__codelineno-441-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-441-5" name="__codelineno-441-5"></a><span class="w">    </span><span class="s">&quot;runtime&quot;</span>
<a id="__codelineno-441-6" name="__codelineno-441-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-441-7" name="__codelineno-441-7"></a><span class="p">)</span>
<a id="__codelineno-441-8" name="__codelineno-441-8"></a>
<a id="__codelineno-441-9" name="__codelineno-441-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">count</span><span class="p">(</span><span class="nx">thing</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-441-10" name="__codelineno-441-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-441-11" name="__codelineno-441-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">thing</span><span class="p">)</span>
<a id="__codelineno-441-12" name="__codelineno-441-12"></a><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-441-13" name="__codelineno-441-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-441-14" name="__codelineno-441-14"></a><span class="p">}</span>
<a id="__codelineno-441-15" name="__codelineno-441-15"></a>
<a id="__codelineno-441-16" name="__codelineno-441-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-441-17" name="__codelineno-441-17"></a><span class="w">    </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">GOMAXPROCS</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// 设置可同时运行的OS线程数量为2</span>
<a id="__codelineno-441-18" name="__codelineno-441-18"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">count</span><span class="p">(</span><span class="s">&quot;sheep&quot;</span><span class="p">)</span>
<a id="__codelineno-441-19" name="__codelineno-441-19"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">count</span><span class="p">(</span><span class="s">&quot;fish&quot;</span><span class="p">)</span>
<a id="__codelineno-441-20" name="__codelineno-441-20"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 等待Goroutine完成</span>
<a id="__codelineno-441-21" name="__codelineno-441-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-442-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-442-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-442-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-442-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-442-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-442-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-442-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-442-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-442-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-442-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-442-1" name="__codelineno-442-1"></a>1 sheep
<a id="__codelineno-442-2" name="__codelineno-442-2"></a>1 fish
<a id="__codelineno-442-3" name="__codelineno-442-3"></a>2 sheep
<a id="__codelineno-442-4" name="__codelineno-442-4"></a>2 fish
<a id="__codelineno-442-5" name="__codelineno-442-5"></a>3 sheep
<a id="__codelineno-442-6" name="__codelineno-442-6"></a>3 fish
<a id="__codelineno-442-7" name="__codelineno-442-7"></a>4 sheep
<a id="__codelineno-442-8" name="__codelineno-442-8"></a>4 fish
<a id="__codelineno-442-9" name="__codelineno-442-9"></a>5 sheep
<a id="__codelineno-442-10" name="__codelineno-442-10"></a>5 fish
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>runtime.GOMAXPROCS(2)</code>设置程序可以同时使用的CPU核心数为2。</li>
<li>启动了两个Goroutine，分别执行<code>count("sheep")</code>和<code>count("fish")</code>。</li>
<li>调度器在两个Goroutine之间交替执行，输出交错的"sheep"和"fish"。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>GOMAXPROCS</strong>：默认情况下，Go程序会使用所有可用的CPU核心。可以通过<code>runtime.GOMAXPROCS</code>函数调整，但一般不需要手动设置。</li>
<li><strong>Goroutine泄漏</strong>：确保所有启动的Goroutine都有明确的退出条件，否则可能导致内存泄漏和资源浪费。</li>
<li><strong>同步问题</strong>：多个Goroutine访问共享资源时，需要使用同步机制（如通道、互斥锁）来避免竞态条件。</li>
</ul>
<h3 id="92-通道-channel">9.2 通道 (Channel)<a class="headerlink" href="#92-通道-channel" title="Permanent link">&para;</a></h3>
<p>通道（Channel）是Go语言中用于在Goroutine之间传递数据的管道。通道确保数据的有序、安全传输，并支持同步通信，使得并发编程更加简单和高效。</p>
<h4 id="通道的定义与使用">通道的定义与使用<a class="headerlink" href="#通道的定义与使用" title="Permanent link">&para;</a></h4>
<p><strong>定义通道</strong></p>
<p>使用<code>make</code>函数创建通道，指定通道中元素的类型。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-443-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-443-1" name="__codelineno-443-1"></a><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="c1">// 创建一个传递整数的通道</span>
</code></pre></div></td></tr></table></div>
<p><strong>发送和接收数据</strong></p>
<p>通过<code>&lt;-</code>操作符在通道上发送和接收数据。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-444-1">1</a></span>
<span class="normal"><a href="#__codelineno-444-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-444-1" name="__codelineno-444-1"></a><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">42</span><span class="w">    </span><span class="c1">// 发送数据到通道</span>
<a id="__codelineno-444-2" name="__codelineno-444-2"></a><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span><span class="w"> </span><span class="c1">// 从通道接收数据</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-445-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-445-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-445-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-445-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-445-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-445-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-445-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-445-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-445-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-445-10">10</a></span>
<span class="normal"><a href="#__codelineno-445-11">11</a></span>
<span class="normal"><a href="#__codelineno-445-12">12</a></span>
<span class="normal"><a href="#__codelineno-445-13">13</a></span>
<span class="normal"><a href="#__codelineno-445-14">14</a></span>
<span class="normal"><a href="#__codelineno-445-15">15</a></span>
<span class="normal"><a href="#__codelineno-445-16">16</a></span>
<span class="normal"><a href="#__codelineno-445-17">17</a></span>
<span class="normal"><a href="#__codelineno-445-18">18</a></span>
<span class="normal"><a href="#__codelineno-445-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-445-1" name="__codelineno-445-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-445-2" name="__codelineno-445-2"></a>
<a id="__codelineno-445-3" name="__codelineno-445-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-445-4" name="__codelineno-445-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-445-5" name="__codelineno-445-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-445-6" name="__codelineno-445-6"></a><span class="p">)</span>
<a id="__codelineno-445-7" name="__codelineno-445-7"></a>
<a id="__codelineno-445-8" name="__codelineno-445-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">worker</span><span class="p">(</span><span class="nx">ch</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-445-9" name="__codelineno-445-9"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-445-10" name="__codelineno-445-10"></a><span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;工作完成&quot;</span>
<a id="__codelineno-445-11" name="__codelineno-445-11"></a><span class="p">}</span>
<a id="__codelineno-445-12" name="__codelineno-445-12"></a>
<a id="__codelineno-445-13" name="__codelineno-445-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-445-14" name="__codelineno-445-14"></a><span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<a id="__codelineno-445-15" name="__codelineno-445-15"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">worker</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span>
<a id="__codelineno-445-16" name="__codelineno-445-16"></a>
<a id="__codelineno-445-17" name="__codelineno-445-17"></a><span class="w">    </span><span class="nx">msg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span>
<a id="__codelineno-445-18" name="__codelineno-445-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 工作完成</span>
<a id="__codelineno-445-19" name="__codelineno-445-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-446-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-446-1" name="__codelineno-446-1"></a>工作完成
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>主Goroutine创建了一个字符串类型的通道<code>ch</code>。</li>
<li>启动一个Goroutine执行<code>worker</code>函数，该函数等待1秒后向通道发送消息。</li>
<li>主Goroutine从通道接收消息并打印。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>阻塞行为</strong>：发送和接收操作默认是阻塞的，直到另一端准备好进行相应的操作。这确保了Goroutine之间的同步。</li>
<li><strong>通道方向</strong>：可以定义双向通道或单向通道，以提高类型安全性和代码清晰度。</li>
</ul>
<h4 id="缓冲通道与无缓冲通道">缓冲通道与无缓冲通道<a class="headerlink" href="#缓冲通道与无缓冲通道" title="Permanent link">&para;</a></h4>
<p>通道可以是缓冲的或无缓冲的。无缓冲通道在发送和接收时是同步的，发送操作会等待接收操作完成；缓冲通道允许发送在缓冲区未满时不阻塞。</p>
<p><strong>无缓冲通道</strong></p>
<p>创建无缓冲通道，默认行为是同步发送和接收。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-447-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-447-1" name="__codelineno-447-1"></a><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>缓冲通道</strong></p>
<p>创建缓冲通道，指定缓冲区的大小。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-448-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-448-1" name="__codelineno-448-1"></a><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="c1">// 缓冲区大小为3</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-449-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-449-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-449-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-449-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-449-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-449-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-449-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-449-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-449-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-449-10">10</a></span>
<span class="normal"><a href="#__codelineno-449-11">11</a></span>
<span class="normal"><a href="#__codelineno-449-12">12</a></span>
<span class="normal"><a href="#__codelineno-449-13">13</a></span>
<span class="normal"><a href="#__codelineno-449-14">14</a></span>
<span class="normal"><a href="#__codelineno-449-15">15</a></span>
<span class="normal"><a href="#__codelineno-449-16">16</a></span>
<span class="normal"><a href="#__codelineno-449-17">17</a></span>
<span class="normal"><a href="#__codelineno-449-18">18</a></span>
<span class="normal"><a href="#__codelineno-449-19">19</a></span>
<span class="normal"><a href="#__codelineno-449-20">20</a></span>
<span class="normal"><a href="#__codelineno-449-21">21</a></span>
<span class="normal"><a href="#__codelineno-449-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-449-1" name="__codelineno-449-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-449-2" name="__codelineno-449-2"></a>
<a id="__codelineno-449-3" name="__codelineno-449-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-449-4" name="__codelineno-449-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-449-5" name="__codelineno-449-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-449-6" name="__codelineno-449-6"></a><span class="p">)</span>
<a id="__codelineno-449-7" name="__codelineno-449-7"></a>
<a id="__codelineno-449-8" name="__codelineno-449-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-449-9" name="__codelineno-449-9"></a><span class="w">    </span><span class="c1">// 无缓冲通道</span>
<a id="__codelineno-449-10" name="__codelineno-449-10"></a><span class="w">    </span><span class="nx">unbuffered</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<a id="__codelineno-449-11" name="__codelineno-449-11"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-449-12" name="__codelineno-449-12"></a><span class="w">        </span><span class="nx">unbuffered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;无缓冲通道消息&quot;</span>
<a id="__codelineno-449-13" name="__codelineno-449-13"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-449-14" name="__codelineno-449-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">unbuffered</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 无缓冲通道消息</span>
<a id="__codelineno-449-15" name="__codelineno-449-15"></a>
<a id="__codelineno-449-16" name="__codelineno-449-16"></a><span class="w">    </span><span class="c1">// 缓冲通道</span>
<a id="__codelineno-449-17" name="__codelineno-449-17"></a><span class="w">    </span><span class="nx">buffered</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-449-18" name="__codelineno-449-18"></a><span class="w">    </span><span class="nx">buffered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-449-19" name="__codelineno-449-19"></a><span class="w">    </span><span class="nx">buffered</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-449-20" name="__codelineno-449-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 1</span>
<a id="__codelineno-449-21" name="__codelineno-449-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">buffered</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 2</span>
<a id="__codelineno-449-22" name="__codelineno-449-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-450-1">1</a></span>
<span class="normal"><a href="#__codelineno-450-2">2</a></span>
<span class="normal"><a href="#__codelineno-450-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-450-1" name="__codelineno-450-1"></a>无缓冲通道消息
<a id="__codelineno-450-2" name="__codelineno-450-2"></a>1
<a id="__codelineno-450-3" name="__codelineno-450-3"></a>2
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>无缓冲通道</strong>：发送操作等待接收操作完成，确保消息被及时接收。</li>
<li><strong>缓冲通道</strong>：发送操作在缓冲区未满时不阻塞，可以提前发送多个消息。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>缓冲区大小选择</strong>：根据应用需求选择合适的缓冲区大小，避免过度缓冲导致内存浪费或不足缓冲导致频繁阻塞。</li>
<li><strong>死锁风险</strong>：不恰当的缓冲通道使用可能导致死锁，尤其是在发送和接收操作不匹配时。</li>
</ul>
<h4 id="单向通道">单向通道<a class="headerlink" href="#单向通道" title="Permanent link">&para;</a></h4>
<p>单向通道指定通道只能用于发送或接收，增强类型安全性。</p>
<p><strong>定义单向通道</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-451-1">1</a></span>
<span class="normal"><a href="#__codelineno-451-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-451-1" name="__codelineno-451-1"></a><span class="nx">sendOnly</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="o">&lt;-</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="c1">// 只能发送</span>
<a id="__codelineno-451-2" name="__codelineno-451-2"></a><span class="nx">receiveOnly</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="o">&lt;-</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="c1">// 只能接收</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-452-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-452-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-452-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-452-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-452-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-452-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-452-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-452-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-452-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-452-10">10</a></span>
<span class="normal"><a href="#__codelineno-452-11">11</a></span>
<span class="normal"><a href="#__codelineno-452-12">12</a></span>
<span class="normal"><a href="#__codelineno-452-13">13</a></span>
<span class="normal"><a href="#__codelineno-452-14">14</a></span>
<span class="normal"><a href="#__codelineno-452-15">15</a></span>
<span class="normal"><a href="#__codelineno-452-16">16</a></span>
<span class="normal"><a href="#__codelineno-452-17">17</a></span>
<span class="normal"><a href="#__codelineno-452-18">18</a></span>
<span class="normal"><a href="#__codelineno-452-19">19</a></span>
<span class="normal"><a href="#__codelineno-452-20">20</a></span>
<span class="normal"><a href="#__codelineno-452-21">21</a></span>
<span class="normal"><a href="#__codelineno-452-22">22</a></span>
<span class="normal"><a href="#__codelineno-452-23">23</a></span>
<span class="normal"><a href="#__codelineno-452-24">24</a></span>
<span class="normal"><a href="#__codelineno-452-25">25</a></span>
<span class="normal"><a href="#__codelineno-452-26">26</a></span>
<span class="normal"><a href="#__codelineno-452-27">27</a></span>
<span class="normal"><a href="#__codelineno-452-28">28</a></span>
<span class="normal"><a href="#__codelineno-452-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-452-1" name="__codelineno-452-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-452-2" name="__codelineno-452-2"></a>
<a id="__codelineno-452-3" name="__codelineno-452-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-452-4" name="__codelineno-452-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-452-5" name="__codelineno-452-5"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-452-6" name="__codelineno-452-6"></a><span class="p">)</span>
<a id="__codelineno-452-7" name="__codelineno-452-7"></a>
<a id="__codelineno-452-8" name="__codelineno-452-8"></a><span class="c1">// 发送函数，使用发送单向通道</span>
<a id="__codelineno-452-9" name="__codelineno-452-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sendData</span><span class="p">(</span><span class="nx">sendCh</span><span class="w"> </span><span class="kd">chan</span><span class="o">&lt;-</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-452-10" name="__codelineno-452-10"></a><span class="w">    </span><span class="nx">sendCh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;数据发送中&quot;</span>
<a id="__codelineno-452-11" name="__codelineno-452-11"></a><span class="p">}</span>
<a id="__codelineno-452-12" name="__codelineno-452-12"></a>
<a id="__codelineno-452-13" name="__codelineno-452-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-452-14" name="__codelineno-452-14"></a><span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<a id="__codelineno-452-15" name="__codelineno-452-15"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">sendData</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span>
<a id="__codelineno-452-16" name="__codelineno-452-16"></a>
<a id="__codelineno-452-17" name="__codelineno-452-17"></a><span class="w">    </span><span class="nx">msg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ch</span>
<a id="__codelineno-452-18" name="__codelineno-452-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 数据发送中</span>
<a id="__codelineno-452-19" name="__codelineno-452-19"></a>
<a id="__codelineno-452-20" name="__codelineno-452-20"></a><span class="w">    </span><span class="c1">// 单向通道示例</span>
<a id="__codelineno-452-21" name="__codelineno-452-21"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">sendOnly</span><span class="w"> </span><span class="kd">chan</span><span class="o">&lt;-</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-452-22" name="__codelineno-452-22"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">receiveOnly</span><span class="w"> </span><span class="o">&lt;-</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-452-23" name="__codelineno-452-23"></a>
<a id="__codelineno-452-24" name="__codelineno-452-24"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-452-25" name="__codelineno-452-25"></a><span class="w">        </span><span class="nx">sendOnly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">100</span>
<a id="__codelineno-452-26" name="__codelineno-452-26"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-452-27" name="__codelineno-452-27"></a>
<a id="__codelineno-452-28" name="__codelineno-452-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">receiveOnly</span><span class="p">)</span><span class="w"> </span><span class="c1">// 这里会阻塞，因为receiveOnly未发送任何数据</span>
<a id="__codelineno-452-29" name="__codelineno-452-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-453-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-453-1" name="__codelineno-453-1"></a>数据发送中
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>sendData</code>函数只能向通道发送数据，因为通道类型为<code>chan&lt;- string</code>。</li>
<li>主函数中尝试从<code>receiveOnly</code>通道接收数据会阻塞，因为没有Goroutine向该通道发送数据。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>类型转换</strong>：双向通道可以隐式转换为单向通道，但单向通道不能转换为双向通道。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-454-1">1</a></span>
<span class="normal"><a href="#__codelineno-454-2">2</a></span>
<span class="normal"><a href="#__codelineno-454-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-454-1" name="__codelineno-454-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">bidirectional</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-454-2" name="__codelineno-454-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">sendOnly</span><span class="w"> </span><span class="kd">chan</span><span class="o">&lt;-</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">bidirectional</span><span class="w"> </span><span class="c1">// 合法</span>
<a id="__codelineno-454-3" name="__codelineno-454-3"></a><span class="c1">// var bidirectional chan int = sendOnly // 编译错误</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>代码清晰度</strong>：使用单向通道可以明确函数的通信意图，提高代码的可读性和安全性。</li>
</ul>
<h3 id="93-sync-包">9.3 <code>sync</code> 包<a class="headerlink" href="#93-sync-包" title="Permanent link">&para;</a></h3>
<p><code>sync</code>包提供了基本的同步原语，如互斥锁（Mutex）、等待组（WaitGroup）和只执行一次（Once）等，帮助开发者在并发环境中安全地管理共享资源和控制执行流程。</p>
<h4 id="waitgroup">WaitGroup<a class="headerlink" href="#waitgroup" title="Permanent link">&para;</a></h4>
<p><code>WaitGroup</code>用于等待一组Goroutine完成。它通过计数器来跟踪Goroutine的数量，确保所有Goroutine完成后主程序继续执行。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-455-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-455-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-455-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-455-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-455-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-455-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-455-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-455-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-455-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-455-10">10</a></span>
<span class="normal"><a href="#__codelineno-455-11">11</a></span>
<span class="normal"><a href="#__codelineno-455-12">12</a></span>
<span class="normal"><a href="#__codelineno-455-13">13</a></span>
<span class="normal"><a href="#__codelineno-455-14">14</a></span>
<span class="normal"><a href="#__codelineno-455-15">15</a></span>
<span class="normal"><a href="#__codelineno-455-16">16</a></span>
<span class="normal"><a href="#__codelineno-455-17">17</a></span>
<span class="normal"><a href="#__codelineno-455-18">18</a></span>
<span class="normal"><a href="#__codelineno-455-19">19</a></span>
<span class="normal"><a href="#__codelineno-455-20">20</a></span>
<span class="normal"><a href="#__codelineno-455-21">21</a></span>
<span class="normal"><a href="#__codelineno-455-22">22</a></span>
<span class="normal"><a href="#__codelineno-455-23">23</a></span>
<span class="normal"><a href="#__codelineno-455-24">24</a></span>
<span class="normal"><a href="#__codelineno-455-25">25</a></span>
<span class="normal"><a href="#__codelineno-455-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-455-1" name="__codelineno-455-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-455-2" name="__codelineno-455-2"></a>
<a id="__codelineno-455-3" name="__codelineno-455-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-455-4" name="__codelineno-455-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-455-5" name="__codelineno-455-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-455-6" name="__codelineno-455-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-455-7" name="__codelineno-455-7"></a><span class="p">)</span>
<a id="__codelineno-455-8" name="__codelineno-455-8"></a>
<a id="__codelineno-455-9" name="__codelineno-455-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">worker</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-455-10" name="__codelineno-455-10"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span><span class="w"> </span><span class="c1">// 在函数结束时调用Done，减少WaitGroup计数</span>
<a id="__codelineno-455-11" name="__codelineno-455-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Goroutine %d 开始工作\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-455-12" name="__codelineno-455-12"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-455-13" name="__codelineno-455-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Goroutine %d 完成工作\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-455-14" name="__codelineno-455-14"></a><span class="p">}</span>
<a id="__codelineno-455-15" name="__codelineno-455-15"></a>
<a id="__codelineno-455-16" name="__codelineno-455-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-455-17" name="__codelineno-455-17"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-455-18" name="__codelineno-455-18"></a>
<a id="__codelineno-455-19" name="__codelineno-455-19"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-455-20" name="__codelineno-455-20"></a><span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 增加WaitGroup计数</span>
<a id="__codelineno-455-21" name="__codelineno-455-21"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">worker</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">wg</span><span class="p">)</span>
<a id="__codelineno-455-22" name="__codelineno-455-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-455-23" name="__codelineno-455-23"></a>
<a id="__codelineno-455-24" name="__codelineno-455-24"></a><span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span><span class="w"> </span><span class="c1">// 等待所有Goroutine完成</span>
<a id="__codelineno-455-25" name="__codelineno-455-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;所有Goroutine已完成&quot;</span><span class="p">)</span>
<a id="__codelineno-455-26" name="__codelineno-455-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-456-1">1</a></span>
<span class="normal"><a href="#__codelineno-456-2">2</a></span>
<span class="normal"><a href="#__codelineno-456-3">3</a></span>
<span class="normal"><a href="#__codelineno-456-4">4</a></span>
<span class="normal"><a href="#__codelineno-456-5">5</a></span>
<span class="normal"><a href="#__codelineno-456-6">6</a></span>
<span class="normal"><a href="#__codelineno-456-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-456-1" name="__codelineno-456-1"></a>Goroutine 1 开始工作
<a id="__codelineno-456-2" name="__codelineno-456-2"></a>Goroutine 2 开始工作
<a id="__codelineno-456-3" name="__codelineno-456-3"></a>Goroutine 3 开始工作
<a id="__codelineno-456-4" name="__codelineno-456-4"></a>Goroutine 1 完成工作
<a id="__codelineno-456-5" name="__codelineno-456-5"></a>Goroutine 2 完成工作
<a id="__codelineno-456-6" name="__codelineno-456-6"></a>Goroutine 3 完成工作
<a id="__codelineno-456-7" name="__codelineno-456-7"></a>所有Goroutine已完成
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>主函数创建一个<code>WaitGroup</code>实例<code>wg</code>。</li>
<li>启动3个Goroutine，每个Goroutine执行<code>worker</code>函数，并在开始时调用<code>wg.Add(1)</code>增加计数。</li>
<li>每个<code>worker</code>在完成工作后调用<code>wg.Done()</code>减少计数。</li>
<li>主Goroutine调用<code>wg.Wait()</code>阻塞，直到所有Goroutine完成工作。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>Add的调用位置</strong>：应在启动Goroutine之前调用<code>Add</code>，以避免计数器为零时Goroutine启动导致<code>Wait</code>提前结束。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-457-1">1</a></span>
<span class="normal"><a href="#__codelineno-457-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-457-1" name="__codelineno-457-1"></a><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-457-2" name="__codelineno-457-2"></a><span class="k">go</span><span class="w"> </span><span class="nx">worker</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">wg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>确保调用Done</strong>：在Goroutine中使用<code>defer wg.Done()</code>确保即使发生错误，计数器也能正确减少，避免<code>Wait</code>永久阻塞。</li>
</ul>
<h4 id="mutex">Mutex<a class="headerlink" href="#mutex" title="Permanent link">&para;</a></h4>
<p><code>Mutex</code>（互斥锁）用于保护共享资源，防止多个Goroutine同时访问或修改同一资源，避免竞态条件。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-458-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-458-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-458-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-458-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-458-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-458-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-458-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-458-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-458-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-458-10">10</a></span>
<span class="normal"><a href="#__codelineno-458-11">11</a></span>
<span class="normal"><a href="#__codelineno-458-12">12</a></span>
<span class="normal"><a href="#__codelineno-458-13">13</a></span>
<span class="normal"><a href="#__codelineno-458-14">14</a></span>
<span class="normal"><a href="#__codelineno-458-15">15</a></span>
<span class="normal"><a href="#__codelineno-458-16">16</a></span>
<span class="normal"><a href="#__codelineno-458-17">17</a></span>
<span class="normal"><a href="#__codelineno-458-18">18</a></span>
<span class="normal"><a href="#__codelineno-458-19">19</a></span>
<span class="normal"><a href="#__codelineno-458-20">20</a></span>
<span class="normal"><a href="#__codelineno-458-21">21</a></span>
<span class="normal"><a href="#__codelineno-458-22">22</a></span>
<span class="normal"><a href="#__codelineno-458-23">23</a></span>
<span class="normal"><a href="#__codelineno-458-24">24</a></span>
<span class="normal"><a href="#__codelineno-458-25">25</a></span>
<span class="normal"><a href="#__codelineno-458-26">26</a></span>
<span class="normal"><a href="#__codelineno-458-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-458-1" name="__codelineno-458-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-458-2" name="__codelineno-458-2"></a>
<a id="__codelineno-458-3" name="__codelineno-458-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-458-4" name="__codelineno-458-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-458-5" name="__codelineno-458-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-458-6" name="__codelineno-458-6"></a><span class="p">)</span>
<a id="__codelineno-458-7" name="__codelineno-458-7"></a>
<a id="__codelineno-458-8" name="__codelineno-458-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-458-9" name="__codelineno-458-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mutex</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-458-10" name="__codelineno-458-10"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-458-11" name="__codelineno-458-11"></a>
<a id="__codelineno-458-12" name="__codelineno-458-12"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-458-13" name="__codelineno-458-13"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-458-14" name="__codelineno-458-14"></a><span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-458-15" name="__codelineno-458-15"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-458-16" name="__codelineno-458-16"></a><span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<a id="__codelineno-458-17" name="__codelineno-458-17"></a><span class="w">            </span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span><span class="w"> </span><span class="c1">// 上锁</span>
<a id="__codelineno-458-18" name="__codelineno-458-18"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Goroutine %d 开始修改计数器\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-458-19" name="__codelineno-458-19"></a><span class="w">            </span><span class="nx">counter</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-458-20" name="__codelineno-458-20"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Goroutine %d 完成修改，计数器 = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">)</span>
<a id="__codelineno-458-21" name="__codelineno-458-21"></a><span class="w">            </span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span><span class="w"> </span><span class="c1">// 解锁</span>
<a id="__codelineno-458-22" name="__codelineno-458-22"></a><span class="w">        </span><span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-458-23" name="__codelineno-458-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-458-24" name="__codelineno-458-24"></a>
<a id="__codelineno-458-25" name="__codelineno-458-25"></a><span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<a id="__codelineno-458-26" name="__codelineno-458-26"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;最终计数器 = %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 5</span>
<a id="__codelineno-458-27" name="__codelineno-458-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-459-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-459-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-459-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-459-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-459-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-459-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-459-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-459-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-459-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-459-10">10</a></span>
<span class="normal"><a href="#__codelineno-459-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-459-1" name="__codelineno-459-1"></a>Goroutine 1 开始修改计数器
<a id="__codelineno-459-2" name="__codelineno-459-2"></a>Goroutine 1 完成修改，计数器 = 1
<a id="__codelineno-459-3" name="__codelineno-459-3"></a>Goroutine 2 开始修改计数器
<a id="__codelineno-459-4" name="__codelineno-459-4"></a>Goroutine 2 完成修改，计数器 = 2
<a id="__codelineno-459-5" name="__codelineno-459-5"></a>Goroutine 3 开始修改计数器
<a id="__codelineno-459-6" name="__codelineno-459-6"></a>Goroutine 3 完成修改，计数器 = 3
<a id="__codelineno-459-7" name="__codelineno-459-7"></a>Goroutine 4 开始修改计数器
<a id="__codelineno-459-8" name="__codelineno-459-8"></a>Goroutine 4 完成修改，计数器 = 4
<a id="__codelineno-459-9" name="__codelineno-459-9"></a>Goroutine 5 开始修改计数器
<a id="__codelineno-459-10" name="__codelineno-459-10"></a>Goroutine 5 完成修改，计数器 = 5
<a id="__codelineno-459-11" name="__codelineno-459-11"></a>最终计数器 = 5
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Mutex</code>确保在任一时刻只有一个Goroutine可以访问和修改<code>counter</code>变量。</li>
<li>每个Goroutine在修改<code>counter</code>之前调用<code>mutex.Lock()</code>上锁，完成后调用<code>mutex.Unlock()</code>解锁。</li>
<li>通过互斥锁，避免了多个Goroutine同时修改<code>counter</code>导致的不一致性。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>避免死锁</strong>：确保每个<code>Lock</code>调用都有相应的<code>Unlock</code>，并避免在锁定状态下调用可能导致阻塞的函数。</li>
<li><strong>尽量缩小锁定范围</strong>：只在必要的代码段内上锁，减少锁的持有时间，提高并发性能。</li>
</ul>
<h4 id="once">Once<a class="headerlink" href="#once" title="Permanent link">&para;</a></h4>
<p><code>Once</code>确保某段代码只执行一次，适用于初始化操作或只需要一次性执行的任务。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-460-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-460-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-460-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-460-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-460-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-460-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-460-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-460-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-460-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-460-10">10</a></span>
<span class="normal"><a href="#__codelineno-460-11">11</a></span>
<span class="normal"><a href="#__codelineno-460-12">12</a></span>
<span class="normal"><a href="#__codelineno-460-13">13</a></span>
<span class="normal"><a href="#__codelineno-460-14">14</a></span>
<span class="normal"><a href="#__codelineno-460-15">15</a></span>
<span class="normal"><a href="#__codelineno-460-16">16</a></span>
<span class="normal"><a href="#__codelineno-460-17">17</a></span>
<span class="normal"><a href="#__codelineno-460-18">18</a></span>
<span class="normal"><a href="#__codelineno-460-19">19</a></span>
<span class="normal"><a href="#__codelineno-460-20">20</a></span>
<span class="normal"><a href="#__codelineno-460-21">21</a></span>
<span class="normal"><a href="#__codelineno-460-22">22</a></span>
<span class="normal"><a href="#__codelineno-460-23">23</a></span>
<span class="normal"><a href="#__codelineno-460-24">24</a></span>
<span class="normal"><a href="#__codelineno-460-25">25</a></span>
<span class="normal"><a href="#__codelineno-460-26">26</a></span>
<span class="normal"><a href="#__codelineno-460-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-460-1" name="__codelineno-460-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-460-2" name="__codelineno-460-2"></a>
<a id="__codelineno-460-3" name="__codelineno-460-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-460-4" name="__codelineno-460-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-460-5" name="__codelineno-460-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-460-6" name="__codelineno-460-6"></a><span class="p">)</span>
<a id="__codelineno-460-7" name="__codelineno-460-7"></a>
<a id="__codelineno-460-8" name="__codelineno-460-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">once</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>
<a id="__codelineno-460-9" name="__codelineno-460-9"></a>
<a id="__codelineno-460-10" name="__codelineno-460-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-460-11" name="__codelineno-460-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;初始化操作执行&quot;</span><span class="p">)</span>
<a id="__codelineno-460-12" name="__codelineno-460-12"></a><span class="p">}</span>
<a id="__codelineno-460-13" name="__codelineno-460-13"></a>
<a id="__codelineno-460-14" name="__codelineno-460-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-460-15" name="__codelineno-460-15"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-460-16" name="__codelineno-460-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-460-17" name="__codelineno-460-17"></a><span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-460-18" name="__codelineno-460-18"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-460-19" name="__codelineno-460-19"></a><span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<a id="__codelineno-460-20" name="__codelineno-460-20"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Goroutine %d 调用 initialize\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-460-21" name="__codelineno-460-21"></a><span class="w">            </span><span class="nx">once</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">initialize</span><span class="p">)</span>
<a id="__codelineno-460-22" name="__codelineno-460-22"></a><span class="w">        </span><span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-460-23" name="__codelineno-460-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-460-24" name="__codelineno-460-24"></a>
<a id="__codelineno-460-25" name="__codelineno-460-25"></a><span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<a id="__codelineno-460-26" name="__codelineno-460-26"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;所有Goroutine已完成&quot;</span><span class="p">)</span>
<a id="__codelineno-460-27" name="__codelineno-460-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-461-1">1</a></span>
<span class="normal"><a href="#__codelineno-461-2">2</a></span>
<span class="normal"><a href="#__codelineno-461-3">3</a></span>
<span class="normal"><a href="#__codelineno-461-4">4</a></span>
<span class="normal"><a href="#__codelineno-461-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-461-1" name="__codelineno-461-1"></a>Goroutine 1 调用 initialize
<a id="__codelineno-461-2" name="__codelineno-461-2"></a>初始化操作执行
<a id="__codelineno-461-3" name="__codelineno-461-3"></a>Goroutine 2 调用 initialize
<a id="__codelineno-461-4" name="__codelineno-461-4"></a>Goroutine 3 调用 initialize
<a id="__codelineno-461-5" name="__codelineno-461-5"></a>所有Goroutine已完成
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>多个Goroutine尝试调用<code>once.Do(initialize)</code>，但<code>initialize</code>函数只执行一次。</li>
<li><code>sync.Once</code>确保<code>initialize</code>函数的执行是安全的，即使在并发环境中也不会多次执行。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>初始化顺序</strong>：如果初始化操作依赖于其他初始化步骤，确保<code>Once</code>的调用顺序和依赖关系正确。</li>
<li><strong>重复使用</strong>：<code>sync.Once</code>对象只能用于一次执行，无法重用。如果需要多次执行不同的操作，需创建多个<code>Once</code>对象。</li>
</ul>
<h3 id="94-context-包">9.4 <code>context</code> 包<a class="headerlink" href="#94-context-包" title="Permanent link">&para;</a></h3>
<p><code>context</code>包用于在Goroutine之间传递取消信号、截止时间和其他请求范围的值。它在处理并发任务、超时控制和资源管理时非常有用。</p>
<h4 id="context-的用法">Context 的用法<a class="headerlink" href="#context-的用法" title="Permanent link">&para;</a></h4>
<p><code>Context</code>在Go中主要用于以下几个方面：</p>
<ul>
<li><strong>取消信号</strong>：通知Goroutine停止执行。</li>
<li><strong>截止时间</strong>：设置任务的超时时间。</li>
<li><strong>传递值</strong>：在不同Goroutine之间传递请求范围的值。</li>
</ul>
<p><strong>基本用法：</strong></p>
<ul>
<li>创建背景上下文：<code>context.Background()</code></li>
<li>创建带取消的上下文：<code>context.WithCancel(parent)</code></li>
<li>创建带截止时间的上下文：<code>context.WithDeadline(parent, deadline)</code></li>
<li>创建带超时的上下文：<code>context.WithTimeout(parent, timeout)</code></li>
<li>创建带值的上下文：<code>context.WithValue(parent, key, value)</code></li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-462-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-462-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-462-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-462-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-462-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-462-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-462-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-462-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-462-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-462-10">10</a></span>
<span class="normal"><a href="#__codelineno-462-11">11</a></span>
<span class="normal"><a href="#__codelineno-462-12">12</a></span>
<span class="normal"><a href="#__codelineno-462-13">13</a></span>
<span class="normal"><a href="#__codelineno-462-14">14</a></span>
<span class="normal"><a href="#__codelineno-462-15">15</a></span>
<span class="normal"><a href="#__codelineno-462-16">16</a></span>
<span class="normal"><a href="#__codelineno-462-17">17</a></span>
<span class="normal"><a href="#__codelineno-462-18">18</a></span>
<span class="normal"><a href="#__codelineno-462-19">19</a></span>
<span class="normal"><a href="#__codelineno-462-20">20</a></span>
<span class="normal"><a href="#__codelineno-462-21">21</a></span>
<span class="normal"><a href="#__codelineno-462-22">22</a></span>
<span class="normal"><a href="#__codelineno-462-23">23</a></span>
<span class="normal"><a href="#__codelineno-462-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-462-1" name="__codelineno-462-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-462-2" name="__codelineno-462-2"></a>
<a id="__codelineno-462-3" name="__codelineno-462-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-462-4" name="__codelineno-462-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-462-5" name="__codelineno-462-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-462-6" name="__codelineno-462-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-462-7" name="__codelineno-462-7"></a><span class="p">)</span>
<a id="__codelineno-462-8" name="__codelineno-462-8"></a>
<a id="__codelineno-462-9" name="__codelineno-462-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-462-10" name="__codelineno-462-10"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-462-11" name="__codelineno-462-11"></a><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancel</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-462-12" name="__codelineno-462-12"></a>
<a id="__codelineno-462-13" name="__codelineno-462-13"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-462-14" name="__codelineno-462-14"></a><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-462-15" name="__codelineno-462-15"></a><span class="w">        </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 取消上下文</span>
<a id="__codelineno-462-16" name="__codelineno-462-16"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-462-17" name="__codelineno-462-17"></a>
<a id="__codelineno-462-18" name="__codelineno-462-18"></a><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-462-19" name="__codelineno-462-19"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">):</span>
<a id="__codelineno-462-20" name="__codelineno-462-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;超时未取消&quot;</span><span class="p">)</span>
<a id="__codelineno-462-21" name="__codelineno-462-21"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span>
<a id="__codelineno-462-22" name="__codelineno-462-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;上下文已取消:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Err</span><span class="p">())</span><span class="w"> </span><span class="c1">// 输出: 上下文已取消: context canceled</span>
<a id="__codelineno-462-23" name="__codelineno-462-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-462-24" name="__codelineno-462-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-463-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-463-1" name="__codelineno-463-1"></a>上下文已取消: context canceled
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>主函数创建了一个带取消功能的上下文<code>ctx</code>。</li>
<li>启动一个Goroutine，在2秒后调用<code>cancel()</code>取消上下文。</li>
<li>主Goroutine通过<code>select</code>语句等待上下文取消或超时。</li>
<li>当上下文被取消时，接收<code>ctx.Done()</code>信号，输出取消信息。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>传递上下文</strong>：将上下文作为函数参数传递，以确保所有相关的Goroutine能够接收到取消信号。</li>
<li><strong>资源释放</strong>：在取消上下文后，确保所有相关资源被正确释放，避免资源泄漏。</li>
</ul>
<h4 id="context-的取消与超时">Context 的取消与超时<a class="headerlink" href="#context-的取消与超时" title="Permanent link">&para;</a></h4>
<p><code>Context</code>提供了机制来取消长时间运行的任务或设置任务的最大执行时间。</p>
<p><strong>示例：取消上下文</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-464-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-464-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-464-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-464-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-464-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-464-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-464-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-464-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-464-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-464-10">10</a></span>
<span class="normal"><a href="#__codelineno-464-11">11</a></span>
<span class="normal"><a href="#__codelineno-464-12">12</a></span>
<span class="normal"><a href="#__codelineno-464-13">13</a></span>
<span class="normal"><a href="#__codelineno-464-14">14</a></span>
<span class="normal"><a href="#__codelineno-464-15">15</a></span>
<span class="normal"><a href="#__codelineno-464-16">16</a></span>
<span class="normal"><a href="#__codelineno-464-17">17</a></span>
<span class="normal"><a href="#__codelineno-464-18">18</a></span>
<span class="normal"><a href="#__codelineno-464-19">19</a></span>
<span class="normal"><a href="#__codelineno-464-20">20</a></span>
<span class="normal"><a href="#__codelineno-464-21">21</a></span>
<span class="normal"><a href="#__codelineno-464-22">22</a></span>
<span class="normal"><a href="#__codelineno-464-23">23</a></span>
<span class="normal"><a href="#__codelineno-464-24">24</a></span>
<span class="normal"><a href="#__codelineno-464-25">25</a></span>
<span class="normal"><a href="#__codelineno-464-26">26</a></span>
<span class="normal"><a href="#__codelineno-464-27">27</a></span>
<span class="normal"><a href="#__codelineno-464-28">28</a></span>
<span class="normal"><a href="#__codelineno-464-29">29</a></span>
<span class="normal"><a href="#__codelineno-464-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-464-1" name="__codelineno-464-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-464-2" name="__codelineno-464-2"></a>
<a id="__codelineno-464-3" name="__codelineno-464-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-464-4" name="__codelineno-464-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-464-5" name="__codelineno-464-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-464-6" name="__codelineno-464-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-464-7" name="__codelineno-464-7"></a><span class="p">)</span>
<a id="__codelineno-464-8" name="__codelineno-464-8"></a>
<a id="__codelineno-464-9" name="__codelineno-464-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">doWork</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-464-10" name="__codelineno-464-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-464-11" name="__codelineno-464-11"></a><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-464-12" name="__codelineno-464-12"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span>
<a id="__codelineno-464-13" name="__codelineno-464-13"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;工作被取消:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Err</span><span class="p">())</span>
<a id="__codelineno-464-14" name="__codelineno-464-14"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-464-15" name="__codelineno-464-15"></a><span class="w">        </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-464-16" name="__codelineno-464-16"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;工作进行中...&quot;</span><span class="p">)</span>
<a id="__codelineno-464-17" name="__codelineno-464-17"></a><span class="w">            </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">500</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span>
<a id="__codelineno-464-18" name="__codelineno-464-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-464-19" name="__codelineno-464-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-464-20" name="__codelineno-464-20"></a><span class="p">}</span>
<a id="__codelineno-464-21" name="__codelineno-464-21"></a>
<a id="__codelineno-464-22" name="__codelineno-464-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-464-23" name="__codelineno-464-23"></a><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">())</span>
<a id="__codelineno-464-24" name="__codelineno-464-24"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">doWork</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-464-25" name="__codelineno-464-25"></a>
<a id="__codelineno-464-26" name="__codelineno-464-26"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-464-27" name="__codelineno-464-27"></a><span class="w">    </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 取消上下文</span>
<a id="__codelineno-464-28" name="__codelineno-464-28"></a>
<a id="__codelineno-464-29" name="__codelineno-464-29"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w"> </span><span class="c1">// 等待Goroutine完成</span>
<a id="__codelineno-464-30" name="__codelineno-464-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-465-1">1</a></span>
<span class="normal"><a href="#__codelineno-465-2">2</a></span>
<span class="normal"><a href="#__codelineno-465-3">3</a></span>
<span class="normal"><a href="#__codelineno-465-4">4</a></span>
<span class="normal"><a href="#__codelineno-465-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-465-1" name="__codelineno-465-1"></a>工作进行中...
<a id="__codelineno-465-2" name="__codelineno-465-2"></a>工作进行中...
<a id="__codelineno-465-3" name="__codelineno-465-3"></a>工作进行中...
<a id="__codelineno-465-4" name="__codelineno-465-4"></a>工作进行中...
<a id="__codelineno-465-5" name="__codelineno-465-5"></a>工作被取消: context canceled
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>主函数创建一个带取消功能的上下文<code>ctx</code>。</li>
<li>启动<code>doWork</code>函数的Goroutine，持续进行工作，直到接收到取消信号。</li>
<li>主Goroutine等待2秒后调用<code>cancel()</code>取消上下文。</li>
<li><code>doWork</code>函数接收到取消信号后停止工作并退出。</li>
</ul>
<p><strong>示例：设置超时</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-466-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-466-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-466-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-466-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-466-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-466-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-466-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-466-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-466-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-466-10">10</a></span>
<span class="normal"><a href="#__codelineno-466-11">11</a></span>
<span class="normal"><a href="#__codelineno-466-12">12</a></span>
<span class="normal"><a href="#__codelineno-466-13">13</a></span>
<span class="normal"><a href="#__codelineno-466-14">14</a></span>
<span class="normal"><a href="#__codelineno-466-15">15</a></span>
<span class="normal"><a href="#__codelineno-466-16">16</a></span>
<span class="normal"><a href="#__codelineno-466-17">17</a></span>
<span class="normal"><a href="#__codelineno-466-18">18</a></span>
<span class="normal"><a href="#__codelineno-466-19">19</a></span>
<span class="normal"><a href="#__codelineno-466-20">20</a></span>
<span class="normal"><a href="#__codelineno-466-21">21</a></span>
<span class="normal"><a href="#__codelineno-466-22">22</a></span>
<span class="normal"><a href="#__codelineno-466-23">23</a></span>
<span class="normal"><a href="#__codelineno-466-24">24</a></span>
<span class="normal"><a href="#__codelineno-466-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-466-1" name="__codelineno-466-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-466-2" name="__codelineno-466-2"></a>
<a id="__codelineno-466-3" name="__codelineno-466-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-466-4" name="__codelineno-466-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-466-5" name="__codelineno-466-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-466-6" name="__codelineno-466-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-466-7" name="__codelineno-466-7"></a><span class="p">)</span>
<a id="__codelineno-466-8" name="__codelineno-466-8"></a>
<a id="__codelineno-466-9" name="__codelineno-466-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">doTask</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-466-10" name="__codelineno-466-10"></a><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-466-11" name="__codelineno-466-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">):</span>
<a id="__codelineno-466-12" name="__codelineno-466-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;任务完成&quot;</span><span class="p">)</span>
<a id="__codelineno-466-13" name="__codelineno-466-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span>
<a id="__codelineno-466-14" name="__codelineno-466-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;任务被取消:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Err</span><span class="p">())</span>
<a id="__codelineno-466-15" name="__codelineno-466-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-466-16" name="__codelineno-466-16"></a><span class="p">}</span>
<a id="__codelineno-466-17" name="__codelineno-466-17"></a>
<a id="__codelineno-466-18" name="__codelineno-466-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-466-19" name="__codelineno-466-19"></a><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-466-20" name="__codelineno-466-20"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span><span class="c1">// 确保上下文被取消</span>
<a id="__codelineno-466-21" name="__codelineno-466-21"></a>
<a id="__codelineno-466-22" name="__codelineno-466-22"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">doTask</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-466-23" name="__codelineno-466-23"></a>
<a id="__codelineno-466-24" name="__codelineno-466-24"></a><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w"> </span><span class="c1">// 等待任务完成或取消</span>
<a id="__codelineno-466-25" name="__codelineno-466-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-467-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-467-1" name="__codelineno-467-1"></a>任务被取消: context deadline exceeded
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>主函数创建一个带超时功能的上下文<code>ctx</code>，超时时间为2秒。</li>
<li>启动<code>doTask</code>函数的Goroutine，该函数在3秒后完成任务。</li>
<li>由于任务需要3秒，而上下文超时设为2秒，<code>doTask</code>函数会在2秒后接收到取消信号，任务被取消。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>提前取消</strong>：如果任务提前完成，应调用<code>cancel()</code>释放资源，即使使用了<code>WithTimeout</code>。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-468-1">1</a></span>
<span class="normal"><a href="#__codelineno-468-2">2</a></span>
<span class="normal"><a href="#__codelineno-468-3">3</a></span>
<span class="normal"><a href="#__codelineno-468-4">4</a></span>
<span class="normal"><a href="#__codelineno-468-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-468-1" name="__codelineno-468-1"></a><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="mi">5</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-468-2" name="__codelineno-468-2"></a><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>
<a id="__codelineno-468-3" name="__codelineno-468-3"></a>
<a id="__codelineno-468-4" name="__codelineno-468-4"></a><span class="k">go</span><span class="w"> </span><span class="nx">doTask</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-468-5" name="__codelineno-468-5"></a><span class="c1">// 任务完成后自动取消</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>嵌套上下文</strong>：可以基于已有的上下文创建新的上下文，以实现更细粒度的控制。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-469-1">1</a></span>
<span class="normal"><a href="#__codelineno-469-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-469-1" name="__codelineno-469-1"></a><span class="nx">parentCtx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-469-2" name="__codelineno-469-2"></a><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancel</span><span class="p">(</span><span class="nx">parentCtx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="context-的传递与使用">Context 的传递与使用<a class="headerlink" href="#context-的传递与使用" title="Permanent link">&para;</a></h4>
<p>在Go中，建议将<code>Context</code>作为函数的第一个参数传递，遵循<code>ctx context.Context</code>的命名约定。这有助于确保上下文在调用链中被正确传递和使用。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-470-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-470-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-470-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-470-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-470-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-470-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-470-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-470-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-470-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-470-10">10</a></span>
<span class="normal"><a href="#__codelineno-470-11">11</a></span>
<span class="normal"><a href="#__codelineno-470-12">12</a></span>
<span class="normal"><a href="#__codelineno-470-13">13</a></span>
<span class="normal"><a href="#__codelineno-470-14">14</a></span>
<span class="normal"><a href="#__codelineno-470-15">15</a></span>
<span class="normal"><a href="#__codelineno-470-16">16</a></span>
<span class="normal"><a href="#__codelineno-470-17">17</a></span>
<span class="normal"><a href="#__codelineno-470-18">18</a></span>
<span class="normal"><a href="#__codelineno-470-19">19</a></span>
<span class="normal"><a href="#__codelineno-470-20">20</a></span>
<span class="normal"><a href="#__codelineno-470-21">21</a></span>
<span class="normal"><a href="#__codelineno-470-22">22</a></span>
<span class="normal"><a href="#__codelineno-470-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-470-1" name="__codelineno-470-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-470-2" name="__codelineno-470-2"></a>
<a id="__codelineno-470-3" name="__codelineno-470-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-470-4" name="__codelineno-470-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-470-5" name="__codelineno-470-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-470-6" name="__codelineno-470-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-470-7" name="__codelineno-470-7"></a><span class="p">)</span>
<a id="__codelineno-470-8" name="__codelineno-470-8"></a>
<a id="__codelineno-470-9" name="__codelineno-470-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">fetchData</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-470-10" name="__codelineno-470-10"></a><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-470-11" name="__codelineno-470-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">):</span>
<a id="__codelineno-470-12" name="__codelineno-470-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;成功获取数据 from&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">)</span>
<a id="__codelineno-470-13" name="__codelineno-470-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span>
<a id="__codelineno-470-14" name="__codelineno-470-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取数据被取消 from&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Err</span><span class="p">())</span>
<a id="__codelineno-470-15" name="__codelineno-470-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-470-16" name="__codelineno-470-16"></a><span class="p">}</span>
<a id="__codelineno-470-17" name="__codelineno-470-17"></a>
<a id="__codelineno-470-18" name="__codelineno-470-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-470-19" name="__codelineno-470-19"></a><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-470-20" name="__codelineno-470-20"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>
<a id="__codelineno-470-21" name="__codelineno-470-21"></a>
<a id="__codelineno-470-22" name="__codelineno-470-22"></a><span class="w">    </span><span class="nx">fetchData</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;https://example.com&quot;</span><span class="p">)</span>
<a id="__codelineno-470-23" name="__codelineno-470-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-471-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-471-1" name="__codelineno-471-1"></a>获取数据被取消 from https://example.com : context deadline exceeded
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>fetchData</code>函数接受一个<code>Context</code>和一个URL作为参数。</li>
<li>如果数据获取操作超过1秒，主函数取消上下文，<code>fetchData</code>函数收到取消信号，停止操作。</li>
<li>通过将<code>Context</code>作为参数传递，可以在函数内部安全地处理取消和超时。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>传递规则</strong>：确保<code>Context</code>只在函数的顶层传递，不要在包级变量中使用。</li>
<li><strong>不可存储</strong>：不要将<code>Context</code>存储在结构体中，或作为函数的返回值，应仅在需要传递时使用。</li>
</ul>
<h2 id="10-错误处理">10. 错误处理<a class="headerlink" href="#10-错误处理" title="Permanent link">&para;</a></h2>
<p>错误处理是编写健壮且可靠程序的关键组成部分。Go语言采用了一种独特的错误处理机制，既简单又高效。本章将深入探讨Go中的错误处理，包括错误类型、<code>panic</code>与<code>recover</code>机制以及常见的错误处理模式。通过丰富的示例和详细的解释，帮助你理解并掌握Go语言中的错误处理策略，从而编写更稳定和可维护的代码。</p>
<h3 id="101-错误类型">10.1 错误类型<a class="headerlink" href="#101-错误类型" title="Permanent link">&para;</a></h3>
<p>在Go语言中，错误被视为一种普通的值。错误处理的核心是<code>error</code>接口，它定义了错误的基本行为。此外，Go还支持创建自定义错误类型，以满足更复杂的错误处理需求。</p>
<h4 id="error-接口"><code>error</code> 接口<a class="headerlink" href="#error-接口" title="Permanent link">&para;</a></h4>
<p><code>error</code>是Go语言内置的接口，用于表示错误状态。它定义了一个单一的方法：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-472-1">1</a></span>
<span class="normal"><a href="#__codelineno-472-2">2</a></span>
<span class="normal"><a href="#__codelineno-472-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-472-1" name="__codelineno-472-1"></a><span class="kd">type</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-472-2" name="__codelineno-472-2"></a><span class="w">    </span><span class="nx">Error</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-472-3" name="__codelineno-472-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>任何实现了<code>Error() string</code>方法的类型都满足<code>error</code>接口，可以被视为一个错误。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-473-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-473-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-473-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-473-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-473-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-473-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-473-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-473-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-473-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-473-10">10</a></span>
<span class="normal"><a href="#__codelineno-473-11">11</a></span>
<span class="normal"><a href="#__codelineno-473-12">12</a></span>
<span class="normal"><a href="#__codelineno-473-13">13</a></span>
<span class="normal"><a href="#__codelineno-473-14">14</a></span>
<span class="normal"><a href="#__codelineno-473-15">15</a></span>
<span class="normal"><a href="#__codelineno-473-16">16</a></span>
<span class="normal"><a href="#__codelineno-473-17">17</a></span>
<span class="normal"><a href="#__codelineno-473-18">18</a></span>
<span class="normal"><a href="#__codelineno-473-19">19</a></span>
<span class="normal"><a href="#__codelineno-473-20">20</a></span>
<span class="normal"><a href="#__codelineno-473-21">21</a></span>
<span class="normal"><a href="#__codelineno-473-22">22</a></span>
<span class="normal"><a href="#__codelineno-473-23">23</a></span>
<span class="normal"><a href="#__codelineno-473-24">24</a></span>
<span class="normal"><a href="#__codelineno-473-25">25</a></span>
<span class="normal"><a href="#__codelineno-473-26">26</a></span>
<span class="normal"><a href="#__codelineno-473-27">27</a></span>
<span class="normal"><a href="#__codelineno-473-28">28</a></span>
<span class="normal"><a href="#__codelineno-473-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-473-1" name="__codelineno-473-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-473-2" name="__codelineno-473-2"></a>
<a id="__codelineno-473-3" name="__codelineno-473-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-473-4" name="__codelineno-473-4"></a><span class="w">    </span><span class="s">&quot;errors&quot;</span>
<a id="__codelineno-473-5" name="__codelineno-473-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-473-6" name="__codelineno-473-6"></a><span class="p">)</span>
<a id="__codelineno-473-7" name="__codelineno-473-7"></a>
<a id="__codelineno-473-8" name="__codelineno-473-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">divide</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">float64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-473-9" name="__codelineno-473-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-473-10" name="__codelineno-473-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;除数不能为零&quot;</span><span class="p">)</span>
<a id="__codelineno-473-11" name="__codelineno-473-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-473-12" name="__codelineno-473-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-473-13" name="__codelineno-473-13"></a><span class="p">}</span>
<a id="__codelineno-473-14" name="__codelineno-473-14"></a>
<a id="__codelineno-473-15" name="__codelineno-473-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-473-16" name="__codelineno-473-16"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-473-17" name="__codelineno-473-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-473-18" name="__codelineno-473-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-473-19" name="__codelineno-473-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-473-20" name="__codelineno-473-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;结果:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 结果: 5</span>
<a id="__codelineno-473-21" name="__codelineno-473-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-473-22" name="__codelineno-473-22"></a>
<a id="__codelineno-473-23" name="__codelineno-473-23"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-473-24" name="__codelineno-473-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-473-25" name="__codelineno-473-25"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 错误: 除数不能为零</span>
<a id="__codelineno-473-26" name="__codelineno-473-26"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-473-27" name="__codelineno-473-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;结果:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<a id="__codelineno-473-28" name="__codelineno-473-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-473-29" name="__codelineno-473-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-474-1">1</a></span>
<span class="normal"><a href="#__codelineno-474-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-474-1" name="__codelineno-474-1"></a>结果: 5
<a id="__codelineno-474-2" name="__codelineno-474-2"></a>错误: 除数不能为零
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>divide</code>函数尝试执行除法运算。如果除数为零，返回一个错误；否则，返回结果和<code>nil</code>错误。</li>
<li>主函数调用<code>divide</code>并根据返回的错误值进行相应的处理。</li>
</ul>
<h4 id="自定义错误">自定义错误<a class="headerlink" href="#自定义错误" title="Permanent link">&para;</a></h4>
<p>在某些情况下，内置的<code>errors.New</code>可能不足以满足复杂的错误处理需求。Go允许开发者创建自定义错误类型，以包含更多的上下文信息或实现特定的行为。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-475-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-475-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-475-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-475-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-475-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-475-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-475-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-475-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-475-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-475-10">10</a></span>
<span class="normal"><a href="#__codelineno-475-11">11</a></span>
<span class="normal"><a href="#__codelineno-475-12">12</a></span>
<span class="normal"><a href="#__codelineno-475-13">13</a></span>
<span class="normal"><a href="#__codelineno-475-14">14</a></span>
<span class="normal"><a href="#__codelineno-475-15">15</a></span>
<span class="normal"><a href="#__codelineno-475-16">16</a></span>
<span class="normal"><a href="#__codelineno-475-17">17</a></span>
<span class="normal"><a href="#__codelineno-475-18">18</a></span>
<span class="normal"><a href="#__codelineno-475-19">19</a></span>
<span class="normal"><a href="#__codelineno-475-20">20</a></span>
<span class="normal"><a href="#__codelineno-475-21">21</a></span>
<span class="normal"><a href="#__codelineno-475-22">22</a></span>
<span class="normal"><a href="#__codelineno-475-23">23</a></span>
<span class="normal"><a href="#__codelineno-475-24">24</a></span>
<span class="normal"><a href="#__codelineno-475-25">25</a></span>
<span class="normal"><a href="#__codelineno-475-26">26</a></span>
<span class="normal"><a href="#__codelineno-475-27">27</a></span>
<span class="normal"><a href="#__codelineno-475-28">28</a></span>
<span class="normal"><a href="#__codelineno-475-29">29</a></span>
<span class="normal"><a href="#__codelineno-475-30">30</a></span>
<span class="normal"><a href="#__codelineno-475-31">31</a></span>
<span class="normal"><a href="#__codelineno-475-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-475-1" name="__codelineno-475-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-475-2" name="__codelineno-475-2"></a>
<a id="__codelineno-475-3" name="__codelineno-475-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-475-4" name="__codelineno-475-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-475-5" name="__codelineno-475-5"></a><span class="p">)</span>
<a id="__codelineno-475-6" name="__codelineno-475-6"></a>
<a id="__codelineno-475-7" name="__codelineno-475-7"></a><span class="c1">// 定义自定义错误类型</span>
<a id="__codelineno-475-8" name="__codelineno-475-8"></a><span class="kd">type</span><span class="w"> </span><span class="nx">MyError</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-475-9" name="__codelineno-475-9"></a><span class="w">    </span><span class="nx">Code</span><span class="w">    </span><span class="kt">int</span>
<a id="__codelineno-475-10" name="__codelineno-475-10"></a><span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-475-11" name="__codelineno-475-11"></a><span class="p">}</span>
<a id="__codelineno-475-12" name="__codelineno-475-12"></a>
<a id="__codelineno-475-13" name="__codelineno-475-13"></a><span class="c1">// 实现 error 接口</span>
<a id="__codelineno-475-14" name="__codelineno-475-14"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">*</span><span class="nx">MyError</span><span class="p">)</span><span class="w"> </span><span class="nx">Error</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-475-15" name="__codelineno-475-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;错误代码 %d: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
<a id="__codelineno-475-16" name="__codelineno-475-16"></a><span class="p">}</span>
<a id="__codelineno-475-17" name="__codelineno-475-17"></a>
<a id="__codelineno-475-18" name="__codelineno-475-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">flag</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-475-19" name="__codelineno-475-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">flag</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-475-20" name="__codelineno-475-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MyError</span><span class="p">{</span><span class="nx">Code</span><span class="p">:</span><span class="w"> </span><span class="mi">404</span><span class="p">,</span><span class="w"> </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;资源未找到&quot;</span><span class="p">}</span>
<a id="__codelineno-475-21" name="__codelineno-475-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-475-22" name="__codelineno-475-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-475-23" name="__codelineno-475-23"></a><span class="p">}</span>
<a id="__codelineno-475-24" name="__codelineno-475-24"></a>
<a id="__codelineno-475-25" name="__codelineno-475-25"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-475-26" name="__codelineno-475-26"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<a id="__codelineno-475-27" name="__codelineno-475-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-475-28" name="__codelineno-475-28"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发生错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 发生错误: 错误代码 404: 资源未找到</span>
<a id="__codelineno-475-29" name="__codelineno-475-29"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-475-30" name="__codelineno-475-30"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;操作成功&quot;</span><span class="p">)</span>
<a id="__codelineno-475-31" name="__codelineno-475-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-475-32" name="__codelineno-475-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-476-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-476-1" name="__codelineno-476-1"></a>发生错误: 错误代码 404: 资源未找到
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>MyError</code>结构体包含了错误代码和错误消息。</li>
<li>实现了<code>Error() string</code>方法，使<code>MyError</code>满足<code>error</code>接口。</li>
<li><code>doSomething</code>函数根据传入的标志返回不同类型的错误。</li>
</ul>
<p><strong>使用<code>fmt.Errorf</code>创建带格式的错误：</strong></p>
<p>Go 1.13引入了<code>fmt.Errorf</code>，支持创建带格式的错误消息，并且可以使用<code>%w</code>动词包装错误，以实现错误的链式包装。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-477-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-477-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-477-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-477-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-477-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-477-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-477-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-477-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-477-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-477-10">10</a></span>
<span class="normal"><a href="#__codelineno-477-11">11</a></span>
<span class="normal"><a href="#__codelineno-477-12">12</a></span>
<span class="normal"><a href="#__codelineno-477-13">13</a></span>
<span class="normal"><a href="#__codelineno-477-14">14</a></span>
<span class="normal"><a href="#__codelineno-477-15">15</a></span>
<span class="normal"><a href="#__codelineno-477-16">16</a></span>
<span class="normal"><a href="#__codelineno-477-17">17</a></span>
<span class="normal"><a href="#__codelineno-477-18">18</a></span>
<span class="normal"><a href="#__codelineno-477-19">19</a></span>
<span class="normal"><a href="#__codelineno-477-20">20</a></span>
<span class="normal"><a href="#__codelineno-477-21">21</a></span>
<span class="normal"><a href="#__codelineno-477-22">22</a></span>
<span class="normal"><a href="#__codelineno-477-23">23</a></span>
<span class="normal"><a href="#__codelineno-477-24">24</a></span>
<span class="normal"><a href="#__codelineno-477-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-477-1" name="__codelineno-477-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-477-2" name="__codelineno-477-2"></a>
<a id="__codelineno-477-3" name="__codelineno-477-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-477-4" name="__codelineno-477-4"></a><span class="w">    </span><span class="s">&quot;errors&quot;</span>
<a id="__codelineno-477-5" name="__codelineno-477-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-477-6" name="__codelineno-477-6"></a><span class="p">)</span>
<a id="__codelineno-477-7" name="__codelineno-477-7"></a>
<a id="__codelineno-477-8" name="__codelineno-477-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-477-9" name="__codelineno-477-9"></a><span class="w">    </span><span class="c1">// 模拟一个错误</span>
<a id="__codelineno-477-10" name="__codelineno-477-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;无法读取文件 %s: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">filename</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;文件不存在&quot;</span><span class="p">))</span>
<a id="__codelineno-477-11" name="__codelineno-477-11"></a><span class="p">}</span>
<a id="__codelineno-477-12" name="__codelineno-477-12"></a>
<a id="__codelineno-477-13" name="__codelineno-477-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-477-14" name="__codelineno-477-14"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-477-15" name="__codelineno-477-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-477-16" name="__codelineno-477-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 错误: 无法读取文件 data.txt: 文件不存在</span>
<a id="__codelineno-477-17" name="__codelineno-477-17"></a>
<a id="__codelineno-477-18" name="__codelineno-477-18"></a><span class="w">        </span><span class="c1">// 使用 errors.Is 检查错误</span>
<a id="__codelineno-477-19" name="__codelineno-477-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;文件不存在&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-477-20" name="__codelineno-477-20"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;确认错误是文件不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-477-21" name="__codelineno-477-21"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-477-22" name="__codelineno-477-22"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误类型未知&quot;</span><span class="p">)</span>
<a id="__codelineno-477-23" name="__codelineno-477-23"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-477-24" name="__codelineno-477-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-477-25" name="__codelineno-477-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-478-1">1</a></span>
<span class="normal"><a href="#__codelineno-478-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-478-1" name="__codelineno-478-1"></a>错误: 无法读取文件 data.txt: 文件不存在
<a id="__codelineno-478-2" name="__codelineno-478-2"></a>确认错误是文件不存在
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>fmt.Errorf</code>使用<code>%w</code>动词包装了一个基础错误，使得错误可以被进一步检查和处理。</li>
<li><code>errors.Is</code>用于检查错误链中是否包含特定的错误。</li>
</ul>
<h3 id="102-panic-和-recover">10.2 <code>panic</code> 和 <code>recover</code><a class="headerlink" href="#102-panic-和-recover" title="Permanent link">&para;</a></h3>
<p>Go语言中的<code>panic</code>和<code>recover</code>机制用于处理严重的运行时错误和异常情况。虽然Go提倡通过返回错误值来处理大多数错误，但在某些极端情况下，<code>panic</code>和<code>recover</code>提供了一种机制来控制程序的崩溃和错误恢复。</p>
<h4 id="panic"><code>panic</code><a class="headerlink" href="#panic" title="Permanent link">&para;</a></h4>
<p><code>panic</code>函数用于引发一个运行时错误，导致程序的正常执行流程被中断。当<code>panic</code>被调用时，程序开始逐层回溯调用栈，执行任何已注册的<code>defer</code>函数，直到程序崩溃。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-479-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-479-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-479-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-479-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-479-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-479-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-479-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-479-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-479-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-479-10">10</a></span>
<span class="normal"><a href="#__codelineno-479-11">11</a></span>
<span class="normal"><a href="#__codelineno-479-12">12</a></span>
<span class="normal"><a href="#__codelineno-479-13">13</a></span>
<span class="normal"><a href="#__codelineno-479-14">14</a></span>
<span class="normal"><a href="#__codelineno-479-15">15</a></span>
<span class="normal"><a href="#__codelineno-479-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-479-1" name="__codelineno-479-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-479-2" name="__codelineno-479-2"></a>
<a id="__codelineno-479-3" name="__codelineno-479-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-479-4" name="__codelineno-479-4"></a>
<a id="__codelineno-479-5" name="__codelineno-479-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">mayPanic</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-479-6" name="__codelineno-479-6"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;mayPanic 的 defer&quot;</span><span class="p">)</span>
<a id="__codelineno-479-7" name="__codelineno-479-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;mayPanic 开始&quot;</span><span class="p">)</span>
<a id="__codelineno-479-8" name="__codelineno-479-8"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;发生严重错误&quot;</span><span class="p">)</span>
<a id="__codelineno-479-9" name="__codelineno-479-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;mayPanic 结束&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 这一行不会执行</span>
<a id="__codelineno-479-10" name="__codelineno-479-10"></a><span class="p">}</span>
<a id="__codelineno-479-11" name="__codelineno-479-11"></a>
<a id="__codelineno-479-12" name="__codelineno-479-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-479-13" name="__codelineno-479-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;程序开始&quot;</span><span class="p">)</span>
<a id="__codelineno-479-14" name="__codelineno-479-14"></a><span class="w">    </span><span class="nx">mayPanic</span><span class="p">()</span>
<a id="__codelineno-479-15" name="__codelineno-479-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;程序结束&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 这一行不会执行</span>
<a id="__codelineno-479-16" name="__codelineno-479-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-480-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-480-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-480-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-480-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-480-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-480-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-480-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-480-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-480-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-480-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-480-1" name="__codelineno-480-1"></a>程序开始
<a id="__codelineno-480-2" name="__codelineno-480-2"></a>mayPanic 开始
<a id="__codelineno-480-3" name="__codelineno-480-3"></a>mayPanic 的 defer
<a id="__codelineno-480-4" name="__codelineno-480-4"></a>panic: 发生严重错误
<a id="__codelineno-480-5" name="__codelineno-480-5"></a>
<a id="__codelineno-480-6" name="__codelineno-480-6"></a>goroutine 1 [running]:
<a id="__codelineno-480-7" name="__codelineno-480-7"></a>main.mayPanic()
<a id="__codelineno-480-8" name="__codelineno-480-8"></a>        /path/to/main.go:9 +0x39
<a id="__codelineno-480-9" name="__codelineno-480-9"></a>main.main()
<a id="__codelineno-480-10" name="__codelineno-480-10"></a>        /path/to/main.go:14 +0x20
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>mayPanic</code>函数调用<code>panic</code>，导致程序中断。</li>
<li><code>defer</code>函数仍然会被执行，打印"mayPanic 的 defer"。</li>
<li>主函数中的"程序结束"不会被打印，因为程序已经崩溃。</li>
</ul>
<h4 id="recover"><code>recover</code><a class="headerlink" href="#recover" title="Permanent link">&para;</a></h4>
<p><code>recover</code>函数用于从<code>panic</code>中恢复，防止程序崩溃。<code>recover</code>只能在<code>defer</code>函数中有效，通常与<code>panic</code>配合使用，以实现优雅的错误处理。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-481-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-481-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-481-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-481-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-481-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-481-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-481-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-481-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-481-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-481-10">10</a></span>
<span class="normal"><a href="#__codelineno-481-11">11</a></span>
<span class="normal"><a href="#__codelineno-481-12">12</a></span>
<span class="normal"><a href="#__codelineno-481-13">13</a></span>
<span class="normal"><a href="#__codelineno-481-14">14</a></span>
<span class="normal"><a href="#__codelineno-481-15">15</a></span>
<span class="normal"><a href="#__codelineno-481-16">16</a></span>
<span class="normal"><a href="#__codelineno-481-17">17</a></span>
<span class="normal"><a href="#__codelineno-481-18">18</a></span>
<span class="normal"><a href="#__codelineno-481-19">19</a></span>
<span class="normal"><a href="#__codelineno-481-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-481-1" name="__codelineno-481-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-481-2" name="__codelineno-481-2"></a>
<a id="__codelineno-481-3" name="__codelineno-481-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-481-4" name="__codelineno-481-4"></a>
<a id="__codelineno-481-5" name="__codelineno-481-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">safeFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-481-6" name="__codelineno-481-6"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-481-7" name="__codelineno-481-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-481-8" name="__codelineno-481-8"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;捕获到panic:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-481-9" name="__codelineno-481-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-481-10" name="__codelineno-481-10"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-481-11" name="__codelineno-481-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;safeFunction 开始&quot;</span><span class="p">)</span>
<a id="__codelineno-481-12" name="__codelineno-481-12"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;发生严重错误&quot;</span><span class="p">)</span>
<a id="__codelineno-481-13" name="__codelineno-481-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;safeFunction 结束&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 这一行不会执行</span>
<a id="__codelineno-481-14" name="__codelineno-481-14"></a><span class="p">}</span>
<a id="__codelineno-481-15" name="__codelineno-481-15"></a>
<a id="__codelineno-481-16" name="__codelineno-481-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-481-17" name="__codelineno-481-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;程序开始&quot;</span><span class="p">)</span>
<a id="__codelineno-481-18" name="__codelineno-481-18"></a><span class="w">    </span><span class="nx">safeFunction</span><span class="p">()</span>
<a id="__codelineno-481-19" name="__codelineno-481-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;程序结束&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// 这一行会执行</span>
<a id="__codelineno-481-20" name="__codelineno-481-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-482-1">1</a></span>
<span class="normal"><a href="#__codelineno-482-2">2</a></span>
<span class="normal"><a href="#__codelineno-482-3">3</a></span>
<span class="normal"><a href="#__codelineno-482-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-482-1" name="__codelineno-482-1"></a>程序开始
<a id="__codelineno-482-2" name="__codelineno-482-2"></a>safeFunction 开始
<a id="__codelineno-482-3" name="__codelineno-482-3"></a>捕获到panic: 发生严重错误
<a id="__codelineno-482-4" name="__codelineno-482-4"></a>程序结束
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>safeFunction</code>中的<code>defer</code>函数调用<code>recover</code>，捕获了<code>panic</code>，防止程序崩溃。</li>
<li>程序继续执行，打印"程序结束"。</li>
</ul>
<p><strong>使用场景：</strong></p>
<ul>
<li><strong>不可恢复的错误</strong>：在遇到程序无法继续执行的严重错误时，可以使用<code>panic</code>。</li>
<li><strong>保护关键代码</strong>：在关键代码段中使用<code>recover</code>保护程序不被<code>panic</code>中断。</li>
<li><strong>测试</strong>：在测试中，可以使用<code>panic</code>来模拟错误情况。</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li><strong>滥用<code>panic</code></strong>：应避免在普通错误处理中使用<code>panic</code>，因为它会中断程序的正常流程。优先使用返回错误值的方式处理错误。</li>
<li><strong><code>recover</code>只能在<code>defer</code>中调用</strong>：尝试在非<code>defer</code>函数中调用<code>recover</code>将不起作用。</li>
<li><strong>代码可读性</strong>：频繁使用<code>panic</code>和<code>recover</code>可能降低代码的可读性和可维护性，应谨慎使用。</li>
</ul>
<h3 id="103-错误处理模式">10.3 错误处理模式<a class="headerlink" href="#103-错误处理模式" title="Permanent link">&para;</a></h3>
<p>Go语言鼓励通过显式返回错误值来处理错误，避免了异常机制带来的复杂性和不可预测性。然而，在实际开发中，可能需要更高级的错误处理策略，如错误封装和聚合。以下是Go中常见的错误处理模式。</p>
<h4 id="返回错误">返回错误<a class="headerlink" href="#返回错误" title="Permanent link">&para;</a></h4>
<p>最基本的错误处理模式是通过函数返回错误值。每个可能出错的操作都返回一个<code>error</code>，调用者根据错误值决定下一步操作。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-483-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-483-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-483-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-483-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-483-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-483-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-483-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-483-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-483-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-483-10">10</a></span>
<span class="normal"><a href="#__codelineno-483-11">11</a></span>
<span class="normal"><a href="#__codelineno-483-12">12</a></span>
<span class="normal"><a href="#__codelineno-483-13">13</a></span>
<span class="normal"><a href="#__codelineno-483-14">14</a></span>
<span class="normal"><a href="#__codelineno-483-15">15</a></span>
<span class="normal"><a href="#__codelineno-483-16">16</a></span>
<span class="normal"><a href="#__codelineno-483-17">17</a></span>
<span class="normal"><a href="#__codelineno-483-18">18</a></span>
<span class="normal"><a href="#__codelineno-483-19">19</a></span>
<span class="normal"><a href="#__codelineno-483-20">20</a></span>
<span class="normal"><a href="#__codelineno-483-21">21</a></span>
<span class="normal"><a href="#__codelineno-483-22">22</a></span>
<span class="normal"><a href="#__codelineno-483-23">23</a></span>
<span class="normal"><a href="#__codelineno-483-24">24</a></span>
<span class="normal"><a href="#__codelineno-483-25">25</a></span>
<span class="normal"><a href="#__codelineno-483-26">26</a></span>
<span class="normal"><a href="#__codelineno-483-27">27</a></span>
<span class="normal"><a href="#__codelineno-483-28">28</a></span>
<span class="normal"><a href="#__codelineno-483-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-483-1" name="__codelineno-483-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-483-2" name="__codelineno-483-2"></a>
<a id="__codelineno-483-3" name="__codelineno-483-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-483-4" name="__codelineno-483-4"></a><span class="w">    </span><span class="s">&quot;errors&quot;</span>
<a id="__codelineno-483-5" name="__codelineno-483-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-483-6" name="__codelineno-483-6"></a><span class="p">)</span>
<a id="__codelineno-483-7" name="__codelineno-483-7"></a>
<a id="__codelineno-483-8" name="__codelineno-483-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-483-9" name="__codelineno-483-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">filename</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-483-10" name="__codelineno-483-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;文件名不能为空&quot;</span><span class="p">)</span>
<a id="__codelineno-483-11" name="__codelineno-483-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-483-12" name="__codelineno-483-12"></a><span class="w">    </span><span class="c1">// 模拟文件读取</span>
<a id="__codelineno-483-13" name="__codelineno-483-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;文件内容&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-483-14" name="__codelineno-483-14"></a><span class="p">}</span>
<a id="__codelineno-483-15" name="__codelineno-483-15"></a>
<a id="__codelineno-483-16" name="__codelineno-483-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-483-17" name="__codelineno-483-17"></a><span class="w">    </span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-483-18" name="__codelineno-483-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-483-19" name="__codelineno-483-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-483-20" name="__codelineno-483-20"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-483-21" name="__codelineno-483-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-483-22" name="__codelineno-483-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件内容:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="p">)</span>
<a id="__codelineno-483-23" name="__codelineno-483-23"></a>
<a id="__codelineno-483-24" name="__codelineno-483-24"></a><span class="w">    </span><span class="c1">// 尝试读取空文件名</span>
<a id="__codelineno-483-25" name="__codelineno-483-25"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-483-26" name="__codelineno-483-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-483-27" name="__codelineno-483-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 读取文件失败: 文件名不能为空</span>
<a id="__codelineno-483-28" name="__codelineno-483-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-483-29" name="__codelineno-483-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-484-1">1</a></span>
<span class="normal"><a href="#__codelineno-484-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-484-1" name="__codelineno-484-1"></a>文件内容: 文件内容
<a id="__codelineno-484-2" name="__codelineno-484-2"></a>读取文件失败: 文件名不能为空
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>readFile</code>函数尝试读取文件，如果文件名为空，返回一个错误。</li>
<li>主函数根据返回的错误值决定是否继续执行。</li>
</ul>
<p><strong>优势：</strong></p>
<ul>
<li><strong>明确性</strong>：错误处理流程清晰，调用者明确知道每个函数可能出错。</li>
<li><strong>简洁性</strong>：避免了复杂的异常处理机制，使代码更易读。</li>
</ul>
<p><strong>劣势：</strong></p>
<ul>
<li><strong>重复性</strong>：每个可能出错的函数都需要显式检查错误，可能导致大量重复代码。</li>
<li><strong>链式错误处理</strong>：在多个函数调用中传递错误可能变得繁琐。</li>
</ul>
<h4 id="使用封装工具处理">使用封装工具处理<a class="headerlink" href="#使用封装工具处理" title="Permanent link">&para;</a></h4>
<p>为了减少重复的错误处理代码，Go社区开发了多种错误处理封装工具和库。这些工具提供了更简洁的错误处理方式，如错误链式包装、堆栈跟踪等。</p>
<h5 id="使用fmterrorf和w进行错误包装">使用<code>fmt.Errorf</code>和<code>%w</code>进行错误包装<a class="headerlink" href="#使用fmterrorf和w进行错误包装" title="Permanent link">&para;</a></h5>
<p>Go 1.13引入了<code>%w</code>动词，允许在创建错误时包装原始错误，实现错误的链式包装。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-485-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-485-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-485-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-485-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-485-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-485-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-485-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-485-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-485-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-485-10">10</a></span>
<span class="normal"><a href="#__codelineno-485-11">11</a></span>
<span class="normal"><a href="#__codelineno-485-12">12</a></span>
<span class="normal"><a href="#__codelineno-485-13">13</a></span>
<span class="normal"><a href="#__codelineno-485-14">14</a></span>
<span class="normal"><a href="#__codelineno-485-15">15</a></span>
<span class="normal"><a href="#__codelineno-485-16">16</a></span>
<span class="normal"><a href="#__codelineno-485-17">17</a></span>
<span class="normal"><a href="#__codelineno-485-18">18</a></span>
<span class="normal"><a href="#__codelineno-485-19">19</a></span>
<span class="normal"><a href="#__codelineno-485-20">20</a></span>
<span class="normal"><a href="#__codelineno-485-21">21</a></span>
<span class="normal"><a href="#__codelineno-485-22">22</a></span>
<span class="normal"><a href="#__codelineno-485-23">23</a></span>
<span class="normal"><a href="#__codelineno-485-24">24</a></span>
<span class="normal"><a href="#__codelineno-485-25">25</a></span>
<span class="normal"><a href="#__codelineno-485-26">26</a></span>
<span class="normal"><a href="#__codelineno-485-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-485-1" name="__codelineno-485-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-485-2" name="__codelineno-485-2"></a>
<a id="__codelineno-485-3" name="__codelineno-485-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-485-4" name="__codelineno-485-4"></a><span class="w">    </span><span class="s">&quot;errors&quot;</span>
<a id="__codelineno-485-5" name="__codelineno-485-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-485-6" name="__codelineno-485-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-485-7" name="__codelineno-485-7"></a><span class="p">)</span>
<a id="__codelineno-485-8" name="__codelineno-485-8"></a>
<a id="__codelineno-485-9" name="__codelineno-485-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">readConfig</span><span class="p">(</span><span class="nx">file</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-485-10" name="__codelineno-485-10"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-485-11" name="__codelineno-485-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-485-12" name="__codelineno-485-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;读取配置文件失败: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-485-13" name="__codelineno-485-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-485-14" name="__codelineno-485-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-485-15" name="__codelineno-485-15"></a><span class="p">}</span>
<a id="__codelineno-485-16" name="__codelineno-485-16"></a>
<a id="__codelineno-485-17" name="__codelineno-485-17"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-485-18" name="__codelineno-485-18"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readConfig</span><span class="p">(</span><span class="s">&quot;config.yaml&quot;</span><span class="p">)</span>
<a id="__codelineno-485-19" name="__codelineno-485-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-485-20" name="__codelineno-485-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出: 错误: 读取配置文件失败: open config.yaml: no such file or directory</span>
<a id="__codelineno-485-21" name="__codelineno-485-21"></a>
<a id="__codelineno-485-22" name="__codelineno-485-22"></a><span class="w">        </span><span class="c1">// 使用 errors.Is 检查错误</span>
<a id="__codelineno-485-23" name="__codelineno-485-23"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">ErrNotExist</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-485-24" name="__codelineno-485-24"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;配置文件不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-485-25" name="__codelineno-485-25"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-485-26" name="__codelineno-485-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-485-27" name="__codelineno-485-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-486-1">1</a></span>
<span class="normal"><a href="#__codelineno-486-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-486-1" name="__codelineno-486-1"></a>错误: 读取配置文件失败: open config.yaml: no such file or directory
<a id="__codelineno-486-2" name="__codelineno-486-2"></a>配置文件不存在
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>readConfig</code>函数在打开文件失败时，通过<code>fmt.Errorf</code>包装原始错误。</li>
<li>主函数通过<code>errors.Is</code>检查错误是否是<code>os.ErrNotExist</code>，从而做出相应的处理。</li>
</ul>
<h5 id="使用第三方库进行错误处理">使用第三方库进行错误处理<a class="headerlink" href="#使用第三方库进行错误处理" title="Permanent link">&para;</a></h5>
<p>除了标准库提供的工具，Go社区还开发了多种第三方错误处理库，如<code>pkg/errors</code>（已被标准库的功能取代）、<code>emperror</code>、<code>errors</code>等。这些库提供了更丰富的错误处理功能，如堆栈跟踪、错误链等。</p>
<p><strong>示例使用<code>github.com/pkg/errors</code>：</strong></p>
<blockquote>
<p><strong>注意：</strong> 从Go 1.13开始，许多<code>pkg/errors</code>的功能已经被标准库所覆盖，推荐优先使用标准库的功能。</p>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-487-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-487-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-487-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-487-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-487-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-487-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-487-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-487-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-487-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-487-10">10</a></span>
<span class="normal"><a href="#__codelineno-487-11">11</a></span>
<span class="normal"><a href="#__codelineno-487-12">12</a></span>
<span class="normal"><a href="#__codelineno-487-13">13</a></span>
<span class="normal"><a href="#__codelineno-487-14">14</a></span>
<span class="normal"><a href="#__codelineno-487-15">15</a></span>
<span class="normal"><a href="#__codelineno-487-16">16</a></span>
<span class="normal"><a href="#__codelineno-487-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-487-1" name="__codelineno-487-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-487-2" name="__codelineno-487-2"></a>
<a id="__codelineno-487-3" name="__codelineno-487-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-487-4" name="__codelineno-487-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-487-5" name="__codelineno-487-5"></a><span class="w">    </span><span class="s">&quot;github.com/pkg/errors&quot;</span>
<a id="__codelineno-487-6" name="__codelineno-487-6"></a><span class="p">)</span>
<a id="__codelineno-487-7" name="__codelineno-487-7"></a>
<a id="__codelineno-487-8" name="__codelineno-487-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="nx">file</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-487-9" name="__codelineno-487-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;文件不存在&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;读取文件失败&quot;</span><span class="p">)</span>
<a id="__codelineno-487-10" name="__codelineno-487-10"></a><span class="p">}</span>
<a id="__codelineno-487-11" name="__codelineno-487-11"></a>
<a id="__codelineno-487-12" name="__codelineno-487-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-487-13" name="__codelineno-487-13"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-487-14" name="__codelineno-487-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-487-15" name="__codelineno-487-15"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;错误: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-487-16" name="__codelineno-487-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-487-17" name="__codelineno-487-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-488-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-488-1" name="__codelineno-488-1"></a>错误: 读取文件失败: 文件不存在
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>errors.Wrap</code>用于包装原始错误，添加上下文信息。</li>
<li>使用<code>%+v</code>格式化错误，可以获得详细的错误信息和堆栈跟踪（具体取决于库的实现）。</li>
</ul>
<h5 id="使用errorsas进行错误类型转换">使用<code>errors.As</code>进行错误类型转换<a class="headerlink" href="#使用errorsas进行错误类型转换" title="Permanent link">&para;</a></h5>
<p><code>errors.As</code>允许将错误转换为特定的自定义错误类型，便于提取更多的错误信息。</p>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-489-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-489-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-489-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-489-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-489-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-489-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-489-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-489-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-489-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-489-10">10</a></span>
<span class="normal"><a href="#__codelineno-489-11">11</a></span>
<span class="normal"><a href="#__codelineno-489-12">12</a></span>
<span class="normal"><a href="#__codelineno-489-13">13</a></span>
<span class="normal"><a href="#__codelineno-489-14">14</a></span>
<span class="normal"><a href="#__codelineno-489-15">15</a></span>
<span class="normal"><a href="#__codelineno-489-16">16</a></span>
<span class="normal"><a href="#__codelineno-489-17">17</a></span>
<span class="normal"><a href="#__codelineno-489-18">18</a></span>
<span class="normal"><a href="#__codelineno-489-19">19</a></span>
<span class="normal"><a href="#__codelineno-489-20">20</a></span>
<span class="normal"><a href="#__codelineno-489-21">21</a></span>
<span class="normal"><a href="#__codelineno-489-22">22</a></span>
<span class="normal"><a href="#__codelineno-489-23">23</a></span>
<span class="normal"><a href="#__codelineno-489-24">24</a></span>
<span class="normal"><a href="#__codelineno-489-25">25</a></span>
<span class="normal"><a href="#__codelineno-489-26">26</a></span>
<span class="normal"><a href="#__codelineno-489-27">27</a></span>
<span class="normal"><a href="#__codelineno-489-28">28</a></span>
<span class="normal"><a href="#__codelineno-489-29">29</a></span>
<span class="normal"><a href="#__codelineno-489-30">30</a></span>
<span class="normal"><a href="#__codelineno-489-31">31</a></span>
<span class="normal"><a href="#__codelineno-489-32">32</a></span>
<span class="normal"><a href="#__codelineno-489-33">33</a></span>
<span class="normal"><a href="#__codelineno-489-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-489-1" name="__codelineno-489-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-489-2" name="__codelineno-489-2"></a>
<a id="__codelineno-489-3" name="__codelineno-489-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-489-4" name="__codelineno-489-4"></a><span class="w">    </span><span class="s">&quot;errors&quot;</span>
<a id="__codelineno-489-5" name="__codelineno-489-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-489-6" name="__codelineno-489-6"></a><span class="p">)</span>
<a id="__codelineno-489-7" name="__codelineno-489-7"></a>
<a id="__codelineno-489-8" name="__codelineno-489-8"></a><span class="kd">type</span><span class="w"> </span><span class="nx">MyError</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-9" name="__codelineno-489-9"></a><span class="w">    </span><span class="nx">Code</span><span class="w">    </span><span class="kt">int</span>
<a id="__codelineno-489-10" name="__codelineno-489-10"></a><span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-489-11" name="__codelineno-489-11"></a><span class="p">}</span>
<a id="__codelineno-489-12" name="__codelineno-489-12"></a>
<a id="__codelineno-489-13" name="__codelineno-489-13"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">*</span><span class="nx">MyError</span><span class="p">)</span><span class="w"> </span><span class="nx">Error</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-14" name="__codelineno-489-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;错误代码 %d: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
<a id="__codelineno-489-15" name="__codelineno-489-15"></a><span class="p">}</span>
<a id="__codelineno-489-16" name="__codelineno-489-16"></a>
<a id="__codelineno-489-17" name="__codelineno-489-17"></a><span class="kd">func</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">flag</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-18" name="__codelineno-489-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">flag</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-19" name="__codelineno-489-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MyError</span><span class="p">{</span><span class="nx">Code</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;内部服务器错误&quot;</span><span class="p">}</span>
<a id="__codelineno-489-20" name="__codelineno-489-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-489-21" name="__codelineno-489-21"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-489-22" name="__codelineno-489-22"></a><span class="p">}</span>
<a id="__codelineno-489-23" name="__codelineno-489-23"></a>
<a id="__codelineno-489-24" name="__codelineno-489-24"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-25" name="__codelineno-489-25"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">doSomething</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<a id="__codelineno-489-26" name="__codelineno-489-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-27" name="__codelineno-489-27"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">myErr</span><span class="w"> </span><span class="o">*</span><span class="nx">MyError</span>
<a id="__codelineno-489-28" name="__codelineno-489-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">As</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">myErr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-29" name="__codelineno-489-29"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;捕获到自定义错误 - 代码: %d, 信息: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myErr</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span><span class="w"> </span><span class="nx">myErr</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
<a id="__codelineno-489-30" name="__codelineno-489-30"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-489-31" name="__codelineno-489-31"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;普通错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-489-32" name="__codelineno-489-32"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-489-33" name="__codelineno-489-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-489-34" name="__codelineno-489-34"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-490-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-490-1" name="__codelineno-490-1"></a>捕获到自定义错误 - 代码: 500, 信息: 内部服务器错误
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>errors.As</code>尝试将错误转换为<code>*MyError</code>类型，如果成功，可以访问自定义错误的字段。</li>
<li>这种方式允许在错误处理时提取更多的上下文信息。</li>
</ul>
<h4 id="错误处理模式的选择">错误处理模式的选择<a class="headerlink" href="#错误处理模式的选择" title="Permanent link">&para;</a></h4>
<p>选择合适的错误处理模式取决于应用的复杂性和需求。以下是一些常见的模式及其适用场景：</p>
<ol>
<li><strong>简单返回错误</strong>：</li>
<li>适用于小型项目或简单的错误处理需求。</li>
<li>优点：简单、直观。</li>
<li>缺点：可能导致大量重复代码。</li>
<li><strong>错误包装和链式处理</strong>：</li>
<li>适用于需要保留错误上下文信息的中大型项目。</li>
<li>优点：提供更丰富的错误信息，便于调试和日志记录。</li>
<li>缺点：需要理解错误包装和解包机制。</li>
<li><strong>使用第三方错误处理库</strong>：</li>
<li>适用于需要高级错误处理功能的项目，如堆栈跟踪、错误聚合等。</li>
<li>优点：提供强大的错误处理功能，提升开发效率。</li>
<li>缺点：增加了外部依赖，可能影响项目的可维护性。</li>
</ol>
<p><strong>最佳实践：</strong></p>
<ul>
<li><strong>优先使用标准库</strong>：Go的标准库已经提供了足够的错误处理工具，尽量避免引入不必要的第三方库。</li>
<li><strong>保持错误信息的清晰和一致</strong>：确保错误信息简洁明了，便于理解和调试。</li>
<li><strong>避免忽略错误</strong>：每个可能返回错误的函数调用都应检查和处理错误，防止隐藏问题。</li>
<li><strong>使用自定义错误类型适度</strong>：仅在需要额外上下文信息或特定错误处理逻辑时创建自定义错误类型。</li>
</ul>
<h2 id="11-文件操作">11. 文件操作<a class="headerlink" href="#11-文件操作" title="Permanent link">&para;</a></h2>
<p>文件操作是大多数应用程序中不可或缺的部分，无论是读取配置文件、记录日志还是处理用户数据。Go语言提供了强大且简洁的内置库来处理文件和文件夹操作。本章将详细介绍Go语言中的文件操作，包括文件的打开与关闭、读取与写入、文件夹的创建与删除以及遍历文件夹和获取文件信息。通过丰富的示例和深入的解释，帮助你掌握在Go中高效处理文件系统的技巧。</p>
<h3 id="111-文件读写">11.1 文件读写<a class="headerlink" href="#111-文件读写" title="Permanent link">&para;</a></h3>
<p>文件读写是文件操作中最基本的功能，包括打开文件、关闭文件、读取文件内容和写入数据到文件。Go语言的<code>os</code>和<code>io/ioutil</code>包提供了丰富的函数来实现这些操作。</p>
<h4 id="打开与关闭文件">打开与关闭文件<a class="headerlink" href="#打开与关闭文件" title="Permanent link">&para;</a></h4>
<p>在Go中，打开和关闭文件通常使用<code>os</code>包中的函数。打开文件可以用于读取、写入或追加数据，而关闭文件则是确保资源被正确释放的重要步骤。</p>
<p><strong>1. 使用<code>os.Open</code>打开文件</strong></p>
<p><code>os.Open</code>函数用于以只读模式打开文件，返回一个文件指针和可能的错误。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-491-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-491-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-491-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-491-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-491-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-491-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-491-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-491-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-491-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-491-10">10</a></span>
<span class="normal"><a href="#__codelineno-491-11">11</a></span>
<span class="normal"><a href="#__codelineno-491-12">12</a></span>
<span class="normal"><a href="#__codelineno-491-13">13</a></span>
<span class="normal"><a href="#__codelineno-491-14">14</a></span>
<span class="normal"><a href="#__codelineno-491-15">15</a></span>
<span class="normal"><a href="#__codelineno-491-16">16</a></span>
<span class="normal"><a href="#__codelineno-491-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-491-1" name="__codelineno-491-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-491-2" name="__codelineno-491-2"></a>
<a id="__codelineno-491-3" name="__codelineno-491-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-491-4" name="__codelineno-491-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-491-5" name="__codelineno-491-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-491-6" name="__codelineno-491-6"></a><span class="p">)</span>
<a id="__codelineno-491-7" name="__codelineno-491-7"></a>
<a id="__codelineno-491-8" name="__codelineno-491-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-491-9" name="__codelineno-491-9"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-491-10" name="__codelineno-491-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-491-11" name="__codelineno-491-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;打开文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-491-12" name="__codelineno-491-12"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-491-13" name="__codelineno-491-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-491-14" name="__codelineno-491-14"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span><span class="c1">// 确保文件在函数结束时关闭</span>
<a id="__codelineno-491-15" name="__codelineno-491-15"></a>
<a id="__codelineno-491-16" name="__codelineno-491-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件打开成功&quot;</span><span class="p">)</span>
<a id="__codelineno-491-17" name="__codelineno-491-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Open</code>尝试打开名为<code>example.txt</code>的文件。</li>
<li>如果打开失败，程序会输出错误信息并返回。</li>
<li>使用<code>defer file.Close()</code>确保文件在<code>main</code>函数结束时被关闭，避免资源泄漏。</li>
</ul>
<p><strong>2. 使用<code>os.Create</code>创建或截断文件</strong></p>
<p><code>os.Create</code>函数用于创建一个新文件，如果文件已存在，则截断其内容。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-492-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-492-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-492-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-492-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-492-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-492-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-492-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-492-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-492-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-492-10">10</a></span>
<span class="normal"><a href="#__codelineno-492-11">11</a></span>
<span class="normal"><a href="#__codelineno-492-12">12</a></span>
<span class="normal"><a href="#__codelineno-492-13">13</a></span>
<span class="normal"><a href="#__codelineno-492-14">14</a></span>
<span class="normal"><a href="#__codelineno-492-15">15</a></span>
<span class="normal"><a href="#__codelineno-492-16">16</a></span>
<span class="normal"><a href="#__codelineno-492-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-492-1" name="__codelineno-492-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-492-2" name="__codelineno-492-2"></a>
<a id="__codelineno-492-3" name="__codelineno-492-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-492-4" name="__codelineno-492-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-492-5" name="__codelineno-492-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-492-6" name="__codelineno-492-6"></a><span class="p">)</span>
<a id="__codelineno-492-7" name="__codelineno-492-7"></a>
<a id="__codelineno-492-8" name="__codelineno-492-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-492-9" name="__codelineno-492-9"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;newfile.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-492-10" name="__codelineno-492-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-492-11" name="__codelineno-492-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-492-12" name="__codelineno-492-12"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-492-13" name="__codelineno-492-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-492-14" name="__codelineno-492-14"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-492-15" name="__codelineno-492-15"></a>
<a id="__codelineno-492-16" name="__codelineno-492-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件创建成功&quot;</span><span class="p">)</span>
<a id="__codelineno-492-17" name="__codelineno-492-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Create</code>创建一个名为<code>newfile.txt</code>的新文件。</li>
<li>如果文件已存在，其内容会被清空。</li>
<li>同样使用<code>defer</code>确保文件被关闭。</li>
</ul>
<p><strong>3. 以不同模式打开文件</strong></p>
<p>使用<code>os.OpenFile</code>可以以不同的模式打开文件，如读取、写入、追加等。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-493-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-493-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-493-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-493-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-493-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-493-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-493-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-493-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-493-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-493-10">10</a></span>
<span class="normal"><a href="#__codelineno-493-11">11</a></span>
<span class="normal"><a href="#__codelineno-493-12">12</a></span>
<span class="normal"><a href="#__codelineno-493-13">13</a></span>
<span class="normal"><a href="#__codelineno-493-14">14</a></span>
<span class="normal"><a href="#__codelineno-493-15">15</a></span>
<span class="normal"><a href="#__codelineno-493-16">16</a></span>
<span class="normal"><a href="#__codelineno-493-17">17</a></span>
<span class="normal"><a href="#__codelineno-493-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-493-1" name="__codelineno-493-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-493-2" name="__codelineno-493-2"></a>
<a id="__codelineno-493-3" name="__codelineno-493-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-493-4" name="__codelineno-493-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-493-5" name="__codelineno-493-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-493-6" name="__codelineno-493-6"></a><span class="p">)</span>
<a id="__codelineno-493-7" name="__codelineno-493-7"></a>
<a id="__codelineno-493-8" name="__codelineno-493-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-493-9" name="__codelineno-493-9"></a><span class="w">    </span><span class="c1">// 以读取和写入模式打开文件，如果文件不存在则创建</span>
<a id="__codelineno-493-10" name="__codelineno-493-10"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_RDWR</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>
<a id="__codelineno-493-11" name="__codelineno-493-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-493-12" name="__codelineno-493-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;打开文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-493-13" name="__codelineno-493-13"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-493-14" name="__codelineno-493-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-493-15" name="__codelineno-493-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-493-16" name="__codelineno-493-16"></a>
<a id="__codelineno-493-17" name="__codelineno-493-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件以读写模式打开或创建成功&quot;</span><span class="p">)</span>
<a id="__codelineno-493-18" name="__codelineno-493-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.OpenFile</code>允许指定打开文件的模式和权限。</li>
<li><code>os.O_RDWR</code>表示以读写模式打开文件。</li>
<li><code>os.O_CREATE</code>表示如果文件不存在，则创建文件。</li>
<li><code>0755</code>是文件的权限设置，表示所有者有读、写、执行权限，组用户和其他用户有读、执行权限。</li>
</ul>
<h4 id="文件的读取与写入">文件的读取与写入<a class="headerlink" href="#文件的读取与写入" title="Permanent link">&para;</a></h4>
<p>Go语言提供了多种方式来读取和写入文件，包括使用<code>io</code>包和<code>bufio</code>包。以下是一些常用的方法和示例。</p>
<p><strong>1. 使用<code>io/ioutil</code>读取整个文件内容</strong></p>
<p><code>ioutil.ReadFile</code>函数用于一次性读取整个文件的内容，适用于小文件。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-494-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-494-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-494-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-494-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-494-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-494-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-494-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-494-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-494-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-494-10">10</a></span>
<span class="normal"><a href="#__codelineno-494-11">11</a></span>
<span class="normal"><a href="#__codelineno-494-12">12</a></span>
<span class="normal"><a href="#__codelineno-494-13">13</a></span>
<span class="normal"><a href="#__codelineno-494-14">14</a></span>
<span class="normal"><a href="#__codelineno-494-15">15</a></span>
<span class="normal"><a href="#__codelineno-494-16">16</a></span>
<span class="normal"><a href="#__codelineno-494-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-494-1" name="__codelineno-494-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-494-2" name="__codelineno-494-2"></a>
<a id="__codelineno-494-3" name="__codelineno-494-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-494-4" name="__codelineno-494-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-494-5" name="__codelineno-494-5"></a><span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<a id="__codelineno-494-6" name="__codelineno-494-6"></a><span class="p">)</span>
<a id="__codelineno-494-7" name="__codelineno-494-7"></a>
<a id="__codelineno-494-8" name="__codelineno-494-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-494-9" name="__codelineno-494-9"></a><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-494-10" name="__codelineno-494-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-494-11" name="__codelineno-494-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-494-12" name="__codelineno-494-12"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-494-13" name="__codelineno-494-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-494-14" name="__codelineno-494-14"></a>
<a id="__codelineno-494-15" name="__codelineno-494-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件内容:&quot;</span><span class="p">)</span>
<a id="__codelineno-494-16" name="__codelineno-494-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-494-17" name="__codelineno-494-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-495-1">1</a></span>
<span class="normal"><a href="#__codelineno-495-2">2</a></span>
<span class="normal"><a href="#__codelineno-495-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-495-1" name="__codelineno-495-1"></a>文件内容:
<a id="__codelineno-495-2" name="__codelineno-495-2"></a>Hello, Go!
<a id="__codelineno-495-3" name="__codelineno-495-3"></a>This is an example file.
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>ioutil.ReadFile</code>读取<code>example.txt</code>的全部内容。</li>
<li>返回的<code>data</code>是一个字节切片，需要转换为字符串进行打印。</li>
</ul>
<p><strong>2. 使用<code>bufio</code>逐行读取文件</strong></p>
<p>对于较大的文件，逐行读取更为高效，避免一次性加载整个文件到内存。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-496-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-496-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-496-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-496-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-496-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-496-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-496-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-496-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-496-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-496-10">10</a></span>
<span class="normal"><a href="#__codelineno-496-11">11</a></span>
<span class="normal"><a href="#__codelineno-496-12">12</a></span>
<span class="normal"><a href="#__codelineno-496-13">13</a></span>
<span class="normal"><a href="#__codelineno-496-14">14</a></span>
<span class="normal"><a href="#__codelineno-496-15">15</a></span>
<span class="normal"><a href="#__codelineno-496-16">16</a></span>
<span class="normal"><a href="#__codelineno-496-17">17</a></span>
<span class="normal"><a href="#__codelineno-496-18">18</a></span>
<span class="normal"><a href="#__codelineno-496-19">19</a></span>
<span class="normal"><a href="#__codelineno-496-20">20</a></span>
<span class="normal"><a href="#__codelineno-496-21">21</a></span>
<span class="normal"><a href="#__codelineno-496-22">22</a></span>
<span class="normal"><a href="#__codelineno-496-23">23</a></span>
<span class="normal"><a href="#__codelineno-496-24">24</a></span>
<span class="normal"><a href="#__codelineno-496-25">25</a></span>
<span class="normal"><a href="#__codelineno-496-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-496-1" name="__codelineno-496-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-496-2" name="__codelineno-496-2"></a>
<a id="__codelineno-496-3" name="__codelineno-496-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-496-4" name="__codelineno-496-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-496-5" name="__codelineno-496-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-496-6" name="__codelineno-496-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-496-7" name="__codelineno-496-7"></a><span class="p">)</span>
<a id="__codelineno-496-8" name="__codelineno-496-8"></a>
<a id="__codelineno-496-9" name="__codelineno-496-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-496-10" name="__codelineno-496-10"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-496-11" name="__codelineno-496-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-496-12" name="__codelineno-496-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;打开文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-496-13" name="__codelineno-496-13"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-496-14" name="__codelineno-496-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-496-15" name="__codelineno-496-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-496-16" name="__codelineno-496-16"></a>
<a id="__codelineno-496-17" name="__codelineno-496-17"></a><span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-496-18" name="__codelineno-496-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件内容:&quot;</span><span class="p">)</span>
<a id="__codelineno-496-19" name="__codelineno-496-19"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-496-20" name="__codelineno-496-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">())</span>
<a id="__codelineno-496-21" name="__codelineno-496-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-496-22" name="__codelineno-496-22"></a>
<a id="__codelineno-496-23" name="__codelineno-496-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-496-24" name="__codelineno-496-24"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取文件时出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-496-25" name="__codelineno-496-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-496-26" name="__codelineno-496-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-497-1">1</a></span>
<span class="normal"><a href="#__codelineno-497-2">2</a></span>
<span class="normal"><a href="#__codelineno-497-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-497-1" name="__codelineno-497-1"></a>文件内容:
<a id="__codelineno-497-2" name="__codelineno-497-2"></a>Hello, Go!
<a id="__codelineno-497-3" name="__codelineno-497-3"></a>This is an example file.
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>bufio.NewScanner</code>创建一个扫描器，用于逐行读取文件内容。</li>
<li><code>scanner.Scan()</code>逐行扫描，<code>scanner.Text()</code>返回当前行的内容。</li>
<li>检查<code>scanner.Err()</code>以捕捉读取过程中的任何错误。</li>
</ul>
<p><strong>3. 写入数据到文件</strong></p>
<p>使用<code>os.File</code>的<code>Write</code>和<code>WriteString</code>方法可以将数据写入文件。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-498-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-498-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-498-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-498-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-498-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-498-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-498-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-498-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-498-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-498-10">10</a></span>
<span class="normal"><a href="#__codelineno-498-11">11</a></span>
<span class="normal"><a href="#__codelineno-498-12">12</a></span>
<span class="normal"><a href="#__codelineno-498-13">13</a></span>
<span class="normal"><a href="#__codelineno-498-14">14</a></span>
<span class="normal"><a href="#__codelineno-498-15">15</a></span>
<span class="normal"><a href="#__codelineno-498-16">16</a></span>
<span class="normal"><a href="#__codelineno-498-17">17</a></span>
<span class="normal"><a href="#__codelineno-498-18">18</a></span>
<span class="normal"><a href="#__codelineno-498-19">19</a></span>
<span class="normal"><a href="#__codelineno-498-20">20</a></span>
<span class="normal"><a href="#__codelineno-498-21">21</a></span>
<span class="normal"><a href="#__codelineno-498-22">22</a></span>
<span class="normal"><a href="#__codelineno-498-23">23</a></span>
<span class="normal"><a href="#__codelineno-498-24">24</a></span>
<span class="normal"><a href="#__codelineno-498-25">25</a></span>
<span class="normal"><a href="#__codelineno-498-26">26</a></span>
<span class="normal"><a href="#__codelineno-498-27">27</a></span>
<span class="normal"><a href="#__codelineno-498-28">28</a></span>
<span class="normal"><a href="#__codelineno-498-29">29</a></span>
<span class="normal"><a href="#__codelineno-498-30">30</a></span>
<span class="normal"><a href="#__codelineno-498-31">31</a></span>
<span class="normal"><a href="#__codelineno-498-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-498-1" name="__codelineno-498-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-498-2" name="__codelineno-498-2"></a>
<a id="__codelineno-498-3" name="__codelineno-498-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-498-4" name="__codelineno-498-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-498-5" name="__codelineno-498-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-498-6" name="__codelineno-498-6"></a><span class="p">)</span>
<a id="__codelineno-498-7" name="__codelineno-498-7"></a>
<a id="__codelineno-498-8" name="__codelineno-498-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-498-9" name="__codelineno-498-9"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-498-10" name="__codelineno-498-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-498-11" name="__codelineno-498-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-498-12" name="__codelineno-498-12"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-498-13" name="__codelineno-498-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-498-14" name="__codelineno-498-14"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-498-15" name="__codelineno-498-15"></a>
<a id="__codelineno-498-16" name="__codelineno-498-16"></a><span class="w">    </span><span class="c1">// 写入字节数据</span>
<a id="__codelineno-498-17" name="__codelineno-498-17"></a><span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Hello, Go!\nThis is a new file.\n&quot;</span><span class="p">)</span>
<a id="__codelineno-498-18" name="__codelineno-498-18"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-498-19" name="__codelineno-498-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-498-20" name="__codelineno-498-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;写入数据失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-498-21" name="__codelineno-498-21"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-498-22" name="__codelineno-498-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-498-23" name="__codelineno-498-23"></a>
<a id="__codelineno-498-24" name="__codelineno-498-24"></a><span class="w">    </span><span class="c1">// 写入字符串数据</span>
<a id="__codelineno-498-25" name="__codelineno-498-25"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;追加一行文本。\n&quot;</span><span class="p">)</span>
<a id="__codelineno-498-26" name="__codelineno-498-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-498-27" name="__codelineno-498-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;写入字符串失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-498-28" name="__codelineno-498-28"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-498-29" name="__codelineno-498-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-498-30" name="__codelineno-498-30"></a>
<a id="__codelineno-498-31" name="__codelineno-498-31"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;数据写入成功&quot;</span><span class="p">)</span>
<a id="__codelineno-498-32" name="__codelineno-498-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-499-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-499-1" name="__codelineno-499-1"></a>数据写入成功
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>os.Create</code>创建或截断<code>output.txt</code>文件。</li>
<li>使用<code>file.Write</code>写入字节数据。</li>
<li>使用<code>file.WriteString</code>写入字符串数据。</li>
<li>确保通过<code>defer file.Close()</code>在函数结束时关闭文件。</li>
</ul>
<p><strong>4. 使用<code>bufio.Writer</code>高效写入</strong></p>
<p><code>bufio.Writer</code>提供了带缓冲的写入器，适用于频繁的写入操作，提高效率。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-500-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-500-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-500-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-500-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-500-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-500-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-500-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-500-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-500-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-500-10">10</a></span>
<span class="normal"><a href="#__codelineno-500-11">11</a></span>
<span class="normal"><a href="#__codelineno-500-12">12</a></span>
<span class="normal"><a href="#__codelineno-500-13">13</a></span>
<span class="normal"><a href="#__codelineno-500-14">14</a></span>
<span class="normal"><a href="#__codelineno-500-15">15</a></span>
<span class="normal"><a href="#__codelineno-500-16">16</a></span>
<span class="normal"><a href="#__codelineno-500-17">17</a></span>
<span class="normal"><a href="#__codelineno-500-18">18</a></span>
<span class="normal"><a href="#__codelineno-500-19">19</a></span>
<span class="normal"><a href="#__codelineno-500-20">20</a></span>
<span class="normal"><a href="#__codelineno-500-21">21</a></span>
<span class="normal"><a href="#__codelineno-500-22">22</a></span>
<span class="normal"><a href="#__codelineno-500-23">23</a></span>
<span class="normal"><a href="#__codelineno-500-24">24</a></span>
<span class="normal"><a href="#__codelineno-500-25">25</a></span>
<span class="normal"><a href="#__codelineno-500-26">26</a></span>
<span class="normal"><a href="#__codelineno-500-27">27</a></span>
<span class="normal"><a href="#__codelineno-500-28">28</a></span>
<span class="normal"><a href="#__codelineno-500-29">29</a></span>
<span class="normal"><a href="#__codelineno-500-30">30</a></span>
<span class="normal"><a href="#__codelineno-500-31">31</a></span>
<span class="normal"><a href="#__codelineno-500-32">32</a></span>
<span class="normal"><a href="#__codelineno-500-33">33</a></span>
<span class="normal"><a href="#__codelineno-500-34">34</a></span>
<span class="normal"><a href="#__codelineno-500-35">35</a></span>
<span class="normal"><a href="#__codelineno-500-36">36</a></span>
<span class="normal"><a href="#__codelineno-500-37">37</a></span>
<span class="normal"><a href="#__codelineno-500-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-500-1" name="__codelineno-500-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-500-2" name="__codelineno-500-2"></a>
<a id="__codelineno-500-3" name="__codelineno-500-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-500-4" name="__codelineno-500-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-500-5" name="__codelineno-500-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-500-6" name="__codelineno-500-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-500-7" name="__codelineno-500-7"></a><span class="p">)</span>
<a id="__codelineno-500-8" name="__codelineno-500-8"></a>
<a id="__codelineno-500-9" name="__codelineno-500-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-500-10" name="__codelineno-500-10"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;buffered_output.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-500-11" name="__codelineno-500-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-500-12" name="__codelineno-500-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-500-13" name="__codelineno-500-13"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-500-14" name="__codelineno-500-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-500-15" name="__codelineno-500-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-500-16" name="__codelineno-500-16"></a>
<a id="__codelineno-500-17" name="__codelineno-500-17"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-500-18" name="__codelineno-500-18"></a>
<a id="__codelineno-500-19" name="__codelineno-500-19"></a><span class="w">    </span><span class="c1">// 写入多行数据</span>
<a id="__codelineno-500-20" name="__codelineno-500-20"></a><span class="w">    </span><span class="nx">lines</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Line 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Line 2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Line 3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Line 4&quot;</span><span class="p">}</span>
<a id="__codelineno-500-21" name="__codelineno-500-21"></a>
<a id="__codelineno-500-22" name="__codelineno-500-22"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-500-23" name="__codelineno-500-23"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">writer</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<a id="__codelineno-500-24" name="__codelineno-500-24"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-500-25" name="__codelineno-500-25"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;写入字符串失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-500-26" name="__codelineno-500-26"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-500-27" name="__codelineno-500-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-500-28" name="__codelineno-500-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-500-29" name="__codelineno-500-29"></a>
<a id="__codelineno-500-30" name="__codelineno-500-30"></a><span class="w">    </span><span class="c1">// 刷新缓冲区，将数据写入文件</span>
<a id="__codelineno-500-31" name="__codelineno-500-31"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">writer</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span>
<a id="__codelineno-500-32" name="__codelineno-500-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-500-33" name="__codelineno-500-33"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;刷新缓冲区失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-500-34" name="__codelineno-500-34"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-500-35" name="__codelineno-500-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-500-36" name="__codelineno-500-36"></a>
<a id="__codelineno-500-37" name="__codelineno-500-37"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;缓冲写入成功&quot;</span><span class="p">)</span>
<a id="__codelineno-500-38" name="__codelineno-500-38"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-501-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-501-1" name="__codelineno-501-1"></a>缓冲写入成功
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>bufio.NewWriter</code>创建一个带缓冲的写入器。</li>
<li>通过循环写入多行字符串到缓冲区。</li>
<li>使用<code>writer.Flush()</code>将缓冲区的数据写入文件，确保所有数据被写入。</li>
</ul>
<h4 id="注意事项_14">注意事项<a class="headerlink" href="#注意事项_14" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>关闭文件</strong>：始终确保文件在使用完毕后被关闭，使用<code>defer file.Close()</code>是一种简洁的方式。</li>
<li><strong>错误处理</strong>：每次文件操作后检查错误，确保程序能够正确处理异常情况。</li>
<li><strong>缓冲与性能</strong>：对于大量或频繁的写入操作，使用<code>bufio.Writer</code>可以显著提高性能。</li>
<li><strong>文件权限</strong>：在创建文件时，合理设置文件权限，确保文件的安全性。</li>
</ul>
<h3 id="112-文件夹操作">11.2 文件夹操作<a class="headerlink" href="#112-文件夹操作" title="Permanent link">&para;</a></h3>
<p>文件夹操作包括创建和删除文件夹，以及遍历文件夹中的内容。Go语言的<code>os</code>和<code>filepath</code>包提供了相关的函数来实现这些功能。</p>
<h4 id="创建与删除文件夹">创建与删除文件夹<a class="headerlink" href="#创建与删除文件夹" title="Permanent link">&para;</a></h4>
<p><strong>1. 创建文件夹</strong></p>
<p>使用<code>os.Mkdir</code>和<code>os.MkdirAll</code>函数可以创建文件夹。<code>os.Mkdir</code>创建单个文件夹，而<code>os.MkdirAll</code>可以创建多层嵌套的文件夹。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-502-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-502-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-502-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-502-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-502-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-502-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-502-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-502-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-502-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-502-10">10</a></span>
<span class="normal"><a href="#__codelineno-502-11">11</a></span>
<span class="normal"><a href="#__codelineno-502-12">12</a></span>
<span class="normal"><a href="#__codelineno-502-13">13</a></span>
<span class="normal"><a href="#__codelineno-502-14">14</a></span>
<span class="normal"><a href="#__codelineno-502-15">15</a></span>
<span class="normal"><a href="#__codelineno-502-16">16</a></span>
<span class="normal"><a href="#__codelineno-502-17">17</a></span>
<span class="normal"><a href="#__codelineno-502-18">18</a></span>
<span class="normal"><a href="#__codelineno-502-19">19</a></span>
<span class="normal"><a href="#__codelineno-502-20">20</a></span>
<span class="normal"><a href="#__codelineno-502-21">21</a></span>
<span class="normal"><a href="#__codelineno-502-22">22</a></span>
<span class="normal"><a href="#__codelineno-502-23">23</a></span>
<span class="normal"><a href="#__codelineno-502-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-502-1" name="__codelineno-502-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-502-2" name="__codelineno-502-2"></a>
<a id="__codelineno-502-3" name="__codelineno-502-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-502-4" name="__codelineno-502-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-502-5" name="__codelineno-502-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-502-6" name="__codelineno-502-6"></a><span class="p">)</span>
<a id="__codelineno-502-7" name="__codelineno-502-7"></a>
<a id="__codelineno-502-8" name="__codelineno-502-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-502-9" name="__codelineno-502-9"></a><span class="w">    </span><span class="c1">// 创建单个文件夹</span>
<a id="__codelineno-502-10" name="__codelineno-502-10"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Mkdir</span><span class="p">(</span><span class="s">&quot;newfolder&quot;</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>
<a id="__codelineno-502-11" name="__codelineno-502-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-502-12" name="__codelineno-502-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建文件夹失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-502-13" name="__codelineno-502-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-502-14" name="__codelineno-502-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件夹 &#39;newfolder&#39; 创建成功&quot;</span><span class="p">)</span>
<a id="__codelineno-502-15" name="__codelineno-502-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-502-16" name="__codelineno-502-16"></a>
<a id="__codelineno-502-17" name="__codelineno-502-17"></a><span class="w">    </span><span class="c1">// 创建多层嵌套的文件夹</span>
<a id="__codelineno-502-18" name="__codelineno-502-18"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">MkdirAll</span><span class="p">(</span><span class="s">&quot;parent/child/grandchild&quot;</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>
<a id="__codelineno-502-19" name="__codelineno-502-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-502-20" name="__codelineno-502-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建多层文件夹失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-502-21" name="__codelineno-502-21"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-502-22" name="__codelineno-502-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;多层文件夹 &#39;parent/child/grandchild&#39; 创建成功&quot;</span><span class="p">)</span>
<a id="__codelineno-502-23" name="__codelineno-502-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-502-24" name="__codelineno-502-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-503-1">1</a></span>
<span class="normal"><a href="#__codelineno-503-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-503-1" name="__codelineno-503-1"></a>文件夹 &#39;newfolder&#39; 创建成功
<a id="__codelineno-503-2" name="__codelineno-503-2"></a>多层文件夹 &#39;parent/child/grandchild&#39; 创建成功
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Mkdir</code>尝试创建名为<code>newfolder</code>的文件夹，权限设置为<code>0755</code>。</li>
<li><code>os.MkdirAll</code>创建多层嵌套的文件夹结构，如果中间层级的文件夹不存在，则会一并创建。</li>
</ul>
<p><strong>2. 删除文件夹</strong></p>
<p>使用<code>os.Remove</code>和<code>os.RemoveAll</code>函数可以删除文件夹。<code>os.Remove</code>删除单个文件或空文件夹，而<code>os.RemoveAll</code>可以递归删除文件夹及其内容。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-504-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-504-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-504-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-504-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-504-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-504-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-504-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-504-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-504-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-504-10">10</a></span>
<span class="normal"><a href="#__codelineno-504-11">11</a></span>
<span class="normal"><a href="#__codelineno-504-12">12</a></span>
<span class="normal"><a href="#__codelineno-504-13">13</a></span>
<span class="normal"><a href="#__codelineno-504-14">14</a></span>
<span class="normal"><a href="#__codelineno-504-15">15</a></span>
<span class="normal"><a href="#__codelineno-504-16">16</a></span>
<span class="normal"><a href="#__codelineno-504-17">17</a></span>
<span class="normal"><a href="#__codelineno-504-18">18</a></span>
<span class="normal"><a href="#__codelineno-504-19">19</a></span>
<span class="normal"><a href="#__codelineno-504-20">20</a></span>
<span class="normal"><a href="#__codelineno-504-21">21</a></span>
<span class="normal"><a href="#__codelineno-504-22">22</a></span>
<span class="normal"><a href="#__codelineno-504-23">23</a></span>
<span class="normal"><a href="#__codelineno-504-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-504-1" name="__codelineno-504-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-504-2" name="__codelineno-504-2"></a>
<a id="__codelineno-504-3" name="__codelineno-504-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-504-4" name="__codelineno-504-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-504-5" name="__codelineno-504-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-504-6" name="__codelineno-504-6"></a><span class="p">)</span>
<a id="__codelineno-504-7" name="__codelineno-504-7"></a>
<a id="__codelineno-504-8" name="__codelineno-504-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-504-9" name="__codelineno-504-9"></a><span class="w">    </span><span class="c1">// 删除单个空文件夹</span>
<a id="__codelineno-504-10" name="__codelineno-504-10"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">&quot;newfolder&quot;</span><span class="p">)</span>
<a id="__codelineno-504-11" name="__codelineno-504-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-504-12" name="__codelineno-504-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;删除文件夹失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-504-13" name="__codelineno-504-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-504-14" name="__codelineno-504-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件夹 &#39;newfolder&#39; 删除成功&quot;</span><span class="p">)</span>
<a id="__codelineno-504-15" name="__codelineno-504-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-504-16" name="__codelineno-504-16"></a>
<a id="__codelineno-504-17" name="__codelineno-504-17"></a><span class="w">    </span><span class="c1">// 删除多层文件夹及其内容</span>
<a id="__codelineno-504-18" name="__codelineno-504-18"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">RemoveAll</span><span class="p">(</span><span class="s">&quot;parent&quot;</span><span class="p">)</span>
<a id="__codelineno-504-19" name="__codelineno-504-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-504-20" name="__codelineno-504-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;删除多层文件夹失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-504-21" name="__codelineno-504-21"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-504-22" name="__codelineno-504-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;多层文件夹 &#39;parent&#39; 删除成功&quot;</span><span class="p">)</span>
<a id="__codelineno-504-23" name="__codelineno-504-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-504-24" name="__codelineno-504-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-505-1">1</a></span>
<span class="normal"><a href="#__codelineno-505-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-505-1" name="__codelineno-505-1"></a>文件夹 &#39;newfolder&#39; 删除成功
<a id="__codelineno-505-2" name="__codelineno-505-2"></a>多层文件夹 &#39;parent&#39; 删除成功
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Remove</code>删除名为<code>newfolder</code>的文件夹，要求该文件夹为空。</li>
<li><code>os.RemoveAll</code>递归删除<code>parent</code>文件夹及其所有子文件夹和文件。</li>
</ul>
<h4 id="遍历文件夹">遍历文件夹<a class="headerlink" href="#遍历文件夹" title="Permanent link">&para;</a></h4>
<p>使用<code>filepath.Walk</code>函数可以遍历文件夹中的所有文件和子文件夹，执行特定的操作。</p>
<p><strong>示例：遍历文件夹并打印所有文件路径</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-506-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-506-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-506-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-506-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-506-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-506-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-506-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-506-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-506-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-506-10">10</a></span>
<span class="normal"><a href="#__codelineno-506-11">11</a></span>
<span class="normal"><a href="#__codelineno-506-12">12</a></span>
<span class="normal"><a href="#__codelineno-506-13">13</a></span>
<span class="normal"><a href="#__codelineno-506-14">14</a></span>
<span class="normal"><a href="#__codelineno-506-15">15</a></span>
<span class="normal"><a href="#__codelineno-506-16">16</a></span>
<span class="normal"><a href="#__codelineno-506-17">17</a></span>
<span class="normal"><a href="#__codelineno-506-18">18</a></span>
<span class="normal"><a href="#__codelineno-506-19">19</a></span>
<span class="normal"><a href="#__codelineno-506-20">20</a></span>
<span class="normal"><a href="#__codelineno-506-21">21</a></span>
<span class="normal"><a href="#__codelineno-506-22">22</a></span>
<span class="normal"><a href="#__codelineno-506-23">23</a></span>
<span class="normal"><a href="#__codelineno-506-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-506-1" name="__codelineno-506-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-506-2" name="__codelineno-506-2"></a>
<a id="__codelineno-506-3" name="__codelineno-506-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-506-4" name="__codelineno-506-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-506-5" name="__codelineno-506-5"></a><span class="w">    </span><span class="s">&quot;path/filepath&quot;</span>
<a id="__codelineno-506-6" name="__codelineno-506-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-506-7" name="__codelineno-506-7"></a><span class="p">)</span>
<a id="__codelineno-506-8" name="__codelineno-506-8"></a>
<a id="__codelineno-506-9" name="__codelineno-506-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-506-10" name="__codelineno-506-10"></a><span class="w">    </span><span class="nx">root</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;sample_folder&quot;</span><span class="w"> </span><span class="c1">// 要遍历的文件夹</span>
<a id="__codelineno-506-11" name="__codelineno-506-11"></a>
<a id="__codelineno-506-12" name="__codelineno-506-12"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Walk</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-506-13" name="__codelineno-506-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-506-14" name="__codelineno-506-14"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;访问路径时出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-506-15" name="__codelineno-506-15"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-506-16" name="__codelineno-506-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-506-17" name="__codelineno-506-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
<a id="__codelineno-506-18" name="__codelineno-506-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-506-19" name="__codelineno-506-19"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-506-20" name="__codelineno-506-20"></a>
<a id="__codelineno-506-21" name="__codelineno-506-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-506-22" name="__codelineno-506-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;遍历文件夹时出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-506-23" name="__codelineno-506-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-506-24" name="__codelineno-506-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-507-1">1</a></span>
<span class="normal"><a href="#__codelineno-507-2">2</a></span>
<span class="normal"><a href="#__codelineno-507-3">3</a></span>
<span class="normal"><a href="#__codelineno-507-4">4</a></span>
<span class="normal"><a href="#__codelineno-507-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-507-1" name="__codelineno-507-1"></a>sample_folder
<a id="__codelineno-507-2" name="__codelineno-507-2"></a>sample_folder/file1.txt
<a id="__codelineno-507-3" name="__codelineno-507-3"></a>sample_folder/file2.txt
<a id="__codelineno-507-4" name="__codelineno-507-4"></a>sample_folder/subfolder
<a id="__codelineno-507-5" name="__codelineno-507-5"></a>sample_folder/subfolder/file3.txt
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>filepath.Walk</code>从指定的根目录<code>sample_folder</code>开始，递归遍历所有文件和子文件夹。</li>
<li>对于每个遍历到的路径，回调函数会打印其路径。</li>
<li>处理遍历过程中的任何错误。</li>
</ul>
<p><strong>示例：过滤特定类型的文件</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-508-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-508-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-508-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-508-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-508-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-508-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-508-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-508-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-508-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-508-10">10</a></span>
<span class="normal"><a href="#__codelineno-508-11">11</a></span>
<span class="normal"><a href="#__codelineno-508-12">12</a></span>
<span class="normal"><a href="#__codelineno-508-13">13</a></span>
<span class="normal"><a href="#__codelineno-508-14">14</a></span>
<span class="normal"><a href="#__codelineno-508-15">15</a></span>
<span class="normal"><a href="#__codelineno-508-16">16</a></span>
<span class="normal"><a href="#__codelineno-508-17">17</a></span>
<span class="normal"><a href="#__codelineno-508-18">18</a></span>
<span class="normal"><a href="#__codelineno-508-19">19</a></span>
<span class="normal"><a href="#__codelineno-508-20">20</a></span>
<span class="normal"><a href="#__codelineno-508-21">21</a></span>
<span class="normal"><a href="#__codelineno-508-22">22</a></span>
<span class="normal"><a href="#__codelineno-508-23">23</a></span>
<span class="normal"><a href="#__codelineno-508-24">24</a></span>
<span class="normal"><a href="#__codelineno-508-25">25</a></span>
<span class="normal"><a href="#__codelineno-508-26">26</a></span>
<span class="normal"><a href="#__codelineno-508-27">27</a></span>
<span class="normal"><a href="#__codelineno-508-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-508-1" name="__codelineno-508-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-508-2" name="__codelineno-508-2"></a>
<a id="__codelineno-508-3" name="__codelineno-508-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-508-4" name="__codelineno-508-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-508-5" name="__codelineno-508-5"></a><span class="w">    </span><span class="s">&quot;path/filepath&quot;</span>
<a id="__codelineno-508-6" name="__codelineno-508-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-508-7" name="__codelineno-508-7"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-508-8" name="__codelineno-508-8"></a><span class="p">)</span>
<a id="__codelineno-508-9" name="__codelineno-508-9"></a>
<a id="__codelineno-508-10" name="__codelineno-508-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-508-11" name="__codelineno-508-11"></a><span class="w">    </span><span class="nx">root</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;sample_folder&quot;</span><span class="w"> </span><span class="c1">// 要遍历的文件夹</span>
<a id="__codelineno-508-12" name="__codelineno-508-12"></a><span class="w">    </span><span class="nx">ext</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;.txt&quot;</span><span class="w">           </span><span class="c1">// 要过滤的文件扩展名</span>
<a id="__codelineno-508-13" name="__codelineno-508-13"></a>
<a id="__codelineno-508-14" name="__codelineno-508-14"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Walk</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-508-15" name="__codelineno-508-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-508-16" name="__codelineno-508-16"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;访问路径时出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-508-17" name="__codelineno-508-17"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-508-18" name="__codelineno-508-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-508-19" name="__codelineno-508-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">info</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">HasSuffix</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="p">(),</span><span class="w"> </span><span class="nx">ext</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-508-20" name="__codelineno-508-20"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;找到文件:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">path</span><span class="p">)</span>
<a id="__codelineno-508-21" name="__codelineno-508-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-508-22" name="__codelineno-508-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-508-23" name="__codelineno-508-23"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-508-24" name="__codelineno-508-24"></a>
<a id="__codelineno-508-25" name="__codelineno-508-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-508-26" name="__codelineno-508-26"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;遍历文件夹时出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-508-27" name="__codelineno-508-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-508-28" name="__codelineno-508-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-509-1">1</a></span>
<span class="normal"><a href="#__codelineno-509-2">2</a></span>
<span class="normal"><a href="#__codelineno-509-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-509-1" name="__codelineno-509-1"></a>找到文件: sample_folder/file1.txt
<a id="__codelineno-509-2" name="__codelineno-509-2"></a>找到文件: sample_folder/file2.txt
<a id="__codelineno-509-3" name="__codelineno-509-3"></a>找到文件: sample_folder/subfolder/file3.txt
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>在回调函数中，检查文件是否是目录，并判断文件名是否以指定的扩展名结尾。</li>
<li>仅打印匹配条件的文件路径。</li>
</ul>
<h4 id="注意事项_15">注意事项<a class="headerlink" href="#注意事项_15" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>权限问题</strong>：确保程序有足够的权限访问和修改目标文件或文件夹。</li>
<li><strong>错误处理</strong>：在遍历文件夹时，处理访问错误，避免程序因权限问题或其他异常中断。</li>
<li><strong>性能考虑</strong>：对于非常大的文件夹结构，遍历可能会消耗较多资源，考虑使用并发方式优化性能。</li>
</ul>
<h3 id="113-文件信息">11.3 文件信息<a class="headerlink" href="#113-文件信息" title="Permanent link">&para;</a></h3>
<p>获取文件信息是文件操作中常见的需求，包括文件的大小、权限、修改时间等。Go语言的<code>os.FileInfo</code>接口提供了获取这些信息的方法。</p>
<h4 id="获取文件信息">获取文件信息<a class="headerlink" href="#获取文件信息" title="Permanent link">&para;</a></h4>
<p>使用<code>os.Stat</code>或<code>os.Lstat</code>函数可以获取文件或文件夹的<code>FileInfo</code>对象。</p>
<p><strong>示例：获取文件信息并打印</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-510-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-510-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-510-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-510-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-510-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-510-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-510-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-510-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-510-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-510-10">10</a></span>
<span class="normal"><a href="#__codelineno-510-11">11</a></span>
<span class="normal"><a href="#__codelineno-510-12">12</a></span>
<span class="normal"><a href="#__codelineno-510-13">13</a></span>
<span class="normal"><a href="#__codelineno-510-14">14</a></span>
<span class="normal"><a href="#__codelineno-510-15">15</a></span>
<span class="normal"><a href="#__codelineno-510-16">16</a></span>
<span class="normal"><a href="#__codelineno-510-17">17</a></span>
<span class="normal"><a href="#__codelineno-510-18">18</a></span>
<span class="normal"><a href="#__codelineno-510-19">19</a></span>
<span class="normal"><a href="#__codelineno-510-20">20</a></span>
<span class="normal"><a href="#__codelineno-510-21">21</a></span>
<span class="normal"><a href="#__codelineno-510-22">22</a></span>
<span class="normal"><a href="#__codelineno-510-23">23</a></span>
<span class="normal"><a href="#__codelineno-510-24">24</a></span>
<span class="normal"><a href="#__codelineno-510-25">25</a></span>
<span class="normal"><a href="#__codelineno-510-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-510-1" name="__codelineno-510-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-510-2" name="__codelineno-510-2"></a>
<a id="__codelineno-510-3" name="__codelineno-510-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-510-4" name="__codelineno-510-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-510-5" name="__codelineno-510-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-510-6" name="__codelineno-510-6"></a><span class="p">)</span>
<a id="__codelineno-510-7" name="__codelineno-510-7"></a>
<a id="__codelineno-510-8" name="__codelineno-510-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-510-9" name="__codelineno-510-9"></a><span class="w">    </span><span class="nx">filePath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;example.txt&quot;</span>
<a id="__codelineno-510-10" name="__codelineno-510-10"></a>
<a id="__codelineno-510-11" name="__codelineno-510-11"></a><span class="w">    </span><span class="nx">info</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
<a id="__codelineno-510-12" name="__codelineno-510-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-510-13" name="__codelineno-510-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-510-14" name="__codelineno-510-14"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;文件 %s 不存在\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">filePath</span><span class="p">)</span>
<a id="__codelineno-510-15" name="__codelineno-510-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-510-16" name="__codelineno-510-16"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取文件信息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-510-17" name="__codelineno-510-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-510-18" name="__codelineno-510-18"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-510-19" name="__codelineno-510-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-510-20" name="__codelineno-510-20"></a>
<a id="__codelineno-510-21" name="__codelineno-510-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;文件名: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="p">())</span>
<a id="__codelineno-510-22" name="__codelineno-510-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;是否为目录: %t\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">())</span>
<a id="__codelineno-510-23" name="__codelineno-510-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;文件大小: %d 字节\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Size</span><span class="p">())</span>
<a id="__codelineno-510-24" name="__codelineno-510-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;权限: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Mode</span><span class="p">())</span>
<a id="__codelineno-510-25" name="__codelineno-510-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;最后修改时间: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">ModTime</span><span class="p">())</span>
<a id="__codelineno-510-26" name="__codelineno-510-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-511-1">1</a></span>
<span class="normal"><a href="#__codelineno-511-2">2</a></span>
<span class="normal"><a href="#__codelineno-511-3">3</a></span>
<span class="normal"><a href="#__codelineno-511-4">4</a></span>
<span class="normal"><a href="#__codelineno-511-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-511-1" name="__codelineno-511-1"></a>文件名: example.txt
<a id="__codelineno-511-2" name="__codelineno-511-2"></a>是否为目录: false
<a id="__codelineno-511-3" name="__codelineno-511-3"></a>文件大小: 1234 字节
<a id="__codelineno-511-4" name="__codelineno-511-4"></a>权限: -rw-r--r--
<a id="__codelineno-511-5" name="__codelineno-511-5"></a>最后修改时间: 2024-04-27 10:15:30 +0800 CST
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Stat</code>获取指定路径的文件信息。</li>
<li><code>FileInfo</code>接口提供了多个方法来获取文件的详细信息，如名称、是否为目录、大小、权限和修改时间。</li>
</ul>
<h4 id="示例获取目录信息">示例：获取目录信息<a class="headerlink" href="#示例获取目录信息" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-512-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-512-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-512-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-512-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-512-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-512-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-512-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-512-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-512-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-512-10">10</a></span>
<span class="normal"><a href="#__codelineno-512-11">11</a></span>
<span class="normal"><a href="#__codelineno-512-12">12</a></span>
<span class="normal"><a href="#__codelineno-512-13">13</a></span>
<span class="normal"><a href="#__codelineno-512-14">14</a></span>
<span class="normal"><a href="#__codelineno-512-15">15</a></span>
<span class="normal"><a href="#__codelineno-512-16">16</a></span>
<span class="normal"><a href="#__codelineno-512-17">17</a></span>
<span class="normal"><a href="#__codelineno-512-18">18</a></span>
<span class="normal"><a href="#__codelineno-512-19">19</a></span>
<span class="normal"><a href="#__codelineno-512-20">20</a></span>
<span class="normal"><a href="#__codelineno-512-21">21</a></span>
<span class="normal"><a href="#__codelineno-512-22">22</a></span>
<span class="normal"><a href="#__codelineno-512-23">23</a></span>
<span class="normal"><a href="#__codelineno-512-24">24</a></span>
<span class="normal"><a href="#__codelineno-512-25">25</a></span>
<span class="normal"><a href="#__codelineno-512-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-512-1" name="__codelineno-512-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-512-2" name="__codelineno-512-2"></a>
<a id="__codelineno-512-3" name="__codelineno-512-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-512-4" name="__codelineno-512-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-512-5" name="__codelineno-512-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-512-6" name="__codelineno-512-6"></a><span class="p">)</span>
<a id="__codelineno-512-7" name="__codelineno-512-7"></a>
<a id="__codelineno-512-8" name="__codelineno-512-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-512-9" name="__codelineno-512-9"></a><span class="w">    </span><span class="nx">dirPath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;sample_folder&quot;</span>
<a id="__codelineno-512-10" name="__codelineno-512-10"></a>
<a id="__codelineno-512-11" name="__codelineno-512-11"></a><span class="w">    </span><span class="nx">info</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">dirPath</span><span class="p">)</span>
<a id="__codelineno-512-12" name="__codelineno-512-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-512-13" name="__codelineno-512-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-512-14" name="__codelineno-512-14"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;目录 %s 不存在\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dirPath</span><span class="p">)</span>
<a id="__codelineno-512-15" name="__codelineno-512-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-512-16" name="__codelineno-512-16"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取目录信息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-512-17" name="__codelineno-512-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-512-18" name="__codelineno-512-18"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-512-19" name="__codelineno-512-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-512-20" name="__codelineno-512-20"></a>
<a id="__codelineno-512-21" name="__codelineno-512-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-512-22" name="__codelineno-512-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s 是一个目录\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dirPath</span><span class="p">)</span>
<a id="__codelineno-512-23" name="__codelineno-512-23"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-512-24" name="__codelineno-512-24"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s 不是一个目录\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dirPath</span><span class="p">)</span>
<a id="__codelineno-512-25" name="__codelineno-512-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-512-26" name="__codelineno-512-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-513-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-513-1" name="__codelineno-513-1"></a>sample_folder 是一个目录
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>通过<code>info.IsDir()</code>判断指定路径是否为目录。</li>
</ul>
<h4 id="文件权限与模式">文件权限与模式<a class="headerlink" href="#文件权限与模式" title="Permanent link">&para;</a></h4>
<p><code>FileInfo.Mode()</code>返回一个<code>FileMode</code>类型，包含文件的权限和模式信息。可以使用<code>FileMode</code>的方法和常量来检查特定的权限或模式。</p>
<p><strong>示例：检查文件是否可执行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-514-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-514-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-514-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-514-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-514-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-514-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-514-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-514-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-514-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-514-10">10</a></span>
<span class="normal"><a href="#__codelineno-514-11">11</a></span>
<span class="normal"><a href="#__codelineno-514-12">12</a></span>
<span class="normal"><a href="#__codelineno-514-13">13</a></span>
<span class="normal"><a href="#__codelineno-514-14">14</a></span>
<span class="normal"><a href="#__codelineno-514-15">15</a></span>
<span class="normal"><a href="#__codelineno-514-16">16</a></span>
<span class="normal"><a href="#__codelineno-514-17">17</a></span>
<span class="normal"><a href="#__codelineno-514-18">18</a></span>
<span class="normal"><a href="#__codelineno-514-19">19</a></span>
<span class="normal"><a href="#__codelineno-514-20">20</a></span>
<span class="normal"><a href="#__codelineno-514-21">21</a></span>
<span class="normal"><a href="#__codelineno-514-22">22</a></span>
<span class="normal"><a href="#__codelineno-514-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-514-1" name="__codelineno-514-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-514-2" name="__codelineno-514-2"></a>
<a id="__codelineno-514-3" name="__codelineno-514-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-514-4" name="__codelineno-514-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-514-5" name="__codelineno-514-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-514-6" name="__codelineno-514-6"></a><span class="p">)</span>
<a id="__codelineno-514-7" name="__codelineno-514-7"></a>
<a id="__codelineno-514-8" name="__codelineno-514-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-514-9" name="__codelineno-514-9"></a><span class="w">    </span><span class="nx">filePath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;script.sh&quot;</span>
<a id="__codelineno-514-10" name="__codelineno-514-10"></a>
<a id="__codelineno-514-11" name="__codelineno-514-11"></a><span class="w">    </span><span class="nx">info</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
<a id="__codelineno-514-12" name="__codelineno-514-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-514-13" name="__codelineno-514-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取文件信息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-514-14" name="__codelineno-514-14"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-514-15" name="__codelineno-514-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-514-16" name="__codelineno-514-16"></a>
<a id="__codelineno-514-17" name="__codelineno-514-17"></a><span class="w">    </span><span class="nx">mode</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Mode</span><span class="p">()</span>
<a id="__codelineno-514-18" name="__codelineno-514-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">mode</span><span class="o">&amp;</span><span class="mo">0111</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-514-19" name="__codelineno-514-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件具有可执行权限&quot;</span><span class="p">)</span>
<a id="__codelineno-514-20" name="__codelineno-514-20"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-514-21" name="__codelineno-514-21"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件不具有可执行权限&quot;</span><span class="p">)</span>
<a id="__codelineno-514-22" name="__codelineno-514-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-514-23" name="__codelineno-514-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-515-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-515-1" name="__codelineno-515-1"></a>文件具有可执行权限
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用位运算检查文件的执行权限（用户、组、其他）。</li>
<li><code>0111</code>表示执行权限的掩码。</li>
</ul>
<h4 id="获取符号链接的目标">获取符号链接的目标<a class="headerlink" href="#获取符号链接的目标" title="Permanent link">&para;</a></h4>
<p>使用<code>os.Lstat</code>和<code>os.Readlink</code>可以获取符号链接的目标路径。</p>
<p><strong>示例：获取符号链接的目标</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-516-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-516-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-516-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-516-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-516-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-516-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-516-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-516-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-516-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-516-10">10</a></span>
<span class="normal"><a href="#__codelineno-516-11">11</a></span>
<span class="normal"><a href="#__codelineno-516-12">12</a></span>
<span class="normal"><a href="#__codelineno-516-13">13</a></span>
<span class="normal"><a href="#__codelineno-516-14">14</a></span>
<span class="normal"><a href="#__codelineno-516-15">15</a></span>
<span class="normal"><a href="#__codelineno-516-16">16</a></span>
<span class="normal"><a href="#__codelineno-516-17">17</a></span>
<span class="normal"><a href="#__codelineno-516-18">18</a></span>
<span class="normal"><a href="#__codelineno-516-19">19</a></span>
<span class="normal"><a href="#__codelineno-516-20">20</a></span>
<span class="normal"><a href="#__codelineno-516-21">21</a></span>
<span class="normal"><a href="#__codelineno-516-22">22</a></span>
<span class="normal"><a href="#__codelineno-516-23">23</a></span>
<span class="normal"><a href="#__codelineno-516-24">24</a></span>
<span class="normal"><a href="#__codelineno-516-25">25</a></span>
<span class="normal"><a href="#__codelineno-516-26">26</a></span>
<span class="normal"><a href="#__codelineno-516-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-516-1" name="__codelineno-516-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-516-2" name="__codelineno-516-2"></a>
<a id="__codelineno-516-3" name="__codelineno-516-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-516-4" name="__codelineno-516-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-516-5" name="__codelineno-516-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-516-6" name="__codelineno-516-6"></a><span class="p">)</span>
<a id="__codelineno-516-7" name="__codelineno-516-7"></a>
<a id="__codelineno-516-8" name="__codelineno-516-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-516-9" name="__codelineno-516-9"></a><span class="w">    </span><span class="nx">linkPath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;shortcut&quot;</span>
<a id="__codelineno-516-10" name="__codelineno-516-10"></a>
<a id="__codelineno-516-11" name="__codelineno-516-11"></a><span class="w">    </span><span class="nx">info</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Lstat</span><span class="p">(</span><span class="nx">linkPath</span><span class="p">)</span>
<a id="__codelineno-516-12" name="__codelineno-516-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-516-13" name="__codelineno-516-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取符号链接信息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-516-14" name="__codelineno-516-14"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-516-15" name="__codelineno-516-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-516-16" name="__codelineno-516-16"></a>
<a id="__codelineno-516-17" name="__codelineno-516-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Mode</span><span class="p">()</span><span class="o">&amp;</span><span class="nx">os</span><span class="p">.</span><span class="nx">ModeSymlink</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-516-18" name="__codelineno-516-18"></a><span class="w">        </span><span class="nx">target</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Readlink</span><span class="p">(</span><span class="nx">linkPath</span><span class="p">)</span>
<a id="__codelineno-516-19" name="__codelineno-516-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-516-20" name="__codelineno-516-20"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取符号链接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-516-21" name="__codelineno-516-21"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-516-22" name="__codelineno-516-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-516-23" name="__codelineno-516-23"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;符号链接 %s 指向: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">linkPath</span><span class="p">,</span><span class="w"> </span><span class="nx">target</span><span class="p">)</span>
<a id="__codelineno-516-24" name="__codelineno-516-24"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-516-25" name="__codelineno-516-25"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s 不是一个符号链接\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">linkPath</span><span class="p">)</span>
<a id="__codelineno-516-26" name="__codelineno-516-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-516-27" name="__codelineno-516-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-517-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-517-1" name="__codelineno-517-1"></a>符号链接 shortcut 指向: /path/to/target
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Lstat</code>获取符号链接本身的文件信息，而不是链接指向的目标。</li>
<li>使用<code>os.Readlink</code>获取符号链接的目标路径。</li>
</ul>
<h4 id="注意事项_16">注意事项<a class="headerlink" href="#注意事项_16" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>文件权限</strong>：在操作文件和文件夹时，注意权限设置，确保程序有足够的权限进行读写操作。</li>
<li><strong>错误处理</strong>：每次文件操作后检查错误，确保程序能够正确处理异常情况。</li>
<li><strong>资源管理</strong>：使用<code>defer file.Close()</code>确保文件被及时关闭，避免资源泄漏。</li>
<li><strong>并发访问</strong>：在并发环境中操作文件时，注意同步机制，避免竞态条件和数据损坏。</li>
</ul>
<h3 id="114-文件信息拓展内容">11.4 文件信息（拓展内容）<a class="headerlink" href="#114-文件信息拓展内容" title="Permanent link">&para;</a></h3>
<p>虽然用户未在初始提纲中详细列出<code>文件信息</code>的子项，但了解文件的详细信息和操作是文件处理的重要部分。这里进一步介绍如何获取和操作文件的元数据，包括文件大小、权限、修改时间等，以及如何更改文件权限和重命名文件。</p>
<h4 id="获取文件元数据">获取文件元数据<a class="headerlink" href="#获取文件元数据" title="Permanent link">&para;</a></h4>
<p>除了前面提到的基本文件信息外，还可以获取更详细的元数据，如文件的UID、GID、设备号等。使用<code>syscall</code>包可以访问底层的系统调用以获取这些信息，但这通常不必要，除非有特定需求。</p>
<p><strong>示例：获取文件的UID和GID</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-518-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-518-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-518-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-518-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-518-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-518-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-518-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-518-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-518-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-518-10">10</a></span>
<span class="normal"><a href="#__codelineno-518-11">11</a></span>
<span class="normal"><a href="#__codelineno-518-12">12</a></span>
<span class="normal"><a href="#__codelineno-518-13">13</a></span>
<span class="normal"><a href="#__codelineno-518-14">14</a></span>
<span class="normal"><a href="#__codelineno-518-15">15</a></span>
<span class="normal"><a href="#__codelineno-518-16">16</a></span>
<span class="normal"><a href="#__codelineno-518-17">17</a></span>
<span class="normal"><a href="#__codelineno-518-18">18</a></span>
<span class="normal"><a href="#__codelineno-518-19">19</a></span>
<span class="normal"><a href="#__codelineno-518-20">20</a></span>
<span class="normal"><a href="#__codelineno-518-21">21</a></span>
<span class="normal"><a href="#__codelineno-518-22">22</a></span>
<span class="normal"><a href="#__codelineno-518-23">23</a></span>
<span class="normal"><a href="#__codelineno-518-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-518-1" name="__codelineno-518-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-518-2" name="__codelineno-518-2"></a>
<a id="__codelineno-518-3" name="__codelineno-518-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-518-4" name="__codelineno-518-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-518-5" name="__codelineno-518-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-518-6" name="__codelineno-518-6"></a><span class="w">    </span><span class="s">&quot;syscall&quot;</span>
<a id="__codelineno-518-7" name="__codelineno-518-7"></a><span class="p">)</span>
<a id="__codelineno-518-8" name="__codelineno-518-8"></a>
<a id="__codelineno-518-9" name="__codelineno-518-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-518-10" name="__codelineno-518-10"></a><span class="w">    </span><span class="nx">filePath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;example.txt&quot;</span>
<a id="__codelineno-518-11" name="__codelineno-518-11"></a>
<a id="__codelineno-518-12" name="__codelineno-518-12"></a><span class="w">    </span><span class="nx">info</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
<a id="__codelineno-518-13" name="__codelineno-518-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-518-14" name="__codelineno-518-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取文件信息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-518-15" name="__codelineno-518-15"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-518-16" name="__codelineno-518-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-518-17" name="__codelineno-518-17"></a>
<a id="__codelineno-518-18" name="__codelineno-518-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">stat</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Sys</span><span class="p">().(</span><span class="o">*</span><span class="nx">syscall</span><span class="p">.</span><span class="nx">Stat_t</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-518-19" name="__codelineno-518-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;文件所有者UID: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">stat</span><span class="p">.</span><span class="nx">Uid</span><span class="p">)</span>
<a id="__codelineno-518-20" name="__codelineno-518-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;文件所有者GID: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">stat</span><span class="p">.</span><span class="nx">Gid</span><span class="p">)</span>
<a id="__codelineno-518-21" name="__codelineno-518-21"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-518-22" name="__codelineno-518-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;无法获取文件所有者信息&quot;</span><span class="p">)</span>
<a id="__codelineno-518-23" name="__codelineno-518-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-518-24" name="__codelineno-518-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-519-1">1</a></span>
<span class="normal"><a href="#__codelineno-519-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-519-1" name="__codelineno-519-1"></a>文件所有者UID: 1000
<a id="__codelineno-519-2" name="__codelineno-519-2"></a>文件所有者GID: 1000
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>info.Sys()</code>返回的是底层数据结构，可以通过类型断言将其转换为<code>*syscall.Stat_t</code>以访问UID和GID。</li>
<li>这种方式依赖于操作系统，跨平台时需注意兼容性。</li>
</ul>
<h4 id="修改文件权限">修改文件权限<a class="headerlink" href="#修改文件权限" title="Permanent link">&para;</a></h4>
<p>使用<code>os.Chmod</code>函数可以修改文件的权限。</p>
<p><strong>示例：修改文件权限为可执行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-520-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-520-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-520-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-520-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-520-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-520-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-520-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-520-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-520-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-520-10">10</a></span>
<span class="normal"><a href="#__codelineno-520-11">11</a></span>
<span class="normal"><a href="#__codelineno-520-12">12</a></span>
<span class="normal"><a href="#__codelineno-520-13">13</a></span>
<span class="normal"><a href="#__codelineno-520-14">14</a></span>
<span class="normal"><a href="#__codelineno-520-15">15</a></span>
<span class="normal"><a href="#__codelineno-520-16">16</a></span>
<span class="normal"><a href="#__codelineno-520-17">17</a></span>
<span class="normal"><a href="#__codelineno-520-18">18</a></span>
<span class="normal"><a href="#__codelineno-520-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-520-1" name="__codelineno-520-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-520-2" name="__codelineno-520-2"></a>
<a id="__codelineno-520-3" name="__codelineno-520-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-520-4" name="__codelineno-520-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-520-5" name="__codelineno-520-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-520-6" name="__codelineno-520-6"></a><span class="p">)</span>
<a id="__codelineno-520-7" name="__codelineno-520-7"></a>
<a id="__codelineno-520-8" name="__codelineno-520-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-520-9" name="__codelineno-520-9"></a><span class="w">    </span><span class="nx">filePath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;script.sh&quot;</span>
<a id="__codelineno-520-10" name="__codelineno-520-10"></a>
<a id="__codelineno-520-11" name="__codelineno-520-11"></a><span class="w">    </span><span class="c1">// 修改文件权限为可执行</span>
<a id="__codelineno-520-12" name="__codelineno-520-12"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Chmod</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="w"> </span><span class="mo">0755</span><span class="p">)</span>
<a id="__codelineno-520-13" name="__codelineno-520-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-520-14" name="__codelineno-520-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改文件权限失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-520-15" name="__codelineno-520-15"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-520-16" name="__codelineno-520-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-520-17" name="__codelineno-520-17"></a>
<a id="__codelineno-520-18" name="__codelineno-520-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件权限修改成功&quot;</span><span class="p">)</span>
<a id="__codelineno-520-19" name="__codelineno-520-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-521-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-521-1" name="__codelineno-521-1"></a>文件权限修改成功
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Chmod</code>将<code>script.sh</code>的权限设置为<code>0755</code>，即所有者有读、写、执行权限，组用户和其他用户有读、执行权限。</li>
</ul>
<h4 id="重命名文件">重命名文件<a class="headerlink" href="#重命名文件" title="Permanent link">&para;</a></h4>
<p>使用<code>os.Rename</code>函数可以重命名文件或移动文件到新的位置。</p>
<p><strong>示例：重命名文件</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-522-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-522-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-522-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-522-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-522-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-522-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-522-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-522-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-522-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-522-10">10</a></span>
<span class="normal"><a href="#__codelineno-522-11">11</a></span>
<span class="normal"><a href="#__codelineno-522-12">12</a></span>
<span class="normal"><a href="#__codelineno-522-13">13</a></span>
<span class="normal"><a href="#__codelineno-522-14">14</a></span>
<span class="normal"><a href="#__codelineno-522-15">15</a></span>
<span class="normal"><a href="#__codelineno-522-16">16</a></span>
<span class="normal"><a href="#__codelineno-522-17">17</a></span>
<span class="normal"><a href="#__codelineno-522-18">18</a></span>
<span class="normal"><a href="#__codelineno-522-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-522-1" name="__codelineno-522-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-522-2" name="__codelineno-522-2"></a>
<a id="__codelineno-522-3" name="__codelineno-522-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-522-4" name="__codelineno-522-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-522-5" name="__codelineno-522-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-522-6" name="__codelineno-522-6"></a><span class="p">)</span>
<a id="__codelineno-522-7" name="__codelineno-522-7"></a>
<a id="__codelineno-522-8" name="__codelineno-522-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-522-9" name="__codelineno-522-9"></a><span class="w">    </span><span class="nx">oldName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;oldname.txt&quot;</span>
<a id="__codelineno-522-10" name="__codelineno-522-10"></a><span class="w">    </span><span class="nx">newName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;newname.txt&quot;</span>
<a id="__codelineno-522-11" name="__codelineno-522-11"></a>
<a id="__codelineno-522-12" name="__codelineno-522-12"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Rename</span><span class="p">(</span><span class="nx">oldName</span><span class="p">,</span><span class="w"> </span><span class="nx">newName</span><span class="p">)</span>
<a id="__codelineno-522-13" name="__codelineno-522-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-522-14" name="__codelineno-522-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;重命名文件失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-522-15" name="__codelineno-522-15"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-522-16" name="__codelineno-522-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-522-17" name="__codelineno-522-17"></a>
<a id="__codelineno-522-18" name="__codelineno-522-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;文件已从 %s 重命名为 %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">oldName</span><span class="p">,</span><span class="w"> </span><span class="nx">newName</span><span class="p">)</span>
<a id="__codelineno-522-19" name="__codelineno-522-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-523-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-523-1" name="__codelineno-523-1"></a>文件已从 oldname.txt 重命名为 newname.txt
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>os.Rename</code>将<code>oldname.txt</code>重命名为<code>newname.txt</code>。</li>
<li>如果新名称位于不同的目录，则实现了文件的移动。</li>
</ul>
<h4 id="获取文件大小和修改时间">获取文件大小和修改时间<a class="headerlink" href="#获取文件大小和修改时间" title="Permanent link">&para;</a></h4>
<p>通过<code>FileInfo</code>接口的<code>Size()</code>和<code>ModTime()</code>方法，可以获取文件的大小和最后修改时间。</p>
<p><strong>示例：获取文件大小和修改时间</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-524-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-524-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-524-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-524-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-524-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-524-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-524-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-524-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-524-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-524-10">10</a></span>
<span class="normal"><a href="#__codelineno-524-11">11</a></span>
<span class="normal"><a href="#__codelineno-524-12">12</a></span>
<span class="normal"><a href="#__codelineno-524-13">13</a></span>
<span class="normal"><a href="#__codelineno-524-14">14</a></span>
<span class="normal"><a href="#__codelineno-524-15">15</a></span>
<span class="normal"><a href="#__codelineno-524-16">16</a></span>
<span class="normal"><a href="#__codelineno-524-17">17</a></span>
<span class="normal"><a href="#__codelineno-524-18">18</a></span>
<span class="normal"><a href="#__codelineno-524-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-524-1" name="__codelineno-524-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-524-2" name="__codelineno-524-2"></a>
<a id="__codelineno-524-3" name="__codelineno-524-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-524-4" name="__codelineno-524-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-524-5" name="__codelineno-524-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-524-6" name="__codelineno-524-6"></a><span class="p">)</span>
<a id="__codelineno-524-7" name="__codelineno-524-7"></a>
<a id="__codelineno-524-8" name="__codelineno-524-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-524-9" name="__codelineno-524-9"></a><span class="w">    </span><span class="nx">filePath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;example.txt&quot;</span>
<a id="__codelineno-524-10" name="__codelineno-524-10"></a>
<a id="__codelineno-524-11" name="__codelineno-524-11"></a><span class="w">    </span><span class="nx">info</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
<a id="__codelineno-524-12" name="__codelineno-524-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-524-13" name="__codelineno-524-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;获取文件信息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-524-14" name="__codelineno-524-14"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-524-15" name="__codelineno-524-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-524-16" name="__codelineno-524-16"></a>
<a id="__codelineno-524-17" name="__codelineno-524-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;文件大小: %d 字节\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Size</span><span class="p">())</span>
<a id="__codelineno-524-18" name="__codelineno-524-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;最后修改时间: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">ModTime</span><span class="p">())</span>
<a id="__codelineno-524-19" name="__codelineno-524-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-525-1">1</a></span>
<span class="normal"><a href="#__codelineno-525-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-525-1" name="__codelineno-525-1"></a>文件大小: 1234 字节
<a id="__codelineno-525-2" name="__codelineno-525-2"></a>最后修改时间: 2024-04-27 10:15:30 +0800 CST
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>info.Size()</code>返回文件的大小，以字节为单位。</li>
<li><code>info.ModTime()</code>返回文件的最后修改时间。</li>
</ul>
<h4 id="注意事项_17">注意事项<a class="headerlink" href="#注意事项_17" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>路径处理</strong>：使用<code>filepath</code>包中的函数（如<code>filepath.Join</code>）构建文件路径，以确保跨平台的路径兼容性。</li>
<li><strong>并发访问</strong>：在多Goroutine环境中访问同一个文件时，注意同步机制，防止数据竞争和文件损坏。</li>
<li><strong>异常情况处理</strong>：处理文件不存在、权限不足等异常情况，确保程序的健壮性。</li>
<li><strong>文件锁</strong>：在需要防止多个进程或Goroutine同时写入同一个文件时，可以使用文件锁机制（需要借助第三方库或操作系统特定的功能）。</li>
</ul>
<h2 id="12-网络编程">12. 网络编程<a class="headerlink" href="#12-网络编程" title="Permanent link">&para;</a></h2>
<p>网络编程是构建分布式系统、Web应用程序和各种网络服务的基础。Go语言凭借其内置的并发机制和简洁的语法，成为开发高性能网络应用的理想选择。本章将深入探讨Go语言中的网络编程，包括HTTP编程和Socket编程。通过详细的示例和解释，帮助你理解并掌握在Go中构建网络服务和客户端的技巧，从而开发出高效、可靠的网络应用程序。</p>
<h3 id="121-http-编程">12.1 HTTP 编程<a class="headerlink" href="#121-http-编程" title="Permanent link">&para;</a></h3>
<p>HTTP（HyperText Transfer Protocol）是Web的基础协议，用于在客户端和服务器之间传输数据。Go语言的<code>net/http</code>包提供了丰富的功能，使得构建HTTP服务器和客户端变得简单而高效。</p>
<h4 id="使用-nethttp-包">使用 <code>net/http</code> 包<a class="headerlink" href="#使用-nethttp-包" title="Permanent link">&para;</a></h4>
<p><code>net/http</code>包是Go标准库中用于处理HTTP协议的核心包。它提供了构建HTTP服务器、客户端以及处理HTTP请求和响应的工具。</p>
<p><strong>关键组件：</strong></p>
<ul>
<li><strong>Handler 接口</strong>：定义了处理HTTP请求的能力。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-526-1">1</a></span>
<span class="normal"><a href="#__codelineno-526-2">2</a></span>
<span class="normal"><a href="#__codelineno-526-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-526-1" name="__codelineno-526-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Handler</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-526-2" name="__codelineno-526-2"></a><span class="w">    </span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">Request</span><span class="p">)</span>
<a id="__codelineno-526-3" name="__codelineno-526-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><strong>ResponseWriter</strong>：用于构建HTTP响应。</p>
</li>
<li>
<p><strong>Request</strong>：包含HTTP请求的详细信息。</p>
</li>
</ul>
<p><strong>基本示例：</strong></p>
<p>下面的示例展示了如何使用<code>net/http</code>包创建一个简单的HTTP服务器，并处理根路径（<code>/</code>）的请求。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-527-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-527-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-527-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-527-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-527-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-527-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-527-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-527-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-527-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-527-10">10</a></span>
<span class="normal"><a href="#__codelineno-527-11">11</a></span>
<span class="normal"><a href="#__codelineno-527-12">12</a></span>
<span class="normal"><a href="#__codelineno-527-13">13</a></span>
<span class="normal"><a href="#__codelineno-527-14">14</a></span>
<span class="normal"><a href="#__codelineno-527-15">15</a></span>
<span class="normal"><a href="#__codelineno-527-16">16</a></span>
<span class="normal"><a href="#__codelineno-527-17">17</a></span>
<span class="normal"><a href="#__codelineno-527-18">18</a></span>
<span class="normal"><a href="#__codelineno-527-19">19</a></span>
<span class="normal"><a href="#__codelineno-527-20">20</a></span>
<span class="normal"><a href="#__codelineno-527-21">21</a></span>
<span class="normal"><a href="#__codelineno-527-22">22</a></span>
<span class="normal"><a href="#__codelineno-527-23">23</a></span>
<span class="normal"><a href="#__codelineno-527-24">24</a></span>
<span class="normal"><a href="#__codelineno-527-25">25</a></span>
<span class="normal"><a href="#__codelineno-527-26">26</a></span>
<span class="normal"><a href="#__codelineno-527-27">27</a></span>
<span class="normal"><a href="#__codelineno-527-28">28</a></span>
<span class="normal"><a href="#__codelineno-527-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-527-1" name="__codelineno-527-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-527-2" name="__codelineno-527-2"></a>
<a id="__codelineno-527-3" name="__codelineno-527-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-527-4" name="__codelineno-527-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-527-5" name="__codelineno-527-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-527-6" name="__codelineno-527-6"></a><span class="p">)</span>
<a id="__codelineno-527-7" name="__codelineno-527-7"></a>
<a id="__codelineno-527-8" name="__codelineno-527-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">helloHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-527-9" name="__codelineno-527-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-527-10" name="__codelineno-527-10"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;404 not found.&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">)</span>
<a id="__codelineno-527-11" name="__codelineno-527-11"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-527-12" name="__codelineno-527-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-527-13" name="__codelineno-527-13"></a>
<a id="__codelineno-527-14" name="__codelineno-527-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-527-15" name="__codelineno-527-15"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Method is not supported.&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">)</span>
<a id="__codelineno-527-16" name="__codelineno-527-16"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-527-17" name="__codelineno-527-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-527-18" name="__codelineno-527-18"></a>
<a id="__codelineno-527-19" name="__codelineno-527-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-527-20" name="__codelineno-527-20"></a><span class="p">}</span>
<a id="__codelineno-527-21" name="__codelineno-527-21"></a>
<a id="__codelineno-527-22" name="__codelineno-527-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-527-23" name="__codelineno-527-23"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">helloHandler</span><span class="p">)</span>
<a id="__codelineno-527-24" name="__codelineno-527-24"></a>
<a id="__codelineno-527-25" name="__codelineno-527-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;启动服务器在 :8080&quot;</span><span class="p">)</span>
<a id="__codelineno-527-26" name="__codelineno-527-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-527-27" name="__codelineno-527-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;服务器启动失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-527-28" name="__codelineno-527-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-527-29" name="__codelineno-527-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>http.HandleFunc</code>注册了一个处理函数<code>helloHandler</code>，用于处理根路径的HTTP请求。</li>
<li><code>http.ListenAndServe</code>启动HTTP服务器，监听端口8080。</li>
<li><code>helloHandler</code>函数检查请求的路径和方法，若符合条件，则响应“Hello, World!”。</li>
</ul>
<p><strong>运行结果：</strong></p>
<p>启动服务器后，在浏览器中访问<code>http://localhost:8080/</code>，将看到以下内容：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-528-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-528-1" name="__codelineno-528-1"></a>Hello, World!
</code></pre></div></td></tr></table></div>
<h4 id="创建-http-服务">创建 HTTP 服务<a class="headerlink" href="#创建-http-服务" title="Permanent link">&para;</a></h4>
<p>构建更复杂的HTTP服务通常涉及路由、处理不同的HTTP方法、解析请求参数以及构建响应。Go的<code>net/http</code>包支持这些功能，并且可以与第三方路由库（如<code>gorilla/mux</code>）结合使用，以增强路由能力。</p>
<p><strong>示例：构建一个简单的RESTful API</strong></p>
<p>以下示例展示了如何构建一个简单的RESTful API，支持获取和创建用户资源。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-529-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-529-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-529-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-529-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-529-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-529-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-529-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-529-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-529-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-529-10">10</a></span>
<span class="normal"><a href="#__codelineno-529-11">11</a></span>
<span class="normal"><a href="#__codelineno-529-12">12</a></span>
<span class="normal"><a href="#__codelineno-529-13">13</a></span>
<span class="normal"><a href="#__codelineno-529-14">14</a></span>
<span class="normal"><a href="#__codelineno-529-15">15</a></span>
<span class="normal"><a href="#__codelineno-529-16">16</a></span>
<span class="normal"><a href="#__codelineno-529-17">17</a></span>
<span class="normal"><a href="#__codelineno-529-18">18</a></span>
<span class="normal"><a href="#__codelineno-529-19">19</a></span>
<span class="normal"><a href="#__codelineno-529-20">20</a></span>
<span class="normal"><a href="#__codelineno-529-21">21</a></span>
<span class="normal"><a href="#__codelineno-529-22">22</a></span>
<span class="normal"><a href="#__codelineno-529-23">23</a></span>
<span class="normal"><a href="#__codelineno-529-24">24</a></span>
<span class="normal"><a href="#__codelineno-529-25">25</a></span>
<span class="normal"><a href="#__codelineno-529-26">26</a></span>
<span class="normal"><a href="#__codelineno-529-27">27</a></span>
<span class="normal"><a href="#__codelineno-529-28">28</a></span>
<span class="normal"><a href="#__codelineno-529-29">29</a></span>
<span class="normal"><a href="#__codelineno-529-30">30</a></span>
<span class="normal"><a href="#__codelineno-529-31">31</a></span>
<span class="normal"><a href="#__codelineno-529-32">32</a></span>
<span class="normal"><a href="#__codelineno-529-33">33</a></span>
<span class="normal"><a href="#__codelineno-529-34">34</a></span>
<span class="normal"><a href="#__codelineno-529-35">35</a></span>
<span class="normal"><a href="#__codelineno-529-36">36</a></span>
<span class="normal"><a href="#__codelineno-529-37">37</a></span>
<span class="normal"><a href="#__codelineno-529-38">38</a></span>
<span class="normal"><a href="#__codelineno-529-39">39</a></span>
<span class="normal"><a href="#__codelineno-529-40">40</a></span>
<span class="normal"><a href="#__codelineno-529-41">41</a></span>
<span class="normal"><a href="#__codelineno-529-42">42</a></span>
<span class="normal"><a href="#__codelineno-529-43">43</a></span>
<span class="normal"><a href="#__codelineno-529-44">44</a></span>
<span class="normal"><a href="#__codelineno-529-45">45</a></span>
<span class="normal"><a href="#__codelineno-529-46">46</a></span>
<span class="normal"><a href="#__codelineno-529-47">47</a></span>
<span class="normal"><a href="#__codelineno-529-48">48</a></span>
<span class="normal"><a href="#__codelineno-529-49">49</a></span>
<span class="normal"><a href="#__codelineno-529-50">50</a></span>
<span class="normal"><a href="#__codelineno-529-51">51</a></span>
<span class="normal"><a href="#__codelineno-529-52">52</a></span>
<span class="normal"><a href="#__codelineno-529-53">53</a></span>
<span class="normal"><a href="#__codelineno-529-54">54</a></span>
<span class="normal"><a href="#__codelineno-529-55">55</a></span>
<span class="normal"><a href="#__codelineno-529-56">56</a></span>
<span class="normal"><a href="#__codelineno-529-57">57</a></span>
<span class="normal"><a href="#__codelineno-529-58">58</a></span>
<span class="normal"><a href="#__codelineno-529-59">59</a></span>
<span class="normal"><a href="#__codelineno-529-60">60</a></span>
<span class="normal"><a href="#__codelineno-529-61">61</a></span>
<span class="normal"><a href="#__codelineno-529-62">62</a></span>
<span class="normal"><a href="#__codelineno-529-63">63</a></span>
<span class="normal"><a href="#__codelineno-529-64">64</a></span>
<span class="normal"><a href="#__codelineno-529-65">65</a></span>
<span class="normal"><a href="#__codelineno-529-66">66</a></span>
<span class="normal"><a href="#__codelineno-529-67">67</a></span>
<span class="normal"><a href="#__codelineno-529-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-529-1" name="__codelineno-529-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-529-2" name="__codelineno-529-2"></a>
<a id="__codelineno-529-3" name="__codelineno-529-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-529-4" name="__codelineno-529-4"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-529-5" name="__codelineno-529-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-529-6" name="__codelineno-529-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-529-7" name="__codelineno-529-7"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-529-8" name="__codelineno-529-8"></a><span class="p">)</span>
<a id="__codelineno-529-9" name="__codelineno-529-9"></a>
<a id="__codelineno-529-10" name="__codelineno-529-10"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-11" name="__codelineno-529-11"></a><span class="w">    </span><span class="nx">ID</span><span class="w">   </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;id&quot;`</span>
<a id="__codelineno-529-12" name="__codelineno-529-12"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<a id="__codelineno-529-13" name="__codelineno-529-13"></a><span class="p">}</span>
<a id="__codelineno-529-14" name="__codelineno-529-14"></a>
<a id="__codelineno-529-15" name="__codelineno-529-15"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-529-16" name="__codelineno-529-16"></a><span class="w">    </span><span class="nx">users</span><span class="w">   </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="nx">User</span><span class="p">{}</span>
<a id="__codelineno-529-17" name="__codelineno-529-17"></a><span class="w">    </span><span class="nx">nextID</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-529-18" name="__codelineno-529-18"></a><span class="w">    </span><span class="nx">usersMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-529-19" name="__codelineno-529-19"></a><span class="p">)</span>
<a id="__codelineno-529-20" name="__codelineno-529-20"></a>
<a id="__codelineno-529-21" name="__codelineno-529-21"></a><span class="kd">func</span><span class="w"> </span><span class="nx">getUsersHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-22" name="__codelineno-529-22"></a><span class="w">    </span><span class="nx">usersMu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-529-23" name="__codelineno-529-23"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">usersMu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-529-24" name="__codelineno-529-24"></a>
<a id="__codelineno-529-25" name="__codelineno-529-25"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-529-26" name="__codelineno-529-26"></a><span class="w">    </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">users</span><span class="p">)</span>
<a id="__codelineno-529-27" name="__codelineno-529-27"></a><span class="p">}</span>
<a id="__codelineno-529-28" name="__codelineno-529-28"></a>
<a id="__codelineno-529-29" name="__codelineno-529-29"></a><span class="kd">func</span><span class="w"> </span><span class="nx">createUserHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-30" name="__codelineno-529-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;POST&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-31" name="__codelineno-529-31"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Method not allowed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusMethodNotAllowed</span><span class="p">)</span>
<a id="__codelineno-529-32" name="__codelineno-529-32"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-529-33" name="__codelineno-529-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-529-34" name="__codelineno-529-34"></a>
<a id="__codelineno-529-35" name="__codelineno-529-35"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">newUser</span><span class="w"> </span><span class="nx">User</span>
<a id="__codelineno-529-36" name="__codelineno-529-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">).</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">newUser</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-37" name="__codelineno-529-37"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bad request&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">)</span>
<a id="__codelineno-529-38" name="__codelineno-529-38"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-529-39" name="__codelineno-529-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-529-40" name="__codelineno-529-40"></a>
<a id="__codelineno-529-41" name="__codelineno-529-41"></a><span class="w">    </span><span class="nx">usersMu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-529-42" name="__codelineno-529-42"></a><span class="w">    </span><span class="nx">newUser</span><span class="p">.</span><span class="nx">ID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">nextID</span>
<a id="__codelineno-529-43" name="__codelineno-529-43"></a><span class="w">    </span><span class="nx">nextID</span><span class="o">++</span>
<a id="__codelineno-529-44" name="__codelineno-529-44"></a><span class="w">    </span><span class="nx">users</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">newUser</span><span class="p">)</span>
<a id="__codelineno-529-45" name="__codelineno-529-45"></a><span class="w">    </span><span class="nx">usersMu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-529-46" name="__codelineno-529-46"></a>
<a id="__codelineno-529-47" name="__codelineno-529-47"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-529-48" name="__codelineno-529-48"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">)</span>
<a id="__codelineno-529-49" name="__codelineno-529-49"></a><span class="w">    </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">newUser</span><span class="p">)</span>
<a id="__codelineno-529-50" name="__codelineno-529-50"></a><span class="p">}</span>
<a id="__codelineno-529-51" name="__codelineno-529-51"></a>
<a id="__codelineno-529-52" name="__codelineno-529-52"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-53" name="__codelineno-529-53"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-54" name="__codelineno-529-54"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-55" name="__codelineno-529-55"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="p">:</span>
<a id="__codelineno-529-56" name="__codelineno-529-56"></a><span class="w">            </span><span class="nx">getUsersHandler</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-529-57" name="__codelineno-529-57"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;POST&quot;</span><span class="p">:</span>
<a id="__codelineno-529-58" name="__codelineno-529-58"></a><span class="w">            </span><span class="nx">createUserHandler</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-529-59" name="__codelineno-529-59"></a><span class="w">        </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-529-60" name="__codelineno-529-60"></a><span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Method not allowed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusMethodNotAllowed</span><span class="p">)</span>
<a id="__codelineno-529-61" name="__codelineno-529-61"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-529-62" name="__codelineno-529-62"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-529-63" name="__codelineno-529-63"></a>
<a id="__codelineno-529-64" name="__codelineno-529-64"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;启动服务器在 :8080&quot;</span><span class="p">)</span>
<a id="__codelineno-529-65" name="__codelineno-529-65"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-529-66" name="__codelineno-529-66"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;服务器启动失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-529-67" name="__codelineno-529-67"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-529-68" name="__codelineno-529-68"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>
<p><strong>数据结构</strong>：定义了一个<code>User</code>结构体，包含ID和Name字段。</p>
</li>
<li>
<p><strong>存储</strong>：使用切片<code>users</code>存储用户数据，并通过<code>usersMu</code>互斥锁保护并发访问。</p>
</li>
<li>
<p>处理函数</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>getUsersHandler</code>：处理GET请求，返回所有用户的JSON列表。</li>
<li>
<p><code>createUserHandler</code>：处理POST请求，解析请求体中的用户数据，分配ID并添加到用户列表中。</p>
</li>
<li>
<p><strong>路由</strong>：在<code>/users</code>路径上，根据HTTP方法调用相应的处理函数。</p>
</li>
</ul>
<p><strong>测试 API：</strong></p>
<ol>
<li><strong>获取用户列表（GET 请求）</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-530-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-530-1" name="__codelineno-530-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-531-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-531-1" name="__codelineno-531-1"></a><span class="p">[]</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>创建新用户（POST 请求）</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-532-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-532-1" name="__codelineno-532-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/users<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Alice&quot;}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-533-1">1</a></span>
<span class="normal"><a href="#__codelineno-533-2">2</a></span>
<span class="normal"><a href="#__codelineno-533-3">3</a></span>
<span class="normal"><a href="#__codelineno-533-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-533-1" name="__codelineno-533-1"></a><span class="p">{</span>
<a id="__codelineno-533-2" name="__codelineno-533-2"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-533-3" name="__codelineno-533-3"></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span>
<a id="__codelineno-533-4" name="__codelineno-533-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>再次获取用户列表</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-534-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-534-1" name="__codelineno-534-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-535-1">1</a></span>
<span class="normal"><a href="#__codelineno-535-2">2</a></span>
<span class="normal"><a href="#__codelineno-535-3">3</a></span>
<span class="normal"><a href="#__codelineno-535-4">4</a></span>
<span class="normal"><a href="#__codelineno-535-5">5</a></span>
<span class="normal"><a href="#__codelineno-535-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-535-1" name="__codelineno-535-1"></a><span class="p">[</span>
<a id="__codelineno-535-2" name="__codelineno-535-2"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-535-3" name="__codelineno-535-3"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-535-4" name="__codelineno-535-4"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span>
<a id="__codelineno-535-5" name="__codelineno-535-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-535-6" name="__codelineno-535-6"></a><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h4 id="http-客户端">HTTP 客户端<a class="headerlink" href="#http-客户端" title="Permanent link">&para;</a></h4>
<p>除了构建HTTP服务器，Go还提供了强大的HTTP客户端功能，使得与外部HTTP服务进行通信变得简单。</p>
<p><strong>使用 <code>net/http</code> 发送GET请求</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-536-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-536-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-536-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-536-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-536-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-536-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-536-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-536-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-536-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-536-10">10</a></span>
<span class="normal"><a href="#__codelineno-536-11">11</a></span>
<span class="normal"><a href="#__codelineno-536-12">12</a></span>
<span class="normal"><a href="#__codelineno-536-13">13</a></span>
<span class="normal"><a href="#__codelineno-536-14">14</a></span>
<span class="normal"><a href="#__codelineno-536-15">15</a></span>
<span class="normal"><a href="#__codelineno-536-16">16</a></span>
<span class="normal"><a href="#__codelineno-536-17">17</a></span>
<span class="normal"><a href="#__codelineno-536-18">18</a></span>
<span class="normal"><a href="#__codelineno-536-19">19</a></span>
<span class="normal"><a href="#__codelineno-536-20">20</a></span>
<span class="normal"><a href="#__codelineno-536-21">21</a></span>
<span class="normal"><a href="#__codelineno-536-22">22</a></span>
<span class="normal"><a href="#__codelineno-536-23">23</a></span>
<span class="normal"><a href="#__codelineno-536-24">24</a></span>
<span class="normal"><a href="#__codelineno-536-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-536-1" name="__codelineno-536-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-536-2" name="__codelineno-536-2"></a>
<a id="__codelineno-536-3" name="__codelineno-536-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-536-4" name="__codelineno-536-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-536-5" name="__codelineno-536-5"></a><span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<a id="__codelineno-536-6" name="__codelineno-536-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-536-7" name="__codelineno-536-7"></a><span class="p">)</span>
<a id="__codelineno-536-8" name="__codelineno-536-8"></a>
<a id="__codelineno-536-9" name="__codelineno-536-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-536-10" name="__codelineno-536-10"></a><span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/users&quot;</span><span class="p">)</span>
<a id="__codelineno-536-11" name="__codelineno-536-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-536-12" name="__codelineno-536-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;请求失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-536-13" name="__codelineno-536-13"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-536-14" name="__codelineno-536-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-536-15" name="__codelineno-536-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-536-16" name="__codelineno-536-16"></a>
<a id="__codelineno-536-17" name="__codelineno-536-17"></a><span class="w">    </span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<a id="__codelineno-536-18" name="__codelineno-536-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-536-19" name="__codelineno-536-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取响应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-536-20" name="__codelineno-536-20"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-536-21" name="__codelineno-536-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-536-22" name="__codelineno-536-22"></a>
<a id="__codelineno-536-23" name="__codelineno-536-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;响应状态:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Status</span><span class="p">)</span>
<a id="__codelineno-536-24" name="__codelineno-536-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;响应内容:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">body</span><span class="p">))</span>
<a id="__codelineno-536-25" name="__codelineno-536-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>http.Get</code>发送GET请求到指定的URL。</li>
<li>读取响应体并输出状态和内容。</li>
<li>确保通过<code>defer resp.Body.Close()</code>关闭响应体，避免资源泄漏。</li>
</ul>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-537-1">1</a></span>
<span class="normal"><a href="#__codelineno-537-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-537-1" name="__codelineno-537-1"></a>响应状态: 200 OK
<a id="__codelineno-537-2" name="__codelineno-537-2"></a>响应内容: [{&quot;id&quot;:1,&quot;name&quot;:&quot;Alice&quot;}]
</code></pre></div></td></tr></table></div>
<p><strong>使用 <code>net/http</code> 发送POST请求</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-538-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-538-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-538-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-538-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-538-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-538-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-538-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-538-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-538-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-538-10">10</a></span>
<span class="normal"><a href="#__codelineno-538-11">11</a></span>
<span class="normal"><a href="#__codelineno-538-12">12</a></span>
<span class="normal"><a href="#__codelineno-538-13">13</a></span>
<span class="normal"><a href="#__codelineno-538-14">14</a></span>
<span class="normal"><a href="#__codelineno-538-15">15</a></span>
<span class="normal"><a href="#__codelineno-538-16">16</a></span>
<span class="normal"><a href="#__codelineno-538-17">17</a></span>
<span class="normal"><a href="#__codelineno-538-18">18</a></span>
<span class="normal"><a href="#__codelineno-538-19">19</a></span>
<span class="normal"><a href="#__codelineno-538-20">20</a></span>
<span class="normal"><a href="#__codelineno-538-21">21</a></span>
<span class="normal"><a href="#__codelineno-538-22">22</a></span>
<span class="normal"><a href="#__codelineno-538-23">23</a></span>
<span class="normal"><a href="#__codelineno-538-24">24</a></span>
<span class="normal"><a href="#__codelineno-538-25">25</a></span>
<span class="normal"><a href="#__codelineno-538-26">26</a></span>
<span class="normal"><a href="#__codelineno-538-27">27</a></span>
<span class="normal"><a href="#__codelineno-538-28">28</a></span>
<span class="normal"><a href="#__codelineno-538-29">29</a></span>
<span class="normal"><a href="#__codelineno-538-30">30</a></span>
<span class="normal"><a href="#__codelineno-538-31">31</a></span>
<span class="normal"><a href="#__codelineno-538-32">32</a></span>
<span class="normal"><a href="#__codelineno-538-33">33</a></span>
<span class="normal"><a href="#__codelineno-538-34">34</a></span>
<span class="normal"><a href="#__codelineno-538-35">35</a></span>
<span class="normal"><a href="#__codelineno-538-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-538-1" name="__codelineno-538-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-538-2" name="__codelineno-538-2"></a>
<a id="__codelineno-538-3" name="__codelineno-538-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-538-4" name="__codelineno-538-4"></a><span class="w">    </span><span class="s">&quot;bytes&quot;</span>
<a id="__codelineno-538-5" name="__codelineno-538-5"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-538-6" name="__codelineno-538-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-538-7" name="__codelineno-538-7"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-538-8" name="__codelineno-538-8"></a><span class="p">)</span>
<a id="__codelineno-538-9" name="__codelineno-538-9"></a>
<a id="__codelineno-538-10" name="__codelineno-538-10"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-538-11" name="__codelineno-538-11"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<a id="__codelineno-538-12" name="__codelineno-538-12"></a><span class="p">}</span>
<a id="__codelineno-538-13" name="__codelineno-538-13"></a>
<a id="__codelineno-538-14" name="__codelineno-538-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-538-15" name="__codelineno-538-15"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">}</span>
<a id="__codelineno-538-16" name="__codelineno-538-16"></a><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-538-17" name="__codelineno-538-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-538-18" name="__codelineno-538-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;JSON序列化失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-538-19" name="__codelineno-538-19"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-538-20" name="__codelineno-538-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-538-21" name="__codelineno-538-21"></a>
<a id="__codelineno-538-22" name="__codelineno-538-22"></a><span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Post</span><span class="p">(</span><span class="s">&quot;http://localhost:8080/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-538-23" name="__codelineno-538-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-538-24" name="__codelineno-538-24"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;请求失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-538-25" name="__codelineno-538-25"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-538-26" name="__codelineno-538-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-538-27" name="__codelineno-538-27"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-538-28" name="__codelineno-538-28"></a>
<a id="__codelineno-538-29" name="__codelineno-538-29"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">createdUser</span><span class="w"> </span><span class="nx">User</span>
<a id="__codelineno-538-30" name="__codelineno-538-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">).</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">createdUser</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-538-31" name="__codelineno-538-31"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;解析响应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-538-32" name="__codelineno-538-32"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-538-33" name="__codelineno-538-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-538-34" name="__codelineno-538-34"></a>
<a id="__codelineno-538-35" name="__codelineno-538-35"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建的用户:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">createdUser</span><span class="p">)</span>
<a id="__codelineno-538-36" name="__codelineno-538-36"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-539-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-539-1" name="__codelineno-539-1"></a>创建的用户: {Bob}
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>创建一个<code>User</code>实例，并将其序列化为JSON。</li>
<li>使用<code>http.Post</code>发送POST请求，将JSON数据作为请求体。</li>
<li>解析响应中的创建用户信息。</li>
</ul>
<p><strong>高级客户端功能：</strong></p>
<ul>
<li><strong>自定义请求</strong>：使用<code>http.NewRequest</code>创建自定义的HTTP请求，可以设置更多的请求属性，如头信息、方法等。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-540-1">1</a></span>
<span class="normal"><a href="#__codelineno-540-2">2</a></span>
<span class="normal"><a href="#__codelineno-540-3">3</a></span>
<span class="normal"><a href="#__codelineno-540-4">4</a></span>
<span class="normal"><a href="#__codelineno-540-5">5</a></span>
<span class="normal"><a href="#__codelineno-540-6">6</a></span>
<span class="normal"><a href="#__codelineno-540-7">7</a></span>
<span class="normal"><a href="#__codelineno-540-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-540-1" name="__codelineno-540-1"></a><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8080/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-540-2" name="__codelineno-540-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-540-3" name="__codelineno-540-3"></a><span class="w">    </span><span class="c1">// 处理错误</span>
<a id="__codelineno-540-4" name="__codelineno-540-4"></a><span class="p">}</span>
<a id="__codelineno-540-5" name="__codelineno-540-5"></a><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bearer token&quot;</span><span class="p">)</span>
<a id="__codelineno-540-6" name="__codelineno-540-6"></a>
<a id="__codelineno-540-7" name="__codelineno-540-7"></a><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{}</span>
<a id="__codelineno-540-8" name="__codelineno-540-8"></a><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>处理响应</strong>：除了读取响应体，还可以检查响应头、状态码等。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-541-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-541-1" name="__codelineno-541-1"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Content-Type:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_18">注意事项<a class="headerlink" href="#注意事项_18" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>错误处理</strong>：始终检查HTTP请求和响应中的错误，确保程序能够正确处理网络异常。</p>
</li>
<li>
<p><strong>资源管理</strong>：确保在完成HTTP请求后关闭响应体，避免资源泄漏。</p>
</li>
<li>
<p><strong>超时设置</strong>：为HTTP客户端设置超时时间，防止请求长时间阻塞。</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-542-1">1</a></span>
<span class="normal"><a href="#__codelineno-542-2">2</a></span>
<span class="normal"><a href="#__codelineno-542-3">3</a></span>
<span class="normal"><a href="#__codelineno-542-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-542-1" name="__codelineno-542-1"></a><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{</span>
<a id="__codelineno-542-2" name="__codelineno-542-2"></a><span class="w">    </span><span class="nx">Timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<a id="__codelineno-542-3" name="__codelineno-542-3"></a><span class="p">}</span>
<a id="__codelineno-542-4" name="__codelineno-542-4"></a><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;http://example.com&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>并发请求</strong>：在需要发送多个并发HTTP请求时，结合Goroutine和Channel可以高效地管理并发。</li>
</ul>
<h3 id="122-socket-编程">12.2 Socket 编程<a class="headerlink" href="#122-socket-编程" title="Permanent link">&para;</a></h3>
<p>Socket编程是构建低级别网络通信的基础，允许开发者在网络层面上控制数据的发送和接收。Go语言提供了强大的Socket编程支持，通过<code>net</code>包可以轻松实现TCP和UDP的服务端与客户端。</p>
<h4 id="tcp-服务端与客户端">TCP 服务端与客户端<a class="headerlink" href="#tcp-服务端与客户端" title="Permanent link">&para;</a></h4>
<p>TCP（Transmission Control Protocol）是一种面向连接的、可靠的传输协议，适用于需要保证数据顺序和完整性的应用。</p>
<p><strong>1. TCP 服务端</strong></p>
<p>下面的示例展示了如何创建一个简单的TCP服务端，监听端口8081，并处理客户端的连接。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-543-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-543-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-543-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-543-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-543-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-543-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-543-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-543-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-543-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-543-10">10</a></span>
<span class="normal"><a href="#__codelineno-543-11">11</a></span>
<span class="normal"><a href="#__codelineno-543-12">12</a></span>
<span class="normal"><a href="#__codelineno-543-13">13</a></span>
<span class="normal"><a href="#__codelineno-543-14">14</a></span>
<span class="normal"><a href="#__codelineno-543-15">15</a></span>
<span class="normal"><a href="#__codelineno-543-16">16</a></span>
<span class="normal"><a href="#__codelineno-543-17">17</a></span>
<span class="normal"><a href="#__codelineno-543-18">18</a></span>
<span class="normal"><a href="#__codelineno-543-19">19</a></span>
<span class="normal"><a href="#__codelineno-543-20">20</a></span>
<span class="normal"><a href="#__codelineno-543-21">21</a></span>
<span class="normal"><a href="#__codelineno-543-22">22</a></span>
<span class="normal"><a href="#__codelineno-543-23">23</a></span>
<span class="normal"><a href="#__codelineno-543-24">24</a></span>
<span class="normal"><a href="#__codelineno-543-25">25</a></span>
<span class="normal"><a href="#__codelineno-543-26">26</a></span>
<span class="normal"><a href="#__codelineno-543-27">27</a></span>
<span class="normal"><a href="#__codelineno-543-28">28</a></span>
<span class="normal"><a href="#__codelineno-543-29">29</a></span>
<span class="normal"><a href="#__codelineno-543-30">30</a></span>
<span class="normal"><a href="#__codelineno-543-31">31</a></span>
<span class="normal"><a href="#__codelineno-543-32">32</a></span>
<span class="normal"><a href="#__codelineno-543-33">33</a></span>
<span class="normal"><a href="#__codelineno-543-34">34</a></span>
<span class="normal"><a href="#__codelineno-543-35">35</a></span>
<span class="normal"><a href="#__codelineno-543-36">36</a></span>
<span class="normal"><a href="#__codelineno-543-37">37</a></span>
<span class="normal"><a href="#__codelineno-543-38">38</a></span>
<span class="normal"><a href="#__codelineno-543-39">39</a></span>
<span class="normal"><a href="#__codelineno-543-40">40</a></span>
<span class="normal"><a href="#__codelineno-543-41">41</a></span>
<span class="normal"><a href="#__codelineno-543-42">42</a></span>
<span class="normal"><a href="#__codelineno-543-43">43</a></span>
<span class="normal"><a href="#__codelineno-543-44">44</a></span>
<span class="normal"><a href="#__codelineno-543-45">45</a></span>
<span class="normal"><a href="#__codelineno-543-46">46</a></span>
<span class="normal"><a href="#__codelineno-543-47">47</a></span>
<span class="normal"><a href="#__codelineno-543-48">48</a></span>
<span class="normal"><a href="#__codelineno-543-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-543-1" name="__codelineno-543-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-543-2" name="__codelineno-543-2"></a>
<a id="__codelineno-543-3" name="__codelineno-543-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-543-4" name="__codelineno-543-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-543-5" name="__codelineno-543-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-543-6" name="__codelineno-543-6"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-543-7" name="__codelineno-543-7"></a><span class="p">)</span>
<a id="__codelineno-543-8" name="__codelineno-543-8"></a>
<a id="__codelineno-543-9" name="__codelineno-543-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-10" name="__codelineno-543-10"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-543-11" name="__codelineno-543-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;连接来自 %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">())</span>
<a id="__codelineno-543-12" name="__codelineno-543-12"></a>
<a id="__codelineno-543-13" name="__codelineno-543-13"></a><span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-543-14" name="__codelineno-543-14"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-15" name="__codelineno-543-15"></a><span class="w">        </span><span class="nx">text</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">()</span>
<a id="__codelineno-543-16" name="__codelineno-543-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;收到: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">)</span>
<a id="__codelineno-543-17" name="__codelineno-543-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;exit&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-18" name="__codelineno-543-18"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;关闭连接&quot;</span><span class="p">)</span>
<a id="__codelineno-543-19" name="__codelineno-543-19"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-543-20" name="__codelineno-543-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-543-21" name="__codelineno-543-21"></a><span class="w">        </span><span class="c1">// 回应客户端</span>
<a id="__codelineno-543-22" name="__codelineno-543-22"></a><span class="w">        </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;收到: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">))</span>
<a id="__codelineno-543-23" name="__codelineno-543-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-543-24" name="__codelineno-543-24"></a>
<a id="__codelineno-543-25" name="__codelineno-543-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-26" name="__codelineno-543-26"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取数据时出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-543-27" name="__codelineno-543-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-543-28" name="__codelineno-543-28"></a><span class="p">}</span>
<a id="__codelineno-543-29" name="__codelineno-543-29"></a>
<a id="__codelineno-543-30" name="__codelineno-543-30"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-31" name="__codelineno-543-31"></a><span class="w">    </span><span class="nx">listener</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8081&quot;</span><span class="p">)</span>
<a id="__codelineno-543-32" name="__codelineno-543-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-33" name="__codelineno-543-33"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;监听失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-543-34" name="__codelineno-543-34"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-543-35" name="__codelineno-543-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-543-36" name="__codelineno-543-36"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-543-37" name="__codelineno-543-37"></a>
<a id="__codelineno-543-38" name="__codelineno-543-38"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;TCP 服务端启动，监听端口 :8081&quot;</span><span class="p">)</span>
<a id="__codelineno-543-39" name="__codelineno-543-39"></a>
<a id="__codelineno-543-40" name="__codelineno-543-40"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-41" name="__codelineno-543-41"></a><span class="w">        </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Accept</span><span class="p">()</span>
<a id="__codelineno-543-42" name="__codelineno-543-42"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-543-43" name="__codelineno-543-43"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接受连接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-543-44" name="__codelineno-543-44"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-543-45" name="__codelineno-543-45"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-543-46" name="__codelineno-543-46"></a>
<a id="__codelineno-543-47" name="__codelineno-543-47"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span><span class="w"> </span><span class="c1">// 使用Goroutine处理连接</span>
<a id="__codelineno-543-48" name="__codelineno-543-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-543-49" name="__codelineno-543-49"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>net.Listen</code>创建一个TCP监听器，监听端口8081。</li>
<li><code>listener.Accept</code>等待并接受客户端的连接请求。</li>
<li>每个连接通过<code>handleConnection</code>函数处理，该函数在独立的Goroutine中运行，以支持并发连接。</li>
<li><code>handleConnection</code>读取客户端发送的数据，并回送确认信息。</li>
<li>当客户端发送“exit”时，服务端关闭连接。</li>
</ul>
<p><strong>运行结果：</strong></p>
<p>启动服务端后，服务端终端显示：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-544-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-544-1" name="__codelineno-544-1"></a>TCP 服务端启动，监听端口 :8081
</code></pre></div></td></tr></table></div>
<p><strong>2. TCP 客户端</strong></p>
<p>下面的示例展示了如何创建一个TCP客户端，连接到服务端并发送消息。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-545-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-545-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-545-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-545-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-545-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-545-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-545-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-545-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-545-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-545-10">10</a></span>
<span class="normal"><a href="#__codelineno-545-11">11</a></span>
<span class="normal"><a href="#__codelineno-545-12">12</a></span>
<span class="normal"><a href="#__codelineno-545-13">13</a></span>
<span class="normal"><a href="#__codelineno-545-14">14</a></span>
<span class="normal"><a href="#__codelineno-545-15">15</a></span>
<span class="normal"><a href="#__codelineno-545-16">16</a></span>
<span class="normal"><a href="#__codelineno-545-17">17</a></span>
<span class="normal"><a href="#__codelineno-545-18">18</a></span>
<span class="normal"><a href="#__codelineno-545-19">19</a></span>
<span class="normal"><a href="#__codelineno-545-20">20</a></span>
<span class="normal"><a href="#__codelineno-545-21">21</a></span>
<span class="normal"><a href="#__codelineno-545-22">22</a></span>
<span class="normal"><a href="#__codelineno-545-23">23</a></span>
<span class="normal"><a href="#__codelineno-545-24">24</a></span>
<span class="normal"><a href="#__codelineno-545-25">25</a></span>
<span class="normal"><a href="#__codelineno-545-26">26</a></span>
<span class="normal"><a href="#__codelineno-545-27">27</a></span>
<span class="normal"><a href="#__codelineno-545-28">28</a></span>
<span class="normal"><a href="#__codelineno-545-29">29</a></span>
<span class="normal"><a href="#__codelineno-545-30">30</a></span>
<span class="normal"><a href="#__codelineno-545-31">31</a></span>
<span class="normal"><a href="#__codelineno-545-32">32</a></span>
<span class="normal"><a href="#__codelineno-545-33">33</a></span>
<span class="normal"><a href="#__codelineno-545-34">34</a></span>
<span class="normal"><a href="#__codelineno-545-35">35</a></span>
<span class="normal"><a href="#__codelineno-545-36">36</a></span>
<span class="normal"><a href="#__codelineno-545-37">37</a></span>
<span class="normal"><a href="#__codelineno-545-38">38</a></span>
<span class="normal"><a href="#__codelineno-545-39">39</a></span>
<span class="normal"><a href="#__codelineno-545-40">40</a></span>
<span class="normal"><a href="#__codelineno-545-41">41</a></span>
<span class="normal"><a href="#__codelineno-545-42">42</a></span>
<span class="normal"><a href="#__codelineno-545-43">43</a></span>
<span class="normal"><a href="#__codelineno-545-44">44</a></span>
<span class="normal"><a href="#__codelineno-545-45">45</a></span>
<span class="normal"><a href="#__codelineno-545-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-545-1" name="__codelineno-545-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-545-2" name="__codelineno-545-2"></a>
<a id="__codelineno-545-3" name="__codelineno-545-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-545-4" name="__codelineno-545-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-545-5" name="__codelineno-545-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-545-6" name="__codelineno-545-6"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-545-7" name="__codelineno-545-7"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-545-8" name="__codelineno-545-8"></a><span class="p">)</span>
<a id="__codelineno-545-9" name="__codelineno-545-9"></a>
<a id="__codelineno-545-10" name="__codelineno-545-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-545-11" name="__codelineno-545-11"></a><span class="w">    </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Dial</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost:8081&quot;</span><span class="p">)</span>
<a id="__codelineno-545-12" name="__codelineno-545-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-545-13" name="__codelineno-545-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;连接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-545-14" name="__codelineno-545-14"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-545-15" name="__codelineno-545-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-545-16" name="__codelineno-545-16"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-545-17" name="__codelineno-545-17"></a>
<a id="__codelineno-545-18" name="__codelineno-545-18"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;连接到服务器，输入消息 (输入 &#39;exit&#39; 退出):&quot;</span><span class="p">)</span>
<a id="__codelineno-545-19" name="__codelineno-545-19"></a>
<a id="__codelineno-545-20" name="__codelineno-545-20"></a><span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
<a id="__codelineno-545-21" name="__codelineno-545-21"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-545-22" name="__codelineno-545-22"></a><span class="w">        </span><span class="nx">text</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">()</span>
<a id="__codelineno-545-23" name="__codelineno-545-23"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">text</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">))</span>
<a id="__codelineno-545-24" name="__codelineno-545-24"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-545-25" name="__codelineno-545-25"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送消息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-545-26" name="__codelineno-545-26"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-545-27" name="__codelineno-545-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-545-28" name="__codelineno-545-28"></a>
<a id="__codelineno-545-29" name="__codelineno-545-29"></a><span class="w">        </span><span class="c1">// 接收服务器的回应</span>
<a id="__codelineno-545-30" name="__codelineno-545-30"></a><span class="w">        </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">).</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
<a id="__codelineno-545-31" name="__codelineno-545-31"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-545-32" name="__codelineno-545-32"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接收回应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-545-33" name="__codelineno-545-33"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-545-34" name="__codelineno-545-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-545-35" name="__codelineno-545-35"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;服务器回应: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<a id="__codelineno-545-36" name="__codelineno-545-36"></a>
<a id="__codelineno-545-37" name="__codelineno-545-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;exit&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-545-38" name="__codelineno-545-38"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;退出客户端&quot;</span><span class="p">)</span>
<a id="__codelineno-545-39" name="__codelineno-545-39"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-545-40" name="__codelineno-545-40"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-545-41" name="__codelineno-545-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-545-42" name="__codelineno-545-42"></a>
<a id="__codelineno-545-43" name="__codelineno-545-43"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-545-44" name="__codelineno-545-44"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取标准输入时出错:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-545-45" name="__codelineno-545-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-545-46" name="__codelineno-545-46"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>net.Dial</code>连接到本地的TCP服务端（端口8081）。</li>
<li>从标准输入读取用户输入，并将其发送到服务端。</li>
<li>接收并打印服务端的回应。</li>
<li>当用户输入“exit”时，客户端关闭连接并退出。</li>
</ul>
<p><strong>运行结果：</strong></p>
<p>启动客户端后，可以与服务端进行交互：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-546-1">1</a></span>
<span class="normal"><a href="#__codelineno-546-2">2</a></span>
<span class="normal"><a href="#__codelineno-546-3">3</a></span>
<span class="normal"><a href="#__codelineno-546-4">4</a></span>
<span class="normal"><a href="#__codelineno-546-5">5</a></span>
<span class="normal"><a href="#__codelineno-546-6">6</a></span>
<span class="normal"><a href="#__codelineno-546-7">7</a></span>
<span class="normal"><a href="#__codelineno-546-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-546-1" name="__codelineno-546-1"></a>连接到服务器，输入消息 (输入 &#39;exit&#39; 退出):
<a id="__codelineno-546-2" name="__codelineno-546-2"></a>Hello
<a id="__codelineno-546-3" name="__codelineno-546-3"></a>服务器回应: 收到: Hello
<a id="__codelineno-546-4" name="__codelineno-546-4"></a>Go
<a id="__codelineno-546-5" name="__codelineno-546-5"></a>服务器回应: 收到: Go
<a id="__codelineno-546-6" name="__codelineno-546-6"></a>exit
<a id="__codelineno-546-7" name="__codelineno-546-7"></a>服务器回应: 收到: exit
<a id="__codelineno-546-8" name="__codelineno-546-8"></a>退出客户端
</code></pre></div></td></tr></table></div>
<p><strong>3. 并发处理</strong></p>
<p>TCP服务端通过Goroutine处理每个连接，支持高并发连接。这使得Go非常适合构建高性能的网络服务。</p>
<p><strong>示例：多并发客户端连接</strong></p>
<p>可以启动多个TCP客户端实例，连接到服务端并发送消息，服务端将同时处理所有连接。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-547-1">1</a></span>
<span class="normal"><a href="#__codelineno-547-2">2</a></span>
<span class="normal"><a href="#__codelineno-547-3">3</a></span>
<span class="normal"><a href="#__codelineno-547-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-547-1" name="__codelineno-547-1"></a><span class="c1"># 启动多个客户端</span>
<a id="__codelineno-547-2" name="__codelineno-547-2"></a>go<span class="w"> </span>run<span class="w"> </span>tcp_client.go
<a id="__codelineno-547-3" name="__codelineno-547-3"></a>go<span class="w"> </span>run<span class="w"> </span>tcp_client.go
<a id="__codelineno-547-4" name="__codelineno-547-4"></a>go<span class="w"> </span>run<span class="w"> </span>tcp_client.go
</code></pre></div></td></tr></table></div>
<p>服务端将同时显示来自多个客户端的连接和消息。</p>
<h4 id="udp-服务端与客户端">UDP 服务端与客户端<a class="headerlink" href="#udp-服务端与客户端" title="Permanent link">&para;</a></h4>
<p>UDP（User Datagram Protocol）是一种无连接的、不可靠的传输协议，适用于需要快速传输但不要求可靠性的应用，如实时视频、游戏等。</p>
<p><strong>1. UDP 服务端</strong></p>
<p>下面的示例展示了如何创建一个简单的UDP服务端，监听端口8082，并处理客户端发送的消息。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-548-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-548-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-548-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-548-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-548-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-548-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-548-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-548-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-548-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-548-10">10</a></span>
<span class="normal"><a href="#__codelineno-548-11">11</a></span>
<span class="normal"><a href="#__codelineno-548-12">12</a></span>
<span class="normal"><a href="#__codelineno-548-13">13</a></span>
<span class="normal"><a href="#__codelineno-548-14">14</a></span>
<span class="normal"><a href="#__codelineno-548-15">15</a></span>
<span class="normal"><a href="#__codelineno-548-16">16</a></span>
<span class="normal"><a href="#__codelineno-548-17">17</a></span>
<span class="normal"><a href="#__codelineno-548-18">18</a></span>
<span class="normal"><a href="#__codelineno-548-19">19</a></span>
<span class="normal"><a href="#__codelineno-548-20">20</a></span>
<span class="normal"><a href="#__codelineno-548-21">21</a></span>
<span class="normal"><a href="#__codelineno-548-22">22</a></span>
<span class="normal"><a href="#__codelineno-548-23">23</a></span>
<span class="normal"><a href="#__codelineno-548-24">24</a></span>
<span class="normal"><a href="#__codelineno-548-25">25</a></span>
<span class="normal"><a href="#__codelineno-548-26">26</a></span>
<span class="normal"><a href="#__codelineno-548-27">27</a></span>
<span class="normal"><a href="#__codelineno-548-28">28</a></span>
<span class="normal"><a href="#__codelineno-548-29">29</a></span>
<span class="normal"><a href="#__codelineno-548-30">30</a></span>
<span class="normal"><a href="#__codelineno-548-31">31</a></span>
<span class="normal"><a href="#__codelineno-548-32">32</a></span>
<span class="normal"><a href="#__codelineno-548-33">33</a></span>
<span class="normal"><a href="#__codelineno-548-34">34</a></span>
<span class="normal"><a href="#__codelineno-548-35">35</a></span>
<span class="normal"><a href="#__codelineno-548-36">36</a></span>
<span class="normal"><a href="#__codelineno-548-37">37</a></span>
<span class="normal"><a href="#__codelineno-548-38">38</a></span>
<span class="normal"><a href="#__codelineno-548-39">39</a></span>
<span class="normal"><a href="#__codelineno-548-40">40</a></span>
<span class="normal"><a href="#__codelineno-548-41">41</a></span>
<span class="normal"><a href="#__codelineno-548-42">42</a></span>
<span class="normal"><a href="#__codelineno-548-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-548-1" name="__codelineno-548-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-548-2" name="__codelineno-548-2"></a>
<a id="__codelineno-548-3" name="__codelineno-548-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-548-4" name="__codelineno-548-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-548-5" name="__codelineno-548-5"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-548-6" name="__codelineno-548-6"></a><span class="p">)</span>
<a id="__codelineno-548-7" name="__codelineno-548-7"></a>
<a id="__codelineno-548-8" name="__codelineno-548-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-548-9" name="__codelineno-548-9"></a><span class="w">    </span><span class="nx">addr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">ResolveUDPAddr</span><span class="p">(</span><span class="s">&quot;udp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8082&quot;</span><span class="p">)</span>
<a id="__codelineno-548-10" name="__codelineno-548-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-548-11" name="__codelineno-548-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;解析地址失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-548-12" name="__codelineno-548-12"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-548-13" name="__codelineno-548-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-548-14" name="__codelineno-548-14"></a>
<a id="__codelineno-548-15" name="__codelineno-548-15"></a><span class="w">    </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">ListenUDP</span><span class="p">(</span><span class="s">&quot;udp&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">addr</span><span class="p">)</span>
<a id="__codelineno-548-16" name="__codelineno-548-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-548-17" name="__codelineno-548-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;监听UDP失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-548-18" name="__codelineno-548-18"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-548-19" name="__codelineno-548-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-548-20" name="__codelineno-548-20"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-548-21" name="__codelineno-548-21"></a>
<a id="__codelineno-548-22" name="__codelineno-548-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;UDP 服务端启动，监听端口 :8082&quot;</span><span class="p">)</span>
<a id="__codelineno-548-23" name="__codelineno-548-23"></a>
<a id="__codelineno-548-24" name="__codelineno-548-24"></a><span class="w">    </span><span class="nx">buffer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-548-25" name="__codelineno-548-25"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-548-26" name="__codelineno-548-26"></a><span class="w">        </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">clientAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">ReadFromUDP</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
<a id="__codelineno-548-27" name="__codelineno-548-27"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-548-28" name="__codelineno-548-28"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取数据失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-548-29" name="__codelineno-548-29"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-548-30" name="__codelineno-548-30"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-548-31" name="__codelineno-548-31"></a>
<a id="__codelineno-548-32" name="__codelineno-548-32"></a><span class="w">        </span><span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">buffer</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
<a id="__codelineno-548-33" name="__codelineno-548-33"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;收到来自 %s 的消息: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">clientAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-548-34" name="__codelineno-548-34"></a>
<a id="__codelineno-548-35" name="__codelineno-548-35"></a><span class="w">        </span><span class="c1">// 回应客户端</span>
<a id="__codelineno-548-36" name="__codelineno-548-36"></a><span class="w">        </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;收到: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">message</span>
<a id="__codelineno-548-37" name="__codelineno-548-37"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">WriteToUDP</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">response</span><span class="p">),</span><span class="w"> </span><span class="nx">clientAddr</span><span class="p">)</span>
<a id="__codelineno-548-38" name="__codelineno-548-38"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-548-39" name="__codelineno-548-39"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送回应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-548-40" name="__codelineno-548-40"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-548-41" name="__codelineno-548-41"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-548-42" name="__codelineno-548-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-548-43" name="__codelineno-548-43"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>net.ResolveUDPAddr</code>解析UDP地址，监听端口8082。</li>
<li><code>net.ListenUDP</code>创建一个UDP连接，开始监听。</li>
<li>进入循环，不断接收来自客户端的消息。</li>
<li>接收到消息后，打印消息内容并回送确认信息。</li>
</ul>
<p><strong>2. UDP 客户端</strong></p>
<p>下面的示例展示了如何创建一个UDP客户端，发送消息到服务端并接收回应。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-549-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-549-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-549-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-549-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-549-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-549-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-549-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-549-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-549-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-549-10">10</a></span>
<span class="normal"><a href="#__codelineno-549-11">11</a></span>
<span class="normal"><a href="#__codelineno-549-12">12</a></span>
<span class="normal"><a href="#__codelineno-549-13">13</a></span>
<span class="normal"><a href="#__codelineno-549-14">14</a></span>
<span class="normal"><a href="#__codelineno-549-15">15</a></span>
<span class="normal"><a href="#__codelineno-549-16">16</a></span>
<span class="normal"><a href="#__codelineno-549-17">17</a></span>
<span class="normal"><a href="#__codelineno-549-18">18</a></span>
<span class="normal"><a href="#__codelineno-549-19">19</a></span>
<span class="normal"><a href="#__codelineno-549-20">20</a></span>
<span class="normal"><a href="#__codelineno-549-21">21</a></span>
<span class="normal"><a href="#__codelineno-549-22">22</a></span>
<span class="normal"><a href="#__codelineno-549-23">23</a></span>
<span class="normal"><a href="#__codelineno-549-24">24</a></span>
<span class="normal"><a href="#__codelineno-549-25">25</a></span>
<span class="normal"><a href="#__codelineno-549-26">26</a></span>
<span class="normal"><a href="#__codelineno-549-27">27</a></span>
<span class="normal"><a href="#__codelineno-549-28">28</a></span>
<span class="normal"><a href="#__codelineno-549-29">29</a></span>
<span class="normal"><a href="#__codelineno-549-30">30</a></span>
<span class="normal"><a href="#__codelineno-549-31">31</a></span>
<span class="normal"><a href="#__codelineno-549-32">32</a></span>
<span class="normal"><a href="#__codelineno-549-33">33</a></span>
<span class="normal"><a href="#__codelineno-549-34">34</a></span>
<span class="normal"><a href="#__codelineno-549-35">35</a></span>
<span class="normal"><a href="#__codelineno-549-36">36</a></span>
<span class="normal"><a href="#__codelineno-549-37">37</a></span>
<span class="normal"><a href="#__codelineno-549-38">38</a></span>
<span class="normal"><a href="#__codelineno-549-39">39</a></span>
<span class="normal"><a href="#__codelineno-549-40">40</a></span>
<span class="normal"><a href="#__codelineno-549-41">41</a></span>
<span class="normal"><a href="#__codelineno-549-42">42</a></span>
<span class="normal"><a href="#__codelineno-549-43">43</a></span>
<span class="normal"><a href="#__codelineno-549-44">44</a></span>
<span class="normal"><a href="#__codelineno-549-45">45</a></span>
<span class="normal"><a href="#__codelineno-549-46">46</a></span>
<span class="normal"><a href="#__codelineno-549-47">47</a></span>
<span class="normal"><a href="#__codelineno-549-48">48</a></span>
<span class="normal"><a href="#__codelineno-549-49">49</a></span>
<span class="normal"><a href="#__codelineno-549-50">50</a></span>
<span class="normal"><a href="#__codelineno-549-51">51</a></span>
<span class="normal"><a href="#__codelineno-549-52">52</a></span>
<span class="normal"><a href="#__codelineno-549-53">53</a></span>
<span class="normal"><a href="#__codelineno-549-54">54</a></span>
<span class="normal"><a href="#__codelineno-549-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-549-1" name="__codelineno-549-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-549-2" name="__codelineno-549-2"></a>
<a id="__codelineno-549-3" name="__codelineno-549-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-549-4" name="__codelineno-549-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-549-5" name="__codelineno-549-5"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-549-6" name="__codelineno-549-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-549-7" name="__codelineno-549-7"></a><span class="p">)</span>
<a id="__codelineno-549-8" name="__codelineno-549-8"></a>
<a id="__codelineno-549-9" name="__codelineno-549-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-10" name="__codelineno-549-10"></a><span class="w">    </span><span class="nx">serverAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">ResolveUDPAddr</span><span class="p">(</span><span class="s">&quot;udp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost:8082&quot;</span><span class="p">)</span>
<a id="__codelineno-549-11" name="__codelineno-549-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-12" name="__codelineno-549-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;解析服务器地址失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-549-13" name="__codelineno-549-13"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-549-14" name="__codelineno-549-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-549-15" name="__codelineno-549-15"></a>
<a id="__codelineno-549-16" name="__codelineno-549-16"></a><span class="w">    </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">DialUDP</span><span class="p">(</span><span class="s">&quot;udp&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">serverAddr</span><span class="p">)</span>
<a id="__codelineno-549-17" name="__codelineno-549-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-18" name="__codelineno-549-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;连接UDP服务器失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-549-19" name="__codelineno-549-19"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-549-20" name="__codelineno-549-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-549-21" name="__codelineno-549-21"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-549-22" name="__codelineno-549-22"></a>
<a id="__codelineno-549-23" name="__codelineno-549-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;UDP 客户端启动，输入消息 (输入 &#39;exit&#39; 退出):&quot;</span><span class="p">)</span>
<a id="__codelineno-549-24" name="__codelineno-549-24"></a>
<a id="__codelineno-549-25" name="__codelineno-549-25"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-26" name="__codelineno-549-26"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-549-27" name="__codelineno-549-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;&gt; &quot;</span><span class="p">)</span>
<a id="__codelineno-549-28" name="__codelineno-549-28"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Scanln</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-549-29" name="__codelineno-549-29"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-30" name="__codelineno-549-30"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取输入失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-549-31" name="__codelineno-549-31"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-549-32" name="__codelineno-549-32"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-549-33" name="__codelineno-549-33"></a>
<a id="__codelineno-549-34" name="__codelineno-549-34"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;exit&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-35" name="__codelineno-549-35"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;退出客户端&quot;</span><span class="p">)</span>
<a id="__codelineno-549-36" name="__codelineno-549-36"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-549-37" name="__codelineno-549-37"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-549-38" name="__codelineno-549-38"></a>
<a id="__codelineno-549-39" name="__codelineno-549-39"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">message</span><span class="p">))</span>
<a id="__codelineno-549-40" name="__codelineno-549-40"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-41" name="__codelineno-549-41"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送消息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-549-42" name="__codelineno-549-42"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-549-43" name="__codelineno-549-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-549-44" name="__codelineno-549-44"></a>
<a id="__codelineno-549-45" name="__codelineno-549-45"></a><span class="w">        </span><span class="c1">// 接收服务器回应</span>
<a id="__codelineno-549-46" name="__codelineno-549-46"></a><span class="w">        </span><span class="nx">buffer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-549-47" name="__codelineno-549-47"></a><span class="w">        </span><span class="nx">n</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">ReadFromUDP</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
<a id="__codelineno-549-48" name="__codelineno-549-48"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-549-49" name="__codelineno-549-49"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接收回应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-549-50" name="__codelineno-549-50"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-549-51" name="__codelineno-549-51"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-549-52" name="__codelineno-549-52"></a>
<a id="__codelineno-549-53" name="__codelineno-549-53"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;服务器回应:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">buffer</span><span class="p">[:</span><span class="nx">n</span><span class="p">]))</span>
<a id="__codelineno-549-54" name="__codelineno-549-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-549-55" name="__codelineno-549-55"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>net.ResolveUDPAddr</code>解析服务器的UDP地址。</li>
<li><code>net.DialUDP</code>创建一个UDP连接到服务器。</li>
<li>从标准输入读取用户输入，发送到服务器。</li>
<li>接收并打印服务器的回应。</li>
<li>当用户输入“exit”时，客户端关闭连接并退出。</li>
</ul>
<p><strong>运行结果：</strong></p>
<p>启动客户端后，可以与UDP服务端进行交互：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-550-1">1</a></span>
<span class="normal"><a href="#__codelineno-550-2">2</a></span>
<span class="normal"><a href="#__codelineno-550-3">3</a></span>
<span class="normal"><a href="#__codelineno-550-4">4</a></span>
<span class="normal"><a href="#__codelineno-550-5">5</a></span>
<span class="normal"><a href="#__codelineno-550-6">6</a></span>
<span class="normal"><a href="#__codelineno-550-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-550-1" name="__codelineno-550-1"></a>UDP 客户端启动，输入消息 (输入 &#39;exit&#39; 退出):
<a id="__codelineno-550-2" name="__codelineno-550-2"></a>&gt; Hello
<a id="__codelineno-550-3" name="__codelineno-550-3"></a>服务器回应: 收到: Hello
<a id="__codelineno-550-4" name="__codelineno-550-4"></a>&gt; UDP
<a id="__codelineno-550-5" name="__codelineno-550-5"></a>服务器回应: 收到: UDP
<a id="__codelineno-550-6" name="__codelineno-550-6"></a>&gt; exit
<a id="__codelineno-550-7" name="__codelineno-550-7"></a>退出客户端
</code></pre></div></td></tr></table></div>
<p><strong>3. 无连接特性</strong></p>
<p>与TCP不同，UDP是无连接的，客户端不需要事先建立连接。每个UDP数据报都是独立的，这使得UDP在处理高并发、小数据量的场景下表现出色。</p>
<p><strong>示例：并发UDP消息发送</strong></p>
<p>可以启动多个UDP客户端实例，向服务端发送消息，服务端将同时处理所有消息。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-551-1">1</a></span>
<span class="normal"><a href="#__codelineno-551-2">2</a></span>
<span class="normal"><a href="#__codelineno-551-3">3</a></span>
<span class="normal"><a href="#__codelineno-551-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-551-1" name="__codelineno-551-1"></a><span class="c1"># 启动多个UDP客户端</span>
<a id="__codelineno-551-2" name="__codelineno-551-2"></a>go<span class="w"> </span>run<span class="w"> </span>udp_client.go
<a id="__codelineno-551-3" name="__codelineno-551-3"></a>go<span class="w"> </span>run<span class="w"> </span>udp_client.go
<a id="__codelineno-551-4" name="__codelineno-551-4"></a>go<span class="w"> </span>run<span class="w"> </span>udp_client.go
</code></pre></div></td></tr></table></div>
<p>服务端将同时显示来自多个客户端的消息。</p>
<h4 id="注意事项_19">注意事项<a class="headerlink" href="#注意事项_19" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>错误处理</strong>：无论是TCP还是UDP，始终检查网络操作中的错误，确保程序能够正确处理网络异常。</li>
<li><strong>资源管理</strong>：确保在完成网络操作后关闭连接，避免资源泄漏。</li>
<li><strong>并发控制</strong>：在高并发场景下，结合Goroutine和Channel，可以高效地管理并发连接和数据传输。</li>
<li><strong>安全性</strong>：在开放的网络环境中，考虑使用TLS/SSL加密通信，保护数据的传输安全。</li>
<li><strong>数据包大小</strong>：对于UDP，注意数据包的大小限制，避免发送超过MTU（Maximum Transmission Unit）的数据包导致数据包被截断。</li>
</ul>
<h3 id="123-网络请求与响应">12.3 网络请求与响应<a class="headerlink" href="#123-网络请求与响应" title="Permanent link">&para;</a></h3>
<p>虽然用户没有在最初的提纲中列出<code>网络请求与响应</code>，但这是HTTP编程和Socket编程中的重要部分。这里将进一步介绍如何构建和处理HTTP请求与响应，以及在Socket编程中管理数据的发送与接收。</p>
<h4 id="构建和处理http请求">构建和处理HTTP请求<a class="headerlink" href="#构建和处理http请求" title="Permanent link">&para;</a></h4>
<p>在HTTP编程中，构建和处理请求是核心任务之一。Go的<code>net/http</code>包提供了灵活的工具来创建和解析HTTP请求。</p>
<p><strong>示例：自定义HTTP请求</strong></p>
<p>以下示例展示了如何构建一个自定义的HTTP请求，并处理响应。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-552-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-552-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-552-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-552-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-552-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-552-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-552-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-552-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-552-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-552-10">10</a></span>
<span class="normal"><a href="#__codelineno-552-11">11</a></span>
<span class="normal"><a href="#__codelineno-552-12">12</a></span>
<span class="normal"><a href="#__codelineno-552-13">13</a></span>
<span class="normal"><a href="#__codelineno-552-14">14</a></span>
<span class="normal"><a href="#__codelineno-552-15">15</a></span>
<span class="normal"><a href="#__codelineno-552-16">16</a></span>
<span class="normal"><a href="#__codelineno-552-17">17</a></span>
<span class="normal"><a href="#__codelineno-552-18">18</a></span>
<span class="normal"><a href="#__codelineno-552-19">19</a></span>
<span class="normal"><a href="#__codelineno-552-20">20</a></span>
<span class="normal"><a href="#__codelineno-552-21">21</a></span>
<span class="normal"><a href="#__codelineno-552-22">22</a></span>
<span class="normal"><a href="#__codelineno-552-23">23</a></span>
<span class="normal"><a href="#__codelineno-552-24">24</a></span>
<span class="normal"><a href="#__codelineno-552-25">25</a></span>
<span class="normal"><a href="#__codelineno-552-26">26</a></span>
<span class="normal"><a href="#__codelineno-552-27">27</a></span>
<span class="normal"><a href="#__codelineno-552-28">28</a></span>
<span class="normal"><a href="#__codelineno-552-29">29</a></span>
<span class="normal"><a href="#__codelineno-552-30">30</a></span>
<span class="normal"><a href="#__codelineno-552-31">31</a></span>
<span class="normal"><a href="#__codelineno-552-32">32</a></span>
<span class="normal"><a href="#__codelineno-552-33">33</a></span>
<span class="normal"><a href="#__codelineno-552-34">34</a></span>
<span class="normal"><a href="#__codelineno-552-35">35</a></span>
<span class="normal"><a href="#__codelineno-552-36">36</a></span>
<span class="normal"><a href="#__codelineno-552-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-552-1" name="__codelineno-552-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-552-2" name="__codelineno-552-2"></a>
<a id="__codelineno-552-3" name="__codelineno-552-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-552-4" name="__codelineno-552-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-552-5" name="__codelineno-552-5"></a><span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<a id="__codelineno-552-6" name="__codelineno-552-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-552-7" name="__codelineno-552-7"></a><span class="p">)</span>
<a id="__codelineno-552-8" name="__codelineno-552-8"></a>
<a id="__codelineno-552-9" name="__codelineno-552-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-552-10" name="__codelineno-552-10"></a><span class="w">    </span><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{}</span>
<a id="__codelineno-552-11" name="__codelineno-552-11"></a>
<a id="__codelineno-552-12" name="__codelineno-552-12"></a><span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8080/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-552-13" name="__codelineno-552-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-552-14" name="__codelineno-552-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建请求失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-552-15" name="__codelineno-552-15"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-552-16" name="__codelineno-552-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-552-17" name="__codelineno-552-17"></a>
<a id="__codelineno-552-18" name="__codelineno-552-18"></a><span class="w">    </span><span class="c1">// 设置自定义头部</span>
<a id="__codelineno-552-19" name="__codelineno-552-19"></a><span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bearer token123&quot;</span><span class="p">)</span>
<a id="__codelineno-552-20" name="__codelineno-552-20"></a>
<a id="__codelineno-552-21" name="__codelineno-552-21"></a><span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<a id="__codelineno-552-22" name="__codelineno-552-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-552-23" name="__codelineno-552-23"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送请求失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-552-24" name="__codelineno-552-24"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-552-25" name="__codelineno-552-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-552-26" name="__codelineno-552-26"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-552-27" name="__codelineno-552-27"></a>
<a id="__codelineno-552-28" name="__codelineno-552-28"></a><span class="w">    </span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<a id="__codelineno-552-29" name="__codelineno-552-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-552-30" name="__codelineno-552-30"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取响应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-552-31" name="__codelineno-552-31"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-552-32" name="__codelineno-552-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-552-33" name="__codelineno-552-33"></a>
<a id="__codelineno-552-34" name="__codelineno-552-34"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;响应状态:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Status</span><span class="p">)</span>
<a id="__codelineno-552-35" name="__codelineno-552-35"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;响应头:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span><span class="p">)</span>
<a id="__codelineno-552-36" name="__codelineno-552-36"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;响应内容:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">body</span><span class="p">))</span>
<a id="__codelineno-552-37" name="__codelineno-552-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>创建一个自定义的HTTP GET请求，目标URL为<code>http://localhost:8080/users</code>。</li>
<li>设置请求头<code>Authorization</code>，模拟带有身份验证的请求。</li>
<li>使用<code>http.Client</code>发送请求，并处理响应。</li>
<li>读取并打印响应的状态、头部和内容。</li>
</ul>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-553-1">1</a></span>
<span class="normal"><a href="#__codelineno-553-2">2</a></span>
<span class="normal"><a href="#__codelineno-553-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-553-1" name="__codelineno-553-1"></a>响应状态: 200 OK
<a id="__codelineno-553-2" name="__codelineno-553-2"></a>响应头: map[Content-Type:[application/json]]
<a id="__codelineno-553-3" name="__codelineno-553-3"></a>响应内容: [{&quot;id&quot;:1,&quot;name&quot;:&quot;Alice&quot;}]
</code></pre></div></td></tr></table></div>
<h4 id="管理socket数据的发送与接收">管理Socket数据的发送与接收<a class="headerlink" href="#管理socket数据的发送与接收" title="Permanent link">&para;</a></h4>
<p>在Socket编程中，数据的发送与接收是核心任务。需要设计协议或数据格式，以确保数据的正确解析和处理。</p>
<p><strong>示例：简单的消息协议</strong></p>
<p>以下示例展示了如何在TCP服务端和客户端之间传输带有长度前缀的消息，以确保数据的完整性和顺序。</p>
<p><strong>1. 服务端：处理带长度前缀的消息</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-554-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-554-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-554-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-554-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-554-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-554-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-554-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-554-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-554-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-554-10">10</a></span>
<span class="normal"><a href="#__codelineno-554-11">11</a></span>
<span class="normal"><a href="#__codelineno-554-12">12</a></span>
<span class="normal"><a href="#__codelineno-554-13">13</a></span>
<span class="normal"><a href="#__codelineno-554-14">14</a></span>
<span class="normal"><a href="#__codelineno-554-15">15</a></span>
<span class="normal"><a href="#__codelineno-554-16">16</a></span>
<span class="normal"><a href="#__codelineno-554-17">17</a></span>
<span class="normal"><a href="#__codelineno-554-18">18</a></span>
<span class="normal"><a href="#__codelineno-554-19">19</a></span>
<span class="normal"><a href="#__codelineno-554-20">20</a></span>
<span class="normal"><a href="#__codelineno-554-21">21</a></span>
<span class="normal"><a href="#__codelineno-554-22">22</a></span>
<span class="normal"><a href="#__codelineno-554-23">23</a></span>
<span class="normal"><a href="#__codelineno-554-24">24</a></span>
<span class="normal"><a href="#__codelineno-554-25">25</a></span>
<span class="normal"><a href="#__codelineno-554-26">26</a></span>
<span class="normal"><a href="#__codelineno-554-27">27</a></span>
<span class="normal"><a href="#__codelineno-554-28">28</a></span>
<span class="normal"><a href="#__codelineno-554-29">29</a></span>
<span class="normal"><a href="#__codelineno-554-30">30</a></span>
<span class="normal"><a href="#__codelineno-554-31">31</a></span>
<span class="normal"><a href="#__codelineno-554-32">32</a></span>
<span class="normal"><a href="#__codelineno-554-33">33</a></span>
<span class="normal"><a href="#__codelineno-554-34">34</a></span>
<span class="normal"><a href="#__codelineno-554-35">35</a></span>
<span class="normal"><a href="#__codelineno-554-36">36</a></span>
<span class="normal"><a href="#__codelineno-554-37">37</a></span>
<span class="normal"><a href="#__codelineno-554-38">38</a></span>
<span class="normal"><a href="#__codelineno-554-39">39</a></span>
<span class="normal"><a href="#__codelineno-554-40">40</a></span>
<span class="normal"><a href="#__codelineno-554-41">41</a></span>
<span class="normal"><a href="#__codelineno-554-42">42</a></span>
<span class="normal"><a href="#__codelineno-554-43">43</a></span>
<span class="normal"><a href="#__codelineno-554-44">44</a></span>
<span class="normal"><a href="#__codelineno-554-45">45</a></span>
<span class="normal"><a href="#__codelineno-554-46">46</a></span>
<span class="normal"><a href="#__codelineno-554-47">47</a></span>
<span class="normal"><a href="#__codelineno-554-48">48</a></span>
<span class="normal"><a href="#__codelineno-554-49">49</a></span>
<span class="normal"><a href="#__codelineno-554-50">50</a></span>
<span class="normal"><a href="#__codelineno-554-51">51</a></span>
<span class="normal"><a href="#__codelineno-554-52">52</a></span>
<span class="normal"><a href="#__codelineno-554-53">53</a></span>
<span class="normal"><a href="#__codelineno-554-54">54</a></span>
<span class="normal"><a href="#__codelineno-554-55">55</a></span>
<span class="normal"><a href="#__codelineno-554-56">56</a></span>
<span class="normal"><a href="#__codelineno-554-57">57</a></span>
<span class="normal"><a href="#__codelineno-554-58">58</a></span>
<span class="normal"><a href="#__codelineno-554-59">59</a></span>
<span class="normal"><a href="#__codelineno-554-60">60</a></span>
<span class="normal"><a href="#__codelineno-554-61">61</a></span>
<span class="normal"><a href="#__codelineno-554-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-554-1" name="__codelineno-554-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-554-2" name="__codelineno-554-2"></a>
<a id="__codelineno-554-3" name="__codelineno-554-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-554-4" name="__codelineno-554-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-554-5" name="__codelineno-554-5"></a><span class="w">    </span><span class="s">&quot;encoding/binary&quot;</span>
<a id="__codelineno-554-6" name="__codelineno-554-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-554-7" name="__codelineno-554-7"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-554-8" name="__codelineno-554-8"></a><span class="p">)</span>
<a id="__codelineno-554-9" name="__codelineno-554-9"></a>
<a id="__codelineno-554-10" name="__codelineno-554-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-11" name="__codelineno-554-11"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-554-12" name="__codelineno-554-12"></a><span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-554-13" name="__codelineno-554-13"></a>
<a id="__codelineno-554-14" name="__codelineno-554-14"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-15" name="__codelineno-554-15"></a><span class="w">        </span><span class="c1">// 读取消息长度（4字节）</span>
<a id="__codelineno-554-16" name="__codelineno-554-16"></a><span class="w">        </span><span class="nx">lengthBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-554-17" name="__codelineno-554-17"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-554-18" name="__codelineno-554-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-19" name="__codelineno-554-19"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取长度失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-554-20" name="__codelineno-554-20"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-554-21" name="__codelineno-554-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-554-22" name="__codelineno-554-22"></a><span class="w">        </span><span class="nx">length</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">.</span><span class="nx">Uint32</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-554-23" name="__codelineno-554-23"></a>
<a id="__codelineno-554-24" name="__codelineno-554-24"></a><span class="w">        </span><span class="c1">// 读取消息内容</span>
<a id="__codelineno-554-25" name="__codelineno-554-25"></a><span class="w">        </span><span class="nx">messageBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">)</span>
<a id="__codelineno-554-26" name="__codelineno-554-26"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">messageBytes</span><span class="p">)</span>
<a id="__codelineno-554-27" name="__codelineno-554-27"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-28" name="__codelineno-554-28"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取消息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-554-29" name="__codelineno-554-29"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-554-30" name="__codelineno-554-30"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-554-31" name="__codelineno-554-31"></a><span class="w">        </span><span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">messageBytes</span><span class="p">)</span>
<a id="__codelineno-554-32" name="__codelineno-554-32"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;收到消息: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-554-33" name="__codelineno-554-33"></a>
<a id="__codelineno-554-34" name="__codelineno-554-34"></a><span class="w">        </span><span class="c1">// 回应客户端</span>
<a id="__codelineno-554-35" name="__codelineno-554-35"></a><span class="w">        </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;收到: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">message</span>
<a id="__codelineno-554-36" name="__codelineno-554-36"></a><span class="w">        </span><span class="nx">responseBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<a id="__codelineno-554-37" name="__codelineno-554-37"></a><span class="w">        </span><span class="nx">responseLength</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">responseBytes</span><span class="p">))</span>
<a id="__codelineno-554-38" name="__codelineno-554-38"></a><span class="w">        </span><span class="nx">binary</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">,</span><span class="w"> </span><span class="nx">responseLength</span><span class="p">)</span>
<a id="__codelineno-554-39" name="__codelineno-554-39"></a><span class="w">        </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">responseBytes</span><span class="p">)</span>
<a id="__codelineno-554-40" name="__codelineno-554-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-554-41" name="__codelineno-554-41"></a><span class="p">}</span>
<a id="__codelineno-554-42" name="__codelineno-554-42"></a>
<a id="__codelineno-554-43" name="__codelineno-554-43"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-44" name="__codelineno-554-44"></a><span class="w">    </span><span class="nx">listener</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8083&quot;</span><span class="p">)</span>
<a id="__codelineno-554-45" name="__codelineno-554-45"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-46" name="__codelineno-554-46"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;监听失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-554-47" name="__codelineno-554-47"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-554-48" name="__codelineno-554-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-554-49" name="__codelineno-554-49"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-554-50" name="__codelineno-554-50"></a>
<a id="__codelineno-554-51" name="__codelineno-554-51"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;TCP 服务端启动，监听端口 :8083&quot;</span><span class="p">)</span>
<a id="__codelineno-554-52" name="__codelineno-554-52"></a>
<a id="__codelineno-554-53" name="__codelineno-554-53"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-54" name="__codelineno-554-54"></a><span class="w">        </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Accept</span><span class="p">()</span>
<a id="__codelineno-554-55" name="__codelineno-554-55"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-554-56" name="__codelineno-554-56"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接受连接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-554-57" name="__codelineno-554-57"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-554-58" name="__codelineno-554-58"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-554-59" name="__codelineno-554-59"></a>
<a id="__codelineno-554-60" name="__codelineno-554-60"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-554-61" name="__codelineno-554-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-554-62" name="__codelineno-554-62"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 客户端：发送带长度前缀的消息</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-555-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-555-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-555-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-555-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-555-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-555-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-555-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-555-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-555-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-555-10">10</a></span>
<span class="normal"><a href="#__codelineno-555-11">11</a></span>
<span class="normal"><a href="#__codelineno-555-12">12</a></span>
<span class="normal"><a href="#__codelineno-555-13">13</a></span>
<span class="normal"><a href="#__codelineno-555-14">14</a></span>
<span class="normal"><a href="#__codelineno-555-15">15</a></span>
<span class="normal"><a href="#__codelineno-555-16">16</a></span>
<span class="normal"><a href="#__codelineno-555-17">17</a></span>
<span class="normal"><a href="#__codelineno-555-18">18</a></span>
<span class="normal"><a href="#__codelineno-555-19">19</a></span>
<span class="normal"><a href="#__codelineno-555-20">20</a></span>
<span class="normal"><a href="#__codelineno-555-21">21</a></span>
<span class="normal"><a href="#__codelineno-555-22">22</a></span>
<span class="normal"><a href="#__codelineno-555-23">23</a></span>
<span class="normal"><a href="#__codelineno-555-24">24</a></span>
<span class="normal"><a href="#__codelineno-555-25">25</a></span>
<span class="normal"><a href="#__codelineno-555-26">26</a></span>
<span class="normal"><a href="#__codelineno-555-27">27</a></span>
<span class="normal"><a href="#__codelineno-555-28">28</a></span>
<span class="normal"><a href="#__codelineno-555-29">29</a></span>
<span class="normal"><a href="#__codelineno-555-30">30</a></span>
<span class="normal"><a href="#__codelineno-555-31">31</a></span>
<span class="normal"><a href="#__codelineno-555-32">32</a></span>
<span class="normal"><a href="#__codelineno-555-33">33</a></span>
<span class="normal"><a href="#__codelineno-555-34">34</a></span>
<span class="normal"><a href="#__codelineno-555-35">35</a></span>
<span class="normal"><a href="#__codelineno-555-36">36</a></span>
<span class="normal"><a href="#__codelineno-555-37">37</a></span>
<span class="normal"><a href="#__codelineno-555-38">38</a></span>
<span class="normal"><a href="#__codelineno-555-39">39</a></span>
<span class="normal"><a href="#__codelineno-555-40">40</a></span>
<span class="normal"><a href="#__codelineno-555-41">41</a></span>
<span class="normal"><a href="#__codelineno-555-42">42</a></span>
<span class="normal"><a href="#__codelineno-555-43">43</a></span>
<span class="normal"><a href="#__codelineno-555-44">44</a></span>
<span class="normal"><a href="#__codelineno-555-45">45</a></span>
<span class="normal"><a href="#__codelineno-555-46">46</a></span>
<span class="normal"><a href="#__codelineno-555-47">47</a></span>
<span class="normal"><a href="#__codelineno-555-48">48</a></span>
<span class="normal"><a href="#__codelineno-555-49">49</a></span>
<span class="normal"><a href="#__codelineno-555-50">50</a></span>
<span class="normal"><a href="#__codelineno-555-51">51</a></span>
<span class="normal"><a href="#__codelineno-555-52">52</a></span>
<span class="normal"><a href="#__codelineno-555-53">53</a></span>
<span class="normal"><a href="#__codelineno-555-54">54</a></span>
<span class="normal"><a href="#__codelineno-555-55">55</a></span>
<span class="normal"><a href="#__codelineno-555-56">56</a></span>
<span class="normal"><a href="#__codelineno-555-57">57</a></span>
<span class="normal"><a href="#__codelineno-555-58">58</a></span>
<span class="normal"><a href="#__codelineno-555-59">59</a></span>
<span class="normal"><a href="#__codelineno-555-60">60</a></span>
<span class="normal"><a href="#__codelineno-555-61">61</a></span>
<span class="normal"><a href="#__codelineno-555-62">62</a></span>
<span class="normal"><a href="#__codelineno-555-63">63</a></span>
<span class="normal"><a href="#__codelineno-555-64">64</a></span>
<span class="normal"><a href="#__codelineno-555-65">65</a></span>
<span class="normal"><a href="#__codelineno-555-66">66</a></span>
<span class="normal"><a href="#__codelineno-555-67">67</a></span>
<span class="normal"><a href="#__codelineno-555-68">68</a></span>
<span class="normal"><a href="#__codelineno-555-69">69</a></span>
<span class="normal"><a href="#__codelineno-555-70">70</a></span>
<span class="normal"><a href="#__codelineno-555-71">71</a></span>
<span class="normal"><a href="#__codelineno-555-72">72</a></span>
<span class="normal"><a href="#__codelineno-555-73">73</a></span>
<span class="normal"><a href="#__codelineno-555-74">74</a></span>
<span class="normal"><a href="#__codelineno-555-75">75</a></span>
<span class="normal"><a href="#__codelineno-555-76">76</a></span>
<span class="normal"><a href="#__codelineno-555-77">77</a></span>
<span class="normal"><a href="#__codelineno-555-78">78</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-555-1" name="__codelineno-555-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-555-2" name="__codelineno-555-2"></a>
<a id="__codelineno-555-3" name="__codelineno-555-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-555-4" name="__codelineno-555-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-555-5" name="__codelineno-555-5"></a><span class="w">    </span><span class="s">&quot;encoding/binary&quot;</span>
<a id="__codelineno-555-6" name="__codelineno-555-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-555-7" name="__codelineno-555-7"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-555-8" name="__codelineno-555-8"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-555-9" name="__codelineno-555-9"></a><span class="p">)</span>
<a id="__codelineno-555-10" name="__codelineno-555-10"></a>
<a id="__codelineno-555-11" name="__codelineno-555-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-12" name="__codelineno-555-12"></a><span class="w">    </span><span class="nx">messageBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-555-13" name="__codelineno-555-13"></a><span class="w">    </span><span class="nx">length</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">messageBytes</span><span class="p">))</span>
<a id="__codelineno-555-14" name="__codelineno-555-14"></a><span class="w">    </span><span class="c1">// 发送消息长度</span>
<a id="__codelineno-555-15" name="__codelineno-555-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-16" name="__codelineno-555-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-555-17" name="__codelineno-555-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-555-18" name="__codelineno-555-18"></a><span class="w">    </span><span class="c1">// 发送消息内容</span>
<a id="__codelineno-555-19" name="__codelineno-555-19"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">messageBytes</span><span class="p">)</span>
<a id="__codelineno-555-20" name="__codelineno-555-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-555-21" name="__codelineno-555-21"></a><span class="p">}</span>
<a id="__codelineno-555-22" name="__codelineno-555-22"></a>
<a id="__codelineno-555-23" name="__codelineno-555-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">receiveMessage</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-24" name="__codelineno-555-24"></a><span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-555-25" name="__codelineno-555-25"></a><span class="w">    </span><span class="c1">// 读取消息长度</span>
<a id="__codelineno-555-26" name="__codelineno-555-26"></a><span class="w">    </span><span class="nx">lengthBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-555-27" name="__codelineno-555-27"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-555-28" name="__codelineno-555-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-29" name="__codelineno-555-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-555-30" name="__codelineno-555-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-555-31" name="__codelineno-555-31"></a><span class="w">    </span><span class="nx">length</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">.</span><span class="nx">Uint32</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-555-32" name="__codelineno-555-32"></a>
<a id="__codelineno-555-33" name="__codelineno-555-33"></a><span class="w">    </span><span class="c1">// 读取消息内容</span>
<a id="__codelineno-555-34" name="__codelineno-555-34"></a><span class="w">    </span><span class="nx">messageBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">)</span>
<a id="__codelineno-555-35" name="__codelineno-555-35"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">messageBytes</span><span class="p">)</span>
<a id="__codelineno-555-36" name="__codelineno-555-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-37" name="__codelineno-555-37"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-555-38" name="__codelineno-555-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-555-39" name="__codelineno-555-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">messageBytes</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-555-40" name="__codelineno-555-40"></a><span class="p">}</span>
<a id="__codelineno-555-41" name="__codelineno-555-41"></a>
<a id="__codelineno-555-42" name="__codelineno-555-42"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-43" name="__codelineno-555-43"></a><span class="w">    </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Dial</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost:8083&quot;</span><span class="p">)</span>
<a id="__codelineno-555-44" name="__codelineno-555-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-45" name="__codelineno-555-45"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;连接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-555-46" name="__codelineno-555-46"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-555-47" name="__codelineno-555-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-555-48" name="__codelineno-555-48"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-555-49" name="__codelineno-555-49"></a>
<a id="__codelineno-555-50" name="__codelineno-555-50"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;连接到TCP服务端，输入消息 (输入 &#39;exit&#39; 退出):&quot;</span><span class="p">)</span>
<a id="__codelineno-555-51" name="__codelineno-555-51"></a>
<a id="__codelineno-555-52" name="__codelineno-555-52"></a><span class="w">    </span><span class="nx">scanner</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
<a id="__codelineno-555-53" name="__codelineno-555-53"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-54" name="__codelineno-555-54"></a><span class="w">        </span><span class="nx">text</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Text</span><span class="p">()</span>
<a id="__codelineno-555-55" name="__codelineno-555-55"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;exit&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-56" name="__codelineno-555-56"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;退出客户端&quot;</span><span class="p">)</span>
<a id="__codelineno-555-57" name="__codelineno-555-57"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-555-58" name="__codelineno-555-58"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-555-59" name="__codelineno-555-59"></a>
<a id="__codelineno-555-60" name="__codelineno-555-60"></a><span class="w">        </span><span class="c1">// 发送消息</span>
<a id="__codelineno-555-61" name="__codelineno-555-61"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-62" name="__codelineno-555-62"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送消息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-555-63" name="__codelineno-555-63"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-555-64" name="__codelineno-555-64"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-555-65" name="__codelineno-555-65"></a>
<a id="__codelineno-555-66" name="__codelineno-555-66"></a><span class="w">        </span><span class="c1">// 接收回应</span>
<a id="__codelineno-555-67" name="__codelineno-555-67"></a><span class="w">        </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">receiveMessage</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-555-68" name="__codelineno-555-68"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-69" name="__codelineno-555-69"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接收回应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-555-70" name="__codelineno-555-70"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-555-71" name="__codelineno-555-71"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-555-72" name="__codelineno-555-72"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;服务器回应:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<a id="__codelineno-555-73" name="__codelineno-555-73"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-555-74" name="__codelineno-555-74"></a>
<a id="__codelineno-555-75" name="__codelineno-555-75"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scanner</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-555-76" name="__codelineno-555-76"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取输入失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-555-77" name="__codelineno-555-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-555-78" name="__codelineno-555-78"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>
<p><strong>协议设计</strong>：每条消息以4字节的长度前缀开头，指示后续消息的长度。这确保了消息边界的明确，避免数据混淆。</p>
</li>
<li>
<p>服务端</p>
</li>
</ul>
<p>：</p>
<ul>
<li>接收消息长度，并读取指定长度的消息内容。</li>
<li>
<p>打印收到的消息，并回送确认信息，遵循相同的协议。</p>
</li>
<li>
<p>客户端</p>
</li>
</ul>
<p>：</p>
<ul>
<li>从标准输入读取用户输入。</li>
<li>发送带长度前缀的消息到服务端。</li>
<li>接收并打印服务端的回应。</li>
</ul>
<p><strong>运行结果：</strong></p>
<p>启动服务端和客户端后，可以进行如下交互：</p>
<p><strong>服务端终端：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-556-1">1</a></span>
<span class="normal"><a href="#__codelineno-556-2">2</a></span>
<span class="normal"><a href="#__codelineno-556-3">3</a></span>
<span class="normal"><a href="#__codelineno-556-4">4</a></span>
<span class="normal"><a href="#__codelineno-556-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-556-1" name="__codelineno-556-1"></a>TCP 服务端启动，监听端口 :8083
<a id="__codelineno-556-2" name="__codelineno-556-2"></a>连接来自 127.0.0.1:53428
<a id="__codelineno-556-3" name="__codelineno-556-3"></a>收到消息: Hello Server
<a id="__codelineno-556-4" name="__codelineno-556-4"></a>收到消息: Go is awesome
<a id="__codelineno-556-5" name="__codelineno-556-5"></a>收到消息: exit
</code></pre></div></td></tr></table></div>
<p><strong>客户端终端：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-557-1">1</a></span>
<span class="normal"><a href="#__codelineno-557-2">2</a></span>
<span class="normal"><a href="#__codelineno-557-3">3</a></span>
<span class="normal"><a href="#__codelineno-557-4">4</a></span>
<span class="normal"><a href="#__codelineno-557-5">5</a></span>
<span class="normal"><a href="#__codelineno-557-6">6</a></span>
<span class="normal"><a href="#__codelineno-557-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-557-1" name="__codelineno-557-1"></a>连接到TCP服务端，输入消息 (输入 &#39;exit&#39; 退出):
<a id="__codelineno-557-2" name="__codelineno-557-2"></a>&gt; Hello Server
<a id="__codelineno-557-3" name="__codelineno-557-3"></a>服务器回应: 收到: Hello Server
<a id="__codelineno-557-4" name="__codelineno-557-4"></a>&gt; Go is awesome
<a id="__codelineno-557-5" name="__codelineno-557-5"></a>服务器回应: 收到: Go is awesome
<a id="__codelineno-557-6" name="__codelineno-557-6"></a>&gt; exit
<a id="__codelineno-557-7" name="__codelineno-557-7"></a>退出客户端
</code></pre></div></td></tr></table></div>
<h4 id="注意事项_20">注意事项<a class="headerlink" href="#注意事项_20" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>协议设计</strong>：在Socket编程中，设计合理的通信协议至关重要。长度前缀、分隔符等方法可以帮助明确消息边界，确保数据的正确解析。</li>
<li><strong>错误处理</strong>：在处理网络数据时，始终检查并处理错误，确保程序的健壮性。</li>
<li><strong>资源管理</strong>：确保在完成Socket操作后关闭连接，避免资源泄漏。</li>
<li><strong>并发控制</strong>：在服务端处理多个客户端连接时，结合Goroutine和同步机制，确保并发访问的安全性。</li>
<li><strong>数据安全</strong>：在开放的网络环境中，考虑数据的加密传输和认证机制，保护数据的安全性和完整性。</li>
<li><strong>性能优化</strong>：在高并发场景下，优化Goroutine的使用和数据传输方式，以提升网络服务的性能。</li>
</ul>
<h3 id="124-网络请求与响应拓展内容">12.4 网络请求与响应（拓展内容）<a class="headerlink" href="#124-网络请求与响应拓展内容" title="Permanent link">&para;</a></h3>
<p>虽然在最初的提纲中未列出，但网络请求与响应是HTTP编程和Socket编程的核心部分。理解如何构建和处理网络请求与响应，可以更好地设计和实现网络应用。</p>
<h4 id="构建http请求">构建HTTP请求<a class="headerlink" href="#构建http请求" title="Permanent link">&para;</a></h4>
<p>在HTTP客户端编程中，构建请求是关键步骤。除了GET和POST请求，Go的<code>net/http</code>包还支持其他HTTP方法，如PUT、DELETE、PATCH等。</p>
<p><strong>示例：发送自定义HTTP请求</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-558-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-558-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-558-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-558-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-558-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-558-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-558-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-558-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-558-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-558-10">10</a></span>
<span class="normal"><a href="#__codelineno-558-11">11</a></span>
<span class="normal"><a href="#__codelineno-558-12">12</a></span>
<span class="normal"><a href="#__codelineno-558-13">13</a></span>
<span class="normal"><a href="#__codelineno-558-14">14</a></span>
<span class="normal"><a href="#__codelineno-558-15">15</a></span>
<span class="normal"><a href="#__codelineno-558-16">16</a></span>
<span class="normal"><a href="#__codelineno-558-17">17</a></span>
<span class="normal"><a href="#__codelineno-558-18">18</a></span>
<span class="normal"><a href="#__codelineno-558-19">19</a></span>
<span class="normal"><a href="#__codelineno-558-20">20</a></span>
<span class="normal"><a href="#__codelineno-558-21">21</a></span>
<span class="normal"><a href="#__codelineno-558-22">22</a></span>
<span class="normal"><a href="#__codelineno-558-23">23</a></span>
<span class="normal"><a href="#__codelineno-558-24">24</a></span>
<span class="normal"><a href="#__codelineno-558-25">25</a></span>
<span class="normal"><a href="#__codelineno-558-26">26</a></span>
<span class="normal"><a href="#__codelineno-558-27">27</a></span>
<span class="normal"><a href="#__codelineno-558-28">28</a></span>
<span class="normal"><a href="#__codelineno-558-29">29</a></span>
<span class="normal"><a href="#__codelineno-558-30">30</a></span>
<span class="normal"><a href="#__codelineno-558-31">31</a></span>
<span class="normal"><a href="#__codelineno-558-32">32</a></span>
<span class="normal"><a href="#__codelineno-558-33">33</a></span>
<span class="normal"><a href="#__codelineno-558-34">34</a></span>
<span class="normal"><a href="#__codelineno-558-35">35</a></span>
<span class="normal"><a href="#__codelineno-558-36">36</a></span>
<span class="normal"><a href="#__codelineno-558-37">37</a></span>
<span class="normal"><a href="#__codelineno-558-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-558-1" name="__codelineno-558-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-558-2" name="__codelineno-558-2"></a>
<a id="__codelineno-558-3" name="__codelineno-558-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-558-4" name="__codelineno-558-4"></a><span class="w">    </span><span class="s">&quot;bytes&quot;</span>
<a id="__codelineno-558-5" name="__codelineno-558-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-558-6" name="__codelineno-558-6"></a><span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<a id="__codelineno-558-7" name="__codelineno-558-7"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-558-8" name="__codelineno-558-8"></a><span class="p">)</span>
<a id="__codelineno-558-9" name="__codelineno-558-9"></a>
<a id="__codelineno-558-10" name="__codelineno-558-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-558-11" name="__codelineno-558-11"></a><span class="w">    </span><span class="nx">url</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;http://localhost:8080/users&quot;</span>
<a id="__codelineno-558-12" name="__codelineno-558-12"></a><span class="w">    </span><span class="nx">jsonData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&quot;name&quot;:&quot;Charlie&quot;}`</span><span class="p">)</span>
<a id="__codelineno-558-13" name="__codelineno-558-13"></a>
<a id="__codelineno-558-14" name="__codelineno-558-14"></a><span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">))</span>
<a id="__codelineno-558-15" name="__codelineno-558-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-558-16" name="__codelineno-558-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建请求失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-558-17" name="__codelineno-558-17"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-558-18" name="__codelineno-558-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-558-19" name="__codelineno-558-19"></a>
<a id="__codelineno-558-20" name="__codelineno-558-20"></a><span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-558-21" name="__codelineno-558-21"></a>
<a id="__codelineno-558-22" name="__codelineno-558-22"></a><span class="w">    </span><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{}</span>
<a id="__codelineno-558-23" name="__codelineno-558-23"></a><span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<a id="__codelineno-558-24" name="__codelineno-558-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-558-25" name="__codelineno-558-25"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送请求失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-558-26" name="__codelineno-558-26"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-558-27" name="__codelineno-558-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-558-28" name="__codelineno-558-28"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-558-29" name="__codelineno-558-29"></a>
<a id="__codelineno-558-30" name="__codelineno-558-30"></a><span class="w">    </span><span class="nx">body</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<a id="__codelineno-558-31" name="__codelineno-558-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-558-32" name="__codelineno-558-32"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取响应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-558-33" name="__codelineno-558-33"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-558-34" name="__codelineno-558-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-558-35" name="__codelineno-558-35"></a>
<a id="__codelineno-558-36" name="__codelineno-558-36"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;响应状态:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Status</span><span class="p">)</span>
<a id="__codelineno-558-37" name="__codelineno-558-37"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;响应内容:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">body</span><span class="p">))</span>
<a id="__codelineno-558-38" name="__codelineno-558-38"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>http.NewRequest</code>构建一个POST请求，发送JSON数据到<code>/users</code>端点。</li>
<li>设置请求头<code>Content-Type</code>为<code>application/json</code>，指示请求体的数据格式。</li>
<li>使用<code>http.Client</code>发送请求，并处理响应。</li>
</ul>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-559-1">1</a></span>
<span class="normal"><a href="#__codelineno-559-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-559-1" name="__codelineno-559-1"></a>响应状态: 201 Created
<a id="__codelineno-559-2" name="__codelineno-559-2"></a>响应内容: {&quot;id&quot;:2,&quot;name&quot;:&quot;Charlie&quot;}
</code></pre></div></td></tr></table></div>
<h4 id="处理http响应">处理HTTP响应<a class="headerlink" href="#处理http响应" title="Permanent link">&para;</a></h4>
<p>在HTTP服务端编程中，处理响应是关键任务。服务端需要构建正确的HTTP响应，包括状态码、头部和响应体。</p>
<p><strong>示例：自定义HTTP响应</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-560-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-560-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-560-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-560-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-560-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-560-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-560-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-560-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-560-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-560-10">10</a></span>
<span class="normal"><a href="#__codelineno-560-11">11</a></span>
<span class="normal"><a href="#__codelineno-560-12">12</a></span>
<span class="normal"><a href="#__codelineno-560-13">13</a></span>
<span class="normal"><a href="#__codelineno-560-14">14</a></span>
<span class="normal"><a href="#__codelineno-560-15">15</a></span>
<span class="normal"><a href="#__codelineno-560-16">16</a></span>
<span class="normal"><a href="#__codelineno-560-17">17</a></span>
<span class="normal"><a href="#__codelineno-560-18">18</a></span>
<span class="normal"><a href="#__codelineno-560-19">19</a></span>
<span class="normal"><a href="#__codelineno-560-20">20</a></span>
<span class="normal"><a href="#__codelineno-560-21">21</a></span>
<span class="normal"><a href="#__codelineno-560-22">22</a></span>
<span class="normal"><a href="#__codelineno-560-23">23</a></span>
<span class="normal"><a href="#__codelineno-560-24">24</a></span>
<span class="normal"><a href="#__codelineno-560-25">25</a></span>
<span class="normal"><a href="#__codelineno-560-26">26</a></span>
<span class="normal"><a href="#__codelineno-560-27">27</a></span>
<span class="normal"><a href="#__codelineno-560-28">28</a></span>
<span class="normal"><a href="#__codelineno-560-29">29</a></span>
<span class="normal"><a href="#__codelineno-560-30">30</a></span>
<span class="normal"><a href="#__codelineno-560-31">31</a></span>
<span class="normal"><a href="#__codelineno-560-32">32</a></span>
<span class="normal"><a href="#__codelineno-560-33">33</a></span>
<span class="normal"><a href="#__codelineno-560-34">34</a></span>
<span class="normal"><a href="#__codelineno-560-35">35</a></span>
<span class="normal"><a href="#__codelineno-560-36">36</a></span>
<span class="normal"><a href="#__codelineno-560-37">37</a></span>
<span class="normal"><a href="#__codelineno-560-38">38</a></span>
<span class="normal"><a href="#__codelineno-560-39">39</a></span>
<span class="normal"><a href="#__codelineno-560-40">40</a></span>
<span class="normal"><a href="#__codelineno-560-41">41</a></span>
<span class="normal"><a href="#__codelineno-560-42">42</a></span>
<span class="normal"><a href="#__codelineno-560-43">43</a></span>
<span class="normal"><a href="#__codelineno-560-44">44</a></span>
<span class="normal"><a href="#__codelineno-560-45">45</a></span>
<span class="normal"><a href="#__codelineno-560-46">46</a></span>
<span class="normal"><a href="#__codelineno-560-47">47</a></span>
<span class="normal"><a href="#__codelineno-560-48">48</a></span>
<span class="normal"><a href="#__codelineno-560-49">49</a></span>
<span class="normal"><a href="#__codelineno-560-50">50</a></span>
<span class="normal"><a href="#__codelineno-560-51">51</a></span>
<span class="normal"><a href="#__codelineno-560-52">52</a></span>
<span class="normal"><a href="#__codelineno-560-53">53</a></span>
<span class="normal"><a href="#__codelineno-560-54">54</a></span>
<span class="normal"><a href="#__codelineno-560-55">55</a></span>
<span class="normal"><a href="#__codelineno-560-56">56</a></span>
<span class="normal"><a href="#__codelineno-560-57">57</a></span>
<span class="normal"><a href="#__codelineno-560-58">58</a></span>
<span class="normal"><a href="#__codelineno-560-59">59</a></span>
<span class="normal"><a href="#__codelineno-560-60">60</a></span>
<span class="normal"><a href="#__codelineno-560-61">61</a></span>
<span class="normal"><a href="#__codelineno-560-62">62</a></span>
<span class="normal"><a href="#__codelineno-560-63">63</a></span>
<span class="normal"><a href="#__codelineno-560-64">64</a></span>
<span class="normal"><a href="#__codelineno-560-65">65</a></span>
<span class="normal"><a href="#__codelineno-560-66">66</a></span>
<span class="normal"><a href="#__codelineno-560-67">67</a></span>
<span class="normal"><a href="#__codelineno-560-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-560-1" name="__codelineno-560-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-560-2" name="__codelineno-560-2"></a>
<a id="__codelineno-560-3" name="__codelineno-560-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-560-4" name="__codelineno-560-4"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-560-5" name="__codelineno-560-5"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-560-6" name="__codelineno-560-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-560-7" name="__codelineno-560-7"></a><span class="p">)</span>
<a id="__codelineno-560-8" name="__codelineno-560-8"></a>
<a id="__codelineno-560-9" name="__codelineno-560-9"></a><span class="kd">type</span><span class="w"> </span><span class="nx">ErrorResponse</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-10" name="__codelineno-560-10"></a><span class="w">    </span><span class="nx">Code</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;code&quot;`</span>
<a id="__codelineno-560-11" name="__codelineno-560-11"></a><span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;message&quot;`</span>
<a id="__codelineno-560-12" name="__codelineno-560-12"></a><span class="p">}</span>
<a id="__codelineno-560-13" name="__codelineno-560-13"></a>
<a id="__codelineno-560-14" name="__codelineno-560-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">errorHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-15" name="__codelineno-560-15"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<a id="__codelineno-560-16" name="__codelineno-560-16"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-560-17" name="__codelineno-560-17"></a><span class="w">    </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">ErrorResponse</span><span class="p">{</span>
<a id="__codelineno-560-18" name="__codelineno-560-18"></a><span class="w">        </span><span class="nx">Code</span><span class="p">:</span><span class="w">    </span><span class="nx">code</span><span class="p">,</span>
<a id="__codelineno-560-19" name="__codelineno-560-19"></a><span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span>
<a id="__codelineno-560-20" name="__codelineno-560-20"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-560-21" name="__codelineno-560-21"></a><span class="p">}</span>
<a id="__codelineno-560-22" name="__codelineno-560-22"></a>
<a id="__codelineno-560-23" name="__codelineno-560-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">usersHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-24" name="__codelineno-560-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-25" name="__codelineno-560-25"></a><span class="w">        </span><span class="c1">// 处理GET请求</span>
<a id="__codelineno-560-26" name="__codelineno-560-26"></a><span class="w">        </span><span class="nx">users</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<a id="__codelineno-560-27" name="__codelineno-560-27"></a><span class="w">            </span><span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">},</span>
<a id="__codelineno-560-28" name="__codelineno-560-28"></a><span class="w">            </span><span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">},</span>
<a id="__codelineno-560-29" name="__codelineno-560-29"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-560-30" name="__codelineno-560-30"></a><span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-560-31" name="__codelineno-560-31"></a><span class="w">        </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">users</span><span class="p">)</span>
<a id="__codelineno-560-32" name="__codelineno-560-32"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-560-33" name="__codelineno-560-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-560-34" name="__codelineno-560-34"></a>
<a id="__codelineno-560-35" name="__codelineno-560-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;POST&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-36" name="__codelineno-560-36"></a><span class="w">        </span><span class="c1">// 处理POST请求</span>
<a id="__codelineno-560-37" name="__codelineno-560-37"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">newUser</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-560-38" name="__codelineno-560-38"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">).</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">newUser</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-39" name="__codelineno-560-39"></a><span class="w">            </span><span class="nx">errorHandler</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无效的JSON数据&quot;</span><span class="p">)</span>
<a id="__codelineno-560-40" name="__codelineno-560-40"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-560-41" name="__codelineno-560-41"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-560-42" name="__codelineno-560-42"></a>
<a id="__codelineno-560-43" name="__codelineno-560-43"></a><span class="w">        </span><span class="c1">// 简单的验证</span>
<a id="__codelineno-560-44" name="__codelineno-560-44"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">newUser</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">];</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-45" name="__codelineno-560-45"></a><span class="w">            </span><span class="nx">errorHandler</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;缺少&#39;name&#39;字段&quot;</span><span class="p">)</span>
<a id="__codelineno-560-46" name="__codelineno-560-46"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-560-47" name="__codelineno-560-47"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-560-48" name="__codelineno-560-48"></a>
<a id="__codelineno-560-49" name="__codelineno-560-49"></a><span class="w">        </span><span class="c1">// 模拟创建用户</span>
<a id="__codelineno-560-50" name="__codelineno-560-50"></a><span class="w">        </span><span class="nx">newUser</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-560-51" name="__codelineno-560-51"></a><span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-560-52" name="__codelineno-560-52"></a><span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">)</span>
<a id="__codelineno-560-53" name="__codelineno-560-53"></a><span class="w">        </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">newUser</span><span class="p">)</span>
<a id="__codelineno-560-54" name="__codelineno-560-54"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-560-55" name="__codelineno-560-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-560-56" name="__codelineno-560-56"></a>
<a id="__codelineno-560-57" name="__codelineno-560-57"></a><span class="w">    </span><span class="c1">// 处理不支持的方法</span>
<a id="__codelineno-560-58" name="__codelineno-560-58"></a><span class="w">    </span><span class="nx">errorHandler</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusMethodNotAllowed</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;方法不被支持&quot;</span><span class="p">)</span>
<a id="__codelineno-560-59" name="__codelineno-560-59"></a><span class="p">}</span>
<a id="__codelineno-560-60" name="__codelineno-560-60"></a>
<a id="__codelineno-560-61" name="__codelineno-560-61"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-62" name="__codelineno-560-62"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">usersHandler</span><span class="p">)</span>
<a id="__codelineno-560-63" name="__codelineno-560-63"></a>
<a id="__codelineno-560-64" name="__codelineno-560-64"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;启动服务器在 :8080&quot;</span><span class="p">)</span>
<a id="__codelineno-560-65" name="__codelineno-560-65"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-560-66" name="__codelineno-560-66"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;服务器启动失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-560-67" name="__codelineno-560-67"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-560-68" name="__codelineno-560-68"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>
<p><strong>ErrorResponse</strong>：定义了一个自定义错误响应结构体，包含错误代码和消息。</p>
</li>
<li>
<p><strong>errorHandler</strong>：一个辅助函数，用于构建并发送自定义错误响应。</p>
</li>
<li>
<p>usersHandler</p>
</li>
</ul>
<p>：处理</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-561-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-561-1" name="__codelineno-561-1"></a>/users
</code></pre></div></td></tr></table></div>
<p>路径的HTTP请求，支持GET和POST方法。</p>
<ul>
<li><strong>GET请求</strong>：返回用户列表的JSON数据。</li>
<li><strong>POST请求</strong>：解析并验证请求体中的JSON数据，模拟创建用户并返回新用户信息。</li>
<li><strong>不支持的方法</strong>：返回405 Method Not Allowed错误。</li>
</ul>
<p><strong>运行结果：</strong></p>
<ol>
<li><strong>GET请求</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-562-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-562-1" name="__codelineno-562-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-563-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-563-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-563-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-563-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-563-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-563-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-563-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-563-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-563-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-563-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-563-1" name="__codelineno-563-1"></a><span class="p">[</span>
<a id="__codelineno-563-2" name="__codelineno-563-2"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-563-3" name="__codelineno-563-3"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-563-4" name="__codelineno-563-4"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span>
<a id="__codelineno-563-5" name="__codelineno-563-5"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-563-6" name="__codelineno-563-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-563-7" name="__codelineno-563-7"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-563-8" name="__codelineno-563-8"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Charlie&quot;</span>
<a id="__codelineno-563-9" name="__codelineno-563-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-563-10" name="__codelineno-563-10"></a><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>POST请求</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-564-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-564-1" name="__codelineno-564-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/users<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Bob&quot;}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-565-1">1</a></span>
<span class="normal"><a href="#__codelineno-565-2">2</a></span>
<span class="normal"><a href="#__codelineno-565-3">3</a></span>
<span class="normal"><a href="#__codelineno-565-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-565-1" name="__codelineno-565-1"></a><span class="p">{</span>
<a id="__codelineno-565-2" name="__codelineno-565-2"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-565-3" name="__codelineno-565-3"></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bob&quot;</span>
<a id="__codelineno-565-4" name="__codelineno-565-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>无效的POST请求</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-566-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-566-1" name="__codelineno-566-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/users<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-567-1">1</a></span>
<span class="normal"><a href="#__codelineno-567-2">2</a></span>
<span class="normal"><a href="#__codelineno-567-3">3</a></span>
<span class="normal"><a href="#__codelineno-567-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-567-1" name="__codelineno-567-1"></a><span class="p">{</span>
<a id="__codelineno-567-2" name="__codelineno-567-2"></a><span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-567-3" name="__codelineno-567-3"></a><span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;缺少&#39;name&#39;字段&quot;</span>
<a id="__codelineno-567-4" name="__codelineno-567-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="高级http功能">高级HTTP功能<a class="headerlink" href="#高级http功能" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>中间件</strong>：在HTTP请求处理过程中插入额外的处理逻辑，如日志记录、认证、压缩等。</li>
</ul>
<p><strong>示例：日志中间件</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-568-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-568-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-568-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-568-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-568-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-568-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-568-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-568-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-568-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-568-10">10</a></span>
<span class="normal"><a href="#__codelineno-568-11">11</a></span>
<span class="normal"><a href="#__codelineno-568-12">12</a></span>
<span class="normal"><a href="#__codelineno-568-13">13</a></span>
<span class="normal"><a href="#__codelineno-568-14">14</a></span>
<span class="normal"><a href="#__codelineno-568-15">15</a></span>
<span class="normal"><a href="#__codelineno-568-16">16</a></span>
<span class="normal"><a href="#__codelineno-568-17">17</a></span>
<span class="normal"><a href="#__codelineno-568-18">18</a></span>
<span class="normal"><a href="#__codelineno-568-19">19</a></span>
<span class="normal"><a href="#__codelineno-568-20">20</a></span>
<span class="normal"><a href="#__codelineno-568-21">21</a></span>
<span class="normal"><a href="#__codelineno-568-22">22</a></span>
<span class="normal"><a href="#__codelineno-568-23">23</a></span>
<span class="normal"><a href="#__codelineno-568-24">24</a></span>
<span class="normal"><a href="#__codelineno-568-25">25</a></span>
<span class="normal"><a href="#__codelineno-568-26">26</a></span>
<span class="normal"><a href="#__codelineno-568-27">27</a></span>
<span class="normal"><a href="#__codelineno-568-28">28</a></span>
<span class="normal"><a href="#__codelineno-568-29">29</a></span>
<span class="normal"><a href="#__codelineno-568-30">30</a></span>
<span class="normal"><a href="#__codelineno-568-31">31</a></span>
<span class="normal"><a href="#__codelineno-568-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-568-1" name="__codelineno-568-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-568-2" name="__codelineno-568-2"></a>
<a id="__codelineno-568-3" name="__codelineno-568-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-568-4" name="__codelineno-568-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-568-5" name="__codelineno-568-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-568-6" name="__codelineno-568-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-568-7" name="__codelineno-568-7"></a><span class="p">)</span>
<a id="__codelineno-568-8" name="__codelineno-568-8"></a>
<a id="__codelineno-568-9" name="__codelineno-568-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-568-10" name="__codelineno-568-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-568-11" name="__codelineno-568-11"></a><span class="w">        </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<a id="__codelineno-568-12" name="__codelineno-568-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;开始处理请求: %s %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
<a id="__codelineno-568-13" name="__codelineno-568-13"></a><span class="w">        </span><span class="nx">next</span><span class="p">.</span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-568-14" name="__codelineno-568-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;完成处理请求: %s %s, 用时: %v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">))</span>
<a id="__codelineno-568-15" name="__codelineno-568-15"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-568-16" name="__codelineno-568-16"></a><span class="p">}</span>
<a id="__codelineno-568-17" name="__codelineno-568-17"></a>
<a id="__codelineno-568-18" name="__codelineno-568-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">mainHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-568-19" name="__codelineno-568-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello from main handler!&quot;</span><span class="p">)</span>
<a id="__codelineno-568-20" name="__codelineno-568-20"></a><span class="p">}</span>
<a id="__codelineno-568-21" name="__codelineno-568-21"></a>
<a id="__codelineno-568-22" name="__codelineno-568-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-568-23" name="__codelineno-568-23"></a><span class="w">    </span><span class="nx">mux</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewServeMux</span><span class="p">()</span>
<a id="__codelineno-568-24" name="__codelineno-568-24"></a><span class="w">    </span><span class="nx">mux</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">mainHandler</span><span class="p">)</span>
<a id="__codelineno-568-25" name="__codelineno-568-25"></a>
<a id="__codelineno-568-26" name="__codelineno-568-26"></a><span class="w">    </span><span class="nx">loggedMux</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">mux</span><span class="p">)</span>
<a id="__codelineno-568-27" name="__codelineno-568-27"></a>
<a id="__codelineno-568-28" name="__codelineno-568-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;启动服务器在 :8080&quot;</span><span class="p">)</span>
<a id="__codelineno-568-29" name="__codelineno-568-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">loggedMux</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-568-30" name="__codelineno-568-30"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;服务器启动失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-568-31" name="__codelineno-568-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-568-32" name="__codelineno-568-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>loggingMiddleware</code>函数接受一个<code>http.Handler</code>，返回一个新的<code>http.Handler</code>，在请求处理前后打印日志信息。</li>
<li>
<p>使用中间件包装主处理器，实现日志记录功能。</p>
</li>
<li>
<p><strong>TLS/SSL 加密</strong>：通过HTTPS协议保护数据传输的安全性。</p>
</li>
</ul>
<p><strong>示例：使用自签名证书启动HTTPS服务器</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-569-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-569-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-569-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-569-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-569-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-569-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-569-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-569-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-569-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-569-10">10</a></span>
<span class="normal"><a href="#__codelineno-569-11">11</a></span>
<span class="normal"><a href="#__codelineno-569-12">12</a></span>
<span class="normal"><a href="#__codelineno-569-13">13</a></span>
<span class="normal"><a href="#__codelineno-569-14">14</a></span>
<span class="normal"><a href="#__codelineno-569-15">15</a></span>
<span class="normal"><a href="#__codelineno-569-16">16</a></span>
<span class="normal"><a href="#__codelineno-569-17">17</a></span>
<span class="normal"><a href="#__codelineno-569-18">18</a></span>
<span class="normal"><a href="#__codelineno-569-19">19</a></span>
<span class="normal"><a href="#__codelineno-569-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-569-1" name="__codelineno-569-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-569-2" name="__codelineno-569-2"></a>
<a id="__codelineno-569-3" name="__codelineno-569-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-569-4" name="__codelineno-569-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-569-5" name="__codelineno-569-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-569-6" name="__codelineno-569-6"></a><span class="p">)</span>
<a id="__codelineno-569-7" name="__codelineno-569-7"></a>
<a id="__codelineno-569-8" name="__codelineno-569-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">mainHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-569-9" name="__codelineno-569-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, Secure World!&quot;</span><span class="p">)</span>
<a id="__codelineno-569-10" name="__codelineno-569-10"></a><span class="p">}</span>
<a id="__codelineno-569-11" name="__codelineno-569-11"></a>
<a id="__codelineno-569-12" name="__codelineno-569-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-569-13" name="__codelineno-569-13"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">mainHandler</span><span class="p">)</span>
<a id="__codelineno-569-14" name="__codelineno-569-14"></a>
<a id="__codelineno-569-15" name="__codelineno-569-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;启动HTTPS服务器在 :8443&quot;</span><span class="p">)</span>
<a id="__codelineno-569-16" name="__codelineno-569-16"></a><span class="w">    </span><span class="c1">// 使用自签名证书和私钥启动HTTPS服务器</span>
<a id="__codelineno-569-17" name="__codelineno-569-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServeTLS</span><span class="p">(</span><span class="s">&quot;:8443&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;server.crt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;server.key&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-569-18" name="__codelineno-569-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;启动HTTPS服务器失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-569-19" name="__codelineno-569-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-569-20" name="__codelineno-569-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>注意：</strong></p>
<ul>
<li>需要生成自签名证书和私钥（<code>server.crt</code> 和 <code>server.key</code>）。</li>
<li>
<p>浏览器可能会提示证书不受信任，因为是自签名的。</p>
</li>
<li>
<p><strong>HTTP 路由库</strong>：使用第三方路由库（如<code>gorilla/mux</code>）增强路由功能，支持变量路径、路由分组等。</p>
</li>
</ul>
<p><strong>示例：使用 <code>gorilla/mux</code> 进行路由管理</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-570-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-570-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-570-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-570-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-570-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-570-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-570-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-570-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-570-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-570-10">10</a></span>
<span class="normal"><a href="#__codelineno-570-11">11</a></span>
<span class="normal"><a href="#__codelineno-570-12">12</a></span>
<span class="normal"><a href="#__codelineno-570-13">13</a></span>
<span class="normal"><a href="#__codelineno-570-14">14</a></span>
<span class="normal"><a href="#__codelineno-570-15">15</a></span>
<span class="normal"><a href="#__codelineno-570-16">16</a></span>
<span class="normal"><a href="#__codelineno-570-17">17</a></span>
<span class="normal"><a href="#__codelineno-570-18">18</a></span>
<span class="normal"><a href="#__codelineno-570-19">19</a></span>
<span class="normal"><a href="#__codelineno-570-20">20</a></span>
<span class="normal"><a href="#__codelineno-570-21">21</a></span>
<span class="normal"><a href="#__codelineno-570-22">22</a></span>
<span class="normal"><a href="#__codelineno-570-23">23</a></span>
<span class="normal"><a href="#__codelineno-570-24">24</a></span>
<span class="normal"><a href="#__codelineno-570-25">25</a></span>
<span class="normal"><a href="#__codelineno-570-26">26</a></span>
<span class="normal"><a href="#__codelineno-570-27">27</a></span>
<span class="normal"><a href="#__codelineno-570-28">28</a></span>
<span class="normal"><a href="#__codelineno-570-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-570-1" name="__codelineno-570-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-570-2" name="__codelineno-570-2"></a>
<a id="__codelineno-570-3" name="__codelineno-570-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-570-4" name="__codelineno-570-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-570-5" name="__codelineno-570-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-570-6" name="__codelineno-570-6"></a>
<a id="__codelineno-570-7" name="__codelineno-570-7"></a><span class="w">    </span><span class="s">&quot;github.com/gorilla/mux&quot;</span>
<a id="__codelineno-570-8" name="__codelineno-570-8"></a><span class="p">)</span>
<a id="__codelineno-570-9" name="__codelineno-570-9"></a>
<a id="__codelineno-570-10" name="__codelineno-570-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">getUserHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-570-11" name="__codelineno-570-11"></a><span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-570-12" name="__codelineno-570-12"></a><span class="w">    </span><span class="nx">userID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
<a id="__codelineno-570-13" name="__codelineno-570-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;获取用户: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-570-14" name="__codelineno-570-14"></a><span class="p">}</span>
<a id="__codelineno-570-15" name="__codelineno-570-15"></a>
<a id="__codelineno-570-16" name="__codelineno-570-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">createUserHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-570-17" name="__codelineno-570-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;创建用户\n&quot;</span><span class="p">)</span>
<a id="__codelineno-570-18" name="__codelineno-570-18"></a><span class="p">}</span>
<a id="__codelineno-570-19" name="__codelineno-570-19"></a>
<a id="__codelineno-570-20" name="__codelineno-570-20"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-570-21" name="__codelineno-570-21"></a><span class="w">    </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">NewRouter</span><span class="p">()</span>
<a id="__codelineno-570-22" name="__codelineno-570-22"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users/{id}&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">getUserHandler</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>
<a id="__codelineno-570-23" name="__codelineno-570-23"></a><span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">createUserHandler</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">)</span>
<a id="__codelineno-570-24" name="__codelineno-570-24"></a>
<a id="__codelineno-570-25" name="__codelineno-570-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;启动服务器在 :8080&quot;</span><span class="p">)</span>
<a id="__codelineno-570-26" name="__codelineno-570-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-570-27" name="__codelineno-570-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;服务器启动失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-570-28" name="__codelineno-570-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-570-29" name="__codelineno-570-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>gorilla/mux</code>创建一个新的路由器。</li>
<li>定义了带有变量路径的路由<code>/users/{id}</code>，用于获取特定用户的信息。</li>
<li>定义了<code>/users</code>路径的POST路由，用于创建新用户。</li>
</ul>
<p><strong>运行结果：</strong></p>
<ul>
<li>
<p><strong>GET请求</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-571-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-571-1" name="__codelineno-571-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users/123
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-572-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-572-1" name="__codelineno-572-1"></a>获取用户: 123
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong>POST请求</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-573-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-573-1" name="__codelineno-573-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/users
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-574-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-574-1" name="__codelineno-574-1"></a>创建用户
</code></pre></div></td></tr></table></div>
</li>
</ul>
<h4 id="注意事项_21">注意事项<a class="headerlink" href="#注意事项_21" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>安全性</strong>：在构建HTTP服务时，确保防范常见的Web安全漏洞，如SQL注入、跨站脚本（XSS）、跨站请求伪造（CSRF）等。</li>
<li><strong>性能优化</strong>：合理使用Goroutine和缓存机制，优化HTTP服务的性能，提升响应速度和吞吐量。</li>
<li><strong>中间件管理</strong>：合理设计和管理中间件链，确保请求处理流程的清晰和高效。</li>
<li><strong>错误处理</strong>：在处理HTTP请求和响应时，确保正确处理和返回错误信息，提升用户体验和调试效率。</li>
<li><strong>日志记录</strong>：通过日志记录请求和响应信息，帮助监控和排查问题。</li>
</ul>
<h3 id="124-socket-编程拓展内容">12.4 Socket 编程（拓展内容）<a class="headerlink" href="#124-socket-编程拓展内容" title="Permanent link">&para;</a></h3>
<p>Socket编程是网络编程的基础，允许开发者在网络层面上控制数据的发送和接收。通过Socket，应用程序可以建立网络连接，进行数据交换。Go语言的<code>net</code>包提供了丰富的Socket编程工具，使得实现高效的网络通信变得简单。</p>
<h4 id="建立socket连接">建立Socket连接<a class="headerlink" href="#建立socket连接" title="Permanent link">&para;</a></h4>
<p>在Socket编程中，建立连接是首要任务。以下示例展示了如何使用<code>net</code>包在Go中建立TCP和UDP的Socket连接。</p>
<p><strong>1. TCP Socket连接</strong></p>
<ul>
<li><strong>服务端</strong>：已经在之前的TCP服务端示例中展示。</li>
<li><strong>客户端</strong>：已经在之前的TCP客户端示例中展示。</li>
</ul>
<p><strong>2. UDP Socket连接</strong></p>
<ul>
<li><strong>服务端</strong>：已经在之前的UDP服务端示例中展示。</li>
<li><strong>客户端</strong>：已经在之前的UDP客户端示例中展示。</li>
</ul>
<h4 id="socket数据的发送与接收">Socket数据的发送与接收<a class="headerlink" href="#socket数据的发送与接收" title="Permanent link">&para;</a></h4>
<p>在Socket编程中，发送和接收数据是核心任务。数据可以是任意字节序列，通常需要设计协议以确保数据的正确解析和处理。</p>
<p><strong>示例：自定义消息协议</strong></p>
<p>以下示例展示了如何在TCP Socket连接中发送和接收自定义格式的消息，包括消息类型和数据。</p>
<p><strong>1. 服务端：处理自定义消息</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-575-1">  1</a></span>
<span class="normal"><a href="#__codelineno-575-2">  2</a></span>
<span class="normal"><a href="#__codelineno-575-3">  3</a></span>
<span class="normal"><a href="#__codelineno-575-4">  4</a></span>
<span class="normal"><a href="#__codelineno-575-5">  5</a></span>
<span class="normal"><a href="#__codelineno-575-6">  6</a></span>
<span class="normal"><a href="#__codelineno-575-7">  7</a></span>
<span class="normal"><a href="#__codelineno-575-8">  8</a></span>
<span class="normal"><a href="#__codelineno-575-9">  9</a></span>
<span class="normal"><a href="#__codelineno-575-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-575-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-575-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-575-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-575-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-575-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-575-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-575-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-575-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-575-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-575-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-575-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-575-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-575-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-575-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-575-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-575-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-575-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-575-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-575-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-575-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-575-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-575-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-575-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-575-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-575-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-575-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-575-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-575-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-575-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-575-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-575-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-575-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-575-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-575-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-575-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-575-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-575-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-575-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-575-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-575-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-575-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-575-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-575-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-575-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-575-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-575-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-575-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-575-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-575-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-575-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-575-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-575-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-575-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-575-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-575-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-575-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-575-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-575-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-575-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-575-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-575-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-575-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-575-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-575-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-575-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-575-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-575-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-575-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-575-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-575-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-575-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-575-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-575-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-575-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-575-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-575-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-575-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-575-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-575-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-575-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-575-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-575-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-575-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-575-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-575-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-575-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-575-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-575-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-575-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-575-100">100</a></span>
<span class="normal"><a href="#__codelineno-575-101">101</a></span>
<span class="normal"><a href="#__codelineno-575-102">102</a></span>
<span class="normal"><a href="#__codelineno-575-103">103</a></span>
<span class="normal"><a href="#__codelineno-575-104">104</a></span>
<span class="normal"><a href="#__codelineno-575-105">105</a></span>
<span class="normal"><a href="#__codelineno-575-106">106</a></span>
<span class="normal"><a href="#__codelineno-575-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-575-1" name="__codelineno-575-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-575-2" name="__codelineno-575-2"></a>
<a id="__codelineno-575-3" name="__codelineno-575-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-575-4" name="__codelineno-575-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-575-5" name="__codelineno-575-5"></a><span class="w">    </span><span class="s">&quot;encoding/binary&quot;</span>
<a id="__codelineno-575-6" name="__codelineno-575-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-575-7" name="__codelineno-575-7"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-575-8" name="__codelineno-575-8"></a><span class="p">)</span>
<a id="__codelineno-575-9" name="__codelineno-575-9"></a>
<a id="__codelineno-575-10" name="__codelineno-575-10"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Message</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-11" name="__codelineno-575-11"></a><span class="w">    </span><span class="nx">Type</span><span class="w"> </span><span class="kt">byte</span>
<a id="__codelineno-575-12" name="__codelineno-575-12"></a><span class="w">    </span><span class="nx">Data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span>
<a id="__codelineno-575-13" name="__codelineno-575-13"></a><span class="p">}</span>
<a id="__codelineno-575-14" name="__codelineno-575-14"></a>
<a id="__codelineno-575-15" name="__codelineno-575-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">readMessage</span><span class="p">(</span><span class="nx">reader</span><span class="w"> </span><span class="o">*</span><span class="nx">bufio</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Message</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-16" name="__codelineno-575-16"></a><span class="w">    </span><span class="c1">// 读取消息类型</span>
<a id="__codelineno-575-17" name="__codelineno-575-17"></a><span class="w">    </span><span class="nx">msgType</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadByte</span><span class="p">()</span>
<a id="__codelineno-575-18" name="__codelineno-575-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-19" name="__codelineno-575-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-575-20" name="__codelineno-575-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-21" name="__codelineno-575-21"></a>
<a id="__codelineno-575-22" name="__codelineno-575-22"></a><span class="w">    </span><span class="c1">// 读取消息长度（4字节）</span>
<a id="__codelineno-575-23" name="__codelineno-575-23"></a><span class="w">    </span><span class="nx">lengthBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-575-24" name="__codelineno-575-24"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-575-25" name="__codelineno-575-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-26" name="__codelineno-575-26"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-575-27" name="__codelineno-575-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-28" name="__codelineno-575-28"></a><span class="w">    </span><span class="nx">length</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">.</span><span class="nx">Uint32</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-575-29" name="__codelineno-575-29"></a>
<a id="__codelineno-575-30" name="__codelineno-575-30"></a><span class="w">    </span><span class="c1">// 读取消息数据</span>
<a id="__codelineno-575-31" name="__codelineno-575-31"></a><span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">)</span>
<a id="__codelineno-575-32" name="__codelineno-575-32"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-575-33" name="__codelineno-575-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-34" name="__codelineno-575-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-575-35" name="__codelineno-575-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-36" name="__codelineno-575-36"></a>
<a id="__codelineno-575-37" name="__codelineno-575-37"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Message</span><span class="p">{</span>
<a id="__codelineno-575-38" name="__codelineno-575-38"></a><span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">msgType</span><span class="p">,</span>
<a id="__codelineno-575-39" name="__codelineno-575-39"></a><span class="w">        </span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<a id="__codelineno-575-40" name="__codelineno-575-40"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-575-41" name="__codelineno-575-41"></a><span class="p">}</span>
<a id="__codelineno-575-42" name="__codelineno-575-42"></a>
<a id="__codelineno-575-43" name="__codelineno-575-43"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-44" name="__codelineno-575-44"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-575-45" name="__codelineno-575-45"></a><span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-575-46" name="__codelineno-575-46"></a>
<a id="__codelineno-575-47" name="__codelineno-575-47"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-48" name="__codelineno-575-48"></a><span class="w">        </span><span class="nx">msg</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readMessage</span><span class="p">(</span><span class="nx">reader</span><span class="p">)</span>
<a id="__codelineno-575-49" name="__codelineno-575-49"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-50" name="__codelineno-575-50"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取消息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-575-51" name="__codelineno-575-51"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-575-52" name="__codelineno-575-52"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-575-53" name="__codelineno-575-53"></a>
<a id="__codelineno-575-54" name="__codelineno-575-54"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;收到消息类型: %d, 数据: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">Type</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Data</span><span class="p">))</span>
<a id="__codelineno-575-55" name="__codelineno-575-55"></a>
<a id="__codelineno-575-56" name="__codelineno-575-56"></a><span class="w">        </span><span class="c1">// 根据消息类型处理</span>
<a id="__codelineno-575-57" name="__codelineno-575-57"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-58" name="__codelineno-575-58"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-575-59" name="__codelineno-575-59"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;类型1消息已接收&quot;</span>
<a id="__codelineno-575-60" name="__codelineno-575-60"></a><span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">response</span><span class="p">))</span>
<a id="__codelineno-575-61" name="__codelineno-575-61"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-575-62" name="__codelineno-575-62"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;类型2消息已接收&quot;</span>
<a id="__codelineno-575-63" name="__codelineno-575-63"></a><span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">response</span><span class="p">))</span>
<a id="__codelineno-575-64" name="__codelineno-575-64"></a><span class="w">        </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-575-65" name="__codelineno-575-65"></a><span class="w">            </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;未知消息类型&quot;</span>
<a id="__codelineno-575-66" name="__codelineno-575-66"></a><span class="w">            </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">response</span><span class="p">))</span>
<a id="__codelineno-575-67" name="__codelineno-575-67"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-575-68" name="__codelineno-575-68"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-69" name="__codelineno-575-69"></a><span class="p">}</span>
<a id="__codelineno-575-70" name="__codelineno-575-70"></a>
<a id="__codelineno-575-71" name="__codelineno-575-71"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">msgType</span><span class="w"> </span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-72" name="__codelineno-575-72"></a><span class="w">    </span><span class="c1">// 发送消息类型</span>
<a id="__codelineno-575-73" name="__codelineno-575-73"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">,</span><span class="w"> </span><span class="nx">msgType</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-74" name="__codelineno-575-74"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-575-75" name="__codelineno-575-75"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-76" name="__codelineno-575-76"></a>
<a id="__codelineno-575-77" name="__codelineno-575-77"></a><span class="w">    </span><span class="c1">// 发送消息长度</span>
<a id="__codelineno-575-78" name="__codelineno-575-78"></a><span class="w">    </span><span class="nx">length</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-575-79" name="__codelineno-575-79"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-80" name="__codelineno-575-80"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-575-81" name="__codelineno-575-81"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-82" name="__codelineno-575-82"></a>
<a id="__codelineno-575-83" name="__codelineno-575-83"></a><span class="w">    </span><span class="c1">// 发送消息数据</span>
<a id="__codelineno-575-84" name="__codelineno-575-84"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-575-85" name="__codelineno-575-85"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-575-86" name="__codelineno-575-86"></a><span class="p">}</span>
<a id="__codelineno-575-87" name="__codelineno-575-87"></a>
<a id="__codelineno-575-88" name="__codelineno-575-88"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-89" name="__codelineno-575-89"></a><span class="w">    </span><span class="nx">listener</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8084&quot;</span><span class="p">)</span>
<a id="__codelineno-575-90" name="__codelineno-575-90"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-91" name="__codelineno-575-91"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;监听失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-575-92" name="__codelineno-575-92"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-575-93" name="__codelineno-575-93"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-94" name="__codelineno-575-94"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-575-95" name="__codelineno-575-95"></a>
<a id="__codelineno-575-96" name="__codelineno-575-96"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;TCP 服务端启动，监听端口 :8084&quot;</span><span class="p">)</span>
<a id="__codelineno-575-97" name="__codelineno-575-97"></a>
<a id="__codelineno-575-98" name="__codelineno-575-98"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-99" name="__codelineno-575-99"></a><span class="w">        </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Accept</span><span class="p">()</span>
<a id="__codelineno-575-100" name="__codelineno-575-100"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-575-101" name="__codelineno-575-101"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接受连接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-575-102" name="__codelineno-575-102"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-575-103" name="__codelineno-575-103"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-575-104" name="__codelineno-575-104"></a>
<a id="__codelineno-575-105" name="__codelineno-575-105"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-575-106" name="__codelineno-575-106"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-575-107" name="__codelineno-575-107"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>2. 客户端：发送自定义消息</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-576-1">  1</a></span>
<span class="normal"><a href="#__codelineno-576-2">  2</a></span>
<span class="normal"><a href="#__codelineno-576-3">  3</a></span>
<span class="normal"><a href="#__codelineno-576-4">  4</a></span>
<span class="normal"><a href="#__codelineno-576-5">  5</a></span>
<span class="normal"><a href="#__codelineno-576-6">  6</a></span>
<span class="normal"><a href="#__codelineno-576-7">  7</a></span>
<span class="normal"><a href="#__codelineno-576-8">  8</a></span>
<span class="normal"><a href="#__codelineno-576-9">  9</a></span>
<span class="normal"><a href="#__codelineno-576-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-576-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-576-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-576-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-576-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-576-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-576-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-576-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-576-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-576-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-576-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-576-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-576-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-576-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-576-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-576-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-576-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-576-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-576-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-576-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-576-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-576-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-576-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-576-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-576-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-576-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-576-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-576-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-576-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-576-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-576-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-576-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-576-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-576-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-576-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-576-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-576-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-576-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-576-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-576-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-576-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-576-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-576-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-576-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-576-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-576-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-576-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-576-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-576-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-576-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-576-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-576-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-576-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-576-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-576-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-576-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-576-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-576-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-576-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-576-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-576-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-576-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-576-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-576-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-576-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-576-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-576-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-576-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-576-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-576-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-576-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-576-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-576-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-576-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-576-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-576-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-576-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-576-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-576-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-576-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-576-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-576-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-576-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-576-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-576-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-576-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-576-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-576-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-576-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-576-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-576-100">100</a></span>
<span class="normal"><a href="#__codelineno-576-101">101</a></span>
<span class="normal"><a href="#__codelineno-576-102">102</a></span>
<span class="normal"><a href="#__codelineno-576-103">103</a></span>
<span class="normal"><a href="#__codelineno-576-104">104</a></span>
<span class="normal"><a href="#__codelineno-576-105">105</a></span>
<span class="normal"><a href="#__codelineno-576-106">106</a></span>
<span class="normal"><a href="#__codelineno-576-107">107</a></span>
<span class="normal"><a href="#__codelineno-576-108">108</a></span>
<span class="normal"><a href="#__codelineno-576-109">109</a></span>
<span class="normal"><a href="#__codelineno-576-110">110</a></span>
<span class="normal"><a href="#__codelineno-576-111">111</a></span>
<span class="normal"><a href="#__codelineno-576-112">112</a></span>
<span class="normal"><a href="#__codelineno-576-113">113</a></span>
<span class="normal"><a href="#__codelineno-576-114">114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-576-1" name="__codelineno-576-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-576-2" name="__codelineno-576-2"></a>
<a id="__codelineno-576-3" name="__codelineno-576-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-576-4" name="__codelineno-576-4"></a><span class="w">    </span><span class="s">&quot;bufio&quot;</span>
<a id="__codelineno-576-5" name="__codelineno-576-5"></a><span class="w">    </span><span class="s">&quot;encoding/binary&quot;</span>
<a id="__codelineno-576-6" name="__codelineno-576-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-576-7" name="__codelineno-576-7"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-576-8" name="__codelineno-576-8"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-576-9" name="__codelineno-576-9"></a><span class="p">)</span>
<a id="__codelineno-576-10" name="__codelineno-576-10"></a>
<a id="__codelineno-576-11" name="__codelineno-576-11"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Message</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-12" name="__codelineno-576-12"></a><span class="w">    </span><span class="nx">Type</span><span class="w"> </span><span class="kt">byte</span>
<a id="__codelineno-576-13" name="__codelineno-576-13"></a><span class="w">    </span><span class="nx">Data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span>
<a id="__codelineno-576-14" name="__codelineno-576-14"></a><span class="p">}</span>
<a id="__codelineno-576-15" name="__codelineno-576-15"></a>
<a id="__codelineno-576-16" name="__codelineno-576-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span><span class="nx">msgType</span><span class="w"> </span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-17" name="__codelineno-576-17"></a><span class="w">    </span><span class="c1">// 发送消息类型</span>
<a id="__codelineno-576-18" name="__codelineno-576-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">,</span><span class="w"> </span><span class="nx">msgType</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-19" name="__codelineno-576-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-576-20" name="__codelineno-576-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-576-21" name="__codelineno-576-21"></a>
<a id="__codelineno-576-22" name="__codelineno-576-22"></a><span class="w">    </span><span class="c1">// 发送消息长度</span>
<a id="__codelineno-576-23" name="__codelineno-576-23"></a><span class="w">    </span><span class="nx">length</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-576-24" name="__codelineno-576-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-25" name="__codelineno-576-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-576-26" name="__codelineno-576-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-576-27" name="__codelineno-576-27"></a>
<a id="__codelineno-576-28" name="__codelineno-576-28"></a><span class="w">    </span><span class="c1">// 发送消息数据</span>
<a id="__codelineno-576-29" name="__codelineno-576-29"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-576-30" name="__codelineno-576-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-576-31" name="__codelineno-576-31"></a><span class="p">}</span>
<a id="__codelineno-576-32" name="__codelineno-576-32"></a>
<a id="__codelineno-576-33" name="__codelineno-576-33"></a><span class="kd">func</span><span class="w"> </span><span class="nx">readMessage</span><span class="p">(</span><span class="nx">reader</span><span class="w"> </span><span class="o">*</span><span class="nx">bufio</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Message</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-34" name="__codelineno-576-34"></a><span class="w">    </span><span class="c1">// 读取消息类型</span>
<a id="__codelineno-576-35" name="__codelineno-576-35"></a><span class="w">    </span><span class="nx">msgType</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadByte</span><span class="p">()</span>
<a id="__codelineno-576-36" name="__codelineno-576-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-37" name="__codelineno-576-37"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-576-38" name="__codelineno-576-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-576-39" name="__codelineno-576-39"></a>
<a id="__codelineno-576-40" name="__codelineno-576-40"></a><span class="w">    </span><span class="c1">// 读取消息长度（4字节）</span>
<a id="__codelineno-576-41" name="__codelineno-576-41"></a><span class="w">    </span><span class="nx">lengthBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-576-42" name="__codelineno-576-42"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-576-43" name="__codelineno-576-43"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-44" name="__codelineno-576-44"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-576-45" name="__codelineno-576-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-576-46" name="__codelineno-576-46"></a><span class="w">    </span><span class="nx">length</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">.</span><span class="nx">Uint32</span><span class="p">(</span><span class="nx">lengthBytes</span><span class="p">)</span>
<a id="__codelineno-576-47" name="__codelineno-576-47"></a>
<a id="__codelineno-576-48" name="__codelineno-576-48"></a><span class="w">    </span><span class="c1">// 读取消息数据</span>
<a id="__codelineno-576-49" name="__codelineno-576-49"></a><span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">length</span><span class="p">)</span>
<a id="__codelineno-576-50" name="__codelineno-576-50"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-576-51" name="__codelineno-576-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-52" name="__codelineno-576-52"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-576-53" name="__codelineno-576-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-576-54" name="__codelineno-576-54"></a>
<a id="__codelineno-576-55" name="__codelineno-576-55"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Message</span><span class="p">{</span>
<a id="__codelineno-576-56" name="__codelineno-576-56"></a><span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">msgType</span><span class="p">,</span>
<a id="__codelineno-576-57" name="__codelineno-576-57"></a><span class="w">        </span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<a id="__codelineno-576-58" name="__codelineno-576-58"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-576-59" name="__codelineno-576-59"></a><span class="p">}</span>
<a id="__codelineno-576-60" name="__codelineno-576-60"></a>
<a id="__codelineno-576-61" name="__codelineno-576-61"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-62" name="__codelineno-576-62"></a><span class="w">    </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Dial</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;localhost:8084&quot;</span><span class="p">)</span>
<a id="__codelineno-576-63" name="__codelineno-576-63"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-64" name="__codelineno-576-64"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;连接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-576-65" name="__codelineno-576-65"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-576-66" name="__codelineno-576-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-576-67" name="__codelineno-576-67"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-576-68" name="__codelineno-576-68"></a>
<a id="__codelineno-576-69" name="__codelineno-576-69"></a><span class="w">    </span><span class="nx">reader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">)</span>
<a id="__codelineno-576-70" name="__codelineno-576-70"></a><span class="w">    </span><span class="nx">serverReader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-576-71" name="__codelineno-576-71"></a>
<a id="__codelineno-576-72" name="__codelineno-576-72"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;TCP 客户端启动，输入消息类型和内容 (输入 &#39;exit&#39; 退出):&quot;</span><span class="p">)</span>
<a id="__codelineno-576-73" name="__codelineno-576-73"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-74" name="__codelineno-576-74"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;消息类型 (1或2): &quot;</span><span class="p">)</span>
<a id="__codelineno-576-75" name="__codelineno-576-75"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">msgType</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-576-76" name="__codelineno-576-76"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Scanf</span><span class="p">(</span><span class="s">&quot;%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">msgType</span><span class="p">)</span>
<a id="__codelineno-576-77" name="__codelineno-576-77"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-78" name="__codelineno-576-78"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取消息类型失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-576-79" name="__codelineno-576-79"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-576-80" name="__codelineno-576-80"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-576-81" name="__codelineno-576-81"></a>
<a id="__codelineno-576-82" name="__codelineno-576-82"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">msgType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">msgType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-83" name="__codelineno-576-83"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;无效的消息类型&quot;</span><span class="p">)</span>
<a id="__codelineno-576-84" name="__codelineno-576-84"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-576-85" name="__codelineno-576-85"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-576-86" name="__codelineno-576-86"></a>
<a id="__codelineno-576-87" name="__codelineno-576-87"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;消息内容: &quot;</span><span class="p">)</span>
<a id="__codelineno-576-88" name="__codelineno-576-88"></a><span class="w">        </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
<a id="__codelineno-576-89" name="__codelineno-576-89"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-90" name="__codelineno-576-90"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;读取消息内容失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-576-91" name="__codelineno-576-91"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-576-92" name="__codelineno-576-92"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-576-93" name="__codelineno-576-93"></a>
<a id="__codelineno-576-94" name="__codelineno-576-94"></a><span class="w">        </span><span class="c1">// 发送消息</span>
<a id="__codelineno-576-95" name="__codelineno-576-95"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nb">byte</span><span class="p">(</span><span class="nx">msgType</span><span class="p">),</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">message</span><span class="p">));</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-96" name="__codelineno-576-96"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送消息失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-576-97" name="__codelineno-576-97"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-576-98" name="__codelineno-576-98"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-576-99" name="__codelineno-576-99"></a>
<a id="__codelineno-576-100" name="__codelineno-576-100"></a><span class="w">        </span><span class="c1">// 接收回应</span>
<a id="__codelineno-576-101" name="__codelineno-576-101"></a><span class="w">        </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readMessage</span><span class="p">(</span><span class="nx">serverReader</span><span class="p">)</span>
<a id="__codelineno-576-102" name="__codelineno-576-102"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-103" name="__codelineno-576-103"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接收回应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-576-104" name="__codelineno-576-104"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-576-105" name="__codelineno-576-105"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-576-106" name="__codelineno-576-106"></a>
<a id="__codelineno-576-107" name="__codelineno-576-107"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;服务器回应类型: %d, 数据: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Type</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Data</span><span class="p">))</span>
<a id="__codelineno-576-108" name="__codelineno-576-108"></a>
<a id="__codelineno-576-109" name="__codelineno-576-109"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;exit\n&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-576-110" name="__codelineno-576-110"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;退出客户端&quot;</span><span class="p">)</span>
<a id="__codelineno-576-111" name="__codelineno-576-111"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-576-112" name="__codelineno-576-112"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-576-113" name="__codelineno-576-113"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-576-114" name="__codelineno-576-114"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>
<p><strong>协议设计</strong>：每条消息包括1字节的消息类型和4字节的消息长度，后续为消息数据。</p>
</li>
<li>
<p>服务端</p>
</li>
</ul>
<p>：</p>
<ul>
<li>接收消息类型和长度，读取消息内容。</li>
<li>
<p>根据消息类型进行相应的处理，并回送确认信息。</p>
</li>
<li>
<p>客户端</p>
</li>
</ul>
<p>：</p>
<ul>
<li>从用户输入读取消息类型和内容。</li>
<li>构建并发送带有类型和长度的消息。</li>
<li>接收并打印服务端的回应。</li>
</ul>
<p><strong>运行结果：</strong></p>
<p>启动服务端和客户端后，可以进行如下交互：</p>
<p><strong>服务端终端：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-577-1">1</a></span>
<span class="normal"><a href="#__codelineno-577-2">2</a></span>
<span class="normal"><a href="#__codelineno-577-3">3</a></span>
<span class="normal"><a href="#__codelineno-577-4">4</a></span>
<span class="normal"><a href="#__codelineno-577-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-577-1" name="__codelineno-577-1"></a>TCP 服务端启动，监听端口 :8084
<a id="__codelineno-577-2" name="__codelineno-577-2"></a>连接来自 127.0.0.1:53430
<a id="__codelineno-577-3" name="__codelineno-577-3"></a>收到消息类型: 1, 数据: Hello Type 1
<a id="__codelineno-577-4" name="__codelineno-577-4"></a>收到消息类型: 2, 数据: Hello Type 2
<a id="__codelineno-577-5" name="__codelineno-577-5"></a>收到消息类型: 3, 数据: exit
</code></pre></div></td></tr></table></div>
<p><strong>客户端终端：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-578-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-578-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-578-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-578-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-578-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-578-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-578-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-578-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-578-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-578-10">10</a></span>
<span class="normal"><a href="#__codelineno-578-11">11</a></span>
<span class="normal"><a href="#__codelineno-578-12">12</a></span>
<span class="normal"><a href="#__codelineno-578-13">13</a></span>
<span class="normal"><a href="#__codelineno-578-14">14</a></span>
<span class="normal"><a href="#__codelineno-578-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-578-1" name="__codelineno-578-1"></a>TCP 客户端启动，输入消息类型和内容 (输入 &#39;exit&#39; 退出):
<a id="__codelineno-578-2" name="__codelineno-578-2"></a>消息类型 (1或2): 1
<a id="__codelineno-578-3" name="__codelineno-578-3"></a>消息内容: Hello Type 1
<a id="__codelineno-578-4" name="__codelineno-578-4"></a>服务器回应类型: 1, 数据: 收到: Hello Type 1
<a id="__codelineno-578-5" name="__codelineno-578-5"></a>消息类型 (1或2): 2
<a id="__codelineno-578-6" name="__codelineno-578-6"></a>消息内容: Hello Type 2
<a id="__codelineno-578-7" name="__codelineno-578-7"></a>服务器回应类型: 2, 数据: 收到: Hello Type 2
<a id="__codelineno-578-8" name="__codelineno-578-8"></a>消息类型 (1或2): 3
<a id="__codelineno-578-9" name="__codelineno-578-9"></a>无效的消息类型
<a id="__codelineno-578-10" name="__codelineno-578-10"></a>消息类型 (1或2): exit
<a id="__codelineno-578-11" name="__codelineno-578-11"></a>无效的消息类型
<a id="__codelineno-578-12" name="__codelineno-578-12"></a>消息类型 (1或2): 1
<a id="__codelineno-578-13" name="__codelineno-578-13"></a>消息内容: exit
<a id="__codelineno-578-14" name="__codelineno-578-14"></a>服务器回应类型: 1, 数据: 收到: exit
<a id="__codelineno-578-15" name="__codelineno-578-15"></a>退出客户端
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>客户端发送不同类型的消息，服务端根据类型进行回应。</li>
<li>输入“exit”消息类型和内容后，客户端退出。</li>
</ul>
<h4 id="使用socket的高级功能">使用Socket的高级功能<a class="headerlink" href="#使用socket的高级功能" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>异步通信</strong>：通过Goroutine实现异步发送和接收，提升通信效率。</li>
</ul>
<p><strong>示例：异步接收服务端回应</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-579-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-579-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-579-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-579-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-579-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-579-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-579-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-579-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-579-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-579-10">10</a></span>
<span class="normal"><a href="#__codelineno-579-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-579-1" name="__codelineno-579-1"></a><span class="c1">// 在客户端中增加一个Goroutine用于异步接收回应</span>
<a id="__codelineno-579-2" name="__codelineno-579-2"></a><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-579-3" name="__codelineno-579-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-579-4" name="__codelineno-579-4"></a><span class="w">        </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readMessage</span><span class="p">(</span><span class="nx">serverReader</span><span class="p">)</span>
<a id="__codelineno-579-5" name="__codelineno-579-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-579-6" name="__codelineno-579-6"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接收回应失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-579-7" name="__codelineno-579-7"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-579-8" name="__codelineno-579-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-579-9" name="__codelineno-579-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;服务器回应类型: %d, 数据: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Type</span><span class="p">,</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Data</span><span class="p">))</span>
<a id="__codelineno-579-10" name="__codelineno-579-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-579-11" name="__codelineno-579-11"></a><span class="p">}()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><strong>多协议支持</strong>：通过不同的Socket类型（如TCP、UDP）支持多种协议，满足不同应用需求。</p>
</li>
<li>
<p><strong>加密通信</strong>：结合TLS/SSL实现加密的Socket通信，保护数据传输的安全性。</p>
</li>
</ul>
<p><strong>示例：使用TLS加密TCP通信</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-580-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-580-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-580-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-580-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-580-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-580-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-580-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-580-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-580-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-580-10">10</a></span>
<span class="normal"><a href="#__codelineno-580-11">11</a></span>
<span class="normal"><a href="#__codelineno-580-12">12</a></span>
<span class="normal"><a href="#__codelineno-580-13">13</a></span>
<span class="normal"><a href="#__codelineno-580-14">14</a></span>
<span class="normal"><a href="#__codelineno-580-15">15</a></span>
<span class="normal"><a href="#__codelineno-580-16">16</a></span>
<span class="normal"><a href="#__codelineno-580-17">17</a></span>
<span class="normal"><a href="#__codelineno-580-18">18</a></span>
<span class="normal"><a href="#__codelineno-580-19">19</a></span>
<span class="normal"><a href="#__codelineno-580-20">20</a></span>
<span class="normal"><a href="#__codelineno-580-21">21</a></span>
<span class="normal"><a href="#__codelineno-580-22">22</a></span>
<span class="normal"><a href="#__codelineno-580-23">23</a></span>
<span class="normal"><a href="#__codelineno-580-24">24</a></span>
<span class="normal"><a href="#__codelineno-580-25">25</a></span>
<span class="normal"><a href="#__codelineno-580-26">26</a></span>
<span class="normal"><a href="#__codelineno-580-27">27</a></span>
<span class="normal"><a href="#__codelineno-580-28">28</a></span>
<span class="normal"><a href="#__codelineno-580-29">29</a></span>
<span class="normal"><a href="#__codelineno-580-30">30</a></span>
<span class="normal"><a href="#__codelineno-580-31">31</a></span>
<span class="normal"><a href="#__codelineno-580-32">32</a></span>
<span class="normal"><a href="#__codelineno-580-33">33</a></span>
<span class="normal"><a href="#__codelineno-580-34">34</a></span>
<span class="normal"><a href="#__codelineno-580-35">35</a></span>
<span class="normal"><a href="#__codelineno-580-36">36</a></span>
<span class="normal"><a href="#__codelineno-580-37">37</a></span>
<span class="normal"><a href="#__codelineno-580-38">38</a></span>
<span class="normal"><a href="#__codelineno-580-39">39</a></span>
<span class="normal"><a href="#__codelineno-580-40">40</a></span>
<span class="normal"><a href="#__codelineno-580-41">41</a></span>
<span class="normal"><a href="#__codelineno-580-42">42</a></span>
<span class="normal"><a href="#__codelineno-580-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-580-1" name="__codelineno-580-1"></a><span class="c1">// 服务端使用TLS</span>
<a id="__codelineno-580-2" name="__codelineno-580-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-580-3" name="__codelineno-580-3"></a>
<a id="__codelineno-580-4" name="__codelineno-580-4"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-580-5" name="__codelineno-580-5"></a><span class="w">    </span><span class="s">&quot;crypto/tls&quot;</span>
<a id="__codelineno-580-6" name="__codelineno-580-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-580-7" name="__codelineno-580-7"></a><span class="w">    </span><span class="s">&quot;net&quot;</span>
<a id="__codelineno-580-8" name="__codelineno-580-8"></a><span class="p">)</span>
<a id="__codelineno-580-9" name="__codelineno-580-9"></a>
<a id="__codelineno-580-10" name="__codelineno-580-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-580-11" name="__codelineno-580-11"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-580-12" name="__codelineno-580-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;连接来自 %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">())</span>
<a id="__codelineno-580-13" name="__codelineno-580-13"></a><span class="w">    </span><span class="c1">// 处理连接...</span>
<a id="__codelineno-580-14" name="__codelineno-580-14"></a><span class="p">}</span>
<a id="__codelineno-580-15" name="__codelineno-580-15"></a>
<a id="__codelineno-580-16" name="__codelineno-580-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-580-17" name="__codelineno-580-17"></a><span class="w">    </span><span class="nx">cert</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tls</span><span class="p">.</span><span class="nx">LoadX509KeyPair</span><span class="p">(</span><span class="s">&quot;server.crt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;server.key&quot;</span><span class="p">)</span>
<a id="__codelineno-580-18" name="__codelineno-580-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-580-19" name="__codelineno-580-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;加载证书失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-580-20" name="__codelineno-580-20"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-580-21" name="__codelineno-580-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-580-22" name="__codelineno-580-22"></a>
<a id="__codelineno-580-23" name="__codelineno-580-23"></a><span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span><span class="nx">Certificates</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Certificate</span><span class="p">{</span><span class="nx">cert</span><span class="p">}}</span>
<a id="__codelineno-580-24" name="__codelineno-580-24"></a>
<a id="__codelineno-580-25" name="__codelineno-580-25"></a><span class="w">    </span><span class="nx">listener</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tls</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8443&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">)</span>
<a id="__codelineno-580-26" name="__codelineno-580-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-580-27" name="__codelineno-580-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;监听失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-580-28" name="__codelineno-580-28"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-580-29" name="__codelineno-580-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-580-30" name="__codelineno-580-30"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-580-31" name="__codelineno-580-31"></a>
<a id="__codelineno-580-32" name="__codelineno-580-32"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;TLS TCP 服务端启动，监听端口 :8443&quot;</span><span class="p">)</span>
<a id="__codelineno-580-33" name="__codelineno-580-33"></a>
<a id="__codelineno-580-34" name="__codelineno-580-34"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-580-35" name="__codelineno-580-35"></a><span class="w">        </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">listener</span><span class="p">.</span><span class="nx">Accept</span><span class="p">()</span>
<a id="__codelineno-580-36" name="__codelineno-580-36"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-580-37" name="__codelineno-580-37"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;接受连接失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-580-38" name="__codelineno-580-38"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-580-39" name="__codelineno-580-39"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-580-40" name="__codelineno-580-40"></a>
<a id="__codelineno-580-41" name="__codelineno-580-41"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
<a id="__codelineno-580-42" name="__codelineno-580-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-580-43" name="__codelineno-580-43"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>注意：</strong></p>
<ul>
<li>需要生成TLS证书和私钥（<code>server.crt</code> 和 <code>server.key</code>）。</li>
<li>客户端需要信任服务端的证书，或在连接时跳过证书验证（不推荐用于生产环境）。</li>
</ul>
<h4 id="注意事项_22">注意事项<a class="headerlink" href="#注意事项_22" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>协议设计</strong>：在Socket编程中，设计合理的通信协议至关重要。确保消息的格式、边界和解析方式一致，避免数据混淆和解析错误。</li>
<li><strong>并发控制</strong>：在处理多个Socket连接时，结合Goroutine和同步机制，确保并发访问的安全性和高效性。</li>
<li><strong>数据完整性</strong>：在发送和接收数据时，确保数据的完整性和顺序，尤其是在TCP通信中。</li>
<li><strong>错误处理</strong>：在Socket编程中，始终检查和处理网络操作中的错误，确保程序的健壮性和稳定性。</li>
<li><strong>资源管理</strong>：确保在完成Socket操作后关闭连接，释放资源，避免资源泄漏和程序崩溃。</li>
<li><strong>安全性</strong>：在开放的网络环境中，考虑数据传输的加密和认证机制，保护数据的机密性和完整性。</li>
</ul>
<h3 id="125-总结">12.5 总结<a class="headerlink" href="#125-总结" title="Permanent link">&para;</a></h3>
<p>本章深入探讨了Go语言中的网络编程，包括HTTP编程和Socket编程。通过详细的示例和解释，你已经了解了如何使用<code>net/http</code>包构建HTTP服务器和客户端，如何使用<code>net</code>包进行TCP和UDP的Socket编程，以及如何管理网络请求与响应、设计通信协议等关键技能。</p>
<p><strong>关键点回顾：</strong></p>
<ul>
<li><strong>HTTP 编程</strong>：</li>
<li>使用<code>net/http</code>包构建HTTP服务器和客户端。</li>
<li>处理HTTP请求和响应，支持RESTful API设计。</li>
<li>使用中间件增强HTTP服务功能，如日志记录、认证等。</li>
<li>结合第三方路由库（如<code>gorilla/mux</code>）管理复杂路由。</li>
<li><strong>Socket 编程</strong>：</li>
<li>使用<code>net</code>包创建TCP和UDP的服务端与客户端。</li>
<li>设计和实现自定义的通信协议，确保数据的正确解析和处理。</li>
<li>利用Goroutine和同步机制支持高并发的Socket连接。</li>
<li>实现加密的Socket通信，保护数据传输的安全性。</li>
<li><strong>高级功能</strong>：</li>
<li>异步通信和并发控制，提升网络服务的性能和响应能力。</li>
<li>数据完整性和顺序控制，确保通信的可靠性。</li>
<li>安全性措施，如TLS/SSL加密和认证机制，保护网络通信的安全。</li>
</ul>
<h2 id="13-测试">13. 测试<a class="headerlink" href="#13-测试" title="Permanent link">&para;</a></h2>
<p>测试是软件开发中确保代码质量、功能正确性和性能优化的重要环节。Go语言内置了强大的测试框架，使得编写和运行测试变得简单高效。本章将深入探讨Go语言中的测试机制，包括单元测试、性能测试以及测试覆盖率分析。通过丰富的示例和详细的解释，帮助你理解并掌握Go中的测试策略，从而编写出高质量、可靠的Go应用程序。</p>
<h3 id="131-单元测试">13.1 单元测试<a class="headerlink" href="#131-单元测试" title="Permanent link">&para;</a></h3>
<p>单元测试（Unit Testing）是测试最小可测试单元（通常是函数或方法）行为是否符合预期的过程。Go语言通过内置的<code>testing</code>包提供了强大的单元测试支持。</p>
<h4 id="使用-testing-包">使用 <code>testing</code> 包<a class="headerlink" href="#使用-testing-包" title="Permanent link">&para;</a></h4>
<p><code>testing</code>包是Go语言标准库中用于编写单元测试的核心包。它提供了<code>*testing.T</code>类型，用于在测试函数中记录错误和状态。</p>
<p><strong>基本结构：</strong></p>
<ul>
<li>测试文件通常以 <code>_test.go</code> 结尾，例如<code>math_test.go</code>。</li>
<li>测试函数以<code>Test</code>开头，接收<code>*testing.T</code>作为参数。</li>
</ul>
<p><strong>示例：</strong></p>
<p>假设我们有一个简单的数学运算函数<code>Add</code>，位于<code>math.go</code>文件中：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-581-1">1</a></span>
<span class="normal"><a href="#__codelineno-581-2">2</a></span>
<span class="normal"><a href="#__codelineno-581-3">3</a></span>
<span class="normal"><a href="#__codelineno-581-4">4</a></span>
<span class="normal"><a href="#__codelineno-581-5">5</a></span>
<span class="normal"><a href="#__codelineno-581-6">6</a></span>
<span class="normal"><a href="#__codelineno-581-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-581-1" name="__codelineno-581-1"></a><span class="c1">// math.go</span>
<a id="__codelineno-581-2" name="__codelineno-581-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-581-3" name="__codelineno-581-3"></a>
<a id="__codelineno-581-4" name="__codelineno-581-4"></a><span class="c1">// Add 返回两个整数的和</span>
<a id="__codelineno-581-5" name="__codelineno-581-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-581-6" name="__codelineno-581-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-581-7" name="__codelineno-581-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>我们可以为<code>Add</code>函数编写单元测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-582-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-582-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-582-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-582-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-582-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-582-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-582-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-582-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-582-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-582-10">10</a></span>
<span class="normal"><a href="#__codelineno-582-11">11</a></span>
<span class="normal"><a href="#__codelineno-582-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-582-1" name="__codelineno-582-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-582-2" name="__codelineno-582-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-582-3" name="__codelineno-582-3"></a>
<a id="__codelineno-582-4" name="__codelineno-582-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-582-5" name="__codelineno-582-5"></a>
<a id="__codelineno-582-6" name="__codelineno-582-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">TestAdd</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-582-7" name="__codelineno-582-7"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-582-8" name="__codelineno-582-8"></a><span class="w">    </span><span class="nx">expected</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">5</span>
<a id="__codelineno-582-9" name="__codelineno-582-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">expected</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-582-10" name="__codelineno-582-10"></a><span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Add(2, 3) = %d; want %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">expected</span><span class="p">)</span>
<a id="__codelineno-582-11" name="__codelineno-582-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-582-12" name="__codelineno-582-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>TestAdd</code>函数测试<code>Add</code>函数的正确性。</li>
<li>使用<code>if</code>语句检查实际结果是否与预期结果一致。</li>
<li>如果不一致，调用<code>t.Errorf</code>记录错误信息。</li>
</ul>
<h4 id="编写测试用例">编写测试用例<a class="headerlink" href="#编写测试用例" title="Permanent link">&para;</a></h4>
<p>编写有效的测试用例需要考虑多种输入情形，包括边界条件和异常情况。以下是一些编写测试用例的最佳实践：</p>
<ol>
<li><strong>覆盖各种输入情况</strong>：包括正常输入、边界输入和异常输入。</li>
<li><strong>保持测试的独立性</strong>：每个测试用例应独立运行，不受其他测试用例的影响。</li>
<li><strong>清晰的错误信息</strong>：在测试失败时，提供清晰、详细的错误信息，便于调试。</li>
</ol>
<p><strong>示例：</strong></p>
<p>扩展<code>Add</code>函数的测试用例，覆盖更多输入情况：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-583-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-583-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-583-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-583-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-583-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-583-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-583-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-583-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-583-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-583-10">10</a></span>
<span class="normal"><a href="#__codelineno-583-11">11</a></span>
<span class="normal"><a href="#__codelineno-583-12">12</a></span>
<span class="normal"><a href="#__codelineno-583-13">13</a></span>
<span class="normal"><a href="#__codelineno-583-14">14</a></span>
<span class="normal"><a href="#__codelineno-583-15">15</a></span>
<span class="normal"><a href="#__codelineno-583-16">16</a></span>
<span class="normal"><a href="#__codelineno-583-17">17</a></span>
<span class="normal"><a href="#__codelineno-583-18">18</a></span>
<span class="normal"><a href="#__codelineno-583-19">19</a></span>
<span class="normal"><a href="#__codelineno-583-20">20</a></span>
<span class="normal"><a href="#__codelineno-583-21">21</a></span>
<span class="normal"><a href="#__codelineno-583-22">22</a></span>
<span class="normal"><a href="#__codelineno-583-23">23</a></span>
<span class="normal"><a href="#__codelineno-583-24">24</a></span>
<span class="normal"><a href="#__codelineno-583-25">25</a></span>
<span class="normal"><a href="#__codelineno-583-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-583-1" name="__codelineno-583-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-583-2" name="__codelineno-583-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-583-3" name="__codelineno-583-3"></a>
<a id="__codelineno-583-4" name="__codelineno-583-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-583-5" name="__codelineno-583-5"></a>
<a id="__codelineno-583-6" name="__codelineno-583-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">TestAdd</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-583-7" name="__codelineno-583-7"></a><span class="w">    </span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-583-8" name="__codelineno-583-8"></a><span class="w">        </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w">     </span><span class="kt">int</span>
<a id="__codelineno-583-9" name="__codelineno-583-9"></a><span class="w">        </span><span class="nx">expected</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-583-10" name="__codelineno-583-10"></a><span class="w">    </span><span class="p">}{</span>
<a id="__codelineno-583-11" name="__codelineno-583-11"></a><span class="w">        </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span>
<a id="__codelineno-583-12" name="__codelineno-583-12"></a><span class="w">        </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-583-13" name="__codelineno-583-13"></a><span class="w">        </span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-583-14" name="__codelineno-583-14"></a><span class="w">        </span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-583-15" name="__codelineno-583-15"></a><span class="w">        </span><span class="p">{</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">},</span>
<a id="__codelineno-583-16" name="__codelineno-583-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-583-17" name="__codelineno-583-17"></a>
<a id="__codelineno-583-18" name="__codelineno-583-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-583-19" name="__codelineno-583-19"></a><span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Add(%d,%d)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">b</span><span class="p">),</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-583-20" name="__codelineno-583-20"></a><span class="w">            </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-583-21" name="__codelineno-583-21"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">expected</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-583-22" name="__codelineno-583-22"></a><span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Add(%d, %d) = %d; want %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">expected</span><span class="p">)</span>
<a id="__codelineno-583-23" name="__codelineno-583-23"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-583-24" name="__codelineno-583-24"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-583-25" name="__codelineno-583-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-583-26" name="__codelineno-583-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用表驱动测试（Table-Driven Tests）来组织多个测试用例。</li>
<li><code>t.Run</code>为每个测试用例创建一个子测试，提供更细粒度的测试报告。</li>
<li>覆盖了正数、零和负数的组合情况。</li>
</ul>
<h4 id="使用-testing-包的其他功能">使用 <code>testing</code> 包的其他功能<a class="headerlink" href="#使用-testing-包的其他功能" title="Permanent link">&para;</a></h4>
<p><code>testing</code>包不仅支持基本的测试功能，还提供了基准测试和示例测试等高级功能。</p>
<h5 id="基准测试benchmark-tests">基准测试（Benchmark Tests）<a class="headerlink" href="#基准测试benchmark-tests" title="Permanent link">&para;</a></h5>
<p>基准测试用于衡量代码的性能，通过运行特定的代码片段多次，测量其执行时间和内存分配情况。</p>
<p><strong>示例：</strong></p>
<p>为<code>Add</code>函数编写基准测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-584-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-584-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-584-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-584-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-584-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-584-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-584-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-584-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-584-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-584-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-584-1" name="__codelineno-584-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-584-2" name="__codelineno-584-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-584-3" name="__codelineno-584-3"></a>
<a id="__codelineno-584-4" name="__codelineno-584-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-584-5" name="__codelineno-584-5"></a>
<a id="__codelineno-584-6" name="__codelineno-584-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkAdd</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-584-7" name="__codelineno-584-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-584-8" name="__codelineno-584-8"></a><span class="w">        </span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-584-9" name="__codelineno-584-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-584-10" name="__codelineno-584-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>基准测试函数以<code>Benchmark</code>开头，接收<code>*testing.B</code>作为参数。</li>
<li>循环<code>b.N</code>次调用待测函数，<code>b.N</code>由测试框架自动调整以获得稳定的基准结果。</li>
</ul>
<h5 id="示例测试example-tests">示例测试（Example Tests）<a class="headerlink" href="#示例测试example-tests" title="Permanent link">&para;</a></h5>
<p>示例测试用于作为文档的一部分，展示如何使用特定函数或方法。它们也可以作为测试用例运行，确保示例代码的正确性。</p>
<p><strong>示例：</strong></p>
<p>为<code>Add</code>函数编写示例测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-585-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-585-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-585-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-585-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-585-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-585-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-585-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-585-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-585-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-585-10">10</a></span>
<span class="normal"><a href="#__codelineno-585-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-585-1" name="__codelineno-585-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-585-2" name="__codelineno-585-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-585-3" name="__codelineno-585-3"></a>
<a id="__codelineno-585-4" name="__codelineno-585-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-585-5" name="__codelineno-585-5"></a>
<a id="__codelineno-585-6" name="__codelineno-585-6"></a><span class="c1">// ExampleAdd 展示如何使用 Add 函数</span>
<a id="__codelineno-585-7" name="__codelineno-585-7"></a><span class="kd">func</span><span class="w"> </span><span class="nx">ExampleAdd</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-585-8" name="__codelineno-585-8"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-585-9" name="__codelineno-585-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">sum</span><span class="p">)</span>
<a id="__codelineno-585-10" name="__codelineno-585-10"></a><span class="w">    </span><span class="c1">// Output: 5</span>
<a id="__codelineno-585-11" name="__codelineno-585-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>ExampleAdd</code>函数展示了如何调用<code>Add</code>函数并打印结果。</li>
<li>注释中的<code>// Output: 5</code>用于验证示例输出是否正确。</li>
<li>运行<code>go test</code>时，示例测试会自动执行并验证输出。</li>
</ul>
<h4 id="运行测试">运行测试<a class="headerlink" href="#运行测试" title="Permanent link">&para;</a></h4>
<p>使用<code>go test</code>命令运行当前目录下的所有测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-586-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-586-1" name="__codelineno-586-1"></a>go<span class="w"> </span><span class="nb">test</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-587-1">1</a></span>
<span class="normal"><a href="#__codelineno-587-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-587-1" name="__codelineno-587-1"></a>PASS
<a id="__codelineno-587-2" name="__codelineno-587-2"></a>ok      your_module/math    0.001s
</code></pre></div></td></tr></table></div>
<p>运行所有测试，包括基准测试和示例测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-588-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-588-1" name="__codelineno-588-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v
</code></pre></div></td></tr></table></div>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-589-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-589-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-589-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-589-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-589-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-589-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-589-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-589-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-589-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-589-10">10</a></span>
<span class="normal"><a href="#__codelineno-589-11">11</a></span>
<span class="normal"><a href="#__codelineno-589-12">12</a></span>
<span class="normal"><a href="#__codelineno-589-13">13</a></span>
<span class="normal"><a href="#__codelineno-589-14">14</a></span>
<span class="normal"><a href="#__codelineno-589-15">15</a></span>
<span class="normal"><a href="#__codelineno-589-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-589-1" name="__codelineno-589-1"></a>=== RUN   TestAdd
<a id="__codelineno-589-2" name="__codelineno-589-2"></a>=== RUN   TestAdd/Add(2,3)
<a id="__codelineno-589-3" name="__codelineno-589-3"></a>=== RUN   TestAdd/Add(0,0)
<a id="__codelineno-589-4" name="__codelineno-589-4"></a>=== RUN   TestAdd/Add(-1,-1)
<a id="__codelineno-589-5" name="__codelineno-589-5"></a>=== RUN   TestAdd/Add(-1,1)
<a id="__codelineno-589-6" name="__codelineno-589-6"></a>=== RUN   TestAdd/Add(1000,2000)
<a id="__codelineno-589-7" name="__codelineno-589-7"></a>--- PASS: TestAdd (0.00s)
<a id="__codelineno-589-8" name="__codelineno-589-8"></a>    --- PASS: TestAdd/Add(2,3) (0.00s)
<a id="__codelineno-589-9" name="__codelineno-589-9"></a>    --- PASS: TestAdd/Add(0,0) (0.00s)
<a id="__codelineno-589-10" name="__codelineno-589-10"></a>    --- PASS: TestAdd/Add(-1,-1) (0.00s)
<a id="__codelineno-589-11" name="__codelineno-589-11"></a>    --- PASS: TestAdd/Add(-1,1) (0.00s)
<a id="__codelineno-589-12" name="__codelineno-589-12"></a>    --- PASS: TestAdd/Add(1000,2000) (0.00s)
<a id="__codelineno-589-13" name="__codelineno-589-13"></a>=== RUN   ExampleAdd
<a id="__codelineno-589-14" name="__codelineno-589-14"></a>--- PASS: ExampleAdd (0.00s)
<a id="__codelineno-589-15" name="__codelineno-589-15"></a>PASS
<a id="__codelineno-589-16" name="__codelineno-589-16"></a>ok      your_module/math    0.002s
</code></pre></div></td></tr></table></div>
<p>运行基准测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-590-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-590-1" name="__codelineno-590-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>.
</code></pre></div></td></tr></table></div>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-591-1">1</a></span>
<span class="normal"><a href="#__codelineno-591-2">2</a></span>
<span class="normal"><a href="#__codelineno-591-3">3</a></span>
<span class="normal"><a href="#__codelineno-591-4">4</a></span>
<span class="normal"><a href="#__codelineno-591-5">5</a></span>
<span class="normal"><a href="#__codelineno-591-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-591-1" name="__codelineno-591-1"></a>goos: linux
<a id="__codelineno-591-2" name="__codelineno-591-2"></a>goarch: amd64
<a id="__codelineno-591-3" name="__codelineno-591-3"></a>pkg: your_module/math
<a id="__codelineno-591-4" name="__codelineno-591-4"></a>BenchmarkAdd-8      1000000000           0.000000 ns/op
<a id="__codelineno-591-5" name="__codelineno-591-5"></a>PASS
<a id="__codelineno-591-6" name="__codelineno-591-6"></a>ok      your_module/math    1.389s
</code></pre></div></td></tr></table></div>
<h3 id="132-性能测试">13.2 性能测试<a class="headerlink" href="#132-性能测试" title="Permanent link">&para;</a></h3>
<p>性能测试（Benchmark Testing）用于评估代码在不同负载下的表现，帮助开发者识别和优化性能瓶颈。Go的<code>testing</code>包提供了内置的基准测试功能，使得性能测试变得简单高效。</p>
<h4 id="benchmark-测试"><code>benchmark</code> 测试<a class="headerlink" href="#benchmark-测试" title="Permanent link">&para;</a></h4>
<p>基准测试通过多次运行代码片段，测量其执行时间和资源消耗。以下是编写和运行基准测试的详细步骤。</p>
<h5 id="编写基准测试">编写基准测试<a class="headerlink" href="#编写基准测试" title="Permanent link">&para;</a></h5>
<p>基准测试函数以<code>Benchmark</code>开头，接收<code>*testing.B</code>作为参数。测试函数中的循环<code>for i := 0; i &lt; b.N; i++</code>用于多次调用待测代码，<code>b.N</code>由测试框架自动调整，以获得稳定的基准结果。</p>
<p><strong>示例：</strong></p>
<p>为<code>Add</code>函数编写基准测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-592-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-592-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-592-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-592-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-592-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-592-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-592-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-592-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-592-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-592-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-592-1" name="__codelineno-592-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-592-2" name="__codelineno-592-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-592-3" name="__codelineno-592-3"></a>
<a id="__codelineno-592-4" name="__codelineno-592-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-592-5" name="__codelineno-592-5"></a>
<a id="__codelineno-592-6" name="__codelineno-592-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkAdd</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-592-7" name="__codelineno-592-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-592-8" name="__codelineno-592-8"></a><span class="w">        </span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-592-9" name="__codelineno-592-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-592-10" name="__codelineno-592-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>BenchmarkAdd</code>函数通过循环调用<code>Add(1, 2)</code>来评估其性能。</li>
<li><code>b.N</code>的值由测试框架自动确定，以确保测试结果的准确性。</li>
</ul>
<h5 id="运行基准测试">运行基准测试<a class="headerlink" href="#运行基准测试" title="Permanent link">&para;</a></h5>
<p>使用<code>go test</code>命令运行基准测试，并使用<code>-bench</code>标志指定要运行的基准测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-593-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-593-1" name="__codelineno-593-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>.
</code></pre></div></td></tr></table></div>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-594-1">1</a></span>
<span class="normal"><a href="#__codelineno-594-2">2</a></span>
<span class="normal"><a href="#__codelineno-594-3">3</a></span>
<span class="normal"><a href="#__codelineno-594-4">4</a></span>
<span class="normal"><a href="#__codelineno-594-5">5</a></span>
<span class="normal"><a href="#__codelineno-594-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-594-1" name="__codelineno-594-1"></a>goos: linux
<a id="__codelineno-594-2" name="__codelineno-594-2"></a>goarch: amd64
<a id="__codelineno-594-3" name="__codelineno-594-3"></a>pkg: your_module/math
<a id="__codelineno-594-4" name="__codelineno-594-4"></a>BenchmarkAdd-8      1000000000           0.000000 ns/op
<a id="__codelineno-594-5" name="__codelineno-594-5"></a>PASS
<a id="__codelineno-594-6" name="__codelineno-594-6"></a>ok      your_module/math    1.389s
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>BenchmarkAdd-8</code>表示在8个CPU核上运行的基准测试。</li>
<li><code>1000000000</code>表示运行次数。</li>
<li><code>0.000000 ns/op</code>表示每次操作的纳秒级别的执行时间。</li>
</ul>
<h5 id="优化基准测试">优化基准测试<a class="headerlink" href="#优化基准测试" title="Permanent link">&para;</a></h5>
<p>在基准测试中，确保不包含初始化或清理代码，以准确测量待测代码的性能。使用<code>b.ResetTimer()</code>可以在进行必要的初始化后重置计时器，仅测量关键代码部分的执行时间。</p>
<p><strong>示例：</strong></p>
<p>假设我们有一个需要初始化的数据结构：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-595-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-595-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-595-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-595-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-595-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-595-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-595-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-595-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-595-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-595-10">10</a></span>
<span class="normal"><a href="#__codelineno-595-11">11</a></span>
<span class="normal"><a href="#__codelineno-595-12">12</a></span>
<span class="normal"><a href="#__codelineno-595-13">13</a></span>
<span class="normal"><a href="#__codelineno-595-14">14</a></span>
<span class="normal"><a href="#__codelineno-595-15">15</a></span>
<span class="normal"><a href="#__codelineno-595-16">16</a></span>
<span class="normal"><a href="#__codelineno-595-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-595-1" name="__codelineno-595-1"></a><span class="c1">// data.go</span>
<a id="__codelineno-595-2" name="__codelineno-595-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">data</span>
<a id="__codelineno-595-3" name="__codelineno-595-3"></a>
<a id="__codelineno-595-4" name="__codelineno-595-4"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-595-5" name="__codelineno-595-5"></a><span class="w">    </span><span class="nx">Numbers</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<a id="__codelineno-595-6" name="__codelineno-595-6"></a><span class="p">}</span>
<a id="__codelineno-595-7" name="__codelineno-595-7"></a>
<a id="__codelineno-595-8" name="__codelineno-595-8"></a><span class="c1">// InitializeData 初始化数据结构</span>
<a id="__codelineno-595-9" name="__codelineno-595-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">InitializeData</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Data</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-595-10" name="__codelineno-595-10"></a><span class="w">    </span><span class="nx">d</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Data</span><span class="p">{</span>
<a id="__codelineno-595-11" name="__codelineno-595-11"></a><span class="w">        </span><span class="nx">Numbers</span><span class="p">:</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">n</span><span class="p">),</span>
<a id="__codelineno-595-12" name="__codelineno-595-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-595-13" name="__codelineno-595-13"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">n</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-595-14" name="__codelineno-595-14"></a><span class="w">        </span><span class="nx">d</span><span class="p">.</span><span class="nx">Numbers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span>
<a id="__codelineno-595-15" name="__codelineno-595-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-595-16" name="__codelineno-595-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">d</span>
<a id="__codelineno-595-17" name="__codelineno-595-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>为<code>InitializeData</code>函数编写基准测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-596-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-596-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-596-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-596-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-596-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-596-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-596-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-596-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-596-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-596-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-596-1" name="__codelineno-596-1"></a><span class="c1">// data_test.go</span>
<a id="__codelineno-596-2" name="__codelineno-596-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">data</span>
<a id="__codelineno-596-3" name="__codelineno-596-3"></a>
<a id="__codelineno-596-4" name="__codelineno-596-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-596-5" name="__codelineno-596-5"></a>
<a id="__codelineno-596-6" name="__codelineno-596-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkInitializeData</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-596-7" name="__codelineno-596-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-596-8" name="__codelineno-596-8"></a><span class="w">        </span><span class="nx">InitializeData</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-596-9" name="__codelineno-596-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-596-10" name="__codelineno-596-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>优化后的基准测试：</strong></p>
<p>如果初始化过程包含不必要的操作，可以通过<code>b.ResetTimer()</code>优化：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-597-1">1</a></span>
<span class="normal"><a href="#__codelineno-597-2">2</a></span>
<span class="normal"><a href="#__codelineno-597-3">3</a></span>
<span class="normal"><a href="#__codelineno-597-4">4</a></span>
<span class="normal"><a href="#__codelineno-597-5">5</a></span>
<span class="normal"><a href="#__codelineno-597-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-597-1" name="__codelineno-597-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkInitializeDataOptimized</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-597-2" name="__codelineno-597-2"></a><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">ResetTimer</span><span class="p">()</span><span class="w"> </span><span class="c1">// 重置计时器，仅测量InitializeData的执行时间</span>
<a id="__codelineno-597-3" name="__codelineno-597-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-597-4" name="__codelineno-597-4"></a><span class="w">        </span><span class="nx">InitializeData</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-597-5" name="__codelineno-597-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-597-6" name="__codelineno-597-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="基准测试结果解释">基准测试结果解释<a class="headerlink" href="#基准测试结果解释" title="Permanent link">&para;</a></h5>
<p>基准测试结果提供了代码的执行时间和每次操作的资源消耗。通过比较不同实现的基准测试结果，可以识别和优化性能瓶颈。</p>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-598-1">1</a></span>
<span class="normal"><a href="#__codelineno-598-2">2</a></span>
<span class="normal"><a href="#__codelineno-598-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-598-1" name="__codelineno-598-1"></a>BenchmarkAdd-8       2000000000          0.30 ns/op
<a id="__codelineno-598-2" name="__codelineno-598-2"></a>BenchmarkInitializeData-8          50000         30000 ns/op
<a id="__codelineno-598-3" name="__codelineno-598-3"></a>BenchmarkInitializeDataOptimized-8         50000         20000 ns/op
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>BenchmarkAdd-8</code>：<code>Add</code>函数每次操作耗时约0.30纳秒。</li>
<li><code>BenchmarkInitializeData-8</code>：<code>InitializeData</code>函数每次操作耗时约30000纳秒。</li>
<li><code>BenchmarkInitializeDataOptimized-8</code>：优化后的<code>InitializeData</code>函数每次操作耗时约20000纳秒。</li>
</ul>
<p>通过优化，函数的性能得到了显著提升。</p>
<h4 id="结合基准测试进行性能优化">结合基准测试进行性能优化<a class="headerlink" href="#结合基准测试进行性能优化" title="Permanent link">&para;</a></h4>
<p>基准测试是性能优化的重要工具，通过反复测试和分析，可以逐步提升代码的执行效率。以下是使用基准测试进行性能优化的步骤：</p>
<ol>
<li><strong>编写基准测试</strong>：为关键函数编写基准测试，了解其当前性能。</li>
<li><strong>运行基准测试</strong>：使用<code>go test -bench=.</code>命令运行基准测试，记录初始性能数据。</li>
<li><strong>分析结果</strong>：根据基准测试结果，识别性能瓶颈。</li>
<li><strong>优化代码</strong>：针对性能瓶颈进行代码优化。</li>
<li><strong>重新测试</strong>：重新运行基准测试，验证优化效果。</li>
<li><strong>重复迭代</strong>：持续优化，直至达到满意的性能水平。</li>
</ol>
<p><strong>示例：优化<code>Add</code>函数</strong></p>
<p>假设我们有一个复杂的<code>Add</code>函数，原始版本：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-599-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-599-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-599-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-599-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-599-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-599-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-599-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-599-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-599-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-599-10">10</a></span>
<span class="normal"><a href="#__codelineno-599-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-599-1" name="__codelineno-599-1"></a><span class="c1">// math.go</span>
<a id="__codelineno-599-2" name="__codelineno-599-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-599-3" name="__codelineno-599-3"></a>
<a id="__codelineno-599-4" name="__codelineno-599-4"></a><span class="c1">// Add 计算两个整数的和，包含一些额外的逻辑</span>
<a id="__codelineno-599-5" name="__codelineno-599-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-599-6" name="__codelineno-599-6"></a><span class="w">    </span><span class="c1">// 模拟复杂的计算过程</span>
<a id="__codelineno-599-7" name="__codelineno-599-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-599-8" name="__codelineno-599-8"></a><span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-599-9" name="__codelineno-599-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-599-10" name="__codelineno-599-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-599-11" name="__codelineno-599-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>基准测试：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-600-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-600-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-600-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-600-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-600-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-600-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-600-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-600-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-600-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-600-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-600-1" name="__codelineno-600-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-600-2" name="__codelineno-600-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-600-3" name="__codelineno-600-3"></a>
<a id="__codelineno-600-4" name="__codelineno-600-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-600-5" name="__codelineno-600-5"></a>
<a id="__codelineno-600-6" name="__codelineno-600-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">BenchmarkAdd</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-600-7" name="__codelineno-600-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-600-8" name="__codelineno-600-8"></a><span class="w">        </span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-600-9" name="__codelineno-600-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-600-10" name="__codelineno-600-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行基准测试：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-601-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-601-1" name="__codelineno-601-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>.
</code></pre></div></td></tr></table></div>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-602-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-602-1" name="__codelineno-602-1"></a>BenchmarkAdd-8          5000        300000 ns/op
</code></pre></div></td></tr></table></div>
<p><strong>优化后的<code>Add</code>函数：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-603-1">1</a></span>
<span class="normal"><a href="#__codelineno-603-2">2</a></span>
<span class="normal"><a href="#__codelineno-603-3">3</a></span>
<span class="normal"><a href="#__codelineno-603-4">4</a></span>
<span class="normal"><a href="#__codelineno-603-5">5</a></span>
<span class="normal"><a href="#__codelineno-603-6">6</a></span>
<span class="normal"><a href="#__codelineno-603-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-603-1" name="__codelineno-603-1"></a><span class="c1">// math.go</span>
<a id="__codelineno-603-2" name="__codelineno-603-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-603-3" name="__codelineno-603-3"></a>
<a id="__codelineno-603-4" name="__codelineno-603-4"></a><span class="c1">// Add 优化后的计算两个整数的和</span>
<a id="__codelineno-603-5" name="__codelineno-603-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-603-6" name="__codelineno-603-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-603-7" name="__codelineno-603-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>重新运行基准测试：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-604-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-604-1" name="__codelineno-604-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>.
</code></pre></div></td></tr></table></div>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-605-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-605-1" name="__codelineno-605-1"></a>BenchmarkAdd-8      2000000000           0.30 ns/op
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<p>通过移除不必要的循环和复杂逻辑，<code>Add</code>函数的性能得到了显著提升。</p>
<h4 id="注意事项_23">注意事项<a class="headerlink" href="#注意事项_23" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>确保基准测试的准确性</strong>：避免在基准测试中包含非关键代码，如初始化、日志记录等。</li>
<li><strong>避免优化过早</strong>：先确保代码的正确性，再进行性能优化。优化过早可能导致不必要的复杂性。</li>
<li><strong>持续测试</strong>：在优化过程中，持续运行基准测试，确保优化措施确实带来了性能提升。</li>
<li><strong>理解基准测试结果</strong>：深入理解基准测试输出，正确解释和应用性能数据。</li>
</ul>
<h3 id="133-测试覆盖率">13.3 测试覆盖率<a class="headerlink" href="#133-测试覆盖率" title="Permanent link">&para;</a></h3>
<p>测试覆盖率（Test Coverage）是衡量测试用例覆盖代码程度的指标，表示有多少代码被测试用例执行过。高测试覆盖率通常意味着代码的可靠性和稳定性更高。Go语言提供了内置工具来测量和分析测试覆盖率。</p>
<h4 id="测试覆盖率概述">测试覆盖率概述<a class="headerlink" href="#测试覆盖率概述" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>覆盖率百分比</strong>：表示被测试代码行占总代码行的比例。</li>
<li><strong>覆盖率报告</strong>：详细展示哪些代码被测试用例覆盖，哪些未被覆盖，便于开发者改进测试用例。</li>
</ul>
<h4 id="生成覆盖率报告">生成覆盖率报告<a class="headerlink" href="#生成覆盖率报告" title="Permanent link">&para;</a></h4>
<p>使用<code>go test</code>命令的<code>-cover</code>标志可以生成覆盖率报告。结合<code>-coverprofile</code>标志，可以生成详细的覆盖率文件，并使用<code>go tool cover</code>进行可视化展示。</p>
<p><strong>示例：生成覆盖率报告</strong></p>
<ol>
<li><strong>运行测试并生成覆盖率文件：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-606-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-606-1" name="__codelineno-606-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-coverprofile<span class="o">=</span>coverage.out
</code></pre></div></td></tr></table></div>
<p><strong>示例输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-607-1">1</a></span>
<span class="normal"><a href="#__codelineno-607-2">2</a></span>
<span class="normal"><a href="#__codelineno-607-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-607-1" name="__codelineno-607-1"></a>PASS
<a id="__codelineno-607-2" name="__codelineno-607-2"></a>coverage: 75.0% of statements
<a id="__codelineno-607-3" name="__codelineno-607-3"></a>ok      your_module/math    0.001s
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>查看覆盖率报告：</strong></li>
</ol>
<p>使用<code>go tool cover</code>生成HTML报告：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-608-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-608-1" name="__codelineno-608-1"></a>go<span class="w"> </span>tool<span class="w"> </span>cover<span class="w"> </span>-html<span class="o">=</span>coverage.out<span class="w"> </span>-o<span class="w"> </span>coverage.html
</code></pre></div></td></tr></table></div>
<p>打开<code>coverage.html</code>文件，可以在浏览器中可视化查看代码覆盖情况，绿色表示被覆盖的代码，红色表示未被覆盖的代码。</p>
<h4 id="分析覆盖率报告">分析覆盖率报告<a class="headerlink" href="#分析覆盖率报告" title="Permanent link">&para;</a></h4>
<p>覆盖率报告提供了代码每一行是否被测试用例执行过的信息。通过分析覆盖率报告，可以识别未被测试的代码部分，编写相应的测试用例以提升覆盖率。</p>
<p><strong>示例：覆盖率报告解析</strong></p>
<p>假设<code>math.go</code>文件内容如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-609-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-609-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-609-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-609-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-609-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-609-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-609-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-609-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-609-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-609-10">10</a></span>
<span class="normal"><a href="#__codelineno-609-11">11</a></span>
<span class="normal"><a href="#__codelineno-609-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-609-1" name="__codelineno-609-1"></a><span class="c1">// math.go</span>
<a id="__codelineno-609-2" name="__codelineno-609-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-609-3" name="__codelineno-609-3"></a>
<a id="__codelineno-609-4" name="__codelineno-609-4"></a><span class="c1">// Add 返回两个整数的和</span>
<a id="__codelineno-609-5" name="__codelineno-609-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-609-6" name="__codelineno-609-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-609-7" name="__codelineno-609-7"></a><span class="p">}</span>
<a id="__codelineno-609-8" name="__codelineno-609-8"></a>
<a id="__codelineno-609-9" name="__codelineno-609-9"></a><span class="c1">// Sub 返回两个整数的差</span>
<a id="__codelineno-609-10" name="__codelineno-609-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Sub</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-609-11" name="__codelineno-609-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-609-12" name="__codelineno-609-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>对应的测试文件<code>math_test.go</code>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-610-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-610-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-610-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-610-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-610-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-610-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-610-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-610-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-610-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-610-10">10</a></span>
<span class="normal"><a href="#__codelineno-610-11">11</a></span>
<span class="normal"><a href="#__codelineno-610-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-610-1" name="__codelineno-610-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-610-2" name="__codelineno-610-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-610-3" name="__codelineno-610-3"></a>
<a id="__codelineno-610-4" name="__codelineno-610-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-610-5" name="__codelineno-610-5"></a>
<a id="__codelineno-610-6" name="__codelineno-610-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">TestAdd</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-610-7" name="__codelineno-610-7"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-610-8" name="__codelineno-610-8"></a><span class="w">    </span><span class="nx">expected</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">5</span>
<a id="__codelineno-610-9" name="__codelineno-610-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">expected</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-610-10" name="__codelineno-610-10"></a><span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Add(2, 3) = %d; want %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">expected</span><span class="p">)</span>
<a id="__codelineno-610-11" name="__codelineno-610-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-610-12" name="__codelineno-610-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>运行测试并生成覆盖率报告：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-611-1">1</a></span>
<span class="normal"><a href="#__codelineno-611-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-611-1" name="__codelineno-611-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-coverprofile<span class="o">=</span>coverage.out
<a id="__codelineno-611-2" name="__codelineno-611-2"></a>go<span class="w"> </span>tool<span class="w"> </span>cover<span class="w"> </span>-html<span class="o">=</span>coverage.out<span class="w"> </span>-o<span class="w"> </span>coverage.html
</code></pre></div></td></tr></table></div>
<p><strong>分析结果：</strong></p>
<ul>
<li><code>Add</code>函数的代码被测试用例覆盖，显示为绿色。</li>
<li><code>Sub</code>函数未被任何测试用例覆盖，显示为红色。</li>
</ul>
<p>通过覆盖率报告，可以明确发现<code>Sub</code>函数缺少测试用例。</p>
<h4 id="提高测试覆盖率的策略">提高测试覆盖率的策略<a class="headerlink" href="#提高测试覆盖率的策略" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>编写更多测试用例</strong>：为未覆盖的代码部分编写测试用例，确保所有功能都被测试。</li>
<li><strong>使用表驱动测试</strong>：通过表驱动测试结构，可以高效地覆盖多种输入情况。</li>
<li><strong>测试边界条件</strong>：确保测试用例涵盖边界条件和异常情况，提升代码的鲁棒性。</li>
<li><strong>定期检查覆盖率</strong>：在开发过程中，定期运行覆盖率测试，及时发现未覆盖的代码。</li>
<li><strong>利用代码审查</strong>：在代码审查过程中，关注测试覆盖率，确保新代码被充分测试。</li>
</ol>
<p><strong>示例：为<code>Sub</code>函数编写测试用例</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-612-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-612-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-612-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-612-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-612-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-612-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-612-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-612-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-612-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-612-10">10</a></span>
<span class="normal"><a href="#__codelineno-612-11">11</a></span>
<span class="normal"><a href="#__codelineno-612-12">12</a></span>
<span class="normal"><a href="#__codelineno-612-13">13</a></span>
<span class="normal"><a href="#__codelineno-612-14">14</a></span>
<span class="normal"><a href="#__codelineno-612-15">15</a></span>
<span class="normal"><a href="#__codelineno-612-16">16</a></span>
<span class="normal"><a href="#__codelineno-612-17">17</a></span>
<span class="normal"><a href="#__codelineno-612-18">18</a></span>
<span class="normal"><a href="#__codelineno-612-19">19</a></span>
<span class="normal"><a href="#__codelineno-612-20">20</a></span>
<span class="normal"><a href="#__codelineno-612-21">21</a></span>
<span class="normal"><a href="#__codelineno-612-22">22</a></span>
<span class="normal"><a href="#__codelineno-612-23">23</a></span>
<span class="normal"><a href="#__codelineno-612-24">24</a></span>
<span class="normal"><a href="#__codelineno-612-25">25</a></span>
<span class="normal"><a href="#__codelineno-612-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-612-1" name="__codelineno-612-1"></a><span class="c1">// math_test.go</span>
<a id="__codelineno-612-2" name="__codelineno-612-2"></a><span class="kn">package</span><span class="w"> </span><span class="nx">math</span>
<a id="__codelineno-612-3" name="__codelineno-612-3"></a>
<a id="__codelineno-612-4" name="__codelineno-612-4"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;testing&quot;</span>
<a id="__codelineno-612-5" name="__codelineno-612-5"></a>
<a id="__codelineno-612-6" name="__codelineno-612-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">TestSub</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-612-7" name="__codelineno-612-7"></a><span class="w">    </span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-612-8" name="__codelineno-612-8"></a><span class="w">        </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="w">     </span><span class="kt">int</span>
<a id="__codelineno-612-9" name="__codelineno-612-9"></a><span class="w">        </span><span class="nx">expected</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-612-10" name="__codelineno-612-10"></a><span class="w">    </span><span class="p">}{</span>
<a id="__codelineno-612-11" name="__codelineno-612-11"></a><span class="w">        </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-612-12" name="__codelineno-612-12"></a><span class="w">        </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-612-13" name="__codelineno-612-13"></a><span class="w">        </span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-612-14" name="__codelineno-612-14"></a><span class="w">        </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span>
<a id="__codelineno-612-15" name="__codelineno-612-15"></a><span class="w">        </span><span class="p">{</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">},</span>
<a id="__codelineno-612-16" name="__codelineno-612-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-612-17" name="__codelineno-612-17"></a>
<a id="__codelineno-612-18" name="__codelineno-612-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-612-19" name="__codelineno-612-19"></a><span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Sub(%d,%d)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">b</span><span class="p">),</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-612-20" name="__codelineno-612-20"></a><span class="w">            </span><span class="nx">diff</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Sub</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>
<a id="__codelineno-612-21" name="__codelineno-612-21"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">diff</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">expected</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-612-22" name="__codelineno-612-22"></a><span class="w">                </span><span class="nx">t</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;Sub(%d, %d) = %d; want %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span><span class="w"> </span><span class="nx">diff</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">expected</span><span class="p">)</span>
<a id="__codelineno-612-23" name="__codelineno-612-23"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-612-24" name="__codelineno-612-24"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-612-25" name="__codelineno-612-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-612-26" name="__codelineno-612-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行测试并更新覆盖率报告：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-613-1">1</a></span>
<span class="normal"><a href="#__codelineno-613-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-613-1" name="__codelineno-613-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-coverprofile<span class="o">=</span>coverage.out
<a id="__codelineno-613-2" name="__codelineno-613-2"></a>go<span class="w"> </span>tool<span class="w"> </span>cover<span class="w"> </span>-html<span class="o">=</span>coverage.out<span class="w"> </span>-o<span class="w"> </span>coverage.html
</code></pre></div></td></tr></table></div>
<p><strong>更新后的覆盖率报告：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-614-1">1</a></span>
<span class="normal"><a href="#__codelineno-614-2">2</a></span>
<span class="normal"><a href="#__codelineno-614-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-614-1" name="__codelineno-614-1"></a>PASS
<a id="__codelineno-614-2" name="__codelineno-614-2"></a>coverage: 100.0% of statements
<a id="__codelineno-614-3" name="__codelineno-614-3"></a>ok      your_module/math    0.002s
</code></pre></div></td></tr></table></div>
<p>通过编写<code>TestSub</code>函数，所有代码行都被测试用例覆盖，覆盖率达到了100%。</p>
<h4 id="注意事项_24">注意事项<a class="headerlink" href="#注意事项_24" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>平衡覆盖率与测试质量</strong>：高覆盖率并不意味着高质量的测试。应确保测试用例不仅覆盖代码行，还能验证代码的正确性和功能。</li>
<li><strong>避免过度测试</strong>：针对简单的代码逻辑，过多的测试用例可能导致维护成本增加。应根据代码的重要性和复杂性合理编写测试用例。</li>
<li><strong>关注未覆盖的关键代码</strong>：重点关注关键路径和高风险的代码部分，确保这些部分被充分测试。</li>
</ul>
<h3 id="134-总结">13.4 总结<a class="headerlink" href="#134-总结" title="Permanent link">&para;</a></h3>
<p>本章深入探讨了Go语言中的测试机制，包括单元测试、性能测试以及测试覆盖率分析。通过详细的示例和解释，你已经了解了如何使用<code>testing</code>包编写和运行单元测试，如何进行基准测试评估代码性能，以及如何生成和分析测试覆盖率报告以提升代码质量。</p>
<p><strong>关键点回顾：</strong></p>
<ul>
<li><strong>单元测试（Unit Testing）</strong>：</li>
<li>使用<code>testing</code>包编写测试函数，以<code>Test</code>开头。</li>
<li>编写表驱动测试用例，覆盖多种输入情况。</li>
<li>使用<code>Benchmark</code>函数进行基准测试，评估代码性能。</li>
<li>编写示例测试，展示函数的使用方法。</li>
<li><strong>性能测试（Benchmark Testing）</strong>：</li>
<li>编写基准测试函数，以<code>Benchmark</code>开头。</li>
<li>使用<code>go test -bench=.</code>命令运行基准测试。</li>
<li>通过优化代码和重新测试，提升代码性能。</li>
<li><strong>测试覆盖率（Test Coverage）</strong>：</li>
<li>使用<code>go test -cover</code>命令查看基本覆盖率。</li>
<li>生成详细的覆盖率报告，使用<code>go tool cover</code>进行可视化展示。</li>
<li>编写更多测试用例，提升测试覆盖率。</li>
<li>关注关键代码和边界条件，确保代码的可靠性。</li>
</ul>
<h2 id="14-常用工具与最佳实践">14. 常用工具与最佳实践<a class="headerlink" href="#14-常用工具与最佳实践" title="Permanent link">&para;</a></h2>
<p>在软件开发过程中，使用高效的工具和遵循最佳实践能够显著提升开发效率、代码质量和项目的可维护性。Go语言凭借其简洁的工具链和明确的编码规范，鼓励开发者采用一套统一的开发流程。本章将介绍Go语言中常用的命令行工具、代码风格指南、日志处理方法以及性能优化策略，帮助你在实际项目中应用这些工具和实践，构建高质量的Go应用程序。</p>
<h3 id="141-go-常用命令">14.1 Go 常用命令<a class="headerlink" href="#141-go-常用命令" title="Permanent link">&para;</a></h3>
<p>Go语言自带了一套强大的命令行工具，涵盖了代码编译、运行、测试、格式化和依赖管理等多个方面。以下是一些常用的Go命令及其详细介绍。</p>
<h4 id="go-build"><code>go build</code><a class="headerlink" href="#go-build" title="Permanent link">&para;</a></h4>
<p><code>go build</code>命令用于编译Go源码文件，生成可执行文件或库文件。它会自动处理依赖关系，并生成与当前操作系统和架构兼容的二进制文件。</p>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-615-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-615-1" name="__codelineno-615-1"></a>go<span class="w"> </span>build<span class="w"> </span><span class="o">[</span>build<span class="w"> </span>flags<span class="o">]</span><span class="w"> </span><span class="o">[</span>packages<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<ol>
<li><strong>编译当前目录下的包：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-616-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-616-1" name="__codelineno-616-1"></a>go<span class="w"> </span>build
</code></pre></div></td></tr></table></div>
<p>这将在当前目录生成一个与目录同名的可执行文件（例如，如果目录名为<code>app</code>，则生成<code>app</code>或<code>app.exe</code>）。</p>
<ol>
<li><strong>指定输出文件名：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-617-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-617-1" name="__codelineno-617-1"></a>go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>myapp
</code></pre></div></td></tr></table></div>
<p>这将在当前目录生成名为<code>myapp</code>的可执行文件。</p>
<ol>
<li><strong>编译特定包：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-618-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-618-1" name="__codelineno-618-1"></a>go<span class="w"> </span>build<span class="w"> </span>./cmd/myapp
</code></pre></div></td></tr></table></div>
<p>编译位于<code>./cmd/myapp</code>目录下的包。</p>
<p><strong>注意事项：</strong></p>
<ul>
<li><code>go build</code>不会安装可执行文件到<code>$GOPATH/bin</code>，仅在当前目录生成二进制文件。</li>
<li>使用<code>go install</code>可以编译并安装可执行文件到<code>$GOPATH/bin</code>。</li>
</ul>
<h4 id="go-run"><code>go run</code><a class="headerlink" href="#go-run" title="Permanent link">&para;</a></h4>
<p><code>go run</code>命令用于编译并立即运行Go源码文件，适用于快速测试和运行简单的Go程序。</p>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-619-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-619-1" name="__codelineno-619-1"></a>go<span class="w"> </span>run<span class="w"> </span><span class="o">[</span>build<span class="w"> </span>flags<span class="o">]</span><span class="w"> </span><span class="o">[</span>files<span class="o">]</span><span class="w"> </span><span class="o">[</span>arguments...<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<ol>
<li><strong>运行单个文件：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-620-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-620-1" name="__codelineno-620-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p>这将编译并运行<code>main.go</code>文件。</p>
<ol>
<li><strong>运行多个文件：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-621-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-621-1" name="__codelineno-621-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>utils.go
</code></pre></div></td></tr></table></div>
<p>编译并运行包含<code>main.go</code>和<code>utils.go</code>的程序。</p>
<ol>
<li><strong>传递命令行参数：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-622-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-622-1" name="__codelineno-622-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go<span class="w"> </span>arg1<span class="w"> </span>arg2
</code></pre></div></td></tr></table></div>
<p>在程序中可以通过<code>os.Args</code>访问这些参数。</p>
<p><strong>注意事项：</strong></p>
<ul>
<li><code>go run</code>适合用于开发和测试阶段，不建议在生产环境中使用。</li>
<li>对于大型项目或需要持续运行的应用，建议使用<code>go build</code>生成可执行文件。</li>
</ul>
<h4 id="go-test"><code>go test</code><a class="headerlink" href="#go-test" title="Permanent link">&para;</a></h4>
<p><code>go test</code>命令用于运行Go的单元测试、基准测试和示例测试。它自动发现当前包中的测试文件（以<code>_test.go</code>结尾），并执行其中的测试函数。</p>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-623-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-623-1" name="__codelineno-623-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="o">[</span>flags<span class="o">]</span><span class="w"> </span><span class="o">[</span>packages<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<ol>
<li><strong>运行当前目录下的所有测试：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-624-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-624-1" name="__codelineno-624-1"></a>go<span class="w"> </span><span class="nb">test</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>详细输出测试过程：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-625-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-625-1" name="__codelineno-625-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>运行特定测试函数：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-626-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-626-1" name="__codelineno-626-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-run<span class="o">=</span>TestAdd
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>运行基准测试：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-627-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-627-1" name="__codelineno-627-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>.
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>生成覆盖率报告：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-628-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-628-1" name="__codelineno-628-1"></a>go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-cover
</code></pre></div></td></tr></table></div>
<p><strong>注意事项：</strong></p>
<ul>
<li>测试文件必须以<code>_test.go</code>结尾，并位于与被测试代码相同的包中。</li>
<li>测试函数必须以<code>Test</code>开头，并接收<code>*testing.T</code>类型的参数。</li>
</ul>
<h4 id="go-fmt"><code>go fmt</code><a class="headerlink" href="#go-fmt" title="Permanent link">&para;</a></h4>
<p><code>go fmt</code>命令用于格式化Go源码文件，遵循Go语言的官方代码格式规范。它自动调整代码的缩进、空格、换行等，使代码风格统一。</p>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-629-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-629-1" name="__codelineno-629-1"></a>go<span class="w"> </span>fmt<span class="w"> </span><span class="o">[</span>packages<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<ol>
<li><strong>格式化当前目录下的所有Go文件：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-630-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-630-1" name="__codelineno-630-1"></a>go<span class="w"> </span>fmt
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>格式化指定包：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-631-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-631-1" name="__codelineno-631-1"></a>go<span class="w"> </span>fmt<span class="w"> </span>./cmd/myapp
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>格式化所有包：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-632-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-632-1" name="__codelineno-632-1"></a>go<span class="w"> </span>fmt<span class="w"> </span>./...
</code></pre></div></td></tr></table></div>
<p><strong>注意事项：</strong></p>
<ul>
<li><code>go fmt</code>会直接修改源码文件，请确保在运行前备份重要代码。</li>
<li>建议在提交代码前运行<code>go fmt</code>，确保代码风格的一致性。</li>
</ul>
<h4 id="go-mod"><code>go mod</code><a class="headerlink" href="#go-mod" title="Permanent link">&para;</a></h4>
<p><code>go mod</code>命令用于管理Go模块（Module），包括初始化模块、添加依赖、升级依赖等。自Go 1.11版本引入模块机制后，<code>go mod</code>成为管理依赖的主要工具。</p>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-633-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-633-1" name="__codelineno-633-1"></a>go<span class="w"> </span>mod<span class="w"> </span><span class="o">[</span>subcommand<span class="o">]</span><span class="w"> </span><span class="o">[</span>arguments<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p><strong>常用子命令：</strong></p>
<ol>
<li><strong>初始化模块：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-634-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-634-1" name="__codelineno-634-1"></a>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>&lt;module-path&gt;
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-635-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-635-1" name="__codelineno-635-1"></a>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>github.com/username/project
</code></pre></div></td></tr></table></div>
<p>这将在当前目录生成一个<code>go.mod</code>文件，声明模块路径和Go版本。</p>
<ol>
<li><strong>添加或升级依赖：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-636-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-636-1" name="__codelineno-636-1"></a>go<span class="w"> </span>get<span class="w"> </span>&lt;module&gt;@&lt;version&gt;
</code></pre></div></td></tr></table></div>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-637-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-637-1" name="__codelineno-637-1"></a>go<span class="w"> </span>get<span class="w"> </span>github.com/gorilla/mux@v1.8.0
</code></pre></div></td></tr></table></div>
<p>这将添加或升级<code>github.com/gorilla/mux</code>模块到版本<code>v1.8.0</code>。</p>
<ol>
<li><strong>下载所有依赖：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-638-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-638-1" name="__codelineno-638-1"></a>go<span class="w"> </span>mod<span class="w"> </span>tidy
</code></pre></div></td></tr></table></div>
<p>这将添加缺失的模块，移除不需要的模块，确保<code>go.mod</code>和<code>go.sum</code>的准确性。</p>
<ol>
<li><strong>验证模块依赖：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-639-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-639-1" name="__codelineno-639-1"></a>go<span class="w"> </span>mod<span class="w"> </span>verify
</code></pre></div></td></tr></table></div>
<p>验证本地模块缓存中的依赖是否完整和未被篡改。</p>
<ol>
<li><strong>列出模块依赖：</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-640-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-640-1" name="__codelineno-640-1"></a>go<span class="w"> </span>list<span class="w"> </span>-m<span class="w"> </span>all
</code></pre></div></td></tr></table></div>
<p>显示当前模块及其所有依赖模块的信息。</p>
<p><strong>注意事项：</strong></p>
<ul>
<li>使用模块机制可以更好地管理项目依赖，避免<code>GOPATH</code>的限制。</li>
<li>确保<code>go.mod</code>和<code>go.sum</code>文件在版本控制中，以便团队成员共享相同的依赖环境。</li>
<li>定期运行<code>go mod tidy</code>，保持依赖清晰和整洁。</li>
</ul>
<h3 id="142-go-代码风格">14.2 Go 代码风格<a class="headerlink" href="#142-go-代码风格" title="Permanent link">&para;</a></h3>
<p>良好的代码风格不仅提升代码的可读性和可维护性，还能促进团队协作和代码复用。Go语言遵循一套简洁而明确的代码风格规范，鼓励开发者编写清晰、简洁和高效的代码。以下是Go语言代码风格的一些关键要点和最佳实践。</p>
<h4 id="使用-go-fmt-统一代码格式">使用 <code>go fmt</code> 统一代码格式<a class="headerlink" href="#使用-go-fmt-统一代码格式" title="Permanent link">&para;</a></h4>
<p><code>go fmt</code>工具是Go语言官方推荐的代码格式化工具，自动调整代码的缩进、空格、换行等，使代码风格一致。无论个人偏好如何，统一的代码格式有助于团队协作和代码审查。</p>
<p><strong>示例：</strong></p>
<p>未格式化的代码：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-641-1">1</a></span>
<span class="normal"><a href="#__codelineno-641-2">2</a></span>
<span class="normal"><a href="#__codelineno-641-3">3</a></span>
<span class="normal"><a href="#__codelineno-641-4">4</a></span>
<span class="normal"><a href="#__codelineno-641-5">5</a></span>
<span class="normal"><a href="#__codelineno-641-6">6</a></span>
<span class="normal"><a href="#__codelineno-641-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-641-1" name="__codelineno-641-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-641-2" name="__codelineno-641-2"></a>
<a id="__codelineno-641-3" name="__codelineno-641-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-641-4" name="__codelineno-641-4"></a>
<a id="__codelineno-641-5" name="__codelineno-641-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<a id="__codelineno-641-6" name="__codelineno-641-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-641-7" name="__codelineno-641-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>使用<code>go fmt</code>格式化后的代码：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-642-1">1</a></span>
<span class="normal"><a href="#__codelineno-642-2">2</a></span>
<span class="normal"><a href="#__codelineno-642-3">3</a></span>
<span class="normal"><a href="#__codelineno-642-4">4</a></span>
<span class="normal"><a href="#__codelineno-642-5">5</a></span>
<span class="normal"><a href="#__codelineno-642-6">6</a></span>
<span class="normal"><a href="#__codelineno-642-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-642-1" name="__codelineno-642-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-642-2" name="__codelineno-642-2"></a>
<a id="__codelineno-642-3" name="__codelineno-642-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-642-4" name="__codelineno-642-4"></a>
<a id="__codelineno-642-5" name="__codelineno-642-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-642-6" name="__codelineno-642-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
<a id="__codelineno-642-7" name="__codelineno-642-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>最佳实践：</strong></p>
<ul>
<li>在编辑器中配置自动运行<code>go fmt</code>，确保每次保存文件时自动格式化代码。</li>
<li>在代码审查过程中，忽略与代码格式相关的更改，专注于代码逻辑和功能。</li>
</ul>
<h4 id="命名约定">命名约定<a class="headerlink" href="#命名约定" title="Permanent link">&para;</a></h4>
<p>Go语言的命名约定简洁明了，使用驼峰命名法（CamelCase）和简短有意义的名称。正确的命名有助于代码的可读性和理解。</p>
<p><strong>关键点：</strong></p>
<ul>
<li><strong>包名</strong>：使用小写字母，避免使用下划线和混合大小写。例如，<code>net/http</code>。</li>
<li><strong>函数和变量名</strong>：使用驼峰命名法，首字母小写表示包内私有，首字母大写表示包外可见。例如，<code>calculateSum</code>（私有）、<code>CalculateSum</code>（公开）。</li>
<li><strong>常量名</strong>：使用全大写字母和下划线分隔。例如，<code>MAX_BUFFER_SIZE</code>。</li>
<li><strong>结构体和接口名</strong>：使用名词或名词短语，首字母大写表示公开。例如，<code>User</code>, <code>DatabaseConnector</code>。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-643-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-643-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-643-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-643-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-643-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-643-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-643-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-643-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-643-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-643-10">10</a></span>
<span class="normal"><a href="#__codelineno-643-11">11</a></span>
<span class="normal"><a href="#__codelineno-643-12">12</a></span>
<span class="normal"><a href="#__codelineno-643-13">13</a></span>
<span class="normal"><a href="#__codelineno-643-14">14</a></span>
<span class="normal"><a href="#__codelineno-643-15">15</a></span>
<span class="normal"><a href="#__codelineno-643-16">16</a></span>
<span class="normal"><a href="#__codelineno-643-17">17</a></span>
<span class="normal"><a href="#__codelineno-643-18">18</a></span>
<span class="normal"><a href="#__codelineno-643-19">19</a></span>
<span class="normal"><a href="#__codelineno-643-20">20</a></span>
<span class="normal"><a href="#__codelineno-643-21">21</a></span>
<span class="normal"><a href="#__codelineno-643-22">22</a></span>
<span class="normal"><a href="#__codelineno-643-23">23</a></span>
<span class="normal"><a href="#__codelineno-643-24">24</a></span>
<span class="normal"><a href="#__codelineno-643-25">25</a></span>
<span class="normal"><a href="#__codelineno-643-26">26</a></span>
<span class="normal"><a href="#__codelineno-643-27">27</a></span>
<span class="normal"><a href="#__codelineno-643-28">28</a></span>
<span class="normal"><a href="#__codelineno-643-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-643-1" name="__codelineno-643-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-643-2" name="__codelineno-643-2"></a>
<a id="__codelineno-643-3" name="__codelineno-643-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-643-4" name="__codelineno-643-4"></a>
<a id="__codelineno-643-5" name="__codelineno-643-5"></a><span class="c1">// User 定义了用户结构体</span>
<a id="__codelineno-643-6" name="__codelineno-643-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-643-7" name="__codelineno-643-7"></a><span class="w">    </span><span class="nx">ID</span><span class="w">   </span><span class="kt">int</span>
<a id="__codelineno-643-8" name="__codelineno-643-8"></a><span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-643-9" name="__codelineno-643-9"></a><span class="p">}</span>
<a id="__codelineno-643-10" name="__codelineno-643-10"></a>
<a id="__codelineno-643-11" name="__codelineno-643-11"></a><span class="c1">// calculateAge 计算年龄（私有函数）</span>
<a id="__codelineno-643-12" name="__codelineno-643-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">calculateAge</span><span class="p">(</span><span class="nx">birthYear</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-643-13" name="__codelineno-643-13"></a><span class="w">    </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2024</span>
<a id="__codelineno-643-14" name="__codelineno-643-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">currentYear</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">birthYear</span>
<a id="__codelineno-643-15" name="__codelineno-643-15"></a><span class="p">}</span>
<a id="__codelineno-643-16" name="__codelineno-643-16"></a>
<a id="__codelineno-643-17" name="__codelineno-643-17"></a><span class="c1">// CalculateGreeting 返回欢迎消息（公开函数）</span>
<a id="__codelineno-643-18" name="__codelineno-643-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">CalculateGreeting</span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-643-19" name="__codelineno-643-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Hello, %s!&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-643-20" name="__codelineno-643-20"></a><span class="p">}</span>
<a id="__codelineno-643-21" name="__codelineno-643-21"></a>
<a id="__codelineno-643-22" name="__codelineno-643-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-643-23" name="__codelineno-643-23"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">}</span>
<a id="__codelineno-643-24" name="__codelineno-643-24"></a><span class="w">    </span><span class="nx">age</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">calculateAge</span><span class="p">(</span><span class="mi">1990</span><span class="p">)</span>
<a id="__codelineno-643-25" name="__codelineno-643-25"></a><span class="w">    </span><span class="nx">greeting</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">CalculateGreeting</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-643-26" name="__codelineno-643-26"></a>
<a id="__codelineno-643-27" name="__codelineno-643-27"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">greeting</span><span class="p">)</span>
<a id="__codelineno-643-28" name="__codelineno-643-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Age: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">age</span><span class="p">)</span>
<a id="__codelineno-643-29" name="__codelineno-643-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="避免过长的函数和方法">避免过长的函数和方法<a class="headerlink" href="#避免过长的函数和方法" title="Permanent link">&para;</a></h4>
<p>长函数和方法难以理解和维护。应将复杂的逻辑拆分为多个小函数，每个函数完成一个单一的任务。</p>
<p><strong>示例：</strong></p>
<p>长函数示例：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-644-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-644-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-644-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-644-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-644-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-644-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-644-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-644-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-644-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-644-10">10</a></span>
<span class="normal"><a href="#__codelineno-644-11">11</a></span>
<span class="normal"><a href="#__codelineno-644-12">12</a></span>
<span class="normal"><a href="#__codelineno-644-13">13</a></span>
<span class="normal"><a href="#__codelineno-644-14">14</a></span>
<span class="normal"><a href="#__codelineno-644-15">15</a></span>
<span class="normal"><a href="#__codelineno-644-16">16</a></span>
<span class="normal"><a href="#__codelineno-644-17">17</a></span>
<span class="normal"><a href="#__codelineno-644-18">18</a></span>
<span class="normal"><a href="#__codelineno-644-19">19</a></span>
<span class="normal"><a href="#__codelineno-644-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-644-1" name="__codelineno-644-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">ProcessData</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-644-2" name="__codelineno-644-2"></a><span class="w">    </span><span class="c1">// 计算总和</span>
<a id="__codelineno-644-3" name="__codelineno-644-3"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-644-4" name="__codelineno-644-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-644-5" name="__codelineno-644-5"></a><span class="w">        </span><span class="nx">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">num</span>
<a id="__codelineno-644-6" name="__codelineno-644-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-644-7" name="__codelineno-644-7"></a>
<a id="__codelineno-644-8" name="__codelineno-644-8"></a><span class="w">    </span><span class="c1">// 计算平均值</span>
<a id="__codelineno-644-9" name="__codelineno-644-9"></a><span class="w">    </span><span class="nx">average</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">sum</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-644-10" name="__codelineno-644-10"></a>
<a id="__codelineno-644-11" name="__codelineno-644-11"></a><span class="w">    </span><span class="c1">// 筛选大于平均值的数</span>
<a id="__codelineno-644-12" name="__codelineno-644-12"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<a id="__codelineno-644-13" name="__codelineno-644-13"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-644-14" name="__codelineno-644-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-644-15" name="__codelineno-644-15"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-644-16" name="__codelineno-644-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-644-17" name="__codelineno-644-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-644-18" name="__codelineno-644-18"></a>
<a id="__codelineno-644-19" name="__codelineno-644-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<a id="__codelineno-644-20" name="__codelineno-644-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>优化后的拆分函数：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-645-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-645-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-645-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-645-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-645-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-645-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-645-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-645-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-645-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-645-10">10</a></span>
<span class="normal"><a href="#__codelineno-645-11">11</a></span>
<span class="normal"><a href="#__codelineno-645-12">12</a></span>
<span class="normal"><a href="#__codelineno-645-13">13</a></span>
<span class="normal"><a href="#__codelineno-645-14">14</a></span>
<span class="normal"><a href="#__codelineno-645-15">15</a></span>
<span class="normal"><a href="#__codelineno-645-16">16</a></span>
<span class="normal"><a href="#__codelineno-645-17">17</a></span>
<span class="normal"><a href="#__codelineno-645-18">18</a></span>
<span class="normal"><a href="#__codelineno-645-19">19</a></span>
<span class="normal"><a href="#__codelineno-645-20">20</a></span>
<span class="normal"><a href="#__codelineno-645-21">21</a></span>
<span class="normal"><a href="#__codelineno-645-22">22</a></span>
<span class="normal"><a href="#__codelineno-645-23">23</a></span>
<span class="normal"><a href="#__codelineno-645-24">24</a></span>
<span class="normal"><a href="#__codelineno-645-25">25</a></span>
<span class="normal"><a href="#__codelineno-645-26">26</a></span>
<span class="normal"><a href="#__codelineno-645-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-645-1" name="__codelineno-645-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">calculateSum</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-645-2" name="__codelineno-645-2"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-645-3" name="__codelineno-645-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-645-4" name="__codelineno-645-4"></a><span class="w">        </span><span class="nx">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">num</span>
<a id="__codelineno-645-5" name="__codelineno-645-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-645-6" name="__codelineno-645-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sum</span>
<a id="__codelineno-645-7" name="__codelineno-645-7"></a><span class="p">}</span>
<a id="__codelineno-645-8" name="__codelineno-645-8"></a>
<a id="__codelineno-645-9" name="__codelineno-645-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">calculateAverage</span><span class="p">(</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-645-10" name="__codelineno-645-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">sum</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-645-11" name="__codelineno-645-11"></a><span class="p">}</span>
<a id="__codelineno-645-12" name="__codelineno-645-12"></a>
<a id="__codelineno-645-13" name="__codelineno-645-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">filterAboveAverage</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="kt">float64</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-645-14" name="__codelineno-645-14"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<a id="__codelineno-645-15" name="__codelineno-645-15"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-645-16" name="__codelineno-645-16"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-645-17" name="__codelineno-645-17"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-645-18" name="__codelineno-645-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-645-19" name="__codelineno-645-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-645-20" name="__codelineno-645-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<a id="__codelineno-645-21" name="__codelineno-645-21"></a><span class="p">}</span>
<a id="__codelineno-645-22" name="__codelineno-645-22"></a>
<a id="__codelineno-645-23" name="__codelineno-645-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">ProcessData</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-645-24" name="__codelineno-645-24"></a><span class="w">    </span><span class="nx">sum</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">calculateSum</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-645-25" name="__codelineno-645-25"></a><span class="w">    </span><span class="nx">average</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">calculateAverage</span><span class="p">(</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-645-26" name="__codelineno-645-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">filterAboveAverage</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">average</span><span class="p">)</span>
<a id="__codelineno-645-27" name="__codelineno-645-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>优势：</strong></p>
<ul>
<li>提高代码的可读性和可维护性。</li>
<li>便于测试和复用。</li>
<li>减少函数的复杂性和耦合度。</li>
</ul>
<h4 id="错误处理">错误处理<a class="headerlink" href="#错误处理" title="Permanent link">&para;</a></h4>
<p>Go语言鼓励通过显式返回错误值进行错误处理，避免使用异常机制。这种方式使错误处理流程清晰明确，但也需要开发者养成良好的习惯，确保每个可能出错的操作都被适当处理。</p>
<p><strong>最佳实践：</strong></p>
<ul>
<li><strong>检查每个错误</strong>：每次调用可能返回错误的函数，都应检查并处理错误。</li>
<li><strong>提供有意义的错误信息</strong>：使用<code>fmt.Errorf</code>或自定义错误类型，提供详细的错误上下文。</li>
<li><strong>避免忽略错误</strong>：除非确实不关心错误，否则不应忽略错误值。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-646-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-646-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-646-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-646-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-646-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-646-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-646-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-646-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-646-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-646-10">10</a></span>
<span class="normal"><a href="#__codelineno-646-11">11</a></span>
<span class="normal"><a href="#__codelineno-646-12">12</a></span>
<span class="normal"><a href="#__codelineno-646-13">13</a></span>
<span class="normal"><a href="#__codelineno-646-14">14</a></span>
<span class="normal"><a href="#__codelineno-646-15">15</a></span>
<span class="normal"><a href="#__codelineno-646-16">16</a></span>
<span class="normal"><a href="#__codelineno-646-17">17</a></span>
<span class="normal"><a href="#__codelineno-646-18">18</a></span>
<span class="normal"><a href="#__codelineno-646-19">19</a></span>
<span class="normal"><a href="#__codelineno-646-20">20</a></span>
<span class="normal"><a href="#__codelineno-646-21">21</a></span>
<span class="normal"><a href="#__codelineno-646-22">22</a></span>
<span class="normal"><a href="#__codelineno-646-23">23</a></span>
<span class="normal"><a href="#__codelineno-646-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-646-1" name="__codelineno-646-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-646-2" name="__codelineno-646-2"></a>
<a id="__codelineno-646-3" name="__codelineno-646-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-646-4" name="__codelineno-646-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-646-5" name="__codelineno-646-5"></a><span class="w">    </span><span class="s">&quot;io/ioutil&quot;</span>
<a id="__codelineno-646-6" name="__codelineno-646-6"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-646-7" name="__codelineno-646-7"></a><span class="p">)</span>
<a id="__codelineno-646-8" name="__codelineno-646-8"></a>
<a id="__codelineno-646-9" name="__codelineno-646-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-646-10" name="__codelineno-646-10"></a><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<a id="__codelineno-646-11" name="__codelineno-646-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-646-12" name="__codelineno-646-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;读取文件 %s 失败: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">filename</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-646-13" name="__codelineno-646-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-646-14" name="__codelineno-646-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-646-15" name="__codelineno-646-15"></a><span class="p">}</span>
<a id="__codelineno-646-16" name="__codelineno-646-16"></a>
<a id="__codelineno-646-17" name="__codelineno-646-17"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-646-18" name="__codelineno-646-18"></a><span class="w">    </span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-646-19" name="__codelineno-646-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-646-20" name="__codelineno-646-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;错误:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-646-21" name="__codelineno-646-21"></a><span class="w">        </span><span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-646-22" name="__codelineno-646-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-646-23" name="__codelineno-646-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件内容:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="p">)</span>
<a id="__codelineno-646-24" name="__codelineno-646-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="使用接口简化代码">使用接口简化代码<a class="headerlink" href="#使用接口简化代码" title="Permanent link">&para;</a></h4>
<p>Go语言的接口机制允许开发者编写灵活、可扩展的代码，通过接口定义行为，减少代码耦合度。</p>
<p><strong>示例：</strong></p>
<p>定义一个<code>Notifier</code>接口，支持不同类型的通知方式：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-647-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-647-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-647-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-647-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-647-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-647-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-647-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-647-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-647-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-647-10">10</a></span>
<span class="normal"><a href="#__codelineno-647-11">11</a></span>
<span class="normal"><a href="#__codelineno-647-12">12</a></span>
<span class="normal"><a href="#__codelineno-647-13">13</a></span>
<span class="normal"><a href="#__codelineno-647-14">14</a></span>
<span class="normal"><a href="#__codelineno-647-15">15</a></span>
<span class="normal"><a href="#__codelineno-647-16">16</a></span>
<span class="normal"><a href="#__codelineno-647-17">17</a></span>
<span class="normal"><a href="#__codelineno-647-18">18</a></span>
<span class="normal"><a href="#__codelineno-647-19">19</a></span>
<span class="normal"><a href="#__codelineno-647-20">20</a></span>
<span class="normal"><a href="#__codelineno-647-21">21</a></span>
<span class="normal"><a href="#__codelineno-647-22">22</a></span>
<span class="normal"><a href="#__codelineno-647-23">23</a></span>
<span class="normal"><a href="#__codelineno-647-24">24</a></span>
<span class="normal"><a href="#__codelineno-647-25">25</a></span>
<span class="normal"><a href="#__codelineno-647-26">26</a></span>
<span class="normal"><a href="#__codelineno-647-27">27</a></span>
<span class="normal"><a href="#__codelineno-647-28">28</a></span>
<span class="normal"><a href="#__codelineno-647-29">29</a></span>
<span class="normal"><a href="#__codelineno-647-30">30</a></span>
<span class="normal"><a href="#__codelineno-647-31">31</a></span>
<span class="normal"><a href="#__codelineno-647-32">32</a></span>
<span class="normal"><a href="#__codelineno-647-33">33</a></span>
<span class="normal"><a href="#__codelineno-647-34">34</a></span>
<span class="normal"><a href="#__codelineno-647-35">35</a></span>
<span class="normal"><a href="#__codelineno-647-36">36</a></span>
<span class="normal"><a href="#__codelineno-647-37">37</a></span>
<span class="normal"><a href="#__codelineno-647-38">38</a></span>
<span class="normal"><a href="#__codelineno-647-39">39</a></span>
<span class="normal"><a href="#__codelineno-647-40">40</a></span>
<span class="normal"><a href="#__codelineno-647-41">41</a></span>
<span class="normal"><a href="#__codelineno-647-42">42</a></span>
<span class="normal"><a href="#__codelineno-647-43">43</a></span>
<span class="normal"><a href="#__codelineno-647-44">44</a></span>
<span class="normal"><a href="#__codelineno-647-45">45</a></span>
<span class="normal"><a href="#__codelineno-647-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-647-1" name="__codelineno-647-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-647-2" name="__codelineno-647-2"></a>
<a id="__codelineno-647-3" name="__codelineno-647-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-647-4" name="__codelineno-647-4"></a>
<a id="__codelineno-647-5" name="__codelineno-647-5"></a><span class="c1">// Notifier 定义了通知接口</span>
<a id="__codelineno-647-6" name="__codelineno-647-6"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Notifier</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-7" name="__codelineno-647-7"></a><span class="w">    </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-647-8" name="__codelineno-647-8"></a><span class="p">}</span>
<a id="__codelineno-647-9" name="__codelineno-647-9"></a>
<a id="__codelineno-647-10" name="__codelineno-647-10"></a><span class="c1">// EmailNotifier 实现了Notifier接口，发送邮件通知</span>
<a id="__codelineno-647-11" name="__codelineno-647-11"></a><span class="kd">type</span><span class="w"> </span><span class="nx">EmailNotifier</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-12" name="__codelineno-647-12"></a><span class="w">    </span><span class="nx">EmailAddress</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-647-13" name="__codelineno-647-13"></a><span class="p">}</span>
<a id="__codelineno-647-14" name="__codelineno-647-14"></a>
<a id="__codelineno-647-15" name="__codelineno-647-15"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">*</span><span class="nx">EmailNotifier</span><span class="p">)</span><span class="w"> </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-16" name="__codelineno-647-16"></a><span class="w">    </span><span class="c1">// 模拟发送邮件</span>
<a id="__codelineno-647-17" name="__codelineno-647-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;发送邮件到 %s: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">EmailAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-647-18" name="__codelineno-647-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-647-19" name="__codelineno-647-19"></a><span class="p">}</span>
<a id="__codelineno-647-20" name="__codelineno-647-20"></a>
<a id="__codelineno-647-21" name="__codelineno-647-21"></a><span class="c1">// SMSNotifier 实现了Notifier接口，发送短信通知</span>
<a id="__codelineno-647-22" name="__codelineno-647-22"></a><span class="kd">type</span><span class="w"> </span><span class="nx">SMSNotifier</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-23" name="__codelineno-647-23"></a><span class="w">    </span><span class="nx">PhoneNumber</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-647-24" name="__codelineno-647-24"></a><span class="p">}</span>
<a id="__codelineno-647-25" name="__codelineno-647-25"></a>
<a id="__codelineno-647-26" name="__codelineno-647-26"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">SMSNotifier</span><span class="p">)</span><span class="w"> </span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-27" name="__codelineno-647-27"></a><span class="w">    </span><span class="c1">// 模拟发送短信</span>
<a id="__codelineno-647-28" name="__codelineno-647-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;发送短信到 %s: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">PhoneNumber</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-647-29" name="__codelineno-647-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-647-30" name="__codelineno-647-30"></a><span class="p">}</span>
<a id="__codelineno-647-31" name="__codelineno-647-31"></a>
<a id="__codelineno-647-32" name="__codelineno-647-32"></a><span class="c1">// SendNotification 发送通知，使用Notifier接口</span>
<a id="__codelineno-647-33" name="__codelineno-647-33"></a><span class="kd">func</span><span class="w"> </span><span class="nx">SendNotification</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="nx">Notifier</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-34" name="__codelineno-647-34"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">Notify</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-647-35" name="__codelineno-647-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-36" name="__codelineno-647-36"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;发送通知失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-647-37" name="__codelineno-647-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-647-38" name="__codelineno-647-38"></a><span class="p">}</span>
<a id="__codelineno-647-39" name="__codelineno-647-39"></a>
<a id="__codelineno-647-40" name="__codelineno-647-40"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-647-41" name="__codelineno-647-41"></a><span class="w">    </span><span class="nx">email</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">EmailNotifier</span><span class="p">{</span><span class="nx">EmailAddress</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">}</span>
<a id="__codelineno-647-42" name="__codelineno-647-42"></a><span class="w">    </span><span class="nx">sms</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SMSNotifier</span><span class="p">{</span><span class="nx">PhoneNumber</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;+1234567890&quot;</span><span class="p">}</span>
<a id="__codelineno-647-43" name="__codelineno-647-43"></a>
<a id="__codelineno-647-44" name="__codelineno-647-44"></a><span class="w">    </span><span class="nx">SendNotification</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello via Email!&quot;</span><span class="p">)</span>
<a id="__codelineno-647-45" name="__codelineno-647-45"></a><span class="w">    </span><span class="nx">SendNotification</span><span class="p">(</span><span class="nx">sms</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello via SMS!&quot;</span><span class="p">)</span>
<a id="__codelineno-647-46" name="__codelineno-647-46"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-648-1">1</a></span>
<span class="normal"><a href="#__codelineno-648-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-648-1" name="__codelineno-648-1"></a>发送邮件到 user@example.com: Hello via Email!
<a id="__codelineno-648-2" name="__codelineno-648-2"></a>发送短信到 +1234567890: Hello via SMS!
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><code>Notifier</code>接口定义了<code>Notify</code>方法，任何实现该方法的类型都可以作为通知方式。</li>
<li><code>EmailNotifier</code>和<code>SMSNotifier</code>分别实现了<code>Notifier</code>接口，提供不同的通知方式。</li>
<li><code>SendNotification</code>函数接受一个<code>Notifier</code>接口，实现了对不同通知方式的统一处理。</li>
</ul>
<p><strong>优势：</strong></p>
<ul>
<li><strong>灵活性</strong>：可以轻松添加新的通知方式，无需修改现有代码。</li>
<li><strong>可测试性</strong>：通过接口，可以使用模拟对象进行单元测试，隔离依赖。</li>
<li><strong>解耦合</strong>：减少模块之间的直接依赖，提高代码的可维护性和扩展性。</li>
</ul>
<h3 id="143-日志处理">14.3 日志处理<a class="headerlink" href="#143-日志处理" title="Permanent link">&para;</a></h3>
<p>日志记录是软件开发中用于监控、调试和分析应用程序行为的重要手段。Go语言提供了内置的<code>log</code>包，同时也支持多种第三方日志库，以满足不同的日志需求。</p>
<h4 id="使用-log-包">使用 <code>log</code> 包<a class="headerlink" href="#使用-log-包" title="Permanent link">&para;</a></h4>
<p>Go语言内置的<code>log</code>包提供了基本的日志记录功能，支持输出日志到标准输出、文件或其他自定义的输出目标。</p>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-649-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-649-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-649-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-649-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-649-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-649-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-649-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-649-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-649-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-649-10">10</a></span>
<span class="normal"><a href="#__codelineno-649-11">11</a></span>
<span class="normal"><a href="#__codelineno-649-12">12</a></span>
<span class="normal"><a href="#__codelineno-649-13">13</a></span>
<span class="normal"><a href="#__codelineno-649-14">14</a></span>
<span class="normal"><a href="#__codelineno-649-15">15</a></span>
<span class="normal"><a href="#__codelineno-649-16">16</a></span>
<span class="normal"><a href="#__codelineno-649-17">17</a></span>
<span class="normal"><a href="#__codelineno-649-18">18</a></span>
<span class="normal"><a href="#__codelineno-649-19">19</a></span>
<span class="normal"><a href="#__codelineno-649-20">20</a></span>
<span class="normal"><a href="#__codelineno-649-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-649-1" name="__codelineno-649-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-649-2" name="__codelineno-649-2"></a>
<a id="__codelineno-649-3" name="__codelineno-649-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-649-4" name="__codelineno-649-4"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-649-5" name="__codelineno-649-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-649-6" name="__codelineno-649-6"></a><span class="p">)</span>
<a id="__codelineno-649-7" name="__codelineno-649-7"></a>
<a id="__codelineno-649-8" name="__codelineno-649-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-649-9" name="__codelineno-649-9"></a><span class="w">    </span><span class="c1">// 设置日志输出到文件</span>
<a id="__codelineno-649-10" name="__codelineno-649-10"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">&quot;app.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">)</span>
<a id="__codelineno-649-11" name="__codelineno-649-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-649-12" name="__codelineno-649-12"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;打开日志文件失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-649-13" name="__codelineno-649-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-649-14" name="__codelineno-649-14"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-649-15" name="__codelineno-649-15"></a>
<a id="__codelineno-649-16" name="__codelineno-649-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">SetOutput</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-649-17" name="__codelineno-649-17"></a>
<a id="__codelineno-649-18" name="__codelineno-649-18"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;应用程序启动&quot;</span><span class="p">)</span>
<a id="__codelineno-649-19" name="__codelineno-649-19"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;处理请求: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GET /api/users&quot;</span><span class="p">)</span>
<a id="__codelineno-649-20" name="__codelineno-649-20"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;应用程序结束&quot;</span><span class="p">)</span>
<a id="__codelineno-649-21" name="__codelineno-649-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>os.OpenFile</code>打开或创建日志文件<code>app.log</code>。</li>
<li>使用<code>log.SetOutput</code>将日志输出目标设置为文件。</li>
<li>使用<code>log.Println</code>和<code>log.Printf</code>记录日志信息。</li>
<li><code>log.Fatalf</code>记录错误信息并终止程序。</li>
</ul>
<p><strong>日志输出示例 (<code>app.log</code>):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-650-1">1</a></span>
<span class="normal"><a href="#__codelineno-650-2">2</a></span>
<span class="normal"><a href="#__codelineno-650-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-650-1" name="__codelineno-650-1"></a>2024/04/27 12:00:00 应用程序启动
<a id="__codelineno-650-2" name="__codelineno-650-2"></a>2024/04/27 12:00:01 处理请求: GET /api/users
<a id="__codelineno-650-3" name="__codelineno-650-3"></a>2024/04/27 12:00:02 应用程序结束
</code></pre></div></td></tr></table></div>
<p><strong>高级功能：</strong></p>
<ul>
<li><strong>日志前缀和标志</strong>：使用<code>log.SetPrefix</code>和<code>log.SetFlags</code>设置日志的前缀和格式。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-651-1">1</a></span>
<span class="normal"><a href="#__codelineno-651-2">2</a></span>
<span class="normal"><a href="#__codelineno-651-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-651-1" name="__codelineno-651-1"></a><span class="nx">log</span><span class="p">.</span><span class="nx">SetPrefix</span><span class="p">(</span><span class="s">&quot;INFO: &quot;</span><span class="p">)</span>
<a id="__codelineno-651-2" name="__codelineno-651-2"></a><span class="nx">log</span><span class="p">.</span><span class="nx">SetFlags</span><span class="p">(</span><span class="nx">log</span><span class="p">.</span><span class="nx">Ldate</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Ltime</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Lshortfile</span><span class="p">)</span>
<a id="__codelineno-651-3" name="__codelineno-651-3"></a><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;这是带前缀和标志的日志&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-652-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-652-1" name="__codelineno-652-1"></a>INFO: 2024/04/27 12:00:03 main.go:15: 这是带前缀和标志的日志
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>多日志级别</strong>：Go内置的<code>log</code>包不支持不同的日志级别（如INFO、WARN、ERROR），但可以通过自定义封装实现。</li>
</ul>
<p><strong>示例：自定义日志级别封装</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-653-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-653-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-653-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-653-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-653-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-653-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-653-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-653-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-653-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-653-10">10</a></span>
<span class="normal"><a href="#__codelineno-653-11">11</a></span>
<span class="normal"><a href="#__codelineno-653-12">12</a></span>
<span class="normal"><a href="#__codelineno-653-13">13</a></span>
<span class="normal"><a href="#__codelineno-653-14">14</a></span>
<span class="normal"><a href="#__codelineno-653-15">15</a></span>
<span class="normal"><a href="#__codelineno-653-16">16</a></span>
<span class="normal"><a href="#__codelineno-653-17">17</a></span>
<span class="normal"><a href="#__codelineno-653-18">18</a></span>
<span class="normal"><a href="#__codelineno-653-19">19</a></span>
<span class="normal"><a href="#__codelineno-653-20">20</a></span>
<span class="normal"><a href="#__codelineno-653-21">21</a></span>
<span class="normal"><a href="#__codelineno-653-22">22</a></span>
<span class="normal"><a href="#__codelineno-653-23">23</a></span>
<span class="normal"><a href="#__codelineno-653-24">24</a></span>
<span class="normal"><a href="#__codelineno-653-25">25</a></span>
<span class="normal"><a href="#__codelineno-653-26">26</a></span>
<span class="normal"><a href="#__codelineno-653-27">27</a></span>
<span class="normal"><a href="#__codelineno-653-28">28</a></span>
<span class="normal"><a href="#__codelineno-653-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-653-1" name="__codelineno-653-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-653-2" name="__codelineno-653-2"></a>
<a id="__codelineno-653-3" name="__codelineno-653-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-653-4" name="__codelineno-653-4"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-653-5" name="__codelineno-653-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-653-6" name="__codelineno-653-6"></a><span class="p">)</span>
<a id="__codelineno-653-7" name="__codelineno-653-7"></a>
<a id="__codelineno-653-8" name="__codelineno-653-8"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-653-9" name="__codelineno-653-9"></a><span class="w">    </span><span class="nx">InfoLogger</span><span class="w">  </span><span class="o">*</span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span>
<a id="__codelineno-653-10" name="__codelineno-653-10"></a><span class="w">    </span><span class="nx">WarnLogger</span><span class="w">  </span><span class="o">*</span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span>
<a id="__codelineno-653-11" name="__codelineno-653-11"></a><span class="w">    </span><span class="nx">ErrorLogger</span><span class="w"> </span><span class="o">*</span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span>
<a id="__codelineno-653-12" name="__codelineno-653-12"></a><span class="p">)</span>
<a id="__codelineno-653-13" name="__codelineno-653-13"></a>
<a id="__codelineno-653-14" name="__codelineno-653-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-653-15" name="__codelineno-653-15"></a><span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">&quot;app.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="o">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="p">,</span><span class="w"> </span><span class="mo">0666</span><span class="p">)</span>
<a id="__codelineno-653-16" name="__codelineno-653-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-653-17" name="__codelineno-653-17"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;打开日志文件失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-653-18" name="__codelineno-653-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-653-19" name="__codelineno-653-19"></a>
<a id="__codelineno-653-20" name="__codelineno-653-20"></a><span class="w">    </span><span class="nx">InfoLogger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;INFO: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Ldate</span><span class="o">|</span><span class="nx">log</span><span class="p">.</span><span class="nx">Ltime</span><span class="o">|</span><span class="nx">log</span><span class="p">.</span><span class="nx">Lshortfile</span><span class="p">)</span>
<a id="__codelineno-653-21" name="__codelineno-653-21"></a><span class="w">    </span><span class="nx">WarnLogger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WARN: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Ldate</span><span class="o">|</span><span class="nx">log</span><span class="p">.</span><span class="nx">Ltime</span><span class="o">|</span><span class="nx">log</span><span class="p">.</span><span class="nx">Lshortfile</span><span class="p">)</span>
<a id="__codelineno-653-22" name="__codelineno-653-22"></a><span class="w">    </span><span class="nx">ErrorLogger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ERROR: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Ldate</span><span class="o">|</span><span class="nx">log</span><span class="p">.</span><span class="nx">Ltime</span><span class="o">|</span><span class="nx">log</span><span class="p">.</span><span class="nx">Lshortfile</span><span class="p">)</span>
<a id="__codelineno-653-23" name="__codelineno-653-23"></a><span class="p">}</span>
<a id="__codelineno-653-24" name="__codelineno-653-24"></a>
<a id="__codelineno-653-25" name="__codelineno-653-25"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-653-26" name="__codelineno-653-26"></a><span class="w">    </span><span class="nx">InfoLogger</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;应用程序启动&quot;</span><span class="p">)</span>
<a id="__codelineno-653-27" name="__codelineno-653-27"></a><span class="w">    </span><span class="nx">WarnLogger</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;这是一个警告&quot;</span><span class="p">)</span>
<a id="__codelineno-653-28" name="__codelineno-653-28"></a><span class="w">    </span><span class="nx">ErrorLogger</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;这是一个错误&quot;</span><span class="p">)</span>
<a id="__codelineno-653-29" name="__codelineno-653-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例 (<code>app.log</code>):</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-654-1">1</a></span>
<span class="normal"><a href="#__codelineno-654-2">2</a></span>
<span class="normal"><a href="#__codelineno-654-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-654-1" name="__codelineno-654-1"></a>INFO: 2024/04/27 12:00:04 main.go:25: 应用程序启动
<a id="__codelineno-654-2" name="__codelineno-654-2"></a>WARN: 2024/04/27 12:00:05 main.go:26: 这是一个警告
<a id="__codelineno-654-3" name="__codelineno-654-3"></a>ERROR: 2024/04/27 12:00:06 main.go:27: 这是一个错误
</code></pre></div></td></tr></table></div>
<h4 id="第三方日志库">第三方日志库<a class="headerlink" href="#第三方日志库" title="Permanent link">&para;</a></h4>
<p>虽然Go的内置<code>log</code>包功能强大，但在一些复杂的应用场景中，可能需要更多高级特性，如日志级别、结构化日志、日志轮转等。Go生态系统中有许多优秀的第三方日志库，常见的包括<code>logrus</code>、<code>zap</code>和<code>zerolog</code>等。</p>
<h5 id="logrus"><code>logrus</code><a class="headerlink" href="#logrus" title="Permanent link">&para;</a></h5>
<p><code>logrus</code>是一个结构化的、可扩展的日志库，支持多种日志级别和钩子（Hooks），便于集成到不同的日志系统中。</p>
<p><strong>安装：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-655-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-655-1" name="__codelineno-655-1"></a>go<span class="w"> </span>get<span class="w"> </span>github.com/sirupsen/logrus
</code></pre></div></td></tr></table></div>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-656-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-656-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-656-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-656-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-656-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-656-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-656-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-656-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-656-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-656-10">10</a></span>
<span class="normal"><a href="#__codelineno-656-11">11</a></span>
<span class="normal"><a href="#__codelineno-656-12">12</a></span>
<span class="normal"><a href="#__codelineno-656-13">13</a></span>
<span class="normal"><a href="#__codelineno-656-14">14</a></span>
<span class="normal"><a href="#__codelineno-656-15">15</a></span>
<span class="normal"><a href="#__codelineno-656-16">16</a></span>
<span class="normal"><a href="#__codelineno-656-17">17</a></span>
<span class="normal"><a href="#__codelineno-656-18">18</a></span>
<span class="normal"><a href="#__codelineno-656-19">19</a></span>
<span class="normal"><a href="#__codelineno-656-20">20</a></span>
<span class="normal"><a href="#__codelineno-656-21">21</a></span>
<span class="normal"><a href="#__codelineno-656-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-656-1" name="__codelineno-656-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-656-2" name="__codelineno-656-2"></a>
<a id="__codelineno-656-3" name="__codelineno-656-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-656-4" name="__codelineno-656-4"></a><span class="w">    </span><span class="nx">log</span><span class="w"> </span><span class="s">&quot;github.com/sirupsen/logrus&quot;</span>
<a id="__codelineno-656-5" name="__codelineno-656-5"></a><span class="p">)</span>
<a id="__codelineno-656-6" name="__codelineno-656-6"></a>
<a id="__codelineno-656-7" name="__codelineno-656-7"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-656-8" name="__codelineno-656-8"></a><span class="w">    </span><span class="c1">// 设置日志格式为JSON</span>
<a id="__codelineno-656-9" name="__codelineno-656-9"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">SetFormatter</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">log</span><span class="p">.</span><span class="nx">JSONFormatter</span><span class="p">{})</span>
<a id="__codelineno-656-10" name="__codelineno-656-10"></a>
<a id="__codelineno-656-11" name="__codelineno-656-11"></a><span class="w">    </span><span class="c1">// 设置日志级别</span>
<a id="__codelineno-656-12" name="__codelineno-656-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">SetLevel</span><span class="p">(</span><span class="nx">log</span><span class="p">.</span><span class="nx">InfoLevel</span><span class="p">)</span>
<a id="__codelineno-656-13" name="__codelineno-656-13"></a>
<a id="__codelineno-656-14" name="__codelineno-656-14"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">WithFields</span><span class="p">(</span><span class="nx">log</span><span class="p">.</span><span class="nx">Fields</span><span class="p">{</span>
<a id="__codelineno-656-15" name="__codelineno-656-15"></a><span class="w">        </span><span class="s">&quot;animal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;walrus&quot;</span><span class="p">,</span>
<a id="__codelineno-656-16" name="__codelineno-656-16"></a><span class="w">        </span><span class="s">&quot;number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-656-17" name="__codelineno-656-17"></a><span class="w">        </span><span class="s">&quot;size&quot;</span><span class="p">:</span><span class="w">   </span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-656-18" name="__codelineno-656-18"></a><span class="w">    </span><span class="p">}).</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;A group of walrus emerges from the ocean&quot;</span><span class="p">)</span>
<a id="__codelineno-656-19" name="__codelineno-656-19"></a>
<a id="__codelineno-656-20" name="__codelineno-656-20"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Warn</span><span class="p">(</span><span class="s">&quot;This is a warning message&quot;</span><span class="p">)</span>
<a id="__codelineno-656-21" name="__codelineno-656-21"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;This is an error message&quot;</span><span class="p">)</span>
<a id="__codelineno-656-22" name="__codelineno-656-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-657-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-657-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-657-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-657-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-657-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-657-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-657-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-657-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-657-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-657-10">10</a></span>
<span class="normal"><a href="#__codelineno-657-11">11</a></span>
<span class="normal"><a href="#__codelineno-657-12">12</a></span>
<span class="normal"><a href="#__codelineno-657-13">13</a></span>
<span class="normal"><a href="#__codelineno-657-14">14</a></span>
<span class="normal"><a href="#__codelineno-657-15">15</a></span>
<span class="normal"><a href="#__codelineno-657-16">16</a></span>
<span class="normal"><a href="#__codelineno-657-17">17</a></span>
<span class="normal"><a href="#__codelineno-657-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-657-1" name="__codelineno-657-1"></a><span class="p">{</span>
<a id="__codelineno-657-2" name="__codelineno-657-2"></a><span class="w">  </span><span class="nt">&quot;animal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;walrus&quot;</span><span class="p">,</span>
<a id="__codelineno-657-3" name="__codelineno-657-3"></a><span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<a id="__codelineno-657-4" name="__codelineno-657-4"></a><span class="w">  </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A group of walrus emerges from the ocean&quot;</span><span class="p">,</span>
<a id="__codelineno-657-5" name="__codelineno-657-5"></a><span class="w">  </span><span class="nt">&quot;number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-657-6" name="__codelineno-657-6"></a><span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-657-7" name="__codelineno-657-7"></a><span class="w">  </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-04-27T12:00:07Z&quot;</span>
<a id="__codelineno-657-8" name="__codelineno-657-8"></a><span class="p">}</span>
<a id="__codelineno-657-9" name="__codelineno-657-9"></a><span class="p">{</span>
<a id="__codelineno-657-10" name="__codelineno-657-10"></a><span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
<a id="__codelineno-657-11" name="__codelineno-657-11"></a><span class="w">  </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is a warning message&quot;</span><span class="p">,</span>
<a id="__codelineno-657-12" name="__codelineno-657-12"></a><span class="w">  </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-04-27T12:00:08Z&quot;</span>
<a id="__codelineno-657-13" name="__codelineno-657-13"></a><span class="p">}</span>
<a id="__codelineno-657-14" name="__codelineno-657-14"></a><span class="p">{</span>
<a id="__codelineno-657-15" name="__codelineno-657-15"></a><span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-657-16" name="__codelineno-657-16"></a><span class="w">  </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is an error message&quot;</span><span class="p">,</span>
<a id="__codelineno-657-17" name="__codelineno-657-17"></a><span class="w">  </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-04-27T12:00:09Z&quot;</span>
<a id="__codelineno-657-18" name="__codelineno-657-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>优势：</strong></p>
<ul>
<li>支持结构化日志，便于日志的机器解析和查询。</li>
<li>丰富的日志级别和钩子，灵活应对不同的日志需求。</li>
<li>支持多种输出格式，如JSON、文本等。</li>
</ul>
<h5 id="zap"><code>zap</code><a class="headerlink" href="#zap" title="Permanent link">&para;</a></h5>
<p><code>zap</code>是Uber开发的一个高性能、结构化的日志库，适用于需要高吞吐量和低延迟的应用场景。</p>
<p><strong>安装：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-658-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-658-1" name="__codelineno-658-1"></a>go<span class="w"> </span>get<span class="w"> </span>go.uber.org/zap
</code></pre></div></td></tr></table></div>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-659-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-659-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-659-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-659-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-659-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-659-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-659-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-659-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-659-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-659-10">10</a></span>
<span class="normal"><a href="#__codelineno-659-11">11</a></span>
<span class="normal"><a href="#__codelineno-659-12">12</a></span>
<span class="normal"><a href="#__codelineno-659-13">13</a></span>
<span class="normal"><a href="#__codelineno-659-14">14</a></span>
<span class="normal"><a href="#__codelineno-659-15">15</a></span>
<span class="normal"><a href="#__codelineno-659-16">16</a></span>
<span class="normal"><a href="#__codelineno-659-17">17</a></span>
<span class="normal"><a href="#__codelineno-659-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-659-1" name="__codelineno-659-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-659-2" name="__codelineno-659-2"></a>
<a id="__codelineno-659-3" name="__codelineno-659-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-659-4" name="__codelineno-659-4"></a><span class="w">    </span><span class="s">&quot;go.uber.org/zap&quot;</span>
<a id="__codelineno-659-5" name="__codelineno-659-5"></a><span class="p">)</span>
<a id="__codelineno-659-6" name="__codelineno-659-6"></a>
<a id="__codelineno-659-7" name="__codelineno-659-7"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-659-8" name="__codelineno-659-8"></a><span class="w">    </span><span class="nx">logger</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zap</span><span class="p">.</span><span class="nx">NewProduction</span><span class="p">()</span>
<a id="__codelineno-659-9" name="__codelineno-659-9"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Sync</span><span class="p">()</span><span class="w"> </span><span class="c1">// flushes buffer, if any</span>
<a id="__codelineno-659-10" name="__codelineno-659-10"></a>
<a id="__codelineno-659-11" name="__codelineno-659-11"></a><span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Starting the application&quot;</span><span class="p">,</span>
<a id="__codelineno-659-12" name="__codelineno-659-12"></a><span class="w">        </span><span class="nx">zap</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">),</span>
<a id="__codelineno-659-13" name="__codelineno-659-13"></a><span class="w">        </span><span class="nx">zap</span><span class="p">.</span><span class="nx">Int</span><span class="p">(</span><span class="s">&quot;port&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8080</span><span class="p">),</span>
<a id="__codelineno-659-14" name="__codelineno-659-14"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-659-15" name="__codelineno-659-15"></a>
<a id="__codelineno-659-16" name="__codelineno-659-16"></a><span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Warn</span><span class="p">(</span><span class="s">&quot;This is a warning message&quot;</span><span class="p">)</span>
<a id="__codelineno-659-17" name="__codelineno-659-17"></a><span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;This is an error message&quot;</span><span class="p">)</span>
<a id="__codelineno-659-18" name="__codelineno-659-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-660-1">1</a></span>
<span class="normal"><a href="#__codelineno-660-2">2</a></span>
<span class="normal"><a href="#__codelineno-660-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-660-1" name="__codelineno-660-1"></a><span class="p">{</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="s2">&quot;info&quot;</span><span class="p">,</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="mf">1649678407.123456</span><span class="p">,</span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="s2">&quot;Starting the application&quot;</span><span class="p">,</span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="mi">8080</span><span class="p">}</span>
<a id="__codelineno-660-2" name="__codelineno-660-2"></a><span class="p">{</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="mf">1649678408.123456</span><span class="p">,</span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="s2">&quot;This is a warning message&quot;</span><span class="p">}</span>
<a id="__codelineno-660-3" name="__codelineno-660-3"></a><span class="p">{</span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="mf">1649678409.123456</span><span class="p">,</span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="s2">&quot;This is an error message&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>优势：</strong></p>
<ul>
<li>极高的性能，适合对日志性能要求较高的应用。</li>
<li>支持结构化日志，便于日志的处理和分析。</li>
<li>提供灵活的配置选项，适应不同的日志需求。</li>
</ul>
<h5 id="zerolog"><code>zerolog</code><a class="headerlink" href="#zerolog" title="Permanent link">&para;</a></h5>
<p><code>zerolog</code>是一个零开销、结构化的日志库，旨在提供高性能和低内存占用。</p>
<p><strong>安装：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-661-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-661-1" name="__codelineno-661-1"></a>go<span class="w"> </span>get<span class="w"> </span>github.com/rs/zerolog/log
</code></pre></div></td></tr></table></div>
<p><strong>基本用法：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-662-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-662-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-662-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-662-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-662-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-662-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-662-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-662-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-662-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-662-10">10</a></span>
<span class="normal"><a href="#__codelineno-662-11">11</a></span>
<span class="normal"><a href="#__codelineno-662-12">12</a></span>
<span class="normal"><a href="#__codelineno-662-13">13</a></span>
<span class="normal"><a href="#__codelineno-662-14">14</a></span>
<span class="normal"><a href="#__codelineno-662-15">15</a></span>
<span class="normal"><a href="#__codelineno-662-16">16</a></span>
<span class="normal"><a href="#__codelineno-662-17">17</a></span>
<span class="normal"><a href="#__codelineno-662-18">18</a></span>
<span class="normal"><a href="#__codelineno-662-19">19</a></span>
<span class="normal"><a href="#__codelineno-662-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-662-1" name="__codelineno-662-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-662-2" name="__codelineno-662-2"></a>
<a id="__codelineno-662-3" name="__codelineno-662-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-662-4" name="__codelineno-662-4"></a><span class="w">    </span><span class="s">&quot;github.com/rs/zerolog/log&quot;</span>
<a id="__codelineno-662-5" name="__codelineno-662-5"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-662-6" name="__codelineno-662-6"></a><span class="p">)</span>
<a id="__codelineno-662-7" name="__codelineno-662-7"></a>
<a id="__codelineno-662-8" name="__codelineno-662-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-662-9" name="__codelineno-662-9"></a><span class="w">    </span><span class="c1">// 设置日志输出为控制台</span>
<a id="__codelineno-662-10" name="__codelineno-662-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Output</span><span class="p">(</span><span class="nx">zerolog</span><span class="p">.</span><span class="nx">ConsoleWriter</span><span class="p">{</span><span class="nx">Out</span><span class="p">:</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">})</span>
<a id="__codelineno-662-11" name="__codelineno-662-11"></a>
<a id="__codelineno-662-12" name="__codelineno-662-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Info</span><span class="p">().</span>
<a id="__codelineno-662-13" name="__codelineno-662-13"></a><span class="w">        </span><span class="nx">Str</span><span class="p">(</span><span class="s">&quot;animal&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;walrus&quot;</span><span class="p">).</span>
<a id="__codelineno-662-14" name="__codelineno-662-14"></a><span class="w">        </span><span class="nx">Int</span><span class="p">(</span><span class="s">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span>
<a id="__codelineno-662-15" name="__codelineno-662-15"></a><span class="w">        </span><span class="nx">Int</span><span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">).</span>
<a id="__codelineno-662-16" name="__codelineno-662-16"></a><span class="w">        </span><span class="nx">Msg</span><span class="p">(</span><span class="s">&quot;A group of walrus emerges from the ocean&quot;</span><span class="p">)</span>
<a id="__codelineno-662-17" name="__codelineno-662-17"></a>
<a id="__codelineno-662-18" name="__codelineno-662-18"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Warn</span><span class="p">().</span><span class="nx">Msg</span><span class="p">(</span><span class="s">&quot;This is a warning message&quot;</span><span class="p">)</span>
<a id="__codelineno-662-19" name="__codelineno-662-19"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Error</span><span class="p">().</span><span class="nx">Msg</span><span class="p">(</span><span class="s">&quot;This is an error message&quot;</span><span class="p">)</span>
<a id="__codelineno-662-20" name="__codelineno-662-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-663-1">1</a></span>
<span class="normal"><a href="#__codelineno-663-2">2</a></span>
<span class="normal"><a href="#__codelineno-663-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-663-1" name="__codelineno-663-1"></a>12:00PM INF A group of walrus emerges from the ocean animal=walrus number=1 size=10
<a id="__codelineno-663-2" name="__codelineno-663-2"></a>12:00PM WRN This is a warning message
<a id="__codelineno-663-3" name="__codelineno-663-3"></a>12:00PM ERR This is an error message
</code></pre></div></td></tr></table></div>
<p><strong>优势：</strong></p>
<ul>
<li>零开销设计，适用于性能敏感的应用。</li>
<li>支持结构化日志，便于后续的日志处理和分析。</li>
<li>提供多种输出格式，包括控制台友好的文本和JSON。</li>
</ul>
<p><strong>选择适合的日志库：</strong></p>
<p>选择日志库时，应根据项目需求和性能要求进行权衡：</p>
<ul>
<li><strong>简单项目或基础需求</strong>：内置的<code>log</code>包已经足够使用。</li>
<li><strong>结构化日志和灵活性</strong>：选择<code>logrus</code>或<code>zerolog</code>。</li>
<li><strong>高性能和低延迟</strong>：选择<code>zap</code>或<code>zerolog</code>。</li>
</ul>
<h3 id="144-性能优化">14.4 性能优化<a class="headerlink" href="#144-性能优化" title="Permanent link">&para;</a></h3>
<p>性能优化是提升应用程序响应速度、吞吐量和资源利用效率的关键步骤。Go语言提供了一系列工具和技术，帮助开发者分析和优化代码性能。本节将介绍使用<code>pprof</code>进行性能分析，以及常见的性能问题与解决方案。</p>
<h4 id="使用-pprof">使用 <code>pprof</code><a class="headerlink" href="#使用-pprof" title="Permanent link">&para;</a></h4>
<p><code>pprof</code>是Go语言内置的性能分析工具，支持CPU分析、内存分析和阻塞分析等多种分析类型。通过集成<code>pprof</code>，可以轻松获取应用程序的性能数据，并进行可视化分析。</p>
<p><strong>基本步骤：</strong></p>
<ol>
<li><strong>引入<code>net/http/pprof</code>包</strong></li>
</ol>
<p>在应用程序中引入<code>net/http/pprof</code>包，以启用性能分析的HTTP端点。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-664-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-664-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-664-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-664-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-664-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-664-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-664-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-664-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-664-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-664-10">10</a></span>
<span class="normal"><a href="#__codelineno-664-11">11</a></span>
<span class="normal"><a href="#__codelineno-664-12">12</a></span>
<span class="normal"><a href="#__codelineno-664-13">13</a></span>
<span class="normal"><a href="#__codelineno-664-14">14</a></span>
<span class="normal"><a href="#__codelineno-664-15">15</a></span>
<span class="normal"><a href="#__codelineno-664-16">16</a></span>
<span class="normal"><a href="#__codelineno-664-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-664-1" name="__codelineno-664-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-664-2" name="__codelineno-664-2"></a>
<a id="__codelineno-664-3" name="__codelineno-664-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-664-4" name="__codelineno-664-4"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-664-5" name="__codelineno-664-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-664-6" name="__codelineno-664-6"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;net/http/pprof&quot;</span>
<a id="__codelineno-664-7" name="__codelineno-664-7"></a><span class="p">)</span>
<a id="__codelineno-664-8" name="__codelineno-664-8"></a>
<a id="__codelineno-664-9" name="__codelineno-664-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-664-10" name="__codelineno-664-10"></a><span class="w">    </span><span class="c1">// 启动性能分析HTTP服务器</span>
<a id="__codelineno-664-11" name="__codelineno-664-11"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-664-12" name="__codelineno-664-12"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;localhost:6060&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
<a id="__codelineno-664-13" name="__codelineno-664-13"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-664-14" name="__codelineno-664-14"></a>
<a id="__codelineno-664-15" name="__codelineno-664-15"></a><span class="w">    </span><span class="c1">// 应用程序的主逻辑</span>
<a id="__codelineno-664-16" name="__codelineno-664-16"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-664-17" name="__codelineno-664-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>注意：</strong></p>
<ul>
<li>使用<code>_ "net/http/pprof"</code>导入包，以仅执行其<code>init</code>函数，注册性能分析的HTTP端点。</li>
<li>
<p>性能分析服务器默认监听在<code>localhost:6060</code>，可以根据需要更改端口。</p>
</li>
<li>
<p><strong>运行应用程序</strong></p>
</li>
</ul>
<p>启动应用程序后，性能分析HTTP端点将可用。</p>
<ol>
<li><strong>使用<code>go tool pprof</code>进行分析</strong></li>
</ol>
<p>使用<code>go tool pprof</code>工具连接到运行中的应用程序，获取和分析性能数据。</p>
<p><strong>示例：CPU分析</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-665-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-665-1" name="__codelineno-665-1"></a>go<span class="w"> </span>tool<span class="w"> </span>pprof<span class="w"> </span>http://localhost:6060/debug/pprof/profile?seconds<span class="o">=</span><span class="m">30</span>
</code></pre></div></td></tr></table></div>
<p>这将采集30秒的CPU性能数据，并进入<code>pprof</code>交互模式。</p>
<ol>
<li><strong>可视化分析</strong></li>
</ol>
<p>在<code>pprof</code>交互模式中，可以生成各种图表和报告。</p>
<p><strong>示例：生成火焰图</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-666-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-666-1" name="__codelineno-666-1"></a><span class="o">(</span>pprof<span class="o">)</span><span class="w"> </span>web
</code></pre></div></td></tr></table></div>
<p>这将生成火焰图，直观展示函数调用的耗时情况。需要安装Graphviz工具以支持图形生成。</p>
<p><strong>示例：集成<code>pprof</code>到HTTP服务器</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-667-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-667-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-667-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-667-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-667-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-667-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-667-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-667-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-667-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-667-10">10</a></span>
<span class="normal"><a href="#__codelineno-667-11">11</a></span>
<span class="normal"><a href="#__codelineno-667-12">12</a></span>
<span class="normal"><a href="#__codelineno-667-13">13</a></span>
<span class="normal"><a href="#__codelineno-667-14">14</a></span>
<span class="normal"><a href="#__codelineno-667-15">15</a></span>
<span class="normal"><a href="#__codelineno-667-16">16</a></span>
<span class="normal"><a href="#__codelineno-667-17">17</a></span>
<span class="normal"><a href="#__codelineno-667-18">18</a></span>
<span class="normal"><a href="#__codelineno-667-19">19</a></span>
<span class="normal"><a href="#__codelineno-667-20">20</a></span>
<span class="normal"><a href="#__codelineno-667-21">21</a></span>
<span class="normal"><a href="#__codelineno-667-22">22</a></span>
<span class="normal"><a href="#__codelineno-667-23">23</a></span>
<span class="normal"><a href="#__codelineno-667-24">24</a></span>
<span class="normal"><a href="#__codelineno-667-25">25</a></span>
<span class="normal"><a href="#__codelineno-667-26">26</a></span>
<span class="normal"><a href="#__codelineno-667-27">27</a></span>
<span class="normal"><a href="#__codelineno-667-28">28</a></span>
<span class="normal"><a href="#__codelineno-667-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-667-1" name="__codelineno-667-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-667-2" name="__codelineno-667-2"></a>
<a id="__codelineno-667-3" name="__codelineno-667-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-667-4" name="__codelineno-667-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-667-5" name="__codelineno-667-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-667-6" name="__codelineno-667-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-667-7" name="__codelineno-667-7"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;net/http/pprof&quot;</span>
<a id="__codelineno-667-8" name="__codelineno-667-8"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-667-9" name="__codelineno-667-9"></a><span class="p">)</span>
<a id="__codelineno-667-10" name="__codelineno-667-10"></a>
<a id="__codelineno-667-11" name="__codelineno-667-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-667-12" name="__codelineno-667-12"></a><span class="w">    </span><span class="c1">// 启动性能分析HTTP服务器</span>
<a id="__codelineno-667-13" name="__codelineno-667-13"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-667-14" name="__codelineno-667-14"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;localhost:6060&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
<a id="__codelineno-667-15" name="__codelineno-667-15"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-667-16" name="__codelineno-667-16"></a>
<a id="__codelineno-667-17" name="__codelineno-667-17"></a><span class="w">    </span><span class="c1">// 模拟主应用程序逻辑</span>
<a id="__codelineno-667-18" name="__codelineno-667-18"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-667-19" name="__codelineno-667-19"></a><span class="w">        </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<a id="__codelineno-667-20" name="__codelineno-667-20"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-667-21" name="__codelineno-667-21"></a><span class="w">            </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i</span>
<a id="__codelineno-667-22" name="__codelineno-667-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-667-23" name="__codelineno-667-23"></a><span class="w">        </span><span class="nx">elapsed</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>
<a id="__codelineno-667-24" name="__codelineno-667-24"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;处理完成，耗时: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">elapsed</span><span class="p">)</span>
<a id="__codelineno-667-25" name="__codelineno-667-25"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-667-26" name="__codelineno-667-26"></a>
<a id="__codelineno-667-27" name="__codelineno-667-27"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;应用程序启动，访问 http://localhost:8080/&quot;</span><span class="p">)</span>
<a id="__codelineno-667-28" name="__codelineno-667-28"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
<a id="__codelineno-667-29" name="__codelineno-667-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行示例：</strong></p>
<ol>
<li>
<p>启动应用程序。</p>
</li>
<li>
<p>访问<code>http://localhost:8080/</code>，触发一些计算。</p>
</li>
<li>
<p>使用<code>pprof</code>分析CPU性能：</p>
</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-668-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-668-1" name="__codelineno-668-1"></a>go<span class="w"> </span>tool<span class="w"> </span>pprof<span class="w"> </span>http://localhost:6060/debug/pprof/profile?seconds<span class="o">=</span><span class="m">10</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>在<code>pprof</code>交互模式中，生成火焰图：</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-669-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-669-1" name="__codelineno-669-1"></a><span class="o">(</span>pprof<span class="o">)</span><span class="w"> </span>web
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<p><img alt="Flame Graph" src="https://golang.org/pkg/net/http/pprof/#hdr-Profiling_tools" /></p>
<p><strong>优势：</strong></p>
<ul>
<li><strong>全面的性能分析</strong>：支持CPU、内存、阻塞等多种分析类型。</li>
<li><strong>可视化工具</strong>：通过火焰图等图形化报告，直观展示性能瓶颈。</li>
<li><strong>集成方便</strong>：无需外部依赖，内置于Go语言标准库。</li>
</ul>
<h4 id="常见性能问题与解决方案">常见性能问题与解决方案<a class="headerlink" href="#常见性能问题与解决方案" title="Permanent link">&para;</a></h4>
<p>在Go应用程序中，常见的性能问题包括高CPU使用率、内存泄漏、过度的垃圾回收等。以下是一些常见性能问题的识别和解决方案。</p>
<h5 id="1-高cpu使用率">1. 高CPU使用率<a class="headerlink" href="#1-高cpu使用率" title="Permanent link">&para;</a></h5>
<p><strong>问题描述：</strong></p>
<p>应用程序在某些操作中消耗了过多的CPU资源，导致响应速度变慢或系统负载过高。</p>
<p><strong>解决方案：</strong></p>
<ul>
<li><strong>识别热点代码</strong>：使用<code>pprof</code>分析CPU性能，找到耗时最多的函数或代码段。</li>
<li><strong>优化算法</strong>：改进算法复杂度，选择更高效的数据结构。</li>
<li><strong>减少锁竞争</strong>：在并发环境中，优化锁的使用，减少锁竞争带来的性能损耗。</li>
<li><strong>避免不必要的计算</strong>：缓存计算结果，避免重复计算。</li>
</ul>
<p><strong>示例：优化热点代码</strong></p>
<p>原始代码：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-670-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-670-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-670-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-670-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-670-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-670-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-670-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-670-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-670-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-670-10">10</a></span>
<span class="normal"><a href="#__codelineno-670-11">11</a></span>
<span class="normal"><a href="#__codelineno-670-12">12</a></span>
<span class="normal"><a href="#__codelineno-670-13">13</a></span>
<span class="normal"><a href="#__codelineno-670-14">14</a></span>
<span class="normal"><a href="#__codelineno-670-15">15</a></span>
<span class="normal"><a href="#__codelineno-670-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-670-1" name="__codelineno-670-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">calculatePrimes</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-670-2" name="__codelineno-670-2"></a><span class="w">    </span><span class="nx">primes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
<a id="__codelineno-670-3" name="__codelineno-670-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">n</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-670-4" name="__codelineno-670-4"></a><span class="w">        </span><span class="nx">isPrime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-670-5" name="__codelineno-670-5"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">*</span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-670-6" name="__codelineno-670-6"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">i</span><span class="o">%</span><span class="nx">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-670-7" name="__codelineno-670-7"></a><span class="w">                </span><span class="nx">isPrime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-670-8" name="__codelineno-670-8"></a><span class="w">                </span><span class="k">break</span>
<a id="__codelineno-670-9" name="__codelineno-670-9"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-670-10" name="__codelineno-670-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-670-11" name="__codelineno-670-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">isPrime</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-670-12" name="__codelineno-670-12"></a><span class="w">            </span><span class="nx">primes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">primes</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-670-13" name="__codelineno-670-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-670-14" name="__codelineno-670-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-670-15" name="__codelineno-670-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">primes</span>
<a id="__codelineno-670-16" name="__codelineno-670-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>优化后的代码（使用并发和更高效的算法）：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-671-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-671-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-671-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-671-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-671-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-671-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-671-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-671-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-671-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-671-10">10</a></span>
<span class="normal"><a href="#__codelineno-671-11">11</a></span>
<span class="normal"><a href="#__codelineno-671-12">12</a></span>
<span class="normal"><a href="#__codelineno-671-13">13</a></span>
<span class="normal"><a href="#__codelineno-671-14">14</a></span>
<span class="normal"><a href="#__codelineno-671-15">15</a></span>
<span class="normal"><a href="#__codelineno-671-16">16</a></span>
<span class="normal"><a href="#__codelineno-671-17">17</a></span>
<span class="normal"><a href="#__codelineno-671-18">18</a></span>
<span class="normal"><a href="#__codelineno-671-19">19</a></span>
<span class="normal"><a href="#__codelineno-671-20">20</a></span>
<span class="normal"><a href="#__codelineno-671-21">21</a></span>
<span class="normal"><a href="#__codelineno-671-22">22</a></span>
<span class="normal"><a href="#__codelineno-671-23">23</a></span>
<span class="normal"><a href="#__codelineno-671-24">24</a></span>
<span class="normal"><a href="#__codelineno-671-25">25</a></span>
<span class="normal"><a href="#__codelineno-671-26">26</a></span>
<span class="normal"><a href="#__codelineno-671-27">27</a></span>
<span class="normal"><a href="#__codelineno-671-28">28</a></span>
<span class="normal"><a href="#__codelineno-671-29">29</a></span>
<span class="normal"><a href="#__codelineno-671-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-671-1" name="__codelineno-671-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">calculatePrimesOptimized</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-671-2" name="__codelineno-671-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">primes</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<a id="__codelineno-671-3" name="__codelineno-671-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-671-4" name="__codelineno-671-4"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-671-5" name="__codelineno-671-5"></a>
<a id="__codelineno-671-6" name="__codelineno-671-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">n</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-671-7" name="__codelineno-671-7"></a><span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-671-8" name="__codelineno-671-8"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">num</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-671-9" name="__codelineno-671-9"></a><span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<a id="__codelineno-671-10" name="__codelineno-671-10"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">isPrime</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-671-11" name="__codelineno-671-11"></a><span class="w">                </span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-671-12" name="__codelineno-671-12"></a><span class="w">                </span><span class="nx">primes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">primes</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-671-13" name="__codelineno-671-13"></a><span class="w">                </span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-671-14" name="__codelineno-671-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-671-15" name="__codelineno-671-15"></a><span class="w">        </span><span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-671-16" name="__codelineno-671-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-671-17" name="__codelineno-671-17"></a>
<a id="__codelineno-671-18" name="__codelineno-671-18"></a><span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<a id="__codelineno-671-19" name="__codelineno-671-19"></a><span class="w">    </span><span class="nx">sort</span><span class="p">.</span><span class="nx">Ints</span><span class="p">(</span><span class="nx">primes</span><span class="p">)</span>
<a id="__codelineno-671-20" name="__codelineno-671-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">primes</span>
<a id="__codelineno-671-21" name="__codelineno-671-21"></a><span class="p">}</span>
<a id="__codelineno-671-22" name="__codelineno-671-22"></a>
<a id="__codelineno-671-23" name="__codelineno-671-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">isPrime</span><span class="p">(</span><span class="nx">num</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-671-24" name="__codelineno-671-24"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">*</span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">num</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-671-25" name="__codelineno-671-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">num</span><span class="o">%</span><span class="nx">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-671-26" name="__codelineno-671-26"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-671-27" name="__codelineno-671-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-671-28" name="__codelineno-671-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-671-29" name="__codelineno-671-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-671-30" name="__codelineno-671-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>并发处理</strong>：使用Goroutine并行计算素数，充分利用多核CPU。</li>
<li><strong>同步控制</strong>：使用互斥锁（<code>mu</code>）保护共享资源<code>primes</code>的并发访问。</li>
<li><strong>算法优化</strong>：将素数判断逻辑封装为独立函数，提升代码复用和可读性。</li>
</ul>
<h5 id="2-内存泄漏">2. 内存泄漏<a class="headerlink" href="#2-内存泄漏" title="Permanent link">&para;</a></h5>
<p><strong>问题描述：</strong></p>
<p>应用程序持续增长的内存使用，未能释放不再需要的内存，导致系统资源耗尽。</p>
<p><strong>解决方案：</strong></p>
<ul>
<li><strong>分析内存使用</strong>：使用<code>pprof</code>的内存分析功能，找出内存泄漏的源头。</li>
<li><strong>及时释放资源</strong>：确保打开的文件、网络连接等资源在使用完毕后被正确关闭。</li>
<li><strong>避免不必要的全局变量</strong>：减少全局变量的使用，防止长生命周期对象占用内存。</li>
<li><strong>优化数据结构</strong>：选择合适的数据结构，避免不必要的内存分配。</li>
</ul>
<p><strong>示例：检测内存泄漏</strong></p>
<p>服务端代码中存在内存泄漏：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-672-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-672-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-672-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-672-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-672-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-672-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-672-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-672-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-672-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-672-10">10</a></span>
<span class="normal"><a href="#__codelineno-672-11">11</a></span>
<span class="normal"><a href="#__codelineno-672-12">12</a></span>
<span class="normal"><a href="#__codelineno-672-13">13</a></span>
<span class="normal"><a href="#__codelineno-672-14">14</a></span>
<span class="normal"><a href="#__codelineno-672-15">15</a></span>
<span class="normal"><a href="#__codelineno-672-16">16</a></span>
<span class="normal"><a href="#__codelineno-672-17">17</a></span>
<span class="normal"><a href="#__codelineno-672-18">18</a></span>
<span class="normal"><a href="#__codelineno-672-19">19</a></span>
<span class="normal"><a href="#__codelineno-672-20">20</a></span>
<span class="normal"><a href="#__codelineno-672-21">21</a></span>
<span class="normal"><a href="#__codelineno-672-22">22</a></span>
<span class="normal"><a href="#__codelineno-672-23">23</a></span>
<span class="normal"><a href="#__codelineno-672-24">24</a></span>
<span class="normal"><a href="#__codelineno-672-25">25</a></span>
<span class="normal"><a href="#__codelineno-672-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-672-1" name="__codelineno-672-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-672-2" name="__codelineno-672-2"></a>
<a id="__codelineno-672-3" name="__codelineno-672-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-672-4" name="__codelineno-672-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-672-5" name="__codelineno-672-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-672-6" name="__codelineno-672-6"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;net/http/pprof&quot;</span>
<a id="__codelineno-672-7" name="__codelineno-672-7"></a><span class="p">)</span>
<a id="__codelineno-672-8" name="__codelineno-672-8"></a>
<a id="__codelineno-672-9" name="__codelineno-672-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span>
<a id="__codelineno-672-10" name="__codelineno-672-10"></a>
<a id="__codelineno-672-11" name="__codelineno-672-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-672-12" name="__codelineno-672-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-672-13" name="__codelineno-672-13"></a><span class="w">        </span><span class="nx">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-672-14" name="__codelineno-672-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-672-15" name="__codelineno-672-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Data length: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-672-16" name="__codelineno-672-16"></a><span class="p">}</span>
<a id="__codelineno-672-17" name="__codelineno-672-17"></a>
<a id="__codelineno-672-18" name="__codelineno-672-18"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-672-19" name="__codelineno-672-19"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span>
<a id="__codelineno-672-20" name="__codelineno-672-20"></a>
<a id="__codelineno-672-21" name="__codelineno-672-21"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-672-22" name="__codelineno-672-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;localhost:6060&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
<a id="__codelineno-672-23" name="__codelineno-672-23"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-672-24" name="__codelineno-672-24"></a>
<a id="__codelineno-672-25" name="__codelineno-672-25"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-672-26" name="__codelineno-672-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>分析与解决：</strong></p>
<ul>
<li><strong>问题识别</strong>：<code>data</code>切片作为全局变量持续增长，导致内存泄漏。</li>
<li><strong>解决方案</strong>：避免将数据存储在全局变量中，或限制其大小。</li>
</ul>
<p>优化后的代码：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-673-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-673-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-673-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-673-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-673-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-673-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-673-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-673-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-673-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-673-10">10</a></span>
<span class="normal"><a href="#__codelineno-673-11">11</a></span>
<span class="normal"><a href="#__codelineno-673-12">12</a></span>
<span class="normal"><a href="#__codelineno-673-13">13</a></span>
<span class="normal"><a href="#__codelineno-673-14">14</a></span>
<span class="normal"><a href="#__codelineno-673-15">15</a></span>
<span class="normal"><a href="#__codelineno-673-16">16</a></span>
<span class="normal"><a href="#__codelineno-673-17">17</a></span>
<span class="normal"><a href="#__codelineno-673-18">18</a></span>
<span class="normal"><a href="#__codelineno-673-19">19</a></span>
<span class="normal"><a href="#__codelineno-673-20">20</a></span>
<span class="normal"><a href="#__codelineno-673-21">21</a></span>
<span class="normal"><a href="#__codelineno-673-22">22</a></span>
<span class="normal"><a href="#__codelineno-673-23">23</a></span>
<span class="normal"><a href="#__codelineno-673-24">24</a></span>
<span class="normal"><a href="#__codelineno-673-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-673-1" name="__codelineno-673-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-673-2" name="__codelineno-673-2"></a>
<a id="__codelineno-673-3" name="__codelineno-673-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-673-4" name="__codelineno-673-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-673-5" name="__codelineno-673-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-673-6" name="__codelineno-673-6"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;net/http/pprof&quot;</span>
<a id="__codelineno-673-7" name="__codelineno-673-7"></a><span class="p">)</span>
<a id="__codelineno-673-8" name="__codelineno-673-8"></a>
<a id="__codelineno-673-9" name="__codelineno-673-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-673-10" name="__codelineno-673-10"></a><span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-673-11" name="__codelineno-673-11"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-673-12" name="__codelineno-673-12"></a><span class="w">        </span><span class="nx">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span>
<a id="__codelineno-673-13" name="__codelineno-673-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-673-14" name="__codelineno-673-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Data length: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<a id="__codelineno-673-15" name="__codelineno-673-15"></a><span class="p">}</span>
<a id="__codelineno-673-16" name="__codelineno-673-16"></a>
<a id="__codelineno-673-17" name="__codelineno-673-17"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-673-18" name="__codelineno-673-18"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span>
<a id="__codelineno-673-19" name="__codelineno-673-19"></a>
<a id="__codelineno-673-20" name="__codelineno-673-20"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-673-21" name="__codelineno-673-21"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;localhost:6060&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
<a id="__codelineno-673-22" name="__codelineno-673-22"></a><span class="w">    </span><span class="p">}()</span>
<a id="__codelineno-673-23" name="__codelineno-673-23"></a>
<a id="__codelineno-673-24" name="__codelineno-673-24"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-673-25" name="__codelineno-673-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>局部变量</strong>：将<code>data</code>切片定义为局部变量，避免其在全局范围内持续增长。</li>
<li><strong>内存释放</strong>：请求结束后，局部变量的内存会被垃圾回收器回收，防止内存泄漏。</li>
</ul>
<h5 id="3-过度的垃圾回收">3. 过度的垃圾回收<a class="headerlink" href="#3-过度的垃圾回收" title="Permanent link">&para;</a></h5>
<p><strong>问题描述：</strong></p>
<p>频繁的垃圾回收（GC）导致应用程序性能下降，尤其是在高并发或大量内存分配的场景下。</p>
<p><strong>解决方案：</strong></p>
<ul>
<li><strong>减少内存分配</strong>：尽量复用对象，避免频繁分配和释放内存。</li>
<li><strong>优化数据结构</strong>：选择适合的数据结构，减少不必要的内存占用。</li>
<li><strong>调整GC参数</strong>：根据应用需求，调整GOGC环境变量，优化垃圾回收频率。</li>
</ul>
<p><strong>示例：优化内存分配</strong></p>
<p>原始代码：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-674-1">1</a></span>
<span class="normal"><a href="#__codelineno-674-2">2</a></span>
<span class="normal"><a href="#__codelineno-674-3">3</a></span>
<span class="normal"><a href="#__codelineno-674-4">4</a></span>
<span class="normal"><a href="#__codelineno-674-5">5</a></span>
<span class="normal"><a href="#__codelineno-674-6">6</a></span>
<span class="normal"><a href="#__codelineno-674-7">7</a></span>
<span class="normal"><a href="#__codelineno-674-8">8</a></span>
<span class="normal"><a href="#__codelineno-674-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-674-1" name="__codelineno-674-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">processData</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-674-2" name="__codelineno-674-2"></a><span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
<a id="__codelineno-674-3" name="__codelineno-674-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-674-4" name="__codelineno-674-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">num</span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-674-5" name="__codelineno-674-5"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-674-6" name="__codelineno-674-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-674-7" name="__codelineno-674-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-674-8" name="__codelineno-674-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<a id="__codelineno-674-9" name="__codelineno-674-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>优化后的代码（预分配内存）：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-675-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-675-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-675-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-675-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-675-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-675-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-675-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-675-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-675-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-675-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-675-1" name="__codelineno-675-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">processDataOptimized</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-675-2" name="__codelineno-675-2"></a><span class="w">    </span><span class="c1">// 预估结果长度，减少内存重新分配</span>
<a id="__codelineno-675-3" name="__codelineno-675-3"></a><span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-675-4" name="__codelineno-675-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-675-5" name="__codelineno-675-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">num</span><span class="o">%</span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-675-6" name="__codelineno-675-6"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-675-7" name="__codelineno-675-7"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-675-8" name="__codelineno-675-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-675-9" name="__codelineno-675-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span>
<a id="__codelineno-675-10" name="__codelineno-675-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>预分配内存</strong>：使用<code>make</code>函数预分配<code>result</code>切片的容量，减少<code>append</code>操作时的内存重新分配。</li>
<li><strong>提高缓存命中率</strong>：减少内存分配次数，提高数据在CPU缓存中的命中率，提升性能。</li>
</ul>
<h4 id="性能分析工具">性能分析工具<a class="headerlink" href="#性能分析工具" title="Permanent link">&para;</a></h4>
<p>除了<code>pprof</code>，Go语言还支持其他性能分析工具，如<code>trace</code>和第三方分析工具。这些工具可以帮助开发者深入了解应用程序的性能瓶颈，制定有效的优化策略。</p>
<h5 id="trace"><code>trace</code><a class="headerlink" href="#trace" title="Permanent link">&para;</a></h5>
<p><code>trace</code>工具用于跟踪应用程序的执行，包括Goroutine的调度、系统调用等。它提供了详细的运行时信息，适用于复杂的性能问题分析。</p>
<p><strong>基本用法：</strong></p>
<ol>
<li><strong>引入<code>runtime/trace</code>包</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-676-1">1</a></span>
<span class="normal"><a href="#__codelineno-676-2">2</a></span>
<span class="normal"><a href="#__codelineno-676-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-676-1" name="__codelineno-676-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-676-2" name="__codelineno-676-2"></a><span class="w">    </span><span class="s">&quot;runtime/trace&quot;</span>
<a id="__codelineno-676-3" name="__codelineno-676-3"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>在应用程序中启动跟踪</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-677-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-677-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-677-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-677-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-677-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-677-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-677-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-677-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-677-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-677-10">10</a></span>
<span class="normal"><a href="#__codelineno-677-11">11</a></span>
<span class="normal"><a href="#__codelineno-677-12">12</a></span>
<span class="normal"><a href="#__codelineno-677-13">13</a></span>
<span class="normal"><a href="#__codelineno-677-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-677-1" name="__codelineno-677-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-677-2" name="__codelineno-677-2"></a><span class="w">    </span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;trace.out&quot;</span><span class="p">)</span>
<a id="__codelineno-677-3" name="__codelineno-677-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-677-4" name="__codelineno-677-4"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-677-5" name="__codelineno-677-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-677-6" name="__codelineno-677-6"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-677-7" name="__codelineno-677-7"></a>
<a id="__codelineno-677-8" name="__codelineno-677-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">trace</span><span class="p">.</span><span class="nx">Start</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-677-9" name="__codelineno-677-9"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-677-10" name="__codelineno-677-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-677-11" name="__codelineno-677-11"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">trace</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>
<a id="__codelineno-677-12" name="__codelineno-677-12"></a>
<a id="__codelineno-677-13" name="__codelineno-677-13"></a><span class="w">    </span><span class="c1">// 应用程序逻辑</span>
<a id="__codelineno-677-14" name="__codelineno-677-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>
<p><strong>运行应用程序</strong></p>
</li>
<li>
<p><strong>分析跟踪文件</strong></p>
</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-678-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-678-1" name="__codelineno-678-1"></a>go<span class="w"> </span>tool<span class="w"> </span>trace<span class="w"> </span>trace.out
</code></pre></div></td></tr></table></div>
<p>这将启动一个Web界面，提供图形化的跟踪数据分析。</p>
<h5 id="第三方性能分析工具">第三方性能分析工具<a class="headerlink" href="#第三方性能分析工具" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>GoLand</strong>：JetBrains的Go开发工具，内置了性能分析和调试功能。</li>
<li><strong>Delve</strong>：Go语言的调试工具，支持断点、变量监控等功能。</li>
<li><strong>Gometrics</strong>：一个性能监控和指标收集工具，适用于分布式系统。</li>
</ul>
<p><strong>示例：使用Delve进行调试</strong></p>
<ol>
<li><strong>安装Delve</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-679-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-679-1" name="__codelineno-679-1"></a>go<span class="w"> </span>install<span class="w"> </span>github.com/go-delve/delve/cmd/dlv@latest
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>启动调试会话</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-680-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-680-1" name="__codelineno-680-1"></a>dlv<span class="w"> </span>debug<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>设置断点和调试</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-681-1">1</a></span>
<span class="normal"><a href="#__codelineno-681-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-681-1" name="__codelineno-681-1"></a><span class="o">(</span>dlv<span class="o">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span>main.go:10
<a id="__codelineno-681-2" name="__codelineno-681-2"></a><span class="o">(</span>dlv<span class="o">)</span><span class="w"> </span><span class="k">continue</span>
</code></pre></div></td></tr></table></div>
<p><strong>优势：</strong></p>
<ul>
<li><strong>全面的调试功能</strong>：支持断点、单步执行、变量监控等功能。</li>
<li><strong>集成开发环境</strong>：与GoLand等IDE集成，提供便捷的调试体验。</li>
<li><strong>灵活的配置</strong>：支持多种调试模式，适应不同的调试需求。</li>
</ul>
<h3 id="145-总结">14.5 总结<a class="headerlink" href="#145-总结" title="Permanent link">&para;</a></h3>
<p>本章介绍了Go语言中常用的命令行工具、代码风格指南、日志处理方法以及性能优化策略。这些工具和最佳实践是构建高质量、可维护和高性能Go应用程序的基石。</p>
<p><strong>关键点回顾：</strong></p>
<ul>
<li><strong>Go 常用命令</strong>：</li>
<li><code>go build</code>：编译Go源码，生成可执行文件或库文件。</li>
<li><code>go run</code>：编译并运行Go源码，适用于快速测试。</li>
<li><code>go test</code>：运行单元测试、基准测试和示例测试。</li>
<li><code>go fmt</code>：格式化Go源码，确保代码风格一致。</li>
<li><code>go mod</code>：管理Go模块，处理依赖关系。</li>
<li><strong>Go 代码风格</strong>：</li>
<li>使用<code>go fmt</code>统一代码格式。</li>
<li>遵循命名约定，使用驼峰命名法和简短有意义的名称。</li>
<li>避免过长的函数和方法，保持代码简洁。</li>
<li>通过接口简化代码，提升灵活性和可测试性。</li>
<li><strong>日志处理</strong>：</li>
<li>使用内置的<code>log</code>包进行基础日志记录。</li>
<li>选择适合的第三方日志库（如<code>logrus</code>、<code>zap</code>、<code>zerolog</code>）满足高级日志需求。</li>
<li>设计合理的日志级别和输出格式，确保日志的可读性和可维护性。</li>
<li><strong>性能优化</strong>：</li>
<li>使用<code>pprof</code>进行全面的性能分析，识别和优化性能瓶颈。</li>
<li>避免常见的性能问题，如高CPU使用率、内存泄漏和过度的垃圾回收。</li>
<li>利用性能分析工具（如<code>trace</code>和<code>Delve</code>）深入了解应用程序的运行时行为。</li>
</ul>
<p><strong>最佳实践：</strong></p>
<ul>
<li><strong>自动化工具链</strong>：在开发流程中集成<code>go fmt</code>、测试和构建命令，确保代码质量和一致性。</li>
<li><strong>持续集成</strong>：使用CI工具（如GitHub Actions、Travis CI）自动运行测试和生成覆盖率报告，确保代码变更不引入错误。</li>
<li><strong>结构化日志</strong>：采用结构化日志格式，便于日志的解析、搜索和分析，提升运维效率。</li>
<li><strong>性能监控</strong>：在生产环境中部署性能监控工具，实时监控应用程序的性能指标，及时发现和解决性能问题。</li>
<li><strong>代码审查</strong>：通过代码审查流程，确保代码风格、质量和性能达到团队标准。</li>
</ul>
<h2 id="15-项目实战">15. 项目实战<a class="headerlink" href="#15-项目实战" title="Permanent link">&para;</a></h2>
<p>通过实际项目的开发，能够将前面章节中学到的Go语言知识应用到真实场景中，加深理解并积累实战经验。本章将带领你完成多个项目，从简单的Web应用到分布式任务调度，每个项目都详细介绍了设计思路、关键技术点以及完整的代码实现。所有代码均经过仔细检查，确保无误，方便你直接运行和学习。</p>
<h3 id="151-简单的-web-应用">15.1 简单的 Web 应用<a class="headerlink" href="#151-简单的-web-应用" title="Permanent link">&para;</a></h3>
<p>构建一个简单的Web应用是掌握Go语言Web开发的第一步。我们将使用Go内置的<code>net/http</code>包创建一个基本的Web服务器，处理不同的路由，并响应HTML页面。</p>
<h4 id="1-项目概述">1. 项目概述<a class="headerlink" href="#1-项目概述" title="Permanent link">&para;</a></h4>
<p>本项目将实现一个简单的Web应用，具备以下功能：</p>
<ul>
<li>主页展示欢迎信息。</li>
<li>关于页面展示应用信息。</li>
<li>联系页面提供联系方式。</li>
</ul>
<h4 id="2-项目结构">2. 项目结构<a class="headerlink" href="#2-项目结构" title="Permanent link">&para;</a></h4>
<p>建议的项目结构如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-682-1">1</a></span>
<span class="normal"><a href="#__codelineno-682-2">2</a></span>
<span class="normal"><a href="#__codelineno-682-3">3</a></span>
<span class="normal"><a href="#__codelineno-682-4">4</a></span>
<span class="normal"><a href="#__codelineno-682-5">5</a></span>
<span class="normal"><a href="#__codelineno-682-6">6</a></span>
<span class="normal"><a href="#__codelineno-682-7">7</a></span>
<span class="normal"><a href="#__codelineno-682-8">8</a></span>
<span class="normal"><a href="#__codelineno-682-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-682-1" name="__codelineno-682-1"></a>simple-web-app/
<a id="__codelineno-682-2" name="__codelineno-682-2"></a>├── main.go
<a id="__codelineno-682-3" name="__codelineno-682-3"></a>├── templates/
<a id="__codelineno-682-4" name="__codelineno-682-4"></a>│   ├── index.html
<a id="__codelineno-682-5" name="__codelineno-682-5"></a>│   ├── about.html
<a id="__codelineno-682-6" name="__codelineno-682-6"></a>│   └── contact.html
<a id="__codelineno-682-7" name="__codelineno-682-7"></a>└── static/
<a id="__codelineno-682-8" name="__codelineno-682-8"></a>    └── css/
<a id="__codelineno-682-9" name="__codelineno-682-9"></a>        └── styles.css
</code></pre></div></td></tr></table></div>
<h4 id="3-编写-html-模板">3. 编写 HTML 模板<a class="headerlink" href="#3-编写-html-模板" title="Permanent link">&para;</a></h4>
<p>首先，创建<code>templates</code>目录，并在其中添加三个HTML模板文件：<code>index.html</code>、<code>about.html</code>和<code>contact.html</code>。</p>
<p><strong>templates/index.html</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">HTML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-683-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-683-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-683-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-683-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-683-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-683-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-683-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-683-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-683-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-683-10">10</a></span>
<span class="normal"><a href="#__codelineno-683-11">11</a></span>
<span class="normal"><a href="#__codelineno-683-12">12</a></span>
<span class="normal"><a href="#__codelineno-683-13">13</a></span>
<span class="normal"><a href="#__codelineno-683-14">14</a></span>
<span class="normal"><a href="#__codelineno-683-15">15</a></span>
<span class="normal"><a href="#__codelineno-683-16">16</a></span>
<span class="normal"><a href="#__codelineno-683-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-683-1" name="__codelineno-683-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-683-2" name="__codelineno-683-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-683-3" name="__codelineno-683-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-683-4" name="__codelineno-683-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-683-5" name="__codelineno-683-5"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-683-6" name="__codelineno-683-6"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/static/css/styles.css&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-683-7" name="__codelineno-683-7"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-683-8" name="__codelineno-683-8"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-683-9" name="__codelineno-683-9"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>欢迎来到简单的Web应用!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-683-10" name="__codelineno-683-10"></a>    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-683-11" name="__codelineno-683-11"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-683-12" name="__codelineno-683-12"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/about&quot;</span><span class="p">&gt;</span>关于<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-683-13" name="__codelineno-683-13"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/contact&quot;</span><span class="p">&gt;</span>联系<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-683-14" name="__codelineno-683-14"></a>    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-683-15" name="__codelineno-683-15"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>这是主页内容。<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-683-16" name="__codelineno-683-16"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-683-17" name="__codelineno-683-17"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>templates/about.html</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">HTML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-684-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-684-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-684-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-684-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-684-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-684-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-684-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-684-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-684-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-684-10">10</a></span>
<span class="normal"><a href="#__codelineno-684-11">11</a></span>
<span class="normal"><a href="#__codelineno-684-12">12</a></span>
<span class="normal"><a href="#__codelineno-684-13">13</a></span>
<span class="normal"><a href="#__codelineno-684-14">14</a></span>
<span class="normal"><a href="#__codelineno-684-15">15</a></span>
<span class="normal"><a href="#__codelineno-684-16">16</a></span>
<span class="normal"><a href="#__codelineno-684-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-684-1" name="__codelineno-684-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-684-2" name="__codelineno-684-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-684-3" name="__codelineno-684-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-684-4" name="__codelineno-684-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-684-5" name="__codelineno-684-5"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>关于<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-684-6" name="__codelineno-684-6"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/static/css/styles.css&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-684-7" name="__codelineno-684-7"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-684-8" name="__codelineno-684-8"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-684-9" name="__codelineno-684-9"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>关于我们<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-684-10" name="__codelineno-684-10"></a>    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-684-11" name="__codelineno-684-11"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-684-12" name="__codelineno-684-12"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/about&quot;</span><span class="p">&gt;</span>关于<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-684-13" name="__codelineno-684-13"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/contact&quot;</span><span class="p">&gt;</span>联系<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-684-14" name="__codelineno-684-14"></a>    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-684-15" name="__codelineno-684-15"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>这是关于页面的内容。<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-684-16" name="__codelineno-684-16"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-684-17" name="__codelineno-684-17"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>templates/contact.html</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">HTML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-685-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-685-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-685-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-685-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-685-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-685-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-685-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-685-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-685-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-685-10">10</a></span>
<span class="normal"><a href="#__codelineno-685-11">11</a></span>
<span class="normal"><a href="#__codelineno-685-12">12</a></span>
<span class="normal"><a href="#__codelineno-685-13">13</a></span>
<span class="normal"><a href="#__codelineno-685-14">14</a></span>
<span class="normal"><a href="#__codelineno-685-15">15</a></span>
<span class="normal"><a href="#__codelineno-685-16">16</a></span>
<span class="normal"><a href="#__codelineno-685-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-685-1" name="__codelineno-685-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-685-2" name="__codelineno-685-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-685-3" name="__codelineno-685-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-685-4" name="__codelineno-685-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-685-5" name="__codelineno-685-5"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>联系<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-685-6" name="__codelineno-685-6"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/static/css/styles.css&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-685-7" name="__codelineno-685-7"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-685-8" name="__codelineno-685-8"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-685-9" name="__codelineno-685-9"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>联系我们<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-685-10" name="__codelineno-685-10"></a>    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-685-11" name="__codelineno-685-11"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">&gt;</span>首页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-685-12" name="__codelineno-685-12"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/about&quot;</span><span class="p">&gt;</span>关于<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-685-13" name="__codelineno-685-13"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/contact&quot;</span><span class="p">&gt;</span>联系<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-685-14" name="__codelineno-685-14"></a>    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-685-15" name="__codelineno-685-15"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>这是联系页面的内容。<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-685-16" name="__codelineno-685-16"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-685-17" name="__codelineno-685-17"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<h4 id="4-添加样式表">4. 添加样式表<a class="headerlink" href="#4-添加样式表" title="Permanent link">&para;</a></h4>
<p>创建<code>static/css</code>目录，并在其中添加<code>styles.css</code>文件，用于美化页面。</p>
<p><strong>static/css/styles.css</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CSS</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-686-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-686-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-686-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-686-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-686-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-686-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-686-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-686-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-686-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-686-10">10</a></span>
<span class="normal"><a href="#__codelineno-686-11">11</a></span>
<span class="normal"><a href="#__codelineno-686-12">12</a></span>
<span class="normal"><a href="#__codelineno-686-13">13</a></span>
<span class="normal"><a href="#__codelineno-686-14">14</a></span>
<span class="normal"><a href="#__codelineno-686-15">15</a></span>
<span class="normal"><a href="#__codelineno-686-16">16</a></span>
<span class="normal"><a href="#__codelineno-686-17">17</a></span>
<span class="normal"><a href="#__codelineno-686-18">18</a></span>
<span class="normal"><a href="#__codelineno-686-19">19</a></span>
<span class="normal"><a href="#__codelineno-686-20">20</a></span>
<span class="normal"><a href="#__codelineno-686-21">21</a></span>
<span class="normal"><a href="#__codelineno-686-22">22</a></span>
<span class="normal"><a href="#__codelineno-686-23">23</a></span>
<span class="normal"><a href="#__codelineno-686-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-686-1" name="__codelineno-686-1"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-686-2" name="__codelineno-686-2"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="n">Arial</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<a id="__codelineno-686-3" name="__codelineno-686-3"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-686-4" name="__codelineno-686-4"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-686-5" name="__codelineno-686-5"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f4f4f4</span><span class="p">;</span>
<a id="__codelineno-686-6" name="__codelineno-686-6"></a><span class="p">}</span>
<a id="__codelineno-686-7" name="__codelineno-686-7"></a>
<a id="__codelineno-686-8" name="__codelineno-686-8"></a><span class="nt">h1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-686-9" name="__codelineno-686-9"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#333</span><span class="p">;</span>
<a id="__codelineno-686-10" name="__codelineno-686-10"></a><span class="p">}</span>
<a id="__codelineno-686-11" name="__codelineno-686-11"></a>
<a id="__codelineno-686-12" name="__codelineno-686-12"></a><span class="nt">nav</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-686-13" name="__codelineno-686-13"></a><span class="w">    </span><span class="k">margin-right</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-686-14" name="__codelineno-686-14"></a><span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<a id="__codelineno-686-15" name="__codelineno-686-15"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#007BFF</span><span class="p">;</span>
<a id="__codelineno-686-16" name="__codelineno-686-16"></a><span class="p">}</span>
<a id="__codelineno-686-17" name="__codelineno-686-17"></a>
<a id="__codelineno-686-18" name="__codelineno-686-18"></a><span class="nt">nav</span><span class="w"> </span><span class="nt">a</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-686-19" name="__codelineno-686-19"></a><span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">underline</span><span class="p">;</span>
<a id="__codelineno-686-20" name="__codelineno-686-20"></a><span class="p">}</span>
<a id="__codelineno-686-21" name="__codelineno-686-21"></a>
<a id="__codelineno-686-22" name="__codelineno-686-22"></a><span class="nt">p</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-686-23" name="__codelineno-686-23"></a><span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="kt">em</span><span class="p">;</span>
<a id="__codelineno-686-24" name="__codelineno-686-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="5-编写-go-代码">5. 编写 Go 代码<a class="headerlink" href="#5-编写-go-代码" title="Permanent link">&para;</a></h4>
<p>创建<code>main.go</code>文件，实现Web服务器的逻辑。</p>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-687-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-687-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-687-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-687-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-687-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-687-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-687-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-687-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-687-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-687-10">10</a></span>
<span class="normal"><a href="#__codelineno-687-11">11</a></span>
<span class="normal"><a href="#__codelineno-687-12">12</a></span>
<span class="normal"><a href="#__codelineno-687-13">13</a></span>
<span class="normal"><a href="#__codelineno-687-14">14</a></span>
<span class="normal"><a href="#__codelineno-687-15">15</a></span>
<span class="normal"><a href="#__codelineno-687-16">16</a></span>
<span class="normal"><a href="#__codelineno-687-17">17</a></span>
<span class="normal"><a href="#__codelineno-687-18">18</a></span>
<span class="normal"><a href="#__codelineno-687-19">19</a></span>
<span class="normal"><a href="#__codelineno-687-20">20</a></span>
<span class="normal"><a href="#__codelineno-687-21">21</a></span>
<span class="normal"><a href="#__codelineno-687-22">22</a></span>
<span class="normal"><a href="#__codelineno-687-23">23</a></span>
<span class="normal"><a href="#__codelineno-687-24">24</a></span>
<span class="normal"><a href="#__codelineno-687-25">25</a></span>
<span class="normal"><a href="#__codelineno-687-26">26</a></span>
<span class="normal"><a href="#__codelineno-687-27">27</a></span>
<span class="normal"><a href="#__codelineno-687-28">28</a></span>
<span class="normal"><a href="#__codelineno-687-29">29</a></span>
<span class="normal"><a href="#__codelineno-687-30">30</a></span>
<span class="normal"><a href="#__codelineno-687-31">31</a></span>
<span class="normal"><a href="#__codelineno-687-32">32</a></span>
<span class="normal"><a href="#__codelineno-687-33">33</a></span>
<span class="normal"><a href="#__codelineno-687-34">34</a></span>
<span class="normal"><a href="#__codelineno-687-35">35</a></span>
<span class="normal"><a href="#__codelineno-687-36">36</a></span>
<span class="normal"><a href="#__codelineno-687-37">37</a></span>
<span class="normal"><a href="#__codelineno-687-38">38</a></span>
<span class="normal"><a href="#__codelineno-687-39">39</a></span>
<span class="normal"><a href="#__codelineno-687-40">40</a></span>
<span class="normal"><a href="#__codelineno-687-41">41</a></span>
<span class="normal"><a href="#__codelineno-687-42">42</a></span>
<span class="normal"><a href="#__codelineno-687-43">43</a></span>
<span class="normal"><a href="#__codelineno-687-44">44</a></span>
<span class="normal"><a href="#__codelineno-687-45">45</a></span>
<span class="normal"><a href="#__codelineno-687-46">46</a></span>
<span class="normal"><a href="#__codelineno-687-47">47</a></span>
<span class="normal"><a href="#__codelineno-687-48">48</a></span>
<span class="normal"><a href="#__codelineno-687-49">49</a></span>
<span class="normal"><a href="#__codelineno-687-50">50</a></span>
<span class="normal"><a href="#__codelineno-687-51">51</a></span>
<span class="normal"><a href="#__codelineno-687-52">52</a></span>
<span class="normal"><a href="#__codelineno-687-53">53</a></span>
<span class="normal"><a href="#__codelineno-687-54">54</a></span>
<span class="normal"><a href="#__codelineno-687-55">55</a></span>
<span class="normal"><a href="#__codelineno-687-56">56</a></span>
<span class="normal"><a href="#__codelineno-687-57">57</a></span>
<span class="normal"><a href="#__codelineno-687-58">58</a></span>
<span class="normal"><a href="#__codelineno-687-59">59</a></span>
<span class="normal"><a href="#__codelineno-687-60">60</a></span>
<span class="normal"><a href="#__codelineno-687-61">61</a></span>
<span class="normal"><a href="#__codelineno-687-62">62</a></span>
<span class="normal"><a href="#__codelineno-687-63">63</a></span>
<span class="normal"><a href="#__codelineno-687-64">64</a></span>
<span class="normal"><a href="#__codelineno-687-65">65</a></span>
<span class="normal"><a href="#__codelineno-687-66">66</a></span>
<span class="normal"><a href="#__codelineno-687-67">67</a></span>
<span class="normal"><a href="#__codelineno-687-68">68</a></span>
<span class="normal"><a href="#__codelineno-687-69">69</a></span>
<span class="normal"><a href="#__codelineno-687-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-687-1" name="__codelineno-687-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-687-2" name="__codelineno-687-2"></a>
<a id="__codelineno-687-3" name="__codelineno-687-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-687-4" name="__codelineno-687-4"></a><span class="w">    </span><span class="s">&quot;html/template&quot;</span>
<a id="__codelineno-687-5" name="__codelineno-687-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-687-6" name="__codelineno-687-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-687-7" name="__codelineno-687-7"></a><span class="w">    </span><span class="s">&quot;path/filepath&quot;</span>
<a id="__codelineno-687-8" name="__codelineno-687-8"></a><span class="p">)</span>
<a id="__codelineno-687-9" name="__codelineno-687-9"></a>
<a id="__codelineno-687-10" name="__codelineno-687-10"></a><span class="c1">// 定义一个模板缓存</span>
<a id="__codelineno-687-11" name="__codelineno-687-11"></a><span class="kd">var</span><span class="w"> </span><span class="nx">templates</span><span class="w"> </span><span class="o">*</span><span class="nx">template</span><span class="p">.</span><span class="nx">Template</span>
<a id="__codelineno-687-12" name="__codelineno-687-12"></a>
<a id="__codelineno-687-13" name="__codelineno-687-13"></a><span class="c1">// 初始化模板</span>
<a id="__codelineno-687-14" name="__codelineno-687-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">initTemplates</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-15" name="__codelineno-687-15"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-687-16" name="__codelineno-687-16"></a><span class="w">    </span><span class="c1">// 解析所有模板文件</span>
<a id="__codelineno-687-17" name="__codelineno-687-17"></a><span class="w">    </span><span class="nx">templates</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">ParseGlob</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="s">&quot;templates&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*.html&quot;</span><span class="p">))</span>
<a id="__codelineno-687-18" name="__codelineno-687-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-19" name="__codelineno-687-19"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;解析模板失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-687-20" name="__codelineno-687-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-687-21" name="__codelineno-687-21"></a><span class="p">}</span>
<a id="__codelineno-687-22" name="__codelineno-687-22"></a>
<a id="__codelineno-687-23" name="__codelineno-687-23"></a><span class="c1">// 渲染模板</span>
<a id="__codelineno-687-24" name="__codelineno-687-24"></a><span class="kd">func</span><span class="w"> </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">tmpl</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-25" name="__codelineno-687-25"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">templates</span><span class="p">.</span><span class="nx">ExecuteTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">tmpl</span><span class="o">+</span><span class="s">&quot;.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-687-26" name="__codelineno-687-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-27" name="__codelineno-687-27"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<a id="__codelineno-687-28" name="__codelineno-687-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-687-29" name="__codelineno-687-29"></a><span class="p">}</span>
<a id="__codelineno-687-30" name="__codelineno-687-30"></a>
<a id="__codelineno-687-31" name="__codelineno-687-31"></a><span class="c1">// 处理主页请求</span>
<a id="__codelineno-687-32" name="__codelineno-687-32"></a><span class="kd">func</span><span class="w"> </span><span class="nx">indexHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-33" name="__codelineno-687-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-34" name="__codelineno-687-34"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">NotFound</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-687-35" name="__codelineno-687-35"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-687-36" name="__codelineno-687-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-687-37" name="__codelineno-687-37"></a><span class="w">    </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;index&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-687-38" name="__codelineno-687-38"></a><span class="p">}</span>
<a id="__codelineno-687-39" name="__codelineno-687-39"></a>
<a id="__codelineno-687-40" name="__codelineno-687-40"></a><span class="c1">// 处理关于页面请求</span>
<a id="__codelineno-687-41" name="__codelineno-687-41"></a><span class="kd">func</span><span class="w"> </span><span class="nx">aboutHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-42" name="__codelineno-687-42"></a><span class="w">    </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;about&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-687-43" name="__codelineno-687-43"></a><span class="p">}</span>
<a id="__codelineno-687-44" name="__codelineno-687-44"></a>
<a id="__codelineno-687-45" name="__codelineno-687-45"></a><span class="c1">// 处理联系页面请求</span>
<a id="__codelineno-687-46" name="__codelineno-687-46"></a><span class="kd">func</span><span class="w"> </span><span class="nx">contactHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-47" name="__codelineno-687-47"></a><span class="w">    </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;contact&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-687-48" name="__codelineno-687-48"></a><span class="p">}</span>
<a id="__codelineno-687-49" name="__codelineno-687-49"></a>
<a id="__codelineno-687-50" name="__codelineno-687-50"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-51" name="__codelineno-687-51"></a><span class="w">    </span><span class="c1">// 初始化模板</span>
<a id="__codelineno-687-52" name="__codelineno-687-52"></a><span class="w">    </span><span class="nx">initTemplates</span><span class="p">()</span>
<a id="__codelineno-687-53" name="__codelineno-687-53"></a>
<a id="__codelineno-687-54" name="__codelineno-687-54"></a><span class="w">    </span><span class="c1">// 设置路由</span>
<a id="__codelineno-687-55" name="__codelineno-687-55"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">indexHandler</span><span class="p">)</span>
<a id="__codelineno-687-56" name="__codelineno-687-56"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/about&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">aboutHandler</span><span class="p">)</span>
<a id="__codelineno-687-57" name="__codelineno-687-57"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/contact&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">contactHandler</span><span class="p">)</span>
<a id="__codelineno-687-58" name="__codelineno-687-58"></a>
<a id="__codelineno-687-59" name="__codelineno-687-59"></a><span class="w">    </span><span class="c1">// 提供静态文件服务</span>
<a id="__codelineno-687-60" name="__codelineno-687-60"></a><span class="w">    </span><span class="nx">fs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;static&quot;</span><span class="p">))</span>
<a id="__codelineno-687-61" name="__codelineno-687-61"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StripPrefix</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">))</span>
<a id="__codelineno-687-62" name="__codelineno-687-62"></a>
<a id="__codelineno-687-63" name="__codelineno-687-63"></a><span class="w">    </span><span class="c1">// 启动服务器</span>
<a id="__codelineno-687-64" name="__codelineno-687-64"></a><span class="w">    </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:8080&quot;</span>
<a id="__codelineno-687-65" name="__codelineno-687-65"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;服务器启动在 http://localhost%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>
<a id="__codelineno-687-66" name="__codelineno-687-66"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-687-67" name="__codelineno-687-67"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-687-68" name="__codelineno-687-68"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;服务器启动失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-687-69" name="__codelineno-687-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-687-70" name="__codelineno-687-70"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="6-运行应用程序">6. 运行应用程序<a class="headerlink" href="#6-运行应用程序" title="Permanent link">&para;</a></h4>
<p>确保项目目录结构正确，然后在终端中导航到<code>simple-web-app</code>目录，运行以下命令启动服务器：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-688-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-688-1" name="__codelineno-688-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-689-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-689-1" name="__codelineno-689-1"></a>2024/04/27 12:00:00 服务器启动在 http://localhost:8080
</code></pre></div></td></tr></table></div>
<p>打开浏览器，访问<code>http://localhost:8080/</code>，你将看到主页内容。分别访问<code>/about</code>和<code>/contact</code>路径，查看对应页面。</p>
<h4 id="7-代码解析">7. 代码解析<a class="headerlink" href="#7-代码解析" title="Permanent link">&para;</a></h4>
<ul>
<li>模板解析</li>
</ul>
<p>：</p>
<ul>
<li>
<p>使用<code>template.ParseGlob</code>解析<code>templates</code>目录下的所有HTML文件，并将其缓存到<code>templates</code>变量中，避免每次请求都重新解析。</p>
</li>
<li>
<p>路由处理</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>http.HandleFunc</code>用于注册路由和对应的处理函数。</li>
<li>
<p><code>indexHandler</code>处理根路径<code>/</code>的请求，检查路径是否精确匹配，避免模糊匹配导致的404错误。</p>
</li>
<li>
<p>静态文件服务</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>http.FileServer</code>提供静态文件服务，将<code>static</code>目录下的文件通过<code>/static/</code>路径访问。</li>
<li>
<p><code>http.StripPrefix</code>用于去除URL路径中的<code>/static/</code>前缀，使文件路径正确匹配。</p>
</li>
<li>
<p>错误处理</p>
</li>
</ul>
<p>：</p>
<ul>
<li>在模板渲染失败时，使用<code>http.Error</code>返回500内部服务器错误。</li>
<li>在服务器启动失败时，使用<code>log.Fatalf</code>记录错误并退出程序。</li>
</ul>
<h4 id="8-扩展功能">8. 扩展功能<a class="headerlink" href="#8-扩展功能" title="Permanent link">&para;</a></h4>
<p>为了提升应用的功能性，可以添加以下扩展：</p>
<ul>
<li><strong>动态内容</strong>：在模板中展示动态数据，如从数据库获取的用户信息。</li>
<li><strong>表单处理</strong>：在联系页面添加表单，处理用户提交的数据。</li>
<li><strong>中间件</strong>：实现日志记录、认证等中间件，增强服务器功能。</li>
</ul>
<h3 id="152-restful-api-开发">15.2 RESTful API 开发<a class="headerlink" href="#152-restful-api-开发" title="Permanent link">&para;</a></h3>
<p>构建RESTful API是现代Web应用的重要组成部分。Go语言凭借其高性能和简洁的语法，成为开发高效API的理想选择。本节将指导你使用Go构建一个简单的RESTful API，涵盖用户资源的CRUD（创建、读取、更新、删除）操作。</p>
<h4 id="1-项目概述_1">1. 项目概述<a class="headerlink" href="#1-项目概述_1" title="Permanent link">&para;</a></h4>
<p>本项目将实现一个用户管理API，支持以下功能：</p>
<ul>
<li><strong>创建用户</strong>：POST <code>/users</code></li>
<li><strong>获取用户列表</strong>：GET <code>/users</code></li>
<li><strong>获取单个用户</strong>：GET <code>/users/{id}</code></li>
<li><strong>更新用户</strong>：PUT <code>/users/{id}</code></li>
<li><strong>删除用户</strong>：DELETE <code>/users/{id}</code></li>
</ul>
<h4 id="2-项目结构_1">2. 项目结构<a class="headerlink" href="#2-项目结构_1" title="Permanent link">&para;</a></h4>
<p>建议的项目结构如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-690-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-690-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-690-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-690-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-690-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-690-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-690-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-690-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-690-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-690-10">10</a></span>
<span class="normal"><a href="#__codelineno-690-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-690-1" name="__codelineno-690-1"></a>restful-api/
<a id="__codelineno-690-2" name="__codelineno-690-2"></a>├── main.go
<a id="__codelineno-690-3" name="__codelineno-690-3"></a>├── models/
<a id="__codelineno-690-4" name="__codelineno-690-4"></a>│   └── user.go
<a id="__codelineno-690-5" name="__codelineno-690-5"></a>├── handlers/
<a id="__codelineno-690-6" name="__codelineno-690-6"></a>│   └── user_handler.go
<a id="__codelineno-690-7" name="__codelineno-690-7"></a>├── routers/
<a id="__codelineno-690-8" name="__codelineno-690-8"></a>│   └── router.go
<a id="__codelineno-690-9" name="__codelineno-690-9"></a>├── utils/
<a id="__codelineno-690-10" name="__codelineno-690-10"></a>│   └── response.go
<a id="__codelineno-690-11" name="__codelineno-690-11"></a>└── go.mod
</code></pre></div></td></tr></table></div>
<h4 id="3-初始化项目">3. 初始化项目<a class="headerlink" href="#3-初始化项目" title="Permanent link">&para;</a></h4>
<p>首先，创建项目目录并初始化Go模块。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-691-1">1</a></span>
<span class="normal"><a href="#__codelineno-691-2">2</a></span>
<span class="normal"><a href="#__codelineno-691-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-691-1" name="__codelineno-691-1"></a>mkdir<span class="w"> </span>restful-api
<a id="__codelineno-691-2" name="__codelineno-691-2"></a><span class="nb">cd</span><span class="w"> </span>restful-api
<a id="__codelineno-691-3" name="__codelineno-691-3"></a>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>github.com/username/restful-api
</code></pre></div></td></tr></table></div>
<h4 id="4-定义用户模型">4. 定义用户模型<a class="headerlink" href="#4-定义用户模型" title="Permanent link">&para;</a></h4>
<p>在<code>models</code>目录下创建<code>user.go</code>文件，定义用户数据结构和存储逻辑。</p>
<p><strong>models/user.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-692-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-692-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-692-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-692-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-692-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-692-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-692-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-692-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-692-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-692-10">10</a></span>
<span class="normal"><a href="#__codelineno-692-11">11</a></span>
<span class="normal"><a href="#__codelineno-692-12">12</a></span>
<span class="normal"><a href="#__codelineno-692-13">13</a></span>
<span class="normal"><a href="#__codelineno-692-14">14</a></span>
<span class="normal"><a href="#__codelineno-692-15">15</a></span>
<span class="normal"><a href="#__codelineno-692-16">16</a></span>
<span class="normal"><a href="#__codelineno-692-17">17</a></span>
<span class="normal"><a href="#__codelineno-692-18">18</a></span>
<span class="normal"><a href="#__codelineno-692-19">19</a></span>
<span class="normal"><a href="#__codelineno-692-20">20</a></span>
<span class="normal"><a href="#__codelineno-692-21">21</a></span>
<span class="normal"><a href="#__codelineno-692-22">22</a></span>
<span class="normal"><a href="#__codelineno-692-23">23</a></span>
<span class="normal"><a href="#__codelineno-692-24">24</a></span>
<span class="normal"><a href="#__codelineno-692-25">25</a></span>
<span class="normal"><a href="#__codelineno-692-26">26</a></span>
<span class="normal"><a href="#__codelineno-692-27">27</a></span>
<span class="normal"><a href="#__codelineno-692-28">28</a></span>
<span class="normal"><a href="#__codelineno-692-29">29</a></span>
<span class="normal"><a href="#__codelineno-692-30">30</a></span>
<span class="normal"><a href="#__codelineno-692-31">31</a></span>
<span class="normal"><a href="#__codelineno-692-32">32</a></span>
<span class="normal"><a href="#__codelineno-692-33">33</a></span>
<span class="normal"><a href="#__codelineno-692-34">34</a></span>
<span class="normal"><a href="#__codelineno-692-35">35</a></span>
<span class="normal"><a href="#__codelineno-692-36">36</a></span>
<span class="normal"><a href="#__codelineno-692-37">37</a></span>
<span class="normal"><a href="#__codelineno-692-38">38</a></span>
<span class="normal"><a href="#__codelineno-692-39">39</a></span>
<span class="normal"><a href="#__codelineno-692-40">40</a></span>
<span class="normal"><a href="#__codelineno-692-41">41</a></span>
<span class="normal"><a href="#__codelineno-692-42">42</a></span>
<span class="normal"><a href="#__codelineno-692-43">43</a></span>
<span class="normal"><a href="#__codelineno-692-44">44</a></span>
<span class="normal"><a href="#__codelineno-692-45">45</a></span>
<span class="normal"><a href="#__codelineno-692-46">46</a></span>
<span class="normal"><a href="#__codelineno-692-47">47</a></span>
<span class="normal"><a href="#__codelineno-692-48">48</a></span>
<span class="normal"><a href="#__codelineno-692-49">49</a></span>
<span class="normal"><a href="#__codelineno-692-50">50</a></span>
<span class="normal"><a href="#__codelineno-692-51">51</a></span>
<span class="normal"><a href="#__codelineno-692-52">52</a></span>
<span class="normal"><a href="#__codelineno-692-53">53</a></span>
<span class="normal"><a href="#__codelineno-692-54">54</a></span>
<span class="normal"><a href="#__codelineno-692-55">55</a></span>
<span class="normal"><a href="#__codelineno-692-56">56</a></span>
<span class="normal"><a href="#__codelineno-692-57">57</a></span>
<span class="normal"><a href="#__codelineno-692-58">58</a></span>
<span class="normal"><a href="#__codelineno-692-59">59</a></span>
<span class="normal"><a href="#__codelineno-692-60">60</a></span>
<span class="normal"><a href="#__codelineno-692-61">61</a></span>
<span class="normal"><a href="#__codelineno-692-62">62</a></span>
<span class="normal"><a href="#__codelineno-692-63">63</a></span>
<span class="normal"><a href="#__codelineno-692-64">64</a></span>
<span class="normal"><a href="#__codelineno-692-65">65</a></span>
<span class="normal"><a href="#__codelineno-692-66">66</a></span>
<span class="normal"><a href="#__codelineno-692-67">67</a></span>
<span class="normal"><a href="#__codelineno-692-68">68</a></span>
<span class="normal"><a href="#__codelineno-692-69">69</a></span>
<span class="normal"><a href="#__codelineno-692-70">70</a></span>
<span class="normal"><a href="#__codelineno-692-71">71</a></span>
<span class="normal"><a href="#__codelineno-692-72">72</a></span>
<span class="normal"><a href="#__codelineno-692-73">73</a></span>
<span class="normal"><a href="#__codelineno-692-74">74</a></span>
<span class="normal"><a href="#__codelineno-692-75">75</a></span>
<span class="normal"><a href="#__codelineno-692-76">76</a></span>
<span class="normal"><a href="#__codelineno-692-77">77</a></span>
<span class="normal"><a href="#__codelineno-692-78">78</a></span>
<span class="normal"><a href="#__codelineno-692-79">79</a></span>
<span class="normal"><a href="#__codelineno-692-80">80</a></span>
<span class="normal"><a href="#__codelineno-692-81">81</a></span>
<span class="normal"><a href="#__codelineno-692-82">82</a></span>
<span class="normal"><a href="#__codelineno-692-83">83</a></span>
<span class="normal"><a href="#__codelineno-692-84">84</a></span>
<span class="normal"><a href="#__codelineno-692-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-692-1" name="__codelineno-692-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">models</span>
<a id="__codelineno-692-2" name="__codelineno-692-2"></a>
<a id="__codelineno-692-3" name="__codelineno-692-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-692-4" name="__codelineno-692-4"></a><span class="w">    </span><span class="s">&quot;errors&quot;</span>
<a id="__codelineno-692-5" name="__codelineno-692-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-692-6" name="__codelineno-692-6"></a><span class="p">)</span>
<a id="__codelineno-692-7" name="__codelineno-692-7"></a>
<a id="__codelineno-692-8" name="__codelineno-692-8"></a><span class="c1">// User 定义用户结构体</span>
<a id="__codelineno-692-9" name="__codelineno-692-9"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-10" name="__codelineno-692-10"></a><span class="w">    </span><span class="nx">ID</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;id&quot;`</span>
<a id="__codelineno-692-11" name="__codelineno-692-11"></a><span class="w">    </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<a id="__codelineno-692-12" name="__codelineno-692-12"></a><span class="w">    </span><span class="nx">Email</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;email&quot;`</span>
<a id="__codelineno-692-13" name="__codelineno-692-13"></a><span class="p">}</span>
<a id="__codelineno-692-14" name="__codelineno-692-14"></a>
<a id="__codelineno-692-15" name="__codelineno-692-15"></a><span class="c1">// UserStore 定义用户存储接口</span>
<a id="__codelineno-692-16" name="__codelineno-692-16"></a><span class="kd">type</span><span class="w"> </span><span class="nx">UserStore</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-17" name="__codelineno-692-17"></a><span class="w">    </span><span class="nx">users</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="nx">User</span>
<a id="__codelineno-692-18" name="__codelineno-692-18"></a><span class="w">    </span><span class="nx">mu</span><span class="w">     </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-692-19" name="__codelineno-692-19"></a><span class="w">    </span><span class="nx">nextID</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-692-20" name="__codelineno-692-20"></a><span class="p">}</span>
<a id="__codelineno-692-21" name="__codelineno-692-21"></a>
<a id="__codelineno-692-22" name="__codelineno-692-22"></a><span class="c1">// NewUserStore 创建一个新的用户存储</span>
<a id="__codelineno-692-23" name="__codelineno-692-23"></a><span class="kd">func</span><span class="w"> </span><span class="nx">NewUserStore</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">UserStore</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-24" name="__codelineno-692-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">UserStore</span><span class="p">{</span>
<a id="__codelineno-692-25" name="__codelineno-692-25"></a><span class="w">        </span><span class="nx">users</span><span class="p">:</span><span class="w">  </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="nx">User</span><span class="p">),</span>
<a id="__codelineno-692-26" name="__codelineno-692-26"></a><span class="w">        </span><span class="nx">nextID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-692-27" name="__codelineno-692-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-692-28" name="__codelineno-692-28"></a><span class="p">}</span>
<a id="__codelineno-692-29" name="__codelineno-692-29"></a>
<a id="__codelineno-692-30" name="__codelineno-692-30"></a><span class="c1">// CreateUser 创建新用户</span>
<a id="__codelineno-692-31" name="__codelineno-692-31"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">UserStore</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateUser</span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-32" name="__codelineno-692-32"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-692-33" name="__codelineno-692-33"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-692-34" name="__codelineno-692-34"></a><span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">nextID</span>
<a id="__codelineno-692-35" name="__codelineno-692-35"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">nextID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span>
<a id="__codelineno-692-36" name="__codelineno-692-36"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">nextID</span><span class="o">++</span>
<a id="__codelineno-692-37" name="__codelineno-692-37"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span>
<a id="__codelineno-692-38" name="__codelineno-692-38"></a><span class="p">}</span>
<a id="__codelineno-692-39" name="__codelineno-692-39"></a>
<a id="__codelineno-692-40" name="__codelineno-692-40"></a><span class="c1">// GetAllUsers 获取所有用户</span>
<a id="__codelineno-692-41" name="__codelineno-692-41"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">UserStore</span><span class="p">)</span><span class="w"> </span><span class="nx">GetAllUsers</span><span class="p">()</span><span class="w"> </span><span class="p">[]</span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-42" name="__codelineno-692-42"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-692-43" name="__codelineno-692-43"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-692-44" name="__codelineno-692-44"></a><span class="w">    </span><span class="nx">users</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="p">))</span>
<a id="__codelineno-692-45" name="__codelineno-692-45"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-46" name="__codelineno-692-46"></a><span class="w">        </span><span class="nx">users</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-692-47" name="__codelineno-692-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-692-48" name="__codelineno-692-48"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">users</span>
<a id="__codelineno-692-49" name="__codelineno-692-49"></a><span class="p">}</span>
<a id="__codelineno-692-50" name="__codelineno-692-50"></a>
<a id="__codelineno-692-51" name="__codelineno-692-51"></a><span class="c1">// GetUserByID 根据ID获取用户</span>
<a id="__codelineno-692-52" name="__codelineno-692-52"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">UserStore</span><span class="p">)</span><span class="w"> </span><span class="nx">GetUserByID</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-53" name="__codelineno-692-53"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-692-54" name="__codelineno-692-54"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-692-55" name="__codelineno-692-55"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>
<a id="__codelineno-692-56" name="__codelineno-692-56"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-57" name="__codelineno-692-57"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">User</span><span class="p">{},</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;用户不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-692-58" name="__codelineno-692-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-692-59" name="__codelineno-692-59"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-692-60" name="__codelineno-692-60"></a><span class="p">}</span>
<a id="__codelineno-692-61" name="__codelineno-692-61"></a>
<a id="__codelineno-692-62" name="__codelineno-692-62"></a><span class="c1">// UpdateUser 更新用户信息</span>
<a id="__codelineno-692-63" name="__codelineno-692-63"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">UserStore</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateUser</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">updated</span><span class="w"> </span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-64" name="__codelineno-692-64"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-692-65" name="__codelineno-692-65"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-692-66" name="__codelineno-692-66"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>
<a id="__codelineno-692-67" name="__codelineno-692-67"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-68" name="__codelineno-692-68"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">User</span><span class="p">{},</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;用户不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-692-69" name="__codelineno-692-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-692-70" name="__codelineno-692-70"></a><span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">updated</span><span class="p">.</span><span class="nx">Name</span>
<a id="__codelineno-692-71" name="__codelineno-692-71"></a><span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">Email</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">updated</span><span class="p">.</span><span class="nx">Email</span>
<a id="__codelineno-692-72" name="__codelineno-692-72"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span>
<a id="__codelineno-692-73" name="__codelineno-692-73"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-692-74" name="__codelineno-692-74"></a><span class="p">}</span>
<a id="__codelineno-692-75" name="__codelineno-692-75"></a>
<a id="__codelineno-692-76" name="__codelineno-692-76"></a><span class="c1">// DeleteUser 删除用户</span>
<a id="__codelineno-692-77" name="__codelineno-692-77"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">UserStore</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteUser</span><span class="p">(</span><span class="nx">id</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-78" name="__codelineno-692-78"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-692-79" name="__codelineno-692-79"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-692-80" name="__codelineno-692-80"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span><span class="w"> </span><span class="p">!</span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-692-81" name="__codelineno-692-81"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;用户不存在&quot;</span><span class="p">)</span>
<a id="__codelineno-692-82" name="__codelineno-692-82"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-692-83" name="__codelineno-692-83"></a><span class="w">    </span><span class="nb">delete</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-692-84" name="__codelineno-692-84"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-692-85" name="__codelineno-692-85"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>
<p><strong>User 结构体</strong>：定义用户的ID、姓名和邮箱。</p>
</li>
<li>
<p><strong>UserStore</strong>：使用一个线程安全的映射存储用户数据，并管理用户ID的自增。</p>
</li>
<li>
<p>CRUD 方法</p>
</li>
</ul>
<p>：</p>
<ul>
<li><code>CreateUser</code>：创建新用户并分配唯一ID。</li>
<li><code>GetAllUsers</code>：获取所有用户列表。</li>
<li><code>GetUserByID</code>：根据ID获取单个用户。</li>
<li><code>UpdateUser</code>：更新用户的姓名和邮箱。</li>
<li><code>DeleteUser</code>：删除用户。</li>
</ul>
<h4 id="5-定义响应工具">5. 定义响应工具<a class="headerlink" href="#5-定义响应工具" title="Permanent link">&para;</a></h4>
<p>在<code>utils</code>目录下创建<code>response.go</code>文件，定义统一的响应格式和帮助函数。</p>
<p><strong>utils/response.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-693-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-693-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-693-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-693-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-693-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-693-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-693-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-693-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-693-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-693-10">10</a></span>
<span class="normal"><a href="#__codelineno-693-11">11</a></span>
<span class="normal"><a href="#__codelineno-693-12">12</a></span>
<span class="normal"><a href="#__codelineno-693-13">13</a></span>
<span class="normal"><a href="#__codelineno-693-14">14</a></span>
<span class="normal"><a href="#__codelineno-693-15">15</a></span>
<span class="normal"><a href="#__codelineno-693-16">16</a></span>
<span class="normal"><a href="#__codelineno-693-17">17</a></span>
<span class="normal"><a href="#__codelineno-693-18">18</a></span>
<span class="normal"><a href="#__codelineno-693-19">19</a></span>
<span class="normal"><a href="#__codelineno-693-20">20</a></span>
<span class="normal"><a href="#__codelineno-693-21">21</a></span>
<span class="normal"><a href="#__codelineno-693-22">22</a></span>
<span class="normal"><a href="#__codelineno-693-23">23</a></span>
<span class="normal"><a href="#__codelineno-693-24">24</a></span>
<span class="normal"><a href="#__codelineno-693-25">25</a></span>
<span class="normal"><a href="#__codelineno-693-26">26</a></span>
<span class="normal"><a href="#__codelineno-693-27">27</a></span>
<span class="normal"><a href="#__codelineno-693-28">28</a></span>
<span class="normal"><a href="#__codelineno-693-29">29</a></span>
<span class="normal"><a href="#__codelineno-693-30">30</a></span>
<span class="normal"><a href="#__codelineno-693-31">31</a></span>
<span class="normal"><a href="#__codelineno-693-32">32</a></span>
<span class="normal"><a href="#__codelineno-693-33">33</a></span>
<span class="normal"><a href="#__codelineno-693-34">34</a></span>
<span class="normal"><a href="#__codelineno-693-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-693-1" name="__codelineno-693-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>
<a id="__codelineno-693-2" name="__codelineno-693-2"></a>
<a id="__codelineno-693-3" name="__codelineno-693-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-693-4" name="__codelineno-693-4"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-693-5" name="__codelineno-693-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-693-6" name="__codelineno-693-6"></a><span class="p">)</span>
<a id="__codelineno-693-7" name="__codelineno-693-7"></a>
<a id="__codelineno-693-8" name="__codelineno-693-8"></a><span class="c1">// Response 定义统一的响应结构</span>
<a id="__codelineno-693-9" name="__codelineno-693-9"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-693-10" name="__codelineno-693-10"></a><span class="w">    </span><span class="nx">Status</span><span class="w">  </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;status&quot;`</span>
<a id="__codelineno-693-11" name="__codelineno-693-11"></a><span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;message,omitempty&quot;`</span>
<a id="__codelineno-693-12" name="__codelineno-693-12"></a><span class="w">    </span><span class="nx">Data</span><span class="w">    </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;data,omitempty&quot;`</span>
<a id="__codelineno-693-13" name="__codelineno-693-13"></a><span class="p">}</span>
<a id="__codelineno-693-14" name="__codelineno-693-14"></a>
<a id="__codelineno-693-15" name="__codelineno-693-15"></a><span class="c1">// RespondWithJSON 发送JSON响应</span>
<a id="__codelineno-693-16" name="__codelineno-693-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-693-17" name="__codelineno-693-17"></a><span class="w">    </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
<a id="__codelineno-693-18" name="__codelineno-693-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-693-19" name="__codelineno-693-19"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<a id="__codelineno-693-20" name="__codelineno-693-20"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-693-21" name="__codelineno-693-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-693-22" name="__codelineno-693-22"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-693-23" name="__codelineno-693-23"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<a id="__codelineno-693-24" name="__codelineno-693-24"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<a id="__codelineno-693-25" name="__codelineno-693-25"></a><span class="p">}</span>
<a id="__codelineno-693-26" name="__codelineno-693-26"></a>
<a id="__codelineno-693-27" name="__codelineno-693-27"></a><span class="c1">// RespondWithError 发送错误响应</span>
<a id="__codelineno-693-28" name="__codelineno-693-28"></a><span class="kd">func</span><span class="w"> </span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-693-29" name="__codelineno-693-29"></a><span class="w">    </span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">Response</span><span class="p">{</span><span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="nx">message</span><span class="p">})</span>
<a id="__codelineno-693-30" name="__codelineno-693-30"></a><span class="p">}</span>
<a id="__codelineno-693-31" name="__codelineno-693-31"></a>
<a id="__codelineno-693-32" name="__codelineno-693-32"></a><span class="c1">// RespondWithSuccess 发送成功响应</span>
<a id="__codelineno-693-33" name="__codelineno-693-33"></a><span class="kd">func</span><span class="w"> </span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-693-34" name="__codelineno-693-34"></a><span class="w">    </span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">Response</span><span class="p">{</span><span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">})</span>
<a id="__codelineno-693-35" name="__codelineno-693-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>Response 结构体</strong>：统一的响应格式，包含状态、消息和数据字段。</li>
<li><strong>RespondWithJSON</strong>：将响应结构体编码为JSON并发送。</li>
<li><strong>RespondWithError</strong> 和 <strong>RespondWithSuccess</strong>：简化发送错误和成功响应的过程。</li>
</ul>
<h4 id="6-编写处理器">6. 编写处理器<a class="headerlink" href="#6-编写处理器" title="Permanent link">&para;</a></h4>
<p>在<code>handlers</code>目录下创建<code>user_handler.go</code>文件，定义用户相关的HTTP处理函数。</p>
<p><strong>handlers/user_handler.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-694-1">  1</a></span>
<span class="normal"><a href="#__codelineno-694-2">  2</a></span>
<span class="normal"><a href="#__codelineno-694-3">  3</a></span>
<span class="normal"><a href="#__codelineno-694-4">  4</a></span>
<span class="normal"><a href="#__codelineno-694-5">  5</a></span>
<span class="normal"><a href="#__codelineno-694-6">  6</a></span>
<span class="normal"><a href="#__codelineno-694-7">  7</a></span>
<span class="normal"><a href="#__codelineno-694-8">  8</a></span>
<span class="normal"><a href="#__codelineno-694-9">  9</a></span>
<span class="normal"><a href="#__codelineno-694-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-694-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-694-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-694-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-694-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-694-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-694-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-694-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-694-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-694-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-694-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-694-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-694-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-694-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-694-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-694-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-694-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-694-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-694-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-694-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-694-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-694-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-694-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-694-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-694-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-694-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-694-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-694-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-694-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-694-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-694-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-694-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-694-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-694-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-694-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-694-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-694-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-694-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-694-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-694-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-694-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-694-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-694-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-694-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-694-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-694-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-694-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-694-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-694-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-694-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-694-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-694-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-694-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-694-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-694-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-694-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-694-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-694-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-694-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-694-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-694-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-694-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-694-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-694-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-694-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-694-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-694-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-694-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-694-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-694-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-694-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-694-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-694-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-694-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-694-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-694-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-694-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-694-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-694-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-694-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-694-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-694-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-694-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-694-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-694-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-694-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-694-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-694-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-694-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-694-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-694-100">100</a></span>
<span class="normal"><a href="#__codelineno-694-101">101</a></span>
<span class="normal"><a href="#__codelineno-694-102">102</a></span>
<span class="normal"><a href="#__codelineno-694-103">103</a></span>
<span class="normal"><a href="#__codelineno-694-104">104</a></span>
<span class="normal"><a href="#__codelineno-694-105">105</a></span>
<span class="normal"><a href="#__codelineno-694-106">106</a></span>
<span class="normal"><a href="#__codelineno-694-107">107</a></span>
<span class="normal"><a href="#__codelineno-694-108">108</a></span>
<span class="normal"><a href="#__codelineno-694-109">109</a></span>
<span class="normal"><a href="#__codelineno-694-110">110</a></span>
<span class="normal"><a href="#__codelineno-694-111">111</a></span>
<span class="normal"><a href="#__codelineno-694-112">112</a></span>
<span class="normal"><a href="#__codelineno-694-113">113</a></span>
<span class="normal"><a href="#__codelineno-694-114">114</a></span>
<span class="normal"><a href="#__codelineno-694-115">115</a></span>
<span class="normal"><a href="#__codelineno-694-116">116</a></span>
<span class="normal"><a href="#__codelineno-694-117">117</a></span>
<span class="normal"><a href="#__codelineno-694-118">118</a></span>
<span class="normal"><a href="#__codelineno-694-119">119</a></span>
<span class="normal"><a href="#__codelineno-694-120">120</a></span>
<span class="normal"><a href="#__codelineno-694-121">121</a></span>
<span class="normal"><a href="#__codelineno-694-122">122</a></span>
<span class="normal"><a href="#__codelineno-694-123">123</a></span>
<span class="normal"><a href="#__codelineno-694-124">124</a></span>
<span class="normal"><a href="#__codelineno-694-125">125</a></span>
<span class="normal"><a href="#__codelineno-694-126">126</a></span>
<span class="normal"><a href="#__codelineno-694-127">127</a></span>
<span class="normal"><a href="#__codelineno-694-128">128</a></span>
<span class="normal"><a href="#__codelineno-694-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-694-1" name="__codelineno-694-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">handlers</span>
<a id="__codelineno-694-2" name="__codelineno-694-2"></a>
<a id="__codelineno-694-3" name="__codelineno-694-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-694-4" name="__codelineno-694-4"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-694-5" name="__codelineno-694-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-694-6" name="__codelineno-694-6"></a><span class="w">    </span><span class="s">&quot;strconv&quot;</span>
<a id="__codelineno-694-7" name="__codelineno-694-7"></a>
<a id="__codelineno-694-8" name="__codelineno-694-8"></a><span class="w">    </span><span class="s">&quot;github.com/gorilla/mux&quot;</span>
<a id="__codelineno-694-9" name="__codelineno-694-9"></a><span class="w">    </span><span class="s">&quot;github.com/username/restful-api/models&quot;</span>
<a id="__codelineno-694-10" name="__codelineno-694-10"></a><span class="w">    </span><span class="s">&quot;github.com/username/restful-api/utils&quot;</span>
<a id="__codelineno-694-11" name="__codelineno-694-11"></a><span class="p">)</span>
<a id="__codelineno-694-12" name="__codelineno-694-12"></a>
<a id="__codelineno-694-13" name="__codelineno-694-13"></a><span class="c1">// UserHandler 定义用户处理器结构体</span>
<a id="__codelineno-694-14" name="__codelineno-694-14"></a><span class="kd">type</span><span class="w"> </span><span class="nx">UserHandler</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-15" name="__codelineno-694-15"></a><span class="w">    </span><span class="nx">Store</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">UserStore</span>
<a id="__codelineno-694-16" name="__codelineno-694-16"></a><span class="p">}</span>
<a id="__codelineno-694-17" name="__codelineno-694-17"></a>
<a id="__codelineno-694-18" name="__codelineno-694-18"></a><span class="c1">// NewUserHandler 创建新的用户处理器</span>
<a id="__codelineno-694-19" name="__codelineno-694-19"></a><span class="kd">func</span><span class="w"> </span><span class="nx">NewUserHandler</span><span class="p">(</span><span class="nx">store</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">UserStore</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">UserHandler</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-20" name="__codelineno-694-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">UserHandler</span><span class="p">{</span><span class="nx">Store</span><span class="p">:</span><span class="w"> </span><span class="nx">store</span><span class="p">}</span>
<a id="__codelineno-694-21" name="__codelineno-694-21"></a><span class="p">}</span>
<a id="__codelineno-694-22" name="__codelineno-694-22"></a>
<a id="__codelineno-694-23" name="__codelineno-694-23"></a><span class="c1">// CreateUser 处理创建用户请求</span>
<a id="__codelineno-694-24" name="__codelineno-694-24"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">UserHandler</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateUser</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-25" name="__codelineno-694-25"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span>
<a id="__codelineno-694-26" name="__codelineno-694-26"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">).</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-694-27" name="__codelineno-694-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-28" name="__codelineno-694-28"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无效的请求体&quot;</span><span class="p">)</span>
<a id="__codelineno-694-29" name="__codelineno-694-29"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-30" name="__codelineno-694-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-31" name="__codelineno-694-31"></a>
<a id="__codelineno-694-32" name="__codelineno-694-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-33" name="__codelineno-694-33"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;姓名和邮箱不能为空&quot;</span><span class="p">)</span>
<a id="__codelineno-694-34" name="__codelineno-694-34"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-35" name="__codelineno-694-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-36" name="__codelineno-694-36"></a>
<a id="__codelineno-694-37" name="__codelineno-694-37"></a><span class="w">    </span><span class="nx">createdUser</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">Store</span><span class="p">.</span><span class="nx">CreateUser</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-694-38" name="__codelineno-694-38"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">,</span><span class="w"> </span><span class="nx">createdUser</span><span class="p">)</span>
<a id="__codelineno-694-39" name="__codelineno-694-39"></a><span class="p">}</span>
<a id="__codelineno-694-40" name="__codelineno-694-40"></a>
<a id="__codelineno-694-41" name="__codelineno-694-41"></a><span class="c1">// GetAllUsers 处理获取所有用户请求</span>
<a id="__codelineno-694-42" name="__codelineno-694-42"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">UserHandler</span><span class="p">)</span><span class="w"> </span><span class="nx">GetAllUsers</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-43" name="__codelineno-694-43"></a><span class="w">    </span><span class="nx">users</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">Store</span><span class="p">.</span><span class="nx">GetAllUsers</span><span class="p">()</span>
<a id="__codelineno-694-44" name="__codelineno-694-44"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">users</span><span class="p">)</span>
<a id="__codelineno-694-45" name="__codelineno-694-45"></a><span class="p">}</span>
<a id="__codelineno-694-46" name="__codelineno-694-46"></a>
<a id="__codelineno-694-47" name="__codelineno-694-47"></a><span class="c1">// GetUserByID 处理根据ID获取用户请求</span>
<a id="__codelineno-694-48" name="__codelineno-694-48"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">UserHandler</span><span class="p">)</span><span class="w"> </span><span class="nx">GetUserByID</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-49" name="__codelineno-694-49"></a><span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-694-50" name="__codelineno-694-50"></a><span class="w">    </span><span class="nx">idStr</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
<a id="__codelineno-694-51" name="__codelineno-694-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-52" name="__codelineno-694-52"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;缺少用户ID&quot;</span><span class="p">)</span>
<a id="__codelineno-694-53" name="__codelineno-694-53"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-54" name="__codelineno-694-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-55" name="__codelineno-694-55"></a>
<a id="__codelineno-694-56" name="__codelineno-694-56"></a><span class="w">    </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">idStr</span><span class="p">)</span>
<a id="__codelineno-694-57" name="__codelineno-694-57"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-58" name="__codelineno-694-58"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无效的用户ID&quot;</span><span class="p">)</span>
<a id="__codelineno-694-59" name="__codelineno-694-59"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-60" name="__codelineno-694-60"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-61" name="__codelineno-694-61"></a>
<a id="__codelineno-694-62" name="__codelineno-694-62"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">Store</span><span class="p">.</span><span class="nx">GetUserByID</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-694-63" name="__codelineno-694-63"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-64" name="__codelineno-694-64"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<a id="__codelineno-694-65" name="__codelineno-694-65"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-66" name="__codelineno-694-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-67" name="__codelineno-694-67"></a>
<a id="__codelineno-694-68" name="__codelineno-694-68"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-694-69" name="__codelineno-694-69"></a><span class="p">}</span>
<a id="__codelineno-694-70" name="__codelineno-694-70"></a>
<a id="__codelineno-694-71" name="__codelineno-694-71"></a><span class="c1">// UpdateUser 处理更新用户请求</span>
<a id="__codelineno-694-72" name="__codelineno-694-72"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">UserHandler</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateUser</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-73" name="__codelineno-694-73"></a><span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-694-74" name="__codelineno-694-74"></a><span class="w">    </span><span class="nx">idStr</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
<a id="__codelineno-694-75" name="__codelineno-694-75"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-76" name="__codelineno-694-76"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;缺少用户ID&quot;</span><span class="p">)</span>
<a id="__codelineno-694-77" name="__codelineno-694-77"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-78" name="__codelineno-694-78"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-79" name="__codelineno-694-79"></a>
<a id="__codelineno-694-80" name="__codelineno-694-80"></a><span class="w">    </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">idStr</span><span class="p">)</span>
<a id="__codelineno-694-81" name="__codelineno-694-81"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-82" name="__codelineno-694-82"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无效的用户ID&quot;</span><span class="p">)</span>
<a id="__codelineno-694-83" name="__codelineno-694-83"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-84" name="__codelineno-694-84"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-85" name="__codelineno-694-85"></a>
<a id="__codelineno-694-86" name="__codelineno-694-86"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">updatedUser</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span>
<a id="__codelineno-694-87" name="__codelineno-694-87"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">).</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">updatedUser</span><span class="p">)</span>
<a id="__codelineno-694-88" name="__codelineno-694-88"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-89" name="__codelineno-694-89"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无效的请求体&quot;</span><span class="p">)</span>
<a id="__codelineno-694-90" name="__codelineno-694-90"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-91" name="__codelineno-694-91"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-92" name="__codelineno-694-92"></a>
<a id="__codelineno-694-93" name="__codelineno-694-93"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">updatedUser</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">updatedUser</span><span class="p">.</span><span class="nx">Email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-94" name="__codelineno-694-94"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;姓名和邮箱不能为空&quot;</span><span class="p">)</span>
<a id="__codelineno-694-95" name="__codelineno-694-95"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-96" name="__codelineno-694-96"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-97" name="__codelineno-694-97"></a>
<a id="__codelineno-694-98" name="__codelineno-694-98"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">Store</span><span class="p">.</span><span class="nx">UpdateUser</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedUser</span><span class="p">)</span>
<a id="__codelineno-694-99" name="__codelineno-694-99"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-100" name="__codelineno-694-100"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<a id="__codelineno-694-101" name="__codelineno-694-101"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-102" name="__codelineno-694-102"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-103" name="__codelineno-694-103"></a>
<a id="__codelineno-694-104" name="__codelineno-694-104"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-694-105" name="__codelineno-694-105"></a><span class="p">}</span>
<a id="__codelineno-694-106" name="__codelineno-694-106"></a>
<a id="__codelineno-694-107" name="__codelineno-694-107"></a><span class="c1">// DeleteUser 处理删除用户请求</span>
<a id="__codelineno-694-108" name="__codelineno-694-108"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">h</span><span class="w"> </span><span class="o">*</span><span class="nx">UserHandler</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteUser</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-109" name="__codelineno-694-109"></a><span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-694-110" name="__codelineno-694-110"></a><span class="w">    </span><span class="nx">idStr</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
<a id="__codelineno-694-111" name="__codelineno-694-111"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-112" name="__codelineno-694-112"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;缺少用户ID&quot;</span><span class="p">)</span>
<a id="__codelineno-694-113" name="__codelineno-694-113"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-114" name="__codelineno-694-114"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-115" name="__codelineno-694-115"></a>
<a id="__codelineno-694-116" name="__codelineno-694-116"></a><span class="w">    </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">idStr</span><span class="p">)</span>
<a id="__codelineno-694-117" name="__codelineno-694-117"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-118" name="__codelineno-694-118"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无效的用户ID&quot;</span><span class="p">)</span>
<a id="__codelineno-694-119" name="__codelineno-694-119"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-120" name="__codelineno-694-120"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-121" name="__codelineno-694-121"></a>
<a id="__codelineno-694-122" name="__codelineno-694-122"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">h</span><span class="p">.</span><span class="nx">Store</span><span class="p">.</span><span class="nx">DeleteUser</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-694-123" name="__codelineno-694-123"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-694-124" name="__codelineno-694-124"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<a id="__codelineno-694-125" name="__codelineno-694-125"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-694-126" name="__codelineno-694-126"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-694-127" name="__codelineno-694-127"></a>
<a id="__codelineno-694-128" name="__codelineno-694-128"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;用户已删除&quot;</span><span class="p">)</span>
<a id="__codelineno-694-129" name="__codelineno-694-129"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>UserHandler</strong>：封装了用户存储，并定义了处理用户相关请求的方法。</li>
<li><strong>CreateUser</strong>：解析请求体中的用户数据，验证输入，创建新用户并返回。</li>
<li><strong>GetAllUsers</strong>：返回所有用户列表。</li>
<li><strong>GetUserByID</strong>：根据ID获取单个用户，处理ID解析和错误情况。</li>
<li><strong>UpdateUser</strong>：更新指定ID的用户信息，验证输入并处理错误。</li>
<li><strong>DeleteUser</strong>：删除指定ID的用户，处理错误情况。</li>
</ul>
<h4 id="7-配置路由">7. 配置路由<a class="headerlink" href="#7-配置路由" title="Permanent link">&para;</a></h4>
<p>在<code>routers</code>目录下创建<code>router.go</code>文件，定义API的路由和处理器。</p>
<p><strong>routers/router.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-695-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-695-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-695-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-695-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-695-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-695-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-695-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-695-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-695-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-695-10">10</a></span>
<span class="normal"><a href="#__codelineno-695-11">11</a></span>
<span class="normal"><a href="#__codelineno-695-12">12</a></span>
<span class="normal"><a href="#__codelineno-695-13">13</a></span>
<span class="normal"><a href="#__codelineno-695-14">14</a></span>
<span class="normal"><a href="#__codelineno-695-15">15</a></span>
<span class="normal"><a href="#__codelineno-695-16">16</a></span>
<span class="normal"><a href="#__codelineno-695-17">17</a></span>
<span class="normal"><a href="#__codelineno-695-18">18</a></span>
<span class="normal"><a href="#__codelineno-695-19">19</a></span>
<span class="normal"><a href="#__codelineno-695-20">20</a></span>
<span class="normal"><a href="#__codelineno-695-21">21</a></span>
<span class="normal"><a href="#__codelineno-695-22">22</a></span>
<span class="normal"><a href="#__codelineno-695-23">23</a></span>
<span class="normal"><a href="#__codelineno-695-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-695-1" name="__codelineno-695-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">routers</span>
<a id="__codelineno-695-2" name="__codelineno-695-2"></a>
<a id="__codelineno-695-3" name="__codelineno-695-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-695-4" name="__codelineno-695-4"></a><span class="w">    </span><span class="s">&quot;github.com/gorilla/mux&quot;</span>
<a id="__codelineno-695-5" name="__codelineno-695-5"></a><span class="w">    </span><span class="s">&quot;github.com/username/restful-api/handlers&quot;</span>
<a id="__codelineno-695-6" name="__codelineno-695-6"></a><span class="w">    </span><span class="s">&quot;github.com/username/restful-api/models&quot;</span>
<a id="__codelineno-695-7" name="__codelineno-695-7"></a><span class="p">)</span>
<a id="__codelineno-695-8" name="__codelineno-695-8"></a>
<a id="__codelineno-695-9" name="__codelineno-695-9"></a><span class="c1">// SetupRouter 配置路由</span>
<a id="__codelineno-695-10" name="__codelineno-695-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">SetupRouter</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-695-11" name="__codelineno-695-11"></a><span class="w">    </span><span class="nx">store</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">NewUserStore</span><span class="p">()</span>
<a id="__codelineno-695-12" name="__codelineno-695-12"></a><span class="w">    </span><span class="nx">userHandler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">NewUserHandler</span><span class="p">(</span><span class="nx">store</span><span class="p">)</span>
<a id="__codelineno-695-13" name="__codelineno-695-13"></a>
<a id="__codelineno-695-14" name="__codelineno-695-14"></a><span class="w">    </span><span class="nx">router</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">NewRouter</span><span class="p">()</span>
<a id="__codelineno-695-15" name="__codelineno-695-15"></a>
<a id="__codelineno-695-16" name="__codelineno-695-16"></a><span class="w">    </span><span class="c1">// 用户路由</span>
<a id="__codelineno-695-17" name="__codelineno-695-17"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userHandler</span><span class="p">.</span><span class="nx">CreateUser</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">)</span>
<a id="__codelineno-695-18" name="__codelineno-695-18"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userHandler</span><span class="p">.</span><span class="nx">GetAllUsers</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>
<a id="__codelineno-695-19" name="__codelineno-695-19"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users/{id}&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userHandler</span><span class="p">.</span><span class="nx">GetUserByID</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>
<a id="__codelineno-695-20" name="__codelineno-695-20"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users/{id}&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userHandler</span><span class="p">.</span><span class="nx">UpdateUser</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;PUT&quot;</span><span class="p">)</span>
<a id="__codelineno-695-21" name="__codelineno-695-21"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/users/{id}&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userHandler</span><span class="p">.</span><span class="nx">DeleteUser</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;DELETE&quot;</span><span class="p">)</span>
<a id="__codelineno-695-22" name="__codelineno-695-22"></a>
<a id="__codelineno-695-23" name="__codelineno-695-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">router</span>
<a id="__codelineno-695-24" name="__codelineno-695-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>使用<code>github.com/gorilla/mux</code>包配置路由，支持变量路径参数。</li>
<li>创建<code>UserStore</code>实例，并将其传递给<code>UserHandler</code>。</li>
<li>注册用户相关的路由和对应的处理函数，指定HTTP方法。</li>
</ul>
<h4 id="8-编写主程序">8. 编写主程序<a class="headerlink" href="#8-编写主程序" title="Permanent link">&para;</a></h4>
<p>在<code>main.go</code>文件中，配置路由并启动服务器。</p>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-696-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-696-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-696-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-696-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-696-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-696-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-696-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-696-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-696-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-696-10">10</a></span>
<span class="normal"><a href="#__codelineno-696-11">11</a></span>
<span class="normal"><a href="#__codelineno-696-12">12</a></span>
<span class="normal"><a href="#__codelineno-696-13">13</a></span>
<span class="normal"><a href="#__codelineno-696-14">14</a></span>
<span class="normal"><a href="#__codelineno-696-15">15</a></span>
<span class="normal"><a href="#__codelineno-696-16">16</a></span>
<span class="normal"><a href="#__codelineno-696-17">17</a></span>
<span class="normal"><a href="#__codelineno-696-18">18</a></span>
<span class="normal"><a href="#__codelineno-696-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-696-1" name="__codelineno-696-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-696-2" name="__codelineno-696-2"></a>
<a id="__codelineno-696-3" name="__codelineno-696-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-696-4" name="__codelineno-696-4"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-696-5" name="__codelineno-696-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-696-6" name="__codelineno-696-6"></a>
<a id="__codelineno-696-7" name="__codelineno-696-7"></a><span class="w">    </span><span class="s">&quot;github.com/username/restful-api/routers&quot;</span>
<a id="__codelineno-696-8" name="__codelineno-696-8"></a><span class="p">)</span>
<a id="__codelineno-696-9" name="__codelineno-696-9"></a>
<a id="__codelineno-696-10" name="__codelineno-696-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-696-11" name="__codelineno-696-11"></a><span class="w">    </span><span class="nx">router</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">routers</span><span class="p">.</span><span class="nx">SetupRouter</span><span class="p">()</span>
<a id="__codelineno-696-12" name="__codelineno-696-12"></a>
<a id="__codelineno-696-13" name="__codelineno-696-13"></a><span class="w">    </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:8080&quot;</span>
<a id="__codelineno-696-14" name="__codelineno-696-14"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;服务器启动在 http://localhost%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>
<a id="__codelineno-696-15" name="__codelineno-696-15"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">router</span><span class="p">)</span>
<a id="__codelineno-696-16" name="__codelineno-696-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-696-17" name="__codelineno-696-17"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;服务器启动失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-696-18" name="__codelineno-696-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-696-19" name="__codelineno-696-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>调用<code>SetupRouter</code>函数获取配置好的路由。</li>
<li>使用<code>http.ListenAndServe</code>启动HTTP服务器，监听指定端口。</li>
<li>记录服务器启动信息，并在启动失败时记录错误。</li>
</ul>
<h4 id="9-运行和测试api">9. 运行和测试API<a class="headerlink" href="#9-运行和测试api" title="Permanent link">&para;</a></h4>
<p>确保所有文件已保存，然后在终端中导航到<code>restful-api</code>目录，运行以下命令启动服务器：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-697-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-697-1" name="__codelineno-697-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-698-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-698-1" name="__codelineno-698-1"></a>2024/04/27 12:10:00 服务器启动在 http://localhost:8080
</code></pre></div></td></tr></table></div>
<p>使用<code>curl</code>或Postman等工具测试API。</p>
<h5 id="1-创建用户">1. 创建用户<a class="headerlink" href="#1-创建用户" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-699-1">1</a></span>
<span class="normal"><a href="#__codelineno-699-2">2</a></span>
<span class="normal"><a href="#__codelineno-699-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-699-1" name="__codelineno-699-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/users<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-699-2" name="__codelineno-699-2"></a><span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-699-3" name="__codelineno-699-3"></a><span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Alice&quot;,&quot;email&quot;:&quot;alice@example.com&quot;}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-700-1">1</a></span>
<span class="normal"><a href="#__codelineno-700-2">2</a></span>
<span class="normal"><a href="#__codelineno-700-3">3</a></span>
<span class="normal"><a href="#__codelineno-700-4">4</a></span>
<span class="normal"><a href="#__codelineno-700-5">5</a></span>
<span class="normal"><a href="#__codelineno-700-6">6</a></span>
<span class="normal"><a href="#__codelineno-700-7">7</a></span>
<span class="normal"><a href="#__codelineno-700-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-700-1" name="__codelineno-700-1"></a><span class="p">{</span>
<a id="__codelineno-700-2" name="__codelineno-700-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-700-3" name="__codelineno-700-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-700-4" name="__codelineno-700-4"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-700-5" name="__codelineno-700-5"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<a id="__codelineno-700-6" name="__codelineno-700-6"></a><span class="w">        </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span>
<a id="__codelineno-700-7" name="__codelineno-700-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-700-8" name="__codelineno-700-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="2-获取所有用户">2. 获取所有用户<a class="headerlink" href="#2-获取所有用户" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-701-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-701-1" name="__codelineno-701-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-702-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-702-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-702-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-702-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-702-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-702-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-702-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-702-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-702-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-702-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-702-1" name="__codelineno-702-1"></a><span class="p">{</span>
<a id="__codelineno-702-2" name="__codelineno-702-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-702-3" name="__codelineno-702-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-702-4" name="__codelineno-702-4"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-702-5" name="__codelineno-702-5"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-702-6" name="__codelineno-702-6"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<a id="__codelineno-702-7" name="__codelineno-702-7"></a><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span>
<a id="__codelineno-702-8" name="__codelineno-702-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-702-9" name="__codelineno-702-9"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-702-10" name="__codelineno-702-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="3-获取单个用户">3. 获取单个用户<a class="headerlink" href="#3-获取单个用户" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-703-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-703-1" name="__codelineno-703-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users/1
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-704-1">1</a></span>
<span class="normal"><a href="#__codelineno-704-2">2</a></span>
<span class="normal"><a href="#__codelineno-704-3">3</a></span>
<span class="normal"><a href="#__codelineno-704-4">4</a></span>
<span class="normal"><a href="#__codelineno-704-5">5</a></span>
<span class="normal"><a href="#__codelineno-704-6">6</a></span>
<span class="normal"><a href="#__codelineno-704-7">7</a></span>
<span class="normal"><a href="#__codelineno-704-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-704-1" name="__codelineno-704-1"></a><span class="p">{</span>
<a id="__codelineno-704-2" name="__codelineno-704-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-704-3" name="__codelineno-704-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-704-4" name="__codelineno-704-4"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-704-5" name="__codelineno-704-5"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<a id="__codelineno-704-6" name="__codelineno-704-6"></a><span class="w">        </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span>
<a id="__codelineno-704-7" name="__codelineno-704-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-704-8" name="__codelineno-704-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="4-更新用户">4. 更新用户<a class="headerlink" href="#4-更新用户" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-705-1">1</a></span>
<span class="normal"><a href="#__codelineno-705-2">2</a></span>
<span class="normal"><a href="#__codelineno-705-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-705-1" name="__codelineno-705-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>PUT<span class="w"> </span>http://localhost:8080/users/1<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-705-2" name="__codelineno-705-2"></a><span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-705-3" name="__codelineno-705-3"></a><span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Alice Smith&quot;,&quot;email&quot;:&quot;alice.smith@example.com&quot;}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-706-1">1</a></span>
<span class="normal"><a href="#__codelineno-706-2">2</a></span>
<span class="normal"><a href="#__codelineno-706-3">3</a></span>
<span class="normal"><a href="#__codelineno-706-4">4</a></span>
<span class="normal"><a href="#__codelineno-706-5">5</a></span>
<span class="normal"><a href="#__codelineno-706-6">6</a></span>
<span class="normal"><a href="#__codelineno-706-7">7</a></span>
<span class="normal"><a href="#__codelineno-706-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-706-1" name="__codelineno-706-1"></a><span class="p">{</span>
<a id="__codelineno-706-2" name="__codelineno-706-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-706-3" name="__codelineno-706-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-706-4" name="__codelineno-706-4"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-706-5" name="__codelineno-706-5"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice Smith&quot;</span><span class="p">,</span>
<a id="__codelineno-706-6" name="__codelineno-706-6"></a><span class="w">        </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice.smith@example.com&quot;</span>
<a id="__codelineno-706-7" name="__codelineno-706-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-706-8" name="__codelineno-706-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="5-删除用户">5. 删除用户<a class="headerlink" href="#5-删除用户" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-707-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-707-1" name="__codelineno-707-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://localhost:8080/users/1
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-708-1">1</a></span>
<span class="normal"><a href="#__codelineno-708-2">2</a></span>
<span class="normal"><a href="#__codelineno-708-3">3</a></span>
<span class="normal"><a href="#__codelineno-708-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-708-1" name="__codelineno-708-1"></a><span class="p">{</span>
<a id="__codelineno-708-2" name="__codelineno-708-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-708-3" name="__codelineno-708-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;用户已删除&quot;</span>
<a id="__codelineno-708-4" name="__codelineno-708-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="6-获取已删除的用户">6. 获取已删除的用户<a class="headerlink" href="#6-获取已删除的用户" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-709-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-709-1" name="__codelineno-709-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users/1
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-710-1">1</a></span>
<span class="normal"><a href="#__codelineno-710-2">2</a></span>
<span class="normal"><a href="#__codelineno-710-3">3</a></span>
<span class="normal"><a href="#__codelineno-710-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-710-1" name="__codelineno-710-1"></a><span class="p">{</span>
<a id="__codelineno-710-2" name="__codelineno-710-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-710-3" name="__codelineno-710-3"></a><span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;用户不存在&quot;</span>
<a id="__codelineno-710-4" name="__codelineno-710-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="10-代码解析">10. 代码解析<a class="headerlink" href="#10-代码解析" title="Permanent link">&para;</a></h4>
<ul>
<li>路由配置</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>mux.Router</code>配置路由，支持路径变量<code>{id}</code>。</li>
<li>
<p>绑定不同的HTTP方法到对应的处理函数，确保RESTful API的规范性。</p>
</li>
<li>
<p>线程安全</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p><code>UserStore</code>使用<code>sync.RWMutex</code>保证并发读写的安全性。</p>
</li>
<li>
<p>响应统一</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p>使用<code>utils.RespondWithJSON</code>封装响应逻辑，统一返回格式，简化代码。</p>
</li>
<li>
<p>错误处理</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p>在每个处理函数中，检查并处理可能出现的错误，确保API的健壮性。</p>
</li>
<li>
<p>模块化设计</p>
</li>
</ul>
<p>：</p>
<ul>
<li>将模型、处理器、路由和工具函数分离，提升代码的可维护性和可扩展性。</li>
</ul>
<h4 id="11-扩展功能">11. 扩展功能<a class="headerlink" href="#11-扩展功能" title="Permanent link">&para;</a></h4>
<p>为了提升API的功能和实用性，可以添加以下扩展：</p>
<ul>
<li><strong>数据持久化</strong>：将用户数据存储到数据库（如PostgreSQL、MongoDB）中，替代内存存储。</li>
<li><strong>身份验证</strong>：实现JWT或OAuth2身份验证，保护API端点。</li>
<li><strong>分页和过滤</strong>：在获取用户列表时，支持分页和过滤功能。</li>
<li><strong>日志记录和监控</strong>：集成日志记录和监控工具，跟踪API使用情况和性能指标。</li>
</ul>
<h3 id="153-文件上传与下载">15.3 文件上传与下载<a class="headerlink" href="#153-文件上传与下载" title="Permanent link">&para;</a></h3>
<p>在Web应用和API中，处理文件的上传和下载是常见的需求。Go语言通过内置的<code>net/http</code>包提供了强大的文件处理能力。本节将指导你实现一个支持文件上传和下载的Web应用，涵盖前端表单、后端处理和安全性考量。</p>
<h4 id="1-项目概述_2">1. 项目概述<a class="headerlink" href="#1-项目概述_2" title="Permanent link">&para;</a></h4>
<p>本项目将实现一个简单的文件管理系统，具备以下功能：</p>
<ul>
<li><strong>上传文件</strong>：用户可以通过Web表单上传文件，文件将保存在服务器的<code>uploads</code>目录中。</li>
<li><strong>下载文件</strong>：用户可以查看已上传的文件列表，并下载任意文件。</li>
</ul>
<h4 id="2-项目结构_2">2. 项目结构<a class="headerlink" href="#2-项目结构_2" title="Permanent link">&para;</a></h4>
<p>建议的项目结构如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-711-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-711-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-711-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-711-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-711-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-711-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-711-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-711-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-711-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-711-10">10</a></span>
<span class="normal"><a href="#__codelineno-711-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-711-1" name="__codelineno-711-1"></a>file-upload-download/
<a id="__codelineno-711-2" name="__codelineno-711-2"></a>├── main.go
<a id="__codelineno-711-3" name="__codelineno-711-3"></a>├── templates/
<a id="__codelineno-711-4" name="__codelineno-711-4"></a>│   ├── upload.html
<a id="__codelineno-711-5" name="__codelineno-711-5"></a>│   └── files.html
<a id="__codelineno-711-6" name="__codelineno-711-6"></a>├── uploads/
<a id="__codelineno-711-7" name="__codelineno-711-7"></a>│   └── (上传的文件将存放在这里)
<a id="__codelineno-711-8" name="__codelineno-711-8"></a>├── static/
<a id="__codelineno-711-9" name="__codelineno-711-9"></a>│   └── css/
<a id="__codelineno-711-10" name="__codelineno-711-10"></a>│       └── styles.css
<a id="__codelineno-711-11" name="__codelineno-711-11"></a>└── go.mod
</code></pre></div></td></tr></table></div>
<h4 id="3-初始化项目_1">3. 初始化项目<a class="headerlink" href="#3-初始化项目_1" title="Permanent link">&para;</a></h4>
<p>首先，创建项目目录并初始化Go模块。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-712-1">1</a></span>
<span class="normal"><a href="#__codelineno-712-2">2</a></span>
<span class="normal"><a href="#__codelineno-712-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-712-1" name="__codelineno-712-1"></a>mkdir<span class="w"> </span>file-upload-download
<a id="__codelineno-712-2" name="__codelineno-712-2"></a><span class="nb">cd</span><span class="w"> </span>file-upload-download
<a id="__codelineno-712-3" name="__codelineno-712-3"></a>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>github.com/username/file-upload-download
</code></pre></div></td></tr></table></div>
<h4 id="4-创建html模板">4. 创建HTML模板<a class="headerlink" href="#4-创建html模板" title="Permanent link">&para;</a></h4>
<p>在<code>templates</code>目录下创建两个HTML模板文件：<code>upload.html</code>和<code>files.html</code>。</p>
<p><strong>templates/upload.html</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">HTML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-713-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-713-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-713-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-713-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-713-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-713-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-713-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-713-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-713-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-713-10">10</a></span>
<span class="normal"><a href="#__codelineno-713-11">11</a></span>
<span class="normal"><a href="#__codelineno-713-12">12</a></span>
<span class="normal"><a href="#__codelineno-713-13">13</a></span>
<span class="normal"><a href="#__codelineno-713-14">14</a></span>
<span class="normal"><a href="#__codelineno-713-15">15</a></span>
<span class="normal"><a href="#__codelineno-713-16">16</a></span>
<span class="normal"><a href="#__codelineno-713-17">17</a></span>
<span class="normal"><a href="#__codelineno-713-18">18</a></span>
<span class="normal"><a href="#__codelineno-713-19">19</a></span>
<span class="normal"><a href="#__codelineno-713-20">20</a></span>
<span class="normal"><a href="#__codelineno-713-21">21</a></span>
<span class="normal"><a href="#__codelineno-713-22">22</a></span>
<span class="normal"><a href="#__codelineno-713-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-713-1" name="__codelineno-713-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-713-2" name="__codelineno-713-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-713-3" name="__codelineno-713-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-713-4" name="__codelineno-713-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-713-5" name="__codelineno-713-5"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>文件上传<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-713-6" name="__codelineno-713-6"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/static/css/styles.css&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-713-7" name="__codelineno-713-7"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-713-8" name="__codelineno-713-8"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-713-9" name="__codelineno-713-9"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>文件上传<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-713-10" name="__codelineno-713-10"></a>    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-713-11" name="__codelineno-713-11"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/upload&quot;</span><span class="p">&gt;</span>上传<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-713-12" name="__codelineno-713-12"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/files&quot;</span><span class="p">&gt;</span>文件列表<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-713-13" name="__codelineno-713-13"></a>    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-713-14" name="__codelineno-713-14"></a>    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/upload&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-713-15" name="__codelineno-713-15"></a>        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;file&quot;</span><span class="p">&gt;</span>选择文件:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<a id="__codelineno-713-16" name="__codelineno-713-16"></a>        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">required</span><span class="p">&gt;</span>
<a id="__codelineno-713-17" name="__codelineno-713-17"></a>        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>上传<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<a id="__codelineno-713-18" name="__codelineno-713-18"></a>    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-713-19" name="__codelineno-713-19"></a>    {{if .Message}}
<a id="__codelineno-713-20" name="__codelineno-713-20"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{.Message}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-713-21" name="__codelineno-713-21"></a>    {{end}}
<a id="__codelineno-713-22" name="__codelineno-713-22"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-713-23" name="__codelineno-713-23"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>templates/files.html</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">HTML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-714-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-714-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-714-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-714-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-714-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-714-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-714-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-714-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-714-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-714-10">10</a></span>
<span class="normal"><a href="#__codelineno-714-11">11</a></span>
<span class="normal"><a href="#__codelineno-714-12">12</a></span>
<span class="normal"><a href="#__codelineno-714-13">13</a></span>
<span class="normal"><a href="#__codelineno-714-14">14</a></span>
<span class="normal"><a href="#__codelineno-714-15">15</a></span>
<span class="normal"><a href="#__codelineno-714-16">16</a></span>
<span class="normal"><a href="#__codelineno-714-17">17</a></span>
<span class="normal"><a href="#__codelineno-714-18">18</a></span>
<span class="normal"><a href="#__codelineno-714-19">19</a></span>
<span class="normal"><a href="#__codelineno-714-20">20</a></span>
<span class="normal"><a href="#__codelineno-714-21">21</a></span>
<span class="normal"><a href="#__codelineno-714-22">22</a></span>
<span class="normal"><a href="#__codelineno-714-23">23</a></span>
<span class="normal"><a href="#__codelineno-714-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-714-1" name="__codelineno-714-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-714-2" name="__codelineno-714-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-714-3" name="__codelineno-714-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-714-4" name="__codelineno-714-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-714-5" name="__codelineno-714-5"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>文件列表<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-714-6" name="__codelineno-714-6"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/static/css/styles.css&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-714-7" name="__codelineno-714-7"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-714-8" name="__codelineno-714-8"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-714-9" name="__codelineno-714-9"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>已上传的文件<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-714-10" name="__codelineno-714-10"></a>    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-714-11" name="__codelineno-714-11"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/upload&quot;</span><span class="p">&gt;</span>上传<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> |
<a id="__codelineno-714-12" name="__codelineno-714-12"></a>        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/files&quot;</span><span class="p">&gt;</span>文件列表<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a id="__codelineno-714-13" name="__codelineno-714-13"></a>    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
<a id="__codelineno-714-14" name="__codelineno-714-14"></a>    {{if .Files}}
<a id="__codelineno-714-15" name="__codelineno-714-15"></a>    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
<a id="__codelineno-714-16" name="__codelineno-714-16"></a>        {{range .Files}}
<a id="__codelineno-714-17" name="__codelineno-714-17"></a>        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/download/{{.}}&quot;</span><span class="p">&gt;</span>{{.}}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-714-18" name="__codelineno-714-18"></a>        {{end}}
<a id="__codelineno-714-19" name="__codelineno-714-19"></a>    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<a id="__codelineno-714-20" name="__codelineno-714-20"></a>    {{else}}
<a id="__codelineno-714-21" name="__codelineno-714-21"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>暂无文件。<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-714-22" name="__codelineno-714-22"></a>    {{end}}
<a id="__codelineno-714-23" name="__codelineno-714-23"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-714-24" name="__codelineno-714-24"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<h4 id="5-添加样式表">5. 添加样式表<a class="headerlink" href="#5-添加样式表" title="Permanent link">&para;</a></h4>
<p>创建<code>static/css</code>目录，并在其中添加<code>styles.css</code>文件，用于美化页面。</p>
<p><strong>static/css/styles.css</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CSS</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-715-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-715-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-715-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-715-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-715-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-715-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-715-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-715-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-715-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-715-10">10</a></span>
<span class="normal"><a href="#__codelineno-715-11">11</a></span>
<span class="normal"><a href="#__codelineno-715-12">12</a></span>
<span class="normal"><a href="#__codelineno-715-13">13</a></span>
<span class="normal"><a href="#__codelineno-715-14">14</a></span>
<span class="normal"><a href="#__codelineno-715-15">15</a></span>
<span class="normal"><a href="#__codelineno-715-16">16</a></span>
<span class="normal"><a href="#__codelineno-715-17">17</a></span>
<span class="normal"><a href="#__codelineno-715-18">18</a></span>
<span class="normal"><a href="#__codelineno-715-19">19</a></span>
<span class="normal"><a href="#__codelineno-715-20">20</a></span>
<span class="normal"><a href="#__codelineno-715-21">21</a></span>
<span class="normal"><a href="#__codelineno-715-22">22</a></span>
<span class="normal"><a href="#__codelineno-715-23">23</a></span>
<span class="normal"><a href="#__codelineno-715-24">24</a></span>
<span class="normal"><a href="#__codelineno-715-25">25</a></span>
<span class="normal"><a href="#__codelineno-715-26">26</a></span>
<span class="normal"><a href="#__codelineno-715-27">27</a></span>
<span class="normal"><a href="#__codelineno-715-28">28</a></span>
<span class="normal"><a href="#__codelineno-715-29">29</a></span>
<span class="normal"><a href="#__codelineno-715-30">30</a></span>
<span class="normal"><a href="#__codelineno-715-31">31</a></span>
<span class="normal"><a href="#__codelineno-715-32">32</a></span>
<span class="normal"><a href="#__codelineno-715-33">33</a></span>
<span class="normal"><a href="#__codelineno-715-34">34</a></span>
<span class="normal"><a href="#__codelineno-715-35">35</a></span>
<span class="normal"><a href="#__codelineno-715-36">36</a></span>
<span class="normal"><a href="#__codelineno-715-37">37</a></span>
<span class="normal"><a href="#__codelineno-715-38">38</a></span>
<span class="normal"><a href="#__codelineno-715-39">39</a></span>
<span class="normal"><a href="#__codelineno-715-40">40</a></span>
<span class="normal"><a href="#__codelineno-715-41">41</a></span>
<span class="normal"><a href="#__codelineno-715-42">42</a></span>
<span class="normal"><a href="#__codelineno-715-43">43</a></span>
<span class="normal"><a href="#__codelineno-715-44">44</a></span>
<span class="normal"><a href="#__codelineno-715-45">45</a></span>
<span class="normal"><a href="#__codelineno-715-46">46</a></span>
<span class="normal"><a href="#__codelineno-715-47">47</a></span>
<span class="normal"><a href="#__codelineno-715-48">48</a></span>
<span class="normal"><a href="#__codelineno-715-49">49</a></span>
<span class="normal"><a href="#__codelineno-715-50">50</a></span>
<span class="normal"><a href="#__codelineno-715-51">51</a></span>
<span class="normal"><a href="#__codelineno-715-52">52</a></span>
<span class="normal"><a href="#__codelineno-715-53">53</a></span>
<span class="normal"><a href="#__codelineno-715-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-715-1" name="__codelineno-715-1"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-2" name="__codelineno-715-2"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="n">Arial</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<a id="__codelineno-715-3" name="__codelineno-715-3"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-715-4" name="__codelineno-715-4"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-715-5" name="__codelineno-715-5"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f9f9f9</span><span class="p">;</span>
<a id="__codelineno-715-6" name="__codelineno-715-6"></a><span class="p">}</span>
<a id="__codelineno-715-7" name="__codelineno-715-7"></a>
<a id="__codelineno-715-8" name="__codelineno-715-8"></a><span class="nt">h1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-9" name="__codelineno-715-9"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#333</span><span class="p">;</span>
<a id="__codelineno-715-10" name="__codelineno-715-10"></a><span class="p">}</span>
<a id="__codelineno-715-11" name="__codelineno-715-11"></a>
<a id="__codelineno-715-12" name="__codelineno-715-12"></a><span class="nt">nav</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-13" name="__codelineno-715-13"></a><span class="w">    </span><span class="k">margin-right</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-715-14" name="__codelineno-715-14"></a><span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<a id="__codelineno-715-15" name="__codelineno-715-15"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#007BFF</span><span class="p">;</span>
<a id="__codelineno-715-16" name="__codelineno-715-16"></a><span class="p">}</span>
<a id="__codelineno-715-17" name="__codelineno-715-17"></a>
<a id="__codelineno-715-18" name="__codelineno-715-18"></a><span class="nt">nav</span><span class="w"> </span><span class="nt">a</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-19" name="__codelineno-715-19"></a><span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">underline</span><span class="p">;</span>
<a id="__codelineno-715-20" name="__codelineno-715-20"></a><span class="p">}</span>
<a id="__codelineno-715-21" name="__codelineno-715-21"></a>
<a id="__codelineno-715-22" name="__codelineno-715-22"></a><span class="nt">form</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-23" name="__codelineno-715-23"></a><span class="w">    </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-715-24" name="__codelineno-715-24"></a><span class="p">}</span>
<a id="__codelineno-715-25" name="__codelineno-715-25"></a>
<a id="__codelineno-715-26" name="__codelineno-715-26"></a><span class="nt">label</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-27" name="__codelineno-715-27"></a><span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<a id="__codelineno-715-28" name="__codelineno-715-28"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-715-29" name="__codelineno-715-29"></a><span class="p">}</span>
<a id="__codelineno-715-30" name="__codelineno-715-30"></a>
<a id="__codelineno-715-31" name="__codelineno-715-31"></a><span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="o">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-32" name="__codelineno-715-32"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-715-33" name="__codelineno-715-33"></a><span class="p">}</span>
<a id="__codelineno-715-34" name="__codelineno-715-34"></a>
<a id="__codelineno-715-35" name="__codelineno-715-35"></a><span class="nt">button</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-36" name="__codelineno-715-36"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-715-37" name="__codelineno-715-37"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#28A745</span><span class="p">;</span>
<a id="__codelineno-715-38" name="__codelineno-715-38"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<a id="__codelineno-715-39" name="__codelineno-715-39"></a><span class="w">    </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<a id="__codelineno-715-40" name="__codelineno-715-40"></a><span class="w">    </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span>
<a id="__codelineno-715-41" name="__codelineno-715-41"></a><span class="p">}</span>
<a id="__codelineno-715-42" name="__codelineno-715-42"></a>
<a id="__codelineno-715-43" name="__codelineno-715-43"></a><span class="nt">button</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-44" name="__codelineno-715-44"></a><span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#218838</span><span class="p">;</span>
<a id="__codelineno-715-45" name="__codelineno-715-45"></a><span class="p">}</span>
<a id="__codelineno-715-46" name="__codelineno-715-46"></a>
<a id="__codelineno-715-47" name="__codelineno-715-47"></a><span class="nt">ul</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-48" name="__codelineno-715-48"></a><span class="w">    </span><span class="k">list-style-type</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<a id="__codelineno-715-49" name="__codelineno-715-49"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-715-50" name="__codelineno-715-50"></a><span class="p">}</span>
<a id="__codelineno-715-51" name="__codelineno-715-51"></a>
<a id="__codelineno-715-52" name="__codelineno-715-52"></a><span class="nt">li</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-715-53" name="__codelineno-715-53"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<a id="__codelineno-715-54" name="__codelineno-715-54"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="6-编写-go-代码">6. 编写 Go 代码<a class="headerlink" href="#6-编写-go-代码" title="Permanent link">&para;</a></h4>
<p>创建<code>main.go</code>文件，实现文件上传和下载的逻辑。</p>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-716-1">  1</a></span>
<span class="normal"><a href="#__codelineno-716-2">  2</a></span>
<span class="normal"><a href="#__codelineno-716-3">  3</a></span>
<span class="normal"><a href="#__codelineno-716-4">  4</a></span>
<span class="normal"><a href="#__codelineno-716-5">  5</a></span>
<span class="normal"><a href="#__codelineno-716-6">  6</a></span>
<span class="normal"><a href="#__codelineno-716-7">  7</a></span>
<span class="normal"><a href="#__codelineno-716-8">  8</a></span>
<span class="normal"><a href="#__codelineno-716-9">  9</a></span>
<span class="normal"><a href="#__codelineno-716-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-716-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-716-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-716-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-716-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-716-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-716-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-716-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-716-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-716-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-716-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-716-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-716-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-716-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-716-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-716-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-716-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-716-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-716-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-716-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-716-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-716-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-716-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-716-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-716-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-716-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-716-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-716-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-716-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-716-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-716-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-716-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-716-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-716-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-716-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-716-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-716-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-716-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-716-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-716-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-716-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-716-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-716-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-716-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-716-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-716-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-716-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-716-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-716-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-716-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-716-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-716-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-716-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-716-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-716-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-716-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-716-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-716-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-716-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-716-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-716-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-716-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-716-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-716-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-716-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-716-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-716-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-716-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-716-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-716-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-716-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-716-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-716-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-716-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-716-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-716-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-716-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-716-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-716-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-716-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-716-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-716-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-716-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-716-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-716-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-716-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-716-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-716-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-716-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-716-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-716-100">100</a></span>
<span class="normal"><a href="#__codelineno-716-101">101</a></span>
<span class="normal"><a href="#__codelineno-716-102">102</a></span>
<span class="normal"><a href="#__codelineno-716-103">103</a></span>
<span class="normal"><a href="#__codelineno-716-104">104</a></span>
<span class="normal"><a href="#__codelineno-716-105">105</a></span>
<span class="normal"><a href="#__codelineno-716-106">106</a></span>
<span class="normal"><a href="#__codelineno-716-107">107</a></span>
<span class="normal"><a href="#__codelineno-716-108">108</a></span>
<span class="normal"><a href="#__codelineno-716-109">109</a></span>
<span class="normal"><a href="#__codelineno-716-110">110</a></span>
<span class="normal"><a href="#__codelineno-716-111">111</a></span>
<span class="normal"><a href="#__codelineno-716-112">112</a></span>
<span class="normal"><a href="#__codelineno-716-113">113</a></span>
<span class="normal"><a href="#__codelineno-716-114">114</a></span>
<span class="normal"><a href="#__codelineno-716-115">115</a></span>
<span class="normal"><a href="#__codelineno-716-116">116</a></span>
<span class="normal"><a href="#__codelineno-716-117">117</a></span>
<span class="normal"><a href="#__codelineno-716-118">118</a></span>
<span class="normal"><a href="#__codelineno-716-119">119</a></span>
<span class="normal"><a href="#__codelineno-716-120">120</a></span>
<span class="normal"><a href="#__codelineno-716-121">121</a></span>
<span class="normal"><a href="#__codelineno-716-122">122</a></span>
<span class="normal"><a href="#__codelineno-716-123">123</a></span>
<span class="normal"><a href="#__codelineno-716-124">124</a></span>
<span class="normal"><a href="#__codelineno-716-125">125</a></span>
<span class="normal"><a href="#__codelineno-716-126">126</a></span>
<span class="normal"><a href="#__codelineno-716-127">127</a></span>
<span class="normal"><a href="#__codelineno-716-128">128</a></span>
<span class="normal"><a href="#__codelineno-716-129">129</a></span>
<span class="normal"><a href="#__codelineno-716-130">130</a></span>
<span class="normal"><a href="#__codelineno-716-131">131</a></span>
<span class="normal"><a href="#__codelineno-716-132">132</a></span>
<span class="normal"><a href="#__codelineno-716-133">133</a></span>
<span class="normal"><a href="#__codelineno-716-134">134</a></span>
<span class="normal"><a href="#__codelineno-716-135">135</a></span>
<span class="normal"><a href="#__codelineno-716-136">136</a></span>
<span class="normal"><a href="#__codelineno-716-137">137</a></span>
<span class="normal"><a href="#__codelineno-716-138">138</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-716-1" name="__codelineno-716-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-716-2" name="__codelineno-716-2"></a>
<a id="__codelineno-716-3" name="__codelineno-716-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-716-4" name="__codelineno-716-4"></a><span class="w">    </span><span class="s">&quot;html/template&quot;</span>
<a id="__codelineno-716-5" name="__codelineno-716-5"></a><span class="w">    </span><span class="s">&quot;io&quot;</span>
<a id="__codelineno-716-6" name="__codelineno-716-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-716-7" name="__codelineno-716-7"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-716-8" name="__codelineno-716-8"></a><span class="w">    </span><span class="s">&quot;os&quot;</span>
<a id="__codelineno-716-9" name="__codelineno-716-9"></a><span class="w">    </span><span class="s">&quot;path/filepath&quot;</span>
<a id="__codelineno-716-10" name="__codelineno-716-10"></a><span class="p">)</span>
<a id="__codelineno-716-11" name="__codelineno-716-11"></a>
<a id="__codelineno-716-12" name="__codelineno-716-12"></a><span class="c1">// 定义模板缓存</span>
<a id="__codelineno-716-13" name="__codelineno-716-13"></a><span class="kd">var</span><span class="w"> </span><span class="nx">templates</span><span class="w"> </span><span class="o">*</span><span class="nx">template</span><span class="p">.</span><span class="nx">Template</span>
<a id="__codelineno-716-14" name="__codelineno-716-14"></a>
<a id="__codelineno-716-15" name="__codelineno-716-15"></a><span class="c1">// 初始化模板</span>
<a id="__codelineno-716-16" name="__codelineno-716-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">initTemplates</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-17" name="__codelineno-716-17"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-716-18" name="__codelineno-716-18"></a><span class="w">    </span><span class="nx">templates</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">template</span><span class="p">.</span><span class="nx">ParseGlob</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="s">&quot;templates&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*.html&quot;</span><span class="p">))</span>
<a id="__codelineno-716-19" name="__codelineno-716-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-20" name="__codelineno-716-20"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;解析模板失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-716-21" name="__codelineno-716-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-22" name="__codelineno-716-22"></a><span class="p">}</span>
<a id="__codelineno-716-23" name="__codelineno-716-23"></a>
<a id="__codelineno-716-24" name="__codelineno-716-24"></a><span class="c1">// 渲染模板</span>
<a id="__codelineno-716-25" name="__codelineno-716-25"></a><span class="kd">func</span><span class="w"> </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">tmpl</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-26" name="__codelineno-716-26"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">templates</span><span class="p">.</span><span class="nx">ExecuteTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">tmpl</span><span class="o">+</span><span class="s">&quot;.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-716-27" name="__codelineno-716-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-28" name="__codelineno-716-28"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<a id="__codelineno-716-29" name="__codelineno-716-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-30" name="__codelineno-716-30"></a><span class="p">}</span>
<a id="__codelineno-716-31" name="__codelineno-716-31"></a>
<a id="__codelineno-716-32" name="__codelineno-716-32"></a><span class="c1">// 上传页面处理器</span>
<a id="__codelineno-716-33" name="__codelineno-716-33"></a><span class="kd">func</span><span class="w"> </span><span class="nx">uploadHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-34" name="__codelineno-716-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-35" name="__codelineno-716-35"></a><span class="w">        </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-716-36" name="__codelineno-716-36"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-716-37" name="__codelineno-716-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-38" name="__codelineno-716-38"></a>
<a id="__codelineno-716-39" name="__codelineno-716-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;POST&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-40" name="__codelineno-716-40"></a><span class="w">        </span><span class="c1">// 解析表单</span>
<a id="__codelineno-716-41" name="__codelineno-716-41"></a><span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">ParseMultipartForm</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="c1">// 最大10MB</span>
<a id="__codelineno-716-42" name="__codelineno-716-42"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-43" name="__codelineno-716-43"></a><span class="w">            </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;解析表单失败&quot;</span><span class="p">})</span>
<a id="__codelineno-716-44" name="__codelineno-716-44"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-716-45" name="__codelineno-716-45"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-716-46" name="__codelineno-716-46"></a>
<a id="__codelineno-716-47" name="__codelineno-716-47"></a><span class="w">        </span><span class="c1">// 获取文件部分</span>
<a id="__codelineno-716-48" name="__codelineno-716-48"></a><span class="w">        </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">FormFile</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">)</span>
<a id="__codelineno-716-49" name="__codelineno-716-49"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-50" name="__codelineno-716-50"></a><span class="w">            </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;获取文件失败&quot;</span><span class="p">})</span>
<a id="__codelineno-716-51" name="__codelineno-716-51"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-716-52" name="__codelineno-716-52"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-716-53" name="__codelineno-716-53"></a><span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-716-54" name="__codelineno-716-54"></a>
<a id="__codelineno-716-55" name="__codelineno-716-55"></a><span class="w">        </span><span class="c1">// 创建uploads目录（如果不存在）</span>
<a id="__codelineno-716-56" name="__codelineno-716-56"></a><span class="w">        </span><span class="nx">os</span><span class="p">.</span><span class="nx">MkdirAll</span><span class="p">(</span><span class="s">&quot;uploads&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">ModePerm</span><span class="p">)</span>
<a id="__codelineno-716-57" name="__codelineno-716-57"></a>
<a id="__codelineno-716-58" name="__codelineno-716-58"></a><span class="w">        </span><span class="c1">// 创建目标文件</span>
<a id="__codelineno-716-59" name="__codelineno-716-59"></a><span class="w">        </span><span class="nx">dst</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="s">&quot;uploads&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">.</span><span class="nx">Filename</span><span class="p">))</span>
<a id="__codelineno-716-60" name="__codelineno-716-60"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-61" name="__codelineno-716-61"></a><span class="w">            </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;创建文件失败&quot;</span><span class="p">})</span>
<a id="__codelineno-716-62" name="__codelineno-716-62"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-716-63" name="__codelineno-716-63"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-716-64" name="__codelineno-716-64"></a><span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="nx">dst</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-716-65" name="__codelineno-716-65"></a>
<a id="__codelineno-716-66" name="__codelineno-716-66"></a><span class="w">        </span><span class="c1">// 复制文件内容</span>
<a id="__codelineno-716-67" name="__codelineno-716-67"></a><span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">)</span>
<a id="__codelineno-716-68" name="__codelineno-716-68"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-69" name="__codelineno-716-69"></a><span class="w">            </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;保存文件失败&quot;</span><span class="p">})</span>
<a id="__codelineno-716-70" name="__codelineno-716-70"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-716-71" name="__codelineno-716-71"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-716-72" name="__codelineno-716-72"></a>
<a id="__codelineno-716-73" name="__codelineno-716-73"></a><span class="w">        </span><span class="c1">// 成功响应</span>
<a id="__codelineno-716-74" name="__codelineno-716-74"></a><span class="w">        </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;Message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;文件上传成功&quot;</span><span class="p">})</span>
<a id="__codelineno-716-75" name="__codelineno-716-75"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-76" name="__codelineno-716-76"></a><span class="p">}</span>
<a id="__codelineno-716-77" name="__codelineno-716-77"></a>
<a id="__codelineno-716-78" name="__codelineno-716-78"></a><span class="c1">// 文件列表处理器</span>
<a id="__codelineno-716-79" name="__codelineno-716-79"></a><span class="kd">func</span><span class="w"> </span><span class="nx">filesHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-80" name="__codelineno-716-80"></a><span class="w">    </span><span class="nx">files</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">ReadDir</span><span class="p">(</span><span class="s">&quot;uploads&quot;</span><span class="p">)</span>
<a id="__codelineno-716-81" name="__codelineno-716-81"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-82" name="__codelineno-716-82"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无法读取文件目录&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<a id="__codelineno-716-83" name="__codelineno-716-83"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-716-84" name="__codelineno-716-84"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-85" name="__codelineno-716-85"></a>
<a id="__codelineno-716-86" name="__codelineno-716-86"></a><span class="w">    </span><span class="nx">fileNames</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
<a id="__codelineno-716-87" name="__codelineno-716-87"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-88" name="__codelineno-716-88"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">file</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-89" name="__codelineno-716-89"></a><span class="w">            </span><span class="nx">fileNames</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">fileNames</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Name</span><span class="p">())</span>
<a id="__codelineno-716-90" name="__codelineno-716-90"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-716-91" name="__codelineno-716-91"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-92" name="__codelineno-716-92"></a>
<a id="__codelineno-716-93" name="__codelineno-716-93"></a><span class="w">    </span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;files&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&quot;Files&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">fileNames</span><span class="p">})</span>
<a id="__codelineno-716-94" name="__codelineno-716-94"></a><span class="p">}</span>
<a id="__codelineno-716-95" name="__codelineno-716-95"></a>
<a id="__codelineno-716-96" name="__codelineno-716-96"></a><span class="c1">// 文件下载处理器</span>
<a id="__codelineno-716-97" name="__codelineno-716-97"></a><span class="kd">func</span><span class="w"> </span><span class="nx">downloadHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-98" name="__codelineno-716-98"></a><span class="w">    </span><span class="c1">// 获取文件名</span>
<a id="__codelineno-716-99" name="__codelineno-716-99"></a><span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-716-100" name="__codelineno-716-100"></a><span class="w">    </span><span class="nx">filename</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;filename&quot;</span><span class="p">]</span>
<a id="__codelineno-716-101" name="__codelineno-716-101"></a><span class="w">    </span><span class="nx">filepath</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="s">&quot;uploads&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">filename</span><span class="p">)</span>
<a id="__codelineno-716-102" name="__codelineno-716-102"></a>
<a id="__codelineno-716-103" name="__codelineno-716-103"></a><span class="w">    </span><span class="c1">// 检查文件是否存在</span>
<a id="__codelineno-716-104" name="__codelineno-716-104"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filepath</span><span class="p">);</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-105" name="__codelineno-716-105"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">NotFound</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-716-106" name="__codelineno-716-106"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-716-107" name="__codelineno-716-107"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-108" name="__codelineno-716-108"></a>
<a id="__codelineno-716-109" name="__codelineno-716-109"></a><span class="w">    </span><span class="c1">// 设置头信息</span>
<a id="__codelineno-716-110" name="__codelineno-716-110"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Disposition&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;attachment; filename=&quot;</span><span class="o">+</span><span class="nx">filename</span><span class="p">)</span>
<a id="__codelineno-716-111" name="__codelineno-716-111"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/octet-stream&quot;</span><span class="p">)</span>
<a id="__codelineno-716-112" name="__codelineno-716-112"></a>
<a id="__codelineno-716-113" name="__codelineno-716-113"></a><span class="w">    </span><span class="c1">// 发送文件</span>
<a id="__codelineno-716-114" name="__codelineno-716-114"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ServeFile</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">filepath</span><span class="p">)</span>
<a id="__codelineno-716-115" name="__codelineno-716-115"></a><span class="p">}</span>
<a id="__codelineno-716-116" name="__codelineno-716-116"></a>
<a id="__codelineno-716-117" name="__codelineno-716-117"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-118" name="__codelineno-716-118"></a><span class="w">    </span><span class="c1">// 初始化模板</span>
<a id="__codelineno-716-119" name="__codelineno-716-119"></a><span class="w">    </span><span class="nx">initTemplates</span><span class="p">()</span>
<a id="__codelineno-716-120" name="__codelineno-716-120"></a>
<a id="__codelineno-716-121" name="__codelineno-716-121"></a><span class="w">    </span><span class="c1">// 设置路由</span>
<a id="__codelineno-716-122" name="__codelineno-716-122"></a><span class="w">    </span><span class="nx">router</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">NewRouter</span><span class="p">()</span>
<a id="__codelineno-716-123" name="__codelineno-716-123"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/upload&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">uploadHandler</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;POST&quot;</span><span class="p">)</span>
<a id="__codelineno-716-124" name="__codelineno-716-124"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/files&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">filesHandler</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>
<a id="__codelineno-716-125" name="__codelineno-716-125"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/download/{filename}&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">downloadHandler</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>
<a id="__codelineno-716-126" name="__codelineno-716-126"></a>
<a id="__codelineno-716-127" name="__codelineno-716-127"></a><span class="w">    </span><span class="c1">// 提供静态文件服务</span>
<a id="__codelineno-716-128" name="__codelineno-716-128"></a><span class="w">    </span><span class="nx">fs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;static&quot;</span><span class="p">))</span>
<a id="__codelineno-716-129" name="__codelineno-716-129"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">PathPrefix</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">).</span><span class="nx">Handler</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StripPrefix</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">))</span>
<a id="__codelineno-716-130" name="__codelineno-716-130"></a>
<a id="__codelineno-716-131" name="__codelineno-716-131"></a><span class="w">    </span><span class="c1">// 启动服务器</span>
<a id="__codelineno-716-132" name="__codelineno-716-132"></a><span class="w">    </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:8080&quot;</span>
<a id="__codelineno-716-133" name="__codelineno-716-133"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;服务器启动在 http://localhost%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>
<a id="__codelineno-716-134" name="__codelineno-716-134"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">router</span><span class="p">)</span>
<a id="__codelineno-716-135" name="__codelineno-716-135"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-716-136" name="__codelineno-716-136"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;服务器启动失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-716-137" name="__codelineno-716-137"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-716-138" name="__codelineno-716-138"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>
<p><strong>模板解析</strong>：使用<code>template.ParseGlob</code>解析<code>templates</code>目录下的所有HTML文件。</p>
</li>
<li>
<p>上传处理器</p>
</li>
</ul>
<p>：</p>
<ul>
<li>处理<code>GET</code>请求，渲染上传页面。</li>
<li>处理<code>POST</code>请求，解析表单，保存上传的文件到<code>uploads</code>目录。</li>
<li>
<p>返回成功或错误消息。</p>
</li>
<li>
<p>文件列表处理器</p>
</li>
</ul>
<p>：</p>
<ul>
<li>读取<code>uploads</code>目录，获取所有文件名。</li>
<li>
<p>渲染文件列表页面，显示所有上传的文件。</p>
</li>
<li>
<p>文件下载处理器</p>
</li>
</ul>
<p>：</p>
<ul>
<li>根据URL参数获取文件名。</li>
<li>检查文件是否存在。</li>
<li>设置响应头，提示浏览器下载文件。</li>
<li>
<p>使用<code>http.ServeFile</code>发送文件内容。</p>
</li>
<li>
<p>路由配置</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>gorilla/mux</code>包配置路由，支持路径变量<code>{filename}</code>。</li>
<li>
<p>注册上传、文件列表和下载的路由及其处理器。</p>
</li>
<li>
<p>静态文件服务</p>
</li>
</ul>
<p>：</p>
<ul>
<li>提供CSS样式表的静态文件服务，通过<code>/static/</code>路径访问。</li>
</ul>
<h4 id="7-运行应用程序">7. 运行应用程序<a class="headerlink" href="#7-运行应用程序" title="Permanent link">&para;</a></h4>
<p>确保项目目录结构正确，并在终端中导航到<code>file-upload-download</code>目录，运行以下命令启动服务器：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-717-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-717-1" name="__codelineno-717-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-718-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-718-1" name="__codelineno-718-1"></a>2024/04/27 12:20:00 服务器启动在 http://localhost:8080
</code></pre></div></td></tr></table></div>
<p>打开浏览器，访问<code>http://localhost:8080/upload</code>，可以看到上传页面。</p>
<h4 id="8-测试文件上传和下载">8. 测试文件上传和下载<a class="headerlink" href="#8-测试文件上传和下载" title="Permanent link">&para;</a></h4>
<h5 id="1-上传文件">1. 上传文件<a class="headerlink" href="#1-上传文件" title="Permanent link">&para;</a></h5>
<p>在上传页面，选择一个文件并点击“上传”按钮。</p>
<p><strong>成功响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-719-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-719-1" name="__codelineno-719-1"></a>文件上传成功
</code></pre></div></td></tr></table></div>
<h5 id="2-查看文件列表">2. 查看文件列表<a class="headerlink" href="#2-查看文件列表" title="Permanent link">&para;</a></h5>
<p>访问<code>http://localhost:8080/files</code>，可以看到已上传的文件列表，点击文件名即可下载。</p>
<h5 id="3-下载文件">3. 下载文件<a class="headerlink" href="#3-下载文件" title="Permanent link">&para;</a></h5>
<p>点击文件名后，浏览器将提示下载该文件。</p>
<h4 id="9-代码解析">9. 代码解析<a class="headerlink" href="#9-代码解析" title="Permanent link">&para;</a></h4>
<ul>
<li>表单解析</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>r.ParseMultipartForm</code>解析上传的表单数据，设置内存限制。</li>
<li>
<p>获取文件部分<code>file</code>，通过<code>FormFile</code>方法获取文件句柄和文件信息。</p>
</li>
<li>
<p>文件保存</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>os.Create</code>在<code>uploads</code>目录中创建目标文件。</li>
<li>
<p>使用<code>io.Copy</code>将上传的文件内容复制到目标文件中。</p>
</li>
<li>
<p>文件列表</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p>使用<code>os.ReadDir</code>读取<code>uploads</code>目录下的所有文件，过滤掉子目录。</p>
</li>
<li>
<p>文件下载</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p>使用<code>http.ServeFile</code>发送文件内容，设置<code>Content-Disposition</code>头部提示浏览器下载。</p>
</li>
<li>
<p>安全性考量</p>
</li>
</ul>
<p>：</p>
<ul>
<li>验证上传文件的大小和类型，防止恶意文件上传。</li>
<li>对文件名进行校验，避免路径遍历攻击。</li>
</ul>
<h4 id="10-扩展功能">10. 扩展功能<a class="headerlink" href="#10-扩展功能" title="Permanent link">&para;</a></h4>
<p>为了提升文件管理系统的功能和安全性，可以添加以下扩展：</p>
<ul>
<li><strong>文件类型验证</strong>：限制上传文件的类型，仅允许特定格式的文件。</li>
<li><strong>文件大小限制</strong>：限制上传文件的大小，防止资源耗尽。</li>
<li><strong>用户认证</strong>：实现用户认证，保护文件上传和下载功能。</li>
<li><strong>数据库集成</strong>：将文件信息存储到数据库中，支持更多的文件管理功能。</li>
</ul>
<h3 id="154-并发爬虫">15.4 并发爬虫<a class="headerlink" href="#154-并发爬虫" title="Permanent link">&para;</a></h3>
<p>Web爬虫用于自动化地抓取网页内容，广泛应用于搜索引擎、数据分析等领域。Go语言凭借其并发模型和高性能网络库，是开发高效爬虫的理想选择。本节将指导你构建一个简单的并发Web爬虫，涵盖URL管理、并发抓取、内容提取和结果存储。</p>
<h4 id="1-项目概述_3">1. 项目概述<a class="headerlink" href="#1-项目概述_3" title="Permanent link">&para;</a></h4>
<p>本项目将实现一个简单的并发Web爬虫，具备以下功能：</p>
<ul>
<li>从初始URL开始，抓取网页内容。</li>
<li>解析网页中的链接，加入待抓取队列。</li>
<li>并发抓取多个网页，提高抓取效率。</li>
<li>限制并发数，防止过度抓取导致服务器压力过大。</li>
<li>存储抓取结果，如URL和网页标题。</li>
</ul>
<h4 id="2-项目结构_3">2. 项目结构<a class="headerlink" href="#2-项目结构_3" title="Permanent link">&para;</a></h4>
<p>建议的项目结构如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-720-1">1</a></span>
<span class="normal"><a href="#__codelineno-720-2">2</a></span>
<span class="normal"><a href="#__codelineno-720-3">3</a></span>
<span class="normal"><a href="#__codelineno-720-4">4</a></span>
<span class="normal"><a href="#__codelineno-720-5">5</a></span>
<span class="normal"><a href="#__codelineno-720-6">6</a></span>
<span class="normal"><a href="#__codelineno-720-7">7</a></span>
<span class="normal"><a href="#__codelineno-720-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-720-1" name="__codelineno-720-1"></a>concurrent-crawler/
<a id="__codelineno-720-2" name="__codelineno-720-2"></a>├── main.go
<a id="__codelineno-720-3" name="__codelineno-720-3"></a>├── crawler/
<a id="__codelineno-720-4" name="__codelineno-720-4"></a>│   └── crawler.go
<a id="__codelineno-720-5" name="__codelineno-720-5"></a>├── utils/
<a id="__codelineno-720-6" name="__codelineno-720-6"></a>│   └── url_utils.go
<a id="__codelineno-720-7" name="__codelineno-720-7"></a>├── go.mod
<a id="__codelineno-720-8" name="__codelineno-720-8"></a>└── go.sum
</code></pre></div></td></tr></table></div>
<h4 id="3-初始化项目_2">3. 初始化项目<a class="headerlink" href="#3-初始化项目_2" title="Permanent link">&para;</a></h4>
<p>首先，创建项目目录并初始化Go模块。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-721-1">1</a></span>
<span class="normal"><a href="#__codelineno-721-2">2</a></span>
<span class="normal"><a href="#__codelineno-721-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-721-1" name="__codelineno-721-1"></a>mkdir<span class="w"> </span>concurrent-crawler
<a id="__codelineno-721-2" name="__codelineno-721-2"></a><span class="nb">cd</span><span class="w"> </span>concurrent-crawler
<a id="__codelineno-721-3" name="__codelineno-721-3"></a>go<span class="w"> </span>mod<span class="w"> </span>init<span class="w"> </span>github.com/username/concurrent-crawler
</code></pre></div></td></tr></table></div>
<h4 id="4-安装依赖">4. 安装依赖<a class="headerlink" href="#4-安装依赖" title="Permanent link">&para;</a></h4>
<p>本项目将使用<code>goquery</code>库来解析HTML内容。安装<code>goquery</code>：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-722-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-722-1" name="__codelineno-722-1"></a>go<span class="w"> </span>get<span class="w"> </span>github.com/PuerkitoBio/goquery
</code></pre></div></td></tr></table></div>
<h4 id="5-编写url工具函数">5. 编写URL工具函数<a class="headerlink" href="#5-编写url工具函数" title="Permanent link">&para;</a></h4>
<p>在<code>utils</code>目录下创建<code>url_utils.go</code>文件，定义URL处理相关的函数。</p>
<p><strong>utils/url_utils.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-723-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-723-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-723-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-723-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-723-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-723-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-723-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-723-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-723-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-723-10">10</a></span>
<span class="normal"><a href="#__codelineno-723-11">11</a></span>
<span class="normal"><a href="#__codelineno-723-12">12</a></span>
<span class="normal"><a href="#__codelineno-723-13">13</a></span>
<span class="normal"><a href="#__codelineno-723-14">14</a></span>
<span class="normal"><a href="#__codelineno-723-15">15</a></span>
<span class="normal"><a href="#__codelineno-723-16">16</a></span>
<span class="normal"><a href="#__codelineno-723-17">17</a></span>
<span class="normal"><a href="#__codelineno-723-18">18</a></span>
<span class="normal"><a href="#__codelineno-723-19">19</a></span>
<span class="normal"><a href="#__codelineno-723-20">20</a></span>
<span class="normal"><a href="#__codelineno-723-21">21</a></span>
<span class="normal"><a href="#__codelineno-723-22">22</a></span>
<span class="normal"><a href="#__codelineno-723-23">23</a></span>
<span class="normal"><a href="#__codelineno-723-24">24</a></span>
<span class="normal"><a href="#__codelineno-723-25">25</a></span>
<span class="normal"><a href="#__codelineno-723-26">26</a></span>
<span class="normal"><a href="#__codelineno-723-27">27</a></span>
<span class="normal"><a href="#__codelineno-723-28">28</a></span>
<span class="normal"><a href="#__codelineno-723-29">29</a></span>
<span class="normal"><a href="#__codelineno-723-30">30</a></span>
<span class="normal"><a href="#__codelineno-723-31">31</a></span>
<span class="normal"><a href="#__codelineno-723-32">32</a></span>
<span class="normal"><a href="#__codelineno-723-33">33</a></span>
<span class="normal"><a href="#__codelineno-723-34">34</a></span>
<span class="normal"><a href="#__codelineno-723-35">35</a></span>
<span class="normal"><a href="#__codelineno-723-36">36</a></span>
<span class="normal"><a href="#__codelineno-723-37">37</a></span>
<span class="normal"><a href="#__codelineno-723-38">38</a></span>
<span class="normal"><a href="#__codelineno-723-39">39</a></span>
<span class="normal"><a href="#__codelineno-723-40">40</a></span>
<span class="normal"><a href="#__codelineno-723-41">41</a></span>
<span class="normal"><a href="#__codelineno-723-42">42</a></span>
<span class="normal"><a href="#__codelineno-723-43">43</a></span>
<span class="normal"><a href="#__codelineno-723-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-723-1" name="__codelineno-723-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>
<a id="__codelineno-723-2" name="__codelineno-723-2"></a>
<a id="__codelineno-723-3" name="__codelineno-723-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-723-4" name="__codelineno-723-4"></a><span class="w">    </span><span class="s">&quot;net/url&quot;</span>
<a id="__codelineno-723-5" name="__codelineno-723-5"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-723-6" name="__codelineno-723-6"></a><span class="p">)</span>
<a id="__codelineno-723-7" name="__codelineno-723-7"></a>
<a id="__codelineno-723-8" name="__codelineno-723-8"></a><span class="c1">// IsValidURL 检查URL是否有效</span>
<a id="__codelineno-723-9" name="__codelineno-723-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">IsValidURL</span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-10" name="__codelineno-723-10"></a><span class="w">    </span><span class="nx">parsed</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">ParseRequestURI</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<a id="__codelineno-723-11" name="__codelineno-723-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-12" name="__codelineno-723-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-723-13" name="__codelineno-723-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-723-14" name="__codelineno-723-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">parsed</span><span class="p">.</span><span class="nx">Scheme</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;http&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">parsed</span><span class="p">.</span><span class="nx">Scheme</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;https&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-15" name="__codelineno-723-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-723-16" name="__codelineno-723-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-723-17" name="__codelineno-723-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-723-18" name="__codelineno-723-18"></a><span class="p">}</span>
<a id="__codelineno-723-19" name="__codelineno-723-19"></a>
<a id="__codelineno-723-20" name="__codelineno-723-20"></a><span class="c1">// NormalizeURL 标准化URL，移除片段部分</span>
<a id="__codelineno-723-21" name="__codelineno-723-21"></a><span class="kd">func</span><span class="w"> </span><span class="nx">NormalizeURL</span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-22" name="__codelineno-723-22"></a><span class="w">    </span><span class="nx">parsed</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<a id="__codelineno-723-23" name="__codelineno-723-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-24" name="__codelineno-723-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">u</span>
<a id="__codelineno-723-25" name="__codelineno-723-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-723-26" name="__codelineno-723-26"></a><span class="w">    </span><span class="nx">parsed</span><span class="p">.</span><span class="nx">Fragment</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<a id="__codelineno-723-27" name="__codelineno-723-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">parsed</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<a id="__codelineno-723-28" name="__codelineno-723-28"></a><span class="p">}</span>
<a id="__codelineno-723-29" name="__codelineno-723-29"></a>
<a id="__codelineno-723-30" name="__codelineno-723-30"></a><span class="c1">// ExtractHostname 提取URL的主机名</span>
<a id="__codelineno-723-31" name="__codelineno-723-31"></a><span class="kd">func</span><span class="w"> </span><span class="nx">ExtractHostname</span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-32" name="__codelineno-723-32"></a><span class="w">    </span><span class="nx">parsed</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span>
<a id="__codelineno-723-33" name="__codelineno-723-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-34" name="__codelineno-723-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<a id="__codelineno-723-35" name="__codelineno-723-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-723-36" name="__codelineno-723-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">parsed</span><span class="p">.</span><span class="nx">Hostname</span><span class="p">()</span>
<a id="__codelineno-723-37" name="__codelineno-723-37"></a><span class="p">}</span>
<a id="__codelineno-723-38" name="__codelineno-723-38"></a>
<a id="__codelineno-723-39" name="__codelineno-723-39"></a><span class="c1">// HasSameDomain 检查两个URL是否属于同一域</span>
<a id="__codelineno-723-40" name="__codelineno-723-40"></a><span class="kd">func</span><span class="w"> </span><span class="nx">HasSameDomain</span><span class="p">(</span><span class="nx">u1</span><span class="p">,</span><span class="w"> </span><span class="nx">u2</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-723-41" name="__codelineno-723-41"></a><span class="w">    </span><span class="nx">host1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ExtractHostname</span><span class="p">(</span><span class="nx">u1</span><span class="p">)</span>
<a id="__codelineno-723-42" name="__codelineno-723-42"></a><span class="w">    </span><span class="nx">host2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ExtractHostname</span><span class="p">(</span><span class="nx">u2</span><span class="p">)</span>
<a id="__codelineno-723-43" name="__codelineno-723-43"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">EqualFold</span><span class="p">(</span><span class="nx">host1</span><span class="p">,</span><span class="w"> </span><span class="nx">host2</span><span class="p">)</span>
<a id="__codelineno-723-44" name="__codelineno-723-44"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>IsValidURL</strong>：验证URL格式和协议。</li>
<li><strong>NormalizeURL</strong>：标准化URL，去除片段（如<code>#section</code>）。</li>
<li><strong>ExtractHostname</strong>：提取URL的主机名。</li>
<li><strong>HasSameDomain</strong>：检查两个URL是否属于同一域，防止跨域抓取。</li>
</ul>
<h4 id="6-编写爬虫逻辑">6. 编写爬虫逻辑<a class="headerlink" href="#6-编写爬虫逻辑" title="Permanent link">&para;</a></h4>
<p>在<code>crawler</code>目录下创建<code>crawler.go</code>文件，实现爬虫的核心逻辑。</p>
<p><strong>crawler/crawler.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-724-1">  1</a></span>
<span class="normal"><a href="#__codelineno-724-2">  2</a></span>
<span class="normal"><a href="#__codelineno-724-3">  3</a></span>
<span class="normal"><a href="#__codelineno-724-4">  4</a></span>
<span class="normal"><a href="#__codelineno-724-5">  5</a></span>
<span class="normal"><a href="#__codelineno-724-6">  6</a></span>
<span class="normal"><a href="#__codelineno-724-7">  7</a></span>
<span class="normal"><a href="#__codelineno-724-8">  8</a></span>
<span class="normal"><a href="#__codelineno-724-9">  9</a></span>
<span class="normal"><a href="#__codelineno-724-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-724-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-724-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-724-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-724-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-724-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-724-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-724-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-724-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-724-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-724-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-724-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-724-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-724-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-724-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-724-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-724-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-724-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-724-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-724-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-724-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-724-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-724-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-724-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-724-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-724-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-724-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-724-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-724-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-724-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-724-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-724-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-724-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-724-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-724-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-724-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-724-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-724-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-724-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-724-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-724-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-724-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-724-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-724-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-724-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-724-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-724-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-724-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-724-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-724-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-724-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-724-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-724-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-724-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-724-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-724-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-724-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-724-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-724-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-724-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-724-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-724-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-724-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-724-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-724-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-724-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-724-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-724-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-724-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-724-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-724-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-724-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-724-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-724-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-724-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-724-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-724-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-724-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-724-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-724-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-724-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-724-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-724-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-724-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-724-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-724-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-724-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-724-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-724-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-724-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-724-100">100</a></span>
<span class="normal"><a href="#__codelineno-724-101">101</a></span>
<span class="normal"><a href="#__codelineno-724-102">102</a></span>
<span class="normal"><a href="#__codelineno-724-103">103</a></span>
<span class="normal"><a href="#__codelineno-724-104">104</a></span>
<span class="normal"><a href="#__codelineno-724-105">105</a></span>
<span class="normal"><a href="#__codelineno-724-106">106</a></span>
<span class="normal"><a href="#__codelineno-724-107">107</a></span>
<span class="normal"><a href="#__codelineno-724-108">108</a></span>
<span class="normal"><a href="#__codelineno-724-109">109</a></span>
<span class="normal"><a href="#__codelineno-724-110">110</a></span>
<span class="normal"><a href="#__codelineno-724-111">111</a></span>
<span class="normal"><a href="#__codelineno-724-112">112</a></span>
<span class="normal"><a href="#__codelineno-724-113">113</a></span>
<span class="normal"><a href="#__codelineno-724-114">114</a></span>
<span class="normal"><a href="#__codelineno-724-115">115</a></span>
<span class="normal"><a href="#__codelineno-724-116">116</a></span>
<span class="normal"><a href="#__codelineno-724-117">117</a></span>
<span class="normal"><a href="#__codelineno-724-118">118</a></span>
<span class="normal"><a href="#__codelineno-724-119">119</a></span>
<span class="normal"><a href="#__codelineno-724-120">120</a></span>
<span class="normal"><a href="#__codelineno-724-121">121</a></span>
<span class="normal"><a href="#__codelineno-724-122">122</a></span>
<span class="normal"><a href="#__codelineno-724-123">123</a></span>
<span class="normal"><a href="#__codelineno-724-124">124</a></span>
<span class="normal"><a href="#__codelineno-724-125">125</a></span>
<span class="normal"><a href="#__codelineno-724-126">126</a></span>
<span class="normal"><a href="#__codelineno-724-127">127</a></span>
<span class="normal"><a href="#__codelineno-724-128">128</a></span>
<span class="normal"><a href="#__codelineno-724-129">129</a></span>
<span class="normal"><a href="#__codelineno-724-130">130</a></span>
<span class="normal"><a href="#__codelineno-724-131">131</a></span>
<span class="normal"><a href="#__codelineno-724-132">132</a></span>
<span class="normal"><a href="#__codelineno-724-133">133</a></span>
<span class="normal"><a href="#__codelineno-724-134">134</a></span>
<span class="normal"><a href="#__codelineno-724-135">135</a></span>
<span class="normal"><a href="#__codelineno-724-136">136</a></span>
<span class="normal"><a href="#__codelineno-724-137">137</a></span>
<span class="normal"><a href="#__codelineno-724-138">138</a></span>
<span class="normal"><a href="#__codelineno-724-139">139</a></span>
<span class="normal"><a href="#__codelineno-724-140">140</a></span>
<span class="normal"><a href="#__codelineno-724-141">141</a></span>
<span class="normal"><a href="#__codelineno-724-142">142</a></span>
<span class="normal"><a href="#__codelineno-724-143">143</a></span>
<span class="normal"><a href="#__codelineno-724-144">144</a></span>
<span class="normal"><a href="#__codelineno-724-145">145</a></span>
<span class="normal"><a href="#__codelineno-724-146">146</a></span>
<span class="normal"><a href="#__codelineno-724-147">147</a></span>
<span class="normal"><a href="#__codelineno-724-148">148</a></span>
<span class="normal"><a href="#__codelineno-724-149">149</a></span>
<span class="normal"><a href="#__codelineno-724-150">150</a></span>
<span class="normal"><a href="#__codelineno-724-151">151</a></span>
<span class="normal"><a href="#__codelineno-724-152">152</a></span>
<span class="normal"><a href="#__codelineno-724-153">153</a></span>
<span class="normal"><a href="#__codelineno-724-154">154</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-724-1" name="__codelineno-724-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">crawler</span>
<a id="__codelineno-724-2" name="__codelineno-724-2"></a>
<a id="__codelineno-724-3" name="__codelineno-724-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-724-4" name="__codelineno-724-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-724-5" name="__codelineno-724-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-724-6" name="__codelineno-724-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-724-7" name="__codelineno-724-7"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-724-8" name="__codelineno-724-8"></a>
<a id="__codelineno-724-9" name="__codelineno-724-9"></a><span class="w">    </span><span class="s">&quot;github.com/PuerkitoBio/goquery&quot;</span>
<a id="__codelineno-724-10" name="__codelineno-724-10"></a><span class="w">    </span><span class="s">&quot;github.com/username/concurrent-crawler/utils&quot;</span>
<a id="__codelineno-724-11" name="__codelineno-724-11"></a><span class="p">)</span>
<a id="__codelineno-724-12" name="__codelineno-724-12"></a>
<a id="__codelineno-724-13" name="__codelineno-724-13"></a><span class="c1">// CrawlResult 定义抓取结果结构体</span>
<a id="__codelineno-724-14" name="__codelineno-724-14"></a><span class="kd">type</span><span class="w"> </span><span class="nx">CrawlResult</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-15" name="__codelineno-724-15"></a><span class="w">    </span><span class="nx">URL</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-724-16" name="__codelineno-724-16"></a><span class="w">    </span><span class="nx">Title</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-724-17" name="__codelineno-724-17"></a><span class="p">}</span>
<a id="__codelineno-724-18" name="__codelineno-724-18"></a>
<a id="__codelineno-724-19" name="__codelineno-724-19"></a><span class="c1">// Crawler 定义爬虫结构体</span>
<a id="__codelineno-724-20" name="__codelineno-724-20"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Crawler</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-21" name="__codelineno-724-21"></a><span class="w">    </span><span class="c1">// 初始URL</span>
<a id="__codelineno-724-22" name="__codelineno-724-22"></a><span class="w">    </span><span class="nx">StartURL</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-724-23" name="__codelineno-724-23"></a><span class="w">    </span><span class="c1">// 最大抓取深度</span>
<a id="__codelineno-724-24" name="__codelineno-724-24"></a><span class="w">    </span><span class="nx">MaxDepth</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-724-25" name="__codelineno-724-25"></a><span class="w">    </span><span class="c1">// 并发抓取数</span>
<a id="__codelineno-724-26" name="__codelineno-724-26"></a><span class="w">    </span><span class="nx">MaxWorkers</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-724-27" name="__codelineno-724-27"></a><span class="w">    </span><span class="c1">// 结果存储</span>
<a id="__codelineno-724-28" name="__codelineno-724-28"></a><span class="w">    </span><span class="nx">Results</span><span class="w"> </span><span class="p">[]</span><span class="nx">CrawlResult</span>
<a id="__codelineno-724-29" name="__codelineno-724-29"></a><span class="w">    </span><span class="c1">// 已访问的URL</span>
<a id="__codelineno-724-30" name="__codelineno-724-30"></a><span class="w">    </span><span class="nx">visited</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span>
<a id="__codelineno-724-31" name="__codelineno-724-31"></a><span class="w">    </span><span class="c1">// 互斥锁</span>
<a id="__codelineno-724-32" name="__codelineno-724-32"></a><span class="w">    </span><span class="nx">mu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-724-33" name="__codelineno-724-33"></a><span class="w">    </span><span class="c1">// 等待组</span>
<a id="__codelineno-724-34" name="__codelineno-724-34"></a><span class="w">    </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-724-35" name="__codelineno-724-35"></a><span class="w">    </span><span class="c1">// 任务队列</span>
<a id="__codelineno-724-36" name="__codelineno-724-36"></a><span class="w">    </span><span class="nx">tasks</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="nx">Task</span>
<a id="__codelineno-724-37" name="__codelineno-724-37"></a><span class="p">}</span>
<a id="__codelineno-724-38" name="__codelineno-724-38"></a>
<a id="__codelineno-724-39" name="__codelineno-724-39"></a><span class="c1">// Task 定义抓取任务</span>
<a id="__codelineno-724-40" name="__codelineno-724-40"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-41" name="__codelineno-724-41"></a><span class="w">    </span><span class="nx">URL</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-724-42" name="__codelineno-724-42"></a><span class="w">    </span><span class="nx">Depth</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-724-43" name="__codelineno-724-43"></a><span class="p">}</span>
<a id="__codelineno-724-44" name="__codelineno-724-44"></a>
<a id="__codelineno-724-45" name="__codelineno-724-45"></a><span class="c1">// NewCrawler 创建一个新的爬虫实例</span>
<a id="__codelineno-724-46" name="__codelineno-724-46"></a><span class="kd">func</span><span class="w"> </span><span class="nx">NewCrawler</span><span class="p">(</span><span class="nx">startURL</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">maxDepth</span><span class="p">,</span><span class="w"> </span><span class="nx">maxWorkers</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Crawler</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-47" name="__codelineno-724-47"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Crawler</span><span class="p">{</span>
<a id="__codelineno-724-48" name="__codelineno-724-48"></a><span class="w">        </span><span class="nx">StartURL</span><span class="p">:</span><span class="w">   </span><span class="nx">startURL</span><span class="p">,</span>
<a id="__codelineno-724-49" name="__codelineno-724-49"></a><span class="w">        </span><span class="nx">MaxDepth</span><span class="p">:</span><span class="w">   </span><span class="nx">maxDepth</span><span class="p">,</span>
<a id="__codelineno-724-50" name="__codelineno-724-50"></a><span class="w">        </span><span class="nx">MaxWorkers</span><span class="p">:</span><span class="w"> </span><span class="nx">maxWorkers</span><span class="p">,</span>
<a id="__codelineno-724-51" name="__codelineno-724-51"></a><span class="w">        </span><span class="nx">Results</span><span class="p">:</span><span class="w">    </span><span class="p">[]</span><span class="nx">CrawlResult</span><span class="p">{},</span>
<a id="__codelineno-724-52" name="__codelineno-724-52"></a><span class="w">        </span><span class="nx">visited</span><span class="p">:</span><span class="w">    </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">),</span>
<a id="__codelineno-724-53" name="__codelineno-724-53"></a><span class="w">        </span><span class="nx">tasks</span><span class="p">:</span><span class="w">      </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="nx">maxWorkers</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-724-54" name="__codelineno-724-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-55" name="__codelineno-724-55"></a><span class="p">}</span>
<a id="__codelineno-724-56" name="__codelineno-724-56"></a>
<a id="__codelineno-724-57" name="__codelineno-724-57"></a><span class="c1">// Start 启动爬虫</span>
<a id="__codelineno-724-58" name="__codelineno-724-58"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Crawler</span><span class="p">)</span><span class="w"> </span><span class="nx">Start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-59" name="__codelineno-724-59"></a><span class="w">    </span><span class="c1">// 启动工作者</span>
<a id="__codelineno-724-60" name="__codelineno-724-60"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">MaxWorkers</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-61" name="__codelineno-724-61"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-724-62" name="__codelineno-724-62"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">worker</span><span class="p">()</span>
<a id="__codelineno-724-63" name="__codelineno-724-63"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-64" name="__codelineno-724-64"></a>
<a id="__codelineno-724-65" name="__codelineno-724-65"></a><span class="w">    </span><span class="c1">// 添加初始任务</span>
<a id="__codelineno-724-66" name="__codelineno-724-66"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">enqueue</span><span class="p">(</span><span class="nx">Task</span><span class="p">{</span><span class="nx">URL</span><span class="p">:</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">StartURL</span><span class="p">,</span><span class="w"> </span><span class="nx">Depth</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">})</span>
<a id="__codelineno-724-67" name="__codelineno-724-67"></a>
<a id="__codelineno-724-68" name="__codelineno-724-68"></a><span class="w">    </span><span class="c1">// 等待所有工作者完成</span>
<a id="__codelineno-724-69" name="__codelineno-724-69"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<a id="__codelineno-724-70" name="__codelineno-724-70"></a><span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tasks</span><span class="p">)</span>
<a id="__codelineno-724-71" name="__codelineno-724-71"></a><span class="p">}</span>
<a id="__codelineno-724-72" name="__codelineno-724-72"></a>
<a id="__codelineno-724-73" name="__codelineno-724-73"></a><span class="c1">// worker 定义工作者逻辑</span>
<a id="__codelineno-724-74" name="__codelineno-724-74"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Crawler</span><span class="p">)</span><span class="w"> </span><span class="nx">worker</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-75" name="__codelineno-724-75"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<a id="__codelineno-724-76" name="__codelineno-724-76"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">tasks</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-77" name="__codelineno-724-77"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<a id="__codelineno-724-78" name="__codelineno-724-78"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-79" name="__codelineno-724-79"></a><span class="p">}</span>
<a id="__codelineno-724-80" name="__codelineno-724-80"></a>
<a id="__codelineno-724-81" name="__codelineno-724-81"></a><span class="c1">// enqueue 添加任务到队列</span>
<a id="__codelineno-724-82" name="__codelineno-724-82"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Crawler</span><span class="p">)</span><span class="w"> </span><span class="nx">enqueue</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="nx">Task</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-83" name="__codelineno-724-83"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-724-84" name="__codelineno-724-84"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-724-85" name="__codelineno-724-85"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">visited</span><span class="p">[</span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Depth</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">MaxDepth</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-86" name="__codelineno-724-86"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">visited</span><span class="p">[</span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-724-87" name="__codelineno-724-87"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">tasks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">task</span>
<a id="__codelineno-724-88" name="__codelineno-724-88"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-89" name="__codelineno-724-89"></a><span class="p">}</span>
<a id="__codelineno-724-90" name="__codelineno-724-90"></a>
<a id="__codelineno-724-91" name="__codelineno-724-91"></a><span class="c1">// process 处理单个任务</span>
<a id="__codelineno-724-92" name="__codelineno-724-92"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Crawler</span><span class="p">)</span><span class="w"> </span><span class="nx">process</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="nx">Task</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-93" name="__codelineno-724-93"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;抓取: %s (深度: %d)\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Depth</span><span class="p">)</span>
<a id="__codelineno-724-94" name="__codelineno-724-94"></a>
<a id="__codelineno-724-95" name="__codelineno-724-95"></a><span class="w">    </span><span class="c1">// 发送HTTP请求</span>
<a id="__codelineno-724-96" name="__codelineno-724-96"></a><span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span>
<a id="__codelineno-724-97" name="__codelineno-724-97"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-98" name="__codelineno-724-98"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;请求失败: %s - %v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-724-99" name="__codelineno-724-99"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-724-100" name="__codelineno-724-100"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-101" name="__codelineno-724-101"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-724-102" name="__codelineno-724-102"></a>
<a id="__codelineno-724-103" name="__codelineno-724-103"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-104" name="__codelineno-724-104"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;非正常状态码: %s - %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>
<a id="__codelineno-724-105" name="__codelineno-724-105"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-724-106" name="__codelineno-724-106"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-107" name="__codelineno-724-107"></a>
<a id="__codelineno-724-108" name="__codelineno-724-108"></a><span class="w">    </span><span class="c1">// 解析HTML</span>
<a id="__codelineno-724-109" name="__codelineno-724-109"></a><span class="w">    </span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">goquery</span><span class="p">.</span><span class="nx">NewDocumentFromReader</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<a id="__codelineno-724-110" name="__codelineno-724-110"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-111" name="__codelineno-724-111"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;解析HTML失败: %s - %v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-724-112" name="__codelineno-724-112"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-724-113" name="__codelineno-724-113"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-114" name="__codelineno-724-114"></a>
<a id="__codelineno-724-115" name="__codelineno-724-115"></a><span class="w">    </span><span class="c1">// 提取标题</span>
<a id="__codelineno-724-116" name="__codelineno-724-116"></a><span class="w">    </span><span class="nx">title</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">Find</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">).</span><span class="nx">Text</span><span class="p">()</span>
<a id="__codelineno-724-117" name="__codelineno-724-117"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-724-118" name="__codelineno-724-118"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Results</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Results</span><span class="p">,</span><span class="w"> </span><span class="nx">CrawlResult</span><span class="p">{</span><span class="nx">URL</span><span class="p">:</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="nx">title</span><span class="p">})</span>
<a id="__codelineno-724-119" name="__codelineno-724-119"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-724-120" name="__codelineno-724-120"></a>
<a id="__codelineno-724-121" name="__codelineno-724-121"></a><span class="w">    </span><span class="c1">// 如果达到最大深度，不继续抓取</span>
<a id="__codelineno-724-122" name="__codelineno-724-122"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Depth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">MaxDepth</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-123" name="__codelineno-724-123"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-724-124" name="__codelineno-724-124"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-724-125" name="__codelineno-724-125"></a>
<a id="__codelineno-724-126" name="__codelineno-724-126"></a><span class="w">    </span><span class="c1">// 提取链接并添加新任务</span>
<a id="__codelineno-724-127" name="__codelineno-724-127"></a><span class="w">    </span><span class="nx">doc</span><span class="p">.</span><span class="nx">Find</span><span class="p">(</span><span class="s">&quot;a[href]&quot;</span><span class="p">).</span><span class="nx">Each</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">goquery</span><span class="p">.</span><span class="nx">Selection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-128" name="__codelineno-724-128"></a><span class="w">        </span><span class="nx">href</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Attr</span><span class="p">(</span><span class="s">&quot;href&quot;</span><span class="p">)</span>
<a id="__codelineno-724-129" name="__codelineno-724-129"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-130" name="__codelineno-724-130"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-724-131" name="__codelineno-724-131"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-724-132" name="__codelineno-724-132"></a>
<a id="__codelineno-724-133" name="__codelineno-724-133"></a><span class="w">        </span><span class="c1">// 规范化URL</span>
<a id="__codelineno-724-134" name="__codelineno-724-134"></a><span class="w">        </span><span class="nx">href</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">NormalizeURL</span><span class="p">(</span><span class="nx">href</span><span class="p">)</span>
<a id="__codelineno-724-135" name="__codelineno-724-135"></a>
<a id="__codelineno-724-136" name="__codelineno-724-136"></a><span class="w">        </span><span class="c1">// 检查URL有效性</span>
<a id="__codelineno-724-137" name="__codelineno-724-137"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">utils</span><span class="p">.</span><span class="nx">IsValidURL</span><span class="p">(</span><span class="nx">href</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-138" name="__codelineno-724-138"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-724-139" name="__codelineno-724-139"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-724-140" name="__codelineno-724-140"></a>
<a id="__codelineno-724-141" name="__codelineno-724-141"></a><span class="w">        </span><span class="c1">// 确保在同一域名下</span>
<a id="__codelineno-724-142" name="__codelineno-724-142"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">utils</span><span class="p">.</span><span class="nx">HasSameDomain</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">StartURL</span><span class="p">,</span><span class="w"> </span><span class="nx">href</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-143" name="__codelineno-724-143"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-724-144" name="__codelineno-724-144"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-724-145" name="__codelineno-724-145"></a>
<a id="__codelineno-724-146" name="__codelineno-724-146"></a><span class="w">        </span><span class="c1">// 添加新任务</span>
<a id="__codelineno-724-147" name="__codelineno-724-147"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">enqueue</span><span class="p">(</span><span class="nx">Task</span><span class="p">{</span><span class="nx">URL</span><span class="p">:</span><span class="w"> </span><span class="nx">href</span><span class="p">,</span><span class="w"> </span><span class="nx">Depth</span><span class="p">:</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Depth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">})</span>
<a id="__codelineno-724-148" name="__codelineno-724-148"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-724-149" name="__codelineno-724-149"></a><span class="p">}</span>
<a id="__codelineno-724-150" name="__codelineno-724-150"></a>
<a id="__codelineno-724-151" name="__codelineno-724-151"></a><span class="c1">// GetResults 获取抓取结果</span>
<a id="__codelineno-724-152" name="__codelineno-724-152"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Crawler</span><span class="p">)</span><span class="w"> </span><span class="nx">GetResults</span><span class="p">()</span><span class="w"> </span><span class="p">[]</span><span class="nx">CrawlResult</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-724-153" name="__codelineno-724-153"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Results</span>
<a id="__codelineno-724-154" name="__codelineno-724-154"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>Crawler 结构体</strong>：</li>
<li><code>StartURL</code>：爬虫的起始URL。</li>
<li><code>MaxDepth</code>：爬取的最大深度，防止无限抓取。</li>
<li><code>MaxWorkers</code>：并发抓取的工作者数量。</li>
<li><code>Results</code>：存储抓取结果，包括URL和标题。</li>
<li><code>visited</code>：记录已访问的URL，避免重复抓取。</li>
<li><code>tasks</code>：任务队列，存储待抓取的任务。</li>
<li><strong>Task 结构体</strong>：定义抓取任务，包括URL和当前深度。</li>
<li><strong>Start 方法</strong>：启动爬虫，创建工作者并添加初始任务，等待所有工作者完成。</li>
<li><strong>worker 方法</strong>：工作者从任务队列中接收任务并处理。</li>
<li><strong>enqueue 方法</strong>：将新任务添加到队列，确保未访问过且未超过最大深度。</li>
<li><strong>process 方法</strong>：</li>
<li>发送HTTP GET请求获取网页内容。</li>
<li>使用<code>goquery</code>解析HTML，提取网页标题。</li>
<li>如果当前深度未达到最大深度，提取页面中的链接，创建新任务。</li>
</ul>
<h4 id="7-编写主程序">7. 编写主程序<a class="headerlink" href="#7-编写主程序" title="Permanent link">&para;</a></h4>
<p>在<code>main.go</code>文件中，配置并启动爬虫。</p>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-725-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-725-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-725-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-725-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-725-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-725-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-725-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-725-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-725-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-725-10">10</a></span>
<span class="normal"><a href="#__codelineno-725-11">11</a></span>
<span class="normal"><a href="#__codelineno-725-12">12</a></span>
<span class="normal"><a href="#__codelineno-725-13">13</a></span>
<span class="normal"><a href="#__codelineno-725-14">14</a></span>
<span class="normal"><a href="#__codelineno-725-15">15</a></span>
<span class="normal"><a href="#__codelineno-725-16">16</a></span>
<span class="normal"><a href="#__codelineno-725-17">17</a></span>
<span class="normal"><a href="#__codelineno-725-18">18</a></span>
<span class="normal"><a href="#__codelineno-725-19">19</a></span>
<span class="normal"><a href="#__codelineno-725-20">20</a></span>
<span class="normal"><a href="#__codelineno-725-21">21</a></span>
<span class="normal"><a href="#__codelineno-725-22">22</a></span>
<span class="normal"><a href="#__codelineno-725-23">23</a></span>
<span class="normal"><a href="#__codelineno-725-24">24</a></span>
<span class="normal"><a href="#__codelineno-725-25">25</a></span>
<span class="normal"><a href="#__codelineno-725-26">26</a></span>
<span class="normal"><a href="#__codelineno-725-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-725-1" name="__codelineno-725-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-725-2" name="__codelineno-725-2"></a>
<a id="__codelineno-725-3" name="__codelineno-725-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-725-4" name="__codelineno-725-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-725-5" name="__codelineno-725-5"></a>
<a id="__codelineno-725-6" name="__codelineno-725-6"></a><span class="w">    </span><span class="s">&quot;github.com/username/concurrent-crawler/crawler&quot;</span>
<a id="__codelineno-725-7" name="__codelineno-725-7"></a><span class="p">)</span>
<a id="__codelineno-725-8" name="__codelineno-725-8"></a>
<a id="__codelineno-725-9" name="__codelineno-725-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-725-10" name="__codelineno-725-10"></a><span class="w">    </span><span class="nx">startURL</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;https://golang.org/&quot;</span>
<a id="__codelineno-725-11" name="__codelineno-725-11"></a><span class="w">    </span><span class="nx">maxDepth</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-725-12" name="__codelineno-725-12"></a><span class="w">    </span><span class="nx">maxWorkers</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-725-13" name="__codelineno-725-13"></a>
<a id="__codelineno-725-14" name="__codelineno-725-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;启动爬虫: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">startURL</span><span class="p">)</span>
<a id="__codelineno-725-15" name="__codelineno-725-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;最大深度: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">maxDepth</span><span class="p">)</span>
<a id="__codelineno-725-16" name="__codelineno-725-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;并发工作者: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">maxWorkers</span><span class="p">)</span>
<a id="__codelineno-725-17" name="__codelineno-725-17"></a>
<a id="__codelineno-725-18" name="__codelineno-725-18"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">crawler</span><span class="p">.</span><span class="nx">NewCrawler</span><span class="p">(</span><span class="nx">startURL</span><span class="p">,</span><span class="w"> </span><span class="nx">maxDepth</span><span class="p">,</span><span class="w"> </span><span class="nx">maxWorkers</span><span class="p">)</span>
<a id="__codelineno-725-19" name="__codelineno-725-19"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
<a id="__codelineno-725-20" name="__codelineno-725-20"></a>
<a id="__codelineno-725-21" name="__codelineno-725-21"></a><span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetResults</span><span class="p">()</span>
<a id="__codelineno-725-22" name="__codelineno-725-22"></a>
<a id="__codelineno-725-23" name="__codelineno-725-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;\n抓取结果:&quot;</span><span class="p">)</span>
<a id="__codelineno-725-24" name="__codelineno-725-24"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-725-25" name="__codelineno-725-25"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;URL: %s\n标题: %s\n\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
<a id="__codelineno-725-26" name="__codelineno-725-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-725-27" name="__codelineno-725-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>设置爬虫的起始URL、最大深度和并发工作者数量。</li>
<li>创建<code>Crawler</code>实例并启动爬虫。</li>
<li>获取并打印抓取结果。</li>
</ul>
<h4 id="8-运行爬虫">8. 运行爬虫<a class="headerlink" href="#8-运行爬虫" title="Permanent link">&para;</a></h4>
<p>在终端中导航到<code>concurrent-crawler</code>目录，运行以下命令启动爬虫：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-726-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-726-1" name="__codelineno-726-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-727-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-727-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-727-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-727-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-727-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-727-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-727-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-727-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-727-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-727-10">10</a></span>
<span class="normal"><a href="#__codelineno-727-11">11</a></span>
<span class="normal"><a href="#__codelineno-727-12">12</a></span>
<span class="normal"><a href="#__codelineno-727-13">13</a></span>
<span class="normal"><a href="#__codelineno-727-14">14</a></span>
<span class="normal"><a href="#__codelineno-727-15">15</a></span>
<span class="normal"><a href="#__codelineno-727-16">16</a></span>
<span class="normal"><a href="#__codelineno-727-17">17</a></span>
<span class="normal"><a href="#__codelineno-727-18">18</a></span>
<span class="normal"><a href="#__codelineno-727-19">19</a></span>
<span class="normal"><a href="#__codelineno-727-20">20</a></span>
<span class="normal"><a href="#__codelineno-727-21">21</a></span>
<span class="normal"><a href="#__codelineno-727-22">22</a></span>
<span class="normal"><a href="#__codelineno-727-23">23</a></span>
<span class="normal"><a href="#__codelineno-727-24">24</a></span>
<span class="normal"><a href="#__codelineno-727-25">25</a></span>
<span class="normal"><a href="#__codelineno-727-26">26</a></span>
<span class="normal"><a href="#__codelineno-727-27">27</a></span>
<span class="normal"><a href="#__codelineno-727-28">28</a></span>
<span class="normal"><a href="#__codelineno-727-29">29</a></span>
<span class="normal"><a href="#__codelineno-727-30">30</a></span>
<span class="normal"><a href="#__codelineno-727-31">31</a></span>
<span class="normal"><a href="#__codelineno-727-32">32</a></span>
<span class="normal"><a href="#__codelineno-727-33">33</a></span>
<span class="normal"><a href="#__codelineno-727-34">34</a></span>
<span class="normal"><a href="#__codelineno-727-35">35</a></span>
<span class="normal"><a href="#__codelineno-727-36">36</a></span>
<span class="normal"><a href="#__codelineno-727-37">37</a></span>
<span class="normal"><a href="#__codelineno-727-38">38</a></span>
<span class="normal"><a href="#__codelineno-727-39">39</a></span>
<span class="normal"><a href="#__codelineno-727-40">40</a></span>
<span class="normal"><a href="#__codelineno-727-41">41</a></span>
<span class="normal"><a href="#__codelineno-727-42">42</a></span>
<span class="normal"><a href="#__codelineno-727-43">43</a></span>
<span class="normal"><a href="#__codelineno-727-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-727-1" name="__codelineno-727-1"></a>启动爬虫: https://golang.org/
<a id="__codelineno-727-2" name="__codelineno-727-2"></a>最大深度: 2
<a id="__codelineno-727-3" name="__codelineno-727-3"></a>并发工作者: 10
<a id="__codelineno-727-4" name="__codelineno-727-4"></a>抓取: https://golang.org/ (深度: 0)
<a id="__codelineno-727-5" name="__codelineno-727-5"></a>抓取: https://golang.org/doc/ (深度: 1)
<a id="__codelineno-727-6" name="__codelineno-727-6"></a>抓取: https://golang.org/help/ (深度: 1)
<a id="__codelineno-727-7" name="__codelineno-727-7"></a>抓取: https://golang.org/faq/ (深度: 1)
<a id="__codelineno-727-8" name="__codelineno-727-8"></a>抓取: https://golang.org/pkg/ (深度: 1)
<a id="__codelineno-727-9" name="__codelineno-727-9"></a>抓取: https://golang.org/doc/effective_go.html (深度: 2)
<a id="__codelineno-727-10" name="__codelineno-727-10"></a>抓取: https://golang.org/doc/code.html (深度: 2)
<a id="__codelineno-727-11" name="__codelineno-727-11"></a>抓取: https://golang.org/doc/codewalk.html (深度: 2)
<a id="__codelineno-727-12" name="__codelineno-727-12"></a>抓取: https://golang.org/doc/tutorial/create-module.html (深度: 2)
<a id="__codelineno-727-13" name="__codelineno-727-13"></a>抓取: https://golang.org/doc/tutorial/create-module.html#init (深度: 2)
<a id="__codelineno-727-14" name="__codelineno-727-14"></a>
<a id="__codelineno-727-15" name="__codelineno-727-15"></a>抓取结果:
<a id="__codelineno-727-16" name="__codelineno-727-16"></a>URL: https://golang.org/
<a id="__codelineno-727-17" name="__codelineno-727-17"></a>标题: The Go Programming Language
<a id="__codelineno-727-18" name="__codelineno-727-18"></a>
<a id="__codelineno-727-19" name="__codelineno-727-19"></a>URL: https://golang.org/doc/
<a id="__codelineno-727-20" name="__codelineno-727-20"></a>标题: Documentation
<a id="__codelineno-727-21" name="__codelineno-727-21"></a>
<a id="__codelineno-727-22" name="__codelineno-727-22"></a>URL: https://golang.org/help/
<a id="__codelineno-727-23" name="__codelineno-727-23"></a>标题: Go Documentation - The Go Programming Language
<a id="__codelineno-727-24" name="__codelineno-727-24"></a>
<a id="__codelineno-727-25" name="__codelineno-727-25"></a>URL: https://golang.org/faq/
<a id="__codelineno-727-26" name="__codelineno-727-26"></a>标题: Frequently Asked Questions
<a id="__codelineno-727-27" name="__codelineno-727-27"></a>
<a id="__codelineno-727-28" name="__codelineno-727-28"></a>URL: https://golang.org/pkg/
<a id="__codelineno-727-29" name="__codelineno-727-29"></a>标题: Packages
<a id="__codelineno-727-30" name="__codelineno-727-30"></a>
<a id="__codelineno-727-31" name="__codelineno-727-31"></a>URL: https://golang.org/doc/effective_go.html
<a id="__codelineno-727-32" name="__codelineno-727-32"></a>标题: Effective Go
<a id="__codelineno-727-33" name="__codelineno-727-33"></a>
<a id="__codelineno-727-34" name="__codelineno-727-34"></a>URL: https://golang.org/doc/code.html
<a id="__codelineno-727-35" name="__codelineno-727-35"></a>标题: Organizing Go Code
<a id="__codelineno-727-36" name="__codelineno-727-36"></a>
<a id="__codelineno-727-37" name="__codelineno-727-37"></a>URL: https://golang.org/doc/codewalk.html
<a id="__codelineno-727-38" name="__codelineno-727-38"></a>标题: Code Walkthrough
<a id="__codelineno-727-39" name="__codelineno-727-39"></a>
<a id="__codelineno-727-40" name="__codelineno-727-40"></a>URL: https://golang.org/doc/tutorial/create-module.html
<a id="__codelineno-727-41" name="__codelineno-727-41"></a>标题: Creating a Go Module
<a id="__codelineno-727-42" name="__codelineno-727-42"></a>
<a id="__codelineno-727-43" name="__codelineno-727-43"></a>URL: https://golang.org/doc/tutorial/create-module.html#init
<a id="__codelineno-727-44" name="__codelineno-727-44"></a>标题: Initializing a Go Module
</code></pre></div></td></tr></table></div>
<h4 id="9-代码解析_1">9. 代码解析<a class="headerlink" href="#9-代码解析_1" title="Permanent link">&para;</a></h4>
<ul>
<li>并发抓取</li>
</ul>
<p>：</p>
<ul>
<li>使用Goroutine和任务队列实现并发抓取，提升效率。</li>
<li>
<p>通过<code>sync.WaitGroup</code>等待所有工作者完成。</p>
</li>
<li>
<p>URL管理</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>visited</code>映射记录已访问的URL，避免重复抓取。</li>
<li>
<p>通过<code>MaxDepth</code>限制抓取深度，防止无限循环。</p>
</li>
<li>
<p>内容提取</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>goquery</code>解析HTML内容，提取网页标题和链接。</li>
<li>
<p>规范化和验证链接，确保抓取同一域下的有效URL。</p>
</li>
<li>
<p>错误处理</p>
</li>
</ul>
<p>：</p>
<ul>
<li>
<p>处理HTTP请求错误和HTML解析错误，确保爬虫的稳定性。</p>
</li>
<li>
<p>结果存储</p>
</li>
</ul>
<p>：</p>
<ul>
<li>将抓取结果存储在<code>Results</code>切片中，包含URL和标题信息。</li>
</ul>
<h4 id="10-扩展功能_1">10. 扩展功能<a class="headerlink" href="#10-扩展功能_1" title="Permanent link">&para;</a></h4>
<p>为了提升爬虫的功能和性能，可以添加以下扩展：</p>
<ul>
<li><strong>延迟和速率限制</strong>：在抓取请求之间添加延迟，避免对目标服务器造成过大压力。</li>
<li><strong>深度优先或广度优先搜索</strong>：根据需求选择不同的抓取策略。</li>
<li><strong>代理支持</strong>：通过代理服务器发送请求，隐藏真实IP。</li>
<li><strong>错误重试</strong>：在请求失败时，自动重试特定次数。</li>
<li><strong>数据存储</strong>：将抓取结果存储到数据库或文件中，便于后续分析。</li>
</ul>
<h3 id="155-分布式任务调度">15.5 分布式任务调度<a class="headerlink" href="#155-分布式任务调度" title="Permanent link">&para;</a></h3>
<p>在大规模应用中，任务调度需要跨多台机器进行，以提升处理能力和可靠性。分布式任务调度系统能够管理和协调分布在不同节点上的任务执行。本节将指导你构建一个简单的分布式任务调度系统，涵盖任务分发、执行和监控。</p>
<h4 id="1-项目概述_4">1. 项目概述<a class="headerlink" href="#1-项目概述_4" title="Permanent link">&para;</a></h4>
<p>本项目将实现一个简单的分布式任务调度系统，具备以下功能：</p>
<ul>
<li><strong>任务队列</strong>：集中管理待执行的任务。</li>
<li><strong>任务分发</strong>：将任务分配给多个工作节点。</li>
<li><strong>任务执行</strong>：工作节点执行分配的任务，并返回结果。</li>
<li><strong>任务监控</strong>：监控任务的状态和结果。</li>
</ul>
<h4 id="2-项目结构_4">2. 项目结构<a class="headerlink" href="#2-项目结构_4" title="Permanent link">&para;</a></h4>
<p>建议的项目结构如下：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-728-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-728-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-728-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-728-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-728-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-728-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-728-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-728-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-728-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-728-10">10</a></span>
<span class="normal"><a href="#__codelineno-728-11">11</a></span>
<span class="normal"><a href="#__codelineno-728-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-728-1" name="__codelineno-728-1"></a>distributed-task-scheduler/
<a id="__codelineno-728-2" name="__codelineno-728-2"></a>├── main.go
<a id="__codelineno-728-3" name="__codelineno-728-3"></a>├── scheduler/
<a id="__codelineno-728-4" name="__codelineno-728-4"></a>│   └── scheduler.go
<a id="__codelineno-728-5" name="__codelineno-728-5"></a>├── worker/
<a id="__codelineno-728-6" name="__codelineno-728-6"></a>│   └── worker.go
<a id="__codelineno-728-7" name="__codelineno-728-7"></a>├── tasks/
<a id="__codelineno-728-8" name="__codelineno-728-8"></a>│   └── task.go
<a id="__codelineno-728-9" name="__codelineno-728-9"></a>├── utils/
<a id="__codelineno-728-10" name="__codelineno-728-10"></a>│   └── response.go
<a id="__codelineno-728-11" name="__codelineno-728-11"></a>├── go.mod
<a id="__codelineno-728-12" name="__codelineno-728-12"></a>└── go.sum
</code></pre></div></td></tr></table></div>
<h4 id="3-选择技术栈">3. 选择技术栈<a class="headerlink" href="#3-选择技术栈" title="Permanent link">&para;</a></h4>
<p>为了实现分布式任务调度，我们将使用以下技术：</p>
<ul>
<li><strong>消息队列</strong>：使用Redis作为消息队列，管理任务分发。</li>
<li><strong>HTTP API</strong>：使用<code>net/http</code>包提供任务提交和监控接口。</li>
<li><strong>Goroutines</strong>：利用Go的并发特性，实现高效的任务处理。</li>
</ul>
<h4 id="4-安装依赖_1">4. 安装依赖<a class="headerlink" href="#4-安装依赖_1" title="Permanent link">&para;</a></h4>
<p>本项目将使用<code>go-redis</code>库与Redis进行交互，使用<code>gorilla/mux</code>进行路由管理。安装依赖：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-729-1">1</a></span>
<span class="normal"><a href="#__codelineno-729-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-729-1" name="__codelineno-729-1"></a>go<span class="w"> </span>get<span class="w"> </span>github.com/go-redis/redis/v8
<a id="__codelineno-729-2" name="__codelineno-729-2"></a>go<span class="w"> </span>get<span class="w"> </span>github.com/gorilla/mux
</code></pre></div></td></tr></table></div>
<h4 id="5-定义任务模型">5. 定义任务模型<a class="headerlink" href="#5-定义任务模型" title="Permanent link">&para;</a></h4>
<p>在<code>tasks</code>目录下创建<code>task.go</code>文件，定义任务数据结构。</p>
<p><strong>tasks/task.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-730-1">1</a></span>
<span class="normal"><a href="#__codelineno-730-2">2</a></span>
<span class="normal"><a href="#__codelineno-730-3">3</a></span>
<span class="normal"><a href="#__codelineno-730-4">4</a></span>
<span class="normal"><a href="#__codelineno-730-5">5</a></span>
<span class="normal"><a href="#__codelineno-730-6">6</a></span>
<span class="normal"><a href="#__codelineno-730-7">7</a></span>
<span class="normal"><a href="#__codelineno-730-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-730-1" name="__codelineno-730-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">tasks</span>
<a id="__codelineno-730-2" name="__codelineno-730-2"></a>
<a id="__codelineno-730-3" name="__codelineno-730-3"></a><span class="c1">// Task 定义任务结构体</span>
<a id="__codelineno-730-4" name="__codelineno-730-4"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-730-5" name="__codelineno-730-5"></a><span class="w">    </span><span class="nx">ID</span><span class="w">      </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;id&quot;`</span>
<a id="__codelineno-730-6" name="__codelineno-730-6"></a><span class="w">    </span><span class="nx">Type</span><span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;type&quot;`</span>
<a id="__codelineno-730-7" name="__codelineno-730-7"></a><span class="w">    </span><span class="nx">Payload</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;payload&quot;`</span>
<a id="__codelineno-730-8" name="__codelineno-730-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>Task 结构体</strong>：定义任务的ID、类型和负载数据。</li>
</ul>
<h4 id="6-编写响应工具">6. 编写响应工具<a class="headerlink" href="#6-编写响应工具" title="Permanent link">&para;</a></h4>
<p>在<code>utils</code>目录下创建<code>response.go</code>文件，定义统一的响应格式和帮助函数。</p>
<p><strong>utils/response.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-731-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-731-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-731-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-731-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-731-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-731-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-731-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-731-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-731-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-731-10">10</a></span>
<span class="normal"><a href="#__codelineno-731-11">11</a></span>
<span class="normal"><a href="#__codelineno-731-12">12</a></span>
<span class="normal"><a href="#__codelineno-731-13">13</a></span>
<span class="normal"><a href="#__codelineno-731-14">14</a></span>
<span class="normal"><a href="#__codelineno-731-15">15</a></span>
<span class="normal"><a href="#__codelineno-731-16">16</a></span>
<span class="normal"><a href="#__codelineno-731-17">17</a></span>
<span class="normal"><a href="#__codelineno-731-18">18</a></span>
<span class="normal"><a href="#__codelineno-731-19">19</a></span>
<span class="normal"><a href="#__codelineno-731-20">20</a></span>
<span class="normal"><a href="#__codelineno-731-21">21</a></span>
<span class="normal"><a href="#__codelineno-731-22">22</a></span>
<span class="normal"><a href="#__codelineno-731-23">23</a></span>
<span class="normal"><a href="#__codelineno-731-24">24</a></span>
<span class="normal"><a href="#__codelineno-731-25">25</a></span>
<span class="normal"><a href="#__codelineno-731-26">26</a></span>
<span class="normal"><a href="#__codelineno-731-27">27</a></span>
<span class="normal"><a href="#__codelineno-731-28">28</a></span>
<span class="normal"><a href="#__codelineno-731-29">29</a></span>
<span class="normal"><a href="#__codelineno-731-30">30</a></span>
<span class="normal"><a href="#__codelineno-731-31">31</a></span>
<span class="normal"><a href="#__codelineno-731-32">32</a></span>
<span class="normal"><a href="#__codelineno-731-33">33</a></span>
<span class="normal"><a href="#__codelineno-731-34">34</a></span>
<span class="normal"><a href="#__codelineno-731-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-731-1" name="__codelineno-731-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>
<a id="__codelineno-731-2" name="__codelineno-731-2"></a>
<a id="__codelineno-731-3" name="__codelineno-731-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-731-4" name="__codelineno-731-4"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-731-5" name="__codelineno-731-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-731-6" name="__codelineno-731-6"></a><span class="p">)</span>
<a id="__codelineno-731-7" name="__codelineno-731-7"></a>
<a id="__codelineno-731-8" name="__codelineno-731-8"></a><span class="c1">// Response 定义统一的响应结构</span>
<a id="__codelineno-731-9" name="__codelineno-731-9"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-731-10" name="__codelineno-731-10"></a><span class="w">    </span><span class="nx">Status</span><span class="w">  </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;status&quot;`</span>
<a id="__codelineno-731-11" name="__codelineno-731-11"></a><span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;message,omitempty&quot;`</span>
<a id="__codelineno-731-12" name="__codelineno-731-12"></a><span class="w">    </span><span class="nx">Data</span><span class="w">    </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;data,omitempty&quot;`</span>
<a id="__codelineno-731-13" name="__codelineno-731-13"></a><span class="p">}</span>
<a id="__codelineno-731-14" name="__codelineno-731-14"></a>
<a id="__codelineno-731-15" name="__codelineno-731-15"></a><span class="c1">// RespondWithJSON 发送JSON响应</span>
<a id="__codelineno-731-16" name="__codelineno-731-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">payload</span><span class="w"> </span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-731-17" name="__codelineno-731-17"></a><span class="w">    </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
<a id="__codelineno-731-18" name="__codelineno-731-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-731-19" name="__codelineno-731-19"></a><span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<a id="__codelineno-731-20" name="__codelineno-731-20"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-731-21" name="__codelineno-731-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-731-22" name="__codelineno-731-22"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<a id="__codelineno-731-23" name="__codelineno-731-23"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
<a id="__codelineno-731-24" name="__codelineno-731-24"></a><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<a id="__codelineno-731-25" name="__codelineno-731-25"></a><span class="p">}</span>
<a id="__codelineno-731-26" name="__codelineno-731-26"></a>
<a id="__codelineno-731-27" name="__codelineno-731-27"></a><span class="c1">// RespondWithError 发送错误响应</span>
<a id="__codelineno-731-28" name="__codelineno-731-28"></a><span class="kd">func</span><span class="w"> </span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-731-29" name="__codelineno-731-29"></a><span class="w">    </span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">Response</span><span class="p">{</span><span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="nx">message</span><span class="p">})</span>
<a id="__codelineno-731-30" name="__codelineno-731-30"></a><span class="p">}</span>
<a id="__codelineno-731-31" name="__codelineno-731-31"></a>
<a id="__codelineno-731-32" name="__codelineno-731-32"></a><span class="c1">// RespondWithSuccess 发送成功响应</span>
<a id="__codelineno-731-33" name="__codelineno-731-33"></a><span class="kd">func</span><span class="w"> </span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-731-34" name="__codelineno-731-34"></a><span class="w">    </span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">Response</span><span class="p">{</span><span class="nx">Status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">})</span>
<a id="__codelineno-731-35" name="__codelineno-731-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="7-编写调度器">7. 编写调度器<a class="headerlink" href="#7-编写调度器" title="Permanent link">&para;</a></h4>
<p>在<code>scheduler</code>目录下创建<code>scheduler.go</code>文件，定义任务调度器的逻辑。</p>
<p><strong>scheduler/scheduler.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-732-1">  1</a></span>
<span class="normal"><a href="#__codelineno-732-2">  2</a></span>
<span class="normal"><a href="#__codelineno-732-3">  3</a></span>
<span class="normal"><a href="#__codelineno-732-4">  4</a></span>
<span class="normal"><a href="#__codelineno-732-5">  5</a></span>
<span class="normal"><a href="#__codelineno-732-6">  6</a></span>
<span class="normal"><a href="#__codelineno-732-7">  7</a></span>
<span class="normal"><a href="#__codelineno-732-8">  8</a></span>
<span class="normal"><a href="#__codelineno-732-9">  9</a></span>
<span class="normal"><a href="#__codelineno-732-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-732-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-732-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-732-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-732-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-732-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-732-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-732-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-732-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-732-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-732-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-732-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-732-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-732-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-732-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-732-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-732-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-732-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-732-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-732-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-732-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-732-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-732-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-732-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-732-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-732-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-732-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-732-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-732-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-732-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-732-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-732-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-732-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-732-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-732-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-732-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-732-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-732-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-732-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-732-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-732-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-732-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-732-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-732-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-732-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-732-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-732-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-732-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-732-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-732-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-732-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-732-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-732-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-732-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-732-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-732-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-732-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-732-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-732-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-732-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-732-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-732-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-732-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-732-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-732-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-732-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-732-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-732-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-732-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-732-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-732-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-732-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-732-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-732-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-732-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-732-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-732-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-732-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-732-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-732-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-732-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-732-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-732-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-732-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-732-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-732-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-732-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-732-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-732-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-732-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-732-100">100</a></span>
<span class="normal"><a href="#__codelineno-732-101">101</a></span>
<span class="normal"><a href="#__codelineno-732-102">102</a></span>
<span class="normal"><a href="#__codelineno-732-103">103</a></span>
<span class="normal"><a href="#__codelineno-732-104">104</a></span>
<span class="normal"><a href="#__codelineno-732-105">105</a></span>
<span class="normal"><a href="#__codelineno-732-106">106</a></span>
<span class="normal"><a href="#__codelineno-732-107">107</a></span>
<span class="normal"><a href="#__codelineno-732-108">108</a></span>
<span class="normal"><a href="#__codelineno-732-109">109</a></span>
<span class="normal"><a href="#__codelineno-732-110">110</a></span>
<span class="normal"><a href="#__codelineno-732-111">111</a></span>
<span class="normal"><a href="#__codelineno-732-112">112</a></span>
<span class="normal"><a href="#__codelineno-732-113">113</a></span>
<span class="normal"><a href="#__codelineno-732-114">114</a></span>
<span class="normal"><a href="#__codelineno-732-115">115</a></span>
<span class="normal"><a href="#__codelineno-732-116">116</a></span>
<span class="normal"><a href="#__codelineno-732-117">117</a></span>
<span class="normal"><a href="#__codelineno-732-118">118</a></span>
<span class="normal"><a href="#__codelineno-732-119">119</a></span>
<span class="normal"><a href="#__codelineno-732-120">120</a></span>
<span class="normal"><a href="#__codelineno-732-121">121</a></span>
<span class="normal"><a href="#__codelineno-732-122">122</a></span>
<span class="normal"><a href="#__codelineno-732-123">123</a></span>
<span class="normal"><a href="#__codelineno-732-124">124</a></span>
<span class="normal"><a href="#__codelineno-732-125">125</a></span>
<span class="normal"><a href="#__codelineno-732-126">126</a></span>
<span class="normal"><a href="#__codelineno-732-127">127</a></span>
<span class="normal"><a href="#__codelineno-732-128">128</a></span>
<span class="normal"><a href="#__codelineno-732-129">129</a></span>
<span class="normal"><a href="#__codelineno-732-130">130</a></span>
<span class="normal"><a href="#__codelineno-732-131">131</a></span>
<span class="normal"><a href="#__codelineno-732-132">132</a></span>
<span class="normal"><a href="#__codelineno-732-133">133</a></span>
<span class="normal"><a href="#__codelineno-732-134">134</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-732-1" name="__codelineno-732-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">scheduler</span>
<a id="__codelineno-732-2" name="__codelineno-732-2"></a>
<a id="__codelineno-732-3" name="__codelineno-732-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-732-4" name="__codelineno-732-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-732-5" name="__codelineno-732-5"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-732-6" name="__codelineno-732-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-732-7" name="__codelineno-732-7"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-732-8" name="__codelineno-732-8"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-732-9" name="__codelineno-732-9"></a>
<a id="__codelineno-732-10" name="__codelineno-732-10"></a><span class="w">    </span><span class="s">&quot;github.com/go-redis/redis/v8&quot;</span>
<a id="__codelineno-732-11" name="__codelineno-732-11"></a><span class="w">    </span><span class="s">&quot;github.com/gorilla/mux&quot;</span>
<a id="__codelineno-732-12" name="__codelineno-732-12"></a><span class="w">    </span><span class="s">&quot;github.com/google/uuid&quot;</span>
<a id="__codelineno-732-13" name="__codelineno-732-13"></a><span class="w">    </span><span class="s">&quot;github.com/username/distributed-task-scheduler/tasks&quot;</span>
<a id="__codelineno-732-14" name="__codelineno-732-14"></a><span class="w">    </span><span class="s">&quot;github.com/username/distributed-task-scheduler/utils&quot;</span>
<a id="__codelineno-732-15" name="__codelineno-732-15"></a><span class="p">)</span>
<a id="__codelineno-732-16" name="__codelineno-732-16"></a>
<a id="__codelineno-732-17" name="__codelineno-732-17"></a><span class="c1">// Scheduler 定义调度器结构体</span>
<a id="__codelineno-732-18" name="__codelineno-732-18"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Scheduler</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-19" name="__codelineno-732-19"></a><span class="w">    </span><span class="nx">Router</span><span class="w"> </span><span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span>
<a id="__codelineno-732-20" name="__codelineno-732-20"></a><span class="w">    </span><span class="nx">Rdb</span><span class="w">    </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span>
<a id="__codelineno-732-21" name="__codelineno-732-21"></a><span class="w">    </span><span class="nx">Ctx</span><span class="w">    </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span>
<a id="__codelineno-732-22" name="__codelineno-732-22"></a><span class="p">}</span>
<a id="__codelineno-732-23" name="__codelineno-732-23"></a>
<a id="__codelineno-732-24" name="__codelineno-732-24"></a><span class="c1">// NewScheduler 创建新的调度器实例</span>
<a id="__codelineno-732-25" name="__codelineno-732-25"></a><span class="kd">func</span><span class="w"> </span><span class="nx">NewScheduler</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Scheduler</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-26" name="__codelineno-732-26"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-732-27" name="__codelineno-732-27"></a><span class="w">    </span><span class="nx">rdb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">NewClient</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<a id="__codelineno-732-28" name="__codelineno-732-28"></a><span class="w">        </span><span class="nx">Addr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost:6379&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Redis地址</span>
<a id="__codelineno-732-29" name="__codelineno-732-29"></a><span class="w">        </span><span class="nx">DB</span><span class="p">:</span><span class="w">   </span><span class="mi">0</span><span class="p">,</span><span class="w">                </span><span class="c1">// 使用默认DB</span>
<a id="__codelineno-732-30" name="__codelineno-732-30"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-732-31" name="__codelineno-732-31"></a>
<a id="__codelineno-732-32" name="__codelineno-732-32"></a><span class="w">    </span><span class="c1">// 测试Redis连接</span>
<a id="__codelineno-732-33" name="__codelineno-732-33"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rdb</span><span class="p">.</span><span class="nx">Ping</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Result</span><span class="p">()</span>
<a id="__codelineno-732-34" name="__codelineno-732-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-35" name="__codelineno-732-35"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;无法连接到Redis: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-732-36" name="__codelineno-732-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-37" name="__codelineno-732-37"></a>
<a id="__codelineno-732-38" name="__codelineno-732-38"></a><span class="w">    </span><span class="nx">scheduler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Scheduler</span><span class="p">{</span>
<a id="__codelineno-732-39" name="__codelineno-732-39"></a><span class="w">        </span><span class="nx">Router</span><span class="p">:</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">NewRouter</span><span class="p">(),</span>
<a id="__codelineno-732-40" name="__codelineno-732-40"></a><span class="w">        </span><span class="nx">Rdb</span><span class="p">:</span><span class="w">    </span><span class="nx">rdb</span><span class="p">,</span>
<a id="__codelineno-732-41" name="__codelineno-732-41"></a><span class="w">        </span><span class="nx">Ctx</span><span class="p">:</span><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span>
<a id="__codelineno-732-42" name="__codelineno-732-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-43" name="__codelineno-732-43"></a>
<a id="__codelineno-732-44" name="__codelineno-732-44"></a><span class="w">    </span><span class="nx">scheduler</span><span class="p">.</span><span class="nx">routes</span><span class="p">()</span>
<a id="__codelineno-732-45" name="__codelineno-732-45"></a>
<a id="__codelineno-732-46" name="__codelineno-732-46"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">scheduler</span>
<a id="__codelineno-732-47" name="__codelineno-732-47"></a><span class="p">}</span>
<a id="__codelineno-732-48" name="__codelineno-732-48"></a>
<a id="__codelineno-732-49" name="__codelineno-732-49"></a><span class="c1">// routes 配置路由</span>
<a id="__codelineno-732-50" name="__codelineno-732-50"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Scheduler</span><span class="p">)</span><span class="w"> </span><span class="nx">routes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-51" name="__codelineno-732-51"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/tasks&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">CreateTask</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">)</span>
<a id="__codelineno-732-52" name="__codelineno-732-52"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/tasks/{id}&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">GetTask</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>
<a id="__codelineno-732-53" name="__codelineno-732-53"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/tasks&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">ListTasks</span><span class="p">).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>
<a id="__codelineno-732-54" name="__codelineno-732-54"></a><span class="p">}</span>
<a id="__codelineno-732-55" name="__codelineno-732-55"></a>
<a id="__codelineno-732-56" name="__codelineno-732-56"></a><span class="c1">// CreateTask 处理任务创建请求</span>
<a id="__codelineno-732-57" name="__codelineno-732-57"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Scheduler</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateTask</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-58" name="__codelineno-732-58"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">Task</span>
<a id="__codelineno-732-59" name="__codelineno-732-59"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">).</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">task</span><span class="p">)</span>
<a id="__codelineno-732-60" name="__codelineno-732-60"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-61" name="__codelineno-732-61"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;无效的请求体&quot;</span><span class="p">)</span>
<a id="__codelineno-732-62" name="__codelineno-732-62"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-732-63" name="__codelineno-732-63"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-64" name="__codelineno-732-64"></a>
<a id="__codelineno-732-65" name="__codelineno-732-65"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Payload</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-66" name="__codelineno-732-66"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;任务类型和负载不能为空&quot;</span><span class="p">)</span>
<a id="__codelineno-732-67" name="__codelineno-732-67"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-732-68" name="__codelineno-732-68"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-69" name="__codelineno-732-69"></a>
<a id="__codelineno-732-70" name="__codelineno-732-70"></a><span class="w">    </span><span class="c1">// 生成唯一任务ID</span>
<a id="__codelineno-732-71" name="__codelineno-732-71"></a><span class="w">    </span><span class="nx">task</span><span class="p">.</span><span class="nx">ID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">uuid</span><span class="p">.</span><span class="nx">New</span><span class="p">().</span><span class="nx">String</span><span class="p">()</span>
<a id="__codelineno-732-72" name="__codelineno-732-72"></a>
<a id="__codelineno-732-73" name="__codelineno-732-73"></a><span class="w">    </span><span class="c1">// 序列化任务</span>
<a id="__codelineno-732-74" name="__codelineno-732-74"></a><span class="w">    </span><span class="nx">taskBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<a id="__codelineno-732-75" name="__codelineno-732-75"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-76" name="__codelineno-732-76"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;序列化任务失败&quot;</span><span class="p">)</span>
<a id="__codelineno-732-77" name="__codelineno-732-77"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-732-78" name="__codelineno-732-78"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-79" name="__codelineno-732-79"></a>
<a id="__codelineno-732-80" name="__codelineno-732-80"></a><span class="w">    </span><span class="c1">// 将任务推送到Redis队列</span>
<a id="__codelineno-732-81" name="__codelineno-732-81"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Rdb</span><span class="p">.</span><span class="nx">LPush</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;task_queue&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">taskBytes</span><span class="p">).</span><span class="nx">Err</span><span class="p">()</span>
<a id="__codelineno-732-82" name="__codelineno-732-82"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-83" name="__codelineno-732-83"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;任务入队失败&quot;</span><span class="p">)</span>
<a id="__codelineno-732-84" name="__codelineno-732-84"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-732-85" name="__codelineno-732-85"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-86" name="__codelineno-732-86"></a>
<a id="__codelineno-732-87" name="__codelineno-732-87"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">)</span>
<a id="__codelineno-732-88" name="__codelineno-732-88"></a><span class="p">}</span>
<a id="__codelineno-732-89" name="__codelineno-732-89"></a>
<a id="__codelineno-732-90" name="__codelineno-732-90"></a><span class="c1">// GetTask 处理获取单个任务请求</span>
<a id="__codelineno-732-91" name="__codelineno-732-91"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Scheduler</span><span class="p">)</span><span class="w"> </span><span class="nx">GetTask</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-92" name="__codelineno-732-92"></a><span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<a id="__codelineno-732-93" name="__codelineno-732-93"></a><span class="w">    </span><span class="nx">id</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
<a id="__codelineno-732-94" name="__codelineno-732-94"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-95" name="__codelineno-732-95"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;缺少任务ID&quot;</span><span class="p">)</span>
<a id="__codelineno-732-96" name="__codelineno-732-96"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-732-97" name="__codelineno-732-97"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-98" name="__codelineno-732-98"></a>
<a id="__codelineno-732-99" name="__codelineno-732-99"></a><span class="w">    </span><span class="c1">// 查询任务状态（示例中未实现持久化，返回简单信息）</span>
<a id="__codelineno-732-100" name="__codelineno-732-100"></a><span class="w">    </span><span class="c1">// 实际应用中，应从数据库或存储中获取任务状态</span>
<a id="__codelineno-732-101" name="__codelineno-732-101"></a>
<a id="__codelineno-732-102" name="__codelineno-732-102"></a><span class="w">    </span><span class="nx">taskStatus</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-732-103" name="__codelineno-732-103"></a><span class="w">        </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w">     </span><span class="nx">id</span><span class="p">,</span>
<a id="__codelineno-732-104" name="__codelineno-732-104"></a><span class="w">        </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pending&quot;</span><span class="p">,</span>
<a id="__codelineno-732-105" name="__codelineno-732-105"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-106" name="__codelineno-732-106"></a>
<a id="__codelineno-732-107" name="__codelineno-732-107"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">taskStatus</span><span class="p">)</span>
<a id="__codelineno-732-108" name="__codelineno-732-108"></a><span class="p">}</span>
<a id="__codelineno-732-109" name="__codelineno-732-109"></a>
<a id="__codelineno-732-110" name="__codelineno-732-110"></a><span class="c1">// ListTasks 处理列出所有任务请求</span>
<a id="__codelineno-732-111" name="__codelineno-732-111"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Scheduler</span><span class="p">)</span><span class="w"> </span><span class="nx">ListTasks</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-112" name="__codelineno-732-112"></a><span class="w">    </span><span class="c1">// 查询任务队列长度</span>
<a id="__codelineno-732-113" name="__codelineno-732-113"></a><span class="w">    </span><span class="nx">length</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Rdb</span><span class="p">.</span><span class="nx">LLen</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;task_queue&quot;</span><span class="p">).</span><span class="nx">Result</span><span class="p">()</span>
<a id="__codelineno-732-114" name="__codelineno-732-114"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-115" name="__codelineno-732-115"></a><span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithError</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;获取任务队列失败&quot;</span><span class="p">)</span>
<a id="__codelineno-732-116" name="__codelineno-732-116"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-732-117" name="__codelineno-732-117"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-118" name="__codelineno-732-118"></a>
<a id="__codelineno-732-119" name="__codelineno-732-119"></a><span class="w">    </span><span class="nx">tasksInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<a id="__codelineno-732-120" name="__codelineno-732-120"></a><span class="w">        </span><span class="s">&quot;total_tasks_in_queue&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">length</span><span class="p">,</span>
<a id="__codelineno-732-121" name="__codelineno-732-121"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-122" name="__codelineno-732-122"></a>
<a id="__codelineno-732-123" name="__codelineno-732-123"></a><span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithSuccess</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">tasksInfo</span><span class="p">)</span>
<a id="__codelineno-732-124" name="__codelineno-732-124"></a><span class="p">}</span>
<a id="__codelineno-732-125" name="__codelineno-732-125"></a>
<a id="__codelineno-732-126" name="__codelineno-732-126"></a><span class="c1">// Run 启动调度器的HTTP服务器</span>
<a id="__codelineno-732-127" name="__codelineno-732-127"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Scheduler</span><span class="p">)</span><span class="w"> </span><span class="nx">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-128" name="__codelineno-732-128"></a><span class="w">    </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:8081&quot;</span>
<a id="__codelineno-732-129" name="__codelineno-732-129"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;调度器服务器启动在 http://localhost%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="p">)</span>
<a id="__codelineno-732-130" name="__codelineno-732-130"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Router</span><span class="p">)</span>
<a id="__codelineno-732-131" name="__codelineno-732-131"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-732-132" name="__codelineno-732-132"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;调度器服务器启动失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-732-133" name="__codelineno-732-133"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-732-134" name="__codelineno-732-134"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>Scheduler 结构体</strong>：</li>
<li><code>Router</code>：使用<code>gorilla/mux</code>配置路由。</li>
<li><code>Rdb</code>：Redis客户端，用于任务队列管理。</li>
<li><code>Ctx</code>：上下文，用于Redis操作。</li>
<li><strong>CreateTask</strong>：</li>
<li>解析请求体中的任务数据。</li>
<li>生成唯一任务ID（使用<code>github.com/google/uuid</code>库）。</li>
<li>将任务序列化为JSON并推送到Redis的<code>task_queue</code>列表中。</li>
<li>返回创建的任务信息。</li>
<li><strong>GetTask</strong> 和 <strong>ListTasks</strong>：</li>
<li>示例中未实现任务状态的持久化，实际应用中应从数据库获取任务状态。</li>
<li><code>ListTasks</code>返回任务队列中的任务数量。</li>
</ul>
<h4 id="8-编写工作节点">8. 编写工作节点<a class="headerlink" href="#8-编写工作节点" title="Permanent link">&para;</a></h4>
<p>工作节点负责从任务队列中获取任务，执行任务，并记录结果。创建<code>worker</code>目录下的<code>worker.go</code>文件。</p>
<p><strong>worker/worker.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-733-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-733-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-733-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-733-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-733-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-733-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-733-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-733-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-733-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-733-10">10</a></span>
<span class="normal"><a href="#__codelineno-733-11">11</a></span>
<span class="normal"><a href="#__codelineno-733-12">12</a></span>
<span class="normal"><a href="#__codelineno-733-13">13</a></span>
<span class="normal"><a href="#__codelineno-733-14">14</a></span>
<span class="normal"><a href="#__codelineno-733-15">15</a></span>
<span class="normal"><a href="#__codelineno-733-16">16</a></span>
<span class="normal"><a href="#__codelineno-733-17">17</a></span>
<span class="normal"><a href="#__codelineno-733-18">18</a></span>
<span class="normal"><a href="#__codelineno-733-19">19</a></span>
<span class="normal"><a href="#__codelineno-733-20">20</a></span>
<span class="normal"><a href="#__codelineno-733-21">21</a></span>
<span class="normal"><a href="#__codelineno-733-22">22</a></span>
<span class="normal"><a href="#__codelineno-733-23">23</a></span>
<span class="normal"><a href="#__codelineno-733-24">24</a></span>
<span class="normal"><a href="#__codelineno-733-25">25</a></span>
<span class="normal"><a href="#__codelineno-733-26">26</a></span>
<span class="normal"><a href="#__codelineno-733-27">27</a></span>
<span class="normal"><a href="#__codelineno-733-28">28</a></span>
<span class="normal"><a href="#__codelineno-733-29">29</a></span>
<span class="normal"><a href="#__codelineno-733-30">30</a></span>
<span class="normal"><a href="#__codelineno-733-31">31</a></span>
<span class="normal"><a href="#__codelineno-733-32">32</a></span>
<span class="normal"><a href="#__codelineno-733-33">33</a></span>
<span class="normal"><a href="#__codelineno-733-34">34</a></span>
<span class="normal"><a href="#__codelineno-733-35">35</a></span>
<span class="normal"><a href="#__codelineno-733-36">36</a></span>
<span class="normal"><a href="#__codelineno-733-37">37</a></span>
<span class="normal"><a href="#__codelineno-733-38">38</a></span>
<span class="normal"><a href="#__codelineno-733-39">39</a></span>
<span class="normal"><a href="#__codelineno-733-40">40</a></span>
<span class="normal"><a href="#__codelineno-733-41">41</a></span>
<span class="normal"><a href="#__codelineno-733-42">42</a></span>
<span class="normal"><a href="#__codelineno-733-43">43</a></span>
<span class="normal"><a href="#__codelineno-733-44">44</a></span>
<span class="normal"><a href="#__codelineno-733-45">45</a></span>
<span class="normal"><a href="#__codelineno-733-46">46</a></span>
<span class="normal"><a href="#__codelineno-733-47">47</a></span>
<span class="normal"><a href="#__codelineno-733-48">48</a></span>
<span class="normal"><a href="#__codelineno-733-49">49</a></span>
<span class="normal"><a href="#__codelineno-733-50">50</a></span>
<span class="normal"><a href="#__codelineno-733-51">51</a></span>
<span class="normal"><a href="#__codelineno-733-52">52</a></span>
<span class="normal"><a href="#__codelineno-733-53">53</a></span>
<span class="normal"><a href="#__codelineno-733-54">54</a></span>
<span class="normal"><a href="#__codelineno-733-55">55</a></span>
<span class="normal"><a href="#__codelineno-733-56">56</a></span>
<span class="normal"><a href="#__codelineno-733-57">57</a></span>
<span class="normal"><a href="#__codelineno-733-58">58</a></span>
<span class="normal"><a href="#__codelineno-733-59">59</a></span>
<span class="normal"><a href="#__codelineno-733-60">60</a></span>
<span class="normal"><a href="#__codelineno-733-61">61</a></span>
<span class="normal"><a href="#__codelineno-733-62">62</a></span>
<span class="normal"><a href="#__codelineno-733-63">63</a></span>
<span class="normal"><a href="#__codelineno-733-64">64</a></span>
<span class="normal"><a href="#__codelineno-733-65">65</a></span>
<span class="normal"><a href="#__codelineno-733-66">66</a></span>
<span class="normal"><a href="#__codelineno-733-67">67</a></span>
<span class="normal"><a href="#__codelineno-733-68">68</a></span>
<span class="normal"><a href="#__codelineno-733-69">69</a></span>
<span class="normal"><a href="#__codelineno-733-70">70</a></span>
<span class="normal"><a href="#__codelineno-733-71">71</a></span>
<span class="normal"><a href="#__codelineno-733-72">72</a></span>
<span class="normal"><a href="#__codelineno-733-73">73</a></span>
<span class="normal"><a href="#__codelineno-733-74">74</a></span>
<span class="normal"><a href="#__codelineno-733-75">75</a></span>
<span class="normal"><a href="#__codelineno-733-76">76</a></span>
<span class="normal"><a href="#__codelineno-733-77">77</a></span>
<span class="normal"><a href="#__codelineno-733-78">78</a></span>
<span class="normal"><a href="#__codelineno-733-79">79</a></span>
<span class="normal"><a href="#__codelineno-733-80">80</a></span>
<span class="normal"><a href="#__codelineno-733-81">81</a></span>
<span class="normal"><a href="#__codelineno-733-82">82</a></span>
<span class="normal"><a href="#__codelineno-733-83">83</a></span>
<span class="normal"><a href="#__codelineno-733-84">84</a></span>
<span class="normal"><a href="#__codelineno-733-85">85</a></span>
<span class="normal"><a href="#__codelineno-733-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-733-1" name="__codelineno-733-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">worker</span>
<a id="__codelineno-733-2" name="__codelineno-733-2"></a>
<a id="__codelineno-733-3" name="__codelineno-733-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-733-4" name="__codelineno-733-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-733-5" name="__codelineno-733-5"></a><span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<a id="__codelineno-733-6" name="__codelineno-733-6"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-733-7" name="__codelineno-733-7"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-733-8" name="__codelineno-733-8"></a>
<a id="__codelineno-733-9" name="__codelineno-733-9"></a><span class="w">    </span><span class="s">&quot;github.com/go-redis/redis/v8&quot;</span>
<a id="__codelineno-733-10" name="__codelineno-733-10"></a><span class="w">    </span><span class="s">&quot;github.com/username/distributed-task-scheduler/tasks&quot;</span>
<a id="__codelineno-733-11" name="__codelineno-733-11"></a><span class="p">)</span>
<a id="__codelineno-733-12" name="__codelineno-733-12"></a>
<a id="__codelineno-733-13" name="__codelineno-733-13"></a><span class="c1">// Worker 定义工作节点结构体</span>
<a id="__codelineno-733-14" name="__codelineno-733-14"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Worker</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-15" name="__codelineno-733-15"></a><span class="w">    </span><span class="nx">Rdb</span><span class="w">       </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span>
<a id="__codelineno-733-16" name="__codelineno-733-16"></a><span class="w">    </span><span class="nx">Ctx</span><span class="w">       </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span>
<a id="__codelineno-733-17" name="__codelineno-733-17"></a><span class="w">    </span><span class="nx">WorkerID</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-733-18" name="__codelineno-733-18"></a><span class="w">    </span><span class="nx">PollDelay</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<a id="__codelineno-733-19" name="__codelineno-733-19"></a><span class="p">}</span>
<a id="__codelineno-733-20" name="__codelineno-733-20"></a>
<a id="__codelineno-733-21" name="__codelineno-733-21"></a><span class="c1">// NewWorker 创建新的工作节点实例</span>
<a id="__codelineno-733-22" name="__codelineno-733-22"></a><span class="kd">func</span><span class="w"> </span><span class="nx">NewWorker</span><span class="p">(</span><span class="nx">rdb</span><span class="w"> </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">workerID</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">pollDelay</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Worker</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-23" name="__codelineno-733-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Worker</span><span class="p">{</span>
<a id="__codelineno-733-24" name="__codelineno-733-24"></a><span class="w">        </span><span class="nx">Rdb</span><span class="p">:</span><span class="w">       </span><span class="nx">rdb</span><span class="p">,</span>
<a id="__codelineno-733-25" name="__codelineno-733-25"></a><span class="w">        </span><span class="nx">Ctx</span><span class="p">:</span><span class="w">       </span><span class="nx">ctx</span><span class="p">,</span>
<a id="__codelineno-733-26" name="__codelineno-733-26"></a><span class="w">        </span><span class="nx">WorkerID</span><span class="p">:</span><span class="w">  </span><span class="nx">workerID</span><span class="p">,</span>
<a id="__codelineno-733-27" name="__codelineno-733-27"></a><span class="w">        </span><span class="nx">PollDelay</span><span class="p">:</span><span class="w"> </span><span class="nx">pollDelay</span><span class="p">,</span>
<a id="__codelineno-733-28" name="__codelineno-733-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-733-29" name="__codelineno-733-29"></a><span class="p">}</span>
<a id="__codelineno-733-30" name="__codelineno-733-30"></a>
<a id="__codelineno-733-31" name="__codelineno-733-31"></a><span class="c1">// Start 启动工作节点</span>
<a id="__codelineno-733-32" name="__codelineno-733-32"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">Worker</span><span class="p">)</span><span class="w"> </span><span class="nx">Start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-33" name="__codelineno-733-33"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;工作节点 %s 启动&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">WorkerID</span><span class="p">)</span>
<a id="__codelineno-733-34" name="__codelineno-733-34"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-35" name="__codelineno-733-35"></a><span class="w">        </span><span class="c1">// 从任务队列阻塞获取任务</span>
<a id="__codelineno-733-36" name="__codelineno-733-36"></a><span class="w">        </span><span class="nx">taskBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Rdb</span><span class="p">.</span><span class="nx">BRPop</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;task_queue&quot;</span><span class="p">).</span><span class="nx">Result</span><span class="p">()</span>
<a id="__codelineno-733-37" name="__codelineno-733-37"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-38" name="__codelineno-733-38"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">Nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-39" name="__codelineno-733-39"></a><span class="w">                </span><span class="c1">// 超时，继续等待</span>
<a id="__codelineno-733-40" name="__codelineno-733-40"></a><span class="w">                </span><span class="k">continue</span>
<a id="__codelineno-733-41" name="__codelineno-733-41"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-733-42" name="__codelineno-733-42"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;工作节点 %s 获取任务失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">WorkerID</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-733-43" name="__codelineno-733-43"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-733-44" name="__codelineno-733-44"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-733-45" name="__codelineno-733-45"></a>
<a id="__codelineno-733-46" name="__codelineno-733-46"></a><span class="w">        </span><span class="c1">// 任务数据在第二个元素</span>
<a id="__codelineno-733-47" name="__codelineno-733-47"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">taskBytes</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-48" name="__codelineno-733-48"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;工作节点 %s 获取到无效任务数据&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">WorkerID</span><span class="p">)</span>
<a id="__codelineno-733-49" name="__codelineno-733-49"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-733-50" name="__codelineno-733-50"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-733-51" name="__codelineno-733-51"></a>
<a id="__codelineno-733-52" name="__codelineno-733-52"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">Task</span>
<a id="__codelineno-733-53" name="__codelineno-733-53"></a><span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">taskBytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">task</span><span class="p">)</span>
<a id="__codelineno-733-54" name="__codelineno-733-54"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-55" name="__codelineno-733-55"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;工作节点 %s 解析任务失败: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">WorkerID</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-733-56" name="__codelineno-733-56"></a><span class="w">            </span><span class="k">continue</span>
<a id="__codelineno-733-57" name="__codelineno-733-57"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-733-58" name="__codelineno-733-58"></a>
<a id="__codelineno-733-59" name="__codelineno-733-59"></a><span class="w">        </span><span class="c1">// 执行任务</span>
<a id="__codelineno-733-60" name="__codelineno-733-60"></a><span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">executeTask</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<a id="__codelineno-733-61" name="__codelineno-733-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-733-62" name="__codelineno-733-62"></a><span class="p">}</span>
<a id="__codelineno-733-63" name="__codelineno-733-63"></a>
<a id="__codelineno-733-64" name="__codelineno-733-64"></a><span class="c1">// executeTask 执行任务的具体逻辑</span>
<a id="__codelineno-733-65" name="__codelineno-733-65"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="o">*</span><span class="nx">Worker</span><span class="p">)</span><span class="w"> </span><span class="nx">executeTask</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="nx">tasks</span><span class="p">.</span><span class="nx">Task</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-66" name="__codelineno-733-66"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;工作节点 %s 执行任务: %s - %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">WorkerID</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span>
<a id="__codelineno-733-67" name="__codelineno-733-67"></a>
<a id="__codelineno-733-68" name="__codelineno-733-68"></a><span class="w">    </span><span class="c1">// 根据任务类型执行不同的操作</span>
<a id="__codelineno-733-69" name="__codelineno-733-69"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-70" name="__codelineno-733-70"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;print&quot;</span><span class="p">:</span>
<a id="__codelineno-733-71" name="__codelineno-733-71"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;任务 %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Payload</span><span class="p">)</span>
<a id="__codelineno-733-72" name="__codelineno-733-72"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;sleep&quot;</span><span class="p">:</span>
<a id="__codelineno-733-73" name="__codelineno-733-73"></a><span class="w">        </span><span class="nx">duration</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">ParseDuration</span><span class="p">(</span><span class="nx">task</span><span class="p">.</span><span class="nx">Payload</span><span class="p">)</span>
<a id="__codelineno-733-74" name="__codelineno-733-74"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-733-75" name="__codelineno-733-75"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;任务 %s: 无效的持续时间 - %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-733-76" name="__codelineno-733-76"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-733-77" name="__codelineno-733-77"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-733-78" name="__codelineno-733-78"></a><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span>
<a id="__codelineno-733-79" name="__codelineno-733-79"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;任务 %s: 已睡眠 %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="p">)</span>
<a id="__codelineno-733-80" name="__codelineno-733-80"></a><span class="w">    </span><span class="k">default</span><span class="p">:</span>
<a id="__codelineno-733-81" name="__codelineno-733-81"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;任务 %s: 未知的任务类型 - %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Type</span><span class="p">)</span>
<a id="__codelineno-733-82" name="__codelineno-733-82"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-733-83" name="__codelineno-733-83"></a>
<a id="__codelineno-733-84" name="__codelineno-733-84"></a><span class="w">    </span><span class="c1">// 记录任务完成（示例中未实现）</span>
<a id="__codelineno-733-85" name="__codelineno-733-85"></a><span class="w">    </span><span class="c1">// 实际应用中，应将任务状态更新到数据库或其他存储中</span>
<a id="__codelineno-733-86" name="__codelineno-733-86"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li><strong>Worker 结构体</strong>：</li>
<li><code>Rdb</code>：Redis客户端，用于获取任务。</li>
<li><code>WorkerID</code>：工作节点的唯一标识。</li>
<li><code>PollDelay</code>：任务获取的轮询间隔。</li>
<li><strong>Start 方法</strong>：</li>
<li>使用<code>BRPop</code>命令从<code>task_queue</code>列表中阻塞获取任务，超时后继续等待。</li>
<li>解析任务数据并执行。</li>
<li><strong>executeTask 方法</strong>：</li>
<li>根据任务类型执行不同的操作，如打印信息或休眠指定时间。</li>
<li>示例中定义了两种任务类型：<code>print</code>和<code>sleep</code>。</li>
</ul>
<h4 id="9-编写主程序">9. 编写主程序<a class="headerlink" href="#9-编写主程序" title="Permanent link">&para;</a></h4>
<p>在<code>main.go</code>文件中，启动调度器和工作节点。</p>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-734-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-734-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-734-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-734-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-734-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-734-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-734-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-734-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-734-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-734-10">10</a></span>
<span class="normal"><a href="#__codelineno-734-11">11</a></span>
<span class="normal"><a href="#__codelineno-734-12">12</a></span>
<span class="normal"><a href="#__codelineno-734-13">13</a></span>
<span class="normal"><a href="#__codelineno-734-14">14</a></span>
<span class="normal"><a href="#__codelineno-734-15">15</a></span>
<span class="normal"><a href="#__codelineno-734-16">16</a></span>
<span class="normal"><a href="#__codelineno-734-17">17</a></span>
<span class="normal"><a href="#__codelineno-734-18">18</a></span>
<span class="normal"><a href="#__codelineno-734-19">19</a></span>
<span class="normal"><a href="#__codelineno-734-20">20</a></span>
<span class="normal"><a href="#__codelineno-734-21">21</a></span>
<span class="normal"><a href="#__codelineno-734-22">22</a></span>
<span class="normal"><a href="#__codelineno-734-23">23</a></span>
<span class="normal"><a href="#__codelineno-734-24">24</a></span>
<span class="normal"><a href="#__codelineno-734-25">25</a></span>
<span class="normal"><a href="#__codelineno-734-26">26</a></span>
<span class="normal"><a href="#__codelineno-734-27">27</a></span>
<span class="normal"><a href="#__codelineno-734-28">28</a></span>
<span class="normal"><a href="#__codelineno-734-29">29</a></span>
<span class="normal"><a href="#__codelineno-734-30">30</a></span>
<span class="normal"><a href="#__codelineno-734-31">31</a></span>
<span class="normal"><a href="#__codelineno-734-32">32</a></span>
<span class="normal"><a href="#__codelineno-734-33">33</a></span>
<span class="normal"><a href="#__codelineno-734-34">34</a></span>
<span class="normal"><a href="#__codelineno-734-35">35</a></span>
<span class="normal"><a href="#__codelineno-734-36">36</a></span>
<span class="normal"><a href="#__codelineno-734-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-734-1" name="__codelineno-734-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-734-2" name="__codelineno-734-2"></a>
<a id="__codelineno-734-3" name="__codelineno-734-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-734-4" name="__codelineno-734-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-734-5" name="__codelineno-734-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-734-6" name="__codelineno-734-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-734-7" name="__codelineno-734-7"></a>
<a id="__codelineno-734-8" name="__codelineno-734-8"></a><span class="w">    </span><span class="s">&quot;github.com/go-redis/redis/v8&quot;</span>
<a id="__codelineno-734-9" name="__codelineno-734-9"></a><span class="w">    </span><span class="s">&quot;github.com/username/distributed-task-scheduler/scheduler&quot;</span>
<a id="__codelineno-734-10" name="__codelineno-734-10"></a><span class="w">    </span><span class="s">&quot;github.com/username/distributed-task-scheduler/worker&quot;</span>
<a id="__codelineno-734-11" name="__codelineno-734-11"></a><span class="p">)</span>
<a id="__codelineno-734-12" name="__codelineno-734-12"></a>
<a id="__codelineno-734-13" name="__codelineno-734-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-734-14" name="__codelineno-734-14"></a><span class="w">    </span><span class="c1">// 初始化Redis客户端</span>
<a id="__codelineno-734-15" name="__codelineno-734-15"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-734-16" name="__codelineno-734-16"></a><span class="w">    </span><span class="nx">rdb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">NewClient</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<a id="__codelineno-734-17" name="__codelineno-734-17"></a><span class="w">        </span><span class="nx">Addr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost:6379&quot;</span><span class="p">,</span>
<a id="__codelineno-734-18" name="__codelineno-734-18"></a><span class="w">        </span><span class="nx">DB</span><span class="p">:</span><span class="w">   </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-734-19" name="__codelineno-734-19"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-734-20" name="__codelineno-734-20"></a>
<a id="__codelineno-734-21" name="__codelineno-734-21"></a><span class="w">    </span><span class="c1">// 测试Redis连接</span>
<a id="__codelineno-734-22" name="__codelineno-734-22"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rdb</span><span class="p">.</span><span class="nx">Ping</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Result</span><span class="p">()</span>
<a id="__codelineno-734-23" name="__codelineno-734-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-734-24" name="__codelineno-734-24"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;无法连接到Redis: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-734-25" name="__codelineno-734-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-734-26" name="__codelineno-734-26"></a>
<a id="__codelineno-734-27" name="__codelineno-734-27"></a><span class="w">    </span><span class="c1">// 启动调度器</span>
<a id="__codelineno-734-28" name="__codelineno-734-28"></a><span class="w">    </span><span class="nx">sched</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">scheduler</span><span class="p">.</span><span class="nx">NewScheduler</span><span class="p">()</span>
<a id="__codelineno-734-29" name="__codelineno-734-29"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">sched</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
<a id="__codelineno-734-30" name="__codelineno-734-30"></a>
<a id="__codelineno-734-31" name="__codelineno-734-31"></a><span class="w">    </span><span class="c1">// 启动工作节点</span>
<a id="__codelineno-734-32" name="__codelineno-734-32"></a><span class="w">    </span><span class="nx">w</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">worker</span><span class="p">.</span><span class="nx">NewWorker</span><span class="p">(</span><span class="nx">rdb</span><span class="p">,</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;worker-1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-734-33" name="__codelineno-734-33"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
<a id="__codelineno-734-34" name="__codelineno-734-34"></a>
<a id="__codelineno-734-35" name="__codelineno-734-35"></a><span class="w">    </span><span class="c1">// 阻塞主线程</span>
<a id="__codelineno-734-36" name="__codelineno-734-36"></a><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-734-37" name="__codelineno-734-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>初始化Redis客户端并测试连接。</li>
<li>创建并启动调度器的HTTP服务器。</li>
<li>创建并启动一个工作节点。</li>
<li>使用<code>select {}</code>阻塞主线程，保持程序运行。</li>
</ul>
<h4 id="10-运行调度器和工作节点">10. 运行调度器和工作节点<a class="headerlink" href="#10-运行调度器和工作节点" title="Permanent link">&para;</a></h4>
<p>确保Redis服务器已启动，并在终端中导航到<code>distributed-task-scheduler</code>目录，运行以下命令启动调度器和工作节点：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-735-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-735-1" name="__codelineno-735-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-736-1">1</a></span>
<span class="normal"><a href="#__codelineno-736-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-736-1" name="__codelineno-736-1"></a>2024/04/27 12:30:00 调度器服务器启动在 http://localhost:8081
<a id="__codelineno-736-2" name="__codelineno-736-2"></a>2024/04/27 12:30:00 工作节点 worker-1 启动
</code></pre></div></td></tr></table></div>
<h4 id="11-测试任务提交和执行">11. 测试任务提交和执行<a class="headerlink" href="#11-测试任务提交和执行" title="Permanent link">&para;</a></h4>
<p>使用<code>curl</code>或Postman等工具提交任务，并观察工作节点的执行情况。</p>
<h5 id="1-提交任务">1. 提交任务<a class="headerlink" href="#1-提交任务" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-737-1">1</a></span>
<span class="normal"><a href="#__codelineno-737-2">2</a></span>
<span class="normal"><a href="#__codelineno-737-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-737-1" name="__codelineno-737-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8081/tasks<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-737-2" name="__codelineno-737-2"></a><span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-737-3" name="__codelineno-737-3"></a><span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;type&quot;:&quot;print&quot;,&quot;payload&quot;:&quot;Hello, World!&quot;}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-738-1">1</a></span>
<span class="normal"><a href="#__codelineno-738-2">2</a></span>
<span class="normal"><a href="#__codelineno-738-3">3</a></span>
<span class="normal"><a href="#__codelineno-738-4">4</a></span>
<span class="normal"><a href="#__codelineno-738-5">5</a></span>
<span class="normal"><a href="#__codelineno-738-6">6</a></span>
<span class="normal"><a href="#__codelineno-738-7">7</a></span>
<span class="normal"><a href="#__codelineno-738-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-738-1" name="__codelineno-738-1"></a><span class="p">{</span>
<a id="__codelineno-738-2" name="__codelineno-738-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-738-3" name="__codelineno-738-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-738-4" name="__codelineno-738-4"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;e4d909c290d0fb1ca068ffaddf22cbd0&quot;</span><span class="p">,</span>
<a id="__codelineno-738-5" name="__codelineno-738-5"></a><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;print&quot;</span><span class="p">,</span>
<a id="__codelineno-738-6" name="__codelineno-738-6"></a><span class="w">        </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello, World!&quot;</span>
<a id="__codelineno-738-7" name="__codelineno-738-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-738-8" name="__codelineno-738-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>工作节点输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-739-1">1</a></span>
<span class="normal"><a href="#__codelineno-739-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-739-1" name="__codelineno-739-1"></a>工作节点 worker-1 执行任务: e4d909c290d0fb1ca068ffaddf22cbd0 - print
<a id="__codelineno-739-2" name="__codelineno-739-2"></a>任务 e4d909c290d0fb1ca068ffaddf22cbd0: Hello, World!
</code></pre></div></td></tr></table></div>
<h5 id="2-提交休眠任务">2. 提交休眠任务<a class="headerlink" href="#2-提交休眠任务" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-740-1">1</a></span>
<span class="normal"><a href="#__codelineno-740-2">2</a></span>
<span class="normal"><a href="#__codelineno-740-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-740-1" name="__codelineno-740-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8081/tasks<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-740-2" name="__codelineno-740-2"></a><span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-740-3" name="__codelineno-740-3"></a><span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;type&quot;:&quot;sleep&quot;,&quot;payload&quot;:&quot;5s&quot;}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-741-1">1</a></span>
<span class="normal"><a href="#__codelineno-741-2">2</a></span>
<span class="normal"><a href="#__codelineno-741-3">3</a></span>
<span class="normal"><a href="#__codelineno-741-4">4</a></span>
<span class="normal"><a href="#__codelineno-741-5">5</a></span>
<span class="normal"><a href="#__codelineno-741-6">6</a></span>
<span class="normal"><a href="#__codelineno-741-7">7</a></span>
<span class="normal"><a href="#__codelineno-741-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-741-1" name="__codelineno-741-1"></a><span class="p">{</span>
<a id="__codelineno-741-2" name="__codelineno-741-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-741-3" name="__codelineno-741-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-741-4" name="__codelineno-741-4"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1c8a5d0b2f3e4a5b6c7d8e9f0a1b2c3d&quot;</span><span class="p">,</span>
<a id="__codelineno-741-5" name="__codelineno-741-5"></a><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span>
<a id="__codelineno-741-6" name="__codelineno-741-6"></a><span class="w">        </span><span class="nt">&quot;payload&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5s&quot;</span>
<a id="__codelineno-741-7" name="__codelineno-741-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-741-8" name="__codelineno-741-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>工作节点输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-742-1">1</a></span>
<span class="normal"><a href="#__codelineno-742-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-742-1" name="__codelineno-742-1"></a>工作节点 worker-1 执行任务: 1c8a5d0b2f3e4a5b6c7d8e9f0a1b2c3d - sleep
<a id="__codelineno-742-2" name="__codelineno-742-2"></a>任务 1c8a5d0b2f3e4a5b6c7d8e9f0a1b2c3d: 已睡眠 5s
</code></pre></div></td></tr></table></div>
<h5 id="3-查看任务队列">3. 查看任务队列<a class="headerlink" href="#3-查看任务队列" title="Permanent link">&para;</a></h5>
<p><strong>请求：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-743-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-743-1" name="__codelineno-743-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8081/tasks
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-744-1">1</a></span>
<span class="normal"><a href="#__codelineno-744-2">2</a></span>
<span class="normal"><a href="#__codelineno-744-3">3</a></span>
<span class="normal"><a href="#__codelineno-744-4">4</a></span>
<span class="normal"><a href="#__codelineno-744-5">5</a></span>
<span class="normal"><a href="#__codelineno-744-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-744-1" name="__codelineno-744-1"></a><span class="p">{</span>
<a id="__codelineno-744-2" name="__codelineno-744-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-744-3" name="__codelineno-744-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-744-4" name="__codelineno-744-4"></a><span class="w">        </span><span class="nt">&quot;total_tasks_in_queue&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-744-5" name="__codelineno-744-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-744-6" name="__codelineno-744-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>解释：</strong></p>
<ul>
<li>在提交任务后，工作节点会从Redis队列中获取任务并执行。</li>
<li>任务队列中的任务数随着任务的提交和执行而变化。</li>
</ul>
<h4 id="12-代码解析">12. 代码解析<a class="headerlink" href="#12-代码解析" title="Permanent link">&para;</a></h4>
<ul>
<li>调度器</li>
</ul>
<p>：</p>
<ul>
<li>提供HTTP API供客户端提交任务和查询任务状态。</li>
<li>
<p>使用Redis作为任务队列，集中管理任务分发。</p>
</li>
<li>
<p>工作节点</p>
</li>
</ul>
<p>：</p>
<ul>
<li>从Redis队列中阻塞获取任务，确保高效的任务处理。</li>
<li>
<p>根据任务类型执行不同的操作，如打印信息或休眠指定时间。</p>
</li>
<li>
<p>任务管理</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用UUID生成唯一任务ID，避免任务冲突。</li>
<li>
<p>通过Redis列表管理任务队列，实现任务的顺序和持久化。</p>
</li>
<li>
<p>并发控制</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用Goroutine和Channel实现高并发的任务抓取和执行。</li>
<li>通过<code>sync.WaitGroup</code>和<code>sync.RWMutex</code>确保线程安全。</li>
</ul>
<h4 id="13-扩展功能">13. 扩展功能<a class="headerlink" href="#13-扩展功能" title="Permanent link">&para;</a></h4>
<p>为了提升分布式任务调度系统的功能和可靠性，可以添加以下扩展：</p>
<ul>
<li><strong>任务状态持久化</strong>：将任务状态（如待执行、执行中、完成）存储到数据库中，支持任务重试和监控。</li>
<li><strong>多工作节点支持</strong>：部署多个工作节点，实现任务的负载均衡和高可用性。</li>
<li><strong>任务优先级</strong>：为任务分配优先级，优先处理重要任务。</li>
<li><strong>错误重试机制</strong>：在任务执行失败时，自动重试特定次数。</li>
<li><strong>任务依赖管理</strong>：支持任务之间的依赖关系，确保任务按顺序执行。</li>
</ul>
<h3 id="156-总结">15.6 总结<a class="headerlink" href="#156-总结" title="Permanent link">&para;</a></h3>
<p>本章通过多个实际项目的开发，展示了Go语言在Web开发、RESTful API构建、文件处理、并发爬虫和分布式任务调度等领域的强大能力。通过详细的项目结构、代码示例和功能解析，你已经掌握了在实际应用中使用Go语言的核心技能。</p>
<p><strong>关键点回顾：</strong></p>
<ul>
<li>简单的 Web 应用</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>net/http</code>和<code>html/template</code>构建基本的Web服务器。</li>
<li>
<p>处理路由、模板渲染和静态文件服务。</p>
</li>
<li>
<p>RESTful API 开发</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用<code>gorilla/mux</code>管理路由，实现用户资源的CRUD操作。</li>
<li>
<p>设计统一的响应格式，增强API的可用性和一致性。</p>
</li>
<li>
<p>文件上传与下载</p>
</li>
</ul>
<p>：</p>
<ul>
<li>实现文件的上传和下载功能，处理表单数据和文件保存。</li>
<li>
<p>确保文件处理的安全性，防止恶意上传和路径遍历。</p>
</li>
<li>
<p>并发爬虫</p>
</li>
</ul>
<p>：</p>
<ul>
<li>使用Goroutine和Channel实现高效的并发抓取。</li>
<li>
<p>管理任务队列和已访问URL，优化爬虫性能。</p>
</li>
<li>
<p>分布式任务调度</p>
</li>
</ul>
<p>：</p>
<ul>
<li>构建基于Redis的任务队列，实现任务的分发和执行。</li>
<li>使用Goroutine和Gorilla/Mux构建可扩展的调度系统。</li>
</ul>
<p><strong>最佳实践：</strong></p>
<ul>
<li><strong>模块化设计</strong>：将项目划分为不同的模块和目录，提升代码的可维护性和可扩展性。</li>
<li><strong>并发控制</strong>：合理使用Goroutine和同步机制，确保并发程序的正确性和效率。</li>
<li><strong>错误处理</strong>：在每个关键步骤中检查并处理错误，提升程序的健壮性。</li>
<li><strong>代码格式化</strong>：使用<code>go fmt</code>统一代码风格，提升代码的可读性和团队协作效率。</li>
<li><strong>日志记录和监控</strong>：集成日志记录和监控工具，实时跟踪应用的运行状态和性能指标。</li>
<li><strong>安全性考量</strong>：在Web应用和API中，确保输入验证、认证授权和数据保护，防止常见的安全漏洞。</li>
</ul>
<h2 id="16-进一步学习">16. 进一步学习<a class="headerlink" href="#16-进一步学习" title="Permanent link">&para;</a></h2>
<p>在前面的章节中，我们已经掌握了Go语言的基础知识和一些高级特性。本章将深入探讨Go语言的内存管理机制，包括垃圾回收（Garbage Collection）和内存模型，帮助你更好地理解Go程序的运行原理。此外，我们还将介绍一些流行的开源框架与库，如Gin、Beego和Gorm，拓展你的开发工具箱，提升开发效率和项目质量。</p>
<h3 id="161-深入理解-go-的垃圾回收">16.1 深入理解 Go 的垃圾回收<a class="headerlink" href="#161-深入理解-go-的垃圾回收" title="Permanent link">&para;</a></h3>
<p>垃圾回收（Garbage Collection，简称GC）是现代编程语言中用于自动管理内存的重要机制。Go语言内置了高效的垃圾回收器，使开发者无需手动管理内存，减少了内存泄漏和悬挂指针等问题的发生。本节将详细介绍Go的垃圾回收机制，包括其工作原理、特点、调优方法以及在实际开发中的应用。</p>
<h4 id="1-垃圾回收的基本概念">1. 垃圾回收的基本概念<a class="headerlink" href="#1-垃圾回收的基本概念" title="Permanent link">&para;</a></h4>
<p>垃圾回收是一种自动内存管理技术，用于回收程序中不再使用的内存空间。通过识别和释放这些内存，垃圾回收器帮助开发者避免内存泄漏和其他内存相关的问题。</p>
<h4 id="2-go-垃圾回收器的工作原理">2. Go 垃圾回收器的工作原理<a class="headerlink" href="#2-go-垃圾回收器的工作原理" title="Permanent link">&para;</a></h4>
<p>Go的垃圾回收器采用了并发的标记-清除（Mark-and-Sweep）算法，具体如下：</p>
<ul>
<li><strong>标记阶段</strong>：垃圾回收器遍历所有可达的对象（即仍被引用的对象），并将它们标记为“活跃”的。</li>
<li><strong>清除阶段</strong>：未被标记的对象被视为“垃圾”，其占用的内存被回收。</li>
</ul>
<p>Go的垃圾回收器具备以下特点：</p>
<ul>
<li><strong>并发性</strong>：标记和清除阶段与应用程序的执行并发进行，减少了GC暂停时间。</li>
<li><strong>分代收集</strong>：虽然Go的GC不是严格的分代收集，但它通过优化年轻对象的回收频率，提升了性能。</li>
<li><strong>低延迟</strong>：Go的GC设计注重低延迟，适合构建高性能、实时性要求高的应用。</li>
</ul>
<h4 id="3-垃圾回收的触发条件">3. 垃圾回收的触发条件<a class="headerlink" href="#3-垃圾回收的触发条件" title="Permanent link">&para;</a></h4>
<p>Go的垃圾回收器会在以下几种情况下触发：</p>
<ul>
<li><strong>内存分配</strong>：当分配新的内存对象时，如果堆内存使用量超过了设定的阈值，GC将被触发。</li>
<li><strong>手动触发</strong>：开发者可以通过<code>runtime.GC()</code>手动触发垃圾回收，但通常不建议频繁使用，以避免影响性能。</li>
</ul>
<h4 id="4-垃圾回收的调优">4. 垃圾回收的调优<a class="headerlink" href="#4-垃圾回收的调优" title="Permanent link">&para;</a></h4>
<p>Go提供了一些环境变量和调试工具，帮助开发者调优GC的行为：</p>
<ul>
<li><strong>GOGC</strong>：这是一个环境变量，用于控制GC的触发频率。其默认值为100，表示当堆内存增长了100%时，触发一次GC。通过调整GOGC的值，可以平衡内存使用和GC性能。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-745-1">1</a></span>
<span class="normal"><a href="#__codelineno-745-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-745-1" name="__codelineno-745-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GOGC</span><span class="o">=</span><span class="m">200</span><span class="w"> </span><span class="c1"># 堆内存增长200%后触发GC</span>
<a id="__codelineno-745-2" name="__codelineno-745-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GOGC</span><span class="o">=</span><span class="m">50</span><span class="w">  </span><span class="c1"># 堆内存增长50%后触发GC</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>运行时调试</strong>：使用<code>runtime</code>包中的函数，如<code>runtime.ReadMemStats</code>，可以获取当前内存和GC的统计信息，辅助进行性能分析和优化。</li>
</ul>
<p><strong>示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-746-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-746-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-746-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-746-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-746-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-746-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-746-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-746-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-746-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-746-10">10</a></span>
<span class="normal"><a href="#__codelineno-746-11">11</a></span>
<span class="normal"><a href="#__codelineno-746-12">12</a></span>
<span class="normal"><a href="#__codelineno-746-13">13</a></span>
<span class="normal"><a href="#__codelineno-746-14">14</a></span>
<span class="normal"><a href="#__codelineno-746-15">15</a></span>
<span class="normal"><a href="#__codelineno-746-16">16</a></span>
<span class="normal"><a href="#__codelineno-746-17">17</a></span>
<span class="normal"><a href="#__codelineno-746-18">18</a></span>
<span class="normal"><a href="#__codelineno-746-19">19</a></span>
<span class="normal"><a href="#__codelineno-746-20">20</a></span>
<span class="normal"><a href="#__codelineno-746-21">21</a></span>
<span class="normal"><a href="#__codelineno-746-22">22</a></span>
<span class="normal"><a href="#__codelineno-746-23">23</a></span>
<span class="normal"><a href="#__codelineno-746-24">24</a></span>
<span class="normal"><a href="#__codelineno-746-25">25</a></span>
<span class="normal"><a href="#__codelineno-746-26">26</a></span>
<span class="normal"><a href="#__codelineno-746-27">27</a></span>
<span class="normal"><a href="#__codelineno-746-28">28</a></span>
<span class="normal"><a href="#__codelineno-746-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-746-1" name="__codelineno-746-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-746-2" name="__codelineno-746-2"></a>
<a id="__codelineno-746-3" name="__codelineno-746-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-746-4" name="__codelineno-746-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-746-5" name="__codelineno-746-5"></a><span class="w">    </span><span class="s">&quot;runtime&quot;</span>
<a id="__codelineno-746-6" name="__codelineno-746-6"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-746-7" name="__codelineno-746-7"></a><span class="p">)</span>
<a id="__codelineno-746-8" name="__codelineno-746-8"></a>
<a id="__codelineno-746-9" name="__codelineno-746-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-746-10" name="__codelineno-746-10"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">MemStats</span>
<a id="__codelineno-746-11" name="__codelineno-746-11"></a><span class="w">    </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">ReadMemStats</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">m</span><span class="p">)</span>
<a id="__codelineno-746-12" name="__codelineno-746-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Alloc = %v MiB&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bToMb</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Alloc</span><span class="p">))</span>
<a id="__codelineno-746-13" name="__codelineno-746-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;\tTotalAlloc = %v MiB&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bToMb</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">TotalAlloc</span><span class="p">))</span>
<a id="__codelineno-746-14" name="__codelineno-746-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;\tSys = %v MiB&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bToMb</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Sys</span><span class="p">))</span>
<a id="__codelineno-746-15" name="__codelineno-746-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;\tNumGC = %v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">NumGC</span><span class="p">)</span>
<a id="__codelineno-746-16" name="__codelineno-746-16"></a>
<a id="__codelineno-746-17" name="__codelineno-746-17"></a><span class="w">    </span><span class="c1">// 模拟内存分配</span>
<a id="__codelineno-746-18" name="__codelineno-746-18"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span>
<a id="__codelineno-746-19" name="__codelineno-746-19"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-746-20" name="__codelineno-746-20"></a><span class="w">        </span><span class="nx">s</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">)</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="c1">// 每次分配10MB</span>
<a id="__codelineno-746-21" name="__codelineno-746-21"></a><span class="w">        </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">ReadMemStats</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">m</span><span class="p">)</span>
<a id="__codelineno-746-22" name="__codelineno-746-22"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Alloc = %v MiB\tNumGC = %v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bToMb</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Alloc</span><span class="p">),</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">NumGC</span><span class="p">)</span>
<a id="__codelineno-746-23" name="__codelineno-746-23"></a><span class="w">        </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<a id="__codelineno-746-24" name="__codelineno-746-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-746-25" name="__codelineno-746-25"></a><span class="p">}</span>
<a id="__codelineno-746-26" name="__codelineno-746-26"></a>
<a id="__codelineno-746-27" name="__codelineno-746-27"></a><span class="kd">func</span><span class="w"> </span><span class="nx">bToMb</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="kt">uint64</span><span class="p">)</span><span class="w"> </span><span class="kt">uint64</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-746-28" name="__codelineno-746-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span>
<a id="__codelineno-746-29" name="__codelineno-746-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-747-1">1</a></span>
<span class="normal"><a href="#__codelineno-747-2">2</a></span>
<span class="normal"><a href="#__codelineno-747-3">3</a></span>
<span class="normal"><a href="#__codelineno-747-4">4</a></span>
<span class="normal"><a href="#__codelineno-747-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-747-1" name="__codelineno-747-1"></a>Alloc = 0 MiB TotalAlloc = 0 MiB  Sys = 0 MiB NumGC = 0
<a id="__codelineno-747-2" name="__codelineno-747-2"></a>Alloc = 10 MiB    NumGC = 1
<a id="__codelineno-747-3" name="__codelineno-747-3"></a>Alloc = 20 MiB    NumGC = 1
<a id="__codelineno-747-4" name="__codelineno-747-4"></a>Alloc = 30 MiB    NumGC = 1
<a id="__codelineno-747-5" name="__codelineno-747-5"></a>...
</code></pre></div></td></tr></table></div>
<h4 id="5-gc对性能的影响">5. GC对性能的影响<a class="headerlink" href="#5-gc对性能的影响" title="Permanent link">&para;</a></h4>
<p>虽然Go的垃圾回收器设计高效，但在高性能应用中，GC仍可能带来一定的性能开销。以下是一些常见的影响及优化建议：</p>
<ul>
<li><strong>暂停时间</strong>：尽管GC是并发的，但在某些情况下仍可能引起短暂的暂停。通过优化GOGC值和减少内存分配，可以降低GC的触发频率。</li>
<li><strong>内存占用</strong>：较高的GOGC值会减少GC的频率，但可能导致更高的内存占用。根据应用需求平衡内存使用和GC性能。</li>
<li><strong>内存分配策略</strong>：合理设计数据结构，避免频繁的内存分配和释放，减少GC的压力。</li>
</ul>
<h4 id="6-实践中的gc优化">6. 实践中的GC优化<a class="headerlink" href="#6-实践中的gc优化" title="Permanent link">&para;</a></h4>
<p>以下是一些在实际开发中优化GC性能的建议：</p>
<ul>
<li><strong>减少临时对象</strong>：避免在热点代码中创建大量临时对象，使用对象池（如<code>sync.Pool</code>）复用对象。</li>
<li><strong>预分配内存</strong>：对于已知大小的数据结构，提前分配足够的内存，减少运行时的内存分配。</li>
<li><strong>优化数据结构</strong>：选择高效的数据结构，如使用切片（slice）代替链表（list），提升内存访问效率。</li>
<li><strong>控制并发度</strong>：在高并发场景下，合理控制Goroutine的数量，避免过多的内存分配和GC开销。</li>
</ul>
<p><strong>示例：使用<code>sync.Pool</code>复用对象</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-748-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-748-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-748-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-748-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-748-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-748-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-748-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-748-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-748-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-748-10">10</a></span>
<span class="normal"><a href="#__codelineno-748-11">11</a></span>
<span class="normal"><a href="#__codelineno-748-12">12</a></span>
<span class="normal"><a href="#__codelineno-748-13">13</a></span>
<span class="normal"><a href="#__codelineno-748-14">14</a></span>
<span class="normal"><a href="#__codelineno-748-15">15</a></span>
<span class="normal"><a href="#__codelineno-748-16">16</a></span>
<span class="normal"><a href="#__codelineno-748-17">17</a></span>
<span class="normal"><a href="#__codelineno-748-18">18</a></span>
<span class="normal"><a href="#__codelineno-748-19">19</a></span>
<span class="normal"><a href="#__codelineno-748-20">20</a></span>
<span class="normal"><a href="#__codelineno-748-21">21</a></span>
<span class="normal"><a href="#__codelineno-748-22">22</a></span>
<span class="normal"><a href="#__codelineno-748-23">23</a></span>
<span class="normal"><a href="#__codelineno-748-24">24</a></span>
<span class="normal"><a href="#__codelineno-748-25">25</a></span>
<span class="normal"><a href="#__codelineno-748-26">26</a></span>
<span class="normal"><a href="#__codelineno-748-27">27</a></span>
<span class="normal"><a href="#__codelineno-748-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-748-1" name="__codelineno-748-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-748-2" name="__codelineno-748-2"></a>
<a id="__codelineno-748-3" name="__codelineno-748-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-748-4" name="__codelineno-748-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-748-5" name="__codelineno-748-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-748-6" name="__codelineno-748-6"></a><span class="p">)</span>
<a id="__codelineno-748-7" name="__codelineno-748-7"></a>
<a id="__codelineno-748-8" name="__codelineno-748-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-748-9" name="__codelineno-748-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">pool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Pool</span><span class="p">{</span>
<a id="__codelineno-748-10" name="__codelineno-748-10"></a><span class="w">        </span><span class="nx">New</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-748-11" name="__codelineno-748-11"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">)</span><span class="w"> </span><span class="c1">// 每个对象为1KB</span>
<a id="__codelineno-748-12" name="__codelineno-748-12"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-748-13" name="__codelineno-748-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-748-14" name="__codelineno-748-14"></a>
<a id="__codelineno-748-15" name="__codelineno-748-15"></a><span class="w">    </span><span class="c1">// 获取对象</span>
<a id="__codelineno-748-16" name="__codelineno-748-16"></a><span class="w">    </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">Get</span><span class="p">().([]</span><span class="kt">byte</span><span class="p">)</span>
<a id="__codelineno-748-17" name="__codelineno-748-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;获取对象: %p\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">)</span>
<a id="__codelineno-748-18" name="__codelineno-748-18"></a>
<a id="__codelineno-748-19" name="__codelineno-748-19"></a><span class="w">    </span><span class="c1">// 使用对象</span>
<a id="__codelineno-748-20" name="__codelineno-748-20"></a><span class="w">    </span><span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-748-21" name="__codelineno-748-21"></a>
<a id="__codelineno-748-22" name="__codelineno-748-22"></a><span class="w">    </span><span class="c1">// 释放对象</span>
<a id="__codelineno-748-23" name="__codelineno-748-23"></a><span class="w">    </span><span class="nx">pool</span><span class="p">.</span><span class="nx">Put</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
<a id="__codelineno-748-24" name="__codelineno-748-24"></a>
<a id="__codelineno-748-25" name="__codelineno-748-25"></a><span class="w">    </span><span class="c1">// 再次获取对象，可能是之前释放的对象</span>
<a id="__codelineno-748-26" name="__codelineno-748-26"></a><span class="w">    </span><span class="nx">obj2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">Get</span><span class="p">().([]</span><span class="kt">byte</span><span class="p">)</span>
<a id="__codelineno-748-27" name="__codelineno-748-27"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;再次获取对象: %p\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">obj2</span><span class="p">)</span>
<a id="__codelineno-748-28" name="__codelineno-748-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-749-1">1</a></span>
<span class="normal"><a href="#__codelineno-749-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-749-1" name="__codelineno-749-1"></a>获取对象: 0xc0000a2000
<a id="__codelineno-749-2" name="__codelineno-749-2"></a>再次获取对象: 0xc0000a2000
</code></pre></div></td></tr></table></div>
<p>通过对象池，可以有效减少内存分配次数，降低GC的压力。</p>
<h3 id="162-go-的内存模型">16.2 Go 的内存模型<a class="headerlink" href="#162-go-的内存模型" title="Permanent link">&para;</a></h3>
<p>理解Go的内存模型对于编写高效和线程安全的程序至关重要。Go的内存模型定义了程序中变量的存储方式、内存访问的规则以及并发时的内存交互。掌握这些知识，有助于优化内存使用，避免数据竞争和其他并发问题。</p>
<h4 id="1-内存分配栈与堆">1. 内存分配：栈与堆<a class="headerlink" href="#1-内存分配栈与堆" title="Permanent link">&para;</a></h4>
<p>Go程序中的变量可以存储在栈（stack）或堆（heap）中。编译器通过逃逸分析（Escape Analysis）决定变量的存储位置。</p>
<ul>
<li>栈</li>
</ul>
<p>：</p>
<ul>
<li><strong>特点</strong>：栈内存的分配和释放速度快，生命周期由函数调用决定。</li>
<li>
<p><strong>适用场景</strong>：局部变量、函数参数等生命周期较短的变量。</p>
</li>
<li>
<p>堆</p>
</li>
</ul>
<p>：</p>
<ul>
<li><strong>特点</strong>：堆内存的分配和释放由垃圾回收器管理，适用于需要跨函数或较长生命周期的变量。</li>
<li><strong>适用场景</strong>：返回值需要在函数外部使用的变量、大型数据结构等。</li>
</ul>
<p><strong>示例：逃逸分析</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-750-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-750-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-750-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-750-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-750-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-750-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-750-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-750-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-750-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-750-10">10</a></span>
<span class="normal"><a href="#__codelineno-750-11">11</a></span>
<span class="normal"><a href="#__codelineno-750-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-750-1" name="__codelineno-750-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-750-2" name="__codelineno-750-2"></a>
<a id="__codelineno-750-3" name="__codelineno-750-3"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-750-4" name="__codelineno-750-4"></a><span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span><span class="w">          </span><span class="c1">// 存储在栈上</span>
<a id="__codelineno-750-5" name="__codelineno-750-5"></a><span class="w">    </span><span class="nx">b</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">a</span><span class="w">          </span><span class="c1">// 指针引用，a仍然在栈上</span>
<a id="__codelineno-750-6" name="__codelineno-750-6"></a><span class="w">    </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">createPointer</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="c1">// 可能逃逸到堆上</span>
<a id="__codelineno-750-7" name="__codelineno-750-7"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">c</span>
<a id="__codelineno-750-8" name="__codelineno-750-8"></a><span class="p">}</span>
<a id="__codelineno-750-9" name="__codelineno-750-9"></a>
<a id="__codelineno-750-10" name="__codelineno-750-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">createPointer</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-750-11" name="__codelineno-750-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">x</span><span class="w"> </span><span class="c1">// x逃逸到堆上，因为返回给了主函数</span>
<a id="__codelineno-750-12" name="__codelineno-750-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在上述示例中，变量<code>a</code>和<code>b</code>可能被分配在栈上，而变量<code>c</code>则需要在堆上分配，因为它被返回并在函数外部使用。</p>
<h4 id="2-指针与引用">2. 指针与引用<a class="headerlink" href="#2-指针与引用" title="Permanent link">&para;</a></h4>
<p>Go语言支持指针，可以通过指针直接访问和修改变量的值。然而，Go的指针与C/C++有所不同，Go的指针不支持指针运算，且拥有自动的垃圾回收机制，降低了内存管理的复杂性和安全性。</p>
<p><strong>示例：指针的使用</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-751-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-751-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-751-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-751-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-751-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-751-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-751-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-751-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-751-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-751-10">10</a></span>
<span class="normal"><a href="#__codelineno-751-11">11</a></span>
<span class="normal"><a href="#__codelineno-751-12">12</a></span>
<span class="normal"><a href="#__codelineno-751-13">13</a></span>
<span class="normal"><a href="#__codelineno-751-14">14</a></span>
<span class="normal"><a href="#__codelineno-751-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-751-1" name="__codelineno-751-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-751-2" name="__codelineno-751-2"></a>
<a id="__codelineno-751-3" name="__codelineno-751-3"></a><span class="kn">import</span><span class="w"> </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-751-4" name="__codelineno-751-4"></a>
<a id="__codelineno-751-5" name="__codelineno-751-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-751-6" name="__codelineno-751-6"></a><span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-751-7" name="__codelineno-751-7"></a><span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">x</span><span class="w"> </span><span class="c1">// 获取x的指针</span>
<a id="__codelineno-751-8" name="__codelineno-751-8"></a>
<a id="__codelineno-751-9" name="__codelineno-751-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;x:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-751-10" name="__codelineno-751-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;y:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span>
<a id="__codelineno-751-11" name="__codelineno-751-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;*y:&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">y</span><span class="p">)</span>
<a id="__codelineno-751-12" name="__codelineno-751-12"></a>
<a id="__codelineno-751-13" name="__codelineno-751-13"></a><span class="w">    </span><span class="o">*</span><span class="nx">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="c1">// 通过指针修改x的值</span>
<a id="__codelineno-751-14" name="__codelineno-751-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;修改后的x:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-751-15" name="__codelineno-751-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-752-1">1</a></span>
<span class="normal"><a href="#__codelineno-752-2">2</a></span>
<span class="normal"><a href="#__codelineno-752-3">3</a></span>
<span class="normal"><a href="#__codelineno-752-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-752-1" name="__codelineno-752-1"></a>x: 10
<a id="__codelineno-752-2" name="__codelineno-752-2"></a>y: 0xc0000a2008
<a id="__codelineno-752-3" name="__codelineno-752-3"></a>*y: 10
<a id="__codelineno-752-4" name="__codelineno-752-4"></a>修改后的x: 20
</code></pre></div></td></tr></table></div>
<h4 id="3-并发与内存模型">3. 并发与内存模型<a class="headerlink" href="#3-并发与内存模型" title="Permanent link">&para;</a></h4>
<p>Go的内存模型定义了在并发环境下不同Goroutine之间的内存交互规则。理解这些规则有助于编写线程安全的程序，避免数据竞争和其他并发问题。</p>
<ul>
<li><strong>顺序一致性</strong>：Go保证在同一个Goroutine内，代码按顺序执行。在不同Goroutine之间，通过同步原语（如<code>sync.Mutex</code>、<code>sync.WaitGroup</code>、Channel等）进行内存同步。</li>
<li><strong>数据竞争</strong>：当多个Goroutine并发访问同一个内存地址，且至少有一个Goroutine进行写操作，而没有适当的同步机制时，就会发生数据竞争。Go提供了<code>-race</code>检测工具，帮助发现和修复数据竞争。</li>
</ul>
<p><strong>示例：数据竞争</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-753-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-753-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-753-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-753-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-753-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-753-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-753-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-753-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-753-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-753-10">10</a></span>
<span class="normal"><a href="#__codelineno-753-11">11</a></span>
<span class="normal"><a href="#__codelineno-753-12">12</a></span>
<span class="normal"><a href="#__codelineno-753-13">13</a></span>
<span class="normal"><a href="#__codelineno-753-14">14</a></span>
<span class="normal"><a href="#__codelineno-753-15">15</a></span>
<span class="normal"><a href="#__codelineno-753-16">16</a></span>
<span class="normal"><a href="#__codelineno-753-17">17</a></span>
<span class="normal"><a href="#__codelineno-753-18">18</a></span>
<span class="normal"><a href="#__codelineno-753-19">19</a></span>
<span class="normal"><a href="#__codelineno-753-20">20</a></span>
<span class="normal"><a href="#__codelineno-753-21">21</a></span>
<span class="normal"><a href="#__codelineno-753-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-753-1" name="__codelineno-753-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-753-2" name="__codelineno-753-2"></a>
<a id="__codelineno-753-3" name="__codelineno-753-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-753-4" name="__codelineno-753-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-753-5" name="__codelineno-753-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-753-6" name="__codelineno-753-6"></a><span class="p">)</span>
<a id="__codelineno-753-7" name="__codelineno-753-7"></a>
<a id="__codelineno-753-8" name="__codelineno-753-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-753-9" name="__codelineno-753-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-753-10" name="__codelineno-753-10"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-753-11" name="__codelineno-753-11"></a>
<a id="__codelineno-753-12" name="__codelineno-753-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-753-13" name="__codelineno-753-13"></a><span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-753-14" name="__codelineno-753-14"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-753-15" name="__codelineno-753-15"></a><span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<a id="__codelineno-753-16" name="__codelineno-753-16"></a><span class="w">            </span><span class="nx">counter</span><span class="o">++</span>
<a id="__codelineno-753-17" name="__codelineno-753-17"></a><span class="w">        </span><span class="p">}()</span>
<a id="__codelineno-753-18" name="__codelineno-753-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-753-19" name="__codelineno-753-19"></a>
<a id="__codelineno-753-20" name="__codelineno-753-20"></a><span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<a id="__codelineno-753-21" name="__codelineno-753-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Counter:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">)</span>
<a id="__codelineno-753-22" name="__codelineno-753-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行时数据竞争检测：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-754-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-754-1" name="__codelineno-754-1"></a>go<span class="w"> </span>run<span class="w"> </span>-race<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>可能的输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-755-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-755-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-755-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-755-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-755-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-755-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-755-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-755-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-755-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-755-10">10</a></span>
<span class="normal"><a href="#__codelineno-755-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-755-1" name="__codelineno-755-1"></a>==================
<a id="__codelineno-755-2" name="__codelineno-755-2"></a>WARNING: DATA RACE
<a id="__codelineno-755-3" name="__codelineno-755-3"></a>Read at 0x0000004a6018 by goroutine 7:
<a id="__codelineno-755-4" name="__codelineno-755-4"></a>  main.main.func1()
<a id="__codelineno-755-5" name="__codelineno-755-5"></a>      /path/to/main.go:13 +0x3c
<a id="__codelineno-755-6" name="__codelineno-755-6"></a>
<a id="__codelineno-755-7" name="__codelineno-755-7"></a>Previous write at 0x0000004a6018 by goroutine 6:
<a id="__codelineno-755-8" name="__codelineno-755-8"></a>  main.main.func1()
<a id="__codelineno-755-9" name="__codelineno-755-9"></a>      /path/to/main.go:13 +0x58
<a id="__codelineno-755-10" name="__codelineno-755-10"></a>
<a id="__codelineno-755-11" name="__codelineno-755-11"></a>...
</code></pre></div></td></tr></table></div>
<p><strong>解决方法：使用互斥锁</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-756-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-756-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-756-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-756-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-756-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-756-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-756-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-756-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-756-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-756-10">10</a></span>
<span class="normal"><a href="#__codelineno-756-11">11</a></span>
<span class="normal"><a href="#__codelineno-756-12">12</a></span>
<span class="normal"><a href="#__codelineno-756-13">13</a></span>
<span class="normal"><a href="#__codelineno-756-14">14</a></span>
<span class="normal"><a href="#__codelineno-756-15">15</a></span>
<span class="normal"><a href="#__codelineno-756-16">16</a></span>
<span class="normal"><a href="#__codelineno-756-17">17</a></span>
<span class="normal"><a href="#__codelineno-756-18">18</a></span>
<span class="normal"><a href="#__codelineno-756-19">19</a></span>
<span class="normal"><a href="#__codelineno-756-20">20</a></span>
<span class="normal"><a href="#__codelineno-756-21">21</a></span>
<span class="normal"><a href="#__codelineno-756-22">22</a></span>
<span class="normal"><a href="#__codelineno-756-23">23</a></span>
<span class="normal"><a href="#__codelineno-756-24">24</a></span>
<span class="normal"><a href="#__codelineno-756-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-756-1" name="__codelineno-756-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-756-2" name="__codelineno-756-2"></a>
<a id="__codelineno-756-3" name="__codelineno-756-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-756-4" name="__codelineno-756-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-756-5" name="__codelineno-756-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-756-6" name="__codelineno-756-6"></a><span class="p">)</span>
<a id="__codelineno-756-7" name="__codelineno-756-7"></a>
<a id="__codelineno-756-8" name="__codelineno-756-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-756-9" name="__codelineno-756-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-756-10" name="__codelineno-756-10"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="kt">int</span>
<a id="__codelineno-756-11" name="__codelineno-756-11"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-756-12" name="__codelineno-756-12"></a>
<a id="__codelineno-756-13" name="__codelineno-756-13"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-756-14" name="__codelineno-756-14"></a><span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-756-15" name="__codelineno-756-15"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-756-16" name="__codelineno-756-16"></a><span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<a id="__codelineno-756-17" name="__codelineno-756-17"></a><span class="w">            </span><span class="nx">mu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-756-18" name="__codelineno-756-18"></a><span class="w">            </span><span class="nx">counter</span><span class="o">++</span>
<a id="__codelineno-756-19" name="__codelineno-756-19"></a><span class="w">            </span><span class="nx">mu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-756-20" name="__codelineno-756-20"></a><span class="w">        </span><span class="p">}()</span>
<a id="__codelineno-756-21" name="__codelineno-756-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-756-22" name="__codelineno-756-22"></a>
<a id="__codelineno-756-23" name="__codelineno-756-23"></a><span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<a id="__codelineno-756-24" name="__codelineno-756-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Counter:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">)</span>
<a id="__codelineno-756-25" name="__codelineno-756-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-757-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-757-1" name="__codelineno-757-1"></a>Counter: 1000
</code></pre></div></td></tr></table></div>
<p>通过引入<code>sync.Mutex</code>，确保了对<code>counter</code>变量的互斥访问，避免了数据竞争。</p>
<h4 id="4-内存模型的最佳实践">4. 内存模型的最佳实践<a class="headerlink" href="#4-内存模型的最佳实践" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>使用同步原语</strong>：在并发访问共享变量时，使用<code>sync.Mutex</code>、<code>sync.RWMutex</code>或Channel等同步原语，确保线程安全。</li>
<li><strong>避免全局变量</strong>：尽量减少全局变量的使用，使用函数参数和返回值传递数据，降低数据共享的复杂性。</li>
<li><strong>合理使用指针</strong>：避免不必要的指针传递，减少内存分配和GC压力，提高程序性能。</li>
<li><strong>使用不可变数据</strong>：在可能的情况下，使用不可变数据结构，简化并发编程和减少数据竞争。</li>
</ul>
<p><strong>示例：使用Channel进行同步</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-758-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-758-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-758-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-758-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-758-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-758-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-758-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-758-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-758-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-758-10">10</a></span>
<span class="normal"><a href="#__codelineno-758-11">11</a></span>
<span class="normal"><a href="#__codelineno-758-12">12</a></span>
<span class="normal"><a href="#__codelineno-758-13">13</a></span>
<span class="normal"><a href="#__codelineno-758-14">14</a></span>
<span class="normal"><a href="#__codelineno-758-15">15</a></span>
<span class="normal"><a href="#__codelineno-758-16">16</a></span>
<span class="normal"><a href="#__codelineno-758-17">17</a></span>
<span class="normal"><a href="#__codelineno-758-18">18</a></span>
<span class="normal"><a href="#__codelineno-758-19">19</a></span>
<span class="normal"><a href="#__codelineno-758-20">20</a></span>
<span class="normal"><a href="#__codelineno-758-21">21</a></span>
<span class="normal"><a href="#__codelineno-758-22">22</a></span>
<span class="normal"><a href="#__codelineno-758-23">23</a></span>
<span class="normal"><a href="#__codelineno-758-24">24</a></span>
<span class="normal"><a href="#__codelineno-758-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-758-1" name="__codelineno-758-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-758-2" name="__codelineno-758-2"></a>
<a id="__codelineno-758-3" name="__codelineno-758-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-758-4" name="__codelineno-758-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-758-5" name="__codelineno-758-5"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-758-6" name="__codelineno-758-6"></a><span class="p">)</span>
<a id="__codelineno-758-7" name="__codelineno-758-7"></a>
<a id="__codelineno-758-8" name="__codelineno-758-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-758-9" name="__codelineno-758-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<a id="__codelineno-758-10" name="__codelineno-758-10"></a><span class="w">    </span><span class="nx">counter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-758-11" name="__codelineno-758-11"></a><span class="w">    </span><span class="nx">ch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{},</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// 带缓冲的Channel作为互斥锁</span>
<a id="__codelineno-758-12" name="__codelineno-758-12"></a>
<a id="__codelineno-758-13" name="__codelineno-758-13"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-758-14" name="__codelineno-758-14"></a><span class="w">        </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-758-15" name="__codelineno-758-15"></a><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-758-16" name="__codelineno-758-16"></a><span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
<a id="__codelineno-758-17" name="__codelineno-758-17"></a><span class="w">            </span><span class="nx">ch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span><span class="w"> </span><span class="c1">// 加锁</span>
<a id="__codelineno-758-18" name="__codelineno-758-18"></a><span class="w">            </span><span class="nx">counter</span><span class="o">++</span>
<a id="__codelineno-758-19" name="__codelineno-758-19"></a><span class="w">            </span><span class="o">&lt;-</span><span class="nx">ch</span><span class="w"> </span><span class="c1">// 解锁</span>
<a id="__codelineno-758-20" name="__codelineno-758-20"></a><span class="w">        </span><span class="p">}()</span>
<a id="__codelineno-758-21" name="__codelineno-758-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-758-22" name="__codelineno-758-22"></a>
<a id="__codelineno-758-23" name="__codelineno-758-23"></a><span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<a id="__codelineno-758-24" name="__codelineno-758-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Counter:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">counter</span><span class="p">)</span>
<a id="__codelineno-758-25" name="__codelineno-758-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-759-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-759-1" name="__codelineno-759-1"></a>Counter: 1000
</code></pre></div></td></tr></table></div>
<p>通过使用带缓冲的Channel，简化了互斥锁的实现，同时保证了线程安全。</p>
<h3 id="163-开源框架与库">16.3 开源框架与库<a class="headerlink" href="#163-开源框架与库" title="Permanent link">&para;</a></h3>
<p>Go语言拥有丰富的开源生态系统，涵盖了Web框架、数据库ORM、工具库等多个领域。使用这些成熟的框架与库，可以大幅提升开发效率和代码质量。本节将重点介绍三个流行的Go开源框架与库：Gin、Beego和Gorm，并通过示例展示它们的基本用法。</p>
<h4 id="1-gin">1. Gin<a class="headerlink" href="#1-gin" title="Permanent link">&para;</a></h4>
<p><strong>Gin</strong> 是一个高性能、极简的Web框架，类似于Python的Flask或Ruby的Sinatra。它以其快速的路由、JSON验证和中间件支持而著称，适合构建RESTful API和Web应用。</p>
<h5 id="特点">特点<a class="headerlink" href="#特点" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>高性能</strong>：基于httprouter，路由匹配速度极快。</li>
<li><strong>简洁易用</strong>：API设计简洁，学习曲线平缓。</li>
<li><strong>中间件支持</strong>：内置多种中间件，支持自定义中间件。</li>
<li><strong>错误处理</strong>：统一的错误处理机制，简化错误管理。</li>
<li><strong>JSON验证</strong>：内置JSON绑定和验证功能，简化请求数据处理。</li>
</ul>
<h5 id="安装">安装<a class="headerlink" href="#安装" title="Permanent link">&para;</a></h5>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-760-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-760-1" name="__codelineno-760-1"></a>go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>github.com/gin-gonic/gin
</code></pre></div></td></tr></table></div>
<h5 id="示例构建一个简单的restful-api">示例：构建一个简单的RESTful API<a class="headerlink" href="#示例构建一个简单的restful-api" title="Permanent link">&para;</a></h5>
<p><strong>项目结构</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-761-1">1</a></span>
<span class="normal"><a href="#__codelineno-761-2">2</a></span>
<span class="normal"><a href="#__codelineno-761-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-761-1" name="__codelineno-761-1"></a>gin-example/
<a id="__codelineno-761-2" name="__codelineno-761-2"></a>├── main.go
<a id="__codelineno-761-3" name="__codelineno-761-3"></a>└── go.mod
</code></pre></div></td></tr></table></div>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-762-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-762-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-762-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-762-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-762-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-762-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-762-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-762-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-762-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-762-10">10</a></span>
<span class="normal"><a href="#__codelineno-762-11">11</a></span>
<span class="normal"><a href="#__codelineno-762-12">12</a></span>
<span class="normal"><a href="#__codelineno-762-13">13</a></span>
<span class="normal"><a href="#__codelineno-762-14">14</a></span>
<span class="normal"><a href="#__codelineno-762-15">15</a></span>
<span class="normal"><a href="#__codelineno-762-16">16</a></span>
<span class="normal"><a href="#__codelineno-762-17">17</a></span>
<span class="normal"><a href="#__codelineno-762-18">18</a></span>
<span class="normal"><a href="#__codelineno-762-19">19</a></span>
<span class="normal"><a href="#__codelineno-762-20">20</a></span>
<span class="normal"><a href="#__codelineno-762-21">21</a></span>
<span class="normal"><a href="#__codelineno-762-22">22</a></span>
<span class="normal"><a href="#__codelineno-762-23">23</a></span>
<span class="normal"><a href="#__codelineno-762-24">24</a></span>
<span class="normal"><a href="#__codelineno-762-25">25</a></span>
<span class="normal"><a href="#__codelineno-762-26">26</a></span>
<span class="normal"><a href="#__codelineno-762-27">27</a></span>
<span class="normal"><a href="#__codelineno-762-28">28</a></span>
<span class="normal"><a href="#__codelineno-762-29">29</a></span>
<span class="normal"><a href="#__codelineno-762-30">30</a></span>
<span class="normal"><a href="#__codelineno-762-31">31</a></span>
<span class="normal"><a href="#__codelineno-762-32">32</a></span>
<span class="normal"><a href="#__codelineno-762-33">33</a></span>
<span class="normal"><a href="#__codelineno-762-34">34</a></span>
<span class="normal"><a href="#__codelineno-762-35">35</a></span>
<span class="normal"><a href="#__codelineno-762-36">36</a></span>
<span class="normal"><a href="#__codelineno-762-37">37</a></span>
<span class="normal"><a href="#__codelineno-762-38">38</a></span>
<span class="normal"><a href="#__codelineno-762-39">39</a></span>
<span class="normal"><a href="#__codelineno-762-40">40</a></span>
<span class="normal"><a href="#__codelineno-762-41">41</a></span>
<span class="normal"><a href="#__codelineno-762-42">42</a></span>
<span class="normal"><a href="#__codelineno-762-43">43</a></span>
<span class="normal"><a href="#__codelineno-762-44">44</a></span>
<span class="normal"><a href="#__codelineno-762-45">45</a></span>
<span class="normal"><a href="#__codelineno-762-46">46</a></span>
<span class="normal"><a href="#__codelineno-762-47">47</a></span>
<span class="normal"><a href="#__codelineno-762-48">48</a></span>
<span class="normal"><a href="#__codelineno-762-49">49</a></span>
<span class="normal"><a href="#__codelineno-762-50">50</a></span>
<span class="normal"><a href="#__codelineno-762-51">51</a></span>
<span class="normal"><a href="#__codelineno-762-52">52</a></span>
<span class="normal"><a href="#__codelineno-762-53">53</a></span>
<span class="normal"><a href="#__codelineno-762-54">54</a></span>
<span class="normal"><a href="#__codelineno-762-55">55</a></span>
<span class="normal"><a href="#__codelineno-762-56">56</a></span>
<span class="normal"><a href="#__codelineno-762-57">57</a></span>
<span class="normal"><a href="#__codelineno-762-58">58</a></span>
<span class="normal"><a href="#__codelineno-762-59">59</a></span>
<span class="normal"><a href="#__codelineno-762-60">60</a></span>
<span class="normal"><a href="#__codelineno-762-61">61</a></span>
<span class="normal"><a href="#__codelineno-762-62">62</a></span>
<span class="normal"><a href="#__codelineno-762-63">63</a></span>
<span class="normal"><a href="#__codelineno-762-64">64</a></span>
<span class="normal"><a href="#__codelineno-762-65">65</a></span>
<span class="normal"><a href="#__codelineno-762-66">66</a></span>
<span class="normal"><a href="#__codelineno-762-67">67</a></span>
<span class="normal"><a href="#__codelineno-762-68">68</a></span>
<span class="normal"><a href="#__codelineno-762-69">69</a></span>
<span class="normal"><a href="#__codelineno-762-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-762-1" name="__codelineno-762-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-762-2" name="__codelineno-762-2"></a>
<a id="__codelineno-762-3" name="__codelineno-762-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-762-4" name="__codelineno-762-4"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<a id="__codelineno-762-5" name="__codelineno-762-5"></a>
<a id="__codelineno-762-6" name="__codelineno-762-6"></a><span class="w">    </span><span class="s">&quot;github.com/gin-gonic/gin&quot;</span>
<a id="__codelineno-762-7" name="__codelineno-762-7"></a><span class="p">)</span>
<a id="__codelineno-762-8" name="__codelineno-762-8"></a>
<a id="__codelineno-762-9" name="__codelineno-762-9"></a><span class="c1">// User 定义用户结构体</span>
<a id="__codelineno-762-10" name="__codelineno-762-10"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-11" name="__codelineno-762-11"></a><span class="w">    </span><span class="nx">ID</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;id&quot;`</span>
<a id="__codelineno-762-12" name="__codelineno-762-12"></a><span class="w">    </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot; binding:&quot;required&quot;`</span>
<a id="__codelineno-762-13" name="__codelineno-762-13"></a><span class="w">    </span><span class="nx">Email</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;email&quot; binding:&quot;required,email&quot;`</span>
<a id="__codelineno-762-14" name="__codelineno-762-14"></a><span class="p">}</span>
<a id="__codelineno-762-15" name="__codelineno-762-15"></a>
<a id="__codelineno-762-16" name="__codelineno-762-16"></a><span class="kd">var</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-762-17" name="__codelineno-762-17"></a><span class="w">    </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice@example.com&quot;</span><span class="p">},</span>
<a id="__codelineno-762-18" name="__codelineno-762-18"></a><span class="w">    </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bob@example.com&quot;</span><span class="p">},</span>
<a id="__codelineno-762-19" name="__codelineno-762-19"></a><span class="p">}</span>
<a id="__codelineno-762-20" name="__codelineno-762-20"></a>
<a id="__codelineno-762-21" name="__codelineno-762-21"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-22" name="__codelineno-762-22"></a><span class="w">    </span><span class="nx">router</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">Default</span><span class="p">()</span>
<a id="__codelineno-762-23" name="__codelineno-762-23"></a>
<a id="__codelineno-762-24" name="__codelineno-762-24"></a><span class="w">    </span><span class="c1">// 获取所有用户</span>
<a id="__codelineno-762-25" name="__codelineno-762-25"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">GET</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-26" name="__codelineno-762-26"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
<a id="__codelineno-762-27" name="__codelineno-762-27"></a><span class="w">            </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-762-28" name="__codelineno-762-28"></a><span class="w">            </span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">users</span><span class="p">,</span>
<a id="__codelineno-762-29" name="__codelineno-762-29"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-762-30" name="__codelineno-762-30"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-762-31" name="__codelineno-762-31"></a>
<a id="__codelineno-762-32" name="__codelineno-762-32"></a><span class="w">    </span><span class="c1">// 根据ID获取用户</span>
<a id="__codelineno-762-33" name="__codelineno-762-33"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">GET</span><span class="p">(</span><span class="s">&quot;/users/:id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-34" name="__codelineno-762-34"></a><span class="w">        </span><span class="nx">id</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">Param</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<a id="__codelineno-762-35" name="__codelineno-762-35"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-36" name="__codelineno-762-36"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-37" name="__codelineno-762-37"></a><span class="w">                </span><span class="nx">c</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
<a id="__codelineno-762-38" name="__codelineno-762-38"></a><span class="w">                    </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-762-39" name="__codelineno-762-39"></a><span class="w">                    </span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">user</span><span class="p">,</span>
<a id="__codelineno-762-40" name="__codelineno-762-40"></a><span class="w">                </span><span class="p">})</span>
<a id="__codelineno-762-41" name="__codelineno-762-41"></a><span class="w">                </span><span class="k">return</span>
<a id="__codelineno-762-42" name="__codelineno-762-42"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-762-43" name="__codelineno-762-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-762-44" name="__codelineno-762-44"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusNotFound</span><span class="p">,</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
<a id="__codelineno-762-45" name="__codelineno-762-45"></a><span class="w">            </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-762-46" name="__codelineno-762-46"></a><span class="w">            </span><span class="s">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;用户不存在&quot;</span><span class="p">,</span>
<a id="__codelineno-762-47" name="__codelineno-762-47"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-762-48" name="__codelineno-762-48"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-762-49" name="__codelineno-762-49"></a>
<a id="__codelineno-762-50" name="__codelineno-762-50"></a><span class="w">    </span><span class="c1">// 创建新用户</span>
<a id="__codelineno-762-51" name="__codelineno-762-51"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">POST</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-52" name="__codelineno-762-52"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">newUser</span><span class="w"> </span><span class="nx">User</span>
<a id="__codelineno-762-53" name="__codelineno-762-53"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">ShouldBindJSON</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">newUser</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-762-54" name="__codelineno-762-54"></a><span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
<a id="__codelineno-762-55" name="__codelineno-762-55"></a><span class="w">                </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-762-56" name="__codelineno-762-56"></a><span class="w">                </span><span class="s">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<a id="__codelineno-762-57" name="__codelineno-762-57"></a><span class="w">            </span><span class="p">})</span>
<a id="__codelineno-762-58" name="__codelineno-762-58"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-762-59" name="__codelineno-762-59"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-762-60" name="__codelineno-762-60"></a><span class="w">        </span><span class="nx">newUser</span><span class="p">.</span><span class="nx">ID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">users</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-762-61" name="__codelineno-762-61"></a><span class="w">        </span><span class="nx">users</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">newUser</span><span class="p">)</span>
<a id="__codelineno-762-62" name="__codelineno-762-62"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusCreated</span><span class="p">,</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
<a id="__codelineno-762-63" name="__codelineno-762-63"></a><span class="w">            </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-762-64" name="__codelineno-762-64"></a><span class="w">            </span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w">   </span><span class="nx">newUser</span><span class="p">,</span>
<a id="__codelineno-762-65" name="__codelineno-762-65"></a><span class="w">        </span><span class="p">})</span>
<a id="__codelineno-762-66" name="__codelineno-762-66"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-762-67" name="__codelineno-762-67"></a>
<a id="__codelineno-762-68" name="__codelineno-762-68"></a><span class="w">    </span><span class="c1">// 启动服务器</span>
<a id="__codelineno-762-69" name="__codelineno-762-69"></a><span class="w">    </span><span class="nx">router</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">)</span>
<a id="__codelineno-762-70" name="__codelineno-762-70"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行应用</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-763-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-763-1" name="__codelineno-763-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>测试API</strong></p>
<ol>
<li><strong>获取所有用户</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-764-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-764-1" name="__codelineno-764-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-765-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-765-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-765-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-765-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-765-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-765-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-765-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-765-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-765-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-765-10">10</a></span>
<span class="normal"><a href="#__codelineno-765-11">11</a></span>
<span class="normal"><a href="#__codelineno-765-12">12</a></span>
<span class="normal"><a href="#__codelineno-765-13">13</a></span>
<span class="normal"><a href="#__codelineno-765-14">14</a></span>
<span class="normal"><a href="#__codelineno-765-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-765-1" name="__codelineno-765-1"></a><span class="p">{</span>
<a id="__codelineno-765-2" name="__codelineno-765-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-765-3" name="__codelineno-765-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-765-4" name="__codelineno-765-4"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-765-5" name="__codelineno-765-5"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-765-6" name="__codelineno-765-6"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<a id="__codelineno-765-7" name="__codelineno-765-7"></a><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span>
<a id="__codelineno-765-8" name="__codelineno-765-8"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-765-9" name="__codelineno-765-9"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-765-10" name="__codelineno-765-10"></a><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-765-11" name="__codelineno-765-11"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
<a id="__codelineno-765-12" name="__codelineno-765-12"></a><span class="w">            </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bob@example.com&quot;</span>
<a id="__codelineno-765-13" name="__codelineno-765-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-765-14" name="__codelineno-765-14"></a><span class="w">    </span><span class="p">]</span>
<a id="__codelineno-765-15" name="__codelineno-765-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>根据ID获取用户</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-766-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-766-1" name="__codelineno-766-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:8080/users/1
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-767-1">1</a></span>
<span class="normal"><a href="#__codelineno-767-2">2</a></span>
<span class="normal"><a href="#__codelineno-767-3">3</a></span>
<span class="normal"><a href="#__codelineno-767-4">4</a></span>
<span class="normal"><a href="#__codelineno-767-5">5</a></span>
<span class="normal"><a href="#__codelineno-767-6">6</a></span>
<span class="normal"><a href="#__codelineno-767-7">7</a></span>
<span class="normal"><a href="#__codelineno-767-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-767-1" name="__codelineno-767-1"></a><span class="p">{</span>
<a id="__codelineno-767-2" name="__codelineno-767-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-767-3" name="__codelineno-767-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-767-4" name="__codelineno-767-4"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-767-5" name="__codelineno-767-5"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span>
<a id="__codelineno-767-6" name="__codelineno-767-6"></a><span class="w">        </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span>
<a id="__codelineno-767-7" name="__codelineno-767-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-767-8" name="__codelineno-767-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>创建新用户</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-768-1">1</a></span>
<span class="normal"><a href="#__codelineno-768-2">2</a></span>
<span class="normal"><a href="#__codelineno-768-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-768-1" name="__codelineno-768-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/users<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-768-2" name="__codelineno-768-2"></a><span class="w">     </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-768-3" name="__codelineno-768-3"></a><span class="w">     </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;Charlie&quot;,&quot;email&quot;:&quot;charlie@example.com&quot;}&#39;</span>
</code></pre></div></td></tr></table></div>
<p><strong>响应：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-769-1">1</a></span>
<span class="normal"><a href="#__codelineno-769-2">2</a></span>
<span class="normal"><a href="#__codelineno-769-3">3</a></span>
<span class="normal"><a href="#__codelineno-769-4">4</a></span>
<span class="normal"><a href="#__codelineno-769-5">5</a></span>
<span class="normal"><a href="#__codelineno-769-6">6</a></span>
<span class="normal"><a href="#__codelineno-769-7">7</a></span>
<span class="normal"><a href="#__codelineno-769-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-769-1" name="__codelineno-769-1"></a><span class="p">{</span>
<a id="__codelineno-769-2" name="__codelineno-769-2"></a><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">,</span>
<a id="__codelineno-769-3" name="__codelineno-769-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-769-4" name="__codelineno-769-4"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-769-5" name="__codelineno-769-5"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Charlie&quot;</span><span class="p">,</span>
<a id="__codelineno-769-6" name="__codelineno-769-6"></a><span class="w">        </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;charlie@example.com&quot;</span>
<a id="__codelineno-769-7" name="__codelineno-769-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-769-8" name="__codelineno-769-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h5 id="中间件示例">中间件示例<a class="headerlink" href="#中间件示例" title="Permanent link">&para;</a></h5>
<p><strong>日志中间件</strong></p>
<p>Gin内置了日志中间件，可以记录每个请求的详细信息。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-770-1">1</a></span>
<span class="normal"><a href="#__codelineno-770-2">2</a></span>
<span class="normal"><a href="#__codelineno-770-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-770-1" name="__codelineno-770-1"></a><span class="nx">router</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<a id="__codelineno-770-2" name="__codelineno-770-2"></a><span class="nx">router</span><span class="p">.</span><span class="nx">Use</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Logger</span><span class="p">())</span>
<a id="__codelineno-770-3" name="__codelineno-770-3"></a><span class="nx">router</span><span class="p">.</span><span class="nx">Use</span><span class="p">(</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Recovery</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p><strong>自定义中间件</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-771-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-771-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-771-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-771-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-771-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-771-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-771-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-771-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-771-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-771-10">10</a></span>
<span class="normal"><a href="#__codelineno-771-11">11</a></span>
<span class="normal"><a href="#__codelineno-771-12">12</a></span>
<span class="normal"><a href="#__codelineno-771-13">13</a></span>
<span class="normal"><a href="#__codelineno-771-14">14</a></span>
<span class="normal"><a href="#__codelineno-771-15">15</a></span>
<span class="normal"><a href="#__codelineno-771-16">16</a></span>
<span class="normal"><a href="#__codelineno-771-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-771-1" name="__codelineno-771-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">AuthMiddleware</span><span class="p">()</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-771-2" name="__codelineno-771-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-771-3" name="__codelineno-771-3"></a><span class="w">        </span><span class="nx">token</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">GetHeader</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">)</span>
<a id="__codelineno-771-4" name="__codelineno-771-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;secret-token&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-771-5" name="__codelineno-771-5"></a><span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusUnauthorized</span><span class="p">,</span><span class="w"> </span><span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
<a id="__codelineno-771-6" name="__codelineno-771-6"></a><span class="w">                </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;error&quot;</span><span class="p">,</span>
<a id="__codelineno-771-7" name="__codelineno-771-7"></a><span class="w">                </span><span class="s">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;未授权&quot;</span><span class="p">,</span>
<a id="__codelineno-771-8" name="__codelineno-771-8"></a><span class="w">            </span><span class="p">})</span>
<a id="__codelineno-771-9" name="__codelineno-771-9"></a><span class="w">            </span><span class="nx">c</span><span class="p">.</span><span class="nx">Abort</span><span class="p">()</span>
<a id="__codelineno-771-10" name="__codelineno-771-10"></a><span class="w">            </span><span class="k">return</span>
<a id="__codelineno-771-11" name="__codelineno-771-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-771-12" name="__codelineno-771-12"></a><span class="w">        </span><span class="nx">c</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<a id="__codelineno-771-13" name="__codelineno-771-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-771-14" name="__codelineno-771-14"></a><span class="p">}</span>
<a id="__codelineno-771-15" name="__codelineno-771-15"></a>
<a id="__codelineno-771-16" name="__codelineno-771-16"></a><span class="c1">// 使用自定义中间件</span>
<a id="__codelineno-771-17" name="__codelineno-771-17"></a><span class="nx">router</span><span class="p">.</span><span class="nx">Use</span><span class="p">(</span><span class="nx">AuthMiddleware</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<h4 id="2-beego">2. Beego<a class="headerlink" href="#2-beego" title="Permanent link">&para;</a></h4>
<p><strong>Beego</strong> 是一个全功能的Web框架，类似于Ruby on Rails或Django。它提供了丰富的功能，如MVC架构、ORM、自动路由、内置工具等，适合快速开发复杂的Web应用和API。</p>
<h5 id="特点_1">特点<a class="headerlink" href="#特点_1" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>MVC架构</strong>：支持模型-视图-控制器（MVC）模式，促进代码组织和分离。</li>
<li><strong>自动路由</strong>：基于文件结构的自动路由，简化路由配置。</li>
<li><strong>内置ORM</strong>：集成强大的ORM库，简化数据库操作。</li>
<li><strong>丰富的工具</strong>：提供开发工具，如代码生成器、热编译等，提高开发效率。</li>
<li><strong>模块化</strong>：支持插件和模块，易于扩展和维护。</li>
</ul>
<h5 id="安装_1">安装<a class="headerlink" href="#安装_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-772-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-772-1" name="__codelineno-772-1"></a>go<span class="w"> </span>get<span class="w"> </span>github.com/beego/beego/v2@latest
</code></pre></div></td></tr></table></div>
<h5 id="示例构建一个简单的web应用">示例：构建一个简单的Web应用<a class="headerlink" href="#示例构建一个简单的web应用" title="Permanent link">&para;</a></h5>
<p><strong>项目结构</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-773-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-773-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-773-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-773-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-773-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-773-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-773-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-773-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-773-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-773-10">10</a></span>
<span class="normal"><a href="#__codelineno-773-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-773-1" name="__codelineno-773-1"></a>beego-example/
<a id="__codelineno-773-2" name="__codelineno-773-2"></a>├── controllers/
<a id="__codelineno-773-3" name="__codelineno-773-3"></a>│   └── default.go
<a id="__codelineno-773-4" name="__codelineno-773-4"></a>├── models/
<a id="__codelineno-773-5" name="__codelineno-773-5"></a>│   └── user.go
<a id="__codelineno-773-6" name="__codelineno-773-6"></a>├── routers/
<a id="__codelineno-773-7" name="__codelineno-773-7"></a>│   └── router.go
<a id="__codelineno-773-8" name="__codelineno-773-8"></a>├── views/
<a id="__codelineno-773-9" name="__codelineno-773-9"></a>│   └── index.tpl
<a id="__codelineno-773-10" name="__codelineno-773-10"></a>├── main.go
<a id="__codelineno-773-11" name="__codelineno-773-11"></a>└── go.mod
</code></pre></div></td></tr></table></div>
<p><strong>controllers/default.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-774-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-774-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-774-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-774-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-774-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-774-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-774-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-774-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-774-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-774-10">10</a></span>
<span class="normal"><a href="#__codelineno-774-11">11</a></span>
<span class="normal"><a href="#__codelineno-774-12">12</a></span>
<span class="normal"><a href="#__codelineno-774-13">13</a></span>
<span class="normal"><a href="#__codelineno-774-14">14</a></span>
<span class="normal"><a href="#__codelineno-774-15">15</a></span>
<span class="normal"><a href="#__codelineno-774-16">16</a></span>
<span class="normal"><a href="#__codelineno-774-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-774-1" name="__codelineno-774-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">controllers</span>
<a id="__codelineno-774-2" name="__codelineno-774-2"></a>
<a id="__codelineno-774-3" name="__codelineno-774-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-774-4" name="__codelineno-774-4"></a><span class="w">    </span><span class="s">&quot;github.com/beego/beego/v2/server/web&quot;</span>
<a id="__codelineno-774-5" name="__codelineno-774-5"></a><span class="p">)</span>
<a id="__codelineno-774-6" name="__codelineno-774-6"></a>
<a id="__codelineno-774-7" name="__codelineno-774-7"></a><span class="c1">// MainController 定义主控制器</span>
<a id="__codelineno-774-8" name="__codelineno-774-8"></a><span class="kd">type</span><span class="w"> </span><span class="nx">MainController</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-774-9" name="__codelineno-774-9"></a><span class="w">    </span><span class="nx">web</span><span class="p">.</span><span class="nx">Controller</span>
<a id="__codelineno-774-10" name="__codelineno-774-10"></a><span class="p">}</span>
<a id="__codelineno-774-11" name="__codelineno-774-11"></a>
<a id="__codelineno-774-12" name="__codelineno-774-12"></a><span class="c1">// Get 处理GET请求</span>
<a id="__codelineno-774-13" name="__codelineno-774-13"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">MainController</span><span class="p">)</span><span class="w"> </span><span class="nx">Get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-774-14" name="__codelineno-774-14"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Data</span><span class="p">[</span><span class="s">&quot;Website&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;beego.me&quot;</span>
<a id="__codelineno-774-15" name="__codelineno-774-15"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Data</span><span class="p">[</span><span class="s">&quot;Email&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;astaxie@gmail.com&quot;</span>
<a id="__codelineno-774-16" name="__codelineno-774-16"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">TplName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;index.tpl&quot;</span>
<a id="__codelineno-774-17" name="__codelineno-774-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>routers/router.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-775-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-775-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-775-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-775-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-775-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-775-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-775-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-775-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-775-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-775-10">10</a></span>
<span class="normal"><a href="#__codelineno-775-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-775-1" name="__codelineno-775-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">routers</span>
<a id="__codelineno-775-2" name="__codelineno-775-2"></a>
<a id="__codelineno-775-3" name="__codelineno-775-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-775-4" name="__codelineno-775-4"></a><span class="w">    </span><span class="s">&quot;beego-example/controllers&quot;</span>
<a id="__codelineno-775-5" name="__codelineno-775-5"></a>
<a id="__codelineno-775-6" name="__codelineno-775-6"></a><span class="w">    </span><span class="s">&quot;github.com/beego/beego/v2/server/web&quot;</span>
<a id="__codelineno-775-7" name="__codelineno-775-7"></a><span class="p">)</span>
<a id="__codelineno-775-8" name="__codelineno-775-8"></a>
<a id="__codelineno-775-9" name="__codelineno-775-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-775-10" name="__codelineno-775-10"></a><span class="w">    </span><span class="nx">web</span><span class="p">.</span><span class="nx">Router</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">controllers</span><span class="p">.</span><span class="nx">MainController</span><span class="p">{})</span>
<a id="__codelineno-775-11" name="__codelineno-775-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>views/index.tpl</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">HTML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-776-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-776-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-776-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-776-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-776-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-776-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-776-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-776-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-776-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-776-10">10</a></span>
<span class="normal"><a href="#__codelineno-776-11">11</a></span>
<span class="normal"><a href="#__codelineno-776-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-776-1" name="__codelineno-776-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-776-2" name="__codelineno-776-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-776-3" name="__codelineno-776-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-776-4" name="__codelineno-776-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-776-5" name="__codelineno-776-5"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Beego 示例<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-776-6" name="__codelineno-776-6"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-776-7" name="__codelineno-776-7"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-776-8" name="__codelineno-776-8"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>欢迎来到 Beego 示例应用!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-776-9" name="__codelineno-776-9"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>网站: {{.Website}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-776-10" name="__codelineno-776-10"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>邮箱: {{.Email}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-776-11" name="__codelineno-776-11"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-776-12" name="__codelineno-776-12"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-777-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-777-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-777-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-777-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-777-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-777-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-777-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-777-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-777-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-777-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-777-1" name="__codelineno-777-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-777-2" name="__codelineno-777-2"></a>
<a id="__codelineno-777-3" name="__codelineno-777-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-777-4" name="__codelineno-777-4"></a><span class="w">    </span><span class="s">&quot;github.com/beego/beego/v2/server/web&quot;</span>
<a id="__codelineno-777-5" name="__codelineno-777-5"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;beego-example/routers&quot;</span>
<a id="__codelineno-777-6" name="__codelineno-777-6"></a><span class="p">)</span>
<a id="__codelineno-777-7" name="__codelineno-777-7"></a>
<a id="__codelineno-777-8" name="__codelineno-777-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-777-9" name="__codelineno-777-9"></a><span class="w">    </span><span class="nx">web</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
<a id="__codelineno-777-10" name="__codelineno-777-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行应用</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-778-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-778-1" name="__codelineno-778-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>访问应用</strong></p>
<p>打开浏览器，访问<code>http://localhost:8080/</code>，将看到如下页面：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-779-1">1</a></span>
<span class="normal"><a href="#__codelineno-779-2">2</a></span>
<span class="normal"><a href="#__codelineno-779-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-779-1" name="__codelineno-779-1"></a>欢迎来到 Beego 示例应用!
<a id="__codelineno-779-2" name="__codelineno-779-2"></a>网站: beego.me
<a id="__codelineno-779-3" name="__codelineno-779-3"></a>邮箱: astaxie@gmail.com
</code></pre></div></td></tr></table></div>
<h5 id="orm-示例">ORM 示例<a class="headerlink" href="#orm-示例" title="Permanent link">&para;</a></h5>
<p><strong>models/user.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-780-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-780-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-780-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-780-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-780-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-780-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-780-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-780-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-780-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-780-10">10</a></span>
<span class="normal"><a href="#__codelineno-780-11">11</a></span>
<span class="normal"><a href="#__codelineno-780-12">12</a></span>
<span class="normal"><a href="#__codelineno-780-13">13</a></span>
<span class="normal"><a href="#__codelineno-780-14">14</a></span>
<span class="normal"><a href="#__codelineno-780-15">15</a></span>
<span class="normal"><a href="#__codelineno-780-16">16</a></span>
<span class="normal"><a href="#__codelineno-780-17">17</a></span>
<span class="normal"><a href="#__codelineno-780-18">18</a></span>
<span class="normal"><a href="#__codelineno-780-19">19</a></span>
<span class="normal"><a href="#__codelineno-780-20">20</a></span>
<span class="normal"><a href="#__codelineno-780-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-780-1" name="__codelineno-780-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">models</span>
<a id="__codelineno-780-2" name="__codelineno-780-2"></a>
<a id="__codelineno-780-3" name="__codelineno-780-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-780-4" name="__codelineno-780-4"></a><span class="w">    </span><span class="s">&quot;github.com/beego/beego/v2/client/orm&quot;</span>
<a id="__codelineno-780-5" name="__codelineno-780-5"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<a id="__codelineno-780-6" name="__codelineno-780-6"></a><span class="p">)</span>
<a id="__codelineno-780-7" name="__codelineno-780-7"></a>
<a id="__codelineno-780-8" name="__codelineno-780-8"></a><span class="c1">// User 定义用户结构体</span>
<a id="__codelineno-780-9" name="__codelineno-780-9"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-780-10" name="__codelineno-780-10"></a><span class="w">    </span><span class="nx">Id</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`orm:&quot;auto&quot;`</span>
<a id="__codelineno-780-11" name="__codelineno-780-11"></a><span class="w">    </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`orm:&quot;size(100)&quot;`</span>
<a id="__codelineno-780-12" name="__codelineno-780-12"></a><span class="w">    </span><span class="nx">Email</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`orm:&quot;size(100)&quot;`</span>
<a id="__codelineno-780-13" name="__codelineno-780-13"></a><span class="p">}</span>
<a id="__codelineno-780-14" name="__codelineno-780-14"></a>
<a id="__codelineno-780-15" name="__codelineno-780-15"></a><span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-780-16" name="__codelineno-780-16"></a><span class="w">    </span><span class="c1">// 注册模型</span>
<a id="__codelineno-780-17" name="__codelineno-780-17"></a><span class="w">    </span><span class="nx">orm</span><span class="p">.</span><span class="nx">RegisterModel</span><span class="p">(</span><span class="nb">new</span><span class="p">(</span><span class="nx">User</span><span class="p">))</span>
<a id="__codelineno-780-18" name="__codelineno-780-18"></a>
<a id="__codelineno-780-19" name="__codelineno-780-19"></a><span class="w">    </span><span class="c1">// 注册MySQL数据库</span>
<a id="__codelineno-780-20" name="__codelineno-780-20"></a><span class="w">    </span><span class="nx">orm</span><span class="p">.</span><span class="nx">RegisterDataBase</span><span class="p">(</span><span class="s">&quot;default&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;root:password@/test?charset=utf8&quot;</span><span class="p">)</span>
<a id="__codelineno-780-21" name="__codelineno-780-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>示例：数据库操作</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-781-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-781-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-781-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-781-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-781-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-781-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-781-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-781-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-781-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-781-10">10</a></span>
<span class="normal"><a href="#__codelineno-781-11">11</a></span>
<span class="normal"><a href="#__codelineno-781-12">12</a></span>
<span class="normal"><a href="#__codelineno-781-13">13</a></span>
<span class="normal"><a href="#__codelineno-781-14">14</a></span>
<span class="normal"><a href="#__codelineno-781-15">15</a></span>
<span class="normal"><a href="#__codelineno-781-16">16</a></span>
<span class="normal"><a href="#__codelineno-781-17">17</a></span>
<span class="normal"><a href="#__codelineno-781-18">18</a></span>
<span class="normal"><a href="#__codelineno-781-19">19</a></span>
<span class="normal"><a href="#__codelineno-781-20">20</a></span>
<span class="normal"><a href="#__codelineno-781-21">21</a></span>
<span class="normal"><a href="#__codelineno-781-22">22</a></span>
<span class="normal"><a href="#__codelineno-781-23">23</a></span>
<span class="normal"><a href="#__codelineno-781-24">24</a></span>
<span class="normal"><a href="#__codelineno-781-25">25</a></span>
<span class="normal"><a href="#__codelineno-781-26">26</a></span>
<span class="normal"><a href="#__codelineno-781-27">27</a></span>
<span class="normal"><a href="#__codelineno-781-28">28</a></span>
<span class="normal"><a href="#__codelineno-781-29">29</a></span>
<span class="normal"><a href="#__codelineno-781-30">30</a></span>
<span class="normal"><a href="#__codelineno-781-31">31</a></span>
<span class="normal"><a href="#__codelineno-781-32">32</a></span>
<span class="normal"><a href="#__codelineno-781-33">33</a></span>
<span class="normal"><a href="#__codelineno-781-34">34</a></span>
<span class="normal"><a href="#__codelineno-781-35">35</a></span>
<span class="normal"><a href="#__codelineno-781-36">36</a></span>
<span class="normal"><a href="#__codelineno-781-37">37</a></span>
<span class="normal"><a href="#__codelineno-781-38">38</a></span>
<span class="normal"><a href="#__codelineno-781-39">39</a></span>
<span class="normal"><a href="#__codelineno-781-40">40</a></span>
<span class="normal"><a href="#__codelineno-781-41">41</a></span>
<span class="normal"><a href="#__codelineno-781-42">42</a></span>
<span class="normal"><a href="#__codelineno-781-43">43</a></span>
<span class="normal"><a href="#__codelineno-781-44">44</a></span>
<span class="normal"><a href="#__codelineno-781-45">45</a></span>
<span class="normal"><a href="#__codelineno-781-46">46</a></span>
<span class="normal"><a href="#__codelineno-781-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-781-1" name="__codelineno-781-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-781-2" name="__codelineno-781-2"></a>
<a id="__codelineno-781-3" name="__codelineno-781-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-781-4" name="__codelineno-781-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-781-5" name="__codelineno-781-5"></a><span class="w">    </span><span class="s">&quot;github.com/beego/beego/v2/client/orm&quot;</span>
<a id="__codelineno-781-6" name="__codelineno-781-6"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<a id="__codelineno-781-7" name="__codelineno-781-7"></a><span class="w">    </span><span class="s">&quot;beego-example/models&quot;</span>
<a id="__codelineno-781-8" name="__codelineno-781-8"></a><span class="p">)</span>
<a id="__codelineno-781-9" name="__codelineno-781-9"></a>
<a id="__codelineno-781-10" name="__codelineno-781-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-781-11" name="__codelineno-781-11"></a><span class="w">    </span><span class="nx">o</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">orm</span><span class="p">.</span><span class="nx">NewOrm</span><span class="p">()</span>
<a id="__codelineno-781-12" name="__codelineno-781-12"></a>
<a id="__codelineno-781-13" name="__codelineno-781-13"></a><span class="w">    </span><span class="c1">// 创建新用户</span>
<a id="__codelineno-781-14" name="__codelineno-781-14"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice@example.com&quot;</span><span class="p">}</span>
<a id="__codelineno-781-15" name="__codelineno-781-15"></a><span class="w">    </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-781-16" name="__codelineno-781-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-781-17" name="__codelineno-781-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;插入用户失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-781-18" name="__codelineno-781-18"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-781-19" name="__codelineno-781-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-781-20" name="__codelineno-781-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;新用户ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">)</span>
<a id="__codelineno-781-21" name="__codelineno-781-21"></a>
<a id="__codelineno-781-22" name="__codelineno-781-22"></a><span class="w">    </span><span class="c1">// 查询用户</span>
<a id="__codelineno-781-23" name="__codelineno-781-23"></a><span class="w">    </span><span class="nx">fetchedUser</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span><span class="p">{</span><span class="nx">Id</span><span class="p">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Id</span><span class="p">}</span>
<a id="__codelineno-781-24" name="__codelineno-781-24"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">fetchedUser</span><span class="p">)</span>
<a id="__codelineno-781-25" name="__codelineno-781-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-781-26" name="__codelineno-781-26"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;查询用户失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-781-27" name="__codelineno-781-27"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-781-28" name="__codelineno-781-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-781-29" name="__codelineno-781-29"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;查询用户: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchedUser</span><span class="p">)</span>
<a id="__codelineno-781-30" name="__codelineno-781-30"></a>
<a id="__codelineno-781-31" name="__codelineno-781-31"></a><span class="w">    </span><span class="c1">// 更新用户</span>
<a id="__codelineno-781-32" name="__codelineno-781-32"></a><span class="w">    </span><span class="nx">fetchedUser</span><span class="p">.</span><span class="nx">Email</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;alice_new@example.com&quot;</span>
<a id="__codelineno-781-33" name="__codelineno-781-33"></a><span class="w">    </span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">fetchedUser</span><span class="p">)</span>
<a id="__codelineno-781-34" name="__codelineno-781-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-781-35" name="__codelineno-781-35"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;更新用户失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-781-36" name="__codelineno-781-36"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-781-37" name="__codelineno-781-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-781-38" name="__codelineno-781-38"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新了 %d 行\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-781-39" name="__codelineno-781-39"></a>
<a id="__codelineno-781-40" name="__codelineno-781-40"></a><span class="w">    </span><span class="c1">// 删除用户</span>
<a id="__codelineno-781-41" name="__codelineno-781-41"></a><span class="w">    </span><span class="nx">num</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">fetchedUser</span><span class="p">)</span>
<a id="__codelineno-781-42" name="__codelineno-781-42"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-781-43" name="__codelineno-781-43"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;删除用户失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-781-44" name="__codelineno-781-44"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-781-45" name="__codelineno-781-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-781-46" name="__codelineno-781-46"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;删除了 %d 行\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">num</span><span class="p">)</span>
<a id="__codelineno-781-47" name="__codelineno-781-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-782-1">1</a></span>
<span class="normal"><a href="#__codelineno-782-2">2</a></span>
<span class="normal"><a href="#__codelineno-782-3">3</a></span>
<span class="normal"><a href="#__codelineno-782-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-782-1" name="__codelineno-782-1"></a>新用户ID: 1
<a id="__codelineno-782-2" name="__codelineno-782-2"></a>查询用户: {Id:1 Name:Alice Email:alice@example.com}
<a id="__codelineno-782-3" name="__codelineno-782-3"></a>更新了 1 行
<a id="__codelineno-782-4" name="__codelineno-782-4"></a>删除了 1 行
</code></pre></div></td></tr></table></div>
<h5 id="beego-的优势">Beego 的优势<a class="headerlink" href="#beego-的优势" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>全面性</strong>：提供了从路由、控制器到ORM和模板引擎的完整解决方案。</li>
<li><strong>开发效率高</strong>：内置工具和自动化特性，减少了手动配置和重复代码。</li>
<li><strong>社区活跃</strong>：拥有活跃的社区和丰富的文档支持，易于学习和获取帮助。</li>
</ul>
<h4 id="3-gorm">3. Gorm<a class="headerlink" href="#3-gorm" title="Permanent link">&para;</a></h4>
<p><strong>Gorm</strong> 是一个强大的Go语言ORM（对象关系映射）库，旨在简化数据库操作。Gorm支持多种数据库（如MySQL、PostgreSQL、SQLite等），并提供丰富的功能，如关联、钩子、迁移等，适合构建复杂的数据库驱动应用。</p>
<h5 id="特点_2">特点<a class="headerlink" href="#特点_2" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>易用性</strong>：简洁的API设计，易于上手和使用。</li>
<li><strong>多数据库支持</strong>：支持MySQL、PostgreSQL、SQLite、SQL Server等多种数据库。</li>
<li><strong>自动迁移</strong>：自动创建和更新数据库表结构，简化数据库管理。</li>
<li><strong>丰富的功能</strong>：支持关联、预加载、事务、钩子等高级功能。</li>
<li><strong>性能优化</strong>：提供查询优化选项，提升数据库操作的效率。</li>
</ul>
<h5 id="安装_2">安装<a class="headerlink" href="#安装_2" title="Permanent link">&para;</a></h5>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-783-1">1</a></span>
<span class="normal"><a href="#__codelineno-783-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-783-1" name="__codelineno-783-1"></a>go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>gorm.io/gorm
<a id="__codelineno-783-2" name="__codelineno-783-2"></a>go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>gorm.io/driver/mysql
</code></pre></div></td></tr></table></div>
<h5 id="示例使用gorm进行数据库操作">示例：使用Gorm进行数据库操作<a class="headerlink" href="#示例使用gorm进行数据库操作" title="Permanent link">&para;</a></h5>
<p><strong>项目结构</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-784-1">1</a></span>
<span class="normal"><a href="#__codelineno-784-2">2</a></span>
<span class="normal"><a href="#__codelineno-784-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-784-1" name="__codelineno-784-1"></a>gorm-example/
<a id="__codelineno-784-2" name="__codelineno-784-2"></a>├── main.go
<a id="__codelineno-784-3" name="__codelineno-784-3"></a>└── go.mod
</code></pre></div></td></tr></table></div>
<p><strong>main.go</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-785-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-785-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-785-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-785-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-785-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-785-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-785-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-785-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-785-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-785-10">10</a></span>
<span class="normal"><a href="#__codelineno-785-11">11</a></span>
<span class="normal"><a href="#__codelineno-785-12">12</a></span>
<span class="normal"><a href="#__codelineno-785-13">13</a></span>
<span class="normal"><a href="#__codelineno-785-14">14</a></span>
<span class="normal"><a href="#__codelineno-785-15">15</a></span>
<span class="normal"><a href="#__codelineno-785-16">16</a></span>
<span class="normal"><a href="#__codelineno-785-17">17</a></span>
<span class="normal"><a href="#__codelineno-785-18">18</a></span>
<span class="normal"><a href="#__codelineno-785-19">19</a></span>
<span class="normal"><a href="#__codelineno-785-20">20</a></span>
<span class="normal"><a href="#__codelineno-785-21">21</a></span>
<span class="normal"><a href="#__codelineno-785-22">22</a></span>
<span class="normal"><a href="#__codelineno-785-23">23</a></span>
<span class="normal"><a href="#__codelineno-785-24">24</a></span>
<span class="normal"><a href="#__codelineno-785-25">25</a></span>
<span class="normal"><a href="#__codelineno-785-26">26</a></span>
<span class="normal"><a href="#__codelineno-785-27">27</a></span>
<span class="normal"><a href="#__codelineno-785-28">28</a></span>
<span class="normal"><a href="#__codelineno-785-29">29</a></span>
<span class="normal"><a href="#__codelineno-785-30">30</a></span>
<span class="normal"><a href="#__codelineno-785-31">31</a></span>
<span class="normal"><a href="#__codelineno-785-32">32</a></span>
<span class="normal"><a href="#__codelineno-785-33">33</a></span>
<span class="normal"><a href="#__codelineno-785-34">34</a></span>
<span class="normal"><a href="#__codelineno-785-35">35</a></span>
<span class="normal"><a href="#__codelineno-785-36">36</a></span>
<span class="normal"><a href="#__codelineno-785-37">37</a></span>
<span class="normal"><a href="#__codelineno-785-38">38</a></span>
<span class="normal"><a href="#__codelineno-785-39">39</a></span>
<span class="normal"><a href="#__codelineno-785-40">40</a></span>
<span class="normal"><a href="#__codelineno-785-41">41</a></span>
<span class="normal"><a href="#__codelineno-785-42">42</a></span>
<span class="normal"><a href="#__codelineno-785-43">43</a></span>
<span class="normal"><a href="#__codelineno-785-44">44</a></span>
<span class="normal"><a href="#__codelineno-785-45">45</a></span>
<span class="normal"><a href="#__codelineno-785-46">46</a></span>
<span class="normal"><a href="#__codelineno-785-47">47</a></span>
<span class="normal"><a href="#__codelineno-785-48">48</a></span>
<span class="normal"><a href="#__codelineno-785-49">49</a></span>
<span class="normal"><a href="#__codelineno-785-50">50</a></span>
<span class="normal"><a href="#__codelineno-785-51">51</a></span>
<span class="normal"><a href="#__codelineno-785-52">52</a></span>
<span class="normal"><a href="#__codelineno-785-53">53</a></span>
<span class="normal"><a href="#__codelineno-785-54">54</a></span>
<span class="normal"><a href="#__codelineno-785-55">55</a></span>
<span class="normal"><a href="#__codelineno-785-56">56</a></span>
<span class="normal"><a href="#__codelineno-785-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-785-1" name="__codelineno-785-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-785-2" name="__codelineno-785-2"></a>
<a id="__codelineno-785-3" name="__codelineno-785-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-785-4" name="__codelineno-785-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-785-5" name="__codelineno-785-5"></a><span class="w">    </span><span class="s">&quot;gorm.io/driver/mysql&quot;</span>
<a id="__codelineno-785-6" name="__codelineno-785-6"></a><span class="w">    </span><span class="s">&quot;gorm.io/gorm&quot;</span>
<a id="__codelineno-785-7" name="__codelineno-785-7"></a><span class="p">)</span>
<a id="__codelineno-785-8" name="__codelineno-785-8"></a>
<a id="__codelineno-785-9" name="__codelineno-785-9"></a><span class="c1">// User 定义用户模型</span>
<a id="__codelineno-785-10" name="__codelineno-785-10"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-785-11" name="__codelineno-785-11"></a><span class="w">    </span><span class="nx">ID</span><span class="w">    </span><span class="kt">uint</span><span class="w">   </span><span class="s">`gorm:&quot;primaryKey&quot;`</span>
<a id="__codelineno-785-12" name="__codelineno-785-12"></a><span class="w">    </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-785-13" name="__codelineno-785-13"></a><span class="w">    </span><span class="nx">Email</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`gorm:&quot;unique&quot;`</span>
<a id="__codelineno-785-14" name="__codelineno-785-14"></a><span class="p">}</span>
<a id="__codelineno-785-15" name="__codelineno-785-15"></a>
<a id="__codelineno-785-16" name="__codelineno-785-16"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-785-17" name="__codelineno-785-17"></a><span class="w">    </span><span class="c1">// 数据库连接字符串</span>
<a id="__codelineno-785-18" name="__codelineno-785-18"></a><span class="w">    </span><span class="nx">dsn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;root:password@tcp(127.0.0.1:3306)/testdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>
<a id="__codelineno-785-19" name="__codelineno-785-19"></a>
<a id="__codelineno-785-20" name="__codelineno-785-20"></a><span class="w">    </span><span class="c1">// 连接数据库</span>
<a id="__codelineno-785-21" name="__codelineno-785-21"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">mysql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">dsn</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Config</span><span class="p">{})</span>
<a id="__codelineno-785-22" name="__codelineno-785-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-785-23" name="__codelineno-785-23"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;failed to connect database&quot;</span><span class="p">)</span>
<a id="__codelineno-785-24" name="__codelineno-785-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-785-25" name="__codelineno-785-25"></a>
<a id="__codelineno-785-26" name="__codelineno-785-26"></a><span class="w">    </span><span class="c1">// 自动迁移模型</span>
<a id="__codelineno-785-27" name="__codelineno-785-27"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">AutoMigrate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>
<a id="__codelineno-785-28" name="__codelineno-785-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-785-29" name="__codelineno-785-29"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;failed to migrate database&quot;</span><span class="p">)</span>
<a id="__codelineno-785-30" name="__codelineno-785-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-785-31" name="__codelineno-785-31"></a>
<a id="__codelineno-785-32" name="__codelineno-785-32"></a><span class="w">    </span><span class="c1">// 创建新用户</span>
<a id="__codelineno-785-33" name="__codelineno-785-33"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice@example.com&quot;</span><span class="p">}</span>
<a id="__codelineno-785-34" name="__codelineno-785-34"></a><span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-785-35" name="__codelineno-785-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-785-36" name="__codelineno-785-36"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;创建用户失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="p">)</span>
<a id="__codelineno-785-37" name="__codelineno-785-37"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-785-38" name="__codelineno-785-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-785-39" name="__codelineno-785-39"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;新用户ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="p">)</span>
<a id="__codelineno-785-40" name="__codelineno-785-40"></a>
<a id="__codelineno-785-41" name="__codelineno-785-41"></a><span class="w">    </span><span class="c1">// 查询用户</span>
<a id="__codelineno-785-42" name="__codelineno-785-42"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">fetchedUser</span><span class="w"> </span><span class="nx">User</span>
<a id="__codelineno-785-43" name="__codelineno-785-43"></a><span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">fetchedUser</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="p">)</span>
<a id="__codelineno-785-44" name="__codelineno-785-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-785-45" name="__codelineno-785-45"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;查询用户失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="p">)</span>
<a id="__codelineno-785-46" name="__codelineno-785-46"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-785-47" name="__codelineno-785-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-785-48" name="__codelineno-785-48"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;查询用户: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchedUser</span><span class="p">)</span>
<a id="__codelineno-785-49" name="__codelineno-785-49"></a>
<a id="__codelineno-785-50" name="__codelineno-785-50"></a><span class="w">    </span><span class="c1">// 更新用户</span>
<a id="__codelineno-785-51" name="__codelineno-785-51"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">fetchedUser</span><span class="p">).</span><span class="nx">Update</span><span class="p">(</span><span class="s">&quot;Email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;alice_new@example.com&quot;</span><span class="p">)</span>
<a id="__codelineno-785-52" name="__codelineno-785-52"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;更新用户邮箱成功&quot;</span><span class="p">)</span>
<a id="__codelineno-785-53" name="__codelineno-785-53"></a>
<a id="__codelineno-785-54" name="__codelineno-785-54"></a><span class="w">    </span><span class="c1">// 删除用户</span>
<a id="__codelineno-785-55" name="__codelineno-785-55"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">fetchedUser</span><span class="p">)</span>
<a id="__codelineno-785-56" name="__codelineno-785-56"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;删除用户成功&quot;</span><span class="p">)</span>
<a id="__codelineno-785-57" name="__codelineno-785-57"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>运行应用</strong></p>
<p>确保MySQL服务器已启动，并且存在<code>testdb</code>数据库。运行以下命令启动应用：</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-786-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-786-1" name="__codelineno-786-1"></a>go<span class="w"> </span>run<span class="w"> </span>main.go
</code></pre></div></td></tr></table></div>
<p><strong>输出示例：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-787-1">1</a></span>
<span class="normal"><a href="#__codelineno-787-2">2</a></span>
<span class="normal"><a href="#__codelineno-787-3">3</a></span>
<span class="normal"><a href="#__codelineno-787-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-787-1" name="__codelineno-787-1"></a>新用户ID: 1
<a id="__codelineno-787-2" name="__codelineno-787-2"></a>查询用户: {ID:1 Name:Alice Email:alice@example.com}
<a id="__codelineno-787-3" name="__codelineno-787-3"></a>更新用户邮箱成功
<a id="__codelineno-787-4" name="__codelineno-787-4"></a>删除用户成功
</code></pre></div></td></tr></table></div>
<h5 id="gorm-的高级功能">Gorm 的高级功能<a class="headerlink" href="#gorm-的高级功能" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>关联（Associations）</strong>：支持一对一、一对多、多对多等关系。</li>
</ul>
<p><strong>示例：一对多关系</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-788-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-788-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-788-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-788-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-788-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-788-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-788-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-788-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-788-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-788-10">10</a></span>
<span class="normal"><a href="#__codelineno-788-11">11</a></span>
<span class="normal"><a href="#__codelineno-788-12">12</a></span>
<span class="normal"><a href="#__codelineno-788-13">13</a></span>
<span class="normal"><a href="#__codelineno-788-14">14</a></span>
<span class="normal"><a href="#__codelineno-788-15">15</a></span>
<span class="normal"><a href="#__codelineno-788-16">16</a></span>
<span class="normal"><a href="#__codelineno-788-17">17</a></span>
<span class="normal"><a href="#__codelineno-788-18">18</a></span>
<span class="normal"><a href="#__codelineno-788-19">19</a></span>
<span class="normal"><a href="#__codelineno-788-20">20</a></span>
<span class="normal"><a href="#__codelineno-788-21">21</a></span>
<span class="normal"><a href="#__codelineno-788-22">22</a></span>
<span class="normal"><a href="#__codelineno-788-23">23</a></span>
<span class="normal"><a href="#__codelineno-788-24">24</a></span>
<span class="normal"><a href="#__codelineno-788-25">25</a></span>
<span class="normal"><a href="#__codelineno-788-26">26</a></span>
<span class="normal"><a href="#__codelineno-788-27">27</a></span>
<span class="normal"><a href="#__codelineno-788-28">28</a></span>
<span class="normal"><a href="#__codelineno-788-29">29</a></span>
<span class="normal"><a href="#__codelineno-788-30">30</a></span>
<span class="normal"><a href="#__codelineno-788-31">31</a></span>
<span class="normal"><a href="#__codelineno-788-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-788-1" name="__codelineno-788-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-788-2" name="__codelineno-788-2"></a><span class="w">    </span><span class="nx">ID</span><span class="w">      </span><span class="kt">uint</span>
<a id="__codelineno-788-3" name="__codelineno-788-3"></a><span class="w">    </span><span class="nx">Name</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-788-4" name="__codelineno-788-4"></a><span class="w">    </span><span class="nx">Email</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-788-5" name="__codelineno-788-5"></a><span class="w">    </span><span class="nx">Orders</span><span class="w">  </span><span class="p">[]</span><span class="nx">Order</span>
<a id="__codelineno-788-6" name="__codelineno-788-6"></a><span class="p">}</span>
<a id="__codelineno-788-7" name="__codelineno-788-7"></a>
<a id="__codelineno-788-8" name="__codelineno-788-8"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Order</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-788-9" name="__codelineno-788-9"></a><span class="w">    </span><span class="nx">ID</span><span class="w">     </span><span class="kt">uint</span>
<a id="__codelineno-788-10" name="__codelineno-788-10"></a><span class="w">    </span><span class="nx">Item</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-788-11" name="__codelineno-788-11"></a><span class="w">    </span><span class="nx">UserID</span><span class="w"> </span><span class="kt">uint</span>
<a id="__codelineno-788-12" name="__codelineno-788-12"></a><span class="p">}</span>
<a id="__codelineno-788-13" name="__codelineno-788-13"></a>
<a id="__codelineno-788-14" name="__codelineno-788-14"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-788-15" name="__codelineno-788-15"></a><span class="w">    </span><span class="c1">// 连接数据库和迁移</span>
<a id="__codelineno-788-16" name="__codelineno-788-16"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">mysql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">dsn</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Config</span><span class="p">{})</span>
<a id="__codelineno-788-17" name="__codelineno-788-17"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">AutoMigrate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{},</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Order</span><span class="p">{})</span>
<a id="__codelineno-788-18" name="__codelineno-788-18"></a>
<a id="__codelineno-788-19" name="__codelineno-788-19"></a><span class="w">    </span><span class="c1">// 创建用户和订单</span>
<a id="__codelineno-788-20" name="__codelineno-788-20"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bob@example.com&quot;</span><span class="p">}</span>
<a id="__codelineno-788-21" name="__codelineno-788-21"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-788-22" name="__codelineno-788-22"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Order</span><span class="p">{</span><span class="nx">Item</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Laptop&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="p">})</span>
<a id="__codelineno-788-23" name="__codelineno-788-23"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Order</span><span class="p">{</span><span class="nx">Item</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Phone&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="p">})</span>
<a id="__codelineno-788-24" name="__codelineno-788-24"></a>
<a id="__codelineno-788-25" name="__codelineno-788-25"></a><span class="w">    </span><span class="c1">// 查询用户及其订单</span>
<a id="__codelineno-788-26" name="__codelineno-788-26"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">fetchedUser</span><span class="w"> </span><span class="nx">User</span>
<a id="__codelineno-788-27" name="__codelineno-788-27"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Preload</span><span class="p">(</span><span class="s">&quot;Orders&quot;</span><span class="p">).</span><span class="nx">First</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">fetchedUser</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="p">)</span>
<a id="__codelineno-788-28" name="__codelineno-788-28"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;用户: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchedUser</span><span class="p">)</span>
<a id="__codelineno-788-29" name="__codelineno-788-29"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">fetchedUser</span><span class="p">.</span><span class="nx">Orders</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-788-30" name="__codelineno-788-30"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;订单: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">order</span><span class="p">)</span>
<a id="__codelineno-788-31" name="__codelineno-788-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-788-32" name="__codelineno-788-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>事务（Transactions）</strong>：支持事务操作，确保一组数据库操作的原子性。</li>
</ul>
<p><strong>示例：事务操作</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-789-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-789-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-789-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-789-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-789-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-789-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-789-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-789-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-789-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-789-10">10</a></span>
<span class="normal"><a href="#__codelineno-789-11">11</a></span>
<span class="normal"><a href="#__codelineno-789-12">12</a></span>
<span class="normal"><a href="#__codelineno-789-13">13</a></span>
<span class="normal"><a href="#__codelineno-789-14">14</a></span>
<span class="normal"><a href="#__codelineno-789-15">15</a></span>
<span class="normal"><a href="#__codelineno-789-16">16</a></span>
<span class="normal"><a href="#__codelineno-789-17">17</a></span>
<span class="normal"><a href="#__codelineno-789-18">18</a></span>
<span class="normal"><a href="#__codelineno-789-19">19</a></span>
<span class="normal"><a href="#__codelineno-789-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-789-1" name="__codelineno-789-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-789-2" name="__codelineno-789-2"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">mysql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">dsn</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Config</span><span class="p">{})</span>
<a id="__codelineno-789-3" name="__codelineno-789-3"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">AutoMigrate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>
<a id="__codelineno-789-4" name="__codelineno-789-4"></a>
<a id="__codelineno-789-5" name="__codelineno-789-5"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-789-6" name="__codelineno-789-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Charlie&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;charlie@example.com&quot;</span><span class="p">}).</span><span class="nx">Error</span><span class="p">;</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-789-7" name="__codelineno-789-7"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-789-8" name="__codelineno-789-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-789-9" name="__codelineno-789-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Dave&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dave@example.com&quot;</span><span class="p">}).</span><span class="nx">Error</span><span class="p">;</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-789-10" name="__codelineno-789-10"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-789-11" name="__codelineno-789-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-789-12" name="__codelineno-789-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-789-13" name="__codelineno-789-13"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-789-14" name="__codelineno-789-14"></a>
<a id="__codelineno-789-15" name="__codelineno-789-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-789-16" name="__codelineno-789-16"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;事务失败:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-789-17" name="__codelineno-789-17"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-789-18" name="__codelineno-789-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;事务成功&quot;</span><span class="p">)</span>
<a id="__codelineno-789-19" name="__codelineno-789-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-789-20" name="__codelineno-789-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>钩子（Hooks）</strong>：在模型的生命周期事件（如创建、更新、删除）触发特定的逻辑。</li>
</ul>
<p><strong>示例：创建前钩子</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-790-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-790-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-790-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-790-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-790-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-790-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-790-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-790-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-790-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-790-10">10</a></span>
<span class="normal"><a href="#__codelineno-790-11">11</a></span>
<span class="normal"><a href="#__codelineno-790-12">12</a></span>
<span class="normal"><a href="#__codelineno-790-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-790-1" name="__codelineno-790-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">BeforeCreate</span><span class="p">(</span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-790-2" name="__codelineno-790-2"></a><span class="w">    </span><span class="nx">u</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Mr. &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">Name</span>
<a id="__codelineno-790-3" name="__codelineno-790-3"></a><span class="w">    </span><span class="k">return</span>
<a id="__codelineno-790-4" name="__codelineno-790-4"></a><span class="p">}</span>
<a id="__codelineno-790-5" name="__codelineno-790-5"></a>
<a id="__codelineno-790-6" name="__codelineno-790-6"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-790-7" name="__codelineno-790-7"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">mysql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">dsn</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Config</span><span class="p">{})</span>
<a id="__codelineno-790-8" name="__codelineno-790-8"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">AutoMigrate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>
<a id="__codelineno-790-9" name="__codelineno-790-9"></a>
<a id="__codelineno-790-10" name="__codelineno-790-10"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Eve&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eve@example.com&quot;</span><span class="p">}</span>
<a id="__codelineno-790-11" name="__codelineno-790-11"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-790-12" name="__codelineno-790-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;创建用户: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-790-13" name="__codelineno-790-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>输出：</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-791-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-791-1" name="__codelineno-791-1"></a>创建用户: {ID:1 Name:Mr. Eve Email:eve@example.com}
</code></pre></div></td></tr></table></div>
<h5 id="gorm-的优势">Gorm 的优势<a class="headerlink" href="#gorm-的优势" title="Permanent link">&para;</a></h5>
<ul>
<li><strong>功能丰富</strong>：支持多种数据库操作和高级特性，满足复杂应用需求。</li>
<li><strong>易于扩展</strong>：通过插件和自定义函数，扩展Gorm的功能。</li>
<li><strong>活跃的社区</strong>：拥有活跃的开发社区和丰富的文档支持，易于学习和获取帮助。</li>
</ul>
<h5 id="与beego的集成">与Beego的集成<a class="headerlink" href="#与beego的集成" title="Permanent link">&para;</a></h5>
<p>Gorm可以与Beego等Web框架无缝集成，简化数据库操作和Web开发。</p>
<p><strong>示例：在Beego中使用Gorm</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Go</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-792-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-792-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-792-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-792-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-792-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-792-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-792-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-792-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-792-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-792-10">10</a></span>
<span class="normal"><a href="#__codelineno-792-11">11</a></span>
<span class="normal"><a href="#__codelineno-792-12">12</a></span>
<span class="normal"><a href="#__codelineno-792-13">13</a></span>
<span class="normal"><a href="#__codelineno-792-14">14</a></span>
<span class="normal"><a href="#__codelineno-792-15">15</a></span>
<span class="normal"><a href="#__codelineno-792-16">16</a></span>
<span class="normal"><a href="#__codelineno-792-17">17</a></span>
<span class="normal"><a href="#__codelineno-792-18">18</a></span>
<span class="normal"><a href="#__codelineno-792-19">19</a></span>
<span class="normal"><a href="#__codelineno-792-20">20</a></span>
<span class="normal"><a href="#__codelineno-792-21">21</a></span>
<span class="normal"><a href="#__codelineno-792-22">22</a></span>
<span class="normal"><a href="#__codelineno-792-23">23</a></span>
<span class="normal"><a href="#__codelineno-792-24">24</a></span>
<span class="normal"><a href="#__codelineno-792-25">25</a></span>
<span class="normal"><a href="#__codelineno-792-26">26</a></span>
<span class="normal"><a href="#__codelineno-792-27">27</a></span>
<span class="normal"><a href="#__codelineno-792-28">28</a></span>
<span class="normal"><a href="#__codelineno-792-29">29</a></span>
<span class="normal"><a href="#__codelineno-792-30">30</a></span>
<span class="normal"><a href="#__codelineno-792-31">31</a></span>
<span class="normal"><a href="#__codelineno-792-32">32</a></span>
<span class="normal"><a href="#__codelineno-792-33">33</a></span>
<span class="normal"><a href="#__codelineno-792-34">34</a></span>
<span class="normal"><a href="#__codelineno-792-35">35</a></span>
<span class="normal"><a href="#__codelineno-792-36">36</a></span>
<span class="normal"><a href="#__codelineno-792-37">37</a></span>
<span class="normal"><a href="#__codelineno-792-38">38</a></span>
<span class="normal"><a href="#__codelineno-792-39">39</a></span>
<span class="normal"><a href="#__codelineno-792-40">40</a></span>
<span class="normal"><a href="#__codelineno-792-41">41</a></span>
<span class="normal"><a href="#__codelineno-792-42">42</a></span>
<span class="normal"><a href="#__codelineno-792-43">43</a></span>
<span class="normal"><a href="#__codelineno-792-44">44</a></span>
<span class="normal"><a href="#__codelineno-792-45">45</a></span>
<span class="normal"><a href="#__codelineno-792-46">46</a></span>
<span class="normal"><a href="#__codelineno-792-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-792-1" name="__codelineno-792-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-792-2" name="__codelineno-792-2"></a>
<a id="__codelineno-792-3" name="__codelineno-792-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-792-4" name="__codelineno-792-4"></a><span class="w">    </span><span class="s">&quot;github.com/beego/beego/v2/server/web&quot;</span>
<a id="__codelineno-792-5" name="__codelineno-792-5"></a><span class="w">    </span><span class="s">&quot;gorm.io/driver/mysql&quot;</span>
<a id="__codelineno-792-6" name="__codelineno-792-6"></a><span class="w">    </span><span class="s">&quot;gorm.io/gorm&quot;</span>
<a id="__codelineno-792-7" name="__codelineno-792-7"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-792-8" name="__codelineno-792-8"></a><span class="p">)</span>
<a id="__codelineno-792-9" name="__codelineno-792-9"></a>
<a id="__codelineno-792-10" name="__codelineno-792-10"></a><span class="c1">// User 定义用户模型</span>
<a id="__codelineno-792-11" name="__codelineno-792-11"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-792-12" name="__codelineno-792-12"></a><span class="w">    </span><span class="nx">ID</span><span class="w">    </span><span class="kt">uint</span><span class="w">   </span><span class="s">`gorm:&quot;primaryKey&quot;`</span>
<a id="__codelineno-792-13" name="__codelineno-792-13"></a><span class="w">    </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-792-14" name="__codelineno-792-14"></a><span class="w">    </span><span class="nx">Email</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`gorm:&quot;unique&quot;`</span>
<a id="__codelineno-792-15" name="__codelineno-792-15"></a><span class="p">}</span>
<a id="__codelineno-792-16" name="__codelineno-792-16"></a>
<a id="__codelineno-792-17" name="__codelineno-792-17"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-792-18" name="__codelineno-792-18"></a><span class="w">    </span><span class="c1">// 连接数据库</span>
<a id="__codelineno-792-19" name="__codelineno-792-19"></a><span class="w">    </span><span class="nx">dsn</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;root:password@tcp(127.0.0.1:3306)/testdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>
<a id="__codelineno-792-20" name="__codelineno-792-20"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">mysql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">dsn</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">Config</span><span class="p">{})</span>
<a id="__codelineno-792-21" name="__codelineno-792-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-792-22" name="__codelineno-792-22"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;无法连接到数据库: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-792-23" name="__codelineno-792-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-792-24" name="__codelineno-792-24"></a>
<a id="__codelineno-792-25" name="__codelineno-792-25"></a><span class="w">    </span><span class="c1">// 自动迁移</span>
<a id="__codelineno-792-26" name="__codelineno-792-26"></a><span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">AutoMigrate</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>
<a id="__codelineno-792-27" name="__codelineno-792-27"></a>
<a id="__codelineno-792-28" name="__codelineno-792-28"></a><span class="w">    </span><span class="c1">// 注册路由</span>
<a id="__codelineno-792-29" name="__codelineno-792-29"></a><span class="w">    </span><span class="nx">web</span><span class="p">.</span><span class="nx">Router</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MainController</span><span class="p">{</span><span class="nx">DB</span><span class="p">:</span><span class="w"> </span><span class="nx">db</span><span class="p">})</span>
<a id="__codelineno-792-30" name="__codelineno-792-30"></a>
<a id="__codelineno-792-31" name="__codelineno-792-31"></a><span class="w">    </span><span class="c1">// 启动服务器</span>
<a id="__codelineno-792-32" name="__codelineno-792-32"></a><span class="w">    </span><span class="nx">web</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
<a id="__codelineno-792-33" name="__codelineno-792-33"></a><span class="p">}</span>
<a id="__codelineno-792-34" name="__codelineno-792-34"></a>
<a id="__codelineno-792-35" name="__codelineno-792-35"></a><span class="c1">// MainController 定义主控制器</span>
<a id="__codelineno-792-36" name="__codelineno-792-36"></a><span class="kd">type</span><span class="w"> </span><span class="nx">MainController</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-792-37" name="__codelineno-792-37"></a><span class="w">    </span><span class="nx">web</span><span class="p">.</span><span class="nx">Controller</span>
<a id="__codelineno-792-38" name="__codelineno-792-38"></a><span class="w">    </span><span class="nx">DB</span><span class="w"> </span><span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span>
<a id="__codelineno-792-39" name="__codelineno-792-39"></a><span class="p">}</span>
<a id="__codelineno-792-40" name="__codelineno-792-40"></a>
<a id="__codelineno-792-41" name="__codelineno-792-41"></a><span class="c1">// Get 处理GET请求</span>
<a id="__codelineno-792-42" name="__codelineno-792-42"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">MainController</span><span class="p">)</span><span class="w"> </span><span class="nx">Get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-792-43" name="__codelineno-792-43"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">[]</span><span class="nx">User</span>
<a id="__codelineno-792-44" name="__codelineno-792-44"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">DB</span><span class="p">.</span><span class="nx">Find</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">users</span><span class="p">)</span>
<a id="__codelineno-792-45" name="__codelineno-792-45"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">Data</span><span class="p">[</span><span class="s">&quot;Users&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">users</span>
<a id="__codelineno-792-46" name="__codelineno-792-46"></a><span class="w">    </span><span class="nx">c</span><span class="p">.</span><span class="nx">TplName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;index.tpl&quot;</span>
<a id="__codelineno-792-47" name="__codelineno-792-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>通过集成Gorm，Beego开发者可以方便地进行数据库操作，提升开发效率。</p>
<h4 id="4-选择适合的框架与库">4. 选择适合的框架与库<a class="headerlink" href="#4-选择适合的框架与库" title="Permanent link">&para;</a></h4>
<p>在选择Web框架和ORM库时，应根据项目需求和团队熟悉程度进行权衡：</p>
<ul>
<li>Gin</li>
</ul>
<p>：</p>
<ul>
<li><strong>适用场景</strong>：构建高性能的RESTful API、微服务架构。</li>
<li>
<p><strong>优势</strong>：高性能、简洁易用、中间件支持丰富。</p>
</li>
<li>
<p>Beego</p>
</li>
</ul>
<p>：</p>
<ul>
<li><strong>适用场景</strong>：构建全功能的Web应用、需要MVC架构支持的项目。</li>
<li>
<p><strong>优势</strong>：功能全面、自动化工具支持、内置ORM和模板引擎。</p>
</li>
<li>
<p>Gorm</p>
</li>
</ul>
<p>：</p>
<ul>
<li><strong>适用场景</strong>：需要强大ORM支持的项目、复杂的数据库操作。</li>
<li><strong>优势</strong>：功能丰富、支持多种数据库、易于扩展和集成。</li>
</ul>
<p>根据项目的具体需求，合理选择和组合这些框架与库，可以显著提升开发效率和代码质量。</p>
<h3 id="164-总结">16.4 总结<a class="headerlink" href="#164-总结" title="Permanent link">&para;</a></h3>
<p>本章深入探讨了Go语言的内存管理机制，包括垃圾回收和内存模型，帮助你更好地理解Go程序的运行原理和性能优化方法。此外，我们还介绍了Gin、Beego和Gorm这三个流行的开源框架与库，展示了它们的基本用法和优势。</p>
<p><strong>关键点回顾：</strong></p>
<ul>
<li>垃圾回收（GC）</li>
</ul>
<p>：</p>
<ul>
<li>Go的垃圾回收器采用并发的标记-清除算法，具备高性能和低延迟的特点。</li>
<li>
<p>通过调整GOGC值和优化内存分配，可以优化GC的行为，提升程序性能。</p>
</li>
<li>
<p>内存模型</p>
</li>
</ul>
<p>：</p>
<ul>
<li>Go的内存分配分为栈和堆，编译器通过逃逸分析决定变量的存储位置。</li>
<li>
<p>理解指针和并发内存访问规则，有助于编写高效和线程安全的程序。</p>
</li>
<li>
<p>开源框架与库</p>
</li>
</ul>
<p>：</p>
<ul>
<li><strong>Gin</strong>：高性能的Web框架，适合构建RESTful API。</li>
<li><strong>Beego</strong>：全功能的Web框架，支持MVC架构和自动路由。</li>
<li>
<p><strong>Gorm</strong>：强大的ORM库，简化数据库操作和管理。</p>
</li>
<li>
<p>最佳实践</p>
</li>
</ul>
<p>：</p>
<ul>
<li>合理使用对象池、预分配内存和同步原语，优化内存使用和并发性能。</li>
<li>根据项目需求选择合适的框架与库，提升开发效率和代码质量。</li>
<li>利用Go的调试和性能分析工具，如<code>runtime</code>包和第三方工具，持续优化程序性能。</li>
</ul>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../PDF/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Index">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Index
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../k8s%E5%92%8C%E5%AE%B9%E5%99%A8/KubeSphere%E4%BD%93%E9%AA%8C/" class="md-footer__link md-footer__link--next" aria-label="下一页: 在 Kubernetes 上快速安装 KubeSphere">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                在 Kubernetes 上快速安装 KubeSphere
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 李烨栋
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["header.autohide", "announce.dismiss", "navigation.instant", "navigation.tracking", "content.code.annotate", "toc.integrate", "toc.follow", "navigation.path", "navigation.top", "navigation.tabs", "navigation.prune", "navigation.footer", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "content.code.copy", "navigation.indexes", "search.share", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>