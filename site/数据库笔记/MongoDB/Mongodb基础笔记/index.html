
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="美少男">
      
      
        <meta name="author" content="李烨栋">
      
      
        <link rel="canonical" href="https://li-ye-dong.github.io/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%94%E8%AE%B0/MongoDB/Mongodb%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/">
      
      
        <link rel="prev" href="../MongoDB%20%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB/">
      
      
        <link rel="next" href="../Mongodb%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>Mongodb基础笔记 - 李烨栋的博客</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="../../../static/stylesheets/google_font.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mongodb基础笔记" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="李烨栋的博客" class="md-header__button md-logo" aria-label="李烨栋的博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            李烨栋的博客
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mongodb基础笔记
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="日间模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="日间模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="夜间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/li-ye-dong/liyedong.github.io.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    li-ye-dong.github.io
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  知识库索引

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../PDF/" class="md-tabs__link">
          
  
    
  
  PDF

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../go/golang/GO%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-tabs__link">
          
  
    
  
  Go

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../k8s%E5%92%8C%E5%AE%B9%E5%99%A8/KubeSphere%E4%BD%93%E9%AA%8C/" class="md-tabs__link">
          
  
    
  
  K8s和容器

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/Nginx%E5%AD%A6%E4%B9%A0/" class="md-tabs__link">
          
  
    
  
  中间件

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%AE%89%E5%85%A8/Burp%20Suite%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/" class="md-tabs__link">
          
  
    
  
  安全

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%BC%80%E5%8F%91/FastApi%E5%AD%A6%E4%B9%A0/" class="md-tabs__link">
          
  
    
  
  开发

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/RHEL9/RHEL9-RHCE%E5%AD%A6%E4%B9%A0/" class="md-tabs__link">
          
  
    
  
  操作系统

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../MongoDB%20%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB/" class="md-tabs__link">
          
  
    
  
  数据库笔记

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%99%9A%E6%8B%9F%E5%8C%96/%E8%99%9A%E6%8B%9F%E5%8C%96/RVtools%E4%BD%BF%E7%94%A8/" class="md-tabs__link">
          
  
    
  
  虚拟化

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%85%B3/credly%E6%9F%A5%E7%9C%8B%E5%8B%8B%E7%AB%A0/" class="md-tabs__link">
          
  
    
  
  认证相关

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="李烨栋的博客" class="md-nav__button md-logo" aria-label="李烨栋的博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    李烨栋的博客
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/li-ye-dong/liyedong.github.io.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    li-ye-dong.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    知识库索引
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../PDF/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    PDF
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../go/golang/GO%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Go
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../k8s%E5%92%8C%E5%AE%B9%E5%99%A8/KubeSphere%E4%BD%93%E9%AA%8C/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    K8s和容器
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/Nginx/Nginx%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    中间件
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%AE%89%E5%85%A8/Burp%20Suite%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    安全
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%BC%80%E5%8F%91/FastApi%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    开发
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/RHEL9/RHEL9-RHCE%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    操作系统
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    数据库笔记
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            数据库笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" checked>
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    MongoDB
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            MongoDB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MongoDB%20%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB 数据一致性和隔离
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Mongodb基础笔记
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Mongodb基础笔记
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="在这个页面">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      在这个页面
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mongodb基础笔记" class="md-nav__link">
    <span class="md-ellipsis">
      Mongodb基础笔记
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#安装mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      安装Mongodb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#关闭thp" class="md-nav__link">
    <span class="md-ellipsis">
      关闭THP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#环境准备" class="md-nav__link">
    <span class="md-ellipsis">
      环境准备
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用配置文件" class="md-nav__link">
    <span class="md-ellipsis">
      使用配置文件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用配置文件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#普通配置文件" class="md-nav__link">
    <span class="md-ellipsis">
      普通配置文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml格式配置文件" class="md-nav__link">
    <span class="md-ellipsis">
      yaml格式配置文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#启动和关闭mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      启动和关闭mongodb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#实例" class="md-nav__link">
    <span class="md-ellipsis">
      实例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#用户管理" class="md-nav__link">
    <span class="md-ellipsis">
      用户管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="用户管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#基本语法" class="md-nav__link">
    <span class="md-ellipsis">
      基本语法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#实例_1" class="md-nav__link">
    <span class="md-ellipsis">
      实例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#角色关系图-roles" class="md-nav__link">
    <span class="md-ellipsis">
      角色关系图 （Roles）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mongodb-基本crud" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB 基本CRUD
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MongoDB 基本CRUD">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#通用方法和帮助获取" class="md-nav__link">
    <span class="md-ellipsis">
      通用方法和帮助获取
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-insert-完成插入操作" class="md-nav__link">
    <span class="md-ellipsis">
      使用 insert 完成插入操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-find-查询文档" class="md-nav__link">
    <span class="md-ellipsis">
      使用 find 查询文档
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用 find 查询文档">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#查询条件对照表" class="md-nav__link">
    <span class="md-ellipsis">
      查询条件对照表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#查询逻辑对照表" class="md-nav__link">
    <span class="md-ellipsis">
      查询逻辑对照表
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#查询逻辑运算符" class="md-nav__link">
    <span class="md-ellipsis">
      查询逻辑运算符
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-find-搜索子文档" class="md-nav__link">
    <span class="md-ellipsis">
      使用 find 搜索子文档
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-find-搜索数组" class="md-nav__link">
    <span class="md-ellipsis">
      使用 find 搜索数组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-find-搜索数组中的对象" class="md-nav__link">
    <span class="md-ellipsis">
      使用 find 搜索数组中的对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-find-搜索数组中的对象_1" class="md-nav__link">
    <span class="md-ellipsis">
      使用 find 搜索数组中的对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#控制-find-返回的字段" class="md-nav__link">
    <span class="md-ellipsis">
      控制 find 返回的字段
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-remove-删除文档" class="md-nav__link">
    <span class="md-ellipsis">
      使用 remove 删除文档
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-update-更新文档" class="md-nav__link">
    <span class="md-ellipsis">
      使用 update 更新文档
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-update-更新数组" class="md-nav__link">
    <span class="md-ellipsis">
      使用 update 更新数组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-drop-删除集合" class="md-nav__link">
    <span class="md-ellipsis">
      使用 drop 删除集合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#使用-dropdatabase-删除数据库" class="md-nav__link">
    <span class="md-ellipsis">
      使用 dropDatabase 删除数据库
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#通过python操作mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      通过python操作mongodb
    </span>
  </a>
  
    <nav class="md-nav" aria-label="通过python操作mongodb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#安装-python-mongodb-驱动程序" class="md-nav__link">
    <span class="md-ellipsis">
      安装 Python MongoDB 驱动程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建连接" class="md-nav__link">
    <span class="md-ellipsis">
      创建连接
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#数据库操作插入数据" class="md-nav__link">
    <span class="md-ellipsis">
      数据库操作：插入数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mongodb-rsreplica-set" class="md-nav__link">
    <span class="md-ellipsis">
      MongoDB RS(Replica Set)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MongoDB RS(Replica Set)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#复制集的作用" class="md-nav__link">
    <span class="md-ellipsis">
      复制集的作用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#典型复制集结构" class="md-nav__link">
    <span class="md-ellipsis">
      典型复制集结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#数据是如何复制的" class="md-nav__link">
    <span class="md-ellipsis">
      数据是如何复制的
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#通过选举完成故障恢复" class="md-nav__link">
    <span class="md-ellipsis">
      通过选举完成故障恢复
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#影响选举的因素" class="md-nav__link">
    <span class="md-ellipsis">
      影响选举的因素
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常见选项" class="md-nav__link">
    <span class="md-ellipsis">
      常见选项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#复制集注意事项" class="md-nav__link">
    <span class="md-ellipsis">
      复制集注意事项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replcation-set配置过程详解" class="md-nav__link">
    <span class="md-ellipsis">
      Replcation Set配置过程详解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Replcation Set配置过程详解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#规划" class="md-nav__link">
    <span class="md-ellipsis">
      规划
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#配置复制集" class="md-nav__link">
    <span class="md-ellipsis">
      配置复制集：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#复制集测试" class="md-nav__link">
    <span class="md-ellipsis">
      复制集测试：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#复制集管理操作" class="md-nav__link">
    <span class="md-ellipsis">
      复制集管理操作：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#副本集其他操作命令" class="md-nav__link">
    <span class="md-ellipsis">
      副本集其他操作命令：
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Mongodb%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mongodb高级运维笔记
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Redis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            Redis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Redis/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis学习笔记
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9_3" >
        
          
          <label class="md-nav__link" for="__nav_9_3" id="__nav_9_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    SQLite3
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_3">
            <span class="md-nav__icon md-icon"></span>
            SQLite3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20ALIAS%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite ALIAS语法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20ALTER%20TABLE%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite ALTER TABLE命令
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20AND%EF%BC%86OR%20%E8%BF%90%E7%AE%97%E7%AC%A6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite AND＆OR 运算符
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20Autoincrement%EF%BC%88%E8%87%AA%E5%8A%A8%E9%80%92%E5%A2%9E%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite Autoincrement（自动递增）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20C%20or%20C%20%2B%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite C or C ++
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20DELETE%20%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite DELETE 查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20DISTINCT%E5%85%B3%E9%94%AE%E5%AD%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite DISTINCT关键字
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20Explain%EF%BC%88%E8%A7%A3%E9%87%8A%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite Explain（解释）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20GLOB%20%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite GLOB 子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20GROUP%20BY%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite GROUP BY子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20HAVING%20%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite HAVING 子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20Java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite Java
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20LIKE%20%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite LIKE 子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20LIMIT%20%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite LIMIT 子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20NULL%E5%80%BC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite NULL值
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20ORDER%20BY%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite ORDER BY子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20PHP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite PHP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20PRAGMA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite PRAGMA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20Perl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite Perl
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20Python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20SELECT%20%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite SELECT 查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20TRUNCATE%20TABLE%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite TRUNCATE TABLE命令
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20UNION%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite UNION子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20UPDATE%20%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite UPDATE 查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20Vacuum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite Vacuum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20WHERE%20%E5%AD%90%E5%8F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite WHERE 子句
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E4%BA%8B%E5%8A%A1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 事务
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%88%86%E7%A6%BB%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88DETACH%20DATABASE%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 分离数据库（DETACH DATABASE）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 创建数据库
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%88%9B%E5%BB%BA%E8%A1%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 创建表
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%88%A0%E9%99%A4%E8%A1%A8%EF%BC%88DROP%20TABLE%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 删除表（DROP TABLE）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 命令
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%AD%90%E5%8F%A5%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 子句索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%AD%90%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 子查询
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 安装
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 常用函数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%EF%BC%88INSERT%20INTO%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 插入数据（INSERT INTO）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 数据类型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 日期和时间
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E6%B3%A8%E5%85%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 注入
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 简介
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E7%BA%A6%E6%9D%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 约束
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E8%81%94%E6%8E%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 联接
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 表达式
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E8%A7%86%E5%9B%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 视图
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E8%A7%A6%E5%8F%91%E5%99%A8%EF%BC%88Trigger%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 触发器（Trigger）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 语法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite%20%E9%99%84%E5%8A%A0%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88ATTACH%20DATABASE%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite 附加数据库（ATTACH DATABASE）
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQLite3/SQLite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQLite
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../%E8%99%9A%E6%8B%9F%E5%8C%96/%E8%99%9A%E6%8B%9F%E5%8C%96/RVtools%E4%BD%BF%E7%94%A8/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    虚拟化
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%85%B3/credly%E6%9F%A5%E7%9C%8B%E5%8B%8B%E7%AB%A0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    认证相关
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h2 id="mongodb基础笔记">Mongodb基础笔记<a class="headerlink" href="#mongodb基础笔记" title="Permanent link">&para;</a></h2>
<h2 id="安装mongodb">安装Mongodb<a class="headerlink" href="#安装mongodb" title="Permanent link">&para;</a></h2>
<p><a href="https://www.mongodb.com/try/download/community">下载地址</a></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>tar<span class="w"> </span>xf<span class="w"> </span>mongodb-linux-x86_64-rhel70-4.4.29.tgz
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>mv<span class="w"> </span>mongodb-linux-x86_64-rhel70-4.4.29<span class="w"> </span>/usr/local/mongodb
</code></pre></div></td></tr></table></div>
<h1 id="关闭thp">关闭THP<a class="headerlink" href="#关闭thp" title="Permanent link">&para;</a></h1>
<p>关闭THP root用户下 在vi /etc/rc.local最后添加如下代码</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-f<span class="w"> </span>/sys/kernel/mm/transparent_hugepage/enabled<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>never<span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/transparent_hugepage/enabled
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="k">fi</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-f<span class="w"> </span>/sys/kernel/mm/transparent_hugepage/defrag<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>never<span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/transparent_hugepage/defrag
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="k">fi</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="o">[</span>root@node01<span class="w"> </span>app<span class="o">]</span><span class="c1">## cat /sys/kernel/mm/transparent_hugepage/enabled </span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>always<span class="w"> </span>madvise<span class="w"> </span><span class="o">[</span>never<span class="o">]</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w"> </span><span class="o">[</span>root@node01<span class="w"> </span>app<span class="o">]</span><span class="c1">## cat /sys/kernel/mm/transparent_hugepage/defrag</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w"> </span>always<span class="w"> </span>madvise<span class="w"> </span><span class="o">[</span>never<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p>其他系统关闭参照官方文档： </p>
<p><a href="https://docs.mongodb.com/manual/tutorial/transparent-huge-pages/">https://docs.mongodb.com/manual/tutorial/transparent-huge-pages/</a></p>
<p>为什么要关闭？ Transparent Huge Pages (THP) is a Linux memory management system that reduces the overhead of Translation Lookaside Buffer (TLB) lookups on machines with large amounts of memory by using larger memory pages. However, database workloads often perform poorly with THP, because they tend to have sparse rather than contiguous memory access patterns. You should disable THP on Linux machines to ensure best performance with MongoDB.  </p>
<h1 id="环境准备">环境准备<a class="headerlink" href="#环境准备" title="Permanent link">&para;</a></h1>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="o">(</span><span class="m">1</span><span class="o">)</span>创建所需用户和组
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>useradd<span class="w"> </span>mongod
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>passwd<span class="w"> </span>mongod
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="o">(</span><span class="m">2</span><span class="o">)</span>创建mongodb所需目录结构
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/mongodb/conf
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/mongodb/log
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/mongodb/data
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="o">(</span><span class="m">3</span><span class="o">)</span><span class="w"> </span>修改权限
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>chown<span class="w"> </span>-R<span class="w"> </span>mongod:mongod<span class="w"> </span>/mongodb
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="o">(</span><span class="m">4</span><span class="o">)</span><span class="w"> </span>切换用户并设置环境变量
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>su<span class="w"> </span>-<span class="w"> </span>mongod
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>vi<span class="w"> </span>.bash_profile
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/usr/local/mongodb/bin:<span class="nv">$PATH</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="nb">source</span><span class="w"> </span>.bash_profile
</code></pre></div></td></tr></table></div>
<h1 id="使用配置文件">使用配置文件<a class="headerlink" href="#使用配置文件" title="Permanent link">&para;</a></h1>
<h3 id="普通配置文件">普通配置文件<a class="headerlink" href="#普通配置文件" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1">## 普通配置文件应用</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>vim<span class="w"> </span>/mongodb/conf/mongodb.conf
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="nv">logpath</span><span class="o">=</span>/mongodb/log/mongodb.log
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="nv">dbpath</span><span class="o">=</span>/mongodb/data<span class="w"> </span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="nv">port</span><span class="o">=</span><span class="m">27017</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="nv">logappend</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="nv">fork</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div></td></tr></table></div>
<h3 id="yaml格式配置文件">yaml格式配置文件<a class="headerlink" href="#yaml格式配置文件" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">YAML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span>
<span class="normal"><a href="#__codelineno-5-35">35</a></span>
<span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span>
<span class="normal"><a href="#__codelineno-5-44">44</a></span>
<span class="normal"><a href="#__codelineno-5-45">45</a></span>
<span class="normal"><a href="#__codelineno-5-46">46</a></span>
<span class="normal"><a href="#__codelineno-5-47">47</a></span>
<span class="normal"><a href="#__codelineno-5-48">48</a></span>
<span class="normal"><a href="#__codelineno-5-49">49</a></span>
<span class="normal"><a href="#__codelineno-5-50">50</a></span>
<span class="normal"><a href="#__codelineno-5-51">51</a></span>
<span class="normal"><a href="#__codelineno-5-52">52</a></span>
<span class="normal"><a href="#__codelineno-5-53">53</a></span>
<span class="normal"><a href="#__codelineno-5-54">54</a></span>
<span class="normal"><a href="#__codelineno-5-55">55</a></span>
<span class="normal"><a href="#__codelineno-5-56">56</a></span>
<span class="normal"><a href="#__codelineno-5-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1">## YAML 配置文件应用--</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="c1">## 系统日志配置</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="nt">systemLog</span><span class="p">:</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="c1">## 日志目标：文件</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">  </span><span class="c1">## 日志文件路径</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/mongodb/log/mongodb.log&quot;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="c1">## 日志以追加模式记录</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">  </span><span class="nt">logAppend</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="c1">## 存储配置</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="nt">storage</span><span class="p">:</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">  </span><span class="c1">## 日志</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">  </span><span class="nt">journal</span><span class="p">:</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="c1">## 启用日志</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">    </span><span class="c1">## 数据路径</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="nt">dbPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/mongodb/data&quot;</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="c1">## 进程管理配置</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="nt">processManagement</span><span class="p">:</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">  </span><span class="c1">## 启用后台守护进程</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">  </span><span class="nt">fork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">  </span><span class="c1">## pid 文件的位置</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">  </span><span class="nt">pidFilePath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;string&gt;</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="c1">## 网络配置</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="nt">net</span><span class="p">:</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w">  </span><span class="c1">## 绑定的 IP 地址</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w">  </span><span class="nt">bindIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ip&gt;</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">  </span><span class="c1">## 端口号</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;port&gt;</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="c1">## 安全配置</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="nt">security</span><span class="p">:</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="w">  </span><span class="c1">## 启用授权</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="w">  </span><span class="nt">authorization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enabled</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="c1">## 复制配置</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="nt">replication</span><span class="p">:</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="w">  </span><span class="c1">## oplog 大小（MB）</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="w">  </span><span class="nt">oplogSizeMB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;NUM&gt;</span>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="w">  </span><span class="c1">## 复制集名称</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w">  </span><span class="nt">replSetName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;REPSETNAME&gt;&quot;</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="w">  </span><span class="c1">## 次要索引预取模式</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="w">  </span><span class="nt">secondaryIndexPrefetch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;all&quot;</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="w">  </span><span class="c1">## 本地 ping 阈值（毫秒）</span>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="w">  </span><span class="nt">localPingThresholdMs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;int&gt;</span>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="c1">## 分片配置</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="nt">sharding</span><span class="p">:</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="w">  </span><span class="c1">## 集群角色</span>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="w">  </span><span class="nt">clusterRole</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;string&gt;</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="w">  </span><span class="c1">## 归档已移动块（仅适用于 mongos）</span>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="w">  </span><span class="nt">archiveMovedChunks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;boolean&gt;</span><span class="w"> </span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="w">  </span><span class="c1">## 配置数据库的地址</span>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="w">  </span><span class="nt">configDB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;string&gt;</span>
</code></pre></div></td></tr></table></div>
<h3 id="启动和关闭mongodb">启动和关闭mongodb<a class="headerlink" href="#启动和关闭mongodb" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1">## 关闭mongodb</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/conf/mongodb.conf<span class="w"> </span>--shutdown
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>使用配置文件启动mongodb
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/conf/mongodb.conf
</code></pre></div></td></tr></table></div>
<h3 id="实例">实例<a class="headerlink" href="#实例" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">YAML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nt">systemLog</span><span class="p">:</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">file</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/mongodb/log/mongodb.log&quot;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">  </span><span class="nt">logAppend</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="nt">storage</span><span class="p">:</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">  </span><span class="nt">journal</span><span class="p">:</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">  </span><span class="nt">dbPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/mongodb/data/&quot;</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="nt">processManagement</span><span class="p">:</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">  </span><span class="nt">fork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="nt">net</span><span class="p">:</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">27017</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">  </span><span class="nt">bindIp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">本机ip,127.0.0.1</span>
</code></pre></div></td></tr></table></div>
<h2 id="用户管理">用户管理<a class="headerlink" href="#用户管理" title="Permanent link">&para;</a></h2>
<p>注意<br />
验证库，建立用户时use到的库，在使用用户时，要加上验证库才能登陆。<br />
对于管理员用户,必须在admin下创建.</p>
<ol>
<li>建用户时,use到的库,就是此用户的验证库</li>
<li>登录时,必须明确指定验证库才能登录</li>
<li>通常,管理员用的验证库是admin,普通用户的验证库一般是所管理的库设置为验证库</li>
<li>如果直接登录到数据库,不进行use,默认的验证库是test,不是我们生产建议的.</li>
</ol>
<h3 id="基本语法">基本语法<a class="headerlink" href="#基本语法" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>use<span class="w"> </span>admin<span class="w"> </span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>mongo<span class="w"> </span><span class="m">192</span>.168.107.23/admin
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w"> </span>db.createUser
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span>user:<span class="w"> </span><span class="s2">&quot;&lt;name&gt;&quot;</span>,
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span>pwd:<span class="w"> </span><span class="s2">&quot;&lt;cleartext password&gt;&quot;</span>,
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span>roles:<span class="w"> </span><span class="o">[</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">       </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span><span class="s2">&quot;&lt;role&gt;&quot;</span>,
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">     </span>db:<span class="w"> </span><span class="s2">&quot;&lt;database&gt;&quot;</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="s2">&quot;&lt;role&gt;&quot;</span>,
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span>...
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>基本语法说明：
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>user:用户名
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>pwd:密码
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>roles:
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">    </span>role:角色名
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="w">    </span>db:作用对象<span class="w"> </span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>role：root,<span class="w"> </span>readWrite,read
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>验证数据库：
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>mongo<span class="w"> </span>-u<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-p<span class="w"> </span><span class="m">123</span><span class="w"> </span><span class="m">10</span>.0.51/test
</code></pre></div></td></tr></table></div>
<h2 id="实例_1">实例<a class="headerlink" href="#实例_1" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span>
<span class="normal"><a href="#__codelineno-9-50">50</a></span>
<span class="normal"><a href="#__codelineno-9-51">51</a></span>
<span class="normal"><a href="#__codelineno-9-52">52</a></span>
<span class="normal"><a href="#__codelineno-9-53">53</a></span>
<span class="normal"><a href="#__codelineno-9-54">54</a></span>
<span class="normal"><a href="#__codelineno-9-55">55</a></span>
<span class="normal"><a href="#__codelineno-9-56">56</a></span>
<span class="normal"><a href="#__codelineno-9-57">57</a></span>
<span class="normal"><a href="#__codelineno-9-58">58</a></span>
<span class="normal"><a href="#__codelineno-9-59">59</a></span>
<span class="normal"><a href="#__codelineno-9-60">60</a></span>
<span class="normal"><a href="#__codelineno-9-61">61</a></span>
<span class="normal"><a href="#__codelineno-9-62">62</a></span>
<span class="normal"><a href="#__codelineno-9-63">63</a></span>
<span class="normal"><a href="#__codelineno-9-64">64</a></span>
<span class="normal"><a href="#__codelineno-9-65">65</a></span>
<span class="normal"><a href="#__codelineno-9-66">66</a></span>
<span class="normal"><a href="#__codelineno-9-67">67</a></span>
<span class="normal"><a href="#__codelineno-9-68">68</a></span>
<span class="normal"><a href="#__codelineno-9-69">69</a></span>
<span class="normal"><a href="#__codelineno-9-70">70</a></span>
<span class="normal"><a href="#__codelineno-9-71">71</a></span>
<span class="normal"><a href="#__codelineno-9-72">72</a></span>
<span class="normal"><a href="#__codelineno-9-73">73</a></span>
<span class="normal"><a href="#__codelineno-9-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>（1）--创建超级管理员：管理所有数据库（必须use<span class="w"> </span>admin再去创建）
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>$<span class="w"> </span>mongo
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w"> </span>use<span class="w"> </span>admin
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w"> </span>db.createUser<span class="o">(</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">   </span><span class="o">{</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">     </span>user:<span class="w"> </span><span class="s2">&quot;root&quot;</span>,
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">     </span>pwd:<span class="w"> </span><span class="s2">&quot;root123&quot;</span>,
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">     </span>roles:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span><span class="s2">&quot;root&quot;</span>,<span class="w"> </span>db:<span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">   </span><span class="o">}</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w"> </span><span class="o">)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>验证用户
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>db.auth<span class="o">(</span><span class="s1">&#39;root&#39;</span>,<span class="s1">&#39;root123&#39;</span><span class="o">)</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>配置文件中，加入以下配置
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>security:
<a id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">   </span>authorization:<span class="w"> </span>enabled
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>重启mongodb
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/conf/mongo.conf<span class="w"> </span>--shutdown<span class="w"> </span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/conf/mongo.conf<span class="w"> </span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a>登录验证
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>mongo<span class="w"> </span>-uroot<span class="w"> </span>-proot123<span class="w">  </span>admin
<a id="__codelineno-9-21" name="__codelineno-9-21"></a>mongo<span class="w"> </span>-uroot<span class="w"> </span>-proot123<span class="w">  </span><span class="m">10</span>.0.51/admin
<a id="__codelineno-9-22" name="__codelineno-9-22"></a>或者
<a id="__codelineno-9-23" name="__codelineno-9-23"></a>mongo
<a id="__codelineno-9-24" name="__codelineno-9-24"></a>use<span class="w"> </span>admin
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>db.auth<span class="o">(</span><span class="s1">&#39;root&#39;</span>,<span class="s1">&#39;root123&#39;</span><span class="o">)</span>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a>查看用户:
<a id="__codelineno-9-27" name="__codelineno-9-27"></a>use<span class="w"> </span>admin
<a id="__codelineno-9-28" name="__codelineno-9-28"></a>db.system.users.find<span class="o">()</span>.pretty<span class="o">()</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="m">2</span>、创建库管理用户
<a id="__codelineno-9-30" name="__codelineno-9-30"></a>mongo<span class="w"> </span>-uroot<span class="w"> </span>-proot123<span class="w">  </span>admin
<a id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="w"> </span>use<span class="w"> </span>app
<a id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="w"> </span>db.createUser<span class="o">(</span>
<a id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="w">   </span><span class="o">{</span>
<a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="w">     </span>user:<span class="w"> </span><span class="s2">&quot;admin&quot;</span>,
<a id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="w">     </span>pwd:<span class="w"> </span><span class="s2">&quot;admin&quot;</span>,
<a id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="w">     </span>roles:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span><span class="s2">&quot;dbAdmin&quot;</span>,<span class="w"> </span>db:<span class="w"> </span><span class="s2">&quot;app&quot;</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="w">   </span><span class="o">}</span>
<a id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="w"> </span><span class="o">)</span>
<a id="__codelineno-9-39" name="__codelineno-9-39"></a>db.auth<span class="o">(</span><span class="s1">&#39;admin&#39;</span>,<span class="s1">&#39;admin&#39;</span><span class="o">)</span>
<a id="__codelineno-9-40" name="__codelineno-9-40"></a>登录测试
<a id="__codelineno-9-41" name="__codelineno-9-41"></a>mongo<span class="w"> </span>-uadmin<span class="w"> </span>-padmin<span class="w"> </span><span class="m">10</span>.4.7.100/app
<a id="__codelineno-9-42" name="__codelineno-9-42"></a><span class="m">3</span>、创建对app数据库，读、写权限的用户app01：
<a id="__codelineno-9-43" name="__codelineno-9-43"></a>（1）超级管理员用户登陆db
<a id="__codelineno-9-44" name="__codelineno-9-44"></a>mongo<span class="w"> </span>-uroot<span class="w"> </span>-proot123<span class="w"> </span>admin
<a id="__codelineno-9-45" name="__codelineno-9-45"></a>（2）选择一个验证库
<a id="__codelineno-9-46" name="__codelineno-9-46"></a>use<span class="w"> </span>app
<a id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="w"> </span><span class="o">(</span><span class="m">3</span><span class="o">)</span>创建用户
<a id="__codelineno-9-48" name="__codelineno-9-48"></a>db.createUser<span class="o">(</span>
<a id="__codelineno-9-49" name="__codelineno-9-49"></a><span class="w">   </span><span class="o">{</span>
<a id="__codelineno-9-50" name="__codelineno-9-50"></a><span class="w">   </span>user:<span class="w"> </span><span class="s2">&quot;app01&quot;</span>,
<a id="__codelineno-9-51" name="__codelineno-9-51"></a><span class="w">   </span>pwd:<span class="w"> </span><span class="s2">&quot;app01&quot;</span>,
<a id="__codelineno-9-52" name="__codelineno-9-52"></a><span class="w">   </span>roles:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span><span class="s2">&quot;readWrite&quot;</span><span class="w"> </span>,<span class="w"> </span>db:<span class="w"> </span><span class="s2">&quot;app&quot;</span><span class="w"> </span><span class="o">}</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-9-53" name="__codelineno-9-53"></a><span class="w">   </span><span class="o">}</span>
<a id="__codelineno-9-54" name="__codelineno-9-54"></a><span class="w"> </span><span class="o">)</span>
<a id="__codelineno-9-55" name="__codelineno-9-55"></a>mongo<span class="w">  </span>-uapp01<span class="w"> </span>-papp01<span class="w"> </span>app
<a id="__codelineno-9-56" name="__codelineno-9-56"></a><span class="m">4</span>、创建app数据库读写权限的用户并对test数据库具有读权限：
<a id="__codelineno-9-57" name="__codelineno-9-57"></a>mongo<span class="w"> </span>-uroot<span class="w"> </span>-proot123<span class="w"> </span><span class="m">10</span>.0.51/admin
<a id="__codelineno-9-58" name="__codelineno-9-58"></a>use<span class="w"> </span>app
<a id="__codelineno-9-59" name="__codelineno-9-59"></a><span class="w"> </span>db.createUser<span class="o">(</span>
<a id="__codelineno-9-60" name="__codelineno-9-60"></a><span class="w">   </span><span class="o">{</span>
<a id="__codelineno-9-61" name="__codelineno-9-61"></a><span class="w">     </span>user:<span class="w"> </span><span class="s2">&quot;app03&quot;</span>,
<a id="__codelineno-9-62" name="__codelineno-9-62"></a><span class="w">     </span>pwd:<span class="w"> </span><span class="s2">&quot;app03&quot;</span>,
<a id="__codelineno-9-63" name="__codelineno-9-63"></a><span class="w">     </span>roles:<span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span><span class="s2">&quot;readWrite&quot;</span>,<span class="w"> </span>db:<span class="w"> </span><span class="s2">&quot;app&quot;</span><span class="w"> </span><span class="o">}</span>,
<a id="__codelineno-9-64" name="__codelineno-9-64"></a><span class="w">     </span><span class="o">{</span><span class="w"> </span>role:<span class="w"> </span><span class="s2">&quot;read&quot;</span>,<span class="w"> </span>db:<span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-9-65" name="__codelineno-9-65"></a><span class="w">     </span><span class="o">]</span>
<a id="__codelineno-9-66" name="__codelineno-9-66"></a><span class="w">   </span><span class="o">}</span>
<a id="__codelineno-9-67" name="__codelineno-9-67"></a><span class="w"> </span><span class="o">)</span>
<a id="__codelineno-9-68" name="__codelineno-9-68"></a><span class="m">5</span>、查询mongodb中的用户信息
<a id="__codelineno-9-69" name="__codelineno-9-69"></a>mongo<span class="w"> </span>-uroot<span class="w"> </span>-proot123<span class="w"> </span><span class="m">10</span>.0.51/admin
<a id="__codelineno-9-70" name="__codelineno-9-70"></a>db.system.users.find<span class="o">()</span>.pretty<span class="o">()</span>
<a id="__codelineno-9-71" name="__codelineno-9-71"></a><span class="m">6</span>、删除用户（root身份登录，use到验证库）
<a id="__codelineno-9-72" name="__codelineno-9-72"></a><span class="c1">## mongo -uroot -proot123 10.0.51/admin</span>
<a id="__codelineno-9-73" name="__codelineno-9-73"></a>use<span class="w"> </span>app
<a id="__codelineno-9-74" name="__codelineno-9-74"></a>db.dropUser<span class="o">(</span><span class="s2">&quot;admin&quot;</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="角色关系图-roles">角色关系图 （Roles）<a class="headerlink" href="#角色关系图-roles" title="Permanent link">&para;</a></h2>
<p><img alt="" src="../../../images/1709911457288-054dc584-d6b6-4016-836d-101af164e58b.png" /></p>
<h1 id="mongodb-基本crud">MongoDB 基本CRUD<a class="headerlink" href="#mongodb-基本crud" title="Permanent link">&para;</a></h1>
<h2 id="通用方法和帮助获取">通用方法和帮助获取<a class="headerlink" href="#通用方法和帮助获取" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span>
<span class="normal"><a href="#__codelineno-10-34">34</a></span>
<span class="normal"><a href="#__codelineno-10-35">35</a></span>
<span class="normal"><a href="#__codelineno-10-36">36</a></span>
<span class="normal"><a href="#__codelineno-10-37">37</a></span>
<span class="normal"><a href="#__codelineno-10-38">38</a></span>
<span class="normal"><a href="#__codelineno-10-39">39</a></span>
<span class="normal"><a href="#__codelineno-10-40">40</a></span>
<span class="normal"><a href="#__codelineno-10-41">41</a></span>
<span class="normal"><a href="#__codelineno-10-42">42</a></span>
<span class="normal"><a href="#__codelineno-10-43">43</a></span>
<span class="normal"><a href="#__codelineno-10-44">44</a></span>
<span class="normal"><a href="#__codelineno-10-45">45</a></span>
<span class="normal"><a href="#__codelineno-10-46">46</a></span>
<span class="normal"><a href="#__codelineno-10-47">47</a></span>
<span class="normal"><a href="#__codelineno-10-48">48</a></span>
<span class="normal"><a href="#__codelineno-10-49">49</a></span>
<span class="normal"><a href="#__codelineno-10-50">50</a></span>
<span class="normal"><a href="#__codelineno-10-51">51</a></span>
<span class="normal"><a href="#__codelineno-10-52">52</a></span>
<span class="normal"><a href="#__codelineno-10-53">53</a></span>
<span class="normal"><a href="#__codelineno-10-54">54</a></span>
<span class="normal"><a href="#__codelineno-10-55">55</a></span>
<span class="normal"><a href="#__codelineno-10-56">56</a></span>
<span class="normal"><a href="#__codelineno-10-57">57</a></span>
<span class="normal"><a href="#__codelineno-10-58">58</a></span>
<span class="normal"><a href="#__codelineno-10-59">59</a></span>
<span class="normal"><a href="#__codelineno-10-60">60</a></span>
<span class="normal"><a href="#__codelineno-10-61">61</a></span>
<span class="normal"><a href="#__codelineno-10-62">62</a></span>
<span class="normal"><a href="#__codelineno-10-63">63</a></span>
<span class="normal"><a href="#__codelineno-10-64">64</a></span>
<span class="normal"><a href="#__codelineno-10-65">65</a></span>
<span class="normal"><a href="#__codelineno-10-66">66</a></span>
<span class="normal"><a href="#__codelineno-10-67">67</a></span>
<span class="normal"><a href="#__codelineno-10-68">68</a></span>
<span class="normal"><a href="#__codelineno-10-69">69</a></span>
<span class="normal"><a href="#__codelineno-10-70">70</a></span>
<span class="normal"><a href="#__codelineno-10-71">71</a></span>
<span class="normal"><a href="#__codelineno-10-72">72</a></span>
<span class="normal"><a href="#__codelineno-10-73">73</a></span>
<span class="normal"><a href="#__codelineno-10-74">74</a></span>
<span class="normal"><a href="#__codelineno-10-75">75</a></span>
<span class="normal"><a href="#__codelineno-10-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="w"> </span>a.获取帮助
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="nb">help</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w"> </span>&gt;<span class="w"> </span><span class="nb">help</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w"> </span>db.help<span class="o">()</span><span class="w">                    </span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>db.mycoll.help<span class="o">()</span><span class="w">             </span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>sh.help<span class="o">()</span><span class="w">                    </span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>rs.help<span class="o">()</span><span class="w">                    </span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="nb">help</span><span class="w"> </span>on<span class="w"> </span>db<span class="w"> </span>methods
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w"> </span><span class="nb">help</span><span class="w"> </span>on<span class="w"> </span>collection<span class="w"> </span>methods
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w"> </span>sharding<span class="w"> </span>helpers
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w"> </span>replica<span class="w"> </span><span class="nb">set</span><span class="w"> </span>helpers
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w"> </span>db.help<span class="o">()</span><span class="p">;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w"> </span>DB<span class="w"> </span>methods:
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w"> </span>db.adminCommand<span class="o">(</span>nameOrDocument<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>switches<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="w"> </span>db,<span class="w"> </span>and<span class="w"> </span>runs<span class="w"> </span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="nb">command</span><span class="w"> </span><span class="o">[</span>just<span class="w"> </span>calls<span class="w"> </span>db.runCommand<span class="o">(</span>...<span class="o">)]</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w"> </span>db.aggregate<span class="o">([</span>pipeline<span class="o">]</span>,<span class="w"> </span><span class="o">{</span>options<span class="o">})</span><span class="w"> </span>-<span class="w"> </span>performs<span class="w"> </span>a<span class="w"> </span>collectionless<span class="w"> </span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>aggregation<span class="w"> </span>on<span class="w"> </span>this<span class="w"> </span>database<span class="p">;</span><span class="w"> </span>returns<span class="w"> </span>a<span class="w"> </span>cursor
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w"> </span>db.auth<span class="o">(</span>username,<span class="w"> </span>password<span class="o">)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w"> </span>db.cloneDatabase<span class="o">(</span>fromhost<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>will<span class="w"> </span>only<span class="w"> </span><span class="k">function</span><span class="w"> </span>with<span class="w"> </span>MongoDB<span class="w"> </span><span class="m">4</span>.0<span class="w"> </span>and<span class="w"> </span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>below
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="w"> </span>...
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="w"> </span>&gt;<span class="w"> </span>db.t1.help<span class="o">()</span><span class="p">;</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w"> </span>DBCollection<span class="w"> </span><span class="nb">help</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w"> </span>db.t1.find<span class="o">()</span>.help<span class="o">()</span><span class="w"> </span>-<span class="w"> </span>show<span class="w"> </span>DBCursor<span class="w"> </span><span class="nb">help</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w"> </span>db.t1.bulkWrite<span class="o">(</span><span class="w"> </span>operations,<span class="w"> </span>&lt;optional<span class="w"> </span>params&gt;<span class="w"> </span><span class="o">)</span><span class="w"> </span>-<span class="w"> </span>bulk<span class="w"> </span>execute<span class="w"> </span>write<span class="w"> </span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a>operations,<span class="w"> </span>optional<span class="w"> </span>parameters<span class="w"> </span>are:<span class="w"> </span>w,<span class="w"> </span>wtimeout,<span class="w"> </span>j
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w"> </span>db.t1.count<span class="o">(</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{}</span>,<span class="w"> </span>&lt;optional<span class="w"> </span>params&gt;<span class="w"> </span><span class="o">)</span><span class="w"> </span>-<span class="w"> </span>count<span class="w"> </span>the<span class="w"> </span>number<span class="w"> </span>of<span class="w"> </span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a>documents<span class="w"> </span>that<span class="w"> </span>matches<span class="w"> </span>the<span class="w"> </span>query,<span class="w"> </span>optional<span class="w"> </span>parameters<span class="w"> </span>are:<span class="w"> </span>limit,<span class="w"> </span>skip,<span class="w"> </span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a>hint,<span class="w"> </span>maxTimeMS
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="w"> </span>...<span class="w"> </span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a>db.<span class="o">[</span>TAB<span class="o">][</span>TAB<span class="o">]</span>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="w"> </span>db.t1.<span class="o">[</span>TAB<span class="o">][</span>TAB<span class="o">]</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="w"> </span>b.<span class="w"> </span>常用操作
<a id="__codelineno-10-34" name="__codelineno-10-34"></a>//查看当前db版本
<a id="__codelineno-10-35" name="__codelineno-10-35"></a>test&gt;<span class="w"> </span>db.version<span class="o">()</span>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="w"> </span>//显示当前数据库
<a id="__codelineno-10-37" name="__codelineno-10-37"></a>test&gt;<span class="w"> </span>db
<a id="__codelineno-10-38" name="__codelineno-10-38"></a>&gt;<span class="w"> </span>db.getName<span class="o">()</span>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="w"> </span>//<span class="w"> </span>查询所有数据库
<a id="__codelineno-10-40" name="__codelineno-10-40"></a>test&gt;<span class="w"> </span>show<span class="w"> </span>dbs
<a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="w"> </span>//切换数据库
<a id="__codelineno-10-42" name="__codelineno-10-42"></a>&gt;<span class="w"> </span>use<span class="w"> </span><span class="nb">local</span>
<a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="w"> </span>//<span class="w"> </span>显示当前数据库状态
<a id="__codelineno-10-44" name="__codelineno-10-44"></a>查看local数据
<a id="__codelineno-10-45" name="__codelineno-10-45"></a>test&gt;<span class="w"> </span>use<span class="w"> </span><span class="nb">local</span>
<a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="w"> </span>local&gt;<span class="w"> </span>db.stats<span class="o">()</span>
<a id="__codelineno-10-47" name="__codelineno-10-47"></a>查看当前数据库的连接机器地址
<a id="__codelineno-10-48" name="__codelineno-10-48"></a>&gt;<span class="w"> </span>db.getMongo<span class="o">()</span>
<a id="__codelineno-10-49" name="__codelineno-10-49"></a><span class="w"> </span>//<span class="w"> </span>指定数据库进行连接：（默认连接本机test数据库）
<a id="__codelineno-10-50" name="__codelineno-10-50"></a><span class="c1">## mongo 192.168.1.24/admin</span>
<a id="__codelineno-10-51" name="__codelineno-10-51"></a><span class="w"> </span><span class="o">[</span>mongod@mongodb<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>mongo<span class="w"> </span><span class="m">192</span>.168.1.24/admin
<a id="__codelineno-10-52" name="__codelineno-10-52"></a><span class="w"> </span>c.<span class="w"> </span>库和表的操作<span class="w"> </span>
<a id="__codelineno-10-53" name="__codelineno-10-53"></a>//<span class="w"> </span>建库<span class="w"> </span>
<a id="__codelineno-10-54" name="__codelineno-10-54"></a>use<span class="w"> </span><span class="nb">test</span>
<a id="__codelineno-10-55" name="__codelineno-10-55"></a><span class="w"> </span>//<span class="w"> </span>删除
<a id="__codelineno-10-56" name="__codelineno-10-56"></a>&gt;<span class="w"> </span>db.dropDatabase<span class="o">()</span>
<a id="__codelineno-10-57" name="__codelineno-10-57"></a><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;dropped&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;test&quot;</span>,<span class="w"> </span><span class="s2">&quot;ok&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="w"> </span>//<span class="w"> </span>创建集合<span class="o">(</span>表<span class="o">)</span>
<a id="__codelineno-10-59" name="__codelineno-10-59"></a>方法1:<span class="w"> </span>
<a id="__codelineno-10-60" name="__codelineno-10-60"></a>admin&gt;<span class="w"> </span>use<span class="w"> </span>app
<a id="__codelineno-10-61" name="__codelineno-10-61"></a><span class="w"> </span>app&gt;<span class="w"> </span>db.createCollection<span class="o">(</span><span class="s1">&#39;a&#39;</span><span class="o">)</span>
<a id="__codelineno-10-62" name="__codelineno-10-62"></a><span class="w"> </span>app&gt;<span class="w"> </span>db.createCollection<span class="o">(</span><span class="s1">&#39;b&#39;</span><span class="o">)</span>
<a id="__codelineno-10-63" name="__codelineno-10-63"></a>方法2：当插入一个文档的时候，一个集合就会自动创建。
<a id="__codelineno-10-64" name="__codelineno-10-64"></a>admin&gt;<span class="w"> </span>use<span class="w"> </span>app
<a id="__codelineno-10-65" name="__codelineno-10-65"></a><span class="w"> </span>switched<span class="w"> </span>to<span class="w"> </span>db<span class="w"> </span>app
<a id="__codelineno-10-66" name="__codelineno-10-66"></a><span class="w"> </span>app&gt;<span class="w"> </span>db.c.insert<span class="o">({</span>username:<span class="s2">&quot;mongodb&quot;</span><span class="o">})</span>
<a id="__codelineno-10-67" name="__codelineno-10-67"></a><span class="w"> </span>WriteResult<span class="o">({</span><span class="w"> </span><span class="s2">&quot;nInserted&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">})</span>
<a id="__codelineno-10-68" name="__codelineno-10-68"></a><span class="w"> </span>app&gt;<span class="w"> </span>show<span class="w"> </span>collections
<a id="__codelineno-10-69" name="__codelineno-10-69"></a><span class="w"> </span>app&gt;<span class="w"> </span>db.c.find<span class="o">()</span>
<a id="__codelineno-10-70" name="__codelineno-10-70"></a><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="w"> </span>:<span class="w"> </span>ObjectId<span class="o">(</span><span class="s2">&quot;5743c9a9bf72d9f7b524713d&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;username&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;mongodb&quot;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-10-71" name="__codelineno-10-71"></a><span class="w"> </span>//<span class="w"> </span>删除集合
<a id="__codelineno-10-72" name="__codelineno-10-72"></a>app&gt;<span class="w"> </span>use<span class="w"> </span>app
<a id="__codelineno-10-73" name="__codelineno-10-73"></a><span class="w"> </span>switched<span class="w"> </span>to<span class="w"> </span>db<span class="w"> </span>app
<a id="__codelineno-10-74" name="__codelineno-10-74"></a><span class="w"> </span>app&gt;<span class="w"> </span>db.log.drop<span class="o">()</span><span class="w"> </span>//删除集合
<a id="__codelineno-10-75" name="__codelineno-10-75"></a>//<span class="w"> </span>重命名集合
<a id="__codelineno-10-76" name="__codelineno-10-76"></a>app&gt;<span class="w"> </span>db.log.renameCollection<span class="o">(</span><span class="s2">&quot;log1&quot;</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="使用-insert-完成插入操作">使用 insert 完成插入操作<a class="headerlink" href="#使用-insert-完成插入操作" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nx">操作格式</span><span class="err">：</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">集合</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">JSON对象</span><span class="o">&gt;</span><span class="p">)</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">集合</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">insertMany</span><span class="p">([</span><span class="o">&lt;</span><span class="nb">JSON</span><span class="w"> </span><span class="mf">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="nb">JSON</span><span class="w"> </span><span class="mf">2</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="o">&lt;</span><span class="nb">JSON</span><span class="w"> </span><span class="nx">n</span><span class="o">&gt;</span><span class="p">])</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span><span class="nx">示例</span><span class="err">：</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;apple&quot;</span><span class="p">})</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">insertMany</span><span class="p">([</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">  </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;apple&quot;</span><span class="p">},</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">  </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;pear&quot;</span><span class="p">},</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">  </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;orange&quot;</span><span class="p">}</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="p">])</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="nx">批量插入数据</span><span class="err">：</span><span class="w"> </span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mf">10000</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span><span class="w"> </span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">  </span><span class="nx">db</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="nx">i</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;mongodb&quot;</span><span class="p">,</span><span class="s2">&quot;age&quot;</span><span class="o">:</span><span class="mf">6</span><span class="p">,</span><span class="s2">&quot;date&quot;</span><span class="o">:</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()});</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="使用-find-查询文档">使用 find 查询文档<a class="headerlink" href="#使用-find-查询文档" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nx">关于</span><span class="w"> </span><span class="nx">find</span><span class="o">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">是</span><span class="w"> </span><span class="nx">MongoDB</span><span class="w"> </span><span class="nx">中查询数据的基本指令</span><span class="err">，</span><span class="nx">相当于</span><span class="w"> </span><span class="nx">SQL</span><span class="w"> </span><span class="nx">中的</span><span class="w"> </span><span class="nx">SELECT</span><span class="w"> </span><span class="err">。</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nx">find</span><span class="w"> </span><span class="nx">返回的是游标</span><span class="err">。</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="err">##</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">示例</span><span class="err">：</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1975</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">//单条件查询</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1989</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Batman&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">//多条件and查询</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$and</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Batman&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;category&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;action&quot;</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="p">)</span><span class="w"> </span><span class="c1">// and的另一种形式</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$or</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;year&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1989</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Batman&quot;</span><span class="p">}]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">//多条件or</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="nx">查询</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="sr">/^B/</span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">//按正则表达式查找</span>
</code></pre></div></td></tr></table></div>
<h3 id="查询条件对照表">查询条件对照表<a class="headerlink" href="#查询条件对照表" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>SQL</th>
<th>MSQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>a = 1</td>
<td>{a: 1}</td>
</tr>
<tr>
<td>a &lt;&gt; 1</td>
<td>{a: {$ne: 1}}</td>
</tr>
<tr>
<td>a &gt; 1</td>
<td>{a: {$gt: 1}}</td>
</tr>
<tr>
<td>a &gt;= 1</td>
<td>{a: {$gte: 1}}</td>
</tr>
<tr>
<td>a &lt; 1</td>
<td>{a: {$lt: 1}}</td>
</tr>
<tr>
<td>a &lt;= 1</td>
<td>{a: {$lte: 1}}</td>
</tr>
</tbody>
</table>
<h3 id="查询逻辑对照表">查询逻辑对照表<a class="headerlink" href="#查询逻辑对照表" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>SQL</th>
<th>MSQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>a = 1 AND b = 1</td>
<td>{a: 1, b: 1}或{$and: [{a: 1}, {b: 1}]}</td>
</tr>
<tr>
<td>a = 1 OR b = 1</td>
<td>{$or: [{a: 1}, {b: 1}]}</td>
</tr>
<tr>
<td>a IS NULL</td>
<td>{a: {$exists: false}}</td>
</tr>
<tr>
<td>a IN (1, 2, 3)</td>
<td>{a: {$in: [1, 2, 3]}}</td>
</tr>
</tbody>
</table>
<h3 id="查询逻辑运算符">查询逻辑运算符<a class="headerlink" href="#查询逻辑运算符" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span>
<span class="normal"><a href="#__codelineno-13-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="err">●</span><span class="w"> </span><span class="nx">$lt</span><span class="o">:</span><span class="w"> </span><span class="nx">存在并小于</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="err">●</span><span class="w"> </span><span class="nx">$lte</span><span class="o">:</span><span class="w"> </span><span class="nx">存在并小于等于</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="err">●</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="nx">存在并大于</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="err">●</span><span class="w"> </span><span class="nx">$gte</span><span class="o">:</span><span class="w"> </span><span class="nx">存在并大于等于</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="err">●</span><span class="w"> </span><span class="nx">$ne</span><span class="o">:</span><span class="w"> </span><span class="nx">不存在或存在但不等于</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="err">●</span><span class="w"> </span><span class="nx">$in</span><span class="o">:</span><span class="w"> </span><span class="nx">存在并在指定数组中</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="err">●</span><span class="w"> </span><span class="nx">$nin</span><span class="o">:</span><span class="w"> </span><span class="nx">不存在或不在指定数组中</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="err">●</span><span class="w"> </span><span class="nx">$or</span><span class="o">:</span><span class="w"> </span><span class="nx">匹配两个或多个条件中的一个</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="err">●</span><span class="w"> </span><span class="nx">$and</span><span class="o">:</span><span class="w"> </span><span class="nx">匹配全部条件</span>
</code></pre></div></td></tr></table></div>
<h3 id="使用-find-搜索子文档">使用 find 搜索子文档<a class="headerlink" href="#使用-find-搜索子文档" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span>
<span class="normal"><a href="#__codelineno-14-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nx">find</span><span class="w"> </span><span class="nx">支持使用</span><span class="err">“</span><span class="nx">field</span><span class="p">.</span><span class="nx">sub_field</span><span class="err">”</span><span class="nx">的形式查询子文档</span><span class="err">。</span><span class="nx">假设有一个文档</span><span class="err">：</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;apple&quot;</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w"> </span><span class="kr">from</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w"> </span><span class="nx">country</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;China&quot;</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w"> </span><span class="nx">province</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Guangdong&quot;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="nx">正确写法</span><span class="err">：</span><span class="w"> </span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;from.country&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;China&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="使用-find-搜索数组">使用 find 搜索数组<a class="headerlink" href="#使用-find-搜索数组" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span>
<span class="normal"><a href="#__codelineno-15-8">8</a></span>
<span class="normal"><a href="#__codelineno-15-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nx">find</span><span class="w"> </span><span class="nx">支持对数组中的元素进行搜索</span><span class="err">。</span><span class="nx">假设有一个文档</span><span class="err">：</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">insert</span><span class="p">([</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Apple&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;green&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Mango&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;green&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w"> </span><span class="p">])</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="nx">查看单个条件</span><span class="err">：</span><span class="w"> </span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">})</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="nx">查询多个条件</span><span class="err">：</span><span class="w"> </span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">$or</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;yellow&quot;</span><span class="p">}]}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="使用-find-搜索数组中的对象">使用 find 搜索数组中的对象<a class="headerlink" href="#使用-find-搜索数组中的对象" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nx">考虑以下文档</span><span class="err">，</span><span class="nx">在其中搜索</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Raiders of the Lost Ark&quot;</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w"> </span><span class="s2">&quot;filming_locations&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="p">{</span><span class="w"> </span><span class="s2">&quot;city&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Los Angeles&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;USA&quot;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;city&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Rome&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Lazio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Italy&quot;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;city&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Florence&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;USA&quot;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w"> </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="p">})</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w"> </span><span class="c1">// 查找城市是 Rome 的记录</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;filming_locations.city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Rome&quot;</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
<h3 id="使用-find-搜索数组中的对象_1">使用 find 搜索数组中的对象<a class="headerlink" href="#使用-find-搜索数组中的对象_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="nx">在数组中搜索子对象的多个字段时</span><span class="err">，</span><span class="nx">如果使用</span><span class="w"> </span><span class="nx">$elemMatch</span><span class="err">，</span><span class="nx">它表示必须是同一个</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="nx">子对象满足多个条件</span><span class="err">。</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="nx">考虑以下两个查询</span><span class="err">：</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="nx">db</span><span class="p">.</span><span class="nx">getCollection</span><span class="p">(</span><span class="s1">&#39;movies&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">({</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w"> </span><span class="s2">&quot;filming_locations.city&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Rome&quot;</span><span class="p">,</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w"> </span><span class="s2">&quot;filming_locations.country&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;USA&quot;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;11111&quot;</span><span class="p">,</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w"> </span><span class="s2">&quot;filming_locations&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="p">{</span><span class="w"> </span><span class="s2">&quot;city&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;bj&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CA&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CHN&quot;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;city&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Rome&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Lazio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Italy&quot;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;city&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;tlp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;state&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;USA&quot;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w"> </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="p">})</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">getCollection</span><span class="p">(</span><span class="s1">&#39;movies&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">({</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w"> </span><span class="s2">&quot;filming_locations&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w"> </span><span class="nx">$elemMatch</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;city&quot;</span><span class="o">:</span><span class="s2">&quot;bj&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;country&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CHN&quot;</span><span class="p">}</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w"> </span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
<h3 id="控制-find-返回的字段">控制 find 返回的字段<a class="headerlink" href="#控制-find-返回的字段" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nx">find</span><span class="w"> </span><span class="nx">可以指定只返回指定的字段</span><span class="err">；</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="err">●</span><span class="w"> </span><span class="nx">_id字段必须明确指明不返回</span><span class="err">，</span><span class="nx">否则默认返回</span><span class="err">；</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="err">●</span><span class="w"> </span><span class="nx">在</span><span class="w"> </span><span class="nx">MongoDB</span><span class="w"> </span><span class="nx">中我们称这为投影</span><span class="err">（</span><span class="nx">projection</span><span class="err">）；</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="err">●</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">({},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="mf">1</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../../../images/1709911931253-3035a3a7-adaf-48d7-8682-b888ffaf15a1.png" /></p>
<h2 id="使用-remove-删除文档">使用 remove 删除文档<a class="headerlink" href="#使用-remove-删除文档" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span>
<span class="normal"><a href="#__codelineno-19-7">7</a></span>
<span class="normal"><a href="#__codelineno-19-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nx">remove</span><span class="w"> </span><span class="nx">命令需要配合查询条件使用</span><span class="err">；</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="err">●</span><span class="w"> </span><span class="nx">匹配查询条件的的文档会被删除</span><span class="err">；</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="err">●</span><span class="w"> </span><span class="nx">指定一个空文档条件会删除所有文档</span><span class="err">；</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="err">●</span><span class="w"> </span><span class="nx">以下示例</span><span class="err">：</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="nx">db</span><span class="p">.</span><span class="nx">testcol</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// 删除a 等于1的记录</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="nx">db</span><span class="p">.</span><span class="nx">testcol</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$lt</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// 删除a 小于5的记录</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="nx">db</span><span class="p">.</span><span class="nx">testcol</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">// 删除所有记录</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="nx">db</span><span class="p">.</span><span class="nx">testcol</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span><span class="w"> </span><span class="c1">//报错</span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../../../images/1709911969965-47725b47-3ba5-402c-a7b9-d632f8de8376.png" /></p>
<h2 id="使用-update-更新文档">使用 update 更新文档<a class="headerlink" href="#使用-update-更新文档" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="err">●</span><span class="w"> </span><span class="nx">使用</span><span class="w"> </span><span class="nx">updateOne</span><span class="w"> </span><span class="nx">表示无论条件匹配多少条记录</span><span class="err">，</span><span class="nx">始终只更新第一条</span><span class="err">；</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="err">●</span><span class="w"> </span><span class="nx">使用</span><span class="w"> </span><span class="nx">updateMany</span><span class="w"> </span><span class="nx">表示条件匹配多少条就更新多少条</span><span class="err">；</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="err">●</span><span class="w"> </span><span class="nx">updateOne</span><span class="o">/</span><span class="nx">updateMany</span><span class="w"> </span><span class="nx">方法要求更新条件部分必须具有以下之一</span><span class="err">，</span><span class="nx">否则将报错</span><span class="err">：</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="err">•</span><span class="w"> </span><span class="nx">$set</span><span class="o">/</span><span class="nx">$unset</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">    </span><span class="err">•</span><span class="w"> </span><span class="nx">$push</span><span class="o">/</span><span class="nx">$pushAll</span><span class="o">/</span><span class="nx">$pop</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="err">•</span><span class="w"> </span><span class="nx">$pull</span><span class="o">/</span><span class="nx">$pullAll</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">    </span><span class="err">•</span><span class="w"> </span><span class="nx">$addToSet</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w"> </span><span class="err">●</span><span class="w"> </span><span class="c1">// 报错</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="nx">db</span><span class="p">.</span><span class="nx">fruit</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;apple&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="kr">from</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;China&quot;</span><span class="p">})</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w"> </span><span class="err">●</span><span class="w"> </span><span class="nx">正确</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">uid</span><span class="o">:</span><span class="mf">0</span><span class="p">},{</span><span class="nx">$set</span><span class="o">:</span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;liyedong&quot;</span><span class="p">}})</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="p">{</span><span class="w"> </span><span class="s2">&quot;acknowledged&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;matchedCount&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;modifiedCount&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="nx">$set</span><span class="o">/</span><span class="nx">$unset</span><span class="err">：</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="nx">$set</span><span class="err">：</span><span class="nx">将指定字段设置为特定的值</span><span class="err">，</span><span class="nx">如果该字段不存在</span><span class="err">，</span><span class="nx">则创建它</span><span class="err">。</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="nx">$unset</span><span class="err">：</span><span class="nx">从文档中删除指定字段</span><span class="err">。</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="nx">$push</span><span class="o">/</span><span class="nx">$pushAll</span><span class="o">/</span><span class="nx">$pop</span><span class="err">：</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="nx">$push</span><span class="err">：</span><span class="nx">将值追加到数组字段中</span><span class="err">。</span><span class="nx">如果数组不存在</span><span class="err">，</span><span class="nx">则创建一个新数组</span><span class="err">。</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="nx">$pushAll</span><span class="err">：</span><span class="nx">将多个值一次性追加到数组字段中</span><span class="err">。</span><span class="nx">在MongoDB</span><span class="w"> </span><span class="mf">3.6</span><span class="nx">之后已弃用</span><span class="err">，</span><span class="nx">推荐使用$push</span><span class="err">。</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="nx">$pop</span><span class="err">：</span><span class="nx">从数组字段的开头或结尾删除一个元素</span><span class="err">。</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="nx">$pull</span><span class="o">/</span><span class="nx">$pullAll</span><span class="err">：</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="nx">$pull</span><span class="err">：</span><span class="nx">从数组字段中删除满足特定条件的所有元素</span><span class="err">。</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="nx">$pullAll</span><span class="err">：</span><span class="nx">从数组字段中删除指定的多个值</span><span class="err">。</span><span class="nx">在MongoDB</span><span class="w"> </span><span class="mf">3.6</span><span class="nx">之后已弃用</span><span class="err">，</span><span class="nx">推荐使用$pull</span><span class="err">。</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="nx">$addToSet</span><span class="err">：</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a><span class="nx">将值添加到集合</span><span class="err">（</span><span class="nx">数组</span><span class="err">）</span><span class="nx">字段中</span><span class="err">，</span><span class="nx">但仅当该值不已经存在于该集合中时才添加</span><span class="err">。</span><span class="nx">如果集合字段不存在</span><span class="err">，</span><span class="nx">则创建一个新集合字段</span><span class="err">。</span>
</code></pre></div></td></tr></table></div>
<h2 id="使用-update-更新数组">使用 update 更新数组<a class="headerlink" href="#使用-update-更新数组" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="err">●</span><span class="w"> </span><span class="nx">$push</span><span class="o">:</span><span class="w"> </span><span class="nx">增加一个对象到数组底部</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="err">●</span><span class="w"> </span><span class="nx">$pushAll</span><span class="o">:</span><span class="w"> </span><span class="nx">增加多个对象到数组底部</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="err">●</span><span class="w"> </span><span class="nx">$pop</span><span class="o">:</span><span class="w"> </span><span class="nx">从数组底部删除一个对象</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="err">●</span><span class="w"> </span><span class="nx">$pull</span><span class="o">:</span><span class="w"> </span><span class="nx">如果匹配指定的值</span><span class="err">，</span><span class="nx">从数组中删除相应的对象</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="err">●</span><span class="w"> </span><span class="nx">$pullAll</span><span class="o">:</span><span class="w"> </span><span class="nx">如果匹配任意的值</span><span class="err">，</span><span class="nx">从数据中删除相应的对象</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="err">●</span><span class="w"> </span><span class="nx">$addToSet</span><span class="o">:</span><span class="w"> </span><span class="nx">如果不存在则增加一个值到数组</span>
</code></pre></div></td></tr></table></div>
<h2 id="使用-drop-删除集合">使用 drop 删除集合<a class="headerlink" href="#使用-drop-删除集合" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="err">●</span><span class="w"> </span><span class="nx">使用</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">集合</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">drop</span><span class="p">()</span><span class="w"> </span><span class="nx">来删除一个集合</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="err">●</span><span class="w"> </span><span class="nx">集合中的全部文档都会被删除</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="err">●</span><span class="w"> </span><span class="nx">集合相关的索引也会被删除</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="nx">db</span><span class="p">.</span><span class="nx">colToBeDropped</span><span class="p">.</span><span class="nx">drop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h2 id="使用-dropdatabase-删除数据库">使用 dropDatabase 删除数据库<a class="headerlink" href="#使用-dropdatabase-删除数据库" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span>
<span class="normal"><a href="#__codelineno-23-5">5</a></span>
<span class="normal"><a href="#__codelineno-23-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="err">●</span><span class="w"> </span><span class="nx">使用</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">dropDatabase</span><span class="p">()</span><span class="w"> </span><span class="nx">来删除数据库</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="err">●</span><span class="w"> </span><span class="nx">数据库相应文件也会被删除</span><span class="err">，</span><span class="nx">磁盘空间将被释放</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="nx">use</span><span class="w"> </span><span class="nx">tempDB</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">dropDatabase</span><span class="p">()</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">collections</span><span class="w"> </span><span class="c1">// No collections</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">dbs</span><span class="w"> </span><span class="c1">// The db is gone</span>
</code></pre></div></td></tr></table></div>
<h1 id="通过python操作mongodb">通过python操作mongodb<a class="headerlink" href="#通过python操作mongodb" title="Permanent link">&para;</a></h1>
<h2 id="安装-python-mongodb-驱动程序">安装 Python MongoDB 驱动程序<a class="headerlink" href="#安装-python-mongodb-驱动程序" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span>
<span class="normal"><a href="#__codelineno-24-6">6</a></span>
<span class="normal"><a href="#__codelineno-24-7">7</a></span>
<span class="normal"><a href="#__codelineno-24-8">8</a></span>
<span class="normal"><a href="#__codelineno-24-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>在<span class="w"> </span>Python<span class="w"> </span>中使用<span class="w"> </span>MongoDB<span class="w"> </span>之前必须先安装用于访问数据库的驱动程序：
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>wget<span class="w"> </span>-O<span class="w"> </span>/etc/yum.repos.d/CentOS-Base.repo<span class="w"> </span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>http://mirrors.aliyun.com/repo/Centos-7.repo
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>wget<span class="w"> </span>-O<span class="w"> </span>/etc/yum.repos.d/epel.repo<span class="w"> </span>http://mirrors.aliyun.com/repo/epel-7.repo
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>pip3<span class="w"> </span>install<span class="w"> </span>pymongo
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>在<span class="w"> </span>python<span class="w"> </span>交互模式下导入<span class="w"> </span>pymongo，检查驱动是否已正确安装：
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>import<span class="w"> </span>pymongo<span class="w"> </span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>pymongo.version
</code></pre></div></td></tr></table></div>
<h2 id="创建连接">创建连接<a class="headerlink" href="#创建连接" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>确定<span class="w"> </span>MongoDB<span class="w"> </span>连接串
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>使用驱动连接到<span class="w"> </span>MongoDB<span class="w"> </span>集群只需要指定<span class="w"> </span>MongoDB<span class="w"> </span>连接字符串即可。其基本格式可
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>以参考文档:<span class="w"> </span>Connection<span class="w"> </span>String<span class="w"> </span>URI<span class="w"> </span>Format<span class="w"> </span>最简单的形式是
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>mongodb://数据库服务器主机地址：端口号
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>如：mongodb://127.0.0.1:27017
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w"> </span>●<span class="w"> </span>初始化数据库连接
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>from<span class="w"> </span>pymongo<span class="w"> </span>import<span class="w"> </span>MongoClient<span class="w"> </span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="nv">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mongodb://root:root123@10.0.0.51:27017&quot;</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>MongoClient<span class="o">(</span>uri<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a>client
</code></pre></div></td></tr></table></div>
<h2 id="数据库操作插入数据">数据库操作：插入数据<a class="headerlink" href="#数据库操作插入数据" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span>
<span class="normal"><a href="#__codelineno-26-7">7</a></span>
<span class="normal"><a href="#__codelineno-26-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a>初始化数据库和集合
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="nv">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client<span class="o">[</span><span class="s2">&quot;eshop&quot;</span><span class="o">]</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w"> </span><span class="nv">user_coll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>db<span class="o">[</span><span class="s2">&quot;users&quot;</span><span class="o">]</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>插入一条新的用户数据
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="nv">new_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="s2">&quot;username&quot;</span>:<span class="w"> </span><span class="s2">&quot;nina&quot;</span>,<span class="w"> </span><span class="s2">&quot;password&quot;</span>:<span class="w"> </span><span class="s2">&quot;xxxx&quot;</span>,<span class="w"> </span><span class="s2">&quot;email&quot;</span>:<span class="w"> </span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="s2">&quot;123456@qq.com &quot;</span><span class="o">}</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>user_coll.insert_one<span class="o">(</span>new_user<span class="o">)</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w"> </span>result
</code></pre></div></td></tr></table></div>
<h1 id="mongodb-rsreplica-set">MongoDB RS(Replica Set)<a class="headerlink" href="#mongodb-rsreplica-set" title="Permanent link">&para;</a></h1>
<h2 id="复制集的作用">复制集的作用<a class="headerlink" href="#复制集的作用" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span>
<span class="normal"><a href="#__codelineno-27-6">6</a></span>
<span class="normal"><a href="#__codelineno-27-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>MongoDB<span class="w"> </span>复制集的主要意义在于实现服务高可用,它的现实依赖于两个方面的功能：
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>•<span class="w"> </span>数据写入时将数据迅速复制到另一个独立节点上
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>•<span class="w"> </span>在接受写入的节点发生故障时自动选举出一个新的替代节点
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>在实现高可用的同时，复制集实现了其他几个附加作用：
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>•<span class="w"> </span>数据分发：将数据从一个区域复制到另一个区域，减少另一个区域的读延迟
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>•<span class="w"> </span>读写分离：不同类型的压力分别在不同的节点上执行
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>•<span class="w"> </span>异地容灾：在数据中心故障时候快速切换到异地
</code></pre></div></td></tr></table></div>
<h2 id="典型复制集结构">典型复制集结构<a class="headerlink" href="#典型复制集结构" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a>一个典型的复制集由3个以上具有投票权的节点组成，包括：
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>•<span class="w"> </span>一个主节点（PRIMARY）：接受写入操作和选举时投票
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>•<span class="w"> </span>Arbiter（投票节点）
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>•<span class="w"> </span>两个（或多个）从节点（SECONDARY）：复制主节点上的新数据和选举时投票
</code></pre></div></td></tr></table></div>
<p>·<img alt="" src="../../../images/1709912228149-bee27bd1-f279-4fc9-ad20-652d1ceac0b7.png" /></p>
<h2 id="数据是如何复制的">数据是如何复制的<a class="headerlink" href="#数据是如何复制的" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>当一个修改操作，无论是插入、更新或删除，到达主节点时，它对数据的操作将被记录下来（经过一些必
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>要的转换），这些记录称为<span class="w"> </span>oplog。
<a id="__codelineno-29-3" name="__codelineno-29-3"></a>从节点通过在主节点上打开一个<span class="w"> </span>tailable<span class="w"> </span>游标不断获取新进入主节点的<span class="w"> </span>oplog，并在自己的数据上
<a id="__codelineno-29-4" name="__codelineno-29-4"></a>回放，以此保持跟主节点的数据一致。
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../../../images/1709912247793-4018e268-5afe-4c32-bed5-b5d5974ae117.png" /></p>
<h2 id="通过选举完成故障恢复">通过选举完成故障恢复<a class="headerlink" href="#通过选举完成故障恢复" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a>具有投票权的节点之间两两互相发送心跳；
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>●<span class="w"> </span>当5次心跳未收到时判断为节点失联；
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>●<span class="w"> </span>如果失联的是主节点，从节点会发起选举，选出新的主节点；
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>●<span class="w"> </span>如果失联的是从节点则不会产生新的选举；<span class="w"> </span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>●<span class="w"> </span>选举基于<span class="w"> </span>RAFT<span class="w"> </span>一致性算法实现，选举成功的必要条件是大多数投票节点存活；
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../../../images/1709912268123-40fc4cb1-090a-470b-83d9-962912b45d18.png" /></p>
<h2 id="影响选举的因素">影响选举的因素<a class="headerlink" href="#影响选举的因素" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>整个集群必须有大多数节点存活；被选举为主节点的节点必须：
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>•<span class="w"> </span>能够与多数节点建立连接
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>•<span class="w"> </span>具有较新的<span class="w"> </span>oplog
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w"> </span>•<span class="w"> </span>具有较高的优先级（如果有配置）
</code></pre></div></td></tr></table></div>
<h2 id="常见选项">常见选项<a class="headerlink" href="#常见选项" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>复制集节点有以下常见的选配项：
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>•<span class="w"> </span>是否具有投票权（v<span class="w"> </span>参数）：有则参与投票；
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>•<span class="w"> </span>优先级（priority<span class="w"> </span>参数）：优先级越高的节点越优先成为主节点。优先级为0的节点无法成为主节
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>点；
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>•<span class="w"> </span>隐藏（hidden<span class="w"> </span>参数）：复制数据，但对应用不可见。隐藏节点可以具有投票仅，但优先级必须为0；<span class="w"> </span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>•<span class="w"> </span>延迟（slaveDelay<span class="w"> </span>参数）：复制<span class="w"> </span>n<span class="w"> </span>秒之前的数据，保持与主节点的时间差。
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../../../images/1709912302148-fa5d1b27-f660-4f29-9e44-669b4f314c94.png" /></p>
<h2 id="复制集注意事项">复制集注意事项<a class="headerlink" href="#复制集注意事项" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a>●<span class="w"> </span>关于硬件：
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>•<span class="w"> </span>因为正常的复制集节点都有可能成为主节点，它们的地位是一样的，因此硬件配置上必须一致；
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>•<span class="w"> </span>为了保证节点不会同时宕机，各节点使用的硬件必须具有独立性。
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>●<span class="w"> </span>关于软件：
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>•<span class="w"> </span>复制集各节点软件版本必须一致，以避免出现不可预知的问题。
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>●<span class="w"> </span>增加节点不会增加系统写性能！
</code></pre></div></td></tr></table></div>
<h2 id="replcation-set配置过程详解">Replcation Set配置过程详解<a class="headerlink" href="#replcation-set配置过程详解" title="Permanent link">&para;</a></h2>
<h3 id="规划">规划<a class="headerlink" href="#规划" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span>
<span class="normal"><a href="#__codelineno-34-21">21</a></span>
<span class="normal"><a href="#__codelineno-34-22">22</a></span>
<span class="normal"><a href="#__codelineno-34-23">23</a></span>
<span class="normal"><a href="#__codelineno-34-24">24</a></span>
<span class="normal"><a href="#__codelineno-34-25">25</a></span>
<span class="normal"><a href="#__codelineno-34-26">26</a></span>
<span class="normal"><a href="#__codelineno-34-27">27</a></span>
<span class="normal"><a href="#__codelineno-34-28">28</a></span>
<span class="normal"><a href="#__codelineno-34-29">29</a></span>
<span class="normal"><a href="#__codelineno-34-30">30</a></span>
<span class="normal"><a href="#__codelineno-34-31">31</a></span>
<span class="normal"><a href="#__codelineno-34-32">32</a></span>
<span class="normal"><a href="#__codelineno-34-33">33</a></span>
<span class="normal"><a href="#__codelineno-34-34">34</a></span>
<span class="normal"><a href="#__codelineno-34-35">35</a></span>
<span class="normal"><a href="#__codelineno-34-36">36</a></span>
<span class="normal"><a href="#__codelineno-34-37">37</a></span>
<span class="normal"><a href="#__codelineno-34-38">38</a></span>
<span class="normal"><a href="#__codelineno-34-39">39</a></span>
<span class="normal"><a href="#__codelineno-34-40">40</a></span>
<span class="normal"><a href="#__codelineno-34-41">41</a></span>
<span class="normal"><a href="#__codelineno-34-42">42</a></span>
<span class="normal"><a href="#__codelineno-34-43">43</a></span>
<span class="normal"><a href="#__codelineno-34-44">44</a></span>
<span class="normal"><a href="#__codelineno-34-45">45</a></span>
<span class="normal"><a href="#__codelineno-34-46">46</a></span>
<span class="normal"><a href="#__codelineno-34-47">47</a></span>
<span class="normal"><a href="#__codelineno-34-48">48</a></span>
<span class="normal"><a href="#__codelineno-34-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>三个以上的mongodb节点（或多实例）
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>多实例：
<a id="__codelineno-34-3" name="__codelineno-34-3"></a>（1）多个端口：28017、28018、28019、28020
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>（2）多套目录：
<a id="__codelineno-34-5" name="__codelineno-34-5"></a>su<span class="w"> </span>-<span class="w"> </span>mongod
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mongodb/28017/conf<span class="w"> </span>/mongodb/28017/data<span class="w"> </span>/mongodb/28017/log
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mongodb/28018/conf<span class="w"> </span>/mongodb/28018/data<span class="w"> </span>/mongodb/28018/log
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mongodb/28019/conf<span class="w"> </span>/mongodb/28019/data<span class="w"> </span>/mongodb/28019/log
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mongodb/28020/conf<span class="w"> </span>/mongodb/28020/data<span class="w"> </span>/mongodb/28020/log
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w"> </span><span class="o">(</span><span class="m">3</span><span class="o">)</span>配置文件内容准备
<a id="__codelineno-34-11" name="__codelineno-34-11"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>/mongodb/28017/conf/mongod.conf<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="s">systemLog:</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="s">  destination: file</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="s">  path: /mongodb/28017/log/mongodb.log</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="s">  logAppend: true</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="s">storage:</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="s">  journal:</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><span class="s">    enabled: true</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="s">  dbPath: /mongodb/28017/data</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a><span class="s">  directoryPerDB: true</span>
<a id="__codelineno-34-21" name="__codelineno-34-21"></a><span class="s">  #engine: wiredTiger</span>
<a id="__codelineno-34-22" name="__codelineno-34-22"></a><span class="s">  wiredTiger:</span>
<a id="__codelineno-34-23" name="__codelineno-34-23"></a><span class="s">    engineConfig:</span>
<a id="__codelineno-34-24" name="__codelineno-34-24"></a><span class="s">      cacheSizeGB: 1</span>
<a id="__codelineno-34-25" name="__codelineno-34-25"></a><span class="s">      directoryForIndexes: true</span>
<a id="__codelineno-34-26" name="__codelineno-34-26"></a><span class="s">    collectionConfig:</span>
<a id="__codelineno-34-27" name="__codelineno-34-27"></a><span class="s">      blockCompressor: zlib</span>
<a id="__codelineno-34-28" name="__codelineno-34-28"></a><span class="s">    indexConfig:</span>
<a id="__codelineno-34-29" name="__codelineno-34-29"></a><span class="s">      prefixCompression: true</span>
<a id="__codelineno-34-30" name="__codelineno-34-30"></a><span class="s">processManagement:</span>
<a id="__codelineno-34-31" name="__codelineno-34-31"></a><span class="s">  fork: true</span>
<a id="__codelineno-34-32" name="__codelineno-34-32"></a><span class="s">net:</span>
<a id="__codelineno-34-33" name="__codelineno-34-33"></a><span class="s">  port: 28017</span>
<a id="__codelineno-34-34" name="__codelineno-34-34"></a><span class="s">  bindIp: 10.0.0.51,127.0.0.1</span>
<a id="__codelineno-34-35" name="__codelineno-34-35"></a><span class="s">replication:</span>
<a id="__codelineno-34-36" name="__codelineno-34-36"></a><span class="s">  oplogSizeMB: 2048</span>
<a id="__codelineno-34-37" name="__codelineno-34-37"></a><span class="s">  replSetName: my_repl</span>
<a id="__codelineno-34-38" name="__codelineno-34-38"></a><span class="s">EOF</span>
<a id="__codelineno-34-39" name="__codelineno-34-39"></a><span class="se">\c</span>p<span class="w">  </span>/mongodb/28017/conf/mongod.conf<span class="w">  </span>/mongodb/28018/conf/
<a id="__codelineno-34-40" name="__codelineno-34-40"></a><span class="se">\c</span>p<span class="w">  </span>/mongodb/28017/conf/mongod.conf<span class="w">  </span>/mongodb/28019/conf/
<a id="__codelineno-34-41" name="__codelineno-34-41"></a><span class="se">\c</span>p<span class="w">  </span>/mongodb/28017/conf/mongod.conf<span class="w">  </span>/mongodb/28020/conf/
<a id="__codelineno-34-42" name="__codelineno-34-42"></a>sed<span class="w"> </span><span class="s1">&#39;s#28017#28018#g&#39;</span><span class="w"> </span>/mongodb/28018/conf/mongod.conf<span class="w"> </span>-i
<a id="__codelineno-34-43" name="__codelineno-34-43"></a>sed<span class="w"> </span><span class="s1">&#39;s#28017#28019#g&#39;</span><span class="w"> </span>/mongodb/28019/conf/mongod.conf<span class="w"> </span>-i
<a id="__codelineno-34-44" name="__codelineno-34-44"></a>sed<span class="w"> </span><span class="s1">&#39;s#28017#28020#g&#39;</span><span class="w"> </span>/mongodb/28020/conf/mongod.conf<span class="w"> </span>-i------------------------------------------------------------
<a id="__codelineno-34-45" name="__codelineno-34-45"></a><span class="o">(</span><span class="m">4</span><span class="o">)</span>启动多个实例备用
<a id="__codelineno-34-46" name="__codelineno-34-46"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/28017/conf/mongod.conf
<a id="__codelineno-34-47" name="__codelineno-34-47"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/28018/conf/mongod.conf
<a id="__codelineno-34-48" name="__codelineno-34-48"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/28019/conf/mongod.conf
<a id="__codelineno-34-49" name="__codelineno-34-49"></a>mongod<span class="w"> </span>-f<span class="w"> </span>/mongodb/28020/conf/mongod.conf
</code></pre></div></td></tr></table></div>
<h3 id="配置复制集">配置复制集：<a class="headerlink" href="#配置复制集" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="err">（</span><span class="mf">1</span><span class="err">）</span><span class="mf">1</span><span class="nx">主2从</span><span class="err">，</span><span class="nx">从库普通从库</span><span class="p">(</span><span class="nx">PSS</span><span class="p">)</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;my_repl&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">members</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">  </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10.0.0.51:28017&#39;</span><span class="p">},</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">  </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10.0.0.51:28018&#39;</span><span class="p">},</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">  </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10.0.0.51:28019&#39;</span><span class="p">}]</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="w">         </span><span class="p">}</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">initiate</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="err">（</span><span class="mf">2</span><span class="err">）</span><span class="mf">1</span><span class="nx">主1从1个arbiter</span><span class="p">(</span><span class="nx">PSA</span><span class="p">)</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;my_repl&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">members</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">  </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10.0.0.51:28017&#39;</span><span class="p">},</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">  </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;10.0.0.51:28018&#39;</span><span class="p">},</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="w">  </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="o">:</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">    </span><span class="s1">&#39;10.0.0.51:28019&#39;</span><span class="p">,</span><span class="s2">&quot;arbiterOnly&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">}]</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="w">         </span><span class="p">}</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">initiate</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="复制集测试">复制集测试：<a class="headerlink" href="#复制集测试" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nx">my_repl</span><span class="o">:</span><span class="nx">PRIMARY</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">insert</span><span class="p">([</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Jaws&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1975</span><span class="p">,</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">                                     </span><span class="s2">&quot;imdb_rating&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">8.1</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">                                   </span><span class="p">...</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Batman&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;year&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1989</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;imdb_rating&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">7.6</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">                                   </span><span class="p">...</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="nx">BulkWriteResult</span><span class="p">({</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">  </span><span class="s2">&quot;writeErrors&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">  </span><span class="s2">&quot;writeConcernErrors&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">  </span><span class="s2">&quot;nInserted&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">  </span><span class="s2">&quot;nUpserted&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">  </span><span class="s2">&quot;nMatched&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">  </span><span class="s2">&quot;nModified&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">  </span><span class="s2">&quot;nRemoved&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">  </span><span class="s2">&quot;upserted&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">]</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="p">})</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="nx">my_repl</span><span class="o">:</span><span class="nx">SECONDARY</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">pretty</span><span class="p">();</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="nx">注</span><span class="err">：</span><span class="nx">在mongodb复制集当中</span><span class="err">，</span><span class="nx">默认从库不允许读写</span><span class="err">。</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">slaveOk</span><span class="p">();</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="nx">my_repl</span><span class="o">:</span><span class="nx">SECONDARY</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">pretty</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
<h3 id="复制集管理操作">复制集管理操作：<a class="headerlink" href="#复制集管理操作" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span>
<span class="normal"><a href="#__codelineno-37-24">24</a></span>
<span class="normal"><a href="#__codelineno-37-25">25</a></span>
<span class="normal"><a href="#__codelineno-37-26">26</a></span>
<span class="normal"><a href="#__codelineno-37-27">27</a></span>
<span class="normal"><a href="#__codelineno-37-28">28</a></span>
<span class="normal"><a href="#__codelineno-37-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="err">（</span><span class="mf">1</span><span class="err">）</span><span class="nx">查看复制集状态</span><span class="err">：</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">status</span><span class="p">();</span><span class="w"> </span><span class="c1">//查看整体复制集状态</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">isMaster</span><span class="p">();</span><span class="w"> </span><span class="c1">// 查看当前是否是主节点</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="err">（</span><span class="mf">2</span><span class="err">）</span><span class="nx">添加删除节点</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;ip:port&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 新增从节点</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">addArb</span><span class="p">(</span><span class="s2">&quot;ip:port&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 新增仲裁节点</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;ip:port&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 删除一个节点</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="err">（</span><span class="mf">3</span><span class="err">）</span><span class="nx">特殊从节点的配置</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="err">•</span><span class="w"> </span><span class="nx">优先级</span><span class="err">（</span><span class="nx">priority</span><span class="w"> </span><span class="nx">参数</span><span class="err">：</span><span class="mf">0</span><span class="o">-</span><span class="mf">1000</span><span class="err">）：</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="nx">优先级越高的节点越优先成为主节点</span><span class="err">。</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="nx">优先级为0的节点无法成为主节点</span><span class="err">；</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="err">•</span><span class="w"> </span><span class="nx">隐藏</span><span class="err">（</span><span class="nx">hidden</span><span class="w"> </span><span class="nx">参数</span><span class="err">）：</span><span class="nx">复制数据</span><span class="err">，</span><span class="nx">但对应用不可见</span><span class="err">。</span><span class="nx">隐藏节点可以具有投票仅</span><span class="err">，</span><span class="nx">但优先级必须为</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="mf">0</span><span class="err">；</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="err">•</span><span class="w"> </span><span class="nx">延迟</span><span class="err">（</span><span class="nx">slaveDelay</span><span class="w"> </span><span class="nx">参数</span><span class="err">）：</span><span class="nx">复制</span><span class="w"> </span><span class="nx">n</span><span class="w"> </span><span class="nx">秒之前的数据</span><span class="err">，</span><span class="nx">保持与主节点的时间差</span><span class="err">。</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="nx">配置延时节点</span><span class="err">（</span><span class="nx">一般延时节点也配置成hidden</span><span class="err">）</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="nx">cfg</span><span class="o">=</span><span class="nx">rs</span><span class="p">.</span><span class="nx">conf</span><span class="p">()</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="nx">cfg</span><span class="p">.</span><span class="nx">members</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">priority</span><span class="o">=</span><span class="mf">0</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="nx">cfg</span><span class="p">.</span><span class="nx">members</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">slaveDelay</span><span class="o">=</span><span class="mf">120</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="nx">cfg</span><span class="p">.</span><span class="nx">members</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">hidden</span><span class="o">=</span><span class="kc">true</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">reconfig</span><span class="p">(</span><span class="nx">cfg</span><span class="p">)</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="nx">改回来</span><span class="err">：</span>
<a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="nx">cfg</span><span class="o">=</span><span class="nx">rs</span><span class="p">.</span><span class="nx">conf</span><span class="p">()</span>
<a id="__codelineno-37-23" name="__codelineno-37-23"></a><span class="nx">cfg</span><span class="p">.</span><span class="nx">members</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nx">priority</span><span class="o">=</span><span class="mf">1</span>
<a id="__codelineno-37-24" name="__codelineno-37-24"></a><span class="nx">cfg</span><span class="p">.</span><span class="nx">members</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nx">slaveDelay</span><span class="o">=</span><span class="mf">0</span>
<a id="__codelineno-37-25" name="__codelineno-37-25"></a><span class="nx">cfg</span><span class="p">.</span><span class="nx">members</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nx">hidden</span><span class="o">=</span><span class="mf">0</span>
<a id="__codelineno-37-26" name="__codelineno-37-26"></a><span class="nx">cfg</span><span class="p">.</span><span class="nx">members</span><span class="p">[</span><span class="mf">2</span><span class="p">].</span><span class="nx">votes</span><span class="o">=</span><span class="mf">0</span>
<a id="__codelineno-37-27" name="__codelineno-37-27"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">reconfig</span><span class="p">(</span><span class="nx">cfg</span><span class="p">)</span>
<a id="__codelineno-37-28" name="__codelineno-37-28"></a><span class="nx">配置成功后</span><span class="err">，</span><span class="nx">通过以下命令查询配置后的属性</span>
<a id="__codelineno-37-29" name="__codelineno-37-29"></a><span class="nx">rs</span><span class="p">.</span><span class="nx">conf</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
<h3 id="副本集其他操作命令">副本集其他操作命令：<a class="headerlink" href="#副本集其他操作命令" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JavaScript</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span>
<span class="normal"><a href="#__codelineno-38-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="o">--</span><span class="nx">查看副本集的配置信息</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="nx">admin</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">config</span><span class="p">()</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="o">--</span><span class="nx">查看副本集各成员的状态</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="nx">admin</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">status</span><span class="p">()</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="o">--</span><span class="nx">副本集角色切换</span><span class="err">（</span><span class="nx">不要人为顺便操作</span><span class="err">，</span><span class="nx">有风险</span><span class="err">）</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="nx">admin</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">stepDown</span><span class="p">()</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="nx">注</span><span class="err">：</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="nx">admin</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">freeze</span><span class="p">(</span><span class="mf">300</span><span class="p">)</span><span class="w"> </span><span class="c1">//锁定从，使其不会转变成主库</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="nx">freeze</span><span class="p">()</span><span class="nx">和stepDown单位都是秒</span><span class="err">。</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="o">--</span><span class="nx">设置副本节点可读</span><span class="err">：</span><span class="nx">在副本节点执行</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="nx">admin</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">slaveOk</span><span class="p">()</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="nx">eg</span><span class="err">：</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="nx">admin</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">app</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a><span class="nx">switched</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">db</span><span class="w"> </span><span class="nx">app</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="nx">app</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">createCollection</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="p">{</span><span class="w"> </span><span class="s2">&quot;ok&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;errmsg&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;not master&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;code&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">10107</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="o">--</span><span class="nx">查看副本节点</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a><span class="nx">admin</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">rs</span><span class="p">.</span><span class="nx">printSlaveReplicationInfo</span><span class="p">()</span>
<a id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="mf">192.168.1.22</span><span class="o">:</span><span class="mf">27017</span>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="w">  </span><span class="nx">syncedTo</span><span class="o">:</span><span class="w"> </span><span class="nx">Thu</span><span class="w"> </span><span class="nx">May</span><span class="w"> </span><span class="mf">26</span><span class="w"> </span><span class="mf">2016</span><span class="w"> </span><span class="mf">10</span><span class="o">:</span><span class="mf">28</span><span class="o">:</span><span class="mf">56</span><span class="w"> </span><span class="nx">GMT</span><span class="o">+</span><span class="mf">0800</span><span class="w"> </span><span class="p">(</span><span class="nx">CST</span><span class="p">)</span>
<a id="__codelineno-38-21" name="__codelineno-38-21"></a><span class="w">  </span><span class="mf">0</span><span class="w"> </span><span class="nx">secs</span><span class="w"> </span><span class="p">(</span><span class="mf">0</span><span class="w"> </span><span class="nx">hrs</span><span class="p">)</span><span class="w"> </span><span class="nx">behind</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">primary</span>
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../MongoDB%20%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB/" class="md-footer__link md-footer__link--prev" aria-label="上一页: MongoDB 数据一致性和隔离">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                MongoDB 数据一致性和隔离
              </div>
            </div>
          </a>
        
        
          
          <a href="../Mongodb%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" class="md-footer__link md-footer__link--next" aria-label="下一页: Mongodb高级运维笔记">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Mongodb高级运维笔记
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 李烨栋
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["header.autohide", "announce.dismiss", "navigation.instant", "navigation.tracking", "content.code.annotate", "toc.integrate", "toc.follow", "navigation.path", "navigation.top", "navigation.tabs", "navigation.prune", "navigation.footer", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "content.code.copy", "navigation.indexes", "search.share", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>