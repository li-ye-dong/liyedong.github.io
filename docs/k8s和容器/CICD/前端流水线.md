ä¸‹é¢æ˜¯é€‚ç”¨äºå…¸å‹**å‰ç«¯é¡¹ç›®ï¼ˆå¦‚ Vue / React / Vite ç­‰ï¼‰**çš„ Dockerfile æ¨¡æ¿ï¼Œé‡‡ç”¨ **å¤šé˜¶æ®µæ„å»º**ï¼Œå°†æ„å»ºäº§ç‰©æ‰“åŒ…è¿›è½»é‡çº§ Nginx é•œåƒï¼Œé€‚åˆç”¨äºéƒ¨ç½²ç”Ÿäº§ç¯å¢ƒã€‚

---

## âœ… é€šç”¨å‰ç«¯é¡¹ç›® Dockerfileï¼ˆæ”¯æŒ Vue / React / Viteï¼‰
```dockerfile
# ===== ç¬¬ä¸€æ­¥ï¼šæ„å»ºé˜¶æ®µ =====
FROM node:20-alpine AS builder

# è®¾ç½®ä¸­å›½ npm é•œåƒæºï¼ˆåŠ é€Ÿä¾èµ–å®‰è£…ï¼‰
RUN npm config set registry https://registry.npmmirror.com

WORKDIR /app

# å¤åˆ¶ package ç›¸å…³æ–‡ä»¶å¹¶å®‰è£…ä¾èµ–ï¼ˆåˆ†æ­¥ç¼“å­˜ï¼‰
COPY package*.json ./
RUN npm install

# å¤åˆ¶é¡¹ç›®æºç å¹¶æ„å»º
COPY . .
RUN npm run build

# ===== ç¬¬äºŒæ­¥ï¼šç”Ÿäº§ç¯å¢ƒé•œåƒï¼Œç”¨ Nginx æ‰˜ç®¡ =====
FROM nginx:1.25-alpine

# å¯é€‰ï¼šä½¿ç”¨è‡ªå®šä¹‰ Nginx é…ç½®ï¼ˆæ›¿æ¢é»˜è®¤é…ç½®ï¼‰
# COPY nginx.conf /etc/nginx/nginx.conf

# åˆ é™¤é»˜è®¤é¡µé¢
RUN rm -rf /usr/share/nginx/html/*

# å¤åˆ¶æ„å»ºäº§ç‰©åˆ° Nginx çš„ html ç›®å½•  reactæ˜¯buildç›®å½•ï¼Œå°†distä¿®æ”¹æˆbuild
COPY --from=builder /app/dist /usr/share/nginx/html

# å¼€æ”¾ç«¯å£
EXPOSE 80

# å¯åŠ¨ Nginxï¼ˆå¯é€‰ä¼˜åŒ–ï¼šåŠ ä¸Š daemon offï¼‰
CMD ["nginx", "-g", "daemon off;"]
```

---

## â˜‘ï¸ nginx.confï¼ˆå¯é€‰ï¼šè‡ªå®šä¹‰ Nginx é…ç½®ï¼‰
å¦‚æœä½ æƒ³è®©å‰ç«¯è·¯ç”±å…¨éƒ¨ç”± `index.html` å¤„ç†ï¼ˆç”¨äº history æ¨¡å¼ï¼‰ï¼Œå¯æ·»åŠ å¦‚ä¸‹ `nginx.conf` å¹¶æŒ‚è½½ï¼š

```nginx
server {
    listen 80;
    server_name ${NGINX_SERVER_NAME:-localhost};  # é»˜è®¤å€¼ä¸º localhost

    location / {
        root /opt/vue-fastapi-admin/web/dist;
        index index.html index.htm;
        try_files $uri /index.html;
    }

    location /api/ {
        proxy_pass http://localhost:9999/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /docs {
        proxy_pass http://localhost:9999/docs;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /openapi.json {
        proxy_pass http://localhost:9999/openapi.json;
    }
}

```

ä½¿ç”¨æ—¶ï¼š

```dockerfile
COPY nginx.conf /etc/nginx/conf.d/default.conf
```

---

## ğŸ“Œ å¸¸è§é€‚é…è¯´æ˜
| æ¡†æ¶ | æ„å»ºå‘½ä»¤ | æ„å»ºäº§ç‰©ç›®å½• |
| --- | --- | --- |
| Vue 2/3 | `npm run build` | `/dist` |
| React | `npm run build` | `/build` |
| Vite | `npm run build` | `/dist` |


å¦‚æœæ˜¯ React é¡¹ç›®ï¼Œè¯·æŠŠ `COPY --from=builder /app/build /usr/share/nginx/html` å†™æˆå¯¹åº”çš„è·¯å¾„ã€‚

---

## ğŸ§ª æ„å»ºä¸è¿è¡Œç¤ºä¾‹
```bash
docker build -t my-frontend-app .
docker run -d -p 80:80 my-frontend-app
```

---

## ğŸš€ è‹¥éƒ¨ç½²åˆ° Harbor ç§æœ‰ä»“åº“
ä½ å¯ä»¥åœ¨ Dockerfile ä¸­æ›¿æ¢åŸºç¡€é•œåƒï¼Œä¾‹å¦‚ï¼š

```dockerfile
FROM harbor.liyedong.com/base/node:20-alpine AS builder
FROM harbor.liyedong.com/base/nginx:1.25-alpine
```

