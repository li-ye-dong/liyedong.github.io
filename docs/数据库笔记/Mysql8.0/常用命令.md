å¥½çš„ï¼æ¥ï¼Œæˆ‘åˆ†åˆ«ç»™ä½ æ•´ç†å¥½ï¼š

---

# ğŸ“Š MySQL å¤åˆ¶æ‹“æ‰‘å›¾ & InnoDB Clusterç»“æ„å›¾ï¼ˆç®€æ´ç‰ˆï¼‰
## 1. ç»å…¸ä¸»ä»å¤åˆ¶æ‹“æ‰‘å›¾ï¼ˆMaster-Replicaï¼‰
```plain
+----------------+            +----------------+
|    Primary     |    --->    |     Replica     |
|  (Master Node) | å¤åˆ¶æ•°æ®åˆ° | (Slave Node)     |
+----------------+            +----------------+
```

**ç‰¹ç‚¹ï¼š**

+ ä¸»åº“å†™å…¥ï¼Œå¤åˆ¶åˆ°ä»åº“ã€‚
+ å¼‚æ­¥/åŠåŒæ­¥ä»»é€‰ã€‚
+ ä»åº“å¯ä»¥è¯»è¯·æ±‚ï¼Œå‡è½»ä¸»åº“å‹åŠ›ã€‚

---

## 2. InnoDB Cluster é«˜å¯ç”¨æ‹“æ‰‘å›¾ï¼ˆGroup Replicationï¼‰
```plain
          +------------------+
          |    MySQL Router  |
          +--------+---------+
                   |
        +----------+-----------+
        |          |           |
+-------+--+ +-----+------+ +---+-------+
|  Node1   | |  Node2     | |  Node3    |
| (Primary)| | (Secondary)| | (Secondary)|
+----------+ +------------+ +------------+
         (Group Replication è‡ªåŠ¨åŒæ­¥)
```

**ç‰¹ç‚¹ï¼š**

+ Routerè´Ÿè´£è¿æ¥åˆ†å‘ï¼Œåº”ç”¨æ— æ„ŸçŸ¥ã€‚
+ èŠ‚ç‚¹ä¹‹é—´ç»„å¤åˆ¶ï¼Œæ•…éšœè‡ªåŠ¨è½¬ç§»ã€‚
+ æ”¯æŒè¯»å†™åˆ†ç¦»ã€æ¨ªå‘æ‰©å±•ã€‚

---

# ğŸ› ï¸ MySQL å¸¸ç”¨å‘½ä»¤æ‰‹å†Œï¼ˆé€ŸæŸ¥ç‰ˆï¼‰
## ä¸€ã€æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨ MySQL
sudo systemctl start mysqld

# åœæ­¢ MySQL
sudo systemctl stop mysqld

# é‡å¯ MySQL
sudo systemctl restart mysqld

# æŸ¥çœ‹ MySQL æœåŠ¡çŠ¶æ€
sudo systemctl status mysqld
```

---

## äºŒã€ç”¨æˆ·å’Œæƒé™ç®¡ç†
```sql
-- åˆ›å»ºç”¨æˆ·
CREATE USER 'user'@'host' IDENTIFIED BY 'password';

-- æˆæƒ
GRANT ALL PRIVILEGES ON database.* TO 'user'@'host';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- ä¿®æ”¹å¯†ç 
ALTER USER 'user'@'host' IDENTIFIED BY 'new_password';

-- åˆ é™¤ç”¨æˆ·
DROP USER 'user'@'host';
```

---

## ä¸‰ã€ä¸»ä»å¤åˆ¶ç®¡ç†
```sql
-- ä¸»åº“æŸ¥çœ‹ binlog ä½ç½®
SHOW MASTER STATUS;

-- ä»åº“é…ç½®å¤åˆ¶
CHANGE MASTER TO MASTER_HOST='ip', MASTER_USER='repl', MASTER_PASSWORD='pwd', MASTER_AUTO_POSITION=1;

-- å¯åŠ¨å¤åˆ¶
START SLAVE;

-- åœæ­¢å¤åˆ¶
STOP SLAVE;

-- æŸ¥çœ‹å¤åˆ¶çŠ¶æ€
SHOW SLAVE STATUS\G;
```

---

## å››ã€å¤‡ä»½ä¸æ¢å¤
```bash
# ä½¿ç”¨mysqldumpå¤‡ä»½
mysqldump -uroot -p dbname > backup.sql

# æ¢å¤æ•°æ®åº“
mysql -uroot -p dbname < backup.sql
```

---

## äº”ã€æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜
```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SHOW VARIABLES LIKE 'slow_query_log%';

-- æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';

-- æŸ¥è¯¢å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';

-- æŸ¥è¯¢æ•°æ®åº“å¤§å°
SELECT table_schema, 
       ROUND(SUM(data_length+index_length)/1024/1024, 2) AS 'DB Size (MB)'
FROM information_schema.tables 
GROUP BY table_schema;
```

---

## å…­ã€InnoDB Cluster ç®¡ç†å‘½ä»¤ï¼ˆmysqlshå·¥å…·ï¼‰
```bash
# ç™»å½•
mysqlsh root@localhost

# åˆ›å»ºé›†ç¾¤
dba.createCluster('myCluster')

# åŠ èŠ‚ç‚¹
cluster = dba.getCluster('myCluster')
cluster.addInstance('root@node2_ip')
cluster.addInstance('root@node3_ip')

# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
cluster.status()

# ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹
cluster.removeInstance('root@node_ip')
```

---

# âœ¨ è¡¥å……å°å»ºè®®
+ å¤åˆ¶éƒ¨ç½²ä¼˜å…ˆä½¿ç”¨ GTID æ¨¡å¼
+ æ—¥å¿—æ ¼å¼ä¼˜å…ˆä½¿ç”¨ ROW
+ ä»åº“å¯ç”¨åªè¯»æ¨¡å¼ï¼ˆread_only=1ï¼‰
+ å®šæœŸåšå…¨å¤‡ + binlog å¢é‡å¤‡ä»½
+ InnoDB Clusteréƒ¨ç½²åï¼Œåº”ç”¨å±‚å¿…é¡»èµ° MySQL Router

---

âœ… **è¿™ä¸¤ä»½èµ„æ–™å…¨éƒ¨æ‰“åŒ…å¥½äº†ï¼**

å¦‚æœéœ€è¦ï¼Œæˆ‘è¿˜èƒ½æŠŠä¸Šé¢è¿™äº›ï¼š

+ è¾“å‡ºæˆ Markdown æ ¼å¼ï¼ˆé€‚åˆä½ è‡ªå·±ç»§ç»­æ•´ç†æˆ–å½’æ¡£ï¼‰
+ æˆ–è€…ç›´æ¥æ‰“åŒ…æˆ PDF æ–‡ä»¶ï¼ˆæ–¹ä¾¿å¸¦èµ°ï¼‰

è¦çš„è¯ç›´æ¥å‘Šè¯‰æˆ‘è¦å“ªç§æ ¼å¼å“ˆï¼ğŸ¯  
è¦ä¸è¦ä¸€èµ·é¡ºä¾¿è¡¥å……ä¸€ä¸ª"è€ƒè¯•é¢˜åº“ç‰ˆ"ï¼Ÿæ¯”å¦‚å¤ä¹ å°æµ‹è¯•é¢˜ç›®åˆé›†ï¼ŸğŸ‘€  
è¦çš„è¯æˆ‘ä¹Ÿå¯ä»¥ä¸€å¹¶ç»™ä½ ï¼

