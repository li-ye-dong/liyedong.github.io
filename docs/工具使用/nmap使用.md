# nmap使用
### **端口联通常用 Nmap 端口扫描命令**
#### **1. 全端口 TCP 扫描**
```powershell
nmap -p 1-65535 -sS -T4 <目标IP>
```

**说明：**

+ `-p 1-65535`：扫描所有 65535 个端口。
+ `-sS`：使用 TCP SYN（半开）扫描，适用于检测防火墙后端口是否开放。
+ `-T4`：设定扫描速度（T0-T5，T4 适中，适用于大部分场景）。

---

#### **2. 全端口 UDP 扫描**
```powershell
nmap -p 1-65535 -sU -T4 <目标IP>
```

**说明：**

+ `-sU`：使用 UDP 扫描，适用于检测 DNS（53）、SNMP（161）等 UDP 服务。
+ 由于 UDP 无连接特性，扫描速度较慢，可搭配 `-T4` 加速。

---

#### **3. TCP+UDP 综合扫描**
```powershell
nmap -p 1-65535 -sS -sU -T4 <目标IP>
```

**说明：**

+ `-sS` 和 `-sU` 组合，进行 TCP 和 UDP 全端口扫描。

---

#### **4. 仅扫描常见端口**
```powershell
nmap -F <目标IP>
```

**说明：**

+ `-F`：快速扫描，仅扫描最常见的 100 个端口。

---

#### **5. 扫描指定端口**
```powershell
nmap -p 22,80,443 -sS <目标IP>
```

**说明：**

+ `-p 22,80,443`：只扫描 SSH（22）、HTTP（80）、HTTPS（443）。

---

#### **6. 检测开放端口及服务版本**
```powershell
nmap -sV -p 1-65535 <目标IP>
```

**说明：**

+ `-sV`：检测端口的服务及版本信息。

---

#### **7. 检测开放端口、操作系统、服务及 traceroute**
```powershell
nmap -A -T4 <目标IP>
```

**说明：**

+ `-A`：启用 OS 识别、版本检测、脚本扫描和 traceroute。

---

#### **8. 规避防火墙的隐蔽扫描**
```powershell
nmap -sS -Pn -f -D RND:10 <目标IP>
```

**说明：**

+ `-Pn`：跳过 Ping 发现，直接扫描端口（适用于主机屏蔽 ICMP）。
+ `-f`：分片发送数据包，绕过部分防火墙。
+ `-D RND:10`：使用 10 个随机 Decoy（伪装）IP 进行扫描，隐藏真实来源。

### **其他场景常用 Nmap 扫描**
Nmap 不仅用于端口扫描，还能用于漏洞检测、内网渗透、网络排查等场景。以下是一些常见的应用场景及命令：

---

#### **1. 网络存活主机探测**
**场景：** 扫描某个网段，查看哪些主机在线。

```powershell
nmap -sn 192.168.1.0/24
```

**说明：**

+ `-sn`：仅进行主机发现，不进行端口扫描。
+ `192.168.1.0/24`：扫描整个 C 段（254 个 IP）。

---

#### **2. 扫描目标的操作系统**
**场景：** 需要判断目标主机运行的操作系统版本。

```powershell
nmap -O <目标IP>
```

**说明：**

+ `-O`：启用操作系统检测（需要管理员权限）。
+ `--osscan-guess`：如果 OS 识别度较低，可尝试更激进的猜测。

---

#### **3. 扫描目标服务及版本**
**场景：** 检测服务器运行的服务及版本号，有助于查找漏洞。

```powershell
nmap -sV <目标IP>
```

**说明：**

+ `-sV`：检测端口对应的服务和版本信息。

---

#### **4. 查找特定服务**
**场景：** 只想查找特定服务（如 FTP、HTTP、MySQL）。

```powershell
nmap -p 21,22,80,443,3306 -sV <目标IP>
```

**说明：**

+ `-p 21,22,80,443,3306`：扫描 FTP（21）、SSH（22）、HTTP（80）、HTTPS（443）、MySQL（3306）。
+ `-sV`：获取服务版本信息。

---

#### **5. 查找所有开启的端口**
**场景：** 查找目标主机上所有开放的端口。

```powershell
nmap -p- <目标IP>
```

**说明：**

+ `-p-`：扫描所有 65535 个端口。

---

#### **6. 绕过防火墙进行扫描**
**场景：** 目标主机有防火墙，普通扫描被阻挡。

```powershell
nmap -sS -Pn -f -D RND:10 <目标IP>
```

**说明：**

+ `-sS`：TCP SYN 半开扫描，隐蔽性强。
+ `-Pn`：跳过 Ping 探测，直接扫描端口（防止 ICMP 被屏蔽）。
+ `-f`：分片扫描，绕过部分防火墙。
+ `-D RND:10`：使用 10 个随机 Decoy IP 伪装来源。

---

#### **7. 内网 SMB 共享扫描**
**场景：** 查找局域网内所有开放 SMB（445）服务的主机。

```powershell
nmap -p 445 --open -sV 192.168.1.0/24
```

**说明：**

+ `-p 445`：扫描 SMB 端口。
+ `--open`：只显示开放的端口。
+ `-sV`：检测服务版本。

---

#### **8. Web 服务器漏洞探测**
**场景：** 检测 Web 服务器的漏洞和安全配置。

```powershell
nmap --script=http-vuln* -p 80,443 <目标IP>
```

**说明：**

+ `--script=http-vuln*`：使用 Nmap 的 NSE 脚本扫描 HTTP 相关漏洞。
+ `-p 80,443`：扫描 HTTP 和 HTTPS 端口。

---

#### **9. 探测 SQL 服务器（MySQL、PostgreSQL）**
**场景：** 查找局域网或公网的数据库服务器。

```powershell
nmap -p 3306,5432 --open -sV 192.168.1.0/24
```

**说明：**

+ `-p 3306,5432`：扫描 MySQL（3306）、PostgreSQL（5432）。
+ `--open`：只显示开放的端口。
+ `-sV`：检测服务版本。

---

#### **10. 扫描目标是否存在已知漏洞**
**场景：** 利用 NSE（Nmap Scripting Engine）检查目标是否有漏洞。

```powershell
nmap --script=vuln <目标IP>
```

**说明：**

+ `--script=vuln`：使用 Nmap 的漏洞扫描脚本（如 MS17-010）。

---

#### **11. 获取目标的路由追踪信息**
**场景：** 检测目标 IP 的网络路径信息（类似 `traceroute`）。

```powershell
nmap --traceroute <目标IP>
```

**说明：**

+ `--traceroute`：显示目标的路由路径。

---

#### **12. 检查开放的 RDP 端口（Windows 远程桌面）**
**场景：** 查找哪些服务器开放了 RDP（3389）。

```powershell
nmap -p 3389 --open -sV 192.168.1.0/24
```

**说明：**

+ `-p 3389`：扫描 Windows 远程桌面端口。
+ `--open`：只显示开放端口的主机。

---

#### **13. 探测 IoT 设备（如摄像头）**
**场景：** 查找智能设备（如摄像头、路由器）的开放端口。

```powershell
nmap -p 23,80,554,8080 --open -sV 192.168.1.0/24
```

**说明：**

+ `-p 23,80,554,8080`：扫描 Telnet（23）、HTTP（80）、RTSP（554）、Web 管理（8080）。
+ `--open`：只显示开放端口的设备。

---

#### **14. 探测 SMTP 邮件服务器**
**场景：** 检查邮件服务器是否存在开放的 SMTP 端口（如 25、587）。

```powershell
nmap -p 25,587 --open -sV <目标IP>
```

**说明：**

+ `-p 25,587`：扫描 SMTP 端口。
+ `--open`：只显示开放端口的主机。

---

#### **15. 全面扫描（适用于渗透测试）**
**场景：** 对目标进行全面信息收集（端口、服务、OS、漏洞）。

```powershell
nmap -A -T4 -p- <目标IP>
```

**说明：**

+ `-A`：启用操作系统检测、版本探测、脚本扫描、路由追踪。
+ `-T4`：加快扫描速度。
+ `-p-`：扫描所有 65535 端口。

---

#### **总结**
Nmap 是非常强大的网络扫描工具，可以用于各种场景，包括：

+ **网络安全检测**（检测开放端口、漏洞扫描）。
+ **内网渗透**（扫描存活主机、查找 SMB/RDP）。
+ **Web 应用测试**（扫描 Web 服务器漏洞）。
+ **数据库安全**（查找 MySQL、PostgreSQL 服务器）。
+ **设备探测**（扫描 IoT 设备、路由器、摄像头）。
+ **应急响应**（快速排查服务器端口开放情况）。



