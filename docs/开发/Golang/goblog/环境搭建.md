

## 拉取镜像
```bash
docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/redis:8.2.0
docker tag  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/redis:8.2.0  docker.io/redis:8.2.0
docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/mysql:9.3.0
docker tag  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/mysql:9.3.0  docker.io/mysql:9.3.0
docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/elasticsearch:8.17.6
docker tag  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/elasticsearch:8.17.6  docker.io/library/elasticsearch:8.17.6
```



## 创建数据目录
```bash
mkdir -p /u01/docker/mysql/data
mkdir -p /u01/docker/mysql/conf
mkdir -p /u01/docker/mysql/logs

mkdir -p /u01/docker/elasticsearch/data
mkdir -p /u01/docker/elasticsearch/logs
mkdir -p /u01/docker/elasticsearch/plugins

mkdir -p /u01/docker/redis/data

```

##  docker-compose.yml  
```yaml
tee /u01/docker/docker-compose.yml <<EOF
version: '3.9'

services:
  mysql:
    image: mysql:9.3.0
    container_name: mysql
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: blog_db
    volumes:
      - /u01/docker/mysql/data:/var/lib/mysql
      - /u01/docker/mysql/conf:/etc/mysql/conf.d
      - /u01/docker/mysql/logs:/var/log/mysql

  elasticsearch:
    image: elasticsearch:8.17.6
    container_name: es
    restart: always
    ports:
      - "9200:9200"
    environment:
      discovery.type: single-node
      xpack.security.http.ssl.enabled: "false"
      xpack.license.self_generated.type: trial
      xpack.security.enabled: "true"   #false没有密码
      ELASTIC_PASSWORD: "elastic"   # ✅ 指定 elastic 用户的初始密码
      ES_JAVA_OPTS: "-Xms512m -Xmx512m"
    volumes:
      - /u01/docker/elasticsearch/data:/usr/share/elasticsearch/data
      - /u01/docker/elasticsearch/logs:/usr/share/elasticsearch/logs
      - /u01/docker/elasticsearch/plugins:/usr/share/elasticsearch/plugins

  redis:
    image: redis:8.2.0
    container_name: redis
    restart: always
    ports:
      - "6379:6379"
    volumes:
      - /u01/docker/redis/data:/data
      - /u01/docker/redis/redis.conf:/usr/local/etc/redis/redis.conf
    command: ["redis-server", "/usr/local/etc/redis/redis.conf"]

EOF
```

## 创建配置文件和授权
```bash
chown -R 1000:1000 /u01/docker/elasticsearch
tee /u01/docker/mysql/conf/my.cnf <<EOF
[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_general_ci
EOF
tee /u01/docker/redis/redis.conf <<EOF
appendonly yes
save 60 1000
requirepass redis
EOF
```

## 启动
```bash
cd /u01/docker
docker compose up -d
```

## 检查
```bash
docker ps
docker exec -it mysql mysql -uroot -proot -e "SHOW DATABASES;"
curl 127.0.0.1:9200
docker exec -it redis redis-cli ping
```

## 4️⃣ 验证数据持久化（重点）
1. 向 MySQL 插入一条数据 / 向 Redis set 一个 key / 向 ES 建一个索引。
2. 停掉容器：

```plain
docker compose down
```

3. 再次启动：

```plain
docker compose up -d
```

4. 重新查询，看数据是否还在。  
👉 如果还在，说明 `/u01/docker/...` 的挂载生效，数据存到了你的数据盘。

