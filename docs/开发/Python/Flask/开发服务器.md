<font style="color:rgb(62, 67, 73);">Flask 提供了一个 </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">run</font>`<font style="color:rgb(62, 67, 73);"> 命令，该命令用来以开发服务器运行应用。在调试 模式模式下，开发服务器提供交互式调试器，并在代码更改时重新加载。</font>

<font style="color:rgb(62, 67, 73);background-color:rgb(250, 250, 250);">Warning</font>

<font style="color:rgb(62, 67, 73);background-color:rgb(250, 250, 250);">生产环境不要使用开发服务器。开发服务器仅供在本地开发期间使用，它 在效率、稳定或安全方面是缺失的。</font>

<font style="color:rgb(62, 67, 73);background-color:rgb(250, 250, 250);">有关部署选项，请参阅</font><font style="color:rgb(62, 67, 73);background-color:rgb(250, 250, 250);"> </font>[<font style="color:rgb(62, 67, 73);background-color:rgb(250, 250, 250);">生产部署</font>](https://dormousehole.readthedocs.io/en/2.3.2/deploying/index.html)<font style="color:rgb(62, 67, 73);background-color:rgb(250, 250, 250);"> </font><font style="color:rgb(62, 67, 73);background-color:rgb(250, 250, 250);">。</font>

## <font style="color:black;">通过命令行使用开发服务器</font>
<font style="color:rgb(62, 67, 73);">推荐使用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">flask</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">run</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">命令行脚本运行开发服务器。使用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">--app</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">选项 指向你的应用，使用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">--debug</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">选项打开调试模式。</font>

```python
$ flask --app hello run --debug
```

<font style="color:rgb(62, 67, 73);">这样就启动了开发环境，包括交互调试器和重载器，并在</font><font style="color:rgb(62, 67, 73);"> </font>[<font style="color:rgb(62, 67, 73);">http://localhost:5000/</font>](http://localhost:5000/)<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">提供服务。使用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">flask</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">run</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">--help</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">命令可以查 看可用的选项，</font><font style="color:rgb(62, 67, 73);"> </font>[<font style="color:rgb(62, 67, 73);">命令行接口</font>](https://dormousehole.readthedocs.io/en/2.3.2/cli.html)<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">提供了关于配置和使用 CLI 的详细介绍。</font>

### <font style="color:black;">地址已被占用</font>
<font style="color:rgb(62, 67, 73);">如果其他程序已经占用了 5000 端口，那么当服务器启动时会看到一个类似以 下的</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">OSError</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">信息：</font>

+ `<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">OSError:</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">[Errno</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">98]</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">Address</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">already</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">in</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">use</font>`
+ `<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">OSError:</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">[WinError</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">10013]</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">An</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">attempt</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">was</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">made</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">to</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">access</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">a</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">socket</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">in</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">a</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">way</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">forbidden</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">by</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">its</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">access</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">permissions</font>`

<font style="color:rgb(62, 67, 73);">解决这个问题有两个方法：要么找到并停止使用这个端口的其他程序，要么使 用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">flask</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">run</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">--port</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">5001</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">来修改您自己的端口。</font>

<font style="color:rgb(62, 67, 73);">您可以使用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">netstat</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">或者</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">lsof</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">来找到占用端口的进程，并使用系统 工具来停止该进程。下面的例子展示进程 id 6847 占用了 5000 端口。</font>

`**<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">netstat</font>**`**<font style="color:rgb(29, 92, 135);background-color:#FFFFFF;"> </font>****<font style="color:rgb(29, 92, 135);background-color:#FFFFFF;">(Linux)</font>**`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">lsof</font>`<font style="color:rgb(29, 92, 135);"> </font><font style="color:rgb(29, 92, 135);">(macOS / Linux)</font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">netstat</font>`<font style="color:rgb(29, 92, 135);"> </font><font style="color:rgb(29, 92, 135);">(Windows)</font>

```python
$ netstat -nlp | grep 5000
tcp 0 0 127.0.0.1:5000 0.0.0.0:* LISTEN 6847/python
```

<font style="color:rgb(62, 67, 73);">macOS Monterey 及更新的版本会自动启动一个占用 5000 端口的服务。要停用 这个服务的话，请进入系统设置、通用，然后停用“接力”。</font>

### <font style="color:black;">重载时的延迟错误</font>
<font style="color:rgb(62, 67, 73);">当重加载器使用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">flask</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">run</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">命令时，服务器将持续运行。哪怕您在代码中 引入了语法错误或其他初始化错误。访问网站时会交互式调试器中显示错误， 而不是使服务器崩溃。</font>

<font style="color:rgb(62, 67, 73);">如果在调用</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">flask</font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);"> </font><font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">run</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">时已经存在语法错误，它将立即失败并显示回溯， 而不是等到网站被访问。 这是为了使错误最初更明显同时仍然允许服务器在重 新加载时处理错误。</font>

## <font style="color:black;">通过代码使用开发服务器</font>
<font style="color:rgb(62, 67, 73);">开发服务器也可以在 Python 中通过</font><font style="color:rgb(62, 67, 73);"> </font>[<font style="color:rgb(62, 67, 73);">Flask.run()</font>](https://dormousehole.readthedocs.io/en/2.3.2/api.html#flask.Flask.run)<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">方法启动。这个方法 接受的参数与 CLI 的相似。主要的不同是重新加载时如果有错误，服务器会崩 溃。</font><font style="color:rgb(62, 67, 73);"> </font>`<font style="color:rgb(34, 34, 34);background-color:rgb(232, 239, 240);">debug=True</font>`<font style="color:rgb(62, 67, 73);"> </font><font style="color:rgb(62, 67, 73);">参数可以开启调试器。</font>

<font style="color:rgb(62, 67, 73);">应当把调用放在 main 代码块中，否则当以后在生产环境中导入和运行应用时 会产生干扰。</font>

```python
if __name__ == "__main__":
    app.run(debug=True)
```

<font style="color:rgb(62, 67, 73);background-color:rgb(248, 248, 248);">$ python hello.py</font>

