### 使用 `robocopy` 复制文件并附带权限：
`robocopy` 是 Windows 系统中更强大的文件复制工具，具有更多的选项。

#### 示例命令：
```powershell
robocopy "源路径" "目标路径" /E /COPYALL /R:0 /NFL /NDL /LOG:"日志文件路径"
```

#### 选项说明：
+ `"源路径"`：指定源文件夹路径。
+ `"目标路径"`：指定目标文件夹路径。
+ `/E`：复制子目录，包括空的子目录。
+ `/COPYALL`：复制所有文件属性，包括权限。
+ `/R:0`：设置重试次数为 0，避免因权限错误而导致重试。
+ `/NFL`：不列出文件名。
+ `/NDL`：不列出目录名。
+ `/LOG:`：指定日志文件路径，可以记录操作过程。



如果你想在 **权限复制失败时仍然复制文件**，可以调整 `robocopy` 的参数，避免因权限报错而中断操作，同时保证文件能够正常迁移。以下是可行的方法：

---

### 1. **调整 **`**COPY:DAT**`** 参数**
当 `/COPYALL`（复制所有属性）引发权限错误时，可以使用 `/COPY:DAT` 参数，仅复制文件的数据（Data）、时间戳（Attributes 和 Timestamps），忽略权限的复制。

#### 示例命令：
```powershell
robocopy "\\192.168.107.226\研发中心$\研发中心-文件共享区\印制板" "\\192.168.104.211\印制板$" /E /COPY:DAT /R:0 /NFL /NDL /LOG:"C:\path\to\logfile.txt"
```

#### 参数解释：
+ `/COPY:DAT`：仅复制文件内容（数据）、文件属性和时间戳，不复制权限。
+ `/R:0`：失败时不重试。
+ `/NFL` 和 `/NDL`：简化输出日志。
+ `/LOG`：记录详细的复制情况。

---

### 2. **分两步操作**
如果希望**尽可能复制权限**，但在权限复制失败时，仍然只复制文件，可以分两步操作：

1. **尝试复制权限**。
2. 如果失败，则直接复制文件。

#### 第一步：尝试复制权限和文件
```powershell
robocopy "\\192.168.107.226\研发中心$\研发中心-文件共享区\印制板" "\\192.168.104.211\印制板$" /E /COPYALL /R:0 /NFL /NDL /LOG:"C:\path\to\copyall_log.txt"
```

+ 如果权限复制成功，一切正常。
+ 如果权限复制失败，你会在日志文件 `copyall_log.txt` 中看到相关的错误记录。

#### 第二步：只复制文件，忽略权限
如果第一步权限复制失败，则运行以下命令只复制文件：

```powershell
robocopy "\\192.168.107.226\研发中心$\研发中心-文件共享区\印制板" "\\192.168.104.211\印制板$" /E /COPY:DAT /R:0 /NFL /NDL /LOG:"C:\path\to\datonly_log.txt"
```

---

### 3. **一次性操作（自动容错复制）**
`robocopy` 提供了一个容错的选项：即使权限复制失败，也不会中断文件复制。

#### 示例命令：
```powershell
robocopy "\\192.168.107.226\研发中心$\研发中心-文件共享区\印制板" "\\192.168.104.211\印制板$" /E /COPY:DAT /SEC /R:0 /NFL /NDL /LOG:"C:\path\to\logfile.txt"
```

#### 参数解释：
+ `/COPY:DAT`：优先保证文件复制。
+ `/SEC`：在权限允许的情况下，尝试复制文件权限。
+ `/R:0`：忽略重试机制。
+ 如果权限复制失败，`robocopy` 会跳过权限部分，继续复制文件，不会中断整个操作。

---

### 4. **检查日志以确保正确性**
使用 `/LOG` 或 `/LOG+` 参数生成的日志文件，可以帮助你检查是否发生了权限复制错误。

日志中，文件和目录的状态如下：

+ `ERROR 5 (0x00000005)`：权限错误（拒绝访问）。
+ 如果有类似的错误，你可以确认文件是否已正常复制。

#### 日志生成示例：
```powershell
robocopy "\\192.168.107.226\研发中心$\研发中心-文件共享区\印制板" "\\192.168.104.211\印制板$" /E /COPYALL /R:0 /NFL /NDL /LOG:"C:\path\to\logfile.txt"
```

查看 `logfile.txt` 是否有错误信息，例如：

```powershell
ERROR 5 (0x00000005) Accessing Source Directory \\192.168.107.226\
Access is denied.
```

---

### 推荐命令
为了实现**尽量复制权限，但权限失败时只复制文件**的自动容错方案，推荐以下命令：

```powershell
robocopy "\\192.168.xxxx\xxx$\xxx\xxx" "\\192.168.xx.xx1\xx$" /E /COPY:DAT /SEC /R:0 /NFL /NDL /LOG:"C:\path\to\logfile.txt"
```

这种方式在权限失败时会自动跳过权限部分，继续复制文件和数据，不需要手动干预。

