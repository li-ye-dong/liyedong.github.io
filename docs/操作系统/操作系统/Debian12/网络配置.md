<font style="color:rgb(0, 0, 0);">电脑使用以太网卡时，必须以下列方法之一配置 IP 网络。最简单的方式是以 DHCP 动态配置，需要在本地网络有 DHCP 服务器。可能需要设置 </font>`**<font style="color:rgb(0, 0, 0);">hostname</font>**`<font style="color:rgb(0, 0, 0);"> 指定主机名称。DHCP 服务器就会送出适当的网络配置。</font>

**<font style="color:rgb(0, 0, 0);">例 8.1. DHCP 配置</font>**

```bash
auto enp0s31f6
iface enp0s31f6 inet dhcp
  hostname arrakis
```

<font style="color:rgb(0, 0, 0);">“静态” 配置必须以固定方式指明网络设置。至少包括 IP 网址及子网掩码；有时也列出网络及广播地址。链接外部的路由器作为网关。</font>

**<font style="color:rgb(0, 0, 0);">例 8.2. 静态配置</font>**

```bash
auto enp0s31f6
iface enp0s31f6 inet static
  address 192.168.0.3/24
  broadcast 192.168.0.255
  network 192.168.0.0
  gateway 192.168.0.1
```

已思考 5 秒

下面是仅针对服务器环境的 Debian 网络配置笔记，去除了与桌面或 Wi-Fi 相关的内容，便于在无 GUI 的纯服务器场景下快速配置和管理网络。

---

## 一、查看网络状态
| 功能 | 命令示例 | 说明 |
| --- | --- | --- |
| 查看所有接口 | `ip link show` | 推荐替代过时的 `ifconfig -a` |
| 查看 IP 地址 | `ip addr show`<br/> 或 `ip a` | 列出接口对应的 IP、网络掩码等信息 |
| 查看路由表 | `ip route show`<br/> 或 `ip r` | 列出默认网关及静态路由 |
| 查看链路状态 | `ethtool eth0` | 查看网卡速率、双工模式等硬件信息 |
| DHCP 客户端 | `sudo dhclient -v eth0` | 手动请求或刷新 DHCP 租约 |


---

## 二、临时调整（重启或服务重启后失效）
| 功能 | 命令示例 | 说明 |
| --- | --- | --- |
| 启用/禁用接口 | `sudo ip link set eth0 up`<br/>`sudo ip link set eth0 down` | 手动启用或停用网口 |
| 添加/删除 IP | `sudo ip addr add 192.168.1.100/24 dev eth0`<br/>`... del ...` | 临时分配或撤销 IP |
| 添加路由 | `sudo ip route add default via 192.168.1.1 dev eth0` | 手动设置默认网关 |
| 删除路由 | `sudo ip route del default` | 删除默认路由 |
| 刷新 DNS 缓存 | `sudo systemd-resolve --flush-caches` | 针对 systemd-resolved |
| 修复依赖 | `sudo apt -f install` | 出现依赖冲突时尝试自动修复（间接影响网络） |


---

## 三、永久配置一：`/etc/network/interfaces`
经典方式，适合 Debian 传统服务器环境。

```bash
# /etc/network/interfaces

# 回环接口
auto lo
iface lo inet loopback

# DHCP 自动获取 IP
auto eth0
iface eth0 inet dhcp

# 或者静态配置示例
# auto eth0
# iface eth0 inet static
#     address 192.168.1.100
#     netmask 255.255.255.0
#     gateway 192.168.1.1
#     dns-nameservers 8.8.8.8 114.114.114.114
```

+ 配置完成后：

```bash
sudo ifdown eth0 && sudo ifup eth0
# 或者
sudo systemctl restart networking
```

+ 可将额外配置文件放在 `/etc/network/interfaces.d/` 目录，保持主配置简洁。

---

## 四、永久配置二：`systemd-networkd`
现代服务器推荐，轻量且与 `systemd` 深度集成。配置文件放在 `/etc/systemd/network/`。

```bash
# /etc/systemd/network/10-eth0.network

[Match]
Name=eth0

[Network]
# DHCP
DHCP=ipv4

# 或静态
# Address=192.168.1.100/24
# Gateway=192.168.1.1
# DNS=8.8.8.8 114.114.114.114
```

+ 启用并启动服务：

```bash
sudo systemctl enable --now systemd-networkd
```

+ 查看状态：

```bash
networkctl list
networkctl status eth0
```

---

## 五、DNS 配置
### 1. 使用 `resolvconf`（推荐）
```bash
# 编辑 /etc/resolvconf/resolv.conf.d/base
nameserver 8.8.8.8
nameserver 114.114.114.114

# 更新生效
sudo resolvconf -u
```

### 2. 使用 `systemd-resolved`（Debian 12+）
编辑 `/etc/systemd/resolved.conf`，添加或修改：

```bash
[Resolve]
DNS=8.8.8.8 114.114.114.114
#FallbackDNS=
```

重启服务：

```bash
sudo systemctl restart systemd-resolved
```

---

## 六、综合建议
+ **首选方式**：
    - 旧版 Debian 或习惯经典配置，使用 `/etc/network/interfaces`。
    - Debian 10 及以上、或希望更现代管理，优先用 `systemd-networkd`。
+ **调试排查**：
    1. `ip addr` / `ip route` 确认配置是否生效；
    2. `journalctl -u networking` 或 `journalctl -u systemd-networkd` 查看日志；
    3. 确认 DNS：`systemd-resolve --status` 或查看 `/etc/resolv.conf`；
+ **自动化**：将以上配置文件纳入版本控制（如 Git），便于大规模服务器批量部署与回滚。

以上即为专注于无 GUI 服务器环境下的 Debian 网络配置笔记，祝部署顺利！

## netplan配置（ubuntu默认）
下面是一份基于 Netplan 的网络管理使用笔记，帮助你在 Ubuntu 及其它采用 Netplan 的系统上快速配置和排查网络。

---

## 一、简介
Netplan 是 Ubuntu 17.10 及以后版本默认的网络配置工具，采用 YAML 格式描述网络拓扑，底层通过 systemd-networkd 或 NetworkManager 实现。相比传统的 `/etc/network/interfaces`，它更加直观、统一。

**意见**：YAML 配置文件可读性强，适合团队协作，但要注意缩进和语法。配置前建议做好原有配置备份。

---

## 二、配置文件位置
所有配置都放在 `/etc/netplan/` 目录下，默认为一个或多个 `.yaml` 文件。文件名可自定义，但必须以 `.yaml` 结尾。

```bash
ls /etc/netplan/
# 例如：01-netcfg.yaml  50-cloud-init.yaml
```

---

## 三、基本命令
```bash
sudo netplan generate     # 生成底层配置（systemd-networkd 或 NetworkManager）
sudo netplan apply        # 立即应用配置
sudo netplan try          # 试用新配置；30 秒内回退到旧配置
sudo netplan ip leases    # 列出 DHCP 租约信息
```

+ **generate**：只生成，不改动运行时网络，适合先检查语法。
+ **apply**：应用并生效，可能会中断网络连接。
+ **try**：在可视化界面中确认后生效，断连会自动回退。

**建议**：远程操作时优先用 `netplan try`，避免误操作导致 SSH 断连。

---

## 四、YAML 结构
```yaml
# /etc/netplan/01-netcfg.yaml
network:                         # 顶级必须键
  version: 2                     # 配置版本，目前固定为 2
  renderer: networkd            # 或 NetworkManager
  ethernets:                    # 有线网卡配置
    enp0s3:                      # 网卡名称（ip link 查看）
      dhcp4: true                # 启用 IPv4 DHCP
      dhcp6: false               # 关闭 IPv6 DHCP
      optional: true             # 如果网卡不存在也不报错
```

**备注**：缩进必须为两个空格，不能用 Tab。

---

## 五、静态地址配置
```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      addresses:
        - 192.168.1.100/24     # 指定静态 IPv4 地址及掩码
      gateway4: 192.168.1.1    # IPv4 默认网关
      nameservers:             # DNS 服务器
        addresses:
          - 8.8.8.8
          - 8.8.4.4
```

保存后执行：

```bash
sudo netplan apply
```

---

## 六、高级示例
### 1. 多网卡绑定（Bonding）
```yaml
network:
  version: 2
  renderer: networkd
  bonds:
    bond0:
      interfaces: [enp0s3, enp0s8] # 绑定的网卡
      addresses: [10.0.0.10/24]
      gateway4: 10.0.0.1
      parameters:
        mode: active-backup      # 备份模式
        primary: enp0s3          # 主网卡
```

### 2. 桥接（Bridge，用于虚拟化）
```yaml
network:
  version: 2
  renderer: networkd
  bridges:
    br0:
      interfaces: [enp0s3]
      addresses: [192.168.122.50/24]
      gateway4: 192.168.122.1
      nameservers:
        addresses: [1.1.1.1]
```

### 3. VLAN
```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3: {}
  vlans:
    vlan100:
      id: 100
      link: enp0s3
      addresses: [172.16.100.2/24]
```

---

## 七、排查与调试
1. **语法校验**

```bash
sudo netplan generate
```

若有语法错误，命令会提示并退出，不会应用到网络。

2. **查看 DHCP 租约**

```bash
sudo netplan ip leases enp0s3
```

3. **底层服务日志**
    - systemd-networkd:

```bash
journalctl -u systemd-networkd -b
```

    - NetworkManager:

```bash
journalctl -u NetworkManager -b
```

4. **实时监控接口状态**

```bash
ip addr show enp0s3
ip route
```

---

## 八、常见注意事项
+ **文件顺序**：如果有多个 YAML 文件，按文件名排序合并。名字前缀数字越小，优先级越高。
+ **缩进严格**：YAML 对缩进敏感，建议用两个空格，切勿混用 Tab。
+ **渲染器选择**：桌面环境建议 `NetworkManager`；服务器常用 `networkd`。
+ **回滚保护**：远程操作前总用 `netplan try` 测试配置。
+ **版本兼容**：Ubuntu 20.04+ 推荐版本为 `version: 2`，如果出现不识别的字段，请检查系统版本和 Netplan 版本。

---

通过上述笔记，你可以快速掌握 Netplan 的核心用法，并根据需求灵活扩展到 Bonding、Bridge、VLAN 等场景。测试环境中多试几种组合，熟悉后上线即可。祝你配置顺利！

